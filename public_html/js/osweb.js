/*!
* @license CreateJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011-2015 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/
this.createjs=this.createjs||{},createjs.extend=function(a,b){"use strict";function c(){this.constructor=a}return c.prototype=b.prototype,a.prototype=new c},this.createjs=this.createjs||{},createjs.promote=function(a,b){"use strict";var c=a.prototype,d=Object.getPrototypeOf&&Object.getPrototypeOf(c)||c.__proto__;if(d){c[(b+="_")+"constructor"]=d.constructor;for(var e in d)c.hasOwnProperty(e)&&"function"==typeof d[e]&&(c[b+e]=d[e])}return a},this.createjs=this.createjs||{},createjs.indexOf=function(a,b){"use strict";for(var c=0,d=a.length;d>c;c++)if(b===a[c])return c;return-1},this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.type=a,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=!!b,this.cancelable=!!c,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}var b=a.prototype;b.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0},b.stopPropagation=function(){this.propagationStopped=!0},b.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},b.remove=function(){this.removed=!0},b.clone=function(){return new a(this.type,this.bubbles,this.cancelable)},b.set=function(a){for(var b in a)this[b]=a[b];return this},b.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this._listeners=null,this._captureListeners=null}var b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.on=b.on,a.removeEventListener=a.off=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent,a._dispatchEvent=b._dispatchEvent,a.willTrigger=b.willTrigger},b.addEventListener=function(a,b,c){var d;d=c?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var e=d[a];return e&&this.removeEventListener(a,b,c),e=d[a],e?e.push(b):d[a]=[b],b},b.on=function(a,b,c,d,e,f){return b.handleEvent&&(c=c||b,b=b.handleEvent),c=c||this,this.addEventListener(a,function(a){b.call(c,a,e),d&&a.remove()},f)},b.removeEventListener=function(a,b,c){var d=c?this._captureListeners:this._listeners;if(d){var e=d[a];if(e)for(var f=0,g=e.length;g>f;f++)if(e[f]==b){1==g?delete d[a]:e.splice(f,1);break}}},b.off=b.removeEventListener,b.removeAllEventListeners=function(a){a?(this._listeners&&delete this._listeners[a],this._captureListeners&&delete this._captureListeners[a]):this._listeners=this._captureListeners=null},b.dispatchEvent=function(a,b,c){if("string"==typeof a){var d=this._listeners;if(!(b||d&&d[a]))return!0;a=new createjs.Event(a,b,c)}else a.target&&a.clone&&(a=a.clone());try{a.target=this}catch(e){}if(a.bubbles&&this.parent){for(var f=this,g=[f];f.parent;)g.push(f=f.parent);var h,i=g.length;for(h=i-1;h>=0&&!a.propagationStopped;h--)g[h]._dispatchEvent(a,1+(0==h));for(h=1;i>h&&!a.propagationStopped;h++)g[h]._dispatchEvent(a,3)}else this._dispatchEvent(a,2);return!a.defaultPrevented},b.hasEventListener=function(a){var b=this._listeners,c=this._captureListeners;return!!(b&&b[a]||c&&c[a])},b.willTrigger=function(a){for(var b=this;b;){if(b.hasEventListener(a))return!0;b=b.parent}return!1},b.toString=function(){return"[EventDispatcher]"},b._dispatchEvent=function(a,b){var c,d=1==b?this._captureListeners:this._listeners;if(a&&d){var e=d[a.type];if(!e||!(c=e.length))return;try{a.currentTarget=this}catch(f){}try{a.eventPhase=b}catch(f){}a.removed=!1,e=e.slice();for(var g=0;c>g&&!a.immediatePropagationStopped;g++){var h=e[g];h.handleEvent?h.handleEvent(a):h(a),a.removed&&(this.off(a.type,h,1==b),a.removed=!1)}}},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Ticker cannot be instantiated."}a.RAF_SYNCHED="synched",a.RAF="raf",a.TIMEOUT="timeout",a.useRAF=!1,a.timingMode=null,a.maxDelta=0,a.paused=!1,a.removeEventListener=null,a.removeAllEventListeners=null,a.dispatchEvent=null,a.hasEventListener=null,a._listeners=null,createjs.EventDispatcher.initialize(a),a._addEventListener=a.addEventListener,a.addEventListener=function(){return!a._inited&&a.init(),a._addEventListener.apply(a,arguments)},a._inited=!1,a._startTime=0,a._pausedTime=0,a._ticks=0,a._pausedTicks=0,a._interval=50,a._lastTime=0,a._times=null,a._tickTimes=null,a._timerId=null,a._raf=!0,a.setInterval=function(b){a._interval=b,a._inited&&a._setupTick()},a.getInterval=function(){return a._interval},a.setFPS=function(b){a.setInterval(1e3/b)},a.getFPS=function(){return 1e3/a._interval};try{Object.defineProperties(a,{interval:{get:a.getInterval,set:a.setInterval},framerate:{get:a.getFPS,set:a.setFPS}})}catch(b){console.log(b)}a.init=function(){a._inited||(a._inited=!0,a._times=[],a._tickTimes=[],a._startTime=a._getTime(),a._times.push(a._lastTime=0),a.interval=a._interval)},a.reset=function(){if(a._raf){var b=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;b&&b(a._timerId)}else clearTimeout(a._timerId);a.removeAllEventListeners("tick"),a._timerId=a._times=a._tickTimes=null,a._startTime=a._lastTime=a._ticks=0,a._inited=!1},a.getMeasuredTickTime=function(b){var c=0,d=a._tickTimes;if(!d||d.length<1)return-1;b=Math.min(d.length,b||0|a.getFPS());for(var e=0;b>e;e++)c+=d[e];return c/b},a.getMeasuredFPS=function(b){var c=a._times;return!c||c.length<2?-1:(b=Math.min(c.length-1,b||0|a.getFPS()),1e3/((c[0]-c[b])/b))},a.setPaused=function(b){a.paused=b},a.getPaused=function(){return a.paused},a.getTime=function(b){return a._startTime?a._getTime()-(b?a._pausedTime:0):-1},a.getEventTime=function(b){return a._startTime?(a._lastTime||a._startTime)-(b?a._pausedTime:0):-1},a.getTicks=function(b){return a._ticks-(b?a._pausedTicks:0)},a._handleSynch=function(){a._timerId=null,a._setupTick(),a._getTime()-a._lastTime>=.97*(a._interval-1)&&a._tick()},a._handleRAF=function(){a._timerId=null,a._setupTick(),a._tick()},a._handleTimeout=function(){a._timerId=null,a._setupTick(),a._tick()},a._setupTick=function(){if(null==a._timerId){var b=a.timingMode||a.useRAF&&a.RAF_SYNCHED;if(b==a.RAF_SYNCHED||b==a.RAF){var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(c)return a._timerId=c(b==a.RAF?a._handleRAF:a._handleSynch),void(a._raf=!0)}a._raf=!1,a._timerId=setTimeout(a._handleTimeout,a._interval)}},a._tick=function(){var b=a.paused,c=a._getTime(),d=c-a._lastTime;if(a._lastTime=c,a._ticks++,b&&(a._pausedTicks++,a._pausedTime+=d),a.hasEventListener("tick")){var e=new createjs.Event("tick"),f=a.maxDelta;e.delta=f&&d>f?f:d,e.paused=b,e.time=c,e.runTime=c-a._pausedTime,a.dispatchEvent(e)}for(a._tickTimes.unshift(a._getTime()-c);a._tickTimes.length>100;)a._tickTimes.pop();for(a._times.unshift(c);a._times.length>100;)a._times.pop()};var c=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);a._getTime=function(){return(c&&c.call(performance)||(new Date).getTime())-a._startTime},createjs.Ticker=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"UID cannot be instantiated"}a._nextID=0,a.get=function(){return a._nextID++},createjs.UID=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){this.Event_constructor(a,b,c),this.stageX=d,this.stageY=e,this.rawX=null==i?d:i,this.rawY=null==j?e:j,this.nativeEvent=f,this.pointerID=g,this.primary=!!h,this.relatedTarget=k}var b=createjs.extend(a,createjs.Event);b._get_localX=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).x},b._get_localY=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).y},b._get_isTouch=function(){return-1!==this.pointerID};try{Object.defineProperties(b,{localX:{get:b._get_localX},localY:{get:b._get_localY},isTouch:{get:b._get_isTouch}})}catch(c){}b.clone=function(){return new a(this.type,this.bubbles,this.cancelable,this.stageX,this.stageY,this.nativeEvent,this.pointerID,this.primary,this.rawX,this.rawY)},b.toString=function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"},createjs.MouseEvent=createjs.promote(a,"Event")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d,e,f){this.setValues(a,b,c,d,e,f)}var b=a.prototype;a.DEG_TO_RAD=Math.PI/180,a.identity=null,b.setValues=function(a,b,c,d,e,f){return this.a=null==a?1:a,this.b=b||0,this.c=c||0,this.d=null==d?1:d,this.tx=e||0,this.ty=f||0,this},b.append=function(a,b,c,d,e,f){var g=this.a,h=this.b,i=this.c,j=this.d;return(1!=a||0!=b||0!=c||1!=d)&&(this.a=g*a+i*b,this.b=h*a+j*b,this.c=g*c+i*d,this.d=h*c+j*d),this.tx=g*e+i*f+this.tx,this.ty=h*e+j*f+this.ty,this},b.prepend=function(a,b,c,d,e,f){var g=this.a,h=this.c,i=this.tx;return this.a=a*g+c*this.b,this.b=b*g+d*this.b,this.c=a*h+c*this.d,this.d=b*h+d*this.d,this.tx=a*i+c*this.ty+e,this.ty=b*i+d*this.ty+f,this},b.appendMatrix=function(a){return this.append(a.a,a.b,a.c,a.d,a.tx,a.ty)},b.prependMatrix=function(a){return this.prepend(a.a,a.b,a.c,a.d,a.tx,a.ty)},b.appendTransform=function(b,c,d,e,f,g,h,i,j){if(f%360)var k=f*a.DEG_TO_RAD,l=Math.cos(k),m=Math.sin(k);else l=1,m=0;return g||h?(g*=a.DEG_TO_RAD,h*=a.DEG_TO_RAD,this.append(Math.cos(h),Math.sin(h),-Math.sin(g),Math.cos(g),b,c),this.append(l*d,m*d,-m*e,l*e,0,0)):this.append(l*d,m*d,-m*e,l*e,b,c),(i||j)&&(this.tx-=i*this.a+j*this.c,this.ty-=i*this.b+j*this.d),this},b.prependTransform=function(b,c,d,e,f,g,h,i,j){if(f%360)var k=f*a.DEG_TO_RAD,l=Math.cos(k),m=Math.sin(k);else l=1,m=0;return(i||j)&&(this.tx-=i,this.ty-=j),g||h?(g*=a.DEG_TO_RAD,h*=a.DEG_TO_RAD,this.prepend(l*d,m*d,-m*e,l*e,0,0),this.prepend(Math.cos(h),Math.sin(h),-Math.sin(g),Math.cos(g),b,c)):this.prepend(l*d,m*d,-m*e,l*e,b,c),this},b.rotate=function(b){b*=a.DEG_TO_RAD;var c=Math.cos(b),d=Math.sin(b),e=this.a,f=this.b;return this.a=e*c+this.c*d,this.b=f*c+this.d*d,this.c=-e*d+this.c*c,this.d=-f*d+this.d*c,this},b.skew=function(b,c){return b*=a.DEG_TO_RAD,c*=a.DEG_TO_RAD,this.append(Math.cos(c),Math.sin(c),-Math.sin(b),Math.cos(b),0,0),this},b.scale=function(a,b){return this.a*=a,this.b*=a,this.c*=b,this.d*=b,this},b.translate=function(a,b){return this.tx+=this.a*a+this.c*b,this.ty+=this.b*a+this.d*b,this},b.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},b.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;return this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f,this},b.isIdentity=function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d},b.equals=function(a){return this.tx===a.tx&&this.ty===a.ty&&this.a===a.a&&this.b===a.b&&this.c===a.c&&this.d===a.d},b.transformPoint=function(a,b,c){return c=c||{},c.x=a*this.a+b*this.c+this.tx,c.y=a*this.b+b*this.d+this.ty,c},b.decompose=function(b){null==b&&(b={}),b.x=this.tx,b.y=this.ty,b.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),b.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var c=Math.atan2(-this.c,this.d),d=Math.atan2(this.b,this.a),e=Math.abs(1-c/d);return 1e-5>e?(b.rotation=d/a.DEG_TO_RAD,this.a<0&&this.d>=0&&(b.rotation+=b.rotation<=0?180:-180),b.skewX=b.skewY=0):(b.skewX=c/a.DEG_TO_RAD,b.skewY=d/a.DEG_TO_RAD),b},b.copy=function(a){return this.setValues(a.a,a.b,a.c,a.d,a.tx,a.ty)},b.clone=function(){return new a(this.a,this.b,this.c,this.d,this.tx,this.ty)},b.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},a.identity=new a,createjs.Matrix2D=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d,e){this.setValues(a,b,c,d,e)}var b=a.prototype;b.setValues=function(a,b,c,d,e){return this.visible=null==a?!0:!!a,this.alpha=null==b?1:b,this.shadow=c,this.compositeOperation=d,this.matrix=e||this.matrix&&this.matrix.identity()||new createjs.Matrix2D,this},b.append=function(a,b,c,d,e){return this.alpha*=b,this.shadow=c||this.shadow,this.compositeOperation=d||this.compositeOperation,this.visible=this.visible&&a,e&&this.matrix.appendMatrix(e),this},b.prepend=function(a,b,c,d,e){return this.alpha*=b,this.shadow=this.shadow||c,this.compositeOperation=this.compositeOperation||d,this.visible=this.visible&&a,e&&this.matrix.prependMatrix(e),this},b.identity=function(){return this.visible=!0,this.alpha=1,this.shadow=this.compositeOperation=null,this.matrix.identity(),this},b.clone=function(){return new a(this.alpha,this.shadow,this.compositeOperation,this.visible,this.matrix.clone())},createjs.DisplayProps=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.setValues(a,b)}var b=a.prototype;b.setValues=function(a,b){return this.x=a||0,this.y=b||0,this},b.copy=function(a){return this.x=a.x,this.y=a.y,this},b.clone=function(){return new a(this.x,this.y)},b.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},createjs.Point=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d){this.setValues(a,b,c,d)}var b=a.prototype;b.setValues=function(a,b,c,d){return this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0,this},b.extend=function(a,b,c,d){return c=c||0,d=d||0,a+c>this.x+this.width&&(this.width=a+c-this.x),b+d>this.y+this.height&&(this.height=b+d-this.y),a<this.x&&(this.width+=this.x-a,this.x=a),b<this.y&&(this.height+=this.y-b,this.y=b),this},b.pad=function(a,b,c,d){return this.x-=b,this.y-=a,this.width+=b+d,this.height+=a+c,this},b.copy=function(a){return this.setValues(a.x,a.y,a.width,a.height)},b.contains=function(a,b,c,d){return c=c||0,d=d||0,a>=this.x&&a+c<=this.x+this.width&&b>=this.y&&b+d<=this.y+this.height},b.union=function(a){return this.clone().extend(a.x,a.y,a.width,a.height)},b.intersection=function(b){var c=b.x,d=b.y,e=c+b.width,f=d+b.height;return this.x>c&&(c=this.x),this.y>d&&(d=this.y),this.x+this.width<e&&(e=this.x+this.width),this.y+this.height<f&&(f=this.y+this.height),c>=e||d>=f?null:new a(c,d,e-c,f-d)},b.intersects=function(a){return a.x<=this.x+this.width&&this.x<=a.x+a.width&&a.y<=this.y+this.height&&this.y<=a.y+a.height},b.isEmpty=function(){return this.width<=0||this.height<=0},b.clone=function(){return new a(this.x,this.y,this.width,this.height)},b.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"},createjs.Rectangle=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d,e,f,g){a.addEventListener&&(this.target=a,this.overLabel=null==c?"over":c,this.outLabel=null==b?"out":b,this.downLabel=null==d?"down":d,this.play=e,this._isPressed=!1,this._isOver=!1,this._enabled=!1,a.mouseChildren=!1,this.enabled=!0,this.handleEvent({}),f&&(g&&(f.actionsEnabled=!1,f.gotoAndStop&&f.gotoAndStop(g)),a.hitArea=f))}var b=a.prototype;b.setEnabled=function(a){if(a!=this._enabled){var b=this.target;this._enabled=a,a?(b.cursor="pointer",b.addEventListener("rollover",this),b.addEventListener("rollout",this),b.addEventListener("mousedown",this),b.addEventListener("pressup",this),b._reset&&(b.__reset=b._reset,b._reset=this._reset)):(b.cursor=null,b.removeEventListener("rollover",this),b.removeEventListener("rollout",this),b.removeEventListener("mousedown",this),b.removeEventListener("pressup",this),b.__reset&&(b._reset=b.__reset,delete b.__reset))}},b.getEnabled=function(){return this._enabled};try{Object.defineProperties(b,{enabled:{get:b.getEnabled,set:b.setEnabled}})}catch(c){}b.toString=function(){return"[ButtonHelper]"},b.handleEvent=function(a){var b,c=this.target,d=a.type;"mousedown"==d?(this._isPressed=!0,b=this.downLabel):"pressup"==d?(this._isPressed=!1,b=this._isOver?this.overLabel:this.outLabel):"rollover"==d?(this._isOver=!0,b=this._isPressed?this.downLabel:this.overLabel):(this._isOver=!1,b=this._isPressed?this.overLabel:this.outLabel),this.play?c.gotoAndPlay&&c.gotoAndPlay(b):c.gotoAndStop&&c.gotoAndStop(b)},b._reset=function(){var a=this.paused;this.__reset(),this.paused=a},createjs.ButtonHelper=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d){this.color=a||"black",this.offsetX=b||0,this.offsetY=c||0,this.blur=d||0}var b=a.prototype;a.identity=new a("transparent",0,0,0),b.toString=function(){return"[Shadow]"},b.clone=function(){return new a(this.color,this.offsetX,this.offsetY,this.blur)},createjs.Shadow=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.EventDispatcher_constructor(),this.complete=!0,this.framerate=0,this._animations=null,this._frames=null,this._images=null,this._data=null,this._loadCount=0,this._frameHeight=0,this._frameWidth=0,this._numFrames=0,this._regX=0,this._regY=0,this._spacing=0,this._margin=0,this._parseData(a)}var b=createjs.extend(a,createjs.EventDispatcher);b.getAnimations=function(){return this._animations.slice()};try{Object.defineProperties(b,{animations:{get:b.getAnimations}})}catch(c){}b.getNumFrames=function(a){if(null==a)return this._frames?this._frames.length:this._numFrames||0;var b=this._data[a];return null==b?0:b.frames.length},b.getAnimation=function(a){return this._data[a]},b.getFrame=function(a){var b;return this._frames&&(b=this._frames[a])?b:null},b.getFrameBounds=function(a,b){var c=this.getFrame(a);return c?(b||new createjs.Rectangle).setValues(-c.regX,-c.regY,c.rect.width,c.rect.height):null},b.toString=function(){return"[SpriteSheet]"},b.clone=function(){throw"SpriteSheet cannot be cloned."},b._parseData=function(a){var b,c,d,e;if(null!=a){if(this.framerate=a.framerate||0,a.images&&(c=a.images.length)>0)for(e=this._images=[],b=0;c>b;b++){var f=a.images[b];if("string"==typeof f){var g=f;f=document.createElement("img"),f.src=g}e.push(f),f.getContext||f.naturalWidth||(this._loadCount++,this.complete=!1,function(a,b){f.onload=function(){a._handleImageLoad(b)}}(this,g),function(a,b){f.onerror=function(){a._handleImageError(b)}}(this,g))}if(null==a.frames);else if(Array.isArray(a.frames))for(this._frames=[],e=a.frames,b=0,c=e.length;c>b;b++){var h=e[b];this._frames.push({image:this._images[h[4]?h[4]:0],rect:new createjs.Rectangle(h[0],h[1],h[2],h[3]),regX:h[5]||0,regY:h[6]||0})}else d=a.frames,this._frameWidth=d.width,this._frameHeight=d.height,this._regX=d.regX||0,this._regY=d.regY||0,this._spacing=d.spacing||0,this._margin=d.margin||0,this._numFrames=d.count,0==this._loadCount&&this._calculateFrames();if(this._animations=[],null!=(d=a.animations)){this._data={};var i;for(i in d){var j={name:i},k=d[i];if("number"==typeof k)e=j.frames=[k];else if(Array.isArray(k))if(1==k.length)j.frames=[k[0]];else for(j.speed=k[3],j.next=k[2],e=j.frames=[],b=k[0];b<=k[1];b++)e.push(b);else{j.speed=k.speed,j.next=k.next;var l=k.frames;e=j.frames="number"==typeof l?[l]:l.slice(0)}(j.next===!0||void 0===j.next)&&(j.next=i),(j.next===!1||e.length<2&&j.next==i)&&(j.next=null),j.speed||(j.speed=1),this._animations.push(i),this._data[i]=j}}}},b._handleImageLoad=function(a){0==--this._loadCount&&(this._calculateFrames(),this.complete=!0,this.dispatchEvent("complete"))},b._handleImageError=function(a){var b=new createjs.Event("error");b.src=a,this.dispatchEvent(b),0==--this._loadCount&&this.dispatchEvent("complete")},b._calculateFrames=function(){if(!this._frames&&0!=this._frameWidth){this._frames=[];var a=this._numFrames||1e5,b=0,c=this._frameWidth,d=this._frameHeight,e=this._spacing,f=this._margin;a:for(var g=0,h=this._images;g<h.length;g++)for(var i=h[g],j=i.width,k=i.height,l=f;k-f-d>=l;){for(var m=f;j-f-c>=m;){if(b>=a)break a;b++,this._frames.push({image:i,rect:new createjs.Rectangle(m,l,c,d),regX:this._regX,regY:this._regY}),m+=c+e}l+=d+e}this._numFrames=b}},createjs.SpriteSheet=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.command=null,this._stroke=null,this._strokeStyle=null,this._oldStrokeStyle=null,this._strokeDash=null,this._oldStrokeDash=null,this._strokeIgnoreScale=!1,this._fill=null,this._instructions=[],this._commitIndex=0,this._activeInstructions=[],this._dirty=!1,this._storeIndex=0,this.clear()}var b=a.prototype,c=a;a.getRGB=function(a,b,c,d){return null!=a&&null==c&&(d=b,c=255&a,b=a>>8&255,a=a>>16&255),null==d?"rgb("+a+","+b+","+c+")":"rgba("+a+","+b+","+c+","+d+")"},a.getHSL=function(a,b,c,d){return null==d?"hsl("+a%360+","+b+"%,"+c+"%)":"hsla("+a%360+","+b+"%,"+c+"%,"+d+")"},a.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63},a.STROKE_CAPS_MAP=["butt","round","square"],a.STROKE_JOINTS_MAP=["miter","round","bevel"];var d=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");d.getContext&&(a._ctx=d.getContext("2d"),d.width=d.height=1),b.getInstructions=function(){return this._updateInstructions(),this._instructions};try{Object.defineProperties(b,{instructions:{get:b.getInstructions}})}catch(e){}b.isEmpty=function(){return!(this._instructions.length||this._activeInstructions.length)},b.draw=function(a,b){this._updateInstructions();for(var c=this._instructions,d=this._storeIndex,e=c.length;e>d;d++)c[d].exec(a,b)},b.drawAsPath=function(a){this._updateInstructions();for(var b,c=this._instructions,d=this._storeIndex,e=c.length;e>d;d++)(b=c[d]).path!==!1&&b.exec(a)},b.moveTo=function(a,b){return this.append(new c.MoveTo(a,b),!0)},b.lineTo=function(a,b){return this.append(new c.LineTo(a,b))},b.arcTo=function(a,b,d,e,f){return this.append(new c.ArcTo(a,b,d,e,f))},b.arc=function(a,b,d,e,f,g){return this.append(new c.Arc(a,b,d,e,f,g))},b.quadraticCurveTo=function(a,b,d,e){return this.append(new c.QuadraticCurveTo(a,b,d,e))},b.bezierCurveTo=function(a,b,d,e,f,g){return this.append(new c.BezierCurveTo(a,b,d,e,f,g))},b.rect=function(a,b,d,e){return this.append(new c.Rect(a,b,d,e))},b.closePath=function(){return this._activeInstructions.length?this.append(new c.ClosePath):this},b.clear=function(){return this._instructions.length=this._activeInstructions.length=this._commitIndex=0,this._strokeStyle=this._oldStrokeStyle=this._stroke=this._fill=this._strokeDash=this._oldStrokeDash=null,this._dirty=this._strokeIgnoreScale=!1,this},b.beginFill=function(a){return this._setFill(a?new c.Fill(a):null)},b.beginLinearGradientFill=function(a,b,d,e,f,g){return this._setFill((new c.Fill).linearGradient(a,b,d,e,f,g))},b.beginRadialGradientFill=function(a,b,d,e,f,g,h,i){return this._setFill((new c.Fill).radialGradient(a,b,d,e,f,g,h,i))},b.beginBitmapFill=function(a,b,d){return this._setFill(new c.Fill(null,d).bitmap(a,b))},b.endFill=function(){return this.beginFill()},b.setStrokeStyle=function(a,b,d,e,f){return this._updateInstructions(!0),this._strokeStyle=this.command=new c.StrokeStyle(a,b,d,e,f),this._stroke&&(this._stroke.ignoreScale=f),this._strokeIgnoreScale=f,this},b.setStrokeDash=function(a,b){return this._updateInstructions(!0),this._strokeDash=this.command=new c.StrokeDash(a,b),this},b.beginStroke=function(a){return this._setStroke(a?new c.Stroke(a):null)},b.beginLinearGradientStroke=function(a,b,d,e,f,g){return this._setStroke((new c.Stroke).linearGradient(a,b,d,e,f,g))},b.beginRadialGradientStroke=function(a,b,d,e,f,g,h,i){return this._setStroke((new c.Stroke).radialGradient(a,b,d,e,f,g,h,i))},b.beginBitmapStroke=function(a,b){return this._setStroke((new c.Stroke).bitmap(a,b))},b.endStroke=function(){return this.beginStroke()},b.curveTo=b.quadraticCurveTo,b.drawRect=b.rect,b.drawRoundRect=function(a,b,c,d,e){return this.drawRoundRectComplex(a,b,c,d,e,e,e,e)},b.drawRoundRectComplex=function(a,b,d,e,f,g,h,i){return this.append(new c.RoundRect(a,b,d,e,f,g,h,i))},b.drawCircle=function(a,b,d){return this.append(new c.Circle(a,b,d))},b.drawEllipse=function(a,b,d,e){return this.append(new c.Ellipse(a,b,d,e))},b.drawPolyStar=function(a,b,d,e,f,g){return this.append(new c.PolyStar(a,b,d,e,f,g))},b.append=function(a,b){return this._activeInstructions.push(a),this.command=a,b||(this._dirty=!0),this},b.decodePath=function(b){for(var c=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo,this.closePath],d=[2,2,4,6,0],e=0,f=b.length,g=[],h=0,i=0,j=a.BASE_64;f>e;){var k=b.charAt(e),l=j[k],m=l>>3,n=c[m];if(!n||3&l)throw"bad path data (@"+e+"): "+k;var o=d[m];m||(h=i=0),g.length=0,e++;for(var p=(l>>2&1)+2,q=0;o>q;q++){var r=j[b.charAt(e)],s=r>>5?-1:1;r=(31&r)<<6|j[b.charAt(e+1)],3==p&&(r=r<<6|j[b.charAt(e+2)]),r=s*r/10,q%2?h=r+=h:i=r+=i,g[q]=r,e+=p}n.apply(this,g)}return this},b.store=function(){return this._updateInstructions(!0),this._storeIndex=this._instructions.length,this},b.unstore=function(){return this._storeIndex=0,this},b.clone=function(){var b=new a;return b.command=this.command,b._stroke=this._stroke,b._strokeStyle=this._strokeStyle,b._strokeDash=this._strokeDash,b._strokeIgnoreScale=this._strokeIgnoreScale,b._fill=this._fill,b._instructions=this._instructions.slice(),b._commitIndex=this._commitIndex,b._activeInstructions=this._activeInstructions.slice(),b._dirty=this._dirty,b._storeIndex=this._storeIndex,b},b.toString=function(){return"[Graphics]"},b.mt=b.moveTo,b.lt=b.lineTo,b.at=b.arcTo,b.bt=b.bezierCurveTo,b.qt=b.quadraticCurveTo,b.a=b.arc,b.r=b.rect,b.cp=b.closePath,b.c=b.clear,b.f=b.beginFill,b.lf=b.beginLinearGradientFill,b.rf=b.beginRadialGradientFill,b.bf=b.beginBitmapFill,b.ef=b.endFill,b.ss=b.setStrokeStyle,b.sd=b.setStrokeDash,b.s=b.beginStroke,b.ls=b.beginLinearGradientStroke,b.rs=b.beginRadialGradientStroke,b.bs=b.beginBitmapStroke,b.es=b.endStroke,b.dr=b.drawRect,b.rr=b.drawRoundRect,b.rc=b.drawRoundRectComplex,b.dc=b.drawCircle,b.de=b.drawEllipse,b.dp=b.drawPolyStar,b.p=b.decodePath,b._updateInstructions=function(b){var c=this._instructions,d=this._activeInstructions,e=this._commitIndex;if(this._dirty&&d.length){c.length=e,c.push(a.beginCmd);var f=d.length,g=c.length;c.length=g+f;for(var h=0;f>h;h++)c[h+g]=d[h];this._fill&&c.push(this._fill),this._stroke&&(this._strokeDash!==this._oldStrokeDash&&(this._oldStrokeDash=this._strokeDash,c.push(this._strokeDash)),this._strokeStyle!==this._oldStrokeStyle&&(this._oldStrokeStyle=this._strokeStyle,c.push(this._strokeStyle)),c.push(this._stroke)),this._dirty=!1}b&&(d.length=0,this._commitIndex=c.length)},b._setFill=function(a){return this._updateInstructions(!0),this.command=this._fill=a,this},b._setStroke=function(a){return this._updateInstructions(!0),(this.command=this._stroke=a)&&(a.ignoreScale=this._strokeIgnoreScale),this},(c.LineTo=function(a,b){this.x=a,this.y=b}).prototype.exec=function(a){a.lineTo(this.x,this.y)},(c.MoveTo=function(a,b){this.x=a,this.y=b}).prototype.exec=function(a){a.moveTo(this.x,this.y)},(c.ArcTo=function(a,b,c,d,e){this.x1=a,this.y1=b,this.x2=c,this.y2=d,this.radius=e}).prototype.exec=function(a){a.arcTo(this.x1,this.y1,this.x2,this.y2,this.radius)},(c.Arc=function(a,b,c,d,e,f){this.x=a,this.y=b,this.radius=c,this.startAngle=d,this.endAngle=e,this.anticlockwise=!!f}).prototype.exec=function(a){a.arc(this.x,this.y,this.radius,this.startAngle,this.endAngle,this.anticlockwise)},(c.QuadraticCurveTo=function(a,b,c,d){this.cpx=a,this.cpy=b,this.x=c,this.y=d}).prototype.exec=function(a){a.quadraticCurveTo(this.cpx,this.cpy,this.x,this.y)},(c.BezierCurveTo=function(a,b,c,d,e,f){this.cp1x=a,this.cp1y=b,this.cp2x=c,this.cp2y=d,this.x=e,this.y=f}).prototype.exec=function(a){a.bezierCurveTo(this.cp1x,this.cp1y,this.cp2x,this.cp2y,this.x,this.y)},(c.Rect=function(a,b,c,d){this.x=a,this.y=b,this.w=c,this.h=d}).prototype.exec=function(a){a.rect(this.x,this.y,this.w,this.h)},(c.ClosePath=function(){}).prototype.exec=function(a){a.closePath()},(c.BeginPath=function(){}).prototype.exec=function(a){a.beginPath()},b=(c.Fill=function(a,b){this.style=a,this.matrix=b}).prototype,b.exec=function(a){if(this.style){a.fillStyle=this.style;var b=this.matrix;b&&(a.save(),a.transform(b.a,b.b,b.c,b.d,b.tx,b.ty)),a.fill(),b&&a.restore()}},b.linearGradient=function(b,c,d,e,f,g){for(var h=this.style=a._ctx.createLinearGradient(d,e,f,g),i=0,j=b.length;j>i;i++)h.addColorStop(c[i],b[i]);return h.props={colors:b,ratios:c,x0:d,y0:e,x1:f,y1:g,type:"linear"},this},b.radialGradient=function(b,c,d,e,f,g,h,i){for(var j=this.style=a._ctx.createRadialGradient(d,e,f,g,h,i),k=0,l=b.length;l>k;k++)j.addColorStop(c[k],b[k]);return j.props={colors:b,ratios:c,x0:d,y0:e,r0:f,x1:g,y1:h,r1:i,type:"radial"},this},b.bitmap=function(b,c){if(b.naturalWidth||b.getContext||b.readyState>=2){var d=this.style=a._ctx.createPattern(b,c||"");d.props={image:b,repetition:c,type:"bitmap"}}return this},b.path=!1,b=(c.Stroke=function(a,b){this.style=a,this.ignoreScale=b}).prototype,b.exec=function(a){this.style&&(a.strokeStyle=this.style,this.ignoreScale&&(a.save(),a.setTransform(1,0,0,1,0,0)),a.stroke(),this.ignoreScale&&a.restore())},b.linearGradient=c.Fill.prototype.linearGradient,b.radialGradient=c.Fill.prototype.radialGradient,b.bitmap=c.Fill.prototype.bitmap,b.path=!1,b=(c.StrokeStyle=function(a,b,c,d,e){this.width=a,this.caps=b,this.joints=c,this.miterLimit=d,this.ignoreScale=e}).prototype,b.exec=function(b){b.lineWidth=null==this.width?"1":this.width,b.lineCap=null==this.caps?"butt":isNaN(this.caps)?this.caps:a.STROKE_CAPS_MAP[this.caps],b.lineJoin=null==this.joints?"miter":isNaN(this.joints)?this.joints:a.STROKE_JOINTS_MAP[this.joints],b.miterLimit=null==this.miterLimit?"10":this.miterLimit,b.ignoreScale=null==this.ignoreScale?!1:this.ignoreScale},b.path=!1,(c.StrokeDash=function(a,b){this.segments=a,this.offset=b||0}).prototype.exec=function(a){a.setLineDash&&(a.setLineDash(this.segments||c.StrokeDash.EMPTY_SEGMENTS),a.lineDashOffset=this.offset||0)},c.StrokeDash.EMPTY_SEGMENTS=[],(c.RoundRect=function(a,b,c,d,e,f,g,h){this.x=a,this.y=b,this.w=c,this.h=d,this.radiusTL=e,this.radiusTR=f,this.radiusBR=g,this.radiusBL=h}).prototype.exec=function(a){var b=(j>i?i:j)/2,c=0,d=0,e=0,f=0,g=this.x,h=this.y,i=this.w,j=this.h,k=this.radiusTL,l=this.radiusTR,m=this.radiusBR,n=this.radiusBL;0>k&&(k*=c=-1),k>b&&(k=b),0>l&&(l*=d=-1),l>b&&(l=b),0>m&&(m*=e=-1),m>b&&(m=b),0>n&&(n*=f=-1),n>b&&(n=b),a.moveTo(g+i-l,h),a.arcTo(g+i+l*d,h-l*d,g+i,h+l,l),a.lineTo(g+i,h+j-m),a.arcTo(g+i+m*e,h+j+m*e,g+i-m,h+j,m),a.lineTo(g+n,h+j),a.arcTo(g-n*f,h+j+n*f,g,h+j-n,n),a.lineTo(g,h+k),a.arcTo(g-k*c,h-k*c,g+k,h,k),a.closePath()},(c.Circle=function(a,b,c){this.x=a,this.y=b,this.radius=c}).prototype.exec=function(a){a.arc(this.x,this.y,this.radius,0,2*Math.PI)},(c.Ellipse=function(a,b,c,d){this.x=a,this.y=b,this.w=c,this.h=d}).prototype.exec=function(a){var b=this.x,c=this.y,d=this.w,e=this.h,f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l)},(c.PolyStar=function(a,b,c,d,e,f){this.x=a,this.y=b,this.radius=c,this.sides=d,this.pointSize=e,this.angle=f}).prototype.exec=function(a){var b=this.x,c=this.y,d=this.radius,e=(this.angle||0)/180*Math.PI,f=this.sides,g=1-(this.pointSize||0),h=Math.PI/f;a.moveTo(b+Math.cos(e)*d,c+Math.sin(e)*d);for(var i=0;f>i;i++)e+=h,1!=g&&a.lineTo(b+Math.cos(e)*d*g,c+Math.sin(e)*d*g),e+=h,a.lineTo(b+Math.cos(e)*d,c+Math.sin(e)*d);a.closePath()},a.beginCmd=new c.BeginPath,createjs.Graphics=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.EventDispatcher_constructor(),this.alpha=1,this.cacheCanvas=null,this.cacheID=0,this.id=createjs.UID.get(),this.mouseEnabled=!0,this.tickEnabled=!0,this.name=null,this.parent=null,this.regX=0,this.regY=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.shadow=null,this.visible=!0,this.x=0,this.y=0,this.transformMatrix=null,this.compositeOperation=null,this.snapToPixel=!0,this.filters=null,
this.mask=null,this.hitArea=null,this.cursor=null,this._cacheOffsetX=0,this._cacheOffsetY=0,this._filterOffsetX=0,this._filterOffsetY=0,this._cacheScale=1,this._cacheDataURLID=0,this._cacheDataURL=null,this._props=new createjs.DisplayProps,this._rectangle=new createjs.Rectangle,this._bounds=null}var b=createjs.extend(a,createjs.EventDispatcher);a._MOUSE_EVENTS=["click","dblclick","mousedown","mouseout","mouseover","pressmove","pressup","rollout","rollover"],a.suppressCrossDomainErrors=!1,a._snapToPixelEnabled=!1;var c=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");c.getContext&&(a._hitTestCanvas=c,a._hitTestContext=c.getContext("2d"),c.width=c.height=1),a._nextCacheID=1,b.getStage=function(){for(var a=this,b=createjs.Stage;a.parent;)a=a.parent;return a instanceof b?a:null};try{Object.defineProperties(b,{stage:{get:b.getStage}})}catch(d){}b.isVisible=function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)},b.draw=function(a,b){var c=this.cacheCanvas;if(b||!c)return!1;var d=this._cacheScale;return a.drawImage(c,this._cacheOffsetX+this._filterOffsetX,this._cacheOffsetY+this._filterOffsetY,c.width/d,c.height/d),!0},b.updateContext=function(b){var c=this,d=c.mask,e=c._props.matrix;d&&d.graphics&&!d.graphics.isEmpty()&&(d.getMatrix(e),b.transform(e.a,e.b,e.c,e.d,e.tx,e.ty),d.graphics.drawAsPath(b),b.clip(),e.invert(),b.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)),this.getMatrix(e);var f=e.tx,g=e.ty;a._snapToPixelEnabled&&c.snapToPixel&&(f=f+(0>f?-.5:.5)|0,g=g+(0>g?-.5:.5)|0),b.transform(e.a,e.b,e.c,e.d,f,g),b.globalAlpha*=c.alpha,c.compositeOperation&&(b.globalCompositeOperation=c.compositeOperation),c.shadow&&this._applyShadow(b,c.shadow)},b.cache=function(a,b,c,d,e){e=e||1,this.cacheCanvas||(this.cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),this._cacheWidth=c,this._cacheHeight=d,this._cacheOffsetX=a,this._cacheOffsetY=b,this._cacheScale=e,this.updateCache()},b.updateCache=function(b){var c=this.cacheCanvas;if(!c)throw"cache() must be called before updateCache()";var d=this._cacheScale,e=this._cacheOffsetX*d,f=this._cacheOffsetY*d,g=this._cacheWidth,h=this._cacheHeight,i=c.getContext("2d"),j=this._getFilterBounds();e+=this._filterOffsetX=j.x,f+=this._filterOffsetY=j.y,g=Math.ceil(g*d)+j.width,h=Math.ceil(h*d)+j.height,g!=c.width||h!=c.height?(c.width=g,c.height=h):b||i.clearRect(0,0,g+1,h+1),i.save(),i.globalCompositeOperation=b,i.setTransform(d,0,0,d,-e,-f),this.draw(i,!0),this._applyFilters(),i.restore(),this.cacheID=a._nextCacheID++},b.uncache=function(){this._cacheDataURL=this.cacheCanvas=null,this.cacheID=this._cacheOffsetX=this._cacheOffsetY=this._filterOffsetX=this._filterOffsetY=0,this._cacheScale=1},b.getCacheDataURL=function(){return this.cacheCanvas?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURL=this.cacheCanvas.toDataURL()),this._cacheDataURL):null},b.localToGlobal=function(a,b,c){return this.getConcatenatedMatrix(this._props.matrix).transformPoint(a,b,c||new createjs.Point)},b.globalToLocal=function(a,b,c){return this.getConcatenatedMatrix(this._props.matrix).invert().transformPoint(a,b,c||new createjs.Point)},b.localToLocal=function(a,b,c,d){return d=this.localToGlobal(a,b,d),c.globalToLocal(d.x,d.y,d)},b.setTransform=function(a,b,c,d,e,f,g,h,i){return this.x=a||0,this.y=b||0,this.scaleX=null==c?1:c,this.scaleY=null==d?1:d,this.rotation=e||0,this.skewX=f||0,this.skewY=g||0,this.regX=h||0,this.regY=i||0,this},b.getMatrix=function(a){var b=this,c=a&&a.identity()||new createjs.Matrix2D;return b.transformMatrix?c.copy(b.transformMatrix):c.appendTransform(b.x,b.y,b.scaleX,b.scaleY,b.rotation,b.skewX,b.skewY,b.regX,b.regY)},b.getConcatenatedMatrix=function(a){for(var b=this,c=this.getMatrix(a);b=b.parent;)c.prependMatrix(b.getMatrix(b._props.matrix));return c},b.getConcatenatedDisplayProps=function(a){a=a?a.identity():new createjs.DisplayProps;var b=this,c=b.getMatrix(a.matrix);do a.prepend(b.visible,b.alpha,b.shadow,b.compositeOperation),b!=this&&c.prependMatrix(b.getMatrix(b._props.matrix));while(b=b.parent);return a},b.hitTest=function(b,c){var d=a._hitTestContext;d.setTransform(1,0,0,1,-b,-c),this.draw(d);var e=this._testHit(d);return d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,2,2),e},b.set=function(a){for(var b in a)this[b]=a[b];return this},b.getBounds=function(){if(this._bounds)return this._rectangle.copy(this._bounds);var a=this.cacheCanvas;if(a){var b=this._cacheScale;return this._rectangle.setValues(this._cacheOffsetX,this._cacheOffsetY,a.width/b,a.height/b)}return null},b.getTransformedBounds=function(){return this._getBounds()},b.setBounds=function(a,b,c,d){null==a&&(this._bounds=a),this._bounds=(this._bounds||new createjs.Rectangle).setValues(a,b,c,d)},b.clone=function(){return this._cloneProps(new a)},b.toString=function(){return"[DisplayObject (name="+this.name+")]"},b._cloneProps=function(a){return a.alpha=this.alpha,a.mouseEnabled=this.mouseEnabled,a.tickEnabled=this.tickEnabled,a.name=this.name,a.regX=this.regX,a.regY=this.regY,a.rotation=this.rotation,a.scaleX=this.scaleX,a.scaleY=this.scaleY,a.shadow=this.shadow,a.skewX=this.skewX,a.skewY=this.skewY,a.visible=this.visible,a.x=this.x,a.y=this.y,a.compositeOperation=this.compositeOperation,a.snapToPixel=this.snapToPixel,a.filters=null==this.filters?null:this.filters.slice(0),a.mask=this.mask,a.hitArea=this.hitArea,a.cursor=this.cursor,a._bounds=this._bounds,a},b._applyShadow=function(a,b){b=b||Shadow.identity,a.shadowColor=b.color,a.shadowOffsetX=b.offsetX,a.shadowOffsetY=b.offsetY,a.shadowBlur=b.blur},b._tick=function(a){var b=this._listeners;b&&b.tick&&(a.target=null,a.propagationStopped=a.immediatePropagationStopped=!1,this.dispatchEvent(a))},b._testHit=function(b){try{var c=b.getImageData(0,0,1,1).data[3]>1}catch(d){if(!a.suppressCrossDomainErrors)throw"An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images."}return c},b._applyFilters=function(){if(this.filters&&0!=this.filters.length&&this.cacheCanvas)for(var a=this.filters.length,b=this.cacheCanvas.getContext("2d"),c=this.cacheCanvas.width,d=this.cacheCanvas.height,e=0;a>e;e++)this.filters[e].applyFilter(b,0,0,c,d)},b._getFilterBounds=function(a){var b,c=this.filters,d=this._rectangle.setValues(0,0,0,0);if(!c||!(b=c.length))return d;for(var e=0;b>e;e++){var f=this.filters[e];f.getBounds&&f.getBounds(d)}return d},b._getBounds=function(a,b){return this._transformBounds(this.getBounds(),a,b)},b._transformBounds=function(a,b,c){if(!a)return a;var d=a.x,e=a.y,f=a.width,g=a.height,h=this._props.matrix;h=c?h.identity():this.getMatrix(h),(d||e)&&h.appendTransform(0,0,1,1,0,0,0,-d,-e),b&&h.prependMatrix(b);var i=f*h.a,j=f*h.b,k=g*h.c,l=g*h.d,m=h.tx,n=h.ty,o=m,p=m,q=n,r=n;return(d=i+m)<o?o=d:d>p&&(p=d),(d=i+k+m)<o?o=d:d>p&&(p=d),(d=k+m)<o?o=d:d>p&&(p=d),(e=j+n)<q?q=e:e>r&&(r=e),(e=j+l+n)<q?q=e:e>r&&(r=e),(e=l+n)<q?q=e:e>r&&(r=e),a.setValues(o,q,p-o,r-q)},b._hasMouseEventListener=function(){for(var b=a._MOUSE_EVENTS,c=0,d=b.length;d>c;c++)if(this.hasEventListener(b[c]))return!0;return!!this.cursor},createjs.DisplayObject=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.DisplayObject_constructor(),this.children=[],this.mouseChildren=!0,this.tickChildren=!0}var b=createjs.extend(a,createjs.DisplayObject);b.getNumChildren=function(){return this.children.length};try{Object.defineProperties(b,{numChildren:{get:b.getNumChildren}})}catch(c){}b.initialize=a,b.isVisible=function(){var a=this.cacheCanvas||this.children.length;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&a)},b.draw=function(a,b){if(this.DisplayObject_draw(a,b))return!0;for(var c=this.children.slice(),d=0,e=c.length;e>d;d++){var f=c[d];f.isVisible()&&(a.save(),f.updateContext(a),f.draw(a),a.restore())}return!0},b.addChild=function(a){if(null==a)return a;var b=arguments.length;if(b>1){for(var c=0;b>c;c++)this.addChild(arguments[c]);return arguments[b-1]}return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.push(a),a.dispatchEvent("added"),a},b.addChildAt=function(a,b){var c=arguments.length,d=arguments[c-1];if(0>d||d>this.children.length)return arguments[c-2];if(c>2){for(var e=0;c-1>e;e++)this.addChildAt(arguments[e],d+e);return arguments[c-2]}return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),a.dispatchEvent("added"),a},b.removeChild=function(a){var b=arguments.length;if(b>1){for(var c=!0,d=0;b>d;d++)c=c&&this.removeChild(arguments[d]);return c}return this.removeChildAt(createjs.indexOf(this.children,a))},b.removeChildAt=function(a){var b=arguments.length;if(b>1){for(var c=[],d=0;b>d;d++)c[d]=arguments[d];c.sort(function(a,b){return b-a});for(var e=!0,d=0;b>d;d++)e=e&&this.removeChildAt(c[d]);return e}if(0>a||a>this.children.length-1)return!1;var f=this.children[a];return f&&(f.parent=null),this.children.splice(a,1),f.dispatchEvent("removed"),!0},b.removeAllChildren=function(){for(var a=this.children;a.length;)this.removeChildAt(0)},b.getChildAt=function(a){return this.children[a]},b.getChildByName=function(a){for(var b=this.children,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},b.sortChildren=function(a){this.children.sort(a)},b.getChildIndex=function(a){return createjs.indexOf(this.children,a)},b.swapChildrenAt=function(a,b){var c=this.children,d=c[a],e=c[b];d&&e&&(c[a]=e,c[b]=d)},b.swapChildren=function(a,b){for(var c,d,e=this.children,f=0,g=e.length;g>f&&(e[f]==a&&(c=f),e[f]==b&&(d=f),null==c||null==d);f++);f!=g&&(e[c]=b,e[d]=a)},b.setChildIndex=function(a,b){var c=this.children,d=c.length;if(!(a.parent!=this||0>b||b>=d)){for(var e=0;d>e&&c[e]!=a;e++);e!=d&&e!=b&&(c.splice(e,1),c.splice(b,0,a))}},b.contains=function(a){for(;a;){if(a==this)return!0;a=a.parent}return!1},b.hitTest=function(a,b){return null!=this.getObjectUnderPoint(a,b)},b.getObjectsUnderPoint=function(a,b,c){var d=[],e=this.localToGlobal(a,b);return this._getObjectsUnderPoint(e.x,e.y,d,c>0,1==c),d},b.getObjectUnderPoint=function(a,b,c){var d=this.localToGlobal(a,b);return this._getObjectsUnderPoint(d.x,d.y,null,c>0,1==c)},b.getBounds=function(){return this._getBounds(null,!0)},b.getTransformedBounds=function(){return this._getBounds()},b.clone=function(b){var c=this._cloneProps(new a);return b&&this._cloneChildren(c),c},b.toString=function(){return"[Container (name="+this.name+")]"},b._tick=function(a){if(this.tickChildren)for(var b=this.children.length-1;b>=0;b--){var c=this.children[b];c.tickEnabled&&c._tick&&c._tick(a)}this.DisplayObject__tick(a)},b._cloneChildren=function(a){a.children.length&&a.removeAllChildren();for(var b=a.children,c=0,d=this.children.length;d>c;c++){var e=this.children[c].clone(!0);e.parent=a,b.push(e)}},b._getObjectsUnderPoint=function(b,c,d,e,f,g){if(g=g||0,!g&&!this._testMask(this,b,c))return null;var h,i=createjs.DisplayObject._hitTestContext;f=f||e&&this._hasMouseEventListener();for(var j=this.children,k=j.length,l=k-1;l>=0;l--){var m=j[l],n=m.hitArea;if(m.visible&&(n||m.isVisible())&&(!e||m.mouseEnabled)&&(n||this._testMask(m,b,c)))if(!n&&m instanceof a){var o=m._getObjectsUnderPoint(b,c,d,e,f,g+1);if(!d&&o)return e&&!this.mouseChildren?this:o}else{if(e&&!f&&!m._hasMouseEventListener())continue;var p=m.getConcatenatedDisplayProps(m._props);if(h=p.matrix,n&&(h.appendMatrix(n.getMatrix(n._props.matrix)),p.alpha=n.alpha),i.globalAlpha=p.alpha,i.setTransform(h.a,h.b,h.c,h.d,h.tx-b,h.ty-c),(n||m).draw(i),!this._testHit(i))continue;if(i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,2,2),!d)return e&&!this.mouseChildren?this:m;d.push(m)}}return null},b._testMask=function(a,b,c){var d=a.mask;if(!d||!d.graphics||d.graphics.isEmpty())return!0;var e=this._props.matrix,f=a.parent;e=f?f.getConcatenatedMatrix(e):e.identity(),e=d.getMatrix(d._props.matrix).prependMatrix(e);var g=createjs.DisplayObject._hitTestContext;return g.setTransform(e.a,e.b,e.c,e.d,e.tx-b,e.ty-c),d.graphics.drawAsPath(g),g.fillStyle="#000",g.fill(),this._testHit(g)?(g.setTransform(1,0,0,1,0,0),g.clearRect(0,0,2,2),!0):!1},b._getBounds=function(a,b){var c=this.DisplayObject_getBounds();if(c)return this._transformBounds(c,a,b);var d=this._props.matrix;d=b?d.identity():this.getMatrix(d),a&&d.prependMatrix(a);for(var e=this.children.length,f=null,g=0;e>g;g++){var h=this.children[g];h.visible&&(c=h._getBounds(d))&&(f?f.extend(c.x,c.y,c.width,c.height):f=c.clone())}return f},createjs.Container=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.Container_constructor(),this.autoClear=!0,this.canvas="string"==typeof a?document.getElementById(a):a,this.mouseX=0,this.mouseY=0,this.drawRect=null,this.snapToPixelEnabled=!1,this.mouseInBounds=!1,this.tickOnUpdate=!0,this.mouseMoveOutside=!1,this.preventSelection=!0,this._pointerData={},this._pointerCount=0,this._primaryPointerID=null,this._mouseOverIntervalID=null,this._nextStage=null,this._prevStage=null,this.enableDOMEvents(!0)}var b=createjs.extend(a,createjs.Container);b._get_nextStage=function(){return this._nextStage},b._set_nextStage=function(a){this._nextStage&&(this._nextStage._prevStage=null),a&&(a._prevStage=this),this._nextStage=a};try{Object.defineProperties(b,{nextStage:{get:b._get_nextStage,set:b._set_nextStage}})}catch(c){}b.update=function(a){if(this.canvas&&(this.tickOnUpdate&&this.tick(a),this.dispatchEvent("drawstart",!1,!0)!==!1)){createjs.DisplayObject._snapToPixelEnabled=this.snapToPixelEnabled;var b=this.drawRect,c=this.canvas.getContext("2d");c.setTransform(1,0,0,1,0,0),this.autoClear&&(b?c.clearRect(b.x,b.y,b.width,b.height):c.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)),c.save(),this.drawRect&&(c.beginPath(),c.rect(b.x,b.y,b.width,b.height),c.clip()),this.updateContext(c),this.draw(c,!1),c.restore(),this.dispatchEvent("drawend")}},b.tick=function(a){if(this.tickEnabled&&this.dispatchEvent("tickstart",!1,!0)!==!1){var b=new createjs.Event("tick");if(a)for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);this._tick(b),this.dispatchEvent("tickend")}},b.handleEvent=function(a){"tick"==a.type&&this.update(a)},b.clear=function(){if(this.canvas){var a=this.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}},b.toDataURL=function(a,b){var c,d=this.canvas.getContext("2d"),e=this.canvas.width,f=this.canvas.height;if(a){c=d.getImageData(0,0,e,f);var g=d.globalCompositeOperation;d.globalCompositeOperation="destination-over",d.fillStyle=a,d.fillRect(0,0,e,f)}var h=this.canvas.toDataURL(b||"image/png");return a&&(d.putImageData(c,0,0),d.globalCompositeOperation=g),h},b.enableMouseOver=function(a){if(this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null,0==a&&this._testMouseOver(!0)),null==a)a=20;else if(0>=a)return;var b=this;this._mouseOverIntervalID=setInterval(function(){b._testMouseOver()},1e3/Math.min(50,a))},b.enableDOMEvents=function(a){null==a&&(a=!0);var b,c,d=this._eventListeners;if(!a&&d){for(b in d)c=d[b],c.t.removeEventListener(b,c.f,!1);this._eventListeners=null}else if(a&&!d&&this.canvas){var e=window.addEventListener?window:document,f=this;d=this._eventListeners={},d.mouseup={t:e,f:function(a){f._handleMouseUp(a)}},d.mousemove={t:e,f:function(a){f._handleMouseMove(a)}},d.dblclick={t:this.canvas,f:function(a){f._handleDoubleClick(a)}},d.mousedown={t:this.canvas,f:function(a){f._handleMouseDown(a)}};for(b in d)c=d[b],c.t.addEventListener(b,c.f,!1)}},b.clone=function(){throw"Stage cannot be cloned."},b.toString=function(){return"[Stage (name="+this.name+")]"},b._getElementRect=function(a){var b;try{b=a.getBoundingClientRect()}catch(c){b={top:a.offsetTop,left:a.offsetLeft,width:a.offsetWidth,height:a.offsetHeight}}var d=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0),e=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0),f=window.getComputedStyle?getComputedStyle(a,null):a.currentStyle,g=parseInt(f.paddingLeft)+parseInt(f.borderLeftWidth),h=parseInt(f.paddingTop)+parseInt(f.borderTopWidth),i=parseInt(f.paddingRight)+parseInt(f.borderRightWidth),j=parseInt(f.paddingBottom)+parseInt(f.borderBottomWidth);return{left:b.left+d+g,right:b.right+d-i,top:b.top+e+h,bottom:b.bottom+e-j}},b._getPointerData=function(a){var b=this._pointerData[a];return b||(b=this._pointerData[a]={x:0,y:0}),b},b._handleMouseMove=function(a){a||(a=window.event),this._handlePointerMove(-1,a,a.pageX,a.pageY)},b._handlePointerMove=function(a,b,c,d,e){if((!this._prevStage||void 0!==e)&&this.canvas){var f=this._nextStage,g=this._getPointerData(a),h=g.inBounds;this._updatePointerPosition(a,b,c,d),(h||g.inBounds||this.mouseMoveOutside)&&(-1===a&&g.inBounds==!h&&this._dispatchMouseEvent(this,h?"mouseleave":"mouseenter",!1,a,g,b),this._dispatchMouseEvent(this,"stagemousemove",!1,a,g,b),this._dispatchMouseEvent(g.target,"pressmove",!0,a,g,b)),f&&f._handlePointerMove(a,b,c,d,null)}},b._updatePointerPosition=function(a,b,c,d){var e=this._getElementRect(this.canvas);c-=e.left,d-=e.top;var f=this.canvas.width,g=this.canvas.height;c/=(e.right-e.left)/f,d/=(e.bottom-e.top)/g;var h=this._getPointerData(a);(h.inBounds=c>=0&&d>=0&&f-1>=c&&g-1>=d)?(h.x=c,h.y=d):this.mouseMoveOutside&&(h.x=0>c?0:c>f-1?f-1:c,h.y=0>d?0:d>g-1?g-1:d),h.posEvtObj=b,h.rawX=c,h.rawY=d,(a===this._primaryPointerID||-1===a)&&(this.mouseX=h.x,this.mouseY=h.y,this.mouseInBounds=h.inBounds)},b._handleMouseUp=function(a){this._handlePointerUp(-1,a,!1)},b._handlePointerUp=function(a,b,c,d){var e=this._nextStage,f=this._getPointerData(a);if(!this._prevStage||void 0!==d){var g=null,h=f.target;d||!h&&!e||(g=this._getObjectsUnderPoint(f.x,f.y,null,!0)),f.down&&(this._dispatchMouseEvent(this,"stagemouseup",!1,a,f,b,g),f.down=!1),g==h&&this._dispatchMouseEvent(h,"click",!0,a,f,b),this._dispatchMouseEvent(h,"pressup",!0,a,f,b),c?(a==this._primaryPointerID&&(this._primaryPointerID=null),delete this._pointerData[a]):f.target=null,e&&e._handlePointerUp(a,b,c,d||g&&this)}},b._handleMouseDown=function(a){this._handlePointerDown(-1,a,a.pageX,a.pageY)},b._handlePointerDown=function(a,b,c,d,e){this.preventSelection&&b.preventDefault(),(null==this._primaryPointerID||-1===a)&&(this._primaryPointerID=a),null!=d&&this._updatePointerPosition(a,b,c,d);var f=null,g=this._nextStage,h=this._getPointerData(a);e||(f=h.target=this._getObjectsUnderPoint(h.x,h.y,null,!0)),h.inBounds&&(this._dispatchMouseEvent(this,"stagemousedown",!1,a,h,b,f),h.down=!0),this._dispatchMouseEvent(f,"mousedown",!0,a,h,b),g&&g._handlePointerDown(a,b,c,d,e||f&&this)},b._testMouseOver=function(a,b,c){if(!this._prevStage||void 0!==b){var d=this._nextStage;if(!this._mouseOverIntervalID)return void(d&&d._testMouseOver(a,b,c));var e=this._getPointerData(-1);if(e&&(a||this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds)){var f,g,h,i=e.posEvtObj,j=c||i&&i.target==this.canvas,k=null,l=-1,m="";!b&&(a||this.mouseInBounds&&j)&&(k=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,!0),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY);var n=this._mouseOverTarget||[],o=n[n.length-1],p=this._mouseOverTarget=[];for(f=k;f;)p.unshift(f),m||(m=f.cursor),f=f.parent;for(this.canvas.style.cursor=m,!b&&c&&(c.canvas.style.cursor=m),g=0,h=p.length;h>g&&p[g]==n[g];g++)l=g;for(o!=k&&this._dispatchMouseEvent(o,"mouseout",!0,-1,e,i,k),g=n.length-1;g>l;g--)this._dispatchMouseEvent(n[g],"rollout",!1,-1,e,i,k);for(g=p.length-1;g>l;g--)this._dispatchMouseEvent(p[g],"rollover",!1,-1,e,i,o);o!=k&&this._dispatchMouseEvent(k,"mouseover",!0,-1,e,i,o),d&&d._testMouseOver(a,b||k&&this,c||j&&this)}}},b._handleDoubleClick=function(a,b){var c=null,d=this._nextStage,e=this._getPointerData(-1);b||(c=this._getObjectsUnderPoint(e.x,e.y,null,!0),this._dispatchMouseEvent(c,"dblclick",!0,-1,e,a)),d&&d._handleDoubleClick(a,b||c&&this)},b._dispatchMouseEvent=function(a,b,c,d,e,f,g){if(a&&(c||a.hasEventListener(b))){var h=new createjs.MouseEvent(b,c,!1,e.x,e.y,f,d,d===this._primaryPointerID||-1===d,e.rawX,e.rawY,g);a.dispatchEvent(h)}},createjs.Stage=createjs.promote(a,"Container")}(),this.createjs=this.createjs||{},function(){function a(a){this.DisplayObject_constructor(),"string"==typeof a?(this.image=document.createElement("img"),this.image.src=a):this.image=a,this.sourceRect=null}var b=createjs.extend(a,createjs.DisplayObject);b.initialize=a,b.isVisible=function(){var a=this.image,b=this.cacheCanvas||a&&(a.naturalWidth||a.getContext||a.readyState>=2);return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&b)},b.draw=function(a,b){if(this.DisplayObject_draw(a,b)||!this.image)return!0;var c=this.image,d=this.sourceRect;if(d){var e=d.x,f=d.y,g=e+d.width,h=f+d.height,i=0,j=0,k=c.width,l=c.height;0>e&&(i-=e,e=0),g>k&&(g=k),0>f&&(j-=f,f=0),h>l&&(h=l),a.drawImage(c,e,f,g-e,h-f,i,j,g-e,h-f)}else a.drawImage(c,0,0);return!0},b.getBounds=function(){var a=this.DisplayObject_getBounds();if(a)return a;var b=this.image,c=this.sourceRect||b,d=b&&(b.naturalWidth||b.getContext||b.readyState>=2);return d?this._rectangle.setValues(0,0,c.width,c.height):null},b.clone=function(){var b=new a(this.image);return this.sourceRect&&(b.sourceRect=this.sourceRect.clone()),this._cloneProps(b),b},b.toString=function(){return"[Bitmap (name="+this.name+")]"},createjs.Bitmap=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.DisplayObject_constructor(),this.currentFrame=0,this.currentAnimation=null,this.paused=!0,this.spriteSheet=a,this.currentAnimationFrame=0,this.framerate=0,this._animation=null,this._currentFrame=null,this._skipAdvance=!1,null!=b&&this.gotoAndPlay(b)}var b=createjs.extend(a,createjs.DisplayObject);b.initialize=a,b.isVisible=function(){var a=this.cacheCanvas||this.spriteSheet.complete;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&a)},b.draw=function(a,b){if(this.DisplayObject_draw(a,b))return!0;this._normalizeFrame();var c=this.spriteSheet.getFrame(0|this._currentFrame);if(!c)return!1;var d=c.rect;return d.width&&d.height&&a.drawImage(c.image,d.x,d.y,d.width,d.height,-c.regX,-c.regY,d.width,d.height),!0},b.play=function(){this.paused=!1},b.stop=function(){this.paused=!0},b.gotoAndPlay=function(a){this.paused=!1,this._skipAdvance=!0,this._goto(a)},b.gotoAndStop=function(a){this.paused=!0,this._goto(a)},b.advance=function(a){var b=this.framerate||this.spriteSheet.framerate,c=b&&null!=a?a/(1e3/b):1;this._normalizeFrame(c)},b.getBounds=function(){return this.DisplayObject_getBounds()||this.spriteSheet.getFrameBounds(this.currentFrame,this._rectangle)},b.clone=function(){return this._cloneProps(new a(this.spriteSheet))},b.toString=function(){return"[Sprite (name="+this.name+")]"},b._cloneProps=function(a){return this.DisplayObject__cloneProps(a),a.currentFrame=this.currentFrame,a.currentAnimation=this.currentAnimation,a.paused=this.paused,a.currentAnimationFrame=this.currentAnimationFrame,a.framerate=this.framerate,a._animation=this._animation,a._currentFrame=this._currentFrame,a._skipAdvance=this._skipAdvance,a},b._tick=function(a){this.paused||(this._skipAdvance||this.advance(a&&a.delta),this._skipAdvance=!1),this.DisplayObject__tick(a)},b._normalizeFrame=function(a){a=a||0;var b,c=this._animation,d=this.paused,e=this._currentFrame;if(c){var f=c.speed||1,g=this.currentAnimationFrame;if(b=c.frames.length,g+a*f>=b){var h=c.next;if(this._dispatchAnimationEnd(c,e,d,h,b-1))return;if(h)return this._goto(h,a-(b-g)/f);this.paused=!0,g=c.frames.length-1}else g+=a*f;this.currentAnimationFrame=g,this._currentFrame=c.frames[0|g]}else if(e=this._currentFrame+=a,b=this.spriteSheet.getNumFrames(),e>=b&&b>0&&!this._dispatchAnimationEnd(c,e,d,b-1)&&(this._currentFrame-=b)>=b)return this._normalizeFrame();e=0|this._currentFrame,this.currentFrame!=e&&(this.currentFrame=e,this.dispatchEvent("change"))},b._dispatchAnimationEnd=function(a,b,c,d,e){var f=a?a.name:null;if(this.hasEventListener("animationend")){var g=new createjs.Event("animationend");g.name=f,g.next=d,this.dispatchEvent(g)}var h=this._animation!=a||this._currentFrame!=b;return h||c||!this.paused||(this.currentAnimationFrame=e,h=!0),h},b._goto=function(a,b){if(this.currentAnimationFrame=0,isNaN(a)){var c=this.spriteSheet.getAnimation(a);c&&(this._animation=c,this.currentAnimation=a,this._normalizeFrame(b))}else this.currentAnimation=this._animation=null,this._currentFrame=a,this._normalizeFrame()},createjs.Sprite=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.DisplayObject_constructor(),this.graphics=a?a:new createjs.Graphics}var b=createjs.extend(a,createjs.DisplayObject);b.isVisible=function(){var a=this.cacheCanvas||this.graphics&&!this.graphics.isEmpty();return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&a)},b.draw=function(a,b){return this.DisplayObject_draw(a,b)?!0:(this.graphics.draw(a,this),!0)},b.clone=function(b){var c=b&&this.graphics?this.graphics.clone():this.graphics;return this._cloneProps(new a(c))},b.toString=function(){return"[Shape (name="+this.name+")]"},createjs.Shape=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.DisplayObject_constructor(),this.text=a,this.font=b,this.color=c,this.textAlign="left",this.textBaseline="top",this.maxWidth=null,this.outline=0,this.lineHeight=0,this.lineWidth=null}var b=createjs.extend(a,createjs.DisplayObject),c=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");c.getContext&&(a._workingContext=c.getContext("2d"),c.width=c.height=1),a.H_OFFSETS={start:0,left:0,center:-.5,end:-1,right:-1},a.V_OFFSETS={top:0,hanging:-.01,middle:-.4,alphabetic:-.8,ideographic:-.85,bottom:-1},b.isVisible=function(){var a=this.cacheCanvas||null!=this.text&&""!==this.text;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&a)},b.draw=function(a,b){if(this.DisplayObject_draw(a,b))return!0;var c=this.color||"#000";return this.outline?(a.strokeStyle=c,a.lineWidth=1*this.outline):a.fillStyle=c,this._drawText(this._prepContext(a)),!0},b.getMeasuredWidth=function(){return this._getMeasuredWidth(this.text)},b.getMeasuredLineHeight=function(){return 1.2*this._getMeasuredWidth("M")},b.getMeasuredHeight=function(){return this._drawText(null,{}).height},b.getBounds=function(){var b=this.DisplayObject_getBounds();if(b)return b;if(null==this.text||""===this.text)return null;var c=this._drawText(null,{}),d=this.maxWidth&&this.maxWidth<c.width?this.maxWidth:c.width,e=d*a.H_OFFSETS[this.textAlign||"left"],f=this.lineHeight||this.getMeasuredLineHeight(),g=f*a.V_OFFSETS[this.textBaseline||"top"];return this._rectangle.setValues(e,g,d,c.height)},b.getMetrics=function(){var b={lines:[]};return b.lineHeight=this.lineHeight||this.getMeasuredLineHeight(),b.vOffset=b.lineHeight*a.V_OFFSETS[this.textBaseline||"top"],this._drawText(null,b,b.lines)},b.clone=function(){return this._cloneProps(new a(this.text,this.font,this.color))},b.toString=function(){return"[Text (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"},b._cloneProps=function(a){return this.DisplayObject__cloneProps(a),a.textAlign=this.textAlign,a.textBaseline=this.textBaseline,a.maxWidth=this.maxWidth,a.outline=this.outline,a.lineHeight=this.lineHeight,a.lineWidth=this.lineWidth,a},b._prepContext=function(a){return a.font=this.font||"10px sans-serif",a.textAlign=this.textAlign||"left",a.textBaseline=this.textBaseline||"top",a},b._drawText=function(b,c,d){var e=!!b;e||(b=a._workingContext,b.save(),this._prepContext(b));for(var f=this.lineHeight||this.getMeasuredLineHeight(),g=0,h=0,i=String(this.text).split(/(?:\r\n|\r|\n)/),j=0,k=i.length;k>j;j++){var l=i[j],m=null;if(null!=this.lineWidth&&(m=b.measureText(l).width)>this.lineWidth){var n=l.split(/(\s)/);l=n[0],m=b.measureText(l).width;for(var o=1,p=n.length;p>o;o+=2){var q=b.measureText(n[o]+n[o+1]).width;m+q>this.lineWidth?(e&&this._drawTextLine(b,l,h*f),d&&d.push(l),m>g&&(g=m),l=n[o+1],m=b.measureText(l).width,h++):(l+=n[o]+n[o+1],m+=q)}}e&&this._drawTextLine(b,l,h*f),d&&d.push(l),c&&null==m&&(m=b.measureText(l).width),m>g&&(g=m),h++}return c&&(c.width=g,c.height=h*f),e||b.restore(),c},b._drawTextLine=function(a,b,c){this.outline?a.strokeText(b,0,c,this.maxWidth||65535):a.fillText(b,0,c,this.maxWidth||65535)},b._getMeasuredWidth=function(b){var c=a._workingContext;c.save();var d=this._prepContext(c).measureText(b).width;return c.restore(),d},createjs.Text=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.Container_constructor(),this.text=a||"",this.spriteSheet=b,this.lineHeight=0,this.letterSpacing=0,this.spaceWidth=0,this._oldProps={text:0,spriteSheet:0,lineHeight:0,letterSpacing:0,spaceWidth:0}}var b=createjs.extend(a,createjs.Container);a.maxPoolSize=100,a._spritePool=[],b.draw=function(a,b){this.DisplayObject_draw(a,b)||(this._updateText(),this.Container_draw(a,b))},b.getBounds=function(){return this._updateText(),this.Container_getBounds()},b.isVisible=function(){var a=this.cacheCanvas||this.spriteSheet&&this.spriteSheet.complete&&this.text;return!!(this.visible&&this.alpha>0&&0!==this.scaleX&&0!==this.scaleY&&a)},b.clone=function(){return this._cloneProps(new a(this.text,this.spriteSheet))},b.addChild=b.addChildAt=b.removeChild=b.removeChildAt=b.removeAllChildren=function(){},b._cloneProps=function(a){return this.Container__cloneProps(a),a.lineHeight=this.lineHeight,a.letterSpacing=this.letterSpacing,a.spaceWidth=this.spaceWidth,a},b._getFrameIndex=function(a,b){var c,d=b.getAnimation(a);return d||(a!=(c=a.toUpperCase())||a!=(c=a.toLowerCase())||(c=null),c&&(d=b.getAnimation(c))),d&&d.frames[0]},b._getFrame=function(a,b){var c=this._getFrameIndex(a,b);return null==c?c:b.getFrame(c)},b._getLineHeight=function(a){var b=this._getFrame("1",a)||this._getFrame("T",a)||this._getFrame("L",a)||a.getFrame(0);return b?b.rect.height:1},b._getSpaceWidth=function(a){var b=this._getFrame("1",a)||this._getFrame("l",a)||this._getFrame("e",a)||this._getFrame("a",a)||a.getFrame(0);return b?b.rect.width:1},b._updateText=function(){var b,c=0,d=0,e=this._oldProps,f=!1,g=this.spaceWidth,h=this.lineHeight,i=this.spriteSheet,j=a._spritePool,k=this.children,l=0,m=k.length;for(var n in e)e[n]!=this[n]&&(e[n]=this[n],f=!0);if(f){var o=!!this._getFrame(" ",i);o||g||(g=this._getSpaceWidth(i)),h||(h=this._getLineHeight(i));for(var p=0,q=this.text.length;q>p;p++){var r=this.text.charAt(p);if(" "!=r||o)if("\n"!=r&&"\r"!=r){var s=this._getFrameIndex(r,i);null!=s&&(m>l?b=k[l]:(k.push(b=j.length?j.pop():new createjs.Sprite),b.parent=this,m++),b.spriteSheet=i,b.gotoAndStop(s),b.x=c,b.y=d,l++,c+=b.getBounds().width+this.letterSpacing)}else"\r"==r&&"\n"==this.text.charAt(p+1)&&p++,c=0,d+=h;else c+=g}for(;m>l;)j.push(b=k.pop()),b.parent=null,m--;j.length>a.maxPoolSize&&(j.length=a.maxPoolSize)}},createjs.BitmapText=createjs.promote(a,"Container")}(),this.createjs=this.createjs||{},function(){"use strict";function a(b,c,d,e){this.Container_constructor(),!a.inited&&a.init(),this.mode=b||a.INDEPENDENT,this.startPosition=c||0,this.loop=d,this.currentFrame=0,this.timeline=new createjs.Timeline(null,e,{paused:!0,position:c,useTicks:!0}),this.paused=!1,this.actionsEnabled=!0,this.autoReset=!0,this.frameBounds=this.frameBounds||null,this.framerate=null,this._synchOffset=0,this._prevPos=-1,this._prevPosition=0,this._t=0,this._managed={}}function b(){throw"MovieClipPlugin cannot be instantiated."}var c=createjs.extend(a,createjs.Container);a.INDEPENDENT="independent",a.SINGLE_FRAME="single",a.SYNCHED="synched",a.inited=!1,a.init=function(){a.inited||(b.install(),a.inited=!0)},c.getLabels=function(){return this.timeline.getLabels()},c.getCurrentLabel=function(){return this._updateTimeline(),this.timeline.getCurrentLabel()},c.getDuration=function(){return this.timeline.duration;
};try{Object.defineProperties(c,{labels:{get:c.getLabels},currentLabel:{get:c.getCurrentLabel},totalFrames:{get:c.getDuration},duration:{get:c.getDuration}})}catch(d){}c.initialize=a,c.isVisible=function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)},c.draw=function(a,b){return this.DisplayObject_draw(a,b)?!0:(this._updateTimeline(),this.Container_draw(a,b),!0)},c.play=function(){this.paused=!1},c.stop=function(){this.paused=!0},c.gotoAndPlay=function(a){this.paused=!1,this._goto(a)},c.gotoAndStop=function(a){this.paused=!0,this._goto(a)},c.advance=function(b){var c=a.INDEPENDENT;if(this.mode==c){for(var d=this,e=d.framerate;(d=d.parent)&&null==e;)d.mode==c&&(e=d._framerate);this._framerate=e;var f=null!=e&&-1!=e&&null!=b?b/(1e3/e)+this._t:1,g=0|f;for(this._t=f-g;!this.paused&&g--;)this._prevPosition=this._prevPos<0?0:this._prevPosition+1,this._updateTimeline()}},c.clone=function(){throw"MovieClip cannot be cloned."},c.toString=function(){return"[MovieClip (name="+this.name+")]"},c._tick=function(a){this.advance(a&&a.delta),this.Container__tick(a)},c._goto=function(a){var b=this.timeline.resolve(a);null!=b&&(-1==this._prevPos&&(this._prevPos=NaN),this._prevPosition=b,this._t=0,this._updateTimeline())},c._reset=function(){this._prevPos=-1,this._t=this.currentFrame=0,this.paused=!1},c._updateTimeline=function(){var b=this.timeline,c=this.mode!=a.INDEPENDENT;b.loop=null==this.loop?!0:this.loop;var d=c?this.startPosition+(this.mode==a.SINGLE_FRAME?0:this._synchOffset):this._prevPos<0?0:this._prevPosition,e=c||!this.actionsEnabled?createjs.Tween.NONE:null;if(this.currentFrame=b._calcPosition(d),b.setPosition(d,e),this._prevPosition=b._prevPosition,this._prevPos!=b._prevPos){this.currentFrame=this._prevPos=b._prevPos;for(var f in this._managed)this._managed[f]=1;for(var g=b._tweens,h=0,i=g.length;i>h;h++){var j=g[h],k=j._target;if(k!=this&&!j.passive){var l=j._stepPosition;k instanceof createjs.DisplayObject?this._addManagedChild(k,l):this._setState(k.state,l)}}var m=this.children;for(h=m.length-1;h>=0;h--){var n=m[h].id;1==this._managed[n]&&(this.removeChildAt(h),delete this._managed[n])}}},c._setState=function(a,b){if(a)for(var c=a.length-1;c>=0;c--){var d=a[c],e=d.t,f=d.p;for(var g in f)e[g]=f[g];this._addManagedChild(e,b)}},c._addManagedChild=function(b,c){b._off||(this.addChildAt(b,0),b instanceof a&&(b._synchOffset=c,b.mode==a.INDEPENDENT&&b.autoReset&&!this._managed[b.id]&&b._reset()),this._managed[b.id]=2)},c._getBounds=function(a,b){var c=this.DisplayObject_getBounds();return c||(this._updateTimeline(),this.frameBounds&&(c=this._rectangle.copy(this.frameBounds[this.currentFrame]))),c?this._transformBounds(c,a,b):this.Container__getBounds(a,b)},createjs.MovieClip=createjs.promote(a,"Container"),b.priority=100,b.install=function(){createjs.Tween.installPlugin(b,["startPosition"])},b.init=function(a,b,c){return c},b.step=function(){},b.tween=function(b,c,d,e,f,g,h,i){return b.target instanceof a?1==g?f[c]:e[c]:d}}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"SpriteSheetUtils cannot be instantiated"}var b=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");b.getContext&&(a._workingCanvas=b,a._workingContext=b.getContext("2d"),b.width=b.height=1),a.addFlippedFrames=function(b,c,d,e){if(c||d||e){var f=0;c&&a._flip(b,++f,!0,!1),d&&a._flip(b,++f,!1,!0),e&&a._flip(b,++f,!0,!0)}},a.extractFrame=function(b,c){isNaN(c)&&(c=b.getAnimation(c).frames[0]);var d=b.getFrame(c);if(!d)return null;var e=d.rect,f=a._workingCanvas;f.width=e.width,f.height=e.height,a._workingContext.drawImage(d.image,e.x,e.y,e.width,e.height,0,0,e.width,e.height);var g=document.createElement("img");return g.src=f.toDataURL("image/png"),g},a.mergeAlpha=function(a,b,c){c||(c=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),c.width=Math.max(b.width,a.width),c.height=Math.max(b.height,a.height);var d=c.getContext("2d");return d.save(),d.drawImage(a,0,0),d.globalCompositeOperation="destination-in",d.drawImage(b,0,0),d.restore(),c},a._flip=function(b,c,d,e){for(var f=b._images,g=a._workingCanvas,h=a._workingContext,i=f.length/c,j=0;i>j;j++){var k=f[j];k.__tmp=j,h.setTransform(1,0,0,1,0,0),h.clearRect(0,0,g.width+1,g.height+1),g.width=k.width,g.height=k.height,h.setTransform(d?-1:1,0,0,e?-1:1,d?k.width:0,e?k.height:0),h.drawImage(k,0,0);var l=document.createElement("img");l.src=g.toDataURL("image/png"),l.width=k.width,l.height=k.height,f.push(l)}var m=b._frames,n=m.length/c;for(j=0;n>j;j++){k=m[j];var o=k.rect.clone();l=f[k.image.__tmp+i*c];var p={image:l,rect:o,regX:k.regX,regY:k.regY};d&&(o.x=l.width-o.x-o.width,p.regX=o.width-k.regX),e&&(o.y=l.height-o.y-o.height,p.regY=o.height-k.regY),m.push(p)}var q="_"+(d?"h":"")+(e?"v":""),r=b._animations,s=b._data,t=r.length/c;for(j=0;t>j;j++){var u=r[j];k=s[u];var v={name:u+q,speed:k.speed,next:k.next,frames:[]};k.next&&(v.next+=q),m=k.frames;for(var w=0,x=m.length;x>w;w++)v.frames.push(m[w]+n*c);s[v.name]=v,r.push(v.name)}},createjs.SpriteSheetUtils=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.EventDispatcher_constructor(),this.maxWidth=2048,this.maxHeight=2048,this.spriteSheet=null,this.scale=1,this.padding=1,this.timeSlice=.3,this.progress=-1,this.framerate=a||0,this._frames=[],this._animations={},this._data=null,this._nextFrameIndex=0,this._index=0,this._timerID=null,this._scale=1}var b=createjs.extend(a,createjs.EventDispatcher);a.ERR_DIMENSIONS="frame dimensions exceed max spritesheet dimensions",a.ERR_RUNNING="a build is already running",b.addFrame=function(b,c,d,e,f){if(this._data)throw a.ERR_RUNNING;var g=c||b.bounds||b.nominalBounds;return!g&&b.getBounds&&(g=b.getBounds()),g?(d=d||1,this._frames.push({source:b,sourceRect:g,scale:d,funct:e,data:f,index:this._frames.length,height:g.height*d})-1):null},b.addAnimation=function(b,c,d,e){if(this._data)throw a.ERR_RUNNING;this._animations[b]={frames:c,next:d,speed:e}},b.addMovieClip=function(b,c,d,e,f,g){if(this._data)throw a.ERR_RUNNING;var h=b.frameBounds,i=c||b.bounds||b.nominalBounds;if(!i&&b.getBounds&&(i=b.getBounds()),i||h){var j,k,l=this._frames.length,m=b.timeline.duration;for(j=0;m>j;j++){var n=h&&h[j]?h[j]:i;this.addFrame(b,n,d,this._setupMovieClipFrame,{i:j,f:e,d:f})}var o=b.timeline._labels,p=[];for(var q in o)p.push({index:o[q],label:q});if(p.length)for(p.sort(function(a,b){return a.index-b.index}),j=0,k=p.length;k>j;j++){for(var r=p[j].label,s=l+p[j].index,t=l+(j==k-1?m:p[j+1].index),u=[],v=s;t>v;v++)u.push(v);(!g||(r=g(r,b,s,t)))&&this.addAnimation(r,u,!0)}}},b.build=function(){if(this._data)throw a.ERR_RUNNING;for(this._startBuild();this._drawNext(););return this._endBuild(),this.spriteSheet},b.buildAsync=function(b){if(this._data)throw a.ERR_RUNNING;this.timeSlice=b,this._startBuild();var c=this;this._timerID=setTimeout(function(){c._run()},50-50*Math.max(.01,Math.min(.99,this.timeSlice||.3)))},b.stopAsync=function(){clearTimeout(this._timerID),this._data=null},b.clone=function(){throw"SpriteSheetBuilder cannot be cloned."},b.toString=function(){return"[SpriteSheetBuilder]"},b._startBuild=function(){var b=this.padding||0;this.progress=0,this.spriteSheet=null,this._index=0,this._scale=this.scale;var c=[];this._data={images:[],frames:c,framerate:this.framerate,animations:this._animations};var d=this._frames.slice();if(d.sort(function(a,b){return a.height<=b.height?-1:1}),d[d.length-1].height+2*b>this.maxHeight)throw a.ERR_DIMENSIONS;for(var e=0,f=0,g=0;d.length;){var h=this._fillRow(d,e,g,c,b);if(h.w>f&&(f=h.w),e+=h.h,!h.h||!d.length){var i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");i.width=this._getSize(f,this.maxWidth),i.height=this._getSize(e,this.maxHeight),this._data.images[g]=i,h.h||(f=e=0,g++)}}},b._setupMovieClipFrame=function(a,b){var c=a.actionsEnabled;a.actionsEnabled=!1,a.gotoAndStop(b.i),a.actionsEnabled=c,b.f&&b.f(a,b.d,b.i)},b._getSize=function(a,b){for(var c=4;Math.pow(2,++c)<a;);return Math.min(b,Math.pow(2,c))},b._fillRow=function(b,c,d,e,f){var g=this.maxWidth,h=this.maxHeight;c+=f;for(var i=h-c,j=f,k=0,l=b.length-1;l>=0;l--){var m=b[l],n=this._scale*m.scale,o=m.sourceRect,p=m.source,q=Math.floor(n*o.x-f),r=Math.floor(n*o.y-f),s=Math.ceil(n*o.height+2*f),t=Math.ceil(n*o.width+2*f);if(t>g)throw a.ERR_DIMENSIONS;s>i||j+t>g||(m.img=d,m.rect=new createjs.Rectangle(j,c,t,s),k=k||s,b.splice(l,1),e[m.index]=[j,c,t,s,d,Math.round(-q+n*p.regX-f),Math.round(-r+n*p.regY-f)],j+=t)}return{w:j,h:k}},b._endBuild=function(){this.spriteSheet=new createjs.SpriteSheet(this._data),this._data=null,this.progress=1,this.dispatchEvent("complete")},b._run=function(){for(var a=50*Math.max(.01,Math.min(.99,this.timeSlice||.3)),b=(new Date).getTime()+a,c=!1;b>(new Date).getTime();)if(!this._drawNext()){c=!0;break}if(c)this._endBuild();else{var d=this;this._timerID=setTimeout(function(){d._run()},50-a)}var e=this.progress=this._index/this._frames.length;if(this.hasEventListener("progress")){var f=new createjs.Event("progress");f.progress=e,this.dispatchEvent(f)}},b._drawNext=function(){var a=this._frames[this._index],b=a.scale*this._scale,c=a.rect,d=a.sourceRect,e=this._data.images[a.img],f=e.getContext("2d");return a.funct&&a.funct(a.source,a.data),f.save(),f.beginPath(),f.rect(c.x,c.y,c.width,c.height),f.clip(),f.translate(Math.ceil(c.x-d.x*b),Math.ceil(c.y-d.y*b)),f.scale(b,b),a.source.draw(f),f.restore(),++this._index<this._frames.length},createjs.SpriteSheetBuilder=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.DisplayObject_constructor(),"string"==typeof a&&(a=document.getElementById(a)),this.mouseEnabled=!1;var b=a.style;b.position="absolute",b.transformOrigin=b.WebkitTransformOrigin=b.msTransformOrigin=b.MozTransformOrigin=b.OTransformOrigin="0% 0%",this.htmlElement=a,this._oldProps=null}var b=createjs.extend(a,createjs.DisplayObject);b.isVisible=function(){return null!=this.htmlElement},b.draw=function(a,b){return!0},b.cache=function(){},b.uncache=function(){},b.updateCache=function(){},b.hitTest=function(){},b.localToGlobal=function(){},b.globalToLocal=function(){},b.localToLocal=function(){},b.clone=function(){throw"DOMElement cannot be cloned."},b.toString=function(){return"[DOMElement (name="+this.name+")]"},b._tick=function(a){var b=this.getStage();b&&b.on("drawend",this._handleDrawEnd,this,!0),this.DisplayObject__tick(a)},b._handleDrawEnd=function(a){var b=this.htmlElement;if(b){var c=b.style,d=this.getConcatenatedDisplayProps(this._props),e=d.matrix,f=d.visible?"visible":"hidden";if(f!=c.visibility&&(c.visibility=f),d.visible){var g=this._oldProps,h=g&&g.matrix,i=1e4;if(!h||!h.equals(e)){var j="matrix("+(e.a*i|0)/i+","+(e.b*i|0)/i+","+(e.c*i|0)/i+","+(e.d*i|0)/i+","+(e.tx+.5|0);c.transform=c.WebkitTransform=c.OTransform=c.msTransform=j+","+(e.ty+.5|0)+")",c.MozTransform=j+"px,"+(e.ty+.5|0)+"px)",g||(g=this._oldProps=new createjs.DisplayProps(!0,NaN)),g.matrix.copy(e)}g.alpha!=d.alpha&&(c.opacity=""+(d.alpha*i|0)/i,g.alpha=d.alpha)}}},createjs.DOMElement=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){}var b=a.prototype;b.getBounds=function(a){return a},b.applyFilter=function(a,b,c,d,e,f,g,h){f=f||a,null==g&&(g=b),null==h&&(h=c);try{var i=a.getImageData(b,c,d,e)}catch(j){return!1}return this._applyFilter(i)?(f.putImageData(i,g,h),!0):!1},b.toString=function(){return"[Filter]"},b.clone=function(){return new a},b._applyFilter=function(a){return!0},createjs.Filter=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){(isNaN(a)||0>a)&&(a=0),(isNaN(b)||0>b)&&(b=0),(isNaN(c)||1>c)&&(c=1),this.blurX=0|a,this.blurY=0|b,this.quality=0|c}var b=createjs.extend(a,createjs.Filter);a.MUL_TABLE=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1],a.SHG_TABLE=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9],b.getBounds=function(a){var b=0|this.blurX,c=0|this.blurY;if(0>=b&&0>=c)return a;var d=Math.pow(this.quality,.2);return(a||new createjs.Rectangle).pad(b*d+1,c*d+1,b*d+1,c*d+1)},b.clone=function(){return new a(this.blurX,this.blurY,this.quality)},b.toString=function(){return"[BlurFilter]"},b._applyFilter=function(b){var c=this.blurX>>1;if(isNaN(c)||0>c)return!1;var d=this.blurY>>1;if(isNaN(d)||0>d)return!1;if(0==c&&0==d)return!1;var e=this.quality;(isNaN(e)||1>e)&&(e=1),e|=0,e>3&&(e=3),1>e&&(e=1);var f=b.data,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=c+c+1|0,w=d+d+1|0,x=0|b.width,y=0|b.height,z=x-1|0,A=y-1|0,B=c+1|0,C=d+1|0,D={r:0,b:0,g:0,a:0},E=D;for(i=1;v>i;i++)E=E.n={r:0,b:0,g:0,a:0};E.n=D;var F={r:0,b:0,g:0,a:0},G=F;for(i=1;w>i;i++)G=G.n={r:0,b:0,g:0,a:0};G.n=F;for(var H=null,I=0|a.MUL_TABLE[c],J=0|a.SHG_TABLE[c],K=0|a.MUL_TABLE[d],L=0|a.SHG_TABLE[d];e-->0;){m=l=0;var M=I,N=J;for(h=y;--h>-1;){for(n=B*(r=f[0|l]),o=B*(s=f[l+1|0]),p=B*(t=f[l+2|0]),q=B*(u=f[l+3|0]),E=D,i=B;--i>-1;)E.r=r,E.g=s,E.b=t,E.a=u,E=E.n;for(i=1;B>i;i++)j=l+((i>z?z:i)<<2)|0,n+=E.r=f[j],o+=E.g=f[j+1],p+=E.b=f[j+2],q+=E.a=f[j+3],E=E.n;for(H=D,g=0;x>g;g++)f[l++]=n*M>>>N,f[l++]=o*M>>>N,f[l++]=p*M>>>N,f[l++]=q*M>>>N,j=m+((j=g+c+1)<z?j:z)<<2,n-=H.r-(H.r=f[j]),o-=H.g-(H.g=f[j+1]),p-=H.b-(H.b=f[j+2]),q-=H.a-(H.a=f[j+3]),H=H.n;m+=x}for(M=K,N=L,g=0;x>g;g++){for(l=g<<2|0,n=C*(r=f[l])|0,o=C*(s=f[l+1|0])|0,p=C*(t=f[l+2|0])|0,q=C*(u=f[l+3|0])|0,G=F,i=0;C>i;i++)G.r=r,G.g=s,G.b=t,G.a=u,G=G.n;for(k=x,i=1;d>=i;i++)l=k+g<<2,n+=G.r=f[l],o+=G.g=f[l+1],p+=G.b=f[l+2],q+=G.a=f[l+3],G=G.n,A>i&&(k+=x);if(l=g,H=F,e>0)for(h=0;y>h;h++)j=l<<2,f[j+3]=u=q*M>>>N,u>0?(f[j]=n*M>>>N,f[j+1]=o*M>>>N,f[j+2]=p*M>>>N):f[j]=f[j+1]=f[j+2]=0,j=g+((j=h+C)<A?j:A)*x<<2,n-=H.r-(H.r=f[j]),o-=H.g-(H.g=f[j+1]),p-=H.b-(H.b=f[j+2]),q-=H.a-(H.a=f[j+3]),H=H.n,l+=x;else for(h=0;y>h;h++)j=l<<2,f[j+3]=u=q*M>>>N,u>0?(u=255/u,f[j]=(n*M>>>N)*u,f[j+1]=(o*M>>>N)*u,f[j+2]=(p*M>>>N)*u):f[j]=f[j+1]=f[j+2]=0,j=g+((j=h+C)<A?j:A)*x<<2,n-=H.r-(H.r=f[j]),o-=H.g-(H.g=f[j+1]),p-=H.b-(H.b=f[j+2]),q-=H.a-(H.a=f[j+3]),H=H.n,l+=x}}return!0},createjs.BlurFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.alphaMap=a,this._alphaMap=null,this._mapData=null}var b=createjs.extend(a,createjs.Filter);b.clone=function(){var b=new a(this.alphaMap);return b._alphaMap=this._alphaMap,b._mapData=this._mapData,b},b.toString=function(){return"[AlphaMapFilter]"},b._applyFilter=function(a){if(!this.alphaMap)return!0;if(!this._prepAlphaMap())return!1;for(var b=a.data,c=this._mapData,d=0,e=b.length;e>d;d+=4)b[d+3]=c[d]||0;return!0},b._prepAlphaMap=function(){if(!this.alphaMap)return!1;if(this.alphaMap==this._alphaMap&&this._mapData)return!0;this._mapData=null;var a,b=this._alphaMap=this.alphaMap,c=b;b instanceof HTMLCanvasElement?a=c.getContext("2d"):(c=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),c.width=b.width,c.height=b.height,a=c.getContext("2d"),a.drawImage(b,0,0));try{var d=a.getImageData(0,0,b.width,b.height)}catch(e){return!1}return this._mapData=d.data,!0},createjs.AlphaMapFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.mask=a}var b=createjs.extend(a,createjs.Filter);b.applyFilter=function(a,b,c,d,e,f,g,h){return this.mask?(f=f||a,null==g&&(g=b),null==h&&(h=c),f.save(),a!=f?!1:(f.globalCompositeOperation="destination-in",f.drawImage(this.mask,g,h),f.restore(),!0)):!0},b.clone=function(){return new a(this.mask)},b.toString=function(){return"[AlphaMaskFilter]"},createjs.AlphaMaskFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d,e,f,g,h){this.redMultiplier=null!=a?a:1,this.greenMultiplier=null!=b?b:1,this.blueMultiplier=null!=c?c:1,this.alphaMultiplier=null!=d?d:1,this.redOffset=e||0,this.greenOffset=f||0,this.blueOffset=g||0,this.alphaOffset=h||0}var b=createjs.extend(a,createjs.Filter);b.toString=function(){return"[ColorFilter]"},b.clone=function(){return new a(this.redMultiplier,this.greenMultiplier,this.blueMultiplier,this.alphaMultiplier,this.redOffset,this.greenOffset,this.blueOffset,this.alphaOffset)},b._applyFilter=function(a){for(var b=a.data,c=b.length,d=0;c>d;d+=4)b[d]=b[d]*this.redMultiplier+this.redOffset,b[d+1]=b[d+1]*this.greenMultiplier+this.greenOffset,b[d+2]=b[d+2]*this.blueMultiplier+this.blueOffset,b[d+3]=b[d+3]*this.alphaMultiplier+this.alphaOffset;return!0},createjs.ColorFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d){this.setColor(a,b,c,d)}var b=a.prototype;a.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],a.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],a.LENGTH=a.IDENTITY_MATRIX.length,b.setColor=function(a,b,c,d){return this.reset().adjustColor(a,b,c,d)},b.reset=function(){return this.copy(a.IDENTITY_MATRIX)},b.adjustColor=function(a,b,c,d){return this.adjustHue(d),this.adjustContrast(b),this.adjustBrightness(a),this.adjustSaturation(c)},b.adjustBrightness=function(a){return 0==a||isNaN(a)?this:(a=this._cleanValue(a,255),this._multiplyMatrix([1,0,0,0,a,0,1,0,0,a,0,0,1,0,a,0,0,0,1,0,0,0,0,0,1]),this)},b.adjustContrast=function(b){if(0==b||isNaN(b))return this;b=this._cleanValue(b,100);var c;return 0>b?c=127+b/100*127:(c=b%1,c=0==c?a.DELTA_INDEX[b]:a.DELTA_INDEX[b<<0]*(1-c)+a.DELTA_INDEX[(b<<0)+1]*c,c=127*c+127),this._multiplyMatrix([c/127,0,0,0,.5*(127-c),0,c/127,0,0,.5*(127-c),0,0,c/127,0,.5*(127-c),0,0,0,1,0,0,0,0,0,1]),this},b.adjustSaturation=function(a){if(0==a||isNaN(a))return this;a=this._cleanValue(a,100);var b=1+(a>0?3*a/100:a/100),c=.3086,d=.6094,e=.082;return this._multiplyMatrix([c*(1-b)+b,d*(1-b),e*(1-b),0,0,c*(1-b),d*(1-b)+b,e*(1-b),0,0,c*(1-b),d*(1-b),e*(1-b)+b,0,0,0,0,0,1,0,0,0,0,0,1]),this},b.adjustHue=function(a){if(0==a||isNaN(a))return this;a=this._cleanValue(a,180)/180*Math.PI;var b=Math.cos(a),c=Math.sin(a),d=.213,e=.715,f=.072;return this._multiplyMatrix([d+b*(1-d)+c*-d,e+b*-e+c*-e,f+b*-f+c*(1-f),0,0,d+b*-d+.143*c,e+b*(1-e)+.14*c,f+b*-f+c*-.283,0,0,d+b*-d+c*-(1-d),e+b*-e+c*e,f+b*(1-f)+c*f,0,0,0,0,0,1,0,0,0,0,0,1]),this},b.concat=function(b){return b=this._fixMatrix(b),b.length!=a.LENGTH?this:(this._multiplyMatrix(b),this)},b.clone=function(){return(new a).copy(this)},b.toArray=function(){for(var b=[],c=0,d=a.LENGTH;d>c;c++)b[c]=this[c];return b},b.copy=function(b){for(var c=a.LENGTH,d=0;c>d;d++)this[d]=b[d];return this},b.toString=function(){return"[ColorMatrix]"},b._multiplyMatrix=function(a){var b,c,d,e=[];for(b=0;5>b;b++){for(c=0;5>c;c++)e[c]=this[c+5*b];for(c=0;5>c;c++){var f=0;for(d=0;5>d;d++)f+=a[c+5*d]*e[d];this[c+5*b]=f}}},b._cleanValue=function(a,b){return Math.min(b,Math.max(-b,a))},b._fixMatrix=function(b){return b instanceof a&&(b=b.toArray()),b.length<a.LENGTH?b=b.slice(0,b.length).concat(a.IDENTITY_MATRIX.slice(b.length,a.LENGTH)):b.length>a.LENGTH&&(b=b.slice(0,a.LENGTH)),b},createjs.ColorMatrix=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.matrix=a}var b=createjs.extend(a,createjs.Filter);b.toString=function(){return"[ColorMatrixFilter]"},b.clone=function(){return new a(this.matrix)},b._applyFilter=function(a){for(var b,c,d,e,f=a.data,g=f.length,h=this.matrix,i=h[0],j=h[1],k=h[2],l=h[3],m=h[4],n=h[5],o=h[6],p=h[7],q=h[8],r=h[9],s=h[10],t=h[11],u=h[12],v=h[13],w=h[14],x=h[15],y=h[16],z=h[17],A=h[18],B=h[19],C=0;g>C;C+=4)b=f[C],c=f[C+1],d=f[C+2],e=f[C+3],f[C]=b*i+c*j+d*k+e*l+m,f[C+1]=b*n+c*o+d*p+e*q+r,f[C+2]=b*s+c*t+d*u+e*v+w,f[C+3]=b*x+c*y+d*z+e*A+B;return!0},createjs.ColorMatrixFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Touch cannot be instantiated"}a.isSupported=function(){return!!("ontouchstart"in window||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0)},a.enable=function(b,c,d){return b&&b.canvas&&a.isSupported()?b.__touch?!0:(b.__touch={pointers:{},multitouch:!c,preventDefault:!d,count:0},"ontouchstart"in window?a._IOS_enable(b):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&a._IE_enable(b),!0):!1},a.disable=function(b){b&&("ontouchstart"in window?a._IOS_disable(b):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&a._IE_disable(b),delete b.__touch)},a._IOS_enable=function(b){var c=b.canvas,d=b.__touch.f=function(c){a._IOS_handleEvent(b,c)};c.addEventListener("touchstart",d,!1),c.addEventListener("touchmove",d,!1),c.addEventListener("touchend",d,!1),c.addEventListener("touchcancel",d,!1)},a._IOS_disable=function(a){var b=a.canvas;if(b){var c=a.__touch.f;b.removeEventListener("touchstart",c,!1),b.removeEventListener("touchmove",c,!1),b.removeEventListener("touchend",c,!1),b.removeEventListener("touchcancel",c,!1)}},a._IOS_handleEvent=function(a,b){if(a){a.__touch.preventDefault&&b.preventDefault&&b.preventDefault();for(var c=b.changedTouches,d=b.type,e=0,f=c.length;f>e;e++){var g=c[e],h=g.identifier;g.target==a.canvas&&("touchstart"==d?this._handleStart(a,h,b,g.pageX,g.pageY):"touchmove"==d?this._handleMove(a,h,b,g.pageX,g.pageY):("touchend"==d||"touchcancel"==d)&&this._handleEnd(a,h,b))}}},a._IE_enable=function(b){var c=b.canvas,d=b.__touch.f=function(c){a._IE_handleEvent(b,c)};void 0===window.navigator.pointerEnabled?(c.addEventListener("MSPointerDown",d,!1),window.addEventListener("MSPointerMove",d,!1),window.addEventListener("MSPointerUp",d,!1),window.addEventListener("MSPointerCancel",d,!1),b.__touch.preventDefault&&(c.style.msTouchAction="none")):(c.addEventListener("pointerdown",d,!1),window.addEventListener("pointermove",d,!1),window.addEventListener("pointerup",d,!1),window.addEventListener("pointercancel",d,!1),b.__touch.preventDefault&&(c.style.touchAction="none")),b.__touch.activeIDs={}},a._IE_disable=function(a){var b=a.__touch.f;void 0===window.navigator.pointerEnabled?(window.removeEventListener("MSPointerMove",b,!1),window.removeEventListener("MSPointerUp",b,!1),window.removeEventListener("MSPointerCancel",b,!1),a.canvas&&a.canvas.removeEventListener("MSPointerDown",b,!1)):(window.removeEventListener("pointermove",b,!1),window.removeEventListener("pointerup",b,!1),window.removeEventListener("pointercancel",b,!1),a.canvas&&a.canvas.removeEventListener("pointerdown",b,!1))},a._IE_handleEvent=function(a,b){if(a){a.__touch.preventDefault&&b.preventDefault&&b.preventDefault();var c=b.type,d=b.pointerId,e=a.__touch.activeIDs;if("MSPointerDown"==c||"pointerdown"==c){if(b.srcElement!=a.canvas)return;e[d]=!0,this._handleStart(a,d,b,b.pageX,b.pageY)}else e[d]&&("MSPointerMove"==c||"pointermove"==c?this._handleMove(a,d,b,b.pageX,b.pageY):("MSPointerUp"==c||"MSPointerCancel"==c||"pointerup"==c||"pointercancel"==c)&&(delete e[d],this._handleEnd(a,d,b)))}},a._handleStart=function(a,b,c,d,e){var f=a.__touch;if(f.multitouch||!f.count){var g=f.pointers;g[b]||(g[b]=!0,f.count++,a._handlePointerDown(b,c,d,e))}},a._handleMove=function(a,b,c,d,e){a.__touch.pointers[b]&&a._handlePointerMove(b,c,d,e)},a._handleEnd=function(a,b,c){var d=a.__touch,e=d.pointers;e[b]&&(d.count--,a._handlePointerUp(b,c,!0),delete e[b])},createjs.Touch=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=createjs.EaselJS=createjs.EaselJS||{};a.version="0.8.2",a.buildDate="Thu, 26 Nov 2015 20:44:34 GMT"}(),this.createjs=this.createjs||{},function(){"use strict";var a=createjs.PreloadJS=createjs.PreloadJS||{};a.version="0.6.2",a.buildDate="Thu, 26 Nov 2015 20:44:31 GMT"}(),this.createjs=this.createjs||{},function(){"use strict";createjs.proxy=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return a.apply(b,Array.prototype.slice.call(arguments,0).concat(c))}}}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.Event_constructor("error"),this.title=a,this.message=b,this.data=c}var b=createjs.extend(a,createjs.Event);b.clone=function(){return new createjs.ErrorEvent(this.title,this.message,this.data)},createjs.ErrorEvent=createjs.promote(a,"Event")}(),this.createjs=this.createjs||{},function(a){"use strict";function b(a,b){this.Event_constructor("progress"),this.loaded=a,this.total=null==b?1:b,this.progress=0==b?0:this.loaded/this.total}var c=createjs.extend(b,createjs.Event);c.clone=function(){return new createjs.ProgressEvent(this.loaded,this.total)},createjs.ProgressEvent=createjs.promote(b,"Event")}(window),function(){function a(b,d){function f(a){if(f[a]!==q)return f[a];var b;if("bug-string-char-index"==a)b="a"!="a"[0];else if("json"==a)b=f("json-stringify")&&f("json-parse");else{var c,e='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==a){var i=d.stringify,k="function"==typeof i&&t;if(k){(c=function(){return 1}).toJSON=c;try{k="0"===i(0)&&"0"===i(new g)&&'""'==i(new h)&&i(s)===q&&i(q)===q&&i()===q&&"1"===i(c)&&"[1]"==i([c])&&"[null]"==i([q])&&"null"==i(null)&&"[null,null,null]"==i([q,s,null])&&i({a:[c,!0,!1,null,"\x00\b\n\f\r	"]})==e&&"1"===i(null,c)&&"[\n 1,\n 2\n]"==i([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==i(new j(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==i(new j(864e13))&&'"-000001-01-01T00:00:00.000Z"'==i(new j(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==i(new j(-1))}catch(l){k=!1}}b=k}if("json-parse"==a){var m=d.parse;if("function"==typeof m)try{if(0===m("0")&&!m(!1)){c=m(e);var n=5==c.a.length&&1===c.a[0];if(n){try{n=!m('"	"')}catch(l){}if(n)try{n=1!==m("01")}catch(l){}if(n)try{n=1!==m("1.")}catch(l){}}}}catch(l){n=!1}b=n}}return f[a]=!!b}b||(b=e.Object()),d||(d=e.Object());var g=b.Number||e.Number,h=b.String||e.String,i=b.Object||e.Object,j=b.Date||e.Date,k=b.SyntaxError||e.SyntaxError,l=b.TypeError||e.TypeError,m=b.Math||e.Math,n=b.JSON||e.JSON;"object"==typeof n&&n&&(d.stringify=n.stringify,d.parse=n.parse);var o,p,q,r=i.prototype,s=r.toString,t=new j(-0xc782b5b800cec);try{t=-109252==t.getUTCFullYear()&&0===t.getUTCMonth()&&1===t.getUTCDate()&&10==t.getUTCHours()&&37==t.getUTCMinutes()&&6==t.getUTCSeconds()&&708==t.getUTCMilliseconds()}catch(u){}if(!f("json")){var v="[object Function]",w="[object Date]",x="[object Number]",y="[object String]",z="[object Array]",A="[object Boolean]",B=f("bug-string-char-index");if(!t)var C=m.floor,D=[0,31,59,90,120,151,181,212,243,273,304,334],E=function(a,b){return D[b]+365*(a-1970)+C((a-1969+(b=+(b>1)))/4)-C((a-1901+b)/100)+C((a-1601+b)/400)};if((o=r.hasOwnProperty)||(o=function(a){var b,c={};return(c.__proto__=null,c.__proto__={toString:1},c).toString!=s?o=function(a){var b=this.__proto__,c=a in(this.__proto__=null,this);return this.__proto__=b,c}:(b=c.constructor,o=function(a){var c=(this.constructor||b).prototype;return a in this&&!(a in c&&this[a]===c[a])}),c=null,o.call(this,a)}),p=function(a,b){var d,e,f,g=0;(d=function(){this.valueOf=0}).prototype.valueOf=0,e=new d;for(f in e)o.call(e,f)&&g++;return d=e=null,g?p=2==g?function(a,b){var c,d={},e=s.call(a)==v;for(c in a)e&&"prototype"==c||o.call(d,c)||!(d[c]=1)||!o.call(a,c)||b(c)}:function(a,b){var c,d,e=s.call(a)==v;for(c in a)e&&"prototype"==c||!o.call(a,c)||(d="constructor"===c)||b(c);(d||o.call(a,c="constructor"))&&b(c)}:(e=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],p=function(a,b){var d,f,g=s.call(a)==v,h=!g&&"function"!=typeof a.constructor&&c[typeof a.hasOwnProperty]&&a.hasOwnProperty||o;for(d in a)g&&"prototype"==d||!h.call(a,d)||b(d);for(f=e.length;d=e[--f];h.call(a,d)&&b(d));}),p(a,b)},!f("json-stringify")){var F={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},G="000000",H=function(a,b){return(G+(b||0)).slice(-a)},I="\\u00",J=function(a){for(var b='"',c=0,d=a.length,e=!B||d>10,f=e&&(B?a.split(""):a);d>c;c++){var g=a.charCodeAt(c);switch(g){case 8:case 9:case 10:case 12:case 13:case 34:case 92:b+=F[g];break;default:if(32>g){b+=I+H(2,g.toString(16));break}b+=e?f[c]:a.charAt(c)}}return b+'"'},K=function(a,b,c,d,e,f,g){var h,i,j,k,m,n,r,t,u,v,B,D,F,G,I,L;try{h=b[a]}catch(M){}if("object"==typeof h&&h)if(i=s.call(h),i!=w||o.call(h,"toJSON"))"function"==typeof h.toJSON&&(i!=x&&i!=y&&i!=z||o.call(h,"toJSON"))&&(h=h.toJSON(a));else if(h>-1/0&&1/0>h){if(E){for(m=C(h/864e5),j=C(m/365.2425)+1970-1;E(j+1,0)<=m;j++);for(k=C((m-E(j,0))/30.42);E(j,k+1)<=m;k++);m=1+m-E(j,k),n=(h%864e5+864e5)%864e5,r=C(n/36e5)%24,t=C(n/6e4)%60,u=C(n/1e3)%60,v=n%1e3}else j=h.getUTCFullYear(),k=h.getUTCMonth(),m=h.getUTCDate(),r=h.getUTCHours(),t=h.getUTCMinutes(),u=h.getUTCSeconds(),v=h.getUTCMilliseconds();h=(0>=j||j>=1e4?(0>j?"-":"+")+H(6,0>j?-j:j):H(4,j))+"-"+H(2,k+1)+"-"+H(2,m)+"T"+H(2,r)+":"+H(2,t)+":"+H(2,u)+"."+H(3,v)+"Z"}else h=null;if(c&&(h=c.call(b,a,h)),null===h)return"null";if(i=s.call(h),i==A)return""+h;if(i==x)return h>-1/0&&1/0>h?""+h:"null";if(i==y)return J(""+h);if("object"==typeof h){for(G=g.length;G--;)if(g[G]===h)throw l();if(g.push(h),B=[],I=f,f+=e,i==z){for(F=0,G=h.length;G>F;F++)D=K(F,h,c,d,e,f,g),B.push(D===q?"null":D);L=B.length?e?"[\n"+f+B.join(",\n"+f)+"\n"+I+"]":"["+B.join(",")+"]":"[]"}else p(d||h,function(a){var b=K(a,h,c,d,e,f,g);b!==q&&B.push(J(a)+":"+(e?" ":"")+b)}),L=B.length?e?"{\n"+f+B.join(",\n"+f)+"\n"+I+"}":"{"+B.join(",")+"}":"{}";return g.pop(),L}};d.stringify=function(a,b,d){var e,f,g,h;if(c[typeof b]&&b)if((h=s.call(b))==v)f=b;else if(h==z){g={};for(var i,j=0,k=b.length;k>j;i=b[j++],h=s.call(i),(h==y||h==x)&&(g[i]=1));}if(d)if((h=s.call(d))==x){if((d-=d%1)>0)for(e="",d>10&&(d=10);e.length<d;e+=" ");}else h==y&&(e=d.length<=10?d:d.slice(0,10));return K("",(i={},i[""]=a,i),f,g,e,"",[])}}if(!f("json-parse")){var L,M,N=h.fromCharCode,O={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},P=function(){throw L=M=null,k()},Q=function(){for(var a,b,c,d,e,f=M,g=f.length;g>L;)switch(e=f.charCodeAt(L)){case 9:case 10:case 13:case 32:L++;break;case 123:case 125:case 91:case 93:case 58:case 44:return a=B?f.charAt(L):f[L],L++,a;case 34:for(a="@",L++;g>L;)if(e=f.charCodeAt(L),32>e)P();else if(92==e)switch(e=f.charCodeAt(++L)){case 92:case 34:
case 47:case 98:case 116:case 110:case 102:case 114:a+=O[e],L++;break;case 117:for(b=++L,c=L+4;c>L;L++)e=f.charCodeAt(L),e>=48&&57>=e||e>=97&&102>=e||e>=65&&70>=e||P();a+=N("0x"+f.slice(b,L));break;default:P()}else{if(34==e)break;for(e=f.charCodeAt(L),b=L;e>=32&&92!=e&&34!=e;)e=f.charCodeAt(++L);a+=f.slice(b,L)}if(34==f.charCodeAt(L))return L++,a;P();default:if(b=L,45==e&&(d=!0,e=f.charCodeAt(++L)),e>=48&&57>=e){for(48==e&&(e=f.charCodeAt(L+1),e>=48&&57>=e)&&P(),d=!1;g>L&&(e=f.charCodeAt(L),e>=48&&57>=e);L++);if(46==f.charCodeAt(L)){for(c=++L;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==L&&P(),L=c}if(e=f.charCodeAt(L),101==e||69==e){for(e=f.charCodeAt(++L),(43==e||45==e)&&L++,c=L;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==L&&P(),L=c}return+f.slice(b,L)}if(d&&P(),"true"==f.slice(L,L+4))return L+=4,!0;if("false"==f.slice(L,L+5))return L+=5,!1;if("null"==f.slice(L,L+4))return L+=4,null;P()}return"$"},R=function(a){var b,c;if("$"==a&&P(),"string"==typeof a){if("@"==(B?a.charAt(0):a[0]))return a.slice(1);if("["==a){for(b=[];a=Q(),"]"!=a;c||(c=!0))c&&(","==a?(a=Q(),"]"==a&&P()):P()),","==a&&P(),b.push(R(a));return b}if("{"==a){for(b={};a=Q(),"}"!=a;c||(c=!0))c&&(","==a?(a=Q(),"}"==a&&P()):P()),(","==a||"string"!=typeof a||"@"!=(B?a.charAt(0):a[0])||":"!=Q())&&P(),b[a.slice(1)]=R(Q());return b}P()}return a},S=function(a,b,c){var d=T(a,b,c);d===q?delete a[b]:a[b]=d},T=function(a,b,c){var d,e=a[b];if("object"==typeof e&&e)if(s.call(e)==z)for(d=e.length;d--;)S(e,d,c);else p(e,function(a){S(e,a,c)});return c.call(a,b,e)};d.parse=function(a,b){var c,d;return L=0,M=""+a,c=R(Q()),"$"!=Q()&&P(),L=M=null,b&&s.call(b)==v?T((d={},d[""]=c,d),"",b):c}}}return d.runInContext=a,d}var b="function"==typeof define&&define.amd,c={"function":!0,object:!0},d=c[typeof exports]&&exports&&!exports.nodeType&&exports,e=c[typeof window]&&window||this,f=d&&c[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!f||f.global!==f&&f.window!==f&&f.self!==f||(e=f),d&&!b)a(e,d);else{var g=e.JSON,h=e.JSON3,i=!1,j=a(e,e.JSON3={noConflict:function(){return i||(i=!0,e.JSON=g,e.JSON3=h,g=h=null),j}});e.JSON={parse:j.parse,stringify:j.stringify}}b&&define(function(){return j})}.call(this),function(){var a={};a.appendToHead=function(b){a.getHead().appendChild(b)},a.getHead=function(){return document.head||document.getElementsByTagName("head")[0]},a.getBody=function(){return document.body||document.getElementsByTagName("body")[0]},createjs.DomUtils=a}(),function(){var a={};a.parseXML=function(a,b){var c=null;try{if(window.DOMParser){var d=new DOMParser;c=d.parseFromString(a,b)}}catch(e){}if(!c)try{c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(a)}catch(e){c=null}return c},a.parseJSON=function(a){if(null==a)return null;try{return JSON.parse(a)}catch(b){throw b}},createjs.DataUtils=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.src=null,this.type=null,this.id=null,this.maintainOrder=!1,this.callback=null,this.data=null,this.method=createjs.LoadItem.GET,this.values=null,this.headers=null,this.withCredentials=!1,this.mimeType=null,this.crossOrigin=null,this.loadTimeout=c.LOAD_TIMEOUT_DEFAULT}var b=a.prototype={},c=a;c.LOAD_TIMEOUT_DEFAULT=8e3,c.create=function(b){if("string"==typeof b){var d=new a;return d.src=b,d}if(b instanceof c)return b;if(b instanceof Object&&b.src)return null==b.loadTimeout&&(b.loadTimeout=c.LOAD_TIMEOUT_DEFAULT),b;throw new Error("Type not recognized.")},b.set=function(a){for(var b in a)this[b]=a[b];return this},createjs.LoadItem=c}(),function(){var a={};a.ABSOLUTE_PATT=/^(?:\w+:)?\/{2}/i,a.RELATIVE_PATT=/^[.\/]*?\//i,a.EXTENSION_PATT=/\/?[^\/]+\.(\w{1,5})$/i,a.parseURI=function(b){var c={absolute:!1,relative:!1};if(null==b)return c;var d=b.indexOf("?");d>-1&&(b=b.substr(0,d));var e;return a.ABSOLUTE_PATT.test(b)?c.absolute=!0:a.RELATIVE_PATT.test(b)&&(c.relative=!0),(e=b.match(a.EXTENSION_PATT))&&(c.extension=e[1].toLowerCase()),c},a.formatQueryString=function(a,b){if(null==a)throw new Error("You must specify data.");var c=[];for(var d in a)c.push(d+"="+escape(a[d]));return b&&(c=c.concat(b)),c.join("&")},a.buildPath=function(a,b){if(null==b)return a;var c=[],d=a.indexOf("?");if(-1!=d){var e=a.slice(d+1);c=c.concat(e.split("&"))}return-1!=d?a.slice(0,d)+"?"+this.formatQueryString(b,c):a+"?"+this.formatQueryString(b,c)},a.isCrossDomain=function(a){var b=document.createElement("a");b.href=a.src;var c=document.createElement("a");c.href=location.href;var d=""!=b.hostname&&(b.port!=c.port||b.protocol!=c.protocol||b.hostname!=c.hostname);return d},a.isLocal=function(a){var b=document.createElement("a");return b.href=a.src,""==b.hostname&&"file:"==b.protocol},a.isBinary=function(a){switch(a){case createjs.AbstractLoader.IMAGE:case createjs.AbstractLoader.BINARY:return!0;default:return!1}},a.isImageTag=function(a){return a instanceof HTMLImageElement},a.isAudioTag=function(a){return window.HTMLAudioElement?a instanceof HTMLAudioElement:!1},a.isVideoTag=function(a){return window.HTMLVideoElement?a instanceof HTMLVideoElement:!1},a.isText=function(a){switch(a){case createjs.AbstractLoader.TEXT:case createjs.AbstractLoader.JSON:case createjs.AbstractLoader.MANIFEST:case createjs.AbstractLoader.XML:case createjs.AbstractLoader.CSS:case createjs.AbstractLoader.SVG:case createjs.AbstractLoader.JAVASCRIPT:case createjs.AbstractLoader.SPRITESHEET:return!0;default:return!1}},a.getTypeByExtension=function(a){if(null==a)return createjs.AbstractLoader.TEXT;switch(a.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.AbstractLoader.IMAGE;case"ogg":case"mp3":case"webm":return createjs.AbstractLoader.SOUND;case"mp4":case"webm":case"ts":return createjs.AbstractLoader.VIDEO;case"json":return createjs.AbstractLoader.JSON;case"xml":return createjs.AbstractLoader.XML;case"css":return createjs.AbstractLoader.CSS;case"js":return createjs.AbstractLoader.JAVASCRIPT;case"svg":return createjs.AbstractLoader.SVG;default:return createjs.AbstractLoader.TEXT}},createjs.RequestUtils=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.EventDispatcher_constructor(),this.loaded=!1,this.canceled=!1,this.progress=0,this.type=c,this.resultFormatter=null,a?this._item=createjs.LoadItem.create(a):this._item=null,this._preferXHR=b,this._result=null,this._rawResult=null,this._loadedItems=null,this._tagSrcAttribute=null,this._tag=null}var b=createjs.extend(a,createjs.EventDispatcher),c=a;c.POST="POST",c.GET="GET",c.BINARY="binary",c.CSS="css",c.IMAGE="image",c.JAVASCRIPT="javascript",c.JSON="json",c.JSONP="jsonp",c.MANIFEST="manifest",c.SOUND="sound",c.VIDEO="video",c.SPRITESHEET="spritesheet",c.SVG="svg",c.TEXT="text",c.XML="xml",b.getItem=function(){return this._item},b.getResult=function(a){return a?this._rawResult:this._result},b.getTag=function(){return this._tag},b.setTag=function(a){this._tag=a},b.load=function(){this._createRequest(),this._request.on("complete",this,this),this._request.on("progress",this,this),this._request.on("loadStart",this,this),this._request.on("abort",this,this),this._request.on("timeout",this,this),this._request.on("error",this,this);var a=new createjs.Event("initialize");a.loader=this._request,this.dispatchEvent(a),this._request.load()},b.cancel=function(){this.canceled=!0,this.destroy()},b.destroy=function(){this._request&&(this._request.removeAllEventListeners(),this._request.destroy()),this._request=null,this._item=null,this._rawResult=null,this._result=null,this._loadItems=null,this.removeAllEventListeners()},b.getLoadedItems=function(){return this._loadedItems},b._createRequest=function(){this._preferXHR?this._request=new createjs.XHRRequest(this._item):this._request=new createjs.TagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)},b._createTag=function(a){return null},b._sendLoadStart=function(){this._isCanceled()||this.dispatchEvent("loadstart")},b._sendProgress=function(a){if(!this._isCanceled()){var b=null;"number"==typeof a?(this.progress=a,b=new createjs.ProgressEvent(this.progress)):(b=a,this.progress=a.loaded/a.total,b.progress=this.progress,(isNaN(this.progress)||this.progress==1/0)&&(this.progress=0)),this.hasEventListener("progress")&&this.dispatchEvent(b)}},b._sendComplete=function(){if(!this._isCanceled()){this.loaded=!0;var a=new createjs.Event("complete");a.rawResult=this._rawResult,null!=this._result&&(a.result=this._result),this.dispatchEvent(a)}},b._sendError=function(a){!this._isCanceled()&&this.hasEventListener("error")&&(null==a&&(a=new createjs.ErrorEvent("PRELOAD_ERROR_EMPTY")),this.dispatchEvent(a))},b._isCanceled=function(){return null==window.createjs||this.canceled?!0:!1},b.resultFormatter=null,b.handleEvent=function(a){switch(a.type){case"complete":this._rawResult=a.target._response;var b=this.resultFormatter&&this.resultFormatter(this);b instanceof Function?b.call(this,createjs.proxy(this._resultFormatSuccess,this),createjs.proxy(this._resultFormatFailed,this)):(this._result=b||this._rawResult,this._sendComplete());break;case"progress":this._sendProgress(a);break;case"error":this._sendError(a);break;case"loadstart":this._sendLoadStart();break;case"abort":case"timeout":this._isCanceled()||this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_"+a.type.toUpperCase()+"_ERROR"))}},b._resultFormatSuccess=function(a){this._result=a,this._sendComplete()},b._resultFormatFailed=function(a){this._sendError(a)},b.buildPath=function(a,b){return createjs.RequestUtils.buildPath(a,b)},b.toString=function(){return"[PreloadJS AbstractLoader]"},createjs.AbstractLoader=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.AbstractLoader_constructor(a,b,c),this.resultFormatter=this._formatResult,this._tagSrcAttribute="src",this.on("initialize",this._updateXHR,this)}var b=createjs.extend(a,createjs.AbstractLoader);b.load=function(){this._tag||(this._tag=this._createTag(this._item.src)),this._tag.preload="auto",this._tag.load(),this.AbstractLoader_load()},b._createTag=function(){},b._createRequest=function(){this._preferXHR?this._request=new createjs.XHRRequest(this._item):this._request=new createjs.MediaTagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)},b._updateXHR=function(a){a.loader.setResponseType&&a.loader.setResponseType("blob")},b._formatResult=function(a){if(this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler),this._tag.onstalled=null,this._preferXHR){var b=window.URL||window.webkitURL,c=a.getResult(!0);a.getTag().src=b.createObjectURL(c)}return a.getTag()},createjs.AbstractMediaLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a){this._item=a},b=createjs.extend(a,createjs.EventDispatcher);b.load=function(){},b.destroy=function(){},b.cancel=function(){},createjs.AbstractRequest=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.AbstractRequest_constructor(a),this._tag=b,this._tagSrcAttribute=c,this._loadedHandler=createjs.proxy(this._handleTagComplete,this),this._addedToDOM=!1,this._startTagVisibility=null}var b=createjs.extend(a,createjs.AbstractRequest);b.load=function(){this._tag.onload=createjs.proxy(this._handleTagComplete,this),this._tag.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this),this._tag.onerror=createjs.proxy(this._handleError,this);var a=new createjs.Event("initialize");a.loader=this._tag,this.dispatchEvent(a),this._hideTag(),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout),this._tag[this._tagSrcAttribute]=this._item.src,null==this._tag.parentNode&&(window.document.body.appendChild(this._tag),this._addedToDOM=!0)},b.destroy=function(){this._clean(),this._tag=null,this.AbstractRequest_destroy()},b._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var a=this._tag;("loaded"==a.readyState||"complete"==a.readyState)&&this._handleTagComplete()},b._handleError=function(){this._clean(),this.dispatchEvent("error")},b._handleTagComplete=function(){this._rawResult=this._tag,this._result=this.resultFormatter&&this.resultFormatter(this)||this._rawResult,this._clean(),this._showTag(),this.dispatchEvent("complete")},b._handleTimeout=function(){this._clean(),this.dispatchEvent(new createjs.Event("timeout"))},b._clean=function(){this._tag.onload=null,this._tag.onreadystatechange=null,this._tag.onerror=null,this._addedToDOM&&null!=this._tag.parentNode&&this._tag.parentNode.removeChild(this._tag),clearTimeout(this._loadTimeout)},b._hideTag=function(){this._startTagVisibility=this._tag.style.visibility,this._tag.style.visibility="hidden"},b._showTag=function(){this._tag.style.visibility=this._startTagVisibility},b._handleStalled=function(){},createjs.TagRequest=createjs.promote(a,"AbstractRequest")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.AbstractRequest_constructor(a),this._tag=b,this._tagSrcAttribute=c,this._loadedHandler=createjs.proxy(this._handleTagComplete,this)}var b=createjs.extend(a,createjs.TagRequest);b.load=function(){var a=createjs.proxy(this._handleStalled,this);this._stalledCallback=a;var b=createjs.proxy(this._handleProgress,this);this._handleProgress=b,this._tag.addEventListener("stalled",a),this._tag.addEventListener("progress",b),this._tag.addEventListener&&this._tag.addEventListener("canplaythrough",this._loadedHandler,!1),this.TagRequest_load()},b._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var a=this._tag;("loaded"==a.readyState||"complete"==a.readyState)&&this._handleTagComplete()},b._handleStalled=function(){},b._handleProgress=function(a){if(a&&!(a.loaded>0&&0==a.total)){var b=new createjs.ProgressEvent(a.loaded,a.total);this.dispatchEvent(b)}},b._clean=function(){this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler),this._tag.removeEventListener("stalled",this._stalledCallback),this._tag.removeEventListener("progress",this._progressCallback),this.TagRequest__clean()},createjs.MediaTagRequest=createjs.promote(a,"TagRequest")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractRequest_constructor(a),this._request=null,this._loadTimeout=null,this._xhrLevel=1,this._response=null,this._rawResponse=null,this._canceled=!1,this._handleLoadStartProxy=createjs.proxy(this._handleLoadStart,this),this._handleProgressProxy=createjs.proxy(this._handleProgress,this),this._handleAbortProxy=createjs.proxy(this._handleAbort,this),this._handleErrorProxy=createjs.proxy(this._handleError,this),this._handleTimeoutProxy=createjs.proxy(this._handleTimeout,this),this._handleLoadProxy=createjs.proxy(this._handleLoad,this),this._handleReadyStateChangeProxy=createjs.proxy(this._handleReadyStateChange,this),!this._createXHR(a)}var b=createjs.extend(a,createjs.AbstractRequest);a.ACTIVEX_VERSIONS=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],b.getResult=function(a){return a&&this._rawResponse?this._rawResponse:this._response},b.cancel=function(){this.canceled=!0,this._clean(),this._request.abort()},b.load=function(){if(null==this._request)return void this._handleError();null!=this._request.addEventListener?(this._request.addEventListener("loadstart",this._handleLoadStartProxy,!1),this._request.addEventListener("progress",this._handleProgressProxy,!1),this._request.addEventListener("abort",this._handleAbortProxy,!1),this._request.addEventListener("error",this._handleErrorProxy,!1),this._request.addEventListener("timeout",this._handleTimeoutProxy,!1),this._request.addEventListener("load",this._handleLoadProxy,!1),this._request.addEventListener("readystatechange",this._handleReadyStateChangeProxy,!1)):(this._request.onloadstart=this._handleLoadStartProxy,this._request.onprogress=this._handleProgressProxy,this._request.onabort=this._handleAbortProxy,this._request.onerror=this._handleErrorProxy,this._request.ontimeout=this._handleTimeoutProxy,this._request.onload=this._handleLoadProxy,this._request.onreadystatechange=this._handleReadyStateChangeProxy),1==this._xhrLevel&&(this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout));try{this._item.values&&this._item.method!=createjs.AbstractLoader.GET?this._item.method==createjs.AbstractLoader.POST&&this._request.send(createjs.RequestUtils.formatQueryString(this._item.values)):this._request.send()}catch(a){this.dispatchEvent(new createjs.ErrorEvent("XHR_SEND",null,a))}},b.setResponseType=function(a){"blob"===a&&(a=window.URL?"blob":"arraybuffer",this._responseType=a),this._request.responseType=a},b.getAllResponseHeaders=function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},b.getResponseHeader=function(a){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(a):null},b._handleProgress=function(a){if(a&&!(a.loaded>0&&0==a.total)){var b=new createjs.ProgressEvent(a.loaded,a.total);this.dispatchEvent(b)}},b._handleLoadStart=function(a){clearTimeout(this._loadTimeout),this.dispatchEvent("loadstart")},b._handleAbort=function(a){this._clean(),this.dispatchEvent(new createjs.ErrorEvent("XHR_ABORTED",null,a))},b._handleError=function(a){this._clean(),this.dispatchEvent(new createjs.ErrorEvent(a.message))},b._handleReadyStateChange=function(a){4==this._request.readyState&&this._handleLoad()},b._handleLoad=function(a){if(!this.loaded){this.loaded=!0;var b=this._checkError();if(b)return void this._handleError(b);if(this._response=this._getResponse(),"arraybuffer"===this._responseType)try{this._response=new Blob([this._response])}catch(c){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"===c.name&&window.BlobBuilder){var d=new BlobBuilder;d.append(this._response),this._response=d.getBlob()}}this._clean(),this.dispatchEvent(new createjs.Event("complete"))}},b._handleTimeout=function(a){this._clean(),this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_TIMEOUT",null,a))},b._checkError=function(){var a=parseInt(this._request.status);switch(a){case 404:case 0:return new Error(a)}return null},b._getResponse=function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(a){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(a){}return null},b._createXHR=function(a){var b=createjs.RequestUtils.isCrossDomain(a),c={},d=null;if(window.XMLHttpRequest)d=new XMLHttpRequest,b&&void 0===d.withCredentials&&window.XDomainRequest&&(d=new XDomainRequest);else{for(var e=0,f=s.ACTIVEX_VERSIONS.length;f>e;e++){var g=s.ACTIVEX_VERSIONS[e];try{d=new ActiveXObject(g);break}catch(h){}}if(null==d)return!1}null==a.mimeType&&createjs.RequestUtils.isText(a.type)&&(a.mimeType="text/plain; charset=utf-8"),a.mimeType&&d.overrideMimeType&&d.overrideMimeType(a.mimeType),this._xhrLevel="string"==typeof d.responseType?2:1;var i=null;if(i=a.method==createjs.AbstractLoader.GET?createjs.RequestUtils.buildPath(a.src,a.values):a.src,d.open(a.method||createjs.AbstractLoader.GET,i,!0),b&&d instanceof XMLHttpRequest&&1==this._xhrLevel&&(c.Origin=location.origin),a.values&&a.method==createjs.AbstractLoader.POST&&(c["Content-Type"]="application/x-www-form-urlencoded"),b||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest"),a.headers)for(var j in a.headers)c[j]=a.headers[j];for(j in c)d.setRequestHeader(j,c[j]);return d instanceof XMLHttpRequest&&void 0!==a.withCredentials&&(d.withCredentials=a.withCredentials),this._request=d,!0},b._clean=function(){clearTimeout(this._loadTimeout),null!=this._request.removeEventListener?(this._request.removeEventListener("loadstart",this._handleLoadStartProxy),this._request.removeEventListener("progress",this._handleProgressProxy),this._request.removeEventListener("abort",this._handleAbortProxy),this._request.removeEventListener("error",this._handleErrorProxy),this._request.removeEventListener("timeout",this._handleTimeoutProxy),this._request.removeEventListener("load",this._handleLoadProxy),this._request.removeEventListener("readystatechange",this._handleReadyStateChangeProxy)):(this._request.onloadstart=null,this._request.onprogress=null,this._request.onabort=null,this._request.onerror=null,this._request.ontimeout=null,this._request.onload=null,this._request.onreadystatechange=null)},b.toString=function(){return"[PreloadJS XHRRequest]"},createjs.XHRRequest=createjs.promote(a,"AbstractRequest")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.AbstractLoader_constructor(),this._plugins=[],this._typeCallbacks={},this._extensionCallbacks={},this.next=null,this.maintainScriptOrder=!0,this.stopOnError=!1,this._maxConnections=1,this._availableLoaders=[createjs.ImageLoader,createjs.JavaScriptLoader,createjs.CSSLoader,createjs.JSONLoader,createjs.JSONPLoader,createjs.SoundLoader,createjs.ManifestLoader,createjs.SpriteSheetLoader,createjs.XMLLoader,createjs.SVGLoader,createjs.BinaryLoader,createjs.VideoLoader,createjs.TextLoader],this._defaultLoaderLength=this._availableLoaders.length,this.init(a,b,c)}var b=createjs.extend(a,createjs.AbstractLoader),c=a;b.init=function(a,b,c){this.useXHR=!0,this.preferXHR=!0,this._preferXHR=!0,this.setPreferXHR(a),this._paused=!1,this._basePath=b,this._crossOrigin=c,this._loadStartWasDispatched=!1,this._currentlyLoadingScript=null,this._currentLoads=[],this._loadQueue=[],this._loadQueueBackup=[],this._loadItemsById={},this._loadItemsBySrc={},this._loadedResults={},this._loadedRawResults={},this._numItems=0,this._numItemsLoaded=0,this._scriptOrder=[],this._loadedScripts=[],this._lastProgress=NaN},c.loadTimeout=8e3,c.LOAD_TIMEOUT=0,c.BINARY=createjs.AbstractLoader.BINARY,c.CSS=createjs.AbstractLoader.CSS,c.IMAGE=createjs.AbstractLoader.IMAGE,c.JAVASCRIPT=createjs.AbstractLoader.JAVASCRIPT,c.JSON=createjs.AbstractLoader.JSON,c.JSONP=createjs.AbstractLoader.JSONP,c.MANIFEST=createjs.AbstractLoader.MANIFEST,c.SOUND=createjs.AbstractLoader.SOUND,c.VIDEO=createjs.AbstractLoader.VIDEO,c.SVG=createjs.AbstractLoader.SVG,c.TEXT=createjs.AbstractLoader.TEXT,c.XML=createjs.AbstractLoader.XML,c.POST=createjs.AbstractLoader.POST,c.GET=createjs.AbstractLoader.GET,b.registerLoader=function(a){if(!a||!a.canLoadItem)throw new Error("loader is of an incorrect type.");if(-1!=this._availableLoaders.indexOf(a))throw new Error("loader already exists.");this._availableLoaders.unshift(a)},b.unregisterLoader=function(a){var b=this._availableLoaders.indexOf(a);-1!=b&&b<this._defaultLoaderLength-1&&this._availableLoaders.splice(b,1)},b.setUseXHR=function(a){return this.setPreferXHR(a)},b.setPreferXHR=function(a){return this.preferXHR=0!=a&&null!=window.XMLHttpRequest,this.preferXHR},b.removeAll=function(){this.remove()},b.remove=function(a){var b=null;if(a&&!Array.isArray(a))b=[a];else if(a)b=a;else if(arguments.length>0)return;var c=!1;if(b){for(;b.length;){var d=b.pop(),e=this.getResult(d);for(f=this._loadQueue.length-1;f>=0;f--)if(g=this._loadQueue[f].getItem(),g.id==d||g.src==d){this._loadQueue.splice(f,1)[0].cancel();break}for(f=this._loadQueueBackup.length-1;f>=0;f--)if(g=this._loadQueueBackup[f].getItem(),g.id==d||g.src==d){this._loadQueueBackup.splice(f,1)[0].cancel();break}if(e)this._disposeItem(this.getItem(d));else for(var f=this._currentLoads.length-1;f>=0;f--){var g=this._currentLoads[f].getItem();if(g.id==d||g.src==d){this._currentLoads.splice(f,1)[0].cancel(),c=!0;break}}}c&&this._loadNext()}else{this.close();for(var h in this._loadItemsById)this._disposeItem(this._loadItemsById[h]);this.init(this.preferXHR,this._basePath)}},b.reset=function(){this.close();for(var a in this._loadItemsById)this._disposeItem(this._loadItemsById[a]);for(var b=[],c=0,d=this._loadQueueBackup.length;d>c;c++)b.push(this._loadQueueBackup[c].getItem());this.loadManifest(b,!1)},b.installPlugin=function(a){if(null!=a&&null!=a.getPreloadHandlers){this._plugins.push(a);var b=a.getPreloadHandlers();if(b.scope=a,null!=b.types)for(var c=0,d=b.types.length;d>c;c++)this._typeCallbacks[b.types[c]]=b;if(null!=b.extensions)for(c=0,d=b.extensions.length;d>c;c++)this._extensionCallbacks[b.extensions[c]]=b}},b.setMaxConnections=function(a){this._maxConnections=a,!this._paused&&this._loadQueue.length>0&&this._loadNext()},b.loadFile=function(a,b,c){if(null==a){var d=new createjs.ErrorEvent("PRELOAD_NO_FILE");return void this._sendError(d)}this._addItem(a,null,c),b!==!1?this.setPaused(!1):this.setPaused(!0)},b.loadManifest=function(a,b,d){var e=null,f=null;if(Array.isArray(a)){if(0==a.length){var g=new createjs.ErrorEvent("PRELOAD_MANIFEST_EMPTY");return void this._sendError(g)}e=a}else if("string"==typeof a)e=[{src:a,type:c.MANIFEST}];else{if("object"!=typeof a){var g=new createjs.ErrorEvent("PRELOAD_MANIFEST_NULL");return void this._sendError(g)}if(void 0!==a.src){if(null==a.type)a.type=c.MANIFEST;else if(a.type!=c.MANIFEST){var g=new createjs.ErrorEvent("PRELOAD_MANIFEST_TYPE");this._sendError(g)}e=[a]}else void 0!==a.manifest&&(e=a.manifest,f=a.path)}for(var h=0,i=e.length;i>h;h++)this._addItem(e[h],f,d);b!==!1?this.setPaused(!1):this.setPaused(!0)},b.load=function(){this.setPaused(!1)},b.getItem=function(a){return this._loadItemsById[a]||this._loadItemsBySrc[a]},b.getResult=function(a,b){var c=this._loadItemsById[a]||this._loadItemsBySrc[a];if(null==c)return null;var d=c.id;return b&&this._loadedRawResults[d]?this._loadedRawResults[d]:this._loadedResults[d]},b.getItems=function(a){var b=[];for(var c in this._loadItemsById){var d=this._loadItemsById[c],e=this.getResult(c);(a!==!0||null!=e)&&b.push({item:d,result:e,rawResult:this.getResult(c,!0)})}return b},b.setPaused=function(a){this._paused=a,this._paused||this._loadNext()},b.close=function(){for(;this._currentLoads.length;)this._currentLoads.pop().cancel();this._scriptOrder.length=0,this._loadedScripts.length=0,this.loadStartWasDispatched=!1,this._itemCount=0,this._lastProgress=NaN},b._addItem=function(a,b,c){var d=this._createLoadItem(a,b,c);if(null!=d){var e=this._createLoader(d);null!=e&&("plugins"in e&&(e.plugins=this._plugins),d._loader=e,this._loadQueue.push(e),this._loadQueueBackup.push(e),this._numItems++,this._updateProgress(),(this.maintainScriptOrder&&d.type==createjs.LoadQueue.JAVASCRIPT||d.maintainOrder===!0)&&(this._scriptOrder.push(d),this._loadedScripts.push(null)))}},b._createLoadItem=function(a,b,c){var d=createjs.LoadItem.create(a);if(null==d)return null;var e="",f=c||this._basePath;if(d.src instanceof Object){if(!d.type)return null;if(b){e=b;var g=createjs.RequestUtils.parseURI(b);null==f||g.absolute||g.relative||(e=f+e)}else null!=f&&(e=f)}else{var h=createjs.RequestUtils.parseURI(d.src);h.extension&&(d.ext=h.extension),null==d.type&&(d.type=createjs.RequestUtils.getTypeByExtension(d.ext));var i=d.src;if(!h.absolute&&!h.relative)if(b){e=b;var g=createjs.RequestUtils.parseURI(b);i=b+i,null==f||g.absolute||g.relative||(e=f+e)}else null!=f&&(e=f);d.src=e+d.src}d.path=e,(void 0===d.id||null===d.id||""===d.id)&&(d.id=i);var j=this._typeCallbacks[d.type]||this._extensionCallbacks[d.ext];if(j){var k=j.callback.call(j.scope,d,this);if(k===!1)return null;k===!0||null!=k&&(d._loader=k),h=createjs.RequestUtils.parseURI(d.src),null!=h.extension&&(d.ext=h.extension)}return this._loadItemsById[d.id]=d,this._loadItemsBySrc[d.src]=d,null==d.crossOrigin&&(d.crossOrigin=this._crossOrigin),d},b._createLoader=function(a){if(null!=a._loader)return a._loader;for(var b=this.preferXHR,c=0;c<this._availableLoaders.length;c++){var d=this._availableLoaders[c];if(d&&d.canLoadItem(a))return new d(a,b)}return null},b._loadNext=function(){if(!this._paused){this._loadStartWasDispatched||(this._sendLoadStart(),this._loadStartWasDispatched=!0),this._numItems==this._numItemsLoaded?(this.loaded=!0,this._sendComplete(),this.next&&this.next.load&&this.next.load()):this.loaded=!1;for(var a=0;a<this._loadQueue.length&&!(this._currentLoads.length>=this._maxConnections);a++){var b=this._loadQueue[a];this._canStartLoad(b)&&(this._loadQueue.splice(a,1),a--,this._loadItem(b))}}},b._loadItem=function(a){a.on("fileload",this._handleFileLoad,this),a.on("progress",this._handleProgress,this),a.on("complete",this._handleFileComplete,this),a.on("error",this._handleError,this),a.on("fileerror",this._handleFileError,this),this._currentLoads.push(a),this._sendFileStart(a.getItem()),a.load()},b._handleFileLoad=function(a){a.target=null,this.dispatchEvent(a)},b._handleFileError=function(a){var b=new createjs.ErrorEvent("FILE_LOAD_ERROR",null,a.item);this._sendError(b)},b._handleError=function(a){var b=a.target;this._numItemsLoaded++,this._finishOrderedItem(b,!0),this._updateProgress();var c=new createjs.ErrorEvent("FILE_LOAD_ERROR",null,b.getItem());this._sendError(c),this.stopOnError?this.setPaused(!0):(this._removeLoadItem(b),this._cleanLoadItem(b),this._loadNext())},b._handleFileComplete=function(a){var b=a.target,c=b.getItem(),d=b.getResult();this._loadedResults[c.id]=d;var e=b.getResult(!0);null!=e&&e!==d&&(this._loadedRawResults[c.id]=e),this._saveLoadedItems(b),this._removeLoadItem(b),this._finishOrderedItem(b)||this._processFinishedLoad(c,b),this._cleanLoadItem(b)},b._saveLoadedItems=function(a){var b=a.getLoadedItems();if(null!==b)for(var c=0;c<b.length;c++){var d=b[c].item;this._loadItemsBySrc[d.src]=d,this._loadItemsById[d.id]=d,this._loadedResults[d.id]=b[c].result,this._loadedRawResults[d.id]=b[c].rawResult}},b._finishOrderedItem=function(a,b){var c=a.getItem();if(this.maintainScriptOrder&&c.type==createjs.LoadQueue.JAVASCRIPT||c.maintainOrder){a instanceof createjs.JavaScriptLoader&&(this._currentlyLoadingScript=!1);var d=createjs.indexOf(this._scriptOrder,c);return-1==d?!1:(this._loadedScripts[d]=b===!0?!0:c,this._checkScriptLoadOrder(),!0)}return!1},b._checkScriptLoadOrder=function(){for(var a=this._loadedScripts.length,b=0;a>b;b++){var c=this._loadedScripts[b];if(null===c)break;if(c!==!0){var d=this._loadedResults[c.id];c.type==createjs.LoadQueue.JAVASCRIPT&&createjs.DomUtils.appendToHead(d);var e=c._loader;this._processFinishedLoad(c,e),this._loadedScripts[b]=!0}}},b._processFinishedLoad=function(a,b){if(this._numItemsLoaded++,!this.maintainScriptOrder&&a.type==createjs.LoadQueue.JAVASCRIPT){var c=b.getTag();createjs.DomUtils.appendToHead(c)}this._updateProgress(),this._sendFileComplete(a,b),this._loadNext()},b._canStartLoad=function(a){if(!this.maintainScriptOrder||a.preferXHR)return!0;var b=a.getItem();if(b.type!=createjs.LoadQueue.JAVASCRIPT)return!0;if(this._currentlyLoadingScript)return!1;for(var c=this._scriptOrder.indexOf(b),d=0;c>d;){var e=this._loadedScripts[d];if(null==e)return!1;d++}return this._currentlyLoadingScript=!0,!0},b._removeLoadItem=function(a){for(var b=this._currentLoads.length,c=0;b>c;c++)if(this._currentLoads[c]==a){this._currentLoads.splice(c,1);break}},b._cleanLoadItem=function(a){var b=a.getItem();b&&delete b._loader},b._handleProgress=function(a){var b=a.target;this._sendFileProgress(b.getItem(),b.progress),this._updateProgress()},b._updateProgress=function(){var a=this._numItemsLoaded/this._numItems,b=this._numItems-this._numItemsLoaded;if(b>0){for(var c=0,d=0,e=this._currentLoads.length;e>d;d++)c+=this._currentLoads[d].progress;a+=c/b*(b/this._numItems)}this._lastProgress!=a&&(this._sendProgress(a),this._lastProgress=a)},b._disposeItem=function(a){delete this._loadedResults[a.id],delete this._loadedRawResults[a.id],delete this._loadItemsById[a.id],delete this._loadItemsBySrc[a.src]},b._sendFileProgress=function(a,b){if(!this._isCanceled()&&!this._paused&&this.hasEventListener("fileprogress")){var c=new createjs.Event("fileprogress");c.progress=b,c.loaded=b,c.total=1,c.item=a,this.dispatchEvent(c)}},b._sendFileComplete=function(a,b){
if(!this._isCanceled()&&!this._paused){var c=new createjs.Event("fileload");c.loader=b,c.item=a,c.result=this._loadedResults[a.id],c.rawResult=this._loadedRawResults[a.id],a.completeHandler&&a.completeHandler(c),this.hasEventListener("fileload")&&this.dispatchEvent(c)}},b._sendFileStart=function(a){var b=new createjs.Event("filestart");b.item=a,this.hasEventListener("filestart")&&this.dispatchEvent(b)},b.toString=function(){return"[PreloadJS LoadQueue]"},createjs.LoadQueue=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,!0,createjs.AbstractLoader.TEXT)}var b=(createjs.extend(a,createjs.AbstractLoader),a);b.canLoadItem=function(a){return a.type==createjs.AbstractLoader.TEXT},createjs.TextLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,!0,createjs.AbstractLoader.BINARY),this.on("initialize",this._updateXHR,this)}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.BINARY},b._updateXHR=function(a){a.loader.setResponseType("arraybuffer")},createjs.BinaryLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractLoader_constructor(a,b,createjs.AbstractLoader.CSS),this.resultFormatter=this._formatResult,this._tagSrcAttribute="href",b?this._tag=document.createElement("style"):this._tag=document.createElement("link"),this._tag.rel="stylesheet",this._tag.type="text/css"}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.CSS},b._formatResult=function(a){if(this._preferXHR){var b=a.getTag();if(b.styleSheet)b.styleSheet.cssText=a.getResult(!0);else{var c=document.createTextNode(a.getResult(!0));b.appendChild(c)}}else b=this._tag;return createjs.DomUtils.appendToHead(b),b},createjs.CSSLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractLoader_constructor(a,b,createjs.AbstractLoader.IMAGE),this.resultFormatter=this._formatResult,this._tagSrcAttribute="src",createjs.RequestUtils.isImageTag(a)?this._tag=a:createjs.RequestUtils.isImageTag(a.src)?this._tag=a.src:createjs.RequestUtils.isImageTag(a.tag)&&(this._tag=a.tag),null!=this._tag?this._preferXHR=!1:this._tag=document.createElement("img"),this.on("initialize",this._updateXHR,this)}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.IMAGE},b.load=function(){if(""!=this._tag.src&&this._tag.complete)return void this._sendComplete();var a=this._item.crossOrigin;1==a&&(a="Anonymous"),null==a||createjs.RequestUtils.isLocal(this._item.src)||(this._tag.crossOrigin=a),this.AbstractLoader_load()},b._updateXHR=function(a){a.loader.mimeType="text/plain; charset=x-user-defined-binary",a.loader.setResponseType&&a.loader.setResponseType("blob")},b._formatResult=function(a){return this._formatImage},b._formatImage=function(a,b){var c=this._tag,d=window.URL||window.webkitURL;if(this._preferXHR)if(d){var e=d.createObjectURL(this.getResult(!0));c.src=e,c.addEventListener("load",this._cleanUpURL,!1),c.addEventListener("error",this._cleanUpURL,!1)}else c.src=this._item.src;else;c.complete?a(c):(c.onload=createjs.proxy(function(){a(this._tag)},this),c.onerror=createjs.proxy(function(){b(_this._tag)},this))},b._cleanUpURL=function(a){var b=window.URL||window.webkitURL;b.revokeObjectURL(a.target.src)},createjs.ImageLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractLoader_constructor(a,b,createjs.AbstractLoader.JAVASCRIPT),this.resultFormatter=this._formatResult,this._tagSrcAttribute="src",this.setTag(document.createElement("script"))}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.JAVASCRIPT},b._formatResult=function(a){var b=a.getTag();return this._preferXHR&&(b.text=a.getResult(!0)),b},createjs.JavaScriptLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,!0,createjs.AbstractLoader.JSON),this.resultFormatter=this._formatResult}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.JSON},b._formatResult=function(a){var b=null;try{b=createjs.DataUtils.parseJSON(a.getResult(!0))}catch(c){var d=new createjs.ErrorEvent("JSON_FORMAT",null,c);return this._sendError(d),c}return b},createjs.JSONLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,!1,createjs.AbstractLoader.JSONP),this.setTag(document.createElement("script")),this.getTag().type="text/javascript"}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.JSONP},b.cancel=function(){this.AbstractLoader_cancel(),this._dispose()},b.load=function(){if(null==this._item.callback)throw new Error("callback is required for loading JSONP requests.");if(null!=window[this._item.callback])throw new Error("JSONP callback '"+this._item.callback+"' already exists on window. You need to specify a different callback or re-name the current one.");window[this._item.callback]=createjs.proxy(this._handleLoad,this),window.document.body.appendChild(this._tag),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout),this._tag.src=this._item.src},b._handleLoad=function(a){this._result=this._rawResult=a,this._sendComplete(),this._dispose()},b._handleTimeout=function(){this._dispose(),this.dispatchEvent(new createjs.ErrorEvent("timeout"))},b._dispose=function(){window.document.body.removeChild(this._tag),delete window[this._item.callback],clearTimeout(this._loadTimeout)},createjs.JSONPLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,null,createjs.AbstractLoader.MANIFEST),this.plugins=null,this._manifestQueue=null}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.MANIFEST_PROGRESS=.25,c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.MANIFEST},b.load=function(){this.AbstractLoader_load()},b._createRequest=function(){var a=this._item.callback;null!=a?this._request=new createjs.JSONPLoader(this._item):this._request=new createjs.JSONLoader(this._item)},b.handleEvent=function(a){switch(a.type){case"complete":return this._rawResult=a.target.getResult(!0),this._result=a.target.getResult(),this._sendProgress(c.MANIFEST_PROGRESS),void this._loadManifest(this._result);case"progress":return a.loaded*=c.MANIFEST_PROGRESS,this.progress=a.loaded/a.total,(isNaN(this.progress)||this.progress==1/0)&&(this.progress=0),void this._sendProgress(a)}this.AbstractLoader_handleEvent(a)},b.destroy=function(){this.AbstractLoader_destroy(),this._manifestQueue.close()},b._loadManifest=function(a){if(a&&a.manifest){var b=this._manifestQueue=new createjs.LoadQueue;b.on("fileload",this._handleManifestFileLoad,this),b.on("progress",this._handleManifestProgress,this),b.on("complete",this._handleManifestComplete,this,!0),b.on("error",this._handleManifestError,this,!0);for(var c=0,d=this.plugins.length;d>c;c++)b.installPlugin(this.plugins[c]);b.loadManifest(a)}else this._sendComplete()},b._handleManifestFileLoad=function(a){a.target=null,this.dispatchEvent(a)},b._handleManifestComplete=function(a){this._loadedItems=this._manifestQueue.getItems(!0),this._sendComplete()},b._handleManifestProgress=function(a){this.progress=a.progress*(1-c.MANIFEST_PROGRESS)+c.MANIFEST_PROGRESS,this._sendProgress(this.progress)},b._handleManifestError=function(a){var b=new createjs.Event("fileerror");b.item=a.data,this.dispatchEvent(b)},createjs.ManifestLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractMediaLoader_constructor(a,b,createjs.AbstractLoader.SOUND),createjs.RequestUtils.isAudioTag(a)?this._tag=a:createjs.RequestUtils.isAudioTag(a.src)?this._tag=a:createjs.RequestUtils.isAudioTag(a.tag)&&(this._tag=createjs.RequestUtils.isAudioTag(a)?a:a.src),null!=this._tag&&(this._preferXHR=!1)}var b=createjs.extend(a,createjs.AbstractMediaLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.SOUND},b._createTag=function(a){var b=document.createElement("audio");return b.autoplay=!1,b.preload="none",b.src=a,b},createjs.SoundLoader=createjs.promote(a,"AbstractMediaLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractMediaLoader_constructor(a,b,createjs.AbstractLoader.VIDEO),createjs.RequestUtils.isVideoTag(a)||createjs.RequestUtils.isVideoTag(a.src)?(this.setTag(createjs.RequestUtils.isVideoTag(a)?a:a.src),this._preferXHR=!1):this.setTag(this._createTag())}var b=createjs.extend(a,createjs.AbstractMediaLoader),c=a;b._createTag=function(){return document.createElement("video")},c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.VIDEO},createjs.VideoLoader=createjs.promote(a,"AbstractMediaLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractLoader_constructor(a,b,createjs.AbstractLoader.SPRITESHEET),this._manifestQueue=null}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.SPRITESHEET_PROGRESS=.25,c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.SPRITESHEET},b.destroy=function(){this.AbstractLoader_destroy,this._manifestQueue.close()},b._createRequest=function(){var a=this._item.callback;null!=a?this._request=new createjs.JSONPLoader(this._item):this._request=new createjs.JSONLoader(this._item)},b.handleEvent=function(a){switch(a.type){case"complete":return this._rawResult=a.target.getResult(!0),this._result=a.target.getResult(),this._sendProgress(c.SPRITESHEET_PROGRESS),void this._loadManifest(this._result);case"progress":return a.loaded*=c.SPRITESHEET_PROGRESS,this.progress=a.loaded/a.total,(isNaN(this.progress)||this.progress==1/0)&&(this.progress=0),void this._sendProgress(a)}this.AbstractLoader_handleEvent(a)},b._loadManifest=function(a){if(a&&a.images){var b=this._manifestQueue=new createjs.LoadQueue(this._preferXHR,this._item.path,this._item.crossOrigin);b.on("complete",this._handleManifestComplete,this,!0),b.on("fileload",this._handleManifestFileLoad,this),b.on("progress",this._handleManifestProgress,this),b.on("error",this._handleManifestError,this,!0),b.loadManifest(a.images)}},b._handleManifestFileLoad=function(a){var b=a.result;if(null!=b){var c=this.getResult().images,d=c.indexOf(a.item.src);c[d]=b}},b._handleManifestComplete=function(a){this._result=new createjs.SpriteSheet(this._result),this._loadedItems=this._manifestQueue.getItems(!0),this._sendComplete()},b._handleManifestProgress=function(a){this.progress=a.progress*(1-c.SPRITESHEET_PROGRESS)+c.SPRITESHEET_PROGRESS,this._sendProgress(this.progress)},b._handleManifestError=function(a){var b=new createjs.Event("fileerror");b.item=a.data,this.dispatchEvent(b)},createjs.SpriteSheetLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractLoader_constructor(a,b,createjs.AbstractLoader.SVG),this.resultFormatter=this._formatResult,this._tagSrcAttribute="data",b?this.setTag(document.createElement("svg")):(this.setTag(document.createElement("object")),this.getTag().type="image/svg+xml")}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.SVG},b._formatResult=function(a){var b=createjs.DataUtils.parseXML(a.getResult(!0),"text/xml"),c=a.getTag();return!this._preferXHR&&document.body.contains(c)&&document.body.removeChild(c),null!=b.documentElement?(c.appendChild(b.documentElement),c.style.visibility="visible",c):b},createjs.SVGLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,!0,createjs.AbstractLoader.XML),this.resultFormatter=this._formatResult}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.XML},b._formatResult=function(a){return createjs.DataUtils.parseXML(a.getResult(!0),"text/xml")},createjs.XMLLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){var a=createjs.SoundJS=createjs.SoundJS||{};a.version="0.6.2",a.buildDate="Thu, 26 Nov 2015 20:44:31 GMT"}(),this.createjs=this.createjs||{},createjs.indexOf=function(a,b){"use strict";for(var c=0,d=a.length;d>c;c++)if(b===a[c])return c;return-1},this.createjs=this.createjs||{},function(){"use strict";createjs.proxy=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return a.apply(b,Array.prototype.slice.call(arguments,0).concat(c))}}}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"BrowserDetect cannot be instantiated"}var b=a.agent=window.navigator.userAgent;a.isWindowPhone=b.indexOf("IEMobile")>-1||b.indexOf("Windows Phone")>-1,a.isFirefox=b.indexOf("Firefox")>-1,a.isOpera=null!=window.opera,a.isChrome=b.indexOf("Chrome")>-1,a.isIOS=(b.indexOf("iPod")>-1||b.indexOf("iPhone")>-1||b.indexOf("iPad")>-1)&&!a.isWindowPhone,a.isAndroid=b.indexOf("Android")>-1&&!a.isWindowPhone,a.isBlackberry=b.indexOf("Blackberry")>-1,createjs.BrowserDetect=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(){this.interrupt=null,this.delay=null,this.offset=null,this.loop=null,this.volume=null,this.pan=null,this.startTime=null,this.duration=null},b=a.prototype={},c=a;c.create=function(a){if(a instanceof c||a instanceof Object){var b=new createjs.PlayPropsConfig;return b.set(a),b}throw new Error("Type not recognized.")},b.set=function(a){for(var b in a)this[b]=a[b];return this},b.toString=function(){return"[PlayPropsConfig]"},createjs.PlayPropsConfig=c}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Sound cannot be instantiated"}function b(a,b){this.init(a,b)}var c=a;c.INTERRUPT_ANY="any",c.INTERRUPT_EARLY="early",c.INTERRUPT_LATE="late",c.INTERRUPT_NONE="none",c.PLAY_INITED="playInited",c.PLAY_SUCCEEDED="playSucceeded",c.PLAY_INTERRUPTED="playInterrupted",c.PLAY_FINISHED="playFinished",c.PLAY_FAILED="playFailed",c.SUPPORTED_EXTENSIONS=["mp3","ogg","opus","mpeg","wav","m4a","mp4","aiff","wma","mid"],c.EXTENSION_MAP={m4a:"mp4"},c.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([\/.]*?(?:[^?]+)?\/)?((?:[^\/?]+)\.(\w+))(?:\?(\S+)?)?$/,c.defaultInterruptBehavior=c.INTERRUPT_NONE,c.alternateExtensions=[],c.activePlugin=null,c._masterVolume=1,Object.defineProperty(c,"volume",{get:function(){return this._masterVolume},set:function(a){if(null==Number(a))return!1;if(a=Math.max(0,Math.min(1,a)),c._masterVolume=a,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(a))for(var b=this._instances,d=0,e=b.length;e>d;d++)b[d].setMasterVolume(a)}}),c._masterMute=!1,Object.defineProperty(c,"muted",{get:function(){return this._masterMute},set:function(a){if(null==a)return!1;if(this._masterMute=a,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(a))for(var b=this._instances,c=0,d=b.length;d>c;c++)b[c].setMasterMute(a);return!0}}),Object.defineProperty(c,"capabilities",{get:function(){return null==c.activePlugin?null:c.activePlugin._capabilities},set:function(a){return!1}}),c._pluginsRegistered=!1,c._lastID=0,c._instances=[],c._idHash={},c._preloadHash={},c._defaultPlayPropsHash={},c.addEventListener=null,c.removeEventListener=null,c.removeAllEventListeners=null,c.dispatchEvent=null,c.hasEventListener=null,c._listeners=null,createjs.EventDispatcher.initialize(c),c.getPreloadHandlers=function(){return{callback:createjs.proxy(c.initLoad,c),types:["sound"],extensions:c.SUPPORTED_EXTENSIONS}},c._handleLoadComplete=function(a){var b=a.target.getItem().src;if(c._preloadHash[b])for(var d=0,e=c._preloadHash[b].length;e>d;d++){var f=c._preloadHash[b][d];if(c._preloadHash[b][d]=!0,c.hasEventListener("fileload")){var a=new createjs.Event("fileload");a.src=f.src,a.id=f.id,a.data=f.data,a.sprite=f.sprite,c.dispatchEvent(a)}}},c._handleLoadError=function(a){var b=a.target.getItem().src;if(c._preloadHash[b])for(var d=0,e=c._preloadHash[b].length;e>d;d++){var f=c._preloadHash[b][d];if(c._preloadHash[b][d]=!1,c.hasEventListener("fileerror")){var a=new createjs.Event("fileerror");a.src=f.src,a.id=f.id,a.data=f.data,a.sprite=f.sprite,c.dispatchEvent(a)}}},c._registerPlugin=function(a){return a.isSupported()?(c.activePlugin=new a,!0):!1},c.registerPlugins=function(a){c._pluginsRegistered=!0;for(var b=0,d=a.length;d>b;b++)if(c._registerPlugin(a[b]))return!0;return!1},c.initializeDefaultPlugins=function(){return null!=c.activePlugin?!0:c._pluginsRegistered?!1:c.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])?!0:!1},c.isReady=function(){return null!=c.activePlugin},c.getCapabilities=function(){return null==c.activePlugin?null:c.activePlugin._capabilities},c.getCapability=function(a){return null==c.activePlugin?null:c.activePlugin._capabilities[a]},c.initLoad=function(a){return c._registerSound(a)},c._registerSound=function(a){if(!c.initializeDefaultPlugins())return!1;var d;if(a.src instanceof Object?(d=c._parseSrc(a.src),d.src=a.path+d.src):d=c._parsePath(a.src),null==d)return!1;a.src=d.src,a.type="sound";var e=a.data,f=null;if(null!=e&&(isNaN(e.channels)?isNaN(e)||(f=parseInt(e)):f=parseInt(e.channels),e.audioSprite))for(var g,h=e.audioSprite.length;h--;)g=e.audioSprite[h],c._idHash[g.id]={src:a.src,startTime:parseInt(g.startTime),duration:parseInt(g.duration)},g.defaultPlayProps&&(c._defaultPlayPropsHash[g.id]=createjs.PlayPropsConfig.create(g.defaultPlayProps));null!=a.id&&(c._idHash[a.id]={src:a.src});var i=c.activePlugin.register(a);return b.create(a.src,f),null!=e&&isNaN(e)?a.data.channels=f||b.maxPerChannel():a.data=f||b.maxPerChannel(),i.type&&(a.type=i.type),a.defaultPlayProps&&(c._defaultPlayPropsHash[a.src]=createjs.PlayPropsConfig.create(a.defaultPlayProps)),i},c.registerSound=function(a,b,d,e,f){var g={src:a,id:b,data:d,defaultPlayProps:f};a instanceof Object&&a.src&&(e=b,g=a),g=createjs.LoadItem.create(g),g.path=e,null==e||g.src instanceof Object||(g.src=e+a);var h=c._registerSound(g);if(!h)return!1;if(c._preloadHash[g.src]||(c._preloadHash[g.src]=[]),c._preloadHash[g.src].push(g),1==c._preloadHash[g.src].length)h.on("complete",createjs.proxy(this._handleLoadComplete,this)),h.on("error",createjs.proxy(this._handleLoadError,this)),c.activePlugin.preload(h);else if(1==c._preloadHash[g.src][0])return!0;return g},c.registerSounds=function(a,b){var c=[];a.path&&(b?b+=a.path:b=a.path,a=a.manifest);for(var d=0,e=a.length;e>d;d++)c[d]=createjs.Sound.registerSound(a[d].src,a[d].id,a[d].data,b,a[d].defaultPlayProps);return c},c.removeSound=function(a,d){if(null==c.activePlugin)return!1;a instanceof Object&&a.src&&(a=a.src);var e;if(a instanceof Object?e=c._parseSrc(a):(a=c._getSrcById(a).src,e=c._parsePath(a)),null==e)return!1;a=e.src,null!=d&&(a=d+a);for(var f in c._idHash)c._idHash[f].src==a&&delete c._idHash[f];return b.removeSrc(a),delete c._preloadHash[a],c.activePlugin.removeSound(a),!0},c.removeSounds=function(a,b){var c=[];a.path&&(b?b+=a.path:b=a.path,a=a.manifest);for(var d=0,e=a.length;e>d;d++)c[d]=createjs.Sound.removeSound(a[d].src,b);return c},c.removeAllSounds=function(){c._idHash={},c._preloadHash={},b.removeAll(),c.activePlugin&&c.activePlugin.removeAllSounds()},c.loadComplete=function(a){if(!c.isReady())return!1;var b=c._parsePath(a);return a=b?c._getSrcById(b.src).src:c._getSrcById(a).src,void 0==c._preloadHash[a]?!1:1==c._preloadHash[a][0]},c._parsePath=function(a){"string"!=typeof a&&(a=a.toString());var b=a.match(c.FILE_PATTERN);if(null==b)return!1;for(var d=b[4],e=b[5],f=c.capabilities,g=0;!f[e];)if(e=c.alternateExtensions[g++],g>c.alternateExtensions.length)return null;a=a.replace("."+b[5],"."+e);var h={name:d,src:a,extension:e};return h},c._parseSrc=function(a){var b={name:void 0,src:void 0,extension:void 0},d=c.capabilities;for(var e in a)if(a.hasOwnProperty(e)&&d[e]){b.src=a[e],b.extension=e;break}if(!b.src)return!1;var f=b.src.lastIndexOf("/");return-1!=f?b.name=b.src.slice(f+1):b.name=b.src,b},c.play=function(a,b,d,e,f,g,h,i,j){var k;k=b instanceof Object||b instanceof createjs.PlayPropsConfig?createjs.PlayPropsConfig.create(b):createjs.PlayPropsConfig.create({interrupt:b,delay:d,offset:e,loop:f,volume:g,pan:h,startTime:i,duration:j});var l=c.createInstance(a,k.startTime,k.duration),m=c._playInstance(l,k);return m||l._playFailed(),l},c.createInstance=function(a,d,e){if(!c.initializeDefaultPlugins())return new createjs.DefaultSoundInstance(a,d,e);var f=c._defaultPlayPropsHash[a];a=c._getSrcById(a);var g=c._parsePath(a.src),h=null;return null!=g&&null!=g.src?(b.create(g.src),null==d&&(d=a.startTime),h=c.activePlugin.create(g.src,d,e||a.duration),f=f||c._defaultPlayPropsHash[g.src],f&&h.applyPlayProps(f)):h=new createjs.DefaultSoundInstance(a,d,e),h.uniqueId=c._lastID++,h},c.stop=function(){for(var a=this._instances,b=a.length;b--;)a[b].stop()},c.setVolume=function(a){if(null==Number(a))return!1;if(a=Math.max(0,Math.min(1,a)),c._masterVolume=a,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(a))for(var b=this._instances,d=0,e=b.length;e>d;d++)b[d].setMasterVolume(a)},c.getVolume=function(){return this._masterVolume},c.setMute=function(a){if(null==a)return!1;if(this._masterMute=a,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(a))for(var b=this._instances,c=0,d=b.length;d>c;c++)b[c].setMasterMute(a);return!0},c.getMute=function(){return this._masterMute},c.setDefaultPlayProps=function(a,b){a=c._getSrcById(a),c._defaultPlayPropsHash[c._parsePath(a.src).src]=createjs.PlayPropsConfig.create(b)},c.getDefaultPlayProps=function(a){return a=c._getSrcById(a),c._defaultPlayPropsHash[c._parsePath(a.src).src]},c._playInstance=function(a,b){var d=c._defaultPlayPropsHash[a.src]||{};if(null==b.interrupt&&(b.interrupt=d.interrupt||c.defaultInterruptBehavior),null==b.delay&&(b.delay=d.delay||0),null==b.offset&&(b.offset=a.getPosition()),null==b.loop&&(b.loop=a.loop),null==b.volume&&(b.volume=a.volume),null==b.pan&&(b.pan=a.pan),0==b.delay){var e=c._beginPlaying(a,b);if(!e)return!1}else{var f=setTimeout(function(){c._beginPlaying(a,b)},b.delay);a.delayTimeoutId=f}return this._instances.push(a),!0},c._beginPlaying=function(a,c){if(!b.add(a,c.interrupt))return!1;var d=a._beginPlaying(c);if(!d){var e=createjs.indexOf(this._instances,a);return e>-1&&this._instances.splice(e,1),!1}return!0},c._getSrcById=function(a){return c._idHash[a]||{src:a}},c._playFinished=function(a){b.remove(a);var c=createjs.indexOf(this._instances,a);c>-1&&this._instances.splice(c,1)},createjs.Sound=a,b.channels={},b.create=function(a,c){var d=b.get(a);return null==d?(b.channels[a]=new b(a,c),!0):!1},b.removeSrc=function(a){var c=b.get(a);return null==c?!1:(c._removeAll(),delete b.channels[a],!0)},b.removeAll=function(){for(var a in b.channels)b.channels[a]._removeAll();b.channels={}},b.add=function(a,c){var d=b.get(a.src);return null==d?!1:d._add(a,c)},b.remove=function(a){var c=b.get(a.src);return null==c?!1:(c._remove(a),!0)},b.maxPerChannel=function(){return d.maxDefault},b.get=function(a){return b.channels[a]};var d=b.prototype;d.constructor=b,d.src=null,d.max=null,d.maxDefault=100,d.length=0,d.init=function(a,b){this.src=a,this.max=b||this.maxDefault,-1==this.max&&(this.max=this.maxDefault),this._instances=[]},d._get=function(a){return this._instances[a]},d._add=function(a,b){return this._getSlot(b,a)?(this._instances.push(a),this.length++,!0):!1},d._remove=function(a){var b=createjs.indexOf(this._instances,a);return-1==b?!1:(this._instances.splice(b,1),this.length--,!0)},d._removeAll=function(){for(var a=this.length-1;a>=0;a--)this._instances[a].stop()},d._getSlot=function(b,c){var d,e;if(b!=a.INTERRUPT_NONE&&(e=this._get(0),null==e))return!0;for(var f=0,g=this.max;g>f;f++){if(d=this._get(f),null==d)return!0;if(d.playState==a.PLAY_FINISHED||d.playState==a.PLAY_INTERRUPTED||d.playState==a.PLAY_FAILED){e=d;break}b!=a.INTERRUPT_NONE&&(b==a.INTERRUPT_EARLY&&d.getPosition()<e.getPosition()||b==a.INTERRUPT_LATE&&d.getPosition()>e.getPosition())&&(e=d)}return null!=e?(e._interrupt(),this._remove(e),!0):!1},d.toString=function(){return"[Sound SoundChannel]"}}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a,b,c,d){this.EventDispatcher_constructor(),this.src=a,this.uniqueId=-1,this.playState=null,this.delayTimeoutId=null,this._volume=1,Object.defineProperty(this,"volume",{get:this.getVolume,set:this.setVolume}),this._pan=0,Object.defineProperty(this,"pan",{get:this.getPan,set:this.setPan}),this._startTime=Math.max(0,b||0),Object.defineProperty(this,"startTime",{get:this.getStartTime,set:this.setStartTime}),this._duration=Math.max(0,c||0),Object.defineProperty(this,"duration",{get:this.getDuration,set:this.setDuration}),this._playbackResource=null,Object.defineProperty(this,"playbackResource",{get:this.getPlaybackResource,set:this.setPlaybackResource}),d!==!1&&d!==!0&&this.setPlaybackResource(d),this._position=0,Object.defineProperty(this,"position",{get:this.getPosition,set:this.setPosition}),this._loop=0,Object.defineProperty(this,"loop",{get:this.getLoop,set:this.setLoop}),this._muted=!1,Object.defineProperty(this,"muted",{get:this.getMuted,set:this.setMuted}),this._paused=!1,Object.defineProperty(this,"paused",{get:this.getPaused,set:this.setPaused})},b=createjs.extend(a,createjs.EventDispatcher);b.play=function(a,b,c,d,e,f){var g;return g=a instanceof Object||a instanceof createjs.PlayPropsConfig?createjs.PlayPropsConfig.create(a):createjs.PlayPropsConfig.create({interrupt:a,delay:b,offset:c,loop:d,volume:e,pan:f}),this.playState==createjs.Sound.PLAY_SUCCEEDED?(this.applyPlayProps(g),void(this._paused&&this.setPaused(!1))):(this._cleanUp(),createjs.Sound._playInstance(this,g),this)},b.stop=function(){return this._position=0,this._paused=!1,this._handleStop(),this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this},b.destroy=function(){this._cleanUp(),this.src=null,this.playbackResource=null,this.removeAllEventListeners()},b.applyPlayProps=function(a){return null!=a.offset&&this.setPosition(a.offset),null!=a.loop&&this.setLoop(a.loop),null!=a.volume&&this.setVolume(a.volume),null!=a.pan&&this.setPan(a.pan),null!=a.startTime&&(this.setStartTime(a.startTime),this.setDuration(a.duration)),this},b.toString=function(){return"[AbstractSoundInstance]"},b.getPaused=function(){return this._paused},b.setPaused=function(a){return a!==!0&&a!==!1||this._paused==a||1==a&&this.playState!=createjs.Sound.PLAY_SUCCEEDED?void 0:(this._paused=a,a?this._pause():this._resume(),clearTimeout(this.delayTimeoutId),this)},b.setVolume=function(a){return a==this._volume?this:(this._volume=Math.max(0,Math.min(1,a)),this._muted||this._updateVolume(),this)},b.getVolume=function(){return this._volume},b.setMuted=function(a){return a===!0||a===!1?(this._muted=a,this._updateVolume(),this):void 0},b.getMuted=function(){return this._muted},b.setPan=function(a){return a==this._pan?this:(this._pan=Math.max(-1,Math.min(1,a)),this._updatePan(),this)},b.getPan=function(){return this._pan},b.getPosition=function(){return this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||(this._position=this._calculateCurrentPosition()),this._position},b.setPosition=function(a){return this._position=Math.max(0,a),this.playState==createjs.Sound.PLAY_SUCCEEDED&&this._updatePosition(),this},b.getStartTime=function(){return this._startTime},b.setStartTime=function(a){return a==this._startTime?this:(this._startTime=Math.max(0,a||0),this._updateStartTime(),this)},b.getDuration=function(){return this._duration},b.setDuration=function(a){return a==this._duration?this:(this._duration=Math.max(0,a||0),this._updateDuration(),this)},b.setPlaybackResource=function(a){return this._playbackResource=a,0==this._duration&&this._setDurationFromSource(),this},b.getPlaybackResource=function(){return this._playbackResource},b.getLoop=function(){return this._loop},b.setLoop=function(a){null!=this._playbackResource&&(0!=this._loop&&0==a?this._removeLooping(a):0==this._loop&&0!=a&&this._addLooping(a)),this._loop=a},b._sendEvent=function(a){var b=new createjs.Event(a);this.dispatchEvent(b)},b._cleanUp=function(){clearTimeout(this.delayTimeoutId),this._handleCleanUp(),this._paused=!1,createjs.Sound._playFinished(this)},b._interrupt=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_INTERRUPTED,this._sendEvent("interrupted")},b._beginPlaying=function(a){return this.setPosition(a.offset),this.setLoop(a.loop),this.setVolume(a.volume),this.setPan(a.pan),null!=a.startTime&&(this.setStartTime(a.startTime),this.setDuration(a.duration)),null!=this._playbackResource&&this._position<this._duration?(this._paused=!1,this._handleSoundReady(),this.playState=createjs.Sound.PLAY_SUCCEEDED,this._sendEvent("succeeded"),!0):(this._playFailed(),!1)},b._playFailed=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_FAILED,this._sendEvent("failed")},b._handleSoundComplete=function(a){return this._position=0,0!=this._loop?(this._loop--,this._handleLoop(),void this._sendEvent("loop")):(this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,void this._sendEvent("complete"))},b._handleSoundReady=function(){},b._updateVolume=function(){},b._updatePan=function(){},b._updateStartTime=function(){},b._updateDuration=function(){},b._setDurationFromSource=function(){},b._calculateCurrentPosition=function(){},b._updatePosition=function(){},b._removeLooping=function(a){},b._addLooping=function(a){},b._pause=function(){},b._resume=function(){},b._handleStop=function(){},b._handleCleanUp=function(){},b._handleLoop=function(){},createjs.AbstractSoundInstance=createjs.promote(a,"EventDispatcher"),createjs.DefaultSoundInstance=createjs.AbstractSoundInstance}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(){this._capabilities=null,this._loaders={},this._audioSources={},this._soundInstances={},this._volume=1,this._loaderClass,this._soundInstanceClass},b=a.prototype;a._capabilities=null,a.isSupported=function(){return!0},b.register=function(a){var b=this._loaders[a.src];return b&&!b.canceled?this._loaders[a.src]:(this._audioSources[a.src]=!0,this._soundInstances[a.src]=[],b=new this._loaderClass(a),b.on("complete",this._handlePreloadComplete,this),this._loaders[a.src]=b,b)},b.preload=function(a){a.on("error",this._handlePreloadError,this),a.load()},b.isPreloadStarted=function(a){return null!=this._audioSources[a]},b.isPreloadComplete=function(a){return!(null==this._audioSources[a]||1==this._audioSources[a])},b.removeSound=function(a){if(this._soundInstances[a]){for(var b=this._soundInstances[a].length;b--;){var c=this._soundInstances[a][b];c.destroy()}delete this._soundInstances[a],delete this._audioSources[a],this._loaders[a]&&this._loaders[a].destroy(),delete this._loaders[a]}},b.removeAllSounds=function(){for(var a in this._audioSources)this.removeSound(a)},b.create=function(a,b,c){this.isPreloadStarted(a)||this.preload(this.register(a));var d=new this._soundInstanceClass(a,b,c,this._audioSources[a]);return this._soundInstances[a].push(d),d},b.setVolume=function(a){return this._volume=a,this._updateVolume(),!0},b.getVolume=function(){return this._volume},b.setMute=function(a){return this._updateVolume(),!0},b.toString=function(){return"[AbstractPlugin]"},b._handlePreloadComplete=function(a){var b=a.target.getItem().src;this._audioSources[b]=a.result;for(var c=0,d=this._soundInstances[b].length;d>c;c++){var e=this._soundInstances[b][c];e.setPlaybackResource(this._audioSources[b]);
}},b._handlePreloadError=function(a){},b._updateVolume=function(){},createjs.AbstractPlugin=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,!0,createjs.AbstractLoader.SOUND)}var b=createjs.extend(a,createjs.AbstractLoader);a.context=null,b.toString=function(){return"[WebAudioLoader]"},b._createRequest=function(){this._request=new createjs.XHRRequest(this._item,!1),this._request.setResponseType("arraybuffer")},b._sendComplete=function(b){a.context.decodeAudioData(this._rawResult,createjs.proxy(this._handleAudioDecoded,this),createjs.proxy(this._sendError,this))},b._handleAudioDecoded=function(a){this._result=a,this.AbstractLoader__sendComplete()},createjs.WebAudioLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,d,e){this.AbstractSoundInstance_constructor(a,b,d,e),this.gainNode=c.context.createGain(),this.panNode=c.context.createPanner(),this.panNode.panningModel=c._panningModel,this.panNode.connect(this.gainNode),this._updatePan(),this.sourceNode=null,this._soundCompleteTimeout=null,this._sourceNodeNext=null,this._playbackStartTime=0,this._endedHandler=createjs.proxy(this._handleSoundComplete,this)}var b=createjs.extend(a,createjs.AbstractSoundInstance),c=a;c.context=null,c._scratchBuffer=null,c.destinationNode=null,c._panningModel="equalpower",b.destroy=function(){this.AbstractSoundInstance_destroy(),this.panNode.disconnect(0),this.panNode=null,this.gainNode.disconnect(0),this.gainNode=null},b.toString=function(){return"[WebAudioSoundInstance]"},b._updatePan=function(){this.panNode.setPosition(this._pan,0,-.5)},b._removeLooping=function(a){this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)},b._addLooping=function(a){this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0))},b._setDurationFromSource=function(){this._duration=1e3*this.playbackResource.duration},b._handleCleanUp=function(){this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._soundCompleteTimeout),this._playbackStartTime=0},b._cleanUpAudioNode=function(a){if(a){a.stop(0),a.disconnect(0);try{a.buffer=c._scratchBuffer}catch(b){}a=null}return a},b._handleSoundReady=function(a){this.gainNode.connect(c.destinationNode);var b=.001*this._duration,d=.001*this._position;d>b&&(d=b),this.sourceNode=this._createAndPlayAudioNode(c.context.currentTime-b,d),this._playbackStartTime=this.sourceNode.startTime-d,this._soundCompleteTimeout=setTimeout(this._endedHandler,1e3*(b-d)),0!=this._loop&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0))},b._createAndPlayAudioNode=function(a,b){var d=c.context.createBufferSource();d.buffer=this.playbackResource,d.connect(this.panNode);var e=.001*this._duration;return d.startTime=a+e,d.start(d.startTime,b+.001*this._startTime,e-b),d},b._pause=function(){this._position=1e3*(c.context.currentTime-this._playbackStartTime),this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._soundCompleteTimeout)},b._resume=function(){this._handleSoundReady()},b._updateVolume=function(){var a=this._muted?0:this._volume;a!=this.gainNode.gain.value&&(this.gainNode.gain.value=a)},b._calculateCurrentPosition=function(){return 1e3*(c.context.currentTime-this._playbackStartTime)},b._updatePosition=function(){this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext),clearTimeout(this._soundCompleteTimeout),this._paused||this._handleSoundReady()},b._handleLoop=function(){this._cleanUpAudioNode(this.sourceNode),this.sourceNode=this._sourceNodeNext,this._playbackStartTime=this.sourceNode.startTime,this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0),this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration)},b._updateDuration=function(){this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._pause(),this._resume())},createjs.WebAudioSoundInstance=createjs.promote(a,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.AbstractPlugin_constructor(),this._panningModel=c._panningModel,this.context=c.context,this.dynamicsCompressorNode=this.context.createDynamicsCompressor(),this.dynamicsCompressorNode.connect(this.context.destination),this.gainNode=this.context.createGain(),this.gainNode.connect(this.dynamicsCompressorNode),createjs.WebAudioSoundInstance.destinationNode=this.gainNode,this._capabilities=c._capabilities,this._loaderClass=createjs.WebAudioLoader,this._soundInstanceClass=createjs.WebAudioSoundInstance,this._addPropsToClasses()}var b=createjs.extend(a,createjs.AbstractPlugin),c=a;c._capabilities=null,c._panningModel="equalpower",c.context=null,c._scratchBuffer=null,c._unlocked=!1,c.isSupported=function(){var a=createjs.BrowserDetect.isIOS||createjs.BrowserDetect.isAndroid||createjs.BrowserDetect.isBlackberry;return"file:"!=location.protocol||a||this._isFileXHRSupported()?(c._generateCapabilities(),null==c.context?!1:!0):!1},c.playEmptySound=function(){if(null!=c.context){var a=c.context.createBufferSource();a.buffer=c._scratchBuffer,a.connect(c.context.destination),a.start(0,0,0)}},c._isFileXHRSupported=function(){var a=!0,b=new XMLHttpRequest;try{b.open("GET","WebAudioPluginTest.fail",!1)}catch(c){return a=!1}b.onerror=function(){a=!1},b.onload=function(){a=404==this.status||200==this.status||0==this.status&&""!=this.response};try{b.send()}catch(c){a=!1}return a},c._generateCapabilities=function(){if(null==c._capabilities){var a=document.createElement("audio");if(null==a.canPlayType)return null;if(null==c.context)if(window.AudioContext)c.context=new AudioContext;else{if(!window.webkitAudioContext)return null;c.context=new webkitAudioContext}null==c._scratchBuffer&&(c._scratchBuffer=c.context.createBuffer(1,1,22050)),c._compatibilitySetUp(),"ontouchstart"in window&&"running"!=c.context.state&&(c._unlock(),document.addEventListener("mousedown",c._unlock,!0),document.addEventListener("touchend",c._unlock,!0)),c._capabilities={panning:!0,volume:!0,tracks:-1};for(var b=createjs.Sound.SUPPORTED_EXTENSIONS,d=createjs.Sound.EXTENSION_MAP,e=0,f=b.length;f>e;e++){var g=b[e],h=d[g]||g;c._capabilities[g]="no"!=a.canPlayType("audio/"+g)&&""!=a.canPlayType("audio/"+g)||"no"!=a.canPlayType("audio/"+h)&&""!=a.canPlayType("audio/"+h)}c.context.destination.numberOfChannels<2&&(c._capabilities.panning=!1)}},c._compatibilitySetUp=function(){if(c._panningModel="equalpower",!c.context.createGain){c.context.createGain=c.context.createGainNode;var a=c.context.createBufferSource();a.__proto__.start=a.__proto__.noteGrainOn,a.__proto__.stop=a.__proto__.noteOff,c._panningModel=0}},c._unlock=function(){c._unlocked||(c.playEmptySound(),"running"==c.context.state&&(document.removeEventListener("mousedown",c._unlock,!0),document.removeEventListener("touchend",c._unlock,!0),c._unlocked=!0))},b.toString=function(){return"[WebAudioPlugin]"},b._addPropsToClasses=function(){var a=this._soundInstanceClass;a.context=this.context,a._scratchBuffer=c._scratchBuffer,a.destinationNode=this.gainNode,a._panningModel=this._panningModel,this._loaderClass.context=this.context},b._updateVolume=function(){var a=createjs.Sound._masterMute?0:this._volume;a!=this.gainNode.gain.value&&(this.gainNode.gain.value=a)},createjs.WebAudioPlugin=createjs.promote(a,"AbstractPlugin")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"HTMLAudioTagPool cannot be instantiated"}function b(a){this._tags=[]}var c=a;c._tags={},c._tagPool=new b,c._tagUsed={},c.get=function(a){var b=c._tags[a];return null==b?(b=c._tags[a]=c._tagPool.get(),b.src=a):c._tagUsed[a]?(b=c._tagPool.get(),b.src=a):c._tagUsed[a]=!0,b},c.set=function(a,b){b==c._tags[a]?c._tagUsed[a]=!1:c._tagPool.set(b)},c.remove=function(a){var b=c._tags[a];return null==b?!1:(c._tagPool.set(b),delete c._tags[a],delete c._tagUsed[a],!0)},c.getDuration=function(a){var b=c._tags[a];return null!=b&&b.duration?1e3*b.duration:0},createjs.HTMLAudioTagPool=a;var d=b.prototype;d.constructor=b,d.get=function(){var a;return a=0==this._tags.length?this._createTag():this._tags.pop(),null==a.parentNode&&document.body.appendChild(a),a},d.set=function(a){var b=createjs.indexOf(this._tags,a);-1==b&&(this._tags.src=null,this._tags.push(a))},d.toString=function(){return"[TagPool]"},d._createTag=function(){var a=document.createElement("audio");return a.autoplay=!1,a.preload="none",a}}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d){this.AbstractSoundInstance_constructor(a,b,c,d),this._audioSpriteStopTime=null,this._delayTimeoutId=null,this._endedHandler=createjs.proxy(this._handleSoundComplete,this),this._readyHandler=createjs.proxy(this._handleTagReady,this),this._stalledHandler=createjs.proxy(this._playFailed,this),this._audioSpriteEndHandler=createjs.proxy(this._handleAudioSpriteLoop,this),this._loopHandler=createjs.proxy(this._handleSoundComplete,this),c?this._audioSpriteStopTime=.001*(b+c):this._duration=createjs.HTMLAudioTagPool.getDuration(this.src)}var b=createjs.extend(a,createjs.AbstractSoundInstance);b.setMasterVolume=function(a){this._updateVolume()},b.setMasterMute=function(a){this._updateVolume()},b.toString=function(){return"[HTMLAudioSoundInstance]"},b._removeLooping=function(){null!=this._playbackResource&&(this._playbackResource.loop=!1,this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},b._addLooping=function(){null==this._playbackResource||this._audioSpriteStopTime||(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.loop=!0)},b._handleCleanUp=function(){var a=this._playbackResource;if(null!=a){a.pause(),a.loop=!1,a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),a.removeEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1);try{a.currentTime=this._startTime}catch(b){}createjs.HTMLAudioTagPool.set(this.src,a),this._playbackResource=null}},b._beginPlaying=function(a){return this._playbackResource=createjs.HTMLAudioTagPool.get(this.src),this.AbstractSoundInstance__beginPlaying(a)},b._handleSoundReady=function(a){if(4!==this._playbackResource.readyState){var b=this._playbackResource;return b.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),b.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),b.preload="auto",void b.load()}this._updateVolume(),this._playbackResource.currentTime=.001*(this._startTime+this._position),this._audioSpriteStopTime?this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1):(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),0!=this._loop&&(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.loop=!0)),this._playbackResource.play()},b._handleTagReady=function(a){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),this._handleSoundReady()},b._pause=function(){this._playbackResource.pause()},b._resume=function(){this._playbackResource.play()},b._updateVolume=function(){if(null!=this._playbackResource){var a=this._muted||createjs.Sound._masterMute?0:this._volume*createjs.Sound._masterVolume;a!=this._playbackResource.volume&&(this._playbackResource.volume=a)}},b._calculateCurrentPosition=function(){return 1e3*this._playbackResource.currentTime-this._startTime},b._updatePosition=function(){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,!1);try{this._playbackResource.currentTime=.001*(this._position+this._startTime)}catch(a){this._handleSetPositionSeek(null)}},b._handleSetPositionSeek=function(a){null!=this._playbackResource&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},b._handleAudioSpriteLoop=function(a){this._playbackResource.currentTime<=this._audioSpriteStopTime||(this._playbackResource.pause(),0==this._loop?this._handleSoundComplete(null):(this._position=0,this._loop--,this._playbackResource.currentTime=.001*this._startTime,this._paused||this._playbackResource.play(),this._sendEvent("loop")))},b._handleLoop=function(a){0==this._loop&&(this._playbackResource.loop=!1,this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},b._updateStartTime=function(){this._audioSpriteStopTime=.001*(this._startTime+this._duration),this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1))},b._updateDuration=function(){this._audioSpriteStopTime=.001*(this._startTime+this._duration),this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1))},b._setDurationFromSource=function(){this._duration=createjs.HTMLAudioTagPool.getDuration(this.src),this._playbackResource=null},createjs.HTMLAudioSoundInstance=createjs.promote(a,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.AbstractPlugin_constructor(),this.defaultNumChannels=2,this._capabilities=c._capabilities,this._loaderClass=createjs.SoundLoader,this._soundInstanceClass=createjs.HTMLAudioSoundInstance}var b=createjs.extend(a,createjs.AbstractPlugin),c=a;c.MAX_INSTANCES=30,c._AUDIO_READY="canplaythrough",c._AUDIO_ENDED="ended",c._AUDIO_SEEKED="seeked",c._AUDIO_STALLED="stalled",c._TIME_UPDATE="timeupdate",c._capabilities=null,c.isSupported=function(){return c._generateCapabilities(),null!=c._capabilities},c._generateCapabilities=function(){if(null==c._capabilities){var a=document.createElement("audio");if(null==a.canPlayType)return null;c._capabilities={panning:!1,volume:!0,tracks:-1};for(var b=createjs.Sound.SUPPORTED_EXTENSIONS,d=createjs.Sound.EXTENSION_MAP,e=0,f=b.length;f>e;e++){var g=b[e],h=d[g]||g;c._capabilities[g]="no"!=a.canPlayType("audio/"+g)&&""!=a.canPlayType("audio/"+g)||"no"!=a.canPlayType("audio/"+h)&&""!=a.canPlayType("audio/"+h)}}},b.register=function(a){var b=createjs.HTMLAudioTagPool.get(a.src),c=this.AbstractPlugin_register(a);return c.setTag(b),c},b.removeSound=function(a){this.AbstractPlugin_removeSound(a),createjs.HTMLAudioTagPool.remove(a)},b.create=function(a,b,c){var d=this.AbstractPlugin_create(a,b,c);return d.setPlaybackResource(null),d},b.toString=function(){return"[HTMLAudioPlugin]"},b.setVolume=b.getVolume=b.setMute=null,createjs.HTMLAudioPlugin=createjs.promote(a,"AbstractPlugin")}(),this.createjs=this.createjs||{},function(){"use strict";function a(b,c,d){this.ignoreGlobalPause=!1,this.loop=!1,this.duration=0,this.pluginData=d||{},this.target=b,this.position=null,this.passive=!1,this._paused=!1,this._curQueueProps={},this._initQueueProps={},this._steps=[],this._actions=[],this._prevPosition=0,this._stepPosition=0,this._prevPos=-1,this._target=b,this._useTicks=!1,this._inited=!1,this._registered=!1,c&&(this._useTicks=c.useTicks,this.ignoreGlobalPause=c.ignoreGlobalPause,this.loop=c.loop,c.onChange&&this.addEventListener("change",c.onChange),c.override&&a.removeTweens(b)),c&&c.paused?this._paused=!0:createjs.Tween._register(this,!0),c&&null!=c.position&&this.setPosition(c.position,a.NONE)}var b=createjs.extend(a,createjs.EventDispatcher);a.NONE=0,a.LOOP=1,a.REVERSE=2,a.IGNORE={},a._tweens=[],a._plugins={},a.get=function(b,c,d,e){return e&&a.removeTweens(b),new a(b,c,d)},a.tick=function(b,c){for(var d=a._tweens.slice(),e=d.length-1;e>=0;e--){var f=d[e];c&&!f.ignoreGlobalPause||f._paused||f.tick(f._useTicks?1:b)}},a.handleEvent=function(a){"tick"==a.type&&this.tick(a.delta,a.paused)},a.removeTweens=function(b){if(b.tweenjs_count){for(var c=a._tweens,d=c.length-1;d>=0;d--){var e=c[d];e._target==b&&(e._paused=!0,c.splice(d,1))}b.tweenjs_count=0}},a.removeAllTweens=function(){for(var b=a._tweens,c=0,d=b.length;d>c;c++){var e=b[c];e._paused=!0,e.target&&(e.target.tweenjs_count=0)}b.length=0},a.hasActiveTweens=function(b){return b?null!=b.tweenjs_count&&!!b.tweenjs_count:a._tweens&&!!a._tweens.length},a.installPlugin=function(b,c){var d=b.priority;null==d&&(b.priority=d=0);for(var e=0,f=c.length,g=a._plugins;f>e;e++){var h=c[e];if(g[h]){for(var i=g[h],j=0,k=i.length;k>j&&!(d<i[j].priority);j++);g[h].splice(j,0,b)}else g[h]=[b]}},a._register=function(b,c){var d=b._target,e=a._tweens;if(c&&!b._registered)d&&(d.tweenjs_count=d.tweenjs_count?d.tweenjs_count+1:1),e.push(b),!a._inited&&createjs.Ticker&&(createjs.Ticker.addEventListener("tick",a),a._inited=!0);else if(!c&&b._registered){d&&d.tweenjs_count--;for(var f=e.length;f--;)if(e[f]==b){e.splice(f,1);break}}b._registered=c},b.wait=function(a,b){if(null==a||0>=a)return this;var c=this._cloneProps(this._curQueueProps);return this._addStep({d:a,p0:c,e:this._linearEase,p1:c,v:b})},b.to=function(a,b,c){return(isNaN(b)||0>b)&&(b=0),this._addStep({d:b||0,p0:this._cloneProps(this._curQueueProps),e:c,p1:this._cloneProps(this._appendQueueProps(a))})},b.call=function(a,b,c){return this._addAction({f:a,p:b?b:[this],o:c?c:this._target})},b.set=function(a,b){return this._addAction({f:this._set,o:this,p:[a,b?b:this._target]})},b.play=function(a){return a||(a=this),this.call(a.setPaused,[!1],a)},b.pause=function(a){return a||(a=this),this.call(a.setPaused,[!0],a)},b.setPosition=function(a,b){0>a&&(a=0),null==b&&(b=1);var c=a,d=!1;if(c>=this.duration&&(this.loop?c%=this.duration:(c=this.duration,d=!0)),c==this._prevPos)return d;var e=this._prevPos;if(this.position=this._prevPos=c,this._prevPosition=a,this._target)if(d)this._updateTargetProps(null,1);else if(this._steps.length>0){for(var f=0,g=this._steps.length;g>f&&!(this._steps[f].t>c);f++);var h=this._steps[f-1];this._updateTargetProps(h,(this._stepPosition=c-h.t)/h.d)}return 0!=b&&this._actions.length>0&&(this._useTicks?this._runActions(c,c):1==b&&e>c?(e!=this.duration&&this._runActions(e,this.duration),this._runActions(0,c,!0)):this._runActions(e,c)),d&&this.setPaused(!0),this.dispatchEvent("change"),d},b.tick=function(a){this._paused||this.setPosition(this._prevPosition+a)},b.setPaused=function(b){return this._paused===!!b?this:(this._paused=!!b,a._register(this,!b),this)},b.w=b.wait,b.t=b.to,b.c=b.call,b.s=b.set,b.toString=function(){return"[Tween]"},b.clone=function(){throw"Tween can not be cloned."},b._updateTargetProps=function(b,c){var d,e,f,g,h,i;if(b||1!=c){if(this.passive=!!b.v,this.passive)return;b.e&&(c=b.e(c,0,1,1)),d=b.p0,e=b.p1}else this.passive=!1,d=e=this._curQueueProps;for(var j in this._initQueueProps){null==(g=d[j])&&(d[j]=g=this._initQueueProps[j]),null==(h=e[j])&&(e[j]=h=g),f=g==h||0==c||1==c||"number"!=typeof g?1==c?h:g:g+(h-g)*c;var k=!1;if(i=a._plugins[j])for(var l=0,m=i.length;m>l;l++){var n=i[l].tween(this,j,f,d,e,c,!!b&&d==e,!b);n==a.IGNORE?k=!0:f=n}k||(this._target[j]=f)}},b._runActions=function(a,b,c){var d=a,e=b,f=-1,g=this._actions.length,h=1;for(a>b&&(d=b,e=a,f=g,g=h=-1);(f+=h)!=g;){var i=this._actions[f],j=i.t;(j==e||j>d&&e>j||c&&j==a)&&i.f.apply(i.o,i.p)}},b._appendQueueProps=function(b){var c,d,e,f,g;for(var h in b)if(void 0===this._initQueueProps[h]){if(d=this._target[h],c=a._plugins[h])for(e=0,f=c.length;f>e;e++)d=c[e].init(this,h,d);this._initQueueProps[h]=this._curQueueProps[h]=void 0===d?null:d}else d=this._curQueueProps[h];for(var h in b){if(d=this._curQueueProps[h],c=a._plugins[h])for(g=g||{},e=0,f=c.length;f>e;e++)c[e].step&&c[e].step(this,h,d,b[h],g);this._curQueueProps[h]=b[h]}return g&&this._appendQueueProps(g),this._curQueueProps},b._cloneProps=function(a){var b={};for(var c in a)b[c]=a[c];return b},b._addStep=function(a){return a.d>0&&(this._steps.push(a),a.t=this.duration,this.duration+=a.d),this},b._addAction=function(a){return a.t=this.duration,this._actions.push(a),this},b._set=function(a,b){for(var c in a)b[c]=a[c]},createjs.Tween=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.EventDispatcher_constructor(),this.ignoreGlobalPause=!1,this.duration=0,this.loop=!1,this.position=null,this._paused=!1,this._tweens=[],this._labels=null,this._labelList=null,this._prevPosition=0,this._prevPos=-1,this._useTicks=!1,this._registered=!1,c&&(this._useTicks=c.useTicks,this.loop=c.loop,this.ignoreGlobalPause=c.ignoreGlobalPause,c.onChange&&this.addEventListener("change",c.onChange)),a&&this.addTween.apply(this,a),this.setLabels(b),c&&c.paused?this._paused=!0:createjs.Tween._register(this,!0),c&&null!=c.position&&this.setPosition(c.position,createjs.Tween.NONE)}var b=createjs.extend(a,createjs.EventDispatcher);b.addTween=function(a){var b=arguments.length;if(b>1){for(var c=0;b>c;c++)this.addTween(arguments[c]);return arguments[0]}return 0==b?null:(this.removeTween(a),this._tweens.push(a),a.setPaused(!0),a._paused=!1,a._useTicks=this._useTicks,a.duration>this.duration&&(this.duration=a.duration),this._prevPos>=0&&a.setPosition(this._prevPos,createjs.Tween.NONE),a)},b.removeTween=function(a){var b=arguments.length;if(b>1){for(var c=!0,d=0;b>d;d++)c=c&&this.removeTween(arguments[d]);return c}if(0==b)return!1;for(var e=this._tweens,d=e.length;d--;)if(e[d]==a)return e.splice(d,1),a.duration>=this.duration&&this.updateDuration(),!0;return!1},b.addLabel=function(a,b){this._labels[a]=b;var c=this._labelList;if(c){for(var d=0,e=c.length;e>d&&!(b<c[d].position);d++);c.splice(d,0,{label:a,position:b})}},b.setLabels=function(a){this._labels=a?a:{}},b.getLabels=function(){var a=this._labelList;if(!a){a=this._labelList=[];var b=this._labels;for(var c in b)a.push({label:c,position:b[c]});a.sort(function(a,b){return a.position-b.position})}return a},b.getCurrentLabel=function(){var a=this.getLabels(),b=this.position,c=a.length;if(c){for(var d=0;c>d&&!(b<a[d].position);d++);return 0==d?null:a[d-1].label}return null},b.gotoAndPlay=function(a){this.setPaused(!1),this._goto(a)},b.gotoAndStop=function(a){this.setPaused(!0),this._goto(a)},b.setPosition=function(a,b){var c=this._calcPosition(a),d=!this.loop&&a>=this.duration;if(c==this._prevPos)return d;this._prevPosition=a,this.position=this._prevPos=c;for(var e=0,f=this._tweens.length;f>e;e++)if(this._tweens[e].setPosition(c,b),c!=this._prevPos)return!1;return d&&this.setPaused(!0),this.dispatchEvent("change"),d},b.setPaused=function(a){this._paused=!!a,createjs.Tween._register(this,!a)},b.updateDuration=function(){this.duration=0;for(var a=0,b=this._tweens.length;b>a;a++){var c=this._tweens[a];c.duration>this.duration&&(this.duration=c.duration)}},b.tick=function(a){this.setPosition(this._prevPosition+a)},b.resolve=function(a){var b=Number(a);return isNaN(b)&&(b=this._labels[a]),b},b.toString=function(){return"[Timeline]"},b.clone=function(){throw"Timeline can not be cloned."},b._goto=function(a){var b=this.resolve(a);null!=b&&this.setPosition(b)},b._calcPosition=function(a){return 0>a?0:a<this.duration?a:this.loop?a%this.duration:this.duration},createjs.Timeline=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Ease cannot be instantiated."}a.linear=function(a){return a},a.none=a.linear,a.get=function(a){return-1>a&&(a=-1),a>1&&(a=1),function(b){return 0==a?b:0>a?b*(b*-a+1+a):b*((2-b)*a+(1-a))}},a.getPowIn=function(a){return function(b){return Math.pow(b,a)}},a.getPowOut=function(a){return function(b){return 1-Math.pow(1-b,a)}},a.getPowInOut=function(a){return function(b){return(b*=2)<1?.5*Math.pow(b,a):1-.5*Math.abs(Math.pow(2-b,a))}},a.quadIn=a.getPowIn(2),a.quadOut=a.getPowOut(2),a.quadInOut=a.getPowInOut(2),a.cubicIn=a.getPowIn(3),a.cubicOut=a.getPowOut(3),a.cubicInOut=a.getPowInOut(3),a.quartIn=a.getPowIn(4),a.quartOut=a.getPowOut(4),a.quartInOut=a.getPowInOut(4),a.quintIn=a.getPowIn(5),a.quintOut=a.getPowOut(5),a.quintInOut=a.getPowInOut(5),a.sineIn=function(a){return 1-Math.cos(a*Math.PI/2)},a.sineOut=function(a){return Math.sin(a*Math.PI/2)},a.sineInOut=function(a){return-.5*(Math.cos(Math.PI*a)-1)},a.getBackIn=function(a){return function(b){return b*b*((a+1)*b-a)}},a.backIn=a.getBackIn(1.7),a.getBackOut=function(a){return function(b){return--b*b*((a+1)*b+a)+1}},a.backOut=a.getBackOut(1.7),a.getBackInOut=function(a){return a*=1.525,function(b){return(b*=2)<1?.5*(b*b*((a+1)*b-a)):.5*((b-=2)*b*((a+1)*b+a)+2)}},a.backInOut=a.getBackInOut(1.7),a.circIn=function(a){return-(Math.sqrt(1-a*a)-1)},a.circOut=function(a){return Math.sqrt(1- --a*a)},a.circInOut=function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},a.bounceIn=function(b){return 1-a.bounceOut(1-b)},a.bounceOut=function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},a.bounceInOut=function(b){return.5>b?.5*a.bounceIn(2*b):.5*a.bounceOut(2*b-1)+.5},a.getElasticIn=function(a,b){var c=2*Math.PI;return function(d){if(0==d||1==d)return d;var e=b/c*Math.asin(1/a);return-(a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*c/b))}},a.elasticIn=a.getElasticIn(1,.3),a.getElasticOut=function(a,b){var c=2*Math.PI;return function(d){if(0==d||1==d)return d;var e=b/c*Math.asin(1/a);return a*Math.pow(2,-10*d)*Math.sin((d-e)*c/b)+1}},a.elasticOut=a.getElasticOut(1,.3),a.getElasticInOut=function(a,b){var c=2*Math.PI;return function(d){var e=b/c*Math.asin(1/a);return(d*=2)<1?-.5*(a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*c/b)):a*Math.pow(2,-10*(d-=1))*Math.sin((d-e)*c/b)*.5+1}},a.elasticInOut=a.getElasticInOut(1,.3*1.5),createjs.Ease=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"MotionGuidePlugin cannot be instantiated."}a.priority=0,a._rotOffS,a._rotOffE,a._rotNormS,a._rotNormE,a.install=function(){return createjs.Tween.installPlugin(a,["guide","x","y","rotation"]),createjs.Tween.IGNORE},a.init=function(a,b,c){var d=a.target;return d.hasOwnProperty("x")||(d.x=0),d.hasOwnProperty("y")||(d.y=0),d.hasOwnProperty("rotation")||(d.rotation=0),"rotation"==b&&(a.__needsRot=!0),"guide"==b?null:c},a.step=function(b,c,d,e,f){if("rotation"==c&&(b.__rotGlobalS=d,b.__rotGlobalE=e,a.testRotData(b,f)),"guide"!=c)return e;var g,h=e;h.hasOwnProperty("path")||(h.path=[]);var i=h.path;if(h.hasOwnProperty("end")||(h.end=1),h.hasOwnProperty("start")||(h.start=d&&d.hasOwnProperty("end")&&d.path===i?d.end:0),h.hasOwnProperty("_segments")&&h._length)return e;var j=i.length,k=10;if(!(j>=6&&(j-2)%4==0))throw"invalid 'path' data, please see documentation for valid paths";h._segments=[],h._length=0;for(var l=2;j>l;l+=4){for(var m,n,o=i[l-2],p=i[l-1],q=i[l+0],r=i[l+1],s=i[l+2],t=i[l+3],u=o,v=p,w=0,x=[],y=1;k>=y;y++){var z=y/k,A=1-z;m=A*A*o+2*A*z*q+z*z*s,n=A*A*p+2*A*z*r+z*z*t,w+=x[x.push(Math.sqrt((g=m-u)*g+(g=n-v)*g))-1],u=m,v=n}h._segments.push(w),h._segments.push(x),h._length+=w}g=h.orient,h.orient=!0;var B={};return a.calc(h,h.start,B),b.__rotPathS=Number(B.rotation.toFixed(5)),a.calc(h,h.end,B),b.__rotPathE=Number(B.rotation.toFixed(5)),h.orient=!1,a.calc(h,h.end,f),h.orient=g,h.orient?(b.__guideData=h,a.testRotData(b,f),e):e},a.testRotData=function(a,b){if(void 0===a.__rotGlobalS||void 0===a.__rotGlobalE){if(a.__needsRot)return;void 0!==a._curQueueProps.rotation?a.__rotGlobalS=a.__rotGlobalE=a._curQueueProps.rotation:a.__rotGlobalS=a.__rotGlobalE=b.rotation=a.target.rotation||0}if(void 0!==a.__guideData){var c=a.__guideData,d=a.__rotGlobalE-a.__rotGlobalS,e=a.__rotPathE-a.__rotPathS,f=d-e;if("auto"==c.orient)f>180?f-=360:-180>f&&(f+=360);else if("cw"==c.orient){for(;0>f;)f+=360;0==f&&d>0&&180!=d&&(f+=360)}else if("ccw"==c.orient){for(f=d-(e>180?360-e:e);f>0;)f-=360;0==f&&0>d&&-180!=d&&(f-=360)}c.rotDelta=f,c.rotOffS=a.__rotGlobalS-a.__rotPathS,a.__rotGlobalS=a.__rotGlobalE=a.__guideData=a.__needsRot=void 0}},a.tween=function(b,c,d,e,f,g,h,i){var j=f.guide;if(void 0==j||j===e.guide)return d;if(j.lastRatio!=g){var k=(j.end-j.start)*(h?j.end:g)+j.start;switch(a.calc(j,k,b.target),j.orient){case"cw":case"ccw":case"auto":b.target.rotation+=j.rotOffS+j.rotDelta*g;break;case"fixed":default:b.target.rotation+=j.rotOffS}j.lastRatio=g}return"rotation"!=c||j.orient&&"false"!=j.orient?b.target[c]:d},a.calc=function(a,b,c){if(void 0==a._segments)throw"Missing critical pre-calculated information, please file a bug";void 0==c&&(c={x:0,y:0,rotation:0});for(var d=a._segments,e=a.path,f=a._length*b,g=d.length-2,h=0;f>d[h]&&g>h;)f-=d[h],h+=2;var i=d[h+1],j=0;for(g=i.length-1;f>i[j]&&g>j;)f-=i[j],j++;var k=j/++g+f/(g*i[j]);h=2*h+2;var l=1-k;return c.x=l*l*e[h-2]+2*l*k*e[h+0]+k*k*e[h+2],c.y=l*l*e[h-1]+2*l*k*e[h+1]+k*k*e[h+3],a.orient&&(c.rotation=57.2957795*Math.atan2((e[h+1]-e[h-1])*l+(e[h+3]-e[h+1])*k,(e[h+0]-e[h-2])*l+(e[h+2]-e[h+0])*k)),c},createjs.MotionGuidePlugin=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=createjs.TweenJS=createjs.TweenJS||{};a.version="0.6.2",a.buildDate="Thu, 26 Nov 2015 20:44:31 GMT"}();
// Filbert is a Python parser written in JavaScript.
//
// Filbert was written by Matt Lott and released under an MIT
// license. It was adatped from [Acorn](https://github.com/marijnh/acorn.git)
// by Marijn Haverbeke.
//
// Git repository for Filbert are available at
//
//     https://github.com/differentmatt/filbert.git
//
// Please use the [github bug tracker][ghbt] to report issues.
//
// [ghbt]: https://github.com/differentmatt/filbert/issues

(function(root, mod) {
  if (typeof exports == "object" && typeof module == "object") return mod(exports); // CommonJS
  if (typeof define == "function" && define.amd) return define(["exports"], mod); // AMD
  mod(root.filbert || (root.filbert = {})); // Plain browser env
})(this, function(exports) {
  "use strict";

  exports.version = "0.5.1";

  // The main exported interface (under `self.filbert` when in the
  // browser) is a `parse` function that takes a code string and
  // returns an abstract syntax tree as specified by [Mozilla parser
  // API][api].
  //
  // [api]: https://developer.mozilla.org/en-US/docs/SpiderMonkey/Parser_API

  var options, input, inputLen, sourceFile, nc;

  exports.parse = function(inpt, opts) {
    input = String(inpt); inputLen = input.length;
    setOptions(opts);
    initTokenState();
    nc = getNodeCreator(startNode, startNodeFrom, finishNode, unpackTuple);
    return parseTopLevel(options.program);
  };

  // A second optional argument can be given to further configure
  // the parser process. These options are recognized:

  var defaultOptions = exports.defaultOptions = {
    // `languageVersion` indicates the Python version to parse. It
    // is not currently in use, but will support 2 or 3 eventually.
    languageVersion: 3,
    // When `allowTrailingCommas` is false, the parser will not allow
    // trailing commas in array and object literals.
    allowTrailingCommas: true,
    // When enabled, a return at the top level is not considered an
    // error.
    allowReturnOutsideFunction: false,
    // When `locations` is on, `loc` properties holding objects with
    // `start` and `end` properties in `{line, column}` form (with
    // line being 1-based and column 0-based) will be attached to the
    // nodes.
    locations: false,
    // A function can be passed as `onComment` option, which will
    // cause Filbert to call that function with `(text, start,
    // end)` parameters whenever a comment is skipped.
    // `text` is the content of the comment, and `start` and `end` are
    // character offsets that denote the start and end of the comment.
    // When the `locations` option is on, two more parameters are
    // passed, the full `{line, column}` locations of the start and
    // end of the comments. Note that you are not allowed to call the
    // parser from the callback-that will corrupt its internal state.
    onComment: null,
    // [semi-standardized][range] `range` property holding a `[start,
    // end]` array with the same numbers, set the `ranges` option to
    // `true`.
    //
    // [range]: https://bugzilla.mozilla.org/show_bug.cgi?id=745678
    ranges: false,
    // It is possible to parse multiple files into a single AST by
    // passing the tree produced by parsing the first file as
    // `program` option in subsequent parses. This will add the
    // toplevel forms of the parsed file to the `Program` (top) node
    // of an existing parse tree.
    program: null,
    // When `locations` is on, you can pass this to record the source
    // file in every node's `loc` object.
    sourceFile: null,
    // This value, if given, is stored in every node, whether
    // `locations` is on or off.
    directSourceFile: null,
    // Python runtime library object name
    runtimeParamName: "__pythonRuntime"
  };

  function setOptions(opts) {
    options = opts || {};
    for (var opt in defaultOptions) if (!Object.prototype.hasOwnProperty.call(options, opt))
      options[opt] = defaultOptions[opt];
    sourceFile = options.sourceFile || null;
  }

  // The `getLineInfo` function is mostly useful when the
  // `locations` option is off (for performance reasons) and you
  // want to find the line/column position for a given character
  // offset. `input` should be the code string that the offset refers
  // into.

  var getLineInfo = exports.getLineInfo = function(input, offset) {
    for (var line = 1, cur = 0;;) {
      lineBreak.lastIndex = cur;
      var match = lineBreak.exec(input);
      if (match && match.index < offset) {
        ++line;
        cur = match.index + match[0].length;
      } else break;
    }
    return {line: line, column: offset - cur};
  };

  // Filbert is organized as a tokenizer and a recursive-descent parser.
  // The `tokenize` export provides an interface to the tokenizer.
  // Because the tokenizer is optimized for being efficiently used by
  // the Filbert parser itself, this interface is somewhat crude and not
  // very modular. Performing another parse or call to `tokenize` will
  // reset the internal state, and invalidate existing tokenizers.

  exports.tokenize = function(inpt, opts) {
    input = String(inpt); inputLen = input.length;
    setOptions(opts);
    initTokenState();

    var t = {};
    function getToken(forceRegexp) {
      lastEnd = tokEnd;
      readToken(forceRegexp);
      t.start = tokStart; t.end = tokEnd;
      t.startLoc = tokStartLoc; t.endLoc = tokEndLoc;
      t.type = tokType; t.value = tokVal;
      return t;
    }
    getToken.jumpTo = function(pos, reAllowed) {
      tokPos = pos;
      if (options.locations) {
        tokCurLine = 1;
        tokLineStart = lineBreak.lastIndex = 0;
        var match;
        while ((match = lineBreak.exec(input)) && match.index < pos) {
          ++tokCurLine;
          tokLineStart = match.index + match[0].length;
        }
      }
      tokRegexpAllowed = reAllowed;
      skipSpace();
    };
    return getToken;
  };

  // State is kept in (closure-)global variables. We already saw the
  // `options`, `input`, and `inputLen` variables above.

  // The current position of the tokenizer in the input.

  var tokPos;

  // The start and end offsets of the current token.

  var tokStart, tokEnd;

  // When `options.locations` is true, these hold objects
  // containing the tokens start and end line/column pairs.

  var tokStartLoc, tokEndLoc;

  // The type and value of the current token. Token types are objects,
  // named by variables against which they can be compared, and
  // holding properties that describe them (indicating, for example,
  // the precedence of an infix operator, and the original name of a
  // keyword token). The kind of value that's held in `tokVal` depends
  // on the type of the token. For literals, it is the literal value,
  // for operators, the operator name, and so on.

  var tokType, tokVal;

  // Interal state for the tokenizer. To distinguish between division
  // operators and regular expressions, it remembers whether the last
  // token was one that is allowed to be followed by an expression.
  // (If it is, a slash is probably a regexp, if it isn't it's a
  // division operator. See the `parseStatement` function for a
  // caveat.)

  var tokRegexpAllowed;

  // When `options.locations` is true, these are used to keep
  // track of the current line, and know when a new line has been
  // entered.

  var tokCurLine, tokLineStart;

  // These store the position of the previous token, which is useful
  // when finishing a node and assigning its `end` position.

  var lastStart, lastEnd, lastEndLoc;

  // This is the parser's state. `inFunction` is used to reject
  // `return` statements outside of functions, `strict` indicates
  // whether strict mode is on, and `bracketNesting` tracks the level
  // of nesting within brackets for implicit lint continuation.

  var inFunction, strict, bracketNesting;

  // This function is used to raise exceptions on parse errors. It
  // takes an offset integer (into the current `input`) to indicate
  // the location of the error, attaches the position to the end
  // of the error message, and then raises a `SyntaxError` with that
  // message.

  function raise(pos, message) {
    var loc = getLineInfo(input, pos);
    var err = new SyntaxError(message);
    err.pos = pos; err.loc = loc; err.raisedAt = tokPos;
    throw err;
  }

  // Reused empty array added for node fields that are always empty.

  var empty = [];

  // Used for name collision avoidance whend adding extra AST identifiers

  var newAstIdCount = 0;

  var indentHist = exports.indentHist = {
    // Current indentation stack
    indent: [],

    // Number of dedent tokens left (i.e. if tokType == _dedent, dedentCount > 0)
    // Multiple dedent tokens are read in at once, but processed individually in readToken()
    dedentCount: 0,

    init: function () { this.indent = []; this.dedentCount = 0; },
    count: function () { return this.indent.length; },
    len: function (i) { 
      if (typeof i === 'undefined' || i >= this.indent.length) i = this.indent.length - 1;
      return this.indent[i].length; 
    },
    isIndent: function(s) {
      return this.indent.length === 0 || s.length > this.len();
    },
    isDedent: function(s) {
      return this.indent.length > 0 && s.length < this.len();
    },
    addIndent: function (s) { this.indent.push(s); },
    addDedent: function (s) {
      this.dedentCount = 0;
      for (var i = this.indent.length - 1; i >= 0 && s.length < this.indent[i].length; --i)
        ++this.dedentCount;
    },
    updateDedent: function () { this.dedentCount = this.count(); },
    pop: function () {
      --this.dedentCount;
      this.indent.pop();
    },
    undoIndent: function () { this.pop(); }
  };

  // ## Scope

  // Collection of namespaces saved as a stack
  // A namespace is a mapping of identifiers to 3 types: variables, functions, classes
  // A namespace also knows whether it is for global, class, or function
  // A new namespace is pushed at function and class start, and popped at their end
  // Starts with a global namespace on the stack
  // E.g. scope.namespaces ~ [{type: 'g', map:{x: 'v', MyClass: 'c'} }, ...]

  // TODO: Not tracking built-in namespace
  
  var scope = exports.scope = {
    namespaces: [],
    init: function () { this.namespaces = [{ type: 'g', map: {} }]; },
    current: function(offset) { 
      offset = offset || 0;
      return this.namespaces[this.namespaces.length - offset - 1];
    },
    startClass: function (id) {
      this.current().map[id] = 'c';
      this.namespaces.push({ type: 'c', map: {}, className: id });
    },
    startFn: function (id) {
      this.current().map[id] = 'f';
      this.namespaces.push({ type: 'f', map: {}, fnName: id });
    },
    end: function () { this.namespaces.pop(); },
    addVar: function (id) { this.current().map[id] = 'v'; },
    exists: function (id) { return this.current().map.hasOwnProperty(id); },
    isClass: function () { return this.current().type === 'c'; },
    isUserFunction: function(name) {
      // Loose match (i.e. order ignored)
      // TODO: does not identify user-defined class methods
      for (var i = this.namespaces.length - 1; i >= 0; i--)
        for (var key in this.namespaces[i].map)
          if (key === name && this.namespaces[i].map[key] === 'f')
            return true;
      return false;
    },
    isParentClass: function() { return this.current(1).type === 'c'; },
    isNewObj: function (id) {
      for (var i = this.namespaces.length - 1; i >= 0; i--)
        if (this.namespaces[i].map[id] === 'c') return true;
        else if (this.namespaces[i].map[id] === 'f') break;
      return false;
    },
    getParentClassName: function () { return this.current(1).className; },
    getThisReplace: function () { return this.current().thisReplace; },
    setThisReplace: function (s) { this.current().thisReplace = s; }
  };
  

  // ## Token types

  // The assignment of fine-grained, information-carrying type objects
  // allows the tokenizer to store the information it has about a
  // token in a way that is very cheap for the parser to look up.

  // All token type variables start with an underscore, to make them
  // easy to recognize.

  // These are the general types. The `type` property is only used to
  // make them recognizeable when debugging.

  var _num = {type: "num"}, _regexp = {type: "regexp"}, _string = {type: "string"};
  var _name = {type: "name"}, _eof = {type: "eof"};
  var _newline = {type: "newline"}, _indent = {type: "indent"}, _dedent = {type: "dedent"};

  // Keyword tokens. The `keyword` property (also used in keyword-like
  // operators) indicates that the token originated from an
  // identifier-like word, which is used when parsing property names.
  //
  // The `beforeExpr` property is used to disambiguate between regular
  // expressions and divisions. It is set on all token types that can
  // be followed by an expression (thus, a slash after them would be a
  // regular expression).
  
  var _dict = { keyword: "dict" };  // TODO: not a keyword
  var _as = { keyword: "as" }, _assert = { keyword: "assert" }, _break = { keyword: "break" };
  var _class = { keyword: "class" }, _continue = { keyword: "continue" };
  var _def = { keyword: "def" }, _del = { keyword: "del" };
  var _elif = { keyword: "elif", beforeExpr: true }, _else = { keyword: "else", beforeExpr: true };
  var _except = { keyword: "except", beforeExpr: true }, _finally = {keyword: "finally"};
  var _for = { keyword: "for" }, _from = { keyword: "from" }, _global = { keyword: "global" };
  var _if = { keyword: "if" }, _import = { keyword: "import" };
  var _lambda = {keyword: "lambda"}, _nonlocal = {keyword: "nonlocal"};
  var _pass = { keyword: "pass" }, _raise = {keyword: "raise"};
  var _return = { keyword: "return", beforeExpr: true }, _try = { keyword: "try" };
  var _while = {keyword: "while"}, _with = {keyword: "with"}, _yield = {keyword: "yield"};

  // The keywords that denote values.

  var _none = {keyword: "None", atomValue: null}, _true = {keyword: "True", atomValue: true};
  var _false = {keyword: "False", atomValue: false};

  // Some keywords are treated as regular operators. `in` sometimes
  // (when parsing `for`) needs to be tested against specifically, so
  // we assign a variable name to it for quick comparing.
  // 'prec' is the operator precedence'

  var _or = { keyword: "or", prec: 1, beforeExpr: true, rep: "||" };
  var _and = { keyword: "and", prec: 2, beforeExpr: true, rep: "&&" };
  var _not = { keyword: "not", prec: 3, prefix: true, beforeExpr: true, rep: "!" };
  var _in = { keyword: "in", prec: 4, beforeExpr: true };
  var _is = { keyword: "is", prec: 4, beforeExpr: true };

  // Map keyword names to token types.

  var keywordTypes = {
    "dict": _dict,
    "False": _false, "None": _none, "True": _true, "and": _and, "as": _as, 
    "break": _break, "class": _class, "continue": _continue, "def": _def, "del": _del,
    "elif": _elif, "else": _else, "except": _except, "finally": _finally, "for": _for,
    "from": _from, "global": _global, "if": _if, "import": _import, "in": _in, "is": _is, 
    "lambda": _lambda, "nonlocal": _nonlocal, "not": _not, "or": _or, 
    "pass": _pass, "raise": _raise, "return": _return, "try": _try, "while": _while, 
    "with": _with, "yield": _yield
  };

  // Punctuation token types. Again, the `type` property is purely for debugging.

  var _bracketL = {type: "[", beforeExpr: true}, _bracketR = {type: "]"}, _braceL = {type: "{", beforeExpr: true};
  var _braceR = {type: "}"}, _parenL = {type: "(", beforeExpr: true}, _parenR = {type: ")"};
  var _comma = {type: ",", beforeExpr: true}, _semi = {type: ";", beforeExpr: true};
  var _colon = { type: ":", beforeExpr: true }, _dot = { type: "." }, _question = { type: "?", beforeExpr: true };
  
  // Operators. These carry several kinds of properties to help the
  // parser use them properly (the presence of these properties is
  // what categorizes them as operators).
  //
  // `prec` specifies the precedence of this operator.
  //
  // `prefix` marks the operator as a prefix unary operator. 
  //
  // `isAssign` marks all of `=`, `+=`, `-=` etcetera, which act as
  // binary operators with a very low precedence, that should result
  // in AssignmentExpression nodes.

  var _slash = { prec: 10, beforeExpr: true }, _eq = { isAssign: true, beforeExpr: true };
  var _assign = {isAssign: true, beforeExpr: true};
  var _equality = { prec: 4, beforeExpr: true };
  var _relational = {prec: 4, beforeExpr: true };
  var _bitwiseOR = { prec: 5, beforeExpr: true };
  var _bitwiseXOR = { prec: 6, beforeExpr: true };
  var _bitwiseAND = { prec: 7, beforeExpr: true };
  var _bitShift = { prec: 8, beforeExpr: true };
  var _plusMin = { prec: 9, beforeExpr: true };
  var _multiplyModulo = { prec: 10, beforeExpr: true };
  var _floorDiv = { prec: 10, beforeExpr: true };
  var _posNegNot = { prec: 11, prefix: true, beforeExpr: true };
  var _bitwiseNOT = { prec: 11, prefix: true, beforeExpr: true };
  var _exponentiation = { prec: 12, beforeExpr: true };

  // Provide access to the token types for external users of the
  // tokenizer.

  exports.tokTypes = {bracketL: _bracketL, bracketR: _bracketR, braceL: _braceL, braceR: _braceR,
                      parenL: _parenL, parenR: _parenR, comma: _comma, semi: _semi, colon: _colon,
                      dot: _dot, question: _question, slash: _slash, eq: _eq, name: _name, eof: _eof,
                      num: _num, regexp: _regexp, string: _string,
                      newline: _newline, indent: _indent, dedent: _dedent,
                      exponentiation: _exponentiation, floorDiv: _floorDiv, plusMin: _plusMin,
                      posNegNot: _posNegNot, multiplyModulo: _multiplyModulo
  };
  for (var kw in keywordTypes) exports.tokTypes["_" + kw] = keywordTypes[kw];

  // This is a trick taken from Esprima. It turns out that, on
  // non-Chrome browsers, to check whether a string is in a set, a
  // predicate containing a big ugly `switch` statement is faster than
  // a regular expression, and on Chrome the two are about on par.
  // This function uses `eval` (non-lexical) to produce such a
  // predicate from a space-separated string of words.
  //
  // It starts by sorting the words by length.

  function makePredicate(words) {
    words = words.split(" ");
    var f = "", cats = [];
    out: for (var i = 0; i < words.length; ++i) {
      for (var j = 0; j < cats.length; ++j)
        if (cats[j][0].length == words[i].length) {
          cats[j].push(words[i]);
          continue out;
        }
      cats.push([words[i]]);
    }
    function compareTo(arr) {
      if (arr.length == 1) return f += "return str === " + JSON.stringify(arr[0]) + ";";
      f += "switch(str){";
      for (var i = 0; i < arr.length; ++i) f += "case " + JSON.stringify(arr[i]) + ":";
      f += "return true}return false;";
    }

    // When there are more than three length categories, an outer
    // switch first dispatches on the lengths, to save on comparisons.

    if (cats.length > 3) {
      cats.sort(function(a, b) {return b.length - a.length;});
      f += "switch(str.length){";
      for (var i = 0; i < cats.length; ++i) {
        var cat = cats[i];
        f += "case " + cat[0].length + ":";
        compareTo(cat);
      }
      f += "}";

      // Otherwise, simply generate a flat `switch` statement.

    } else {
      compareTo(words);
    }
    return new Function("str", f);
  }

  // The forbidden variable names

  var isStrictBadIdWord = makePredicate("eval arguments");

  // Keywords
  // TODO: dict isn't a keyword, it's a builtin

  var isKeyword = makePredicate("dict False None True and as assert break class continue def del elif else except finally for from global if import in is lambda nonlocal not or pass raise return try while with yield");

  // ## Character categories

  // Big ugly regular expressions that match characters in the
  // whitespace, identifier, and identifier-start categories. These
  // are only applied when a character is found to actually have a
  // code point above 128.

  var nonASCIIwhitespace = /[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/;
  var nonASCIIidentifierStartChars = "\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc";
  var nonASCIIidentifierChars = "\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u0620-\u0649\u0672-\u06d3\u06e7-\u06e8\u06fb-\u06fc\u0730-\u074a\u0800-\u0814\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0840-\u0857\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962-\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09d7\u09df-\u09e0\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5f-\u0b60\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62-\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2-\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d46-\u0d48\u0d57\u0d62-\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e34-\u0e3a\u0e40-\u0e45\u0e50-\u0e59\u0eb4-\u0eb9\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f41-\u0f47\u0f71-\u0f84\u0f86-\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1029\u1040-\u1049\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u170e-\u1710\u1720-\u1730\u1740-\u1750\u1772\u1773\u1780-\u17b2\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1920-\u192b\u1930-\u193b\u1951-\u196d\u19b0-\u19c0\u19c8-\u19c9\u19d0-\u19d9\u1a00-\u1a15\u1a20-\u1a53\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b46-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1bb0-\u1bb9\u1be6-\u1bf3\u1c00-\u1c22\u1c40-\u1c49\u1c5b-\u1c7d\u1cd0-\u1cd2\u1d00-\u1dbe\u1e01-\u1f15\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2d81-\u2d96\u2de0-\u2dff\u3021-\u3028\u3099\u309a\ua640-\ua66d\ua674-\ua67d\ua69f\ua6f0-\ua6f1\ua7f8-\ua800\ua806\ua80b\ua823-\ua827\ua880-\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8f3-\ua8f7\ua900-\ua909\ua926-\ua92d\ua930-\ua945\ua980-\ua983\ua9b3-\ua9c0\uaa00-\uaa27\uaa40-\uaa41\uaa4c-\uaa4d\uaa50-\uaa59\uaa7b\uaae0-\uaae9\uaaf2-\uaaf3\uabc0-\uabe1\uabec\uabed\uabf0-\uabf9\ufb20-\ufb28\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f";
  var nonASCIIidentifierStart = new RegExp("[" + nonASCIIidentifierStartChars + "]");
  var nonASCIIidentifier = new RegExp("[" + nonASCIIidentifierStartChars + nonASCIIidentifierChars + "]");

  // Whether a single character denotes a newline.

  var newline = /[\n\r\u2028\u2029]/;

  // Matches a whole line break (where CRLF is considered a single
  // line break). Used to count lines.

  var lineBreak = /\r\n|[\n\r\u2028\u2029]/g;

  // Test whether a given character code starts an identifier.

  var isIdentifierStart = exports.isIdentifierStart = function(code) {
    if (code < 65) return code === 36;
    if (code < 91) return true;
    if (code < 97) return code === 95;
    if (code < 123)return true;
    return code >= 0xaa && nonASCIIidentifierStart.test(String.fromCharCode(code));
  };

  // Test whether a given character is part of an identifier.

  var isIdentifierChar = exports.isIdentifierChar = function(code) {
    if (code < 48) return code === 36;
    if (code < 58) return true;
    if (code < 65) return false;
    if (code < 91) return true;
    if (code < 97) return code === 95;
    if (code < 123)return true;
    return code >= 0xaa && nonASCIIidentifier.test(String.fromCharCode(code));
  };

  // ## Tokenizer

  // These are used when `options.locations` is on, for the
  // `tokStartLoc` and `tokEndLoc` properties.

  function Position() {
    this.line = tokCurLine;
    this.column = tokPos - tokLineStart;
  }

  // Reset the token state. Used at the start of a parse.

  function initTokenState() {
    tokCurLine = 1;
    tokPos = tokLineStart = 0;
    tokRegexpAllowed = true;
    indentHist.init();
    newAstIdCount = 0;
    scope.init();
  }

  // Called at the end of every token. Sets `tokEnd`, `tokVal`, and
  // `tokRegexpAllowed`, and skips the space after the token, so that
  // the next one's `tokStart` will point at the right position.

  function finishToken(type, val) {
    tokEnd = tokPos;
    if (options.locations) tokEndLoc = new Position;
    tokType = type;
    if (type === _parenL || type === _braceL || type === _bracketL) ++bracketNesting;
    if (type === _parenR || type === _braceR || type === _bracketR) --bracketNesting;
    if (type !== _newline) skipSpace();
    tokVal = val;
    tokRegexpAllowed = type.beforeExpr;
  }

  function skipLine() {
    var ch = input.charCodeAt(++tokPos);
    while (tokPos < inputLen && !isNewline(ch)) {
      ++tokPos;
      ch = input.charCodeAt(tokPos);
    }
  }

  function skipLineComment() {
    var start = tokPos;
    var startLoc = options.onComment && options.locations && new Position;
    skipLine();
    if (options.onComment)
      options.onComment(input.slice(start + 1, tokPos), start, tokPos,
                        startLoc, options.locations && new Position);
  }

  // Called at the start of the parse and after every token. Skips
  // whitespace and comments, and.

  function skipSpace() {
    while (tokPos < inputLen) {
      var ch = input.charCodeAt(tokPos);
      if (ch === 35) skipLineComment();
      else if (ch === 92) {
        ++tokPos;
        if (isNewline(input.charCodeAt(tokPos))) {
          if (input.charCodeAt(tokPos) === 13 && input.charCodeAt(tokPos+1) === 10) ++tokPos;
          ++tokPos;
          if (options.location) { tokLineStart = tokPos; ++tokCurLine; }
        } else {
          raise(tokPos, "Unexpected character after line continuation character");
        }
      }
      else if (isSpace(ch)) ++tokPos;
      else if (bracketNesting > 0 && isNewline(ch)) {
        if (ch === 13 && input.charCodeAt(tokPos+1) === 10) ++tokPos;
        ++tokPos;
        if (options.location) { tokLineStart = tokPos; ++tokCurLine; }
      }
      else break;
    }
  }

  function isSpace(ch) {
    if (ch === 32 || // ' '
      ch === 9 || ch === 11 || ch === 12 ||
      ch === 160 || // '\xa0'
      ch >= 5760 && nonASCIIwhitespace.test(String.fromCharCode(ch))) {
      return true;
    }
    return false;
  }

  function isNewline(ch) {
    if (ch === 10 || ch === 13 ||
      ch === 8232 || ch === 8233) {
      return true;
    }
    return false;
  }

  // ### Token reading

  // This is the function that is called to fetch the next token. It
  // is somewhat obscure, because it works in character codes rather
  // than characters, and because operator parsing has been inlined
  // into it.
  //
  // All in the name of speed.
  //
  // The `forceRegexp` parameter is used in the one case where the
  // `tokRegexpAllowed` trick does not work. See `parseStatement`.

  function readToken_dot() {
    var next = input.charCodeAt(tokPos + 1);
    if (next >= 48 && next <= 57) return readNumber(true);
    ++tokPos;
    return finishToken(_dot);
  }

  function readToken_slash() { // '/'
    if (tokRegexpAllowed) { ++tokPos; return readRegexp(); }
    var next = input.charCodeAt(tokPos + 1);
    if (next === 47) return finishOp(_floorDiv, 2);
    if (next === 61) return finishOp(_assign, 2);
    return finishOp(_slash, 1);
  }

  function readToken_mult_modulo(code) { // '*%'
    var next = input.charCodeAt(tokPos + 1);
    if (next === 42 && next === code) return finishOp(_exponentiation, 2);
    if (next === 61) return finishOp(_assign, 2);
    return finishOp(_multiplyModulo, 1);
  }
  
  function readToken_pipe_amp(code) { // '|&'
    var next = input.charCodeAt(tokPos + 1);
    if (next === 61) return finishOp(_assign, 2);
    return finishOp(code === 124 ? _bitwiseOR : _bitwiseAND, 1);
  }

  function readToken_caret() { // '^'
    var next = input.charCodeAt(tokPos + 1);
    if (next === 61) return finishOp(_assign, 2);
    return finishOp(_bitwiseXOR, 1);
  }

  function readToken_plus_min(code) { // '+-'
    var next = input.charCodeAt(tokPos + 1);
    if (next === 61) return finishOp(_assign, 2);
    return finishOp(_plusMin, 1);
  }

  function readToken_lt_gt(code) { // '<>'
    var next = input.charCodeAt(tokPos + 1);
    var size = 1;
    if (next === code) {
      size = 2;
      if (input.charCodeAt(tokPos + size) === 61) return finishOp(_assign, size + 1);
      return finishOp(_bitShift, size);
    }
    if (next === 61) size = 2;
    return finishOp(_relational, size);
  }

  function readToken_eq_excl(code) { // '=!'
    var next = input.charCodeAt(tokPos + 1);
    if (next === 61) return finishOp(_equality, 2);
    return finishOp(_eq, 1);
  }

  // Parse indentation
  // Possible output: _indent, _dedent, _eof, readToken()
  // TODO: disallow unequal indents of same length (e.g. nested if/else block)

  function readToken_indent() {
    // Read indent, skip empty lines and comments
    var indent = "";
    var indentPos = tokPos;
    var ch, next;
    while (indentPos < inputLen) {
      ch = input.charCodeAt(indentPos);
      if (isSpace(ch)) {
        indent += String.fromCharCode(ch);
        ++indentPos;
      } else if (isNewline(ch)) { // newline
        indent = "";
        if (ch === 13 && input.charCodeAt(indentPos + 1) === 10) ++indentPos;
        ++indentPos;
        tokPos = indentPos;
        if (options.locations) {
          tokLineStart = indentPos;
          ++tokCurLine;
        }
      } else if (ch === 35) { // '#'
        do {
          next = input.charCodeAt(++indentPos);
        } while (indentPos < inputLen && next !== 10);
        // TODO: call onComment
      } else {
        break;
      }
    }

    // Determine token type based on indent found versus indentation history
    var type;
    if (indent.length > 0) {
      if (indentHist.isIndent(indent)) {
        type = _indent;
        if (indentHist.count() >= 1) tokStart += indentHist.len(indentHist.count() - 1);
        indentHist.addIndent(indent);
      } else if (indentHist.isDedent(indent)) {
        type = _dedent;
        indentHist.addDedent(indent);
        var nextDedent = indentHist.count() - indentHist.dedentCount;
        if (nextDedent >= 2) {
          tokStart += indentHist.len(nextDedent) - indentHist.len(nextDedent - 1);
        }
      } else {
        tokPos += indent.length;
      }
    } else if (indentPos >= inputLen) {
      type = _eof;
    } else if (indentHist.count() > 0) {
      type = _dedent;
      indentHist.updateDedent();
    }

    switch (type) {
      case _indent: case _dedent: return finishOp(type, indentPos - ++tokPos);
      case _eof:
        tokPos = inputLen;
        if (options.locations) tokStartLoc = new Position;
        return finishOp(type, 0);
      default:
        tokType = null;
        return readToken();
    }
  }

  function getTokenFromCode(code) {
    switch(code) {

    case 13: case 10: case 8232: case 8233:
      ++tokPos;
      if (code === 13 && input.charCodeAt(tokPos) === 10) ++tokPos;
      if (options.locations) {
        ++tokCurLine;
        tokLineStart = tokPos;
      }
      return finishToken(_newline);

    case 35: // '#'
      skipLineComment();
      return readToken();

      // The interpretation of a dot depends on whether it is followed
      // by a digit.
    case 46: // '.'
      return readToken_dot();

      // Punctuation tokens.
    case 40: ++tokPos; return finishToken(_parenL);
    case 41: ++tokPos; return finishToken(_parenR);
    case 59: ++tokPos; return finishToken(_semi);
    case 44: ++tokPos; return finishToken(_comma);
    case 91: ++tokPos; return finishToken(_bracketL);
    case 93: ++tokPos; return finishToken(_bracketR);
    case 123: ++tokPos; return finishToken(_braceL);
    case 125: ++tokPos; return finishToken(_braceR);
    case 58: ++tokPos; return finishToken(_colon);
    case 63: ++tokPos; return finishToken(_question);

      // '0x' is a hexadecimal number.
    case 48: // '0'
      var next = input.charCodeAt(tokPos + 1);
      if (next === 120 || next === 88) return readHexNumber();
      // Anything else beginning with a digit is an integer, octal
      // number, or float.
    case 49: case 50: case 51: case 52: case 53: case 54: case 55: case 56: case 57: // 1-9
      return readNumber(false);

      // Quotes produce strings.
    case 34: case 39: // '"', "'"
      return readString(code);

    // Operators are parsed inline in tiny state machines. '=' (61) is
    // often referred to. `finishOp` simply skips the amount of
    // characters it is given as second argument, and returns a token
    // of the type given by its first argument.

    case 47: // '/'
      return readToken_slash(code);

    case 42: case 37: // '*%'
      return readToken_mult_modulo(code);

    case 124: case 38: // '|&'
      return readToken_pipe_amp(code);

    case 94: // '^'
      return readToken_caret();

    case 43: case 45: // '+-'
      return readToken_plus_min(code);

    case 60: case 62: // '<>'
      return readToken_lt_gt(code);

    case 61: case 33: // '=!'
      return readToken_eq_excl(code);

    case 126: // '~'
      return finishOp(_bitwiseNOT, 1);
    }

    return false;
  }

  function readToken(forceRegexp) {
    if (tokType === _dedent) {
      indentHist.pop();
      if (indentHist.dedentCount > 0) return;
    }

    if (!forceRegexp) tokStart = tokPos;
    else tokPos = tokStart + 1;
    if (options.locations) tokStartLoc = new Position;
    if (forceRegexp) return readRegexp();
    if (tokPos >= inputLen) return finishToken(_eof);
    if (tokType === _newline) return readToken_indent();

    var code = input.charCodeAt(tokPos);
    // Identifier or keyword. '\uXXXX' sequences are allowed in
    // identifiers, so '\' also dispatches to that.
    if (isIdentifierStart(code) || code === 92 /* '\' */) return readWord();

    var tok = getTokenFromCode(code);

    if (tok === false) {
      // If we are here, we either found a non-ASCII identifier
      // character, or something that's entirely disallowed.
      var ch = String.fromCharCode(code);
      if (ch === "\\" || nonASCIIidentifierStart.test(ch)) return readWord();
      raise(tokPos, "Unexpected character '" + ch + "'");
    }
    return tok;
  }

  function finishOp(type, size) {
    var str = input.slice(tokPos, tokPos + size);
    tokPos += size;
    finishToken(type, str);
  }

  // Parse a regular expression. Some context-awareness is necessary,
  // since a '/' inside a '[]' set does not end the expression.

  function readRegexp() {
    var content = "", escaped, inClass, start = tokPos, value;
    for (;;) {
      if (tokPos >= inputLen) raise(start, "Unterminated regular expression");
      var ch = input.charAt(tokPos);
      if (newline.test(ch)) raise(start, "Unterminated regular expression");
      if (!escaped) {
        if (ch === "[") inClass = true;
        else if (ch === "]" && inClass) inClass = false;
        else if (ch === "/" && !inClass) break;
        escaped = ch === "\\";
      } else escaped = false;
      ++tokPos;
    }
    content = input.slice(start, tokPos);
    ++tokPos;
    // Need to use `readWord1` because '\uXXXX' sequences are allowed
    // here (don't ask).
    var mods = readWord1();
    if (mods && !/^[gmsiy]*$/.test(mods)) raise(start, "Invalid regular expression flag");
    try {
      value = new RegExp(content, mods);
    } catch (e) {
      if (e instanceof SyntaxError) raise(start, "Error parsing regular expression: " + e.message);
      raise(e);
    }
    return finishToken(_regexp, value);
  }

  // Read an integer in the given radix. Return null if zero digits
  // were read, the integer value otherwise. When `len` is given, this
  // will return `null` unless the integer has exactly `len` digits.

  function readInt(radix, len) {
    var start = tokPos, total = 0;
    for (var i = 0, e = len == null ? Infinity : len; i < e; ++i) {
      var code = input.charCodeAt(tokPos), val;
      if (code >= 97) val = code - 97 + 10; // a
      else if (code >= 65) val = code - 65 + 10; // A
      else if (code >= 48 && code <= 57) val = code - 48; // 0-9
      else val = Infinity;
      if (val >= radix) break;
      ++tokPos;
      total = total * radix + val;
    }
    if (tokPos === start || len != null && tokPos - start !== len) return null;

    return total;
  }

  function readHexNumber() {
    tokPos += 2; // 0x
    var val = readInt(16);
    if (val == null) raise(tokStart + 2, "Expected hexadecimal number");
    if (isIdentifierStart(input.charCodeAt(tokPos))) raise(tokPos, "Identifier directly after number");
    return finishToken(_num, val);
  }

  // Read an integer, octal integer, or floating-point number.

  function readNumber(startsWithDot) {
    var start = tokPos, isFloat = false, octal = input.charCodeAt(tokPos) === 48;
    if (!startsWithDot && readInt(10) === null) raise(start, "Invalid number");
    if (input.charCodeAt(tokPos) === 46) {
      ++tokPos;
      readInt(10);
      isFloat = true;
    }
    var next = input.charCodeAt(tokPos);
    if (next === 69 || next === 101) { // 'eE'
      next = input.charCodeAt(++tokPos);
      if (next === 43 || next === 45) ++tokPos; // '+-'
      if (readInt(10) === null) raise(start, "Invalid number");
      isFloat = true;
    }
    if (isIdentifierStart(input.charCodeAt(tokPos))) raise(tokPos, "Identifier directly after number");

    var str = input.slice(start, tokPos), val;
    if (isFloat) val = parseFloat(str);
    else if (!octal || str.length === 1) val = parseInt(str, 10);
    else if (/[89]/.test(str) || strict) raise(start, "Invalid number");
    else val = parseInt(str, 8);
    return finishToken(_num, val);
  }

  // Read a string value, interpreting backslash-escapes.

  function readString(quote) {
    tokPos++;
    var ch = input.charCodeAt(tokPos);
    var tripleQuoted = false;
    if (ch === quote && input.charCodeAt(tokPos+1) === quote) {
      tripleQuoted = true;
      tokPos += 2;
    }
    var out = "";
    for (;;) {
      if (tokPos >= inputLen) raise(tokStart, "Unterminated string constant");
      var ch = input.charCodeAt(tokPos);
      if (ch === quote) {
        if (tripleQuoted) {
          if (input.charCodeAt(tokPos+1) === quote &&
              input.charCodeAt(tokPos+2) === quote) {
            tokPos += 3;
            return finishToken(_string, out);
          }
        } else {
          ++tokPos;
          return finishToken(_string, out);
        }
      }
      if (ch === 92) { // '\'
        ch = input.charCodeAt(++tokPos);
        var octal = /^[0-7]+/.exec(input.slice(tokPos, tokPos + 3));
        if (octal) octal = octal[0];
        while (octal && parseInt(octal, 8) > 255) octal = octal.slice(0, -1);
        if (octal === "0") octal = null;
        ++tokPos;
        if (octal) {
          if (strict) raise(tokPos - 2, "Octal literal in strict mode");
          out += String.fromCharCode(parseInt(octal, 8));
          tokPos += octal.length - 1;
        } else {
          switch (ch) {
          case 110: out += "\n"; break; // 'n' -> '\n'
          case 114: out += "\r"; break; // 'r' -> '\r'
          case 120: out += String.fromCharCode(readHexChar(2)); break; // 'x'
          case 117: out += String.fromCharCode(readHexChar(4)); break; // 'u'
          case 85: // 'U'
            ch = readHexChar(8);
            if (ch < 0xFFFF && (ch < 0xD800 || 0xDBFF < ch)) out += String.fromCharCode(ch); // If it's UTF-16
            else { // If we need UCS-2
              ch -= 0x10000;
              out += String.fromCharCode((ch>>10)+0xd800)+String.fromCharCode((ch%0x400)+0xdc00);
            }
            break;
          case 116: out += "\t"; break; // 't' -> '\t'
          case 98: out += "\b"; break; // 'b' -> '\b'
          case 118: out += "\u000b"; break; // 'v' -> '\u000b'
          case 102: out += "\f"; break; // 'f' -> '\f'
          case 48: out += "\0"; break; // 0 -> '\0'
          case 13: if (input.charCodeAt(tokPos) === 10) ++tokPos; // '\r\n'
          case 10: // ' \n'
            if (options.locations) { tokLineStart = tokPos; ++tokCurLine; }
            break;
          default: out += '\\' + String.fromCharCode(ch); break; // Python doesn't remove slashes on failed escapes
          }
        }
      } else {
        if (isNewline(ch)) {
          if (tripleQuoted) {
            out += String.fromCharCode(ch);
            ++tokPos;
            if (ch === 13 && input.charCodeAt(tokPos) === 10) {
              ++tokPos;
              out += "\n";
            }
            if (options.location) { tokLineStart = tokPos; ++tokCurLine; }
          } else raise(tokStart, "Unterminated string constant");
        } else {
          out += String.fromCharCode(ch); // '\'
          ++tokPos;
        }
      }
    }
  }

  // Used to read character escape sequences ('\x', '\u', '\U').

  function readHexChar(len) {
    var n = readInt(16, len);
    if (n === null) raise(tokStart, "Bad character escape sequence");
    return n;
  }

  // Used to signal to callers of `readWord1` whether the word
  // contained any escape sequences. This is needed because words with
  // escape sequences must not be interpreted as keywords.

  var containsEsc;

  // Read an identifier, and return it as a string. Sets `containsEsc`
  // to whether the word contained a '\u' escape.
  //
  // Only builds up the word character-by-character when it actually
  // containeds an escape, as a micro-optimization.

  function readWord1() {
    containsEsc = false;
    var word, first = true, start = tokPos;
    for (;;) {
      var ch = input.charCodeAt(tokPos);
      if (isIdentifierChar(ch)) {
        if (containsEsc) word += input.charAt(tokPos);
        ++tokPos;
      } else if (ch === 92) { // "\"
        if (!containsEsc) word = input.slice(start, tokPos);
        containsEsc = true;
        if (input.charCodeAt(++tokPos) != 117) // "u"
          raise(tokPos, "Expecting Unicode escape sequence \\uXXXX");
        ++tokPos;
        var esc = readHexChar(4);
        var escStr = String.fromCharCode(esc);
        if (!escStr) raise(tokPos - 1, "Invalid Unicode escape");
        if (!(first ? isIdentifierStart(esc) : isIdentifierChar(esc)))
          raise(tokPos - 4, "Invalid Unicode escape");
        word += escStr;
      } else {
        break;
      }
      first = false;
    }
    return containsEsc ? word : input.slice(start, tokPos);
  }

  // Read an identifier or keyword token. Will check for reserved
  // words when necessary.

  function readWord() {
    var word = readWord1();
    var type = _name;
    if (!containsEsc && isKeyword(word))
      type = keywordTypes[word];
    return finishToken(type, word);
  }

  // ## Parser

  // A recursive descent parser operates by defining functions for all
  // syntactic elements, and recursively calling those, each function
  // advancing the input stream and returning an AST node. Precedence
  // of constructs (for example, the fact that `!x[1]` means `!(x[1])`
  // instead of `(!x)[1]` is handled by the fact that the parser
  // function that parses unary prefix operators is called first, and
  // in turn calls the function that parses `[]` subscripts - that
  // way, it'll receive the node for `x[1]` already parsed, and wraps
  // *that* in the unary operator node.
  //
  // Acorn uses an [operator precedence parser][opp] to handle binary
  // operator precedence, because it is much more compact than using
  // the technique outlined above, which uses different, nesting
  // functions to specify precedence, for all of the ten binary
  // precedence levels that JavaScript defines.
  //
  // [opp]: http://en.wikipedia.org/wiki/Operator-precedence_parser

  // ### Parser utilities

  // Continue to the next token.

  function next() {
    lastStart = tokStart;
    lastEnd = tokEnd;
    lastEndLoc = tokEndLoc;
    readToken();
  }

  // Enter strict mode. Re-reads the next token to please pedantic
  // tests ("use strict"; 010; -- should fail).

  function setStrict(strct) {
    strict = strct;
    tokPos = tokStart;
    if (options.locations) {
      while (tokPos < tokLineStart) {
        tokLineStart = input.lastIndexOf("\n", tokLineStart - 2) + 1;
        --tokCurLine;
      }
    }
    skipSpace();
    readToken();
  }

  // Start an AST node, attaching a start offset.

  function Node() {
    this.type = null;
  }

  exports.Node = Node;

  function SourceLocation() {
    this.start = tokStartLoc;
    this.end = null;
    if (sourceFile !== null) this.source = sourceFile;
  }

  function startNode() {
    var node = new Node();
    if (options.locations)
      node.loc = new SourceLocation();
    if (options.directSourceFile)
      node.sourceFile = options.directSourceFile;
    if (options.ranges)
      node.range = [tokStart, 0];
    return node;
  }

  // Finish an AST node, adding `type` and `end` properties.

  function finishNode(node, type) {
    node.type = type;
    if (options.locations)
      node.loc.end = lastEndLoc;
    if (options.ranges)
      node.range[1] = lastEnd;
    return node;
  }

  // Start a node whose start offset information should be based on
  // the start of another node. For example, a binary operator node is
  // only started after its left-hand side has already been parsed.

  function startNodeFrom(other) {
    var node = new Node();
    if (options.locations) {
      node.loc = new SourceLocation();
      node.loc.start = other.loc.start;
    }
    if (options.ranges)
      node.range = [other.range[0], 0];

    return node;
  }

  // ## Node creation utilities

  var getNodeCreator = exports.getNodeCreator = function(startNode, startNodeFrom, finishNode, unpackTuple) {

    return {

      // Finish a node whose end offset information should be based on
      // the end of another node.  For example, createNode* functions
      // are used to create extra AST nodes which may be based on a single
      // parsed user code node.

      finishNodeFrom: function (endNode, node, type) {
        node.type = type;
        if (options.locations) node.loc.end = endNode.loc.end;
        if (options.ranges) node.range[1] = endNode.range[1];
        return node;
      },

      // Create an AST node using start offsets

      createNodeFrom: function (startNode, type, props) {
        var node = startNodeFrom(startNode);
        for (var prop in props) node[prop] = props[prop];
        return finishNode(node, type);
      },

      // Create an AST node using start and end offsets

      createNodeSpan: function (startNode, endNode, type, props) {
        var node = startNodeFrom(startNode);
        for (var prop in props) node[prop] = props[prop];
        return this.finishNodeFrom(endNode, node, type);
      },

      createGeneratedNodeSpan: function (startNode, endNode, type, props) {
        var node = startNodeFrom(startNode);
        for (var prop in props) node[prop] = props[prop];
        node.userCode = false;
        return this.finishNodeFrom(endNode, node, type);
      },

      // while (__formalsIndex < __params.formals.length) {
      //   <argsId>.push(__params.formals[__formalsIndex++]); }
      createNodeArgsWhileConsequent: function (argsId, s) {
        var __paramsFormals = this.createNodeMembIds(argsId, '__params' + s, 'formals');
        var __formalsIndexId = this.createGeneratedNodeSpan(argsId, argsId, "Identifier", { name: '__formalsIndex' + s });
        return this.createGeneratedNodeSpan(argsId, argsId, "WhileStatement", {
          test: this.createGeneratedNodeSpan(argsId, argsId, "BinaryExpression", {
            operator: '<', left: __formalsIndexId,
            right: this.createGeneratedNodeSpan(argsId, argsId, "MemberExpression", {
              computed: false, object: __paramsFormals,
              property: this.createGeneratedNodeSpan(argsId, argsId, "Identifier", { name: 'length' })
            })
          }),
          body: this.createGeneratedNodeSpan(argsId, argsId, "BlockStatement", {
            body: [this.createGeneratedNodeSpan(argsId, argsId, "ExpressionStatement", {
              expression: this.createGeneratedNodeSpan(argsId, argsId, "CallExpression", {
                callee: this.createNodeMembIds(argsId, argsId.name, 'push'),
                arguments: [this.createGeneratedNodeSpan(argsId, argsId, "MemberExpression", {
                  computed: true, object: __paramsFormals,
                  property: this.createGeneratedNodeSpan(argsId, argsId, "UpdateExpression", {
                    operator: '++', prefix: false, argument: __formalsIndexId
                  })
                })]
              })
            })]
          })
        });
      },

      // { while (__formalsIndex < __args.length) {
      //   <argsId>.push(__args[__formalsIndex++]); }}
      createNodeArgsAlternate: function (argsId, s) {
        var __args = '__args' + s;
        var __formalsIndexId = this.createGeneratedNodeSpan(argsId, argsId, "Identifier", { name: '__formalsIndex' + s });
        return this.createGeneratedNodeSpan(argsId, argsId, "BlockStatement", {
          body: [this.createGeneratedNodeSpan(argsId, argsId, "WhileStatement", {
            test: this.createGeneratedNodeSpan(argsId, argsId, "BinaryExpression", {
              operator: '<', left: __formalsIndexId,
              right: this.createNodeMembIds(argsId, __args, 'length')
            }),
            body: this.createGeneratedNodeSpan(argsId, argsId, "BlockStatement", {
              body: [this.createGeneratedNodeSpan(argsId, argsId, "ExpressionStatement", {
                expression: this.createGeneratedNodeSpan(argsId, argsId, "CallExpression", {
                  callee: this.createNodeMembIds(argsId, argsId.name, 'push'),
                  arguments: [this.createGeneratedNodeSpan(argsId, argsId, "MemberExpression", {
                    computed: true,
                    object: this.createGeneratedNodeSpan(argsId, argsId, "Identifier", { name: __args }),
                    property: this.createGeneratedNodeSpan(argsId, argsId, "UpdateExpression", {
                      operator: '++', prefix: false, argument: __formalsIndexId
                    })
                  })]
                })
              })]
            })
          })]
        });
      },

      // return (function() {<body>}).call(this);
      createNodeFnBodyIife: function (body) {
        var iifeBody = this.createGeneratedNodeSpan(body, body, "FunctionExpression", {
          params: [], defaults: [], body: body, generator: false, expression: false
        });
        var iifeCall = this.createGeneratedNodeSpan(body, body, "CallExpression", {
          callee: this.createGeneratedNodeSpan(body, body, "MemberExpression", {
            computed: false, object: iifeBody,
            property: this.createGeneratedNodeSpan(body, body, "Identifier", { name: 'call' })
          }),
          arguments: [this.createGeneratedNodeSpan(body, body, "ThisExpression")]
        });
        return this.createGeneratedNodeSpan(body, body, "ReturnStatement", { argument: iifeCall });
      },

      // E.g. Math.pow(2, 3)

      createNodeMemberCall: function (node, object, property, args) {
        var objId = this.createNodeFrom(node, "Identifier", { name: object });
        var propId = this.createNodeFrom(node, "Identifier", { name: property });
        var member = this.createNodeFrom(node, "MemberExpression", { object: objId, property: propId, computed: false });
        node.callee = member;
        node.arguments = args;
        return finishNode(node, "CallExpression");
      },

      // o.p
      createNodeMembIds: function(r, o, p) {
        return this.createNodeSpan(r, r, "MemberExpression", {
          computed: false,
          object: this.createNodeSpan(r, r, "Identifier", { name: o }),
          property: this.createNodeSpan(r, r, "Identifier", { name: p })
        })
      },

      // o[p]
      createNodeMembIdLit: function(r, o, p) {
        return this.createNodeSpan(r, r, "MemberExpression", {
          computed: true,
          object: this.createNodeSpan(r, r, "Identifier", { name: o }),
          property: this.createNodeSpan(r, r, "Literal", { value: p })
        })
      },

      // E.g. pyRuntime.ops.add

      createNodeOpsCallee: function (node, fnName) {
        var runtimeId = this.createGeneratedNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
        var opsId = this.createGeneratedNodeSpan(node, node, "Identifier", { name: "ops" });
        var addId = this.createGeneratedNodeSpan(node, node, "Identifier", { name: fnName });
        var opsMember = this.createGeneratedNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: opsId, computed: false });
        return this.createGeneratedNodeSpan(node, node, "MemberExpression", { object: opsMember, property: addId, computed: false });
      },

      // var __params = arguments.length === 1 && arguments[0].formals && arguments[0].keywords ? arguments[0] : null;
      createNodeParamsCheck: function (r, s) {
        var __paramsId = this.createNodeSpan(r, r, "Identifier", { name: '__params' + s });
        var arguments0 = this.createNodeMembIdLit(r, 'arguments', 0);
        var checks = this.createNodeSpan(r, r, "ConditionalExpression", {
          test: this.createNodeSpan(r, r, "LogicalExpression", {
            operator: '&&',
            left: this.createNodeSpan(r, r, "LogicalExpression", {
              operator: '&&',
              left: this.createNodeSpan(r, r, "BinaryExpression", {
                operator: '===',
                left: this.createNodeMembIds(r, 'arguments', 'length'),
                right: this.createNodeSpan(r, r, "Literal", { value: 1 })
              }),
              right: this.createNodeSpan(r, r, "MemberExpression", {
                computed: false, object: arguments0,
                property: this.createNodeSpan(r, r, "Identifier", { name: 'formals' }),
              })
            }),
            right: this.createNodeSpan(r, r, "MemberExpression", {
              computed: false, object: arguments0,
              property: this.createNodeSpan(r, r, "Identifier", { name: 'keywords' }),
            })
          }),
          consequent: arguments0,
          alternate: this.createNodeSpan(r, r, "Literal", { value: null })
        });
        return this.createGeneratedVarDeclFromId(r, __paramsId, checks);
      },

      // function __getParam(v, d) {
      //   var r = d;
      //   if (__params) {
      //     if (__formalsIndex < __params.formals.length) {
      //       r = __params.formals[__formalsIndex++];
      //     } else if (v in __params.keywords) {
      //       r = __params.keywords[v];
      //       delete __params.keywords[v];
      //     }
      //   } else if (__formalsIndex < __args.length) {
      //     r = __args[__formalsIndex++];
      //   }
      //   return r;
      // }
      createNodeGetParamFn: function (r, s) {
        var dId = this.createNodeSpan(r, r, "Identifier", { name: 'd' });
        var vId = this.createNodeSpan(r, r, "Identifier", { name: 'v' });
        var rId = this.createNodeSpan(r, r, "Identifier", { name: 'r' });
        var __formalsIndexId = this.createNodeSpan(r, r, "Identifier", { name: '__formalsIndex' + s });
        var __params = '__params' + s;
        var __getParam = '__getParam' + s;
        var __args = '__args' + s;
        var __paramsFormals = this.createNodeMembIds(r, __params, 'formals');
        var __paramsKeywords = this.createNodeMembIds(r, __params, 'keywords')
        var __paramsKeywordsV = this.createNodeSpan(r, r, "MemberExpression", { computed: true, property: vId, object: __paramsKeywords });
        return this.createGeneratedNodeSpan(r, r, "FunctionDeclaration", {
          id: this.createNodeSpan(r, r, "Identifier", { name: __getParam }),
          params: [vId, dId],
          defaults: [],
          body: this.createNodeSpan(r, r, "BlockStatement", {
            body: [this.createGeneratedVarDeclFromId(r, rId, dId),
              this.createGeneratedNodeSpan(r, r, "IfStatement", {
                test: this.createNodeSpan(r, r, "Identifier", { name: __params }),
                consequent: this.createNodeSpan(r, r, "BlockStatement", {
                  body: [this.createGeneratedNodeSpan(r, r, "IfStatement", {
                    test: this.createNodeSpan(r, r, "BinaryExpression", {
                      operator: '<', left: __formalsIndexId,
                      right: this.createNodeSpan(r, r, "MemberExpression", {
                        computed: false, object: __paramsFormals,
                        property: this.createNodeSpan(r, r, "Identifier", { name: 'length' })
                      })
                    }),
                    consequent: this.createNodeSpan(r, r, "BlockStatement", {
                      body: [this.createGeneratedNodeSpan(r, r, "ExpressionStatement", {
                        expression: this.createGeneratedNodeSpan(r, r, "AssignmentExpression", {
                          operator: '=', left: rId,
                          right: this.createNodeSpan(r, r, "MemberExpression", {
                            computed: true, object: __paramsFormals,
                            property: this.createNodeSpan(r, r, "UpdateExpression", {
                              operator: '++', argument: __formalsIndexId, prefix: false
                            })
                          })
                        })
                      })]
                    }),
                    alternate: this.createGeneratedNodeSpan(r, r, "IfStatement", {
                      test: this.createNodeSpan(r, r, "BinaryExpression", {
                        operator: 'in', left: vId, right: __paramsKeywords,
                      }),
                      consequent: this.createNodeSpan(r, r, "BlockStatement", {
                        body: [this.createGeneratedNodeSpan(r, r, "ExpressionStatement", {
                          expression: this.createGeneratedNodeSpan(r, r, "AssignmentExpression", {
                            operator: '=', left: rId, right: __paramsKeywordsV
                          })
                        }),
                        this.createGeneratedNodeSpan(r, r, "ExpressionStatement", {
                          expression: this.createNodeSpan(r, r, "UnaryExpression", {
                            operator: 'delete', prefix: true, argument: __paramsKeywordsV
                          })
                        })]
                      }),
                      alternate: null
                    })
                  })]
                }),
                alternate: this.createGeneratedNodeSpan(r, r, "IfStatement", {
                  test: this.createGeneratedNodeSpan(r, r, "BinaryExpression", {
                    operator: '<', left: __formalsIndexId,
                    right: this.createNodeMembIds(r, __args, 'length'),
                  }),
                  consequent: this.createGeneratedNodeSpan(r, r, "BlockStatement", {
                    body: [this.createGeneratedNodeSpan(r, r, "ExpressionStatement", {
                      expression: this.createGeneratedNodeSpan(r, r, "AssignmentExpression", {
                        operator: '=', left: rId,
                        right: this.createGeneratedNodeSpan(r, r, "MemberExpression", {
                          computed: true,
                          object: this.createGeneratedNodeSpan(r, r, "Identifier", { name: __args }),
                          property: this.createGeneratedNodeSpan(r, r, "UpdateExpression", {
                            operator: '++', argument: __formalsIndexId, prefix: false
                          })
                        })
                      })
                    })]
                  }),
                  alternate: null
                })
              }),
              this.createGeneratedNodeSpan(r, r, "ReturnStatement", { argument: rId })]
          }),
          rest: null, generator: false, expression: false
        });
      },

      // E.g. pyRuntime.utils.add

      createNodeRuntimeCall: function (r, mod, fn, args) {
        return this.createNodeSpan(r, r, "CallExpression", {
          callee: this.createNodeSpan(r, r, "MemberExpression", {
            computed: false,
            object: this.createNodeMembIds(r, options.runtimeParamName,  mod),
            property: this.createNodeSpan(r, r, "Identifier", { name: fn })
          }),
          arguments: args
        });
      },

      // Used to convert 'id = init' to 'var id = init'

      createVarDeclFromId: function (refNode, id, init) {
        var decl = startNodeFrom(refNode);
        decl.id = id;
        decl.init = init;
        this.finishNodeFrom(refNode, decl, "VariableDeclarator");
        var declDecl = startNodeFrom(refNode);
        declDecl.kind = "var";
        declDecl.declarations = [decl];
        return this.finishNodeFrom(refNode, declDecl, "VariableDeclaration");
      },

      createGeneratedVarDeclFromId: function (refNode, id, init) {
        var decl = startNodeFrom(refNode);
        decl.id = id;
        decl.init = init;
        this.finishNodeFrom(refNode, decl, "VariableDeclarator");
        var declDecl = startNodeFrom(refNode);
        declDecl.kind = "var";
        declDecl.declarations = [decl];
        declDecl.userCode = false;
        return this.finishNodeFrom(refNode, declDecl, "VariableDeclaration");
      },

      createClass: function(container, ctorNode, classParams, classBodyRefNode, classBlock) {
        // Helper to identify class methods which were parsed onto the class prototype

        function getPrototype(stmt) {
          if (stmt.expression && stmt.expression.left && stmt.expression.left.object &&
            stmt.expression.left.object.property && stmt.expression.left.object.property.name === "prototype")
            return stmt.expression.left.property.name;
          return null;
        }

        // Start building class constructor

        var ctorBlock = startNodeFrom(classBlock);
        ctorBlock.body = [];

        // Add parent class constructor call

        if (classParams.length === 1) {
          var objId = this.createNodeSpan(classBodyRefNode, classBodyRefNode, "Identifier", { name: classParams[0].name });
          var propertyId = this.createNodeSpan(classBodyRefNode, classBodyRefNode, "Identifier", { name: "call" });
          var calleeMember = this.createNodeSpan(classBodyRefNode, classBodyRefNode, "MemberExpression", { object: objId, property: propertyId, computed: false });
          var thisExpr = this.createNodeSpan(classBodyRefNode, classBodyRefNode, "ThisExpression");
          var callExpr = this.createNodeSpan(classBodyRefNode, classBodyRefNode, "CallExpression", { callee: calleeMember, arguments: [thisExpr] });
          var superExpr = this.createNodeSpan(classBodyRefNode, classBodyRefNode, "ExpressionStatement", { expression: callExpr });
          ctorBlock.body.push(superExpr);
        }

        // Add non-function statements and contents of special '__init__' method

        for (var i in classBlock.body) {
          var stmt = classBlock.body[i];
          var prototype = getPrototype(stmt);
          if (!prototype) {
            ctorBlock.body.push(stmt);
          }
          else if (prototype === "__init__") {
            for (var j in stmt.expression.right.body.body)
              ctorBlock.body.push(stmt.expression.right.body.body[j]);
            ctorNode.params = stmt.expression.right.params;
          }
        }

        // Finish class constructor

        ctorNode.body = finishNode(ctorBlock, "BlockStatement");
        finishNode(ctorNode, "FunctionDeclaration");
        container.body.push(ctorNode);

        // Add inheritance via 'MyClass.prototype = Object.create(ParentClass.prototype)'

        if (classParams.length === 1) {
          var childClassId = this.createNodeSpan(ctorNode, ctorNode, "Identifier", { name: ctorNode.id.name });
          var childPrototypeId = this.createNodeSpan(ctorNode, ctorNode, "Identifier", { name: "prototype" });
          var childPrototypeMember = this.createNodeSpan(ctorNode, ctorNode, "MemberExpression", { object: childClassId, property: childPrototypeId, computed: false });
          var parentClassId = this.createNodeSpan(ctorNode, ctorNode, "Identifier", { name: classParams[0].name });
          var parentPrototypeId = this.createNodeSpan(ctorNode, ctorNode, "Identifier", { name: "prototype" });
          var parentPrototypeMember = this.createNodeSpan(ctorNode, ctorNode, "MemberExpression", { object: parentClassId, property: parentPrototypeId, computed: false });
          var objClassId = this.createNodeSpan(ctorNode, ctorNode, "Identifier", { name: "Object" });
          var objCreateId = this.createNodeSpan(ctorNode, ctorNode, "Identifier", { name: "create" });
          var objPropertyMember = this.createNodeSpan(ctorNode, ctorNode, "MemberExpression", { object: objClassId, property: objCreateId, computed: false });
          var callExpr = this.createNodeSpan(ctorNode, ctorNode, "CallExpression", { callee: objPropertyMember, arguments: [parentPrototypeMember] });
          var assignExpr = this.createNodeSpan(ctorNode, ctorNode, "AssignmentExpression", { left: childPrototypeMember, operator: "=", right: callExpr });
          var inheritanceExpr = this.createNodeSpan(ctorNode, ctorNode, "ExpressionStatement", { expression: assignExpr });
          container.body.push(inheritanceExpr);
        }

        // Add class methods, which are already prototype assignments

        for (var i in classBlock.body) {
          var stmt = classBlock.body[i];
          var prototype = getPrototype(stmt);
          if (prototype && prototype !== "__init__")
            container.body.push(stmt);
        }

        return finishNode(container, "BlockStatement");
      },

      // Create for loop
      // 
      // Problem:
      // 1. JavaScript for/in loop iterates on properties, which are the indexes for an Array
      //    Python iterates on the list items themselves, not indexes
      // 2. JavaScript for/in does not necessarily iterate in order
      // Solution:
      // Generate extra AST to do the right thing at runtime
      // JavaScript for/in is used for dictionaries
      // If iterating through an ordered sequence, return something like: 
      // { var __right = right; 
      //    if (__right instanceof Array) { 
      //      for(var __index=0; __index < __right.length; __index++) {
      //        i = __right[__index]; 
      //        ...
      //      } 
      //    } else { 
      //      for(i in __right){...} 
      //    }
      // }
      // When the loop target is a Tuple, it is unpacked into each for body in the example above.
      // E.g. 'for k, v in __right: total += v' becomes:
      // for (var __tmp in __right) {
      //    k = __tmp[0];
      //    v = __tmp[1];
      //    total += v;
      // }

      // TODO: for/in on a string should go through items, not indexes. String obj and string literal.

      createFor: function (node, init, tupleArgs, right, body) {
        var forOrderedBody = body;
        var forInBody = JSON.parse(JSON.stringify(forOrderedBody));

        var tmpVarSuffix = newAstIdCount++;

        var arrayId = this.createNodeSpan(node, node, "Identifier", { name: "Array" });
        var lengthId = this.createNodeSpan(init, init, "Identifier", { name: "length" });
        var zeroLit = this.createNodeSpan(init, init, "Literal", { value: 0 });

        // var __rightN = right

        var rightId = this.createNodeSpan(right, right, "Identifier", { name: "__filbertRight" + tmpVarSuffix });
        var rightAssign = this.createVarDeclFromId(right, rightId, right);

        // for(;;) and for(in) loops

        var forRightId = this.createNodeSpan(init, init, "Identifier", { name: "__filbertRight" + tmpVarSuffix });

        // for (var __indexN; __indexN < __rightN.length; ++__indexN)

        var forOrderedIndexId = this.createNodeSpan(init, init, "Identifier", { name: "__filbertIndex" + tmpVarSuffix });
        var forOrderedIndexDeclr = this.createNodeSpan(init, init, "VariableDeclarator", { id: forOrderedIndexId, init: zeroLit });
        var forOrderedIndexDecln = this.createNodeSpan(init, init, "VariableDeclaration", { declarations: [forOrderedIndexDeclr], kind: "var" });
        var forOrderedTestMember = this.createNodeSpan(init, init, "MemberExpression", { object: forRightId, property: lengthId, computed: false });
        var forOrderedTestBinop = this.createNodeSpan(init, init, "BinaryExpression", { left: forOrderedIndexId, operator: "<", right: forOrderedTestMember });
        var forOrderedUpdate = this.createNodeSpan(init, init, "UpdateExpression", { operator: "++", prefix: true, argument: forOrderedIndexId });
        var forOrderedMember = this.createNodeSpan(init, init, "MemberExpression", { object: forRightId, property: forOrderedIndexId, computed: true });

        if (tupleArgs) {
          var varStmts = unpackTuple(tupleArgs, forOrderedMember);
          for (var i = varStmts.length - 1; i >= 0; i--) forOrderedBody.body.unshift(varStmts[i]);
        }
        else {
          if (init.type === "Identifier" && !scope.exists(init.name)) {
            scope.addVar(init.name);
            forOrderedBody.body.unshift(this.createVarDeclFromId(init, init, forOrderedMember));
          } else {
            var forOrderedInit = this.createNodeSpan(init, init, "AssignmentExpression", { operator: "=", left: init, right: forOrderedMember });
            var forOrderedInitStmt = this.createNodeSpan(init, init, "ExpressionStatement", { expression: forOrderedInit });
            forOrderedBody.body.unshift(forOrderedInitStmt);
          }
        }

        var forOrdered = this.createNodeSpan(node, node, "ForStatement", { init: forOrderedIndexDecln, test: forOrderedTestBinop, update: forOrderedUpdate, body: forOrderedBody });
        var forOrderedBlock = this.createNodeSpan(node, node, "BlockStatement", { body: [forOrdered] });

        // for (init in __rightN)

        var forInLeft = init;
        if (tupleArgs) {
          var varStmts = unpackTuple(tupleArgs, right);
          forInLeft = varStmts[0];
          for (var i = varStmts.length - 1; i > 0; i--) forInBody.body.unshift(varStmts[i]);
        }
        else if (init.type === "Identifier" && !scope.exists(init.name)) {
          scope.addVar(init.name);
          forInLeft = this.createVarDeclFromId(init, init, null);
        }
        var forIn = this.createNodeSpan(node, node, "ForInStatement", { left: forInLeft, right: forRightId, body: forInBody });
        var forInBlock = this.createNodeSpan(node, node, "BlockStatement", { body: [forIn] });

        // if ordered sequence then forOrdered else forIn

        var ifRightId = this.createNodeSpan(node, node, "Identifier", { name: "__filbertRight" + tmpVarSuffix });
        var ifTest = this.createNodeSpan(node, node, "BinaryExpression", { left: ifRightId, operator: "instanceof", right: arrayId });
        var ifStmt = this.createNodeSpan(node, node, "IfStatement", { test: ifTest, consequent: forOrderedBlock, alternate: forInBlock });

        node.body = [rightAssign, ifStmt];

        return node;
      },

      // expr => __tmpList.push(expr);

      createListCompPush: function (expr, tmpVarSuffix) {
        var exprPushTmpListId = this.createNodeSpan(expr, expr, "Identifier", { name: "__tmpList" + tmpVarSuffix });
        var exprPushId = this.createNodeSpan(expr, expr, "Identifier", { name: "push" });
        var exprMember = this.createNodeSpan(expr, expr, "MemberExpression", { object: exprPushTmpListId, property: exprPushId, computed: false });
        var exprCall = this.createNodeSpan(expr, expr, "CallExpression", { callee: exprMember, arguments: [expr] });
        return this.createNodeSpan(expr, expr, "ExpressionStatement", { expression: exprCall });
      },

      //  (function() {
      //    var _list = [];
      //    ...
      //    body
      //    return _list;
      //  }());

      createListCompIife: function (node, body, tmpVarSuffix) {
        var iifeRuntimeId = this.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
        var iifeObjectsId = this.createNodeSpan(node, node, "Identifier", { name: "objects" });
        var iifeObjMember = this.createNodeSpan(node, node, "MemberExpression", { object: iifeRuntimeId, property: iifeObjectsId, computed: false });
        var iifeListId = this.createNodeSpan(node, node, "Identifier", { name: "list" });
        var iifeListMember = this.createNodeSpan(node, node, "MemberExpression", { object: iifeObjMember, property: iifeListId, computed: false });
        var iifeNewExpr = this.createNodeSpan(node, node, "NewExpression", { callee: iifeListMember, arguments: [] });
        var iifeListId = this.createNodeSpan(node, node, "Identifier", { name: "__tmpList" + tmpVarSuffix });
        var iifeListDecl = this.createVarDeclFromId(node, iifeListId, iifeNewExpr);

        var iifeReturnListId = this.createNodeSpan(node, node, "Identifier", { name: "__tmpList" + tmpVarSuffix });
        var iifeReturn = this.createNodeSpan(node, node, "ReturnStatement", { argument: iifeReturnListId });

        var iifeBlock = this.createNodeSpan(node, node, "BlockStatement", { body: [iifeListDecl, body, iifeReturn] });
        var fnExpr = this.createNodeSpan(node, node, "FunctionExpression", { params: [], defaults: [], body: iifeBlock, generator: false, expression: false });

        return this.createNodeSpan(node, node, "CallExpression", { callee: fnExpr, arguments: [] });
      }
    };
  };

  // Predicate that tests whether the next token is of the given
  // type, and if yes, consumes it as a side effect.

  function eat(type) {
    if (tokType === type) {
      next();
      return true;
    }
  }

  // Expect a token of a given type. If found, consume it, otherwise,
  // raise an unexpected token error.

  function expect(type) {
    if (tokType === type) next();
    else unexpected();
  }

  // Raise an unexpected token error.

  function unexpected() {
    raise(tokStart, "Unexpected token");
  }

  // Verify that a node is an lval - something that can be assigned
  // to.

  function checkLVal(expr) {
    if (expr.type !== "Identifier" && expr.type !== "MemberExpression")
      raise(expr.start, "Assigning to rvalue");
    if (strict && expr.type === "Identifier" && isStrictBadIdWord(expr.name))
      raise(expr.start, "Assigning to " + expr.name + " in strict mode");
  }

  // Get args for a new tuple expression

  function getTupleArgs(expr) {
    if (expr.callee && expr.callee.object && expr.callee.object.object &&
      expr.callee.object.object.name === options.runtimeParamName &&
      expr.callee.property && expr.callee.property.name === "tuple")
      return expr.arguments;
    return null;
  }

  // Unpack an lvalue tuple into indivual variable assignments
  // 'arg0, arg1 = right' becomes:
  // var tmp = right
  // arg0 = tmp[0]
  // arg1 = tmp[1]
  // ...

  function unpackTuple(tupleArgs, right) {
    if (!tupleArgs || tupleArgs.length < 1) unexpected();

    var varStmts = [];

    // var tmp = right

    var tmpId = nc.createNodeSpan(right, right, "Identifier", { name: "__filbertTmp" + newAstIdCount++ });
    var tmpDecl = nc.createVarDeclFromId(right, tmpId, right);
    varStmts.push(tmpDecl);

    // argN = tmp[N]

    for (var i = 0; i < tupleArgs.length; i++) {
      var lval = tupleArgs[i];
      var subTupleArgs = getTupleArgs(lval);
      if (subTupleArgs) {
        var subLit = nc.createNodeSpan(right, right, "Literal", { value: i });
        var subRight = nc.createNodeSpan(right, right, "MemberExpression", { object: tmpId, property: subLit, computed: true });
        var subStmts = unpackTuple(subTupleArgs, subRight);
        for (var j = 0; j < subStmts.length; j++) varStmts.push(subStmts[j]);
      } else {
        checkLVal(lval);
        var indexId = nc.createNodeSpan(right, right, "Literal", { value: i });
        var init = nc.createNodeSpan(right, right, "MemberExpression", { object: tmpId, property: indexId, computed: true });
        if (lval.type === "Identifier" && !scope.exists(lval.name)) {
          scope.addVar(lval.name);
          var varDecl = nc.createVarDeclFromId(lval, lval, init);
          varStmts.push(varDecl);
        }
        else {
          var node = startNodeFrom(lval);
          node.left = lval;
          node.operator = "=";
          node.right = init;
          finishNode(node, "AssignmentExpression");
          varStmts.push(nc.createNodeFrom(node, "ExpressionStatement", { expression: node }));
        }
      }
    }

    return varStmts;
  }

  // ### Statement parsing

  // Parse a program. Initializes the parser, reads any number of
  // statements, and wraps them in a Program node.  Optionally takes a
  // `program` argument.  If present, the statements will be appended
  // to its body instead of creating a new node.

  function parseTopLevel(program) {
    lastStart = lastEnd = tokPos;
    if (options.locations) lastEndLoc = new Position;
    inFunction = strict = null;
    bracketNesting = 0;
    readToken();
    var node = program || startNode();
    if (!program) node.body = [];
    while (tokType !== _eof) {
      var stmt = parseStatement();
      if (stmt) node.body.push(stmt);
    }
    return finishNode(node, "Program");
  }

  // Parse a single statement.
  //
  // If expecting a statement and finding a slash operator, parse a
  // regular expression literal. This is to handle cases like
  // `if (foo) /blah/.exec(foo);`, where looking at the previous token
  // does not help.

  function parseStatement() {
    if (tokType === _slash || tokType === _assign && tokVal == "/=")
      readToken(true);

    var starttype = tokType, node = startNode();

    // Most types of statements are recognized by the keyword they
    // start with. Many are trivial to parse, some require a bit of
    // complexity.

    switch (starttype) {

    case _break:
      next();
      return finishNode(node, "BreakStatement");

    case _continue:
      next();
      return finishNode(node, "ContinueStatement");

    case _class:
      next();
      return parseClass(node);

    case _def:
      next();
      return parseFunction(node);

    case _for:
      next();
      return parseFor(node);

    case _from: // Skipping from and import statements for now
      skipLine();
      next();
      return parseStatement();

    case _if: case _elif:
      next();
      if (tokType === _parenL) node.test = parseParenExpression();
      else node.test = parseExpression();
      expect(_colon);
      node.consequent = parseSuite();
      if (tokType === _elif)
        node.alternate = parseStatement();
      else
        node.alternate = eat(_else) && eat(_colon) ? parseSuite() : null;
      return finishNode(node, "IfStatement");

    case _import: // Skipping from and import statements for now
      skipLine();
      next();
      return parseStatement();

    case _newline:
      // TODO: parseStatement() should probably eat it's own newline
      next();
      return null;

    case _pass:
      next();
      return finishNode(node, "EmptyStatement");

    case _return:
      if (!inFunction && !options.allowReturnOutsideFunction)
        raise(tokStart, "'return' outside of function");
      next();
      if (tokType ===_newline || tokType === _eof) node.argument = null;
      else { node.argument = parseExpression();}
      return finishNode(node, "ReturnStatement");

    case _try: // TODO, and remove parseBlock
      next();
      node.block = parseBlock();
      node.handler = null;
      if (tokType === _catch) {
        var clause = startNode();
        next();
        expect(_parenL);
        clause.param = parseIdent();
        if (strict && isStrictBadIdWord(clause.param.name))
          raise(clause.param.start, "Binding " + clause.param.name + " in strict mode");
        expect(_parenR);
        clause.guard = null;
        clause.body = parseBlock();
        node.handler = finishNode(clause, "CatchClause");
      }
      node.guardedHandlers = empty;
      node.finalizer = eat(_finally) ? parseBlock() : null;
      if (!node.handler && !node.finalizer)
        raise(node.start, "Missing catch or finally clause");
      return finishNode(node, "TryStatement");

    case _while:
      next();
      if (tokType === _parenL) node.test = parseParenExpression();
      else node.test = parseExpression();
      expect(_colon);
      node.body = parseSuite();
      return finishNode(node, "WhileStatement");

    case _with: // TODO
      if (strict) raise(tokStart, "'with' in strict mode");
      next();
      node.object = parseParenExpression();
      node.body = parseStatement();
      return finishNode(node, "WithStatement");

    case _semi:
      next();
      return finishNode(node, "EmptyStatement");

      // Assume it's an ExpressionStatement. If an assign has been 
      // converted to a variable declaration, pass it up as is.

    default:
      var expr = parseExpression();
      if (tokType !== _semi && tokType !== _newline && tokType !== _eof) unexpected();
      if (expr.type === "VariableDeclaration" || expr.type === "BlockStatement") {
        return expr;
      } else {
        node.expression = expr;
        return finishNode(node, "ExpressionStatement");
      }
    }
  }

  // Parse indent-enclosed block of statements

  function parseBlock() {
    var node = startNode();
    node.body = [];
    while (tokType !== _dedent && tokType !== _eof) {
      var stmt = parseStatement();
      if (stmt) node.body.push(stmt);
    }
    if (tokType === _dedent) next();
    return finishNode(node, "BlockStatement");
  }

  // Parse 'suite' from Python grammar spec
  // Will replace parseBlock eventually

  function parseSuite() {
    // NOTE: This is not strictly valid Python for this to be an empty block
    var node = startNode();
    node.body = [];
    if (eat(_newline)) {
      if (tokType === _indent) {
        expect(_indent);
        while (!eat(_dedent) && !eat(_eof)) {
          var stmt = parseStatement();
          if (stmt) node.body.push(stmt);
        }
      }
    } else if (tokType !== _eof) {
      node.body.push(parseStatement());
      next();
    }
    return finishNode(node, "BlockStatement");
  }

  // Parse for/in loop

  function parseFor(node) {
    var init = parseExpression(false, true);
    var tupleArgs = getTupleArgs(init);
    if (!tupleArgs) checkLVal(init);
    expect(_in);
    var right = parseExpression();
    expect(_colon);
    var body = parseSuite();
    finishNode(node, "BlockStatement");
    return nc.createFor(node, init, tupleArgs, right, body);
  }

  // ### Expression parsing

  // These nest, from the most general expression type at the top to
  // 'atomic', nondivisible expression types at the bottom. Most of
  // the functions will simply let the function(s) below them parse,
  // and, *if* the syntactic construct they handle is present, wrap
  // the AST node that the inner parser gave them in another node.

  // Parse a full expression. The arguments are used to forbid comma
  // sequences (in argument lists, array literals, or object literals)
  // or the `in` operator (in for loops initalization expressions).

  function parseExpression(noComma, noIn) {
    return parseMaybeAssign(noIn);
  }

  // Used for constructs like `switch` and `if` that insist on
  // parentheses around their expression.

  function parseParenExpression() {
    expect(_parenL);
    var val = parseExpression();
    expect(_parenR);
    return val;
  }

  // Parse an assignment expression. This includes applications of
  // operators like `+=`.
  // Add 'this.' to assignments in a class constructor.
  // Convert identifier assignment to variable declaration if the
  // identifier doesn't exist in this namespace yet.

  function parseMaybeAssign(noIn) {
    var left = parseMaybeTuple(noIn);
    if (tokType.isAssign) {
      var tupleArgs = getTupleArgs(left);
      if (tupleArgs) {
        next();
        var right = parseMaybeTuple(noIn);
        var blockNode = startNodeFrom(left);
        blockNode.body = unpackTuple(tupleArgs, right);
        return finishNode(blockNode, "BlockStatement");
      }

      if (scope.isClass()) {
        var thisExpr = nc.createNodeFrom(left, "ThisExpression");
        left = nc.createNodeFrom(left, "MemberExpression", { object: thisExpr, property: left });
      }

      var node = startNodeFrom(left);
      node.operator = tokVal;
      node.left = left;
      next();
      node.right = parseMaybeTuple(noIn);
      checkLVal(left);

      if (node.operator === '+=' || node.operator === '*=') {
        var right = nc.createNodeSpan(node.right, node.right, "CallExpression");
        right.callee = nc.createNodeOpsCallee(right, node.operator === '+=' ? "add" : "multiply");
        right.arguments = [left, node.right];
        node.right = right;
        node.operator = '=';
      }

      if (left.type === "Identifier" && !scope.exists(left.name)) {
        if (!node.operator || node.operator.length > 1) unexpected();
        scope.addVar(left.name);
        return nc.createVarDeclFromId(node.left, node.left, node.right);
      }
      return finishNode(node, "AssignmentExpression");
    }
    return left;
  }

  // Parse a tuple

  function parseMaybeTuple(noIn) {
    var expr = parseExprOps(noIn);
    if (tokType === _comma) {
      return parseTuple(noIn, expr);
    }
    return expr;
  }

  // Start the precedence parser.

  function parseExprOps(noIn) {
    return parseExprOp(parseMaybeUnary(noIn), -1, noIn);
  }

  // Parse binary operators with the operator precedence parsing
  // algorithm. `left` is the left-hand side of the operator.
  // `minPrec` provides context that allows the function to stop and
  // defer further parser to one of its callers when it encounters an
  // operator that has a lower precedence than the set it is parsing.
  // Exponentiation is evaluated right-to-left, so 'prec >= minPrec'
  // Exponentiation operator 'x**y' is replaced with 'Math.pow(x, y)'
  // Floor division operator 'x//y' is replaced with 'Math.floor(x/y)'
  // 'in' and 'not in' implemented via indexOf()

  function parseExprOp(left, minPrec, noIn) {
    var node, exprNode, right, op = tokType, val = tokVal;
    var prec = op === _not ? _in.prec : op.prec;
    if (op === _exponentiation && prec >= minPrec) {
      node = startNodeFrom(left);
      next();
      right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
      exprNode = nc.createNodeMemberCall(node, "Math", "pow", [left, right]);
      return parseExprOp(exprNode, minPrec, noIn);
    } else if (prec != null && (!noIn || op !== _in)) {
      if (prec > minPrec) {
        next();
        node = startNodeFrom(left);
        if (op === _floorDiv) {
          right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
          finishNode(node);
          var binExpr = nc.createNodeSpan(node, node, "BinaryExpression", { left: left, operator: '/', right: right });
          exprNode = nc.createNodeMemberCall(node, "Math", "floor", [binExpr]);
        } else if (op === _in || op === _not) {
          if (op === _in || eat(_in)) {
            right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
            finishNode(node);
            var notLit = nc.createNodeSpan(node, node, "Literal", { value: op === _not });
            exprNode = nc.createNodeRuntimeCall(node, 'ops', 'in', [left, right, notLit]);
          } else raise(tokPos, "Expected 'not in' comparison operator");
        } else if (op === _plusMin && val === '+' || op === _multiplyModulo && val === '*') {
          node.arguments = [left];
          node.arguments.push(parseExprOp(parseMaybeUnary(noIn), prec, noIn));
          finishNode(node, "CallExpression");
          node.callee = nc.createNodeOpsCallee(node, op === _plusMin ? "add" : "multiply");
          exprNode = node;
        } else {
          if (op === _is) {
            if (eat(_not)) node.operator = "!==";
            else node.operator = "===";
          } else node.operator = op.rep != null ? op.rep : val;
          node.left = left;
          node.right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
          exprNode = finishNode(node, (op === _or || op === _and) ? "LogicalExpression" : "BinaryExpression");
        }
        return parseExprOp(exprNode, minPrec, noIn);
      }
    }
    return left;
  }

  // Parse unary operators.
  // '-+' are prefixes here, with different precedence.

  function parseMaybeUnary(noIn) {
    if (tokType.prefix || tokType === _plusMin) {
      var prec = tokType === _plusMin ? _posNegNot.prec : tokType.prec;
      var node = startNode();
      node.operator = tokType.rep != null ? tokType.rep : tokVal;
      node.prefix = true;
      tokRegexpAllowed = true;
      next();
      node.argument = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
      return finishNode(node, "UnaryExpression");
    }
    return parseSubscripts(parseExprAtom());
  }

  // Parse call, dot, and `[]`-subscript expressions.

  function parseSubscripts(base, noCalls) {
    var node = startNodeFrom(base);
    if (eat(_dot)) {
      var id = parseIdent(true);
      if (pythonRuntime.imports[base.name] && pythonRuntime.imports[base.name][id.name]) {
        // Calling a Python import function
        // TODO: Unpack parameters into JavaScript-friendly parameters
        var runtimeId = nc.createNodeSpan(base, base, "Identifier", { name: options.runtimeParamName });
        var importsId = nc.createNodeSpan(base, base, "Identifier", { name: "imports" });
        var runtimeMember = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeId, property: importsId, computed: false });
        node.object = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeMember, property: base, computed: false });
      } else if (base.name && base.name === scope.getThisReplace()) {
        node.object = nc.createNodeSpan(base, base, "ThisExpression");
      } else node.object = base;
      node.property = id;
      node.computed = false;
      return parseSubscripts(finishNode(node, "MemberExpression"), noCalls);
    } else if (eat(_bracketL)) {
      var expr, isSlice = false;
      if (eat(_colon)) isSlice = true;
      else expr = parseExpression();
      if (!isSlice && eat(_colon)) isSlice = true;
      if (isSlice) return parseSlice(node, base, expr, noCalls);
      var subscriptCall = nc.createNodeSpan(expr, expr, "CallExpression");
      subscriptCall.callee = nc.createNodeOpsCallee(expr, "subscriptIndex");
      subscriptCall.arguments = [base, expr];
      node.object = base;
      node.property = subscriptCall;
      node.computed = true;
      expect(_bracketR);
      return parseSubscripts(finishNode(node, "MemberExpression"), noCalls);
    } else if (!noCalls && eat(_parenL)) {
      if (scope.isUserFunction(base.name)) {
        // Unpack parameters into JavaScript-friendly parameters, further processed at runtime
        var createParamsCall = nc.createNodeRuntimeCall(node, 'utils', 'createParamsObj', parseParamsList());
        node.arguments = [createParamsCall];
      } else node.arguments = parseExprList(_parenR, false);
      if (scope.isNewObj(base.name)) finishNode(node, "NewExpression");
      else finishNode(node, "CallExpression");
      if (pythonRuntime.functions[base.name]) {
        // Calling a Python built-in function
        // TODO: Unpack parameters into JavaScript-friendly parameters
        if (base.type !== "Identifier") unexpected();
        var runtimeId = nc.createNodeSpan(base, base, "Identifier", { name: options.runtimeParamName });
        var functionsId = nc.createNodeSpan(base, base, "Identifier", { name: "functions" });
        var runtimeMember = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeId, property: functionsId, computed: false });
        node.callee = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeMember, property: base, computed: false });
      } else node.callee = base;
      return parseSubscripts(node, noCalls);
    }
    return base;
  }

  function parseSlice(node, base, start, noCalls) {
    var end, step;
    if (!start) start = nc.createNodeFrom(node, "Literal", { value: null });
    if (tokType === _bracketR || eat(_colon)) {
      end = nc.createNodeFrom(node, "Literal", { value: null });
    } else {
      end = parseExpression();
      if (tokType !== _bracketR) expect(_colon);
    }
    if (tokType === _bracketR) step = nc.createNodeFrom(node, "Literal", { value: null });
    else step = parseExpression();
    expect(_bracketR);

    node.arguments = [start, end, step];
    var sliceId = nc.createNodeFrom(base, "Identifier", { name: "_pySlice" });
    var memberExpr = nc.createNodeSpan(base, base, "MemberExpression", { object: base, property: sliceId, computed: false });
    node.callee = memberExpr;
    return parseSubscripts(finishNode(node, "CallExpression"), noCalls);
  }

  // Parse an atomic expression - either a single token that is an
  // expression, an expression started by a keyword like `function` or
  // `new`, or an expression wrapped in punctuation like `()`, `[]`,
  // or `{}`.

  function parseExprAtom() {
    switch (tokType) {

    case _dict:
      next();
      return parseDict(_parenR);

    case _name:
      return parseIdent();

    case _num: case _string: case _regexp:
      var node = startNode();
      node.value = tokVal;
      node.raw = input.slice(tokStart, tokEnd);
      next();
      return finishNode(node, "Literal");

    case _none: case _true: case _false:
      var node = startNode();
      node.value = tokType.atomValue;
      node.raw = tokType.keyword;
      next();
      return finishNode(node, "Literal");

    case _parenL:
      var tokStartLoc1 = tokStartLoc, tokStart1 = tokStart;
      next();
      if (tokType === _parenR) {
        // Empty tuple
        var node = parseTuple(false);
        eat(_parenR);
        return node;
      }
      var val = parseMaybeTuple(false);
      if (options.locations) {
        val.loc.start = tokStartLoc1;
        val.loc.end = tokEndLoc;
      }
      if (options.ranges)
        val.range = [tokStart1, tokEnd];
      expect(_parenR);
      return val;

    case _bracketL:
      return parseList();

    case _braceL:
      return parseDict(_braceR);

    case _indent:
      raise(tokStart, "Unexpected indent");

    default:
      unexpected();
    }
  }

  // Parse list

  // Custom list object is used to simulate native Python list
  // E.g. Python '[]' becomes JavaScript 'new __pythonRuntime.objects.list();'
  // If list comprehension, build something like this:
  //(function() {
  //  var _list = [];
  //  ...
  //  _list.push(expr);
  //  return _list;
  //}());

  function parseList() {
    var node = startNode();
    node.arguments = [];
    next();

    if (!eat(_bracketR)) {
      var expr = parseExprOps(false);
      if (tokType === _for || tokType === _if) {

        // List comprehension
        var tmpVarSuffix = newAstIdCount++;
        expr = nc.createListCompPush(expr, tmpVarSuffix);
        var body = parseCompIter(expr, true);
        finishNode(node);
        return nc.createListCompIife(node, body, tmpVarSuffix);

      } else if (eat(_comma)) {
        node.arguments = [expr].concat(parseExprList(_bracketR, true, false));
      }
      else {
        expect(_bracketR);
        node.arguments = [expr];
      }
    }

    finishNode(node, "NewExpression");
    var runtimeId = nc.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
    var objectsId = nc.createNodeSpan(node, node, "Identifier", { name: "objects" });
    var runtimeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: objectsId, computed: false });
    var listId = nc.createNodeSpan(node, node, "Identifier", { name: "list" });
    node.callee = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeMember, property: listId, computed: false });
    return node;
  }

  // Parse a comp_iter from Python language grammar
  // Used to build list comprehensions
  // 'expr' is the body to be used after unrolling the ifs and fors

  function parseCompIter(expr, first) {
    if (first && tokType !== _for) unexpected();
    if (eat(_bracketR)) return expr;
    var node = startNode();
    if (eat(_for)) {
      var init = parseExpression(false, true);
      var tupleArgs = getTupleArgs(init);
      if (!tupleArgs) checkLVal(init);
      expect(_in);
      var right = parseExpression();
      var body = parseCompIter(expr, false);
      var block = nc.createNodeSpan(body, body, "BlockStatement", { body: [body] });
      finishNode(node, "BlockStatement");
      return nc.createFor(node, init, tupleArgs, right, block);
    } else if (eat(_if)) {
      if (tokType === _parenL) node.test = parseParenExpression();
      else node.test = parseExpression();
      node.consequent = parseCompIter(expr, false);
      return finishNode(node, "IfStatement");
    } else unexpected();
  }

  // Parse class

  function parseClass(ctorNode) {
    // Container for class constructor and prototype functions
    var container = startNodeFrom(ctorNode);
    container.body = [];

    // Parse class signature
    ctorNode.id = parseIdent();
    ctorNode.params = [];
    var classParams = [];
    if (eat(_parenL)) {
      var first = true;
      while (!eat(_parenR)) {
        if (!first) expect(_comma); else first = false;
        classParams.push(parseIdent());
      }
    }
    if (classParams.length > 1) raise(tokPos, "Multiple inheritance not supported");
    expect(_colon);

    // Start new namespace for class body
    scope.startClass(ctorNode.id.name);

    // Save a reference for source ranges
    var classBodyRefNode = finishNode(startNode());

    // Parse class body
    var classBlock = parseSuite();

    // Generate additional AST to implement class
    var classStmt = nc.createClass(container, ctorNode, classParams, classBodyRefNode, classBlock);

    scope.end();

    return classStmt;
  }

  // Parse dictionary
  // Custom dict object used to simulate native Python dict
  // E.g. "{'k1':'v1', 'k2':'v2'}" becomes "new __pythonRuntime.objects.dict(['k1', 'v1'], ['k2', 'v2']);"

  function parseDict(tokClose) {
    var node = startNode(), first = true, key, value;
    node.arguments = [];
    next();
    while (!eat(tokClose)) {
      if (!first) {
        expect(_comma);
      } else first = false;

      if (tokClose === _braceR) {
        key = parsePropertyName();
        expect(_colon);
        value = parseExprOps(false);
      } else if (tokClose === _parenR) {
        var keyId = parseIdent(true);
        key = startNodeFrom(keyId);
        key.value = keyId.name;
        finishNode(key, "Literal");
        expect(_eq);
        value = parseExprOps(false);
      } else unexpected();
      node.arguments.push(nc.createNodeSpan(key, value, "ArrayExpression", { elements: [key, value] }));
    }
    finishNode(node, "NewExpression");

    var runtimeId = nc.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
    var objectsId = nc.createNodeSpan(node, node, "Identifier", { name: "objects" });
    var runtimeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: objectsId, computed: false });
    var listId = nc.createNodeSpan(node, node, "Identifier", { name: "dict" });
    node.callee = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeMember, property: listId, computed: false });

    return node;
  }

  function parsePropertyName() {
    if (tokType === _num || tokType === _string) return parseExprAtom();
    return parseIdent(true);
  }

  function parseFunction(node) {
    // TODO: The node creation utilities used here are tightly coupled (e.g. variable names)

    var suffix = newAstIdCount++;
    node.id = parseIdent();
    node.params = [];

    // Parse parameters

    var formals = [];     // In order, maybe with default value
    var argsId = null;    // *args
    var kwargsId = null;  // **kwargs
    var defaultsFound = false;
    var first = true;
    expect(_parenL);
    while (!eat(_parenR)) {
      if (!first) expect(_comma); else first = false;
      if (tokVal === '*') {
        if (kwargsId) raise(tokPos, "invalid syntax");
        next(); argsId = parseIdent();
      } else if (tokVal === '**') {
        next(); kwargsId = parseIdent();
      } else {
        if (kwargsId) raise(tokPos, "invalid syntax");
        var paramId = parseIdent();
        if (eat(_eq)) {
          formals.push({ id: paramId, expr: parseExprOps(false) });
          defaultsFound = true;
        } else {
          if (defaultsFound) raise(tokPos, "non-default argument follows default argument");
          if (argsId) raise(tokPos, "missing required keyword-only argument");
          formals.push({ id: paramId, expr: null });
        }
      }
    }
    expect(_colon);

    // Start a new scope with regard to the `inFunction`
    // flag (restore them to their old value afterwards).
    // `inFunction` used to throw syntax error for stray `return`
    var oldInFunc = inFunction = true;

    scope.startFn(node.id.name);

    // If class method, remove class instance var from params and save for 'this' replacement
    if (scope.isParentClass()) {
      var selfId = formals.shift();
      scope.setThisReplace(selfId.id.name);
    }

    var body = parseSuite();
    node.body = nc.createNodeSpan(body, body, "BlockStatement", { body: [] });

    // Add runtime parameter processing
    // The caller may pass a complex parameter object as a single parameter like this:
    // {formals:[<expr>, <expr>, ...], keywords:{<id>:<expr>, <id>:<expr>, ...}}

    if (formals.length > 0 || argsId || kwargsId) {
      // var __params = arguments.length === 1 && arguments[0].formals && arguments[0].keywords ? arguments[0] : null;
      node.body.body.push(nc.createNodeParamsCheck(node.id, suffix));

      // var __formalsIndex = 0;
      node.body.body.push(nc.createGeneratedVarDeclFromId(node.id,
        nc.createNodeSpan(node.id, node.id, "Identifier", { name: '__formalsIndex' + suffix }),
        nc.createNodeSpan(node.id, node.id, "Literal", { value: 0 })));

      // var __args = arguments;
      node.body.body.push(nc.createGeneratedVarDeclFromId(node.id,
        nc.createNodeSpan(node.id, node.id, "Identifier", { name: '__args' + suffix }),
        nc.createNodeSpan(node.id, node.id, "Identifier", { name: 'arguments' })));
    }

    if (formals.length > 0) {
      // function __getParam(v, d) {
      //   var r = d;
      //   if (__params) {
      //     if (__formalsIndex < __params.formals.length) {
      //       r = __params.formals[__formalsIndex++];
      //     } else if (v in __params.keywords) {
      //       r = __params.keywords[v];
      //       delete __params.keywords[v];
      //     }
      //   } else if (__formalsIndex < __args.length) {
      //     r = __args[__formalsIndex++];
      //   }
      //   return r;
      // }
      node.body.body.push(nc.createNodeGetParamFn(node.id, suffix));

      for (var i = 0; i < formals.length; i++) {
        // var <param> = __getParam('<param>', <optional default>);
        var __getParamCall = nc.createNodeSpan(formals[i].id, formals[i].id, "CallExpression", {
          callee: nc.createNodeSpan(formals[i].id, formals[i].id, "Identifier", { name: '__getParam' + suffix }),
          arguments: [nc.createNodeSpan(formals[i].id, formals[i].id, "Literal", { value: formals[i].id.name })]
        });
        if (formals[i].expr) __getParamCall.arguments.push(formals[i].expr);
        node.body.body.push(nc.createGeneratedVarDeclFromId(formals[i].id, formals[i].id, __getParamCall));
      }
    }
    
    var refNode = argsId || kwargsId;
    if (refNode) {
      if (argsId) {
        // var <args> = [];
        var argsAssign = nc.createGeneratedVarDeclFromId(argsId, argsId, nc.createNodeSpan(argsId, argsId, "ArrayExpression", { elements: [] }));
        node.body.body.push(argsAssign);
      }
      if (kwargsId) {
        // var <kwargs> = {};
        var kwargsAssign = nc.createGeneratedVarDeclFromId(kwargsId, kwargsId, nc.createNodeSpan(kwargsId, kwargsId, "ObjectExpression", { properties: [] }));
        node.body.body.push(kwargsAssign);
      }
      // if (__params) {}
      var argsIf = nc.createNodeSpan(refNode, refNode, "IfStatement", {
        test: nc.createNodeSpan(refNode, refNode, "Identifier", { name: '__params' + suffix }),
        consequent: nc.createNodeSpan(refNode, refNode, "BlockStatement", { body: [] })})
      if (argsId) {
        // while (__formalsIndex < __params.formals.length) {
        //   <argsId>.push(__params.formals[__formalsIndex++]); }
        argsIf.consequent.body.push(nc.createNodeArgsWhileConsequent(argsId, suffix));
        // { while (__formalsIndex < __args.length) {
        //   <argsId>.push(__args[__formalsIndex++]); }}
        argsIf.alternate = nc.createNodeArgsAlternate(argsId, suffix);
      }
      if (kwargsId) {
        // <kwargs> = __params.keywords
        argsIf.consequent.body.push(nc.createNodeSpan(kwargsId, kwargsId, "ExpressionStatement", {
          expression: nc.createNodeSpan(kwargsId, kwargsId, "AssignmentExpression", {
            operator: '=', left: kwargsId, right: nc.createNodeMembIds(kwargsId, '__params' + suffix, 'keywords'),
          })
        }));
      }
      node.body.body.push(argsIf);
    }

    // Convert original body to 'return (function() {<body>}).call(this);'
    node.body.body.push(nc.createNodeFnBodyIife(body));

    inFunction = oldInFunc;

    // Verify that argument names are not repeated
    for (var i = 0; i < formals.length; ++i) {
      for (var j = 0; j < i; ++j) if (formals[i].id.name === formals[j].id.name)
        raise(formals[i].id.start, "Argument name clash");
    }

    // If class method, replace with prototype function literals
    var retNode;
    if (scope.isParentClass()) {
      finishNode(node);
      var classId = nc.createNodeSpan(node, node, "Identifier", { name: scope.getParentClassName() });
      var prototypeId = nc.createNodeSpan(node, node, "Identifier", { name: "prototype" });
      var functionId = node.id;
      var prototypeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: classId, property: prototypeId, computed: false });
      var functionMember = nc.createNodeSpan(node, node, "MemberExpression", { object: prototypeMember, property: functionId, computed: false });
      var functionExpr = nc.createNodeSpan(node, node, "FunctionExpression", { body: node.body, params: node.params });
      var assignExpr = nc.createNodeSpan(node, node, "AssignmentExpression", { left: functionMember, operator: "=", right: functionExpr });
      retNode = nc.createNodeSpan(node, node, "ExpressionStatement", { expression: assignExpr });
    } else retNode = finishNode(node, "FunctionDeclaration");

    scope.end();

    return retNode;
  }

  // Parses a comma-separated list of expressions, and returns them as
  // an array. `close` is the token type that ends the list, and
  // `allowEmpty` can be turned on to allow subsequent commas with
  // nothing in between them to be parsed as `null` (which is needed
  // for array literals).

  function parseExprList(close, allowTrailingComma, allowEmpty) {
    var elts = [], first = true;
    while (!eat(close)) {
      if (!first) {
        expect(_comma);
        if (allowTrailingComma && options.allowTrailingCommas && eat(close)) break;
      } else first = false;

      if (allowEmpty && tokType === _comma) elts.push(null);
      else elts.push(parseExprOps(false));
    }
    return elts;
  }

  function parseParamsList() {
    // In: expr, expr, ..., id=expr, id=expr, ...
    // Out: expr, expr, ..., {id:expr, __kwp:true}, {id:expr, __kwp:true}, ...
    var elts = [], first = true;
    while (!eat(_parenR)) {
      if (!first) expect(_comma);
      else first = false;
      var expr = parseExprOps(false);
      if (eat(_eq)) {
        var right = parseExprOps(false);
        var kwId = nc.createNodeSpan(expr, right, "Identifier", {name:"__kwp"});
        var kwLit = nc.createNodeSpan(expr, right, "Literal", {value:true});
        var left = nc.createNodeSpan(expr, right, "ObjectExpression", { properties: [] });
        left.properties.push({ type: "Property", key: expr, value: right, kind: "init" });
        left.properties.push({ type: "Property", key: kwId, value: kwLit, kind: "init" });
        expr = left;
      }
      elts.push(expr);
    }
    return elts;
  }

  // Parse the next token as an identifier. If `liberal` is true (used
  // when parsing properties), it will also convert keywords into
  // identifiers.

  // TODO: liberal?

  function parseIdent(liberal) {
    var node = startNode();
    if (liberal) liberal = false;
    if (tokType === _name) {
      if (!liberal && strict && input.slice(tokStart, tokEnd).indexOf("\\") == -1)
        raise(tokStart, "The keyword '" + tokVal + "' is reserved");
      node.name = tokVal;
    } else if (liberal && tokType.keyword) {
      node.name = tokType.keyword;
    } else {
      unexpected();
    }
    tokRegexpAllowed = false;
    next();
    return finishNode(node, "Identifier");
  }

  function parseTuple(noIn, expr) {
    var node = expr ? startNodeFrom(expr) : startNode();
    node.arguments = expr ? [expr] : [];

    // Tuple with single element has special trailing comma: t = 'hi',
    // Look ahead and eat comma in this scenario
    if (tokType === _comma) {
      var oldPos = tokPos; skipSpace();
      var newPos = tokPos; tokPos = oldPos;
      if (newPos >= inputLen || input[newPos] === ';' || input[newPos] === ')' || newline.test(input[newPos]))
        eat(_comma);
    }

    while (eat(_comma)) {
      node.arguments.push(parseExprOps(noIn));
    }
    finishNode(node, "NewExpression");

    var runtimeId = nc.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
    var objectsId = nc.createNodeSpan(node, node, "Identifier", { name: "objects" });
    var runtimeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: objectsId, computed: false });
    var listId = nc.createNodeSpan(node, node, "Identifier", { name: "tuple" });
    node.callee = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeMember, property: listId, computed: false });

    return node;
  }


  // ## Python runtime library

  var pythonRuntime = exports.pythonRuntime = {

    // Shim JavaScript objects that impersonate Python equivalents

    // TODO: use 'type' or isSequence instead of 'instanceof Array' to id these

    internal: {
      // Only used within runtime
      isSeq: function (a) { return a && (a._type === "list" || a._type === "tuple"); },
      slice: function (obj, start, end, step) {
        if (step == null || step === 0) step = 1; // TODO: step === 0 is a runtime error
        if (start == null) {
          if (step < 0) start = obj.length - 1;
          else start = 0;
        } else if (start < 0) start += obj.length;
        if (end == null) {
          if (step < 0) end = -1;
          else end = obj.length;
        } else if (end < 0) end += obj.length;

        var ret = new pythonRuntime.objects.list(), tmp, i;
        if (step < 0) {
          tmp = obj.slice(end + 1, start + 1);
          for (i = tmp.length - 1; i >= 0; i += step) ret.append(tmp[i]);
        } else {
          tmp = obj.slice(start, end);
          if (step === 1) ret = pythonRuntime.utils.createList(tmp);
          else for (i = 0; i < tmp.length; i += step) ret.append(tmp[i]);
        }
        return ret;
      },
      isJSArray: Array.isArray || function(obj) {
        return toString.call(obj) === '[object Array]';
      }
    },

    utils: {
      convertToDict: function (dict) {
        if (!dict.hasOwnProperty("_type")) {
          Object.defineProperty(dict, "_type",
          {
            get: function () { return 'dict';},
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("_isPython")) {
          Object.defineProperty(dict, "_isPython",
          {
            get: function () { return true; },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("items")) {
          Object.defineProperty(dict, "items",
          {
            value: function () {
              var items = new pythonRuntime.objects.list();
              for (var k in this) items.append(new pythonRuntime.objects.tuple(k, this[k]));
              return items;
            },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("length")) {
          Object.defineProperty(dict, "length",
          {
            get: function () {
              return Object.keys(this).length;
            },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("clear")) {
          Object.defineProperty(dict, "clear",
          {
            value: function () {
              for (var i in this) delete this[i];
            },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("get")) {
          Object.defineProperty(dict, "get",
          {
            value: function (key, def) {
              if (key in this) return this[key];
              else if (def !== undefined) return def;
              return null;
            },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("keys")) {
          Object.defineProperty(dict, "keys",
          {
            value: function () {
              return Object.keys(this);
            },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("pop")) {
          Object.defineProperty(dict, "pop",
          {
            value: function (key, def) {
              var value;
              if (key in this) {
                value = this[key];
                delete this[key];
              } else if (def !== undefined) value = def;
              else return new Error("KeyError");
              return value;
            },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("values")) {
          Object.defineProperty(dict, "values",
          {
            value: function () {
              var values = new pythonRuntime.objects.list();
              for (var key in this) values.append(this[key]);
              return values;
            },
            enumerable: false
          });
        }
      },
      createDict: function () {
        var ret = new pythonRuntime.objects.dict();
        if (arguments.length === 1 && arguments[0] instanceof Object)
          for (var k in arguments[0]) ret[k] = arguments[0][k];
        else
          throw TypeError("createDict expects a single JavaScript object")
        return ret;
      },
      createParamsObj: function () {
        // In: expr, expr, ..., {id:expr, __kwp:true}, {id:expr, __kwp:true}, ...
        // Out: {formals:[expr, expr, ...], keywords:{id:expr, id:expr, ...}}
        var params = { formals: new pythonRuntime.objects.list(), keywords: new pythonRuntime.objects.dict() };
        for (var i = 0; i < arguments.length; i++) {
          if (arguments[i] && arguments[i].__kwp === true) {
            for (var k in arguments[i])
              if (k !== '__kwp') params.keywords[k] = arguments[i][k];
          }
          else params.formals.push(arguments[i]);
        }
        return params;
      },
      convertToList: function (list) {
        if (!list.hasOwnProperty("_type")) {
          Object.defineProperty(list, "_type",
          {
            get: function () { return 'list'; },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("_isPython")) {
          Object.defineProperty(list, "_isPython",
          {
            get: function () { return true; },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("append")) {
          Object.defineProperty(list, "append",
          {
            value: function (x) {
              this.push(x);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("clear")) {
          Object.defineProperty(list, "clear",
          {
            value: function () {
              this.splice(0, this.length);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("copy")) {
          Object.defineProperty(list, "copy",
          {
            value: function () {
              return this.slice(0);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("count")) {
          Object.defineProperty(list, "count",
          {
            value: function (x) {
              var c = 0;
              for (var i = 0; i < this.length; i++)
                if (this[i] === x) c++;
              return c;
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("equals")) {
          Object.defineProperty(list, "equals",
          {
            value: function (x) {
              try {
                if (this.length !== x.length) return false;
                for (var i = 0; i < this.length; i++) {
                  if (this[i].hasOwnProperty("equals")) {
                    if (!this[i].equals(x[i])) return false;
                  } else if (this[i] !== x[i]) return false;
                }
                return true;
              }
              catch (e) { }
              return false;
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("extend")) {
          Object.defineProperty(list, "extend",
          {
            value: function (L) {
              for (var i = 0; i < L.length; i++) this.push(L[i]);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("index")) {
          Object.defineProperty(list, "index",
          {
            value: function (x) {
              return this.indexOf(x);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("indexOf")) {
          Object.defineProperty(list, "indexOf",
          {
            value: function (x, fromIndex) {
              try {
                for (var i = fromIndex ? fromIndex : 0; i < this.length; i++) {
                  if (this[i].hasOwnProperty("equals")) {
                    if (this[i].equals(x)) return i;
                  } else if (this[i] === x) return i;
                }
              }
              catch (e) { }
              return -1;
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("insert")) {
          Object.defineProperty(list, "insert",
          {
            value: function (i, x) {
              this.splice(i, 0, x);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("pop")) {
          Object.defineProperty(list, "pop",
          {
            value: function (i) {
              if (!i)
                i = this.length - 1;
              var item = this[i];
              this.splice(i, 1);
              return item;
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("_pySlice")) {
          Object.defineProperty(list, "_pySlice",
          {
            value: function (start, end, step) {
              return pythonRuntime.internal.slice(this, start, end, step);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("remove")) {
          Object.defineProperty(list, "remove",
          {
            value: function (x) {
              this.splice(this.indexOf(x), 1);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("sort")) {
          Object.defineProperty(list, "sort",
          {
            value: function(x, reverse) {
              var list2 = this.slice(0);
              var apply_key = function(a, numerical) {
                var list3 = list2.map(x);
                // construct a dict that maps the listay before and after the map
                var mapping = {}
                for(var i in list3) mapping[list3[i]] = list2[i];
                if(numerical)
                  list3.sort(function(a, b) { return a - b; });
                else
                  list3.sort()
                for(var i in a) a[i] = mapping[list3[i]];
              }
              for(var i in this) {
                if(typeof this[i] !== 'number' || !isFinite(this[i])) {
                  if(typeof x != 'undefined') {
                    apply_key(this, false);
                  }
                  else {
                    list2.sort();
                    for (var j in this) this[j] = list2[j];
                  }
                  if(reverse)
                    this.reverse();
                  return;
                }
              }
              if(typeof x != 'undefined') {
                apply_key(this, true);
              }
              else {
                list2.sort(function(a, b) { return a - b; });
                for(var i in this) this[i] = list2[i];
              }
              if(reverse)
                this.reverse();
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("toString")) {
          Object.defineProperty(list, "toString",
          {
            value: function () {
              return '[' + this.join(', ') + ']';
            },
            enumerable: false
          });
        }
      },
      createList: function () {
        var ret = new pythonRuntime.objects.list();
        if (arguments.length === 1 && arguments[0] instanceof Array)
          for (var i in arguments[0]) ret.push(arguments[0][i]);
        else
          for (var i in arguments) ret.push(arguments[i]);
        return ret;
      }
    },

    ops: {
      add: function (a, b) {
        if (pythonRuntime.internal.isSeq(a) && pythonRuntime.internal.isSeq(b)) {
          if (a._type !== b._type)
            throw TypeError("can only concatenate " + a._type + " (not '" + b._type + "') to " + a._type);
          var ret;
          if (a._type === 'list') ret = new pythonRuntime.objects.list();
          else if (a._type === 'tuple') ret = new pythonRuntime.objects.tuple();
          if (ret) {
            for (var i = 0; i < a.length; i++) ret.push(a[i]);
            for (var i = 0; i < b.length; i++) ret.push(b[i]);
            return ret;
          }
        }
        return a + b;
      },
      in: function (a, b, n) {
        var r = b.hasOwnProperty('indexOf') ? b.indexOf(a) >= 0 : a in b;
        return n ? !r : r;
      },
      multiply: function (a, b) {
        // TODO: non-sequence operand must be an integer
        if (pythonRuntime.internal.isSeq(a) && !isNaN(parseInt(b))) {
          var ret;
          if (a._type === 'list') ret = new pythonRuntime.objects.list();
          else if (a._type === 'tuple') ret = new pythonRuntime.objects.tuple();
          if (ret) {
            for (var i = 0; i < b; i++)
              for (var j = 0; j < a.length; j++) ret.push(a[j]);
            return ret;
          }
        }
        else if (pythonRuntime.internal.isSeq(b) && !isNaN(parseInt(a))) {
          var ret;
          if (b._type === 'list') ret = new pythonRuntime.objects.list();
          else if (b._type === 'tuple') ret = new pythonRuntime.objects.tuple();
          if (ret) {
            for (var i = 0; i < a; i++)
              for (var j = 0; j < b.length; j++) ret.push(b[j]);
            return ret;
          }
        }
        return a * b;
      },
      subscriptIndex: function (o, i) {
        if (pythonRuntime.internal.isSeq(o) && i < 0) return o.length + i;
        if (pythonRuntime.internal.isJSArray(o) && i < 0 ) return o.length + i;
        if ( typeof o === "string" && i < 0 ) return o.length + i;
        return i;
      }
    },

    objects: {
      dict: function () {
        var obj = {};
        for (var i in arguments) obj[arguments[i][0]] = arguments[i][1];
        pythonRuntime.utils.convertToDict(obj);
        return obj;
      },
      list: function () {
        var arr = [];
        arr.push.apply(arr, arguments);
        pythonRuntime.utils.convertToList(arr);
        return arr;
      },
      tuple: function () {
        var arr = [];
        arr.push.apply(arr, arguments);
        Object.defineProperty(arr, "_type",
        {
          get: function () { return 'tuple'; },
          enumerable: false
        });
        Object.defineProperty(arr, "_isPython",
        {
          get: function () { return true; },
          enumerable: false
        });
        Object.defineProperty(arr, "count",
        {
          value: function (x) {
            var c = 0;
            for (var i = 0; i < this.length; i++)
              if (this[i] === x) c++;
            return c;
          },
          enumerable: false
        });
        Object.defineProperty(arr, "equals",
        {
          value: function (x) {
            try {
              if (this.length !== x.length) return false;
              for (var i = 0; i < this.length; i++) {
                if (this[i].hasOwnProperty("equals")) {
                  if (!this[i].equals(x[i])) return false;
                } else if (this[i] !== x[i]) return false;
              }
              return true;
            }
            catch (e) { }
            return false;
          },
          enumerable: false
        });
        Object.defineProperty(arr, "index",
        {
          value: function (x) {
            return this.indexOf(x);
          },
          enumerable: false
        });
        Object.defineProperty(arr, "indexOf",
        {
          value: function (x, fromIndex) {
            try {
              for (var i = fromIndex ? fromIndex : 0; i < this.length; i++) {
                if (this[i].hasOwnProperty("equals")) {
                  if (this[i].equals(x)) return i;
                } else if (this[i] === x) return i;
              }
            }
            catch (e) { }
            return -1;
          },
          enumerable: false
        });
        Object.defineProperty(arr, "_pySlice",
        {
          value: function (start, end, step) { 
            return pythonRuntime.internal.slice(this, start, end, step);
          },
            enumerable: false
        });
        Object.defineProperty(arr, "toString",
        {
          value: function () {
            var s = '(' + this.join(', ');
            if (this.length === 1) s += ',';
            s += ')';
            return s;
          },
          enumerable: false
        });
        return arr;
      }
    },

    // Python built-in functions

    functions: {
      abs: function(x) {
        return Math.abs(x);
      },
      all: function(iterable) {
        for (var i in iterable) if (pythonRuntime.functions.bool(iterable[i]) !== true) return false;
        return true;
      },
      any: function(iterable) {
        for (var i in iterable) if (pythonRuntime.functions.bool(iterable[i]) === true) return true;
        return false;
      },
      ascii: function(obj) {
        var s = pythonRuntime.functions.repr(obj),
            asc = "",
            code;
        for (var i = 0; i < s.length; i++) {
          code = s.charCodeAt(i);
          if (code <= 127) asc += s[i];
          else if (code <= 0xFF) asc += "\\x" + code.toString(16);
          else if (0xD800 <= code && code <= 0xDBFF) { // UCS-2 for the astral chars
            // if (i+1 >= s.length) throw "High surrogate not followed by low surrogate"; // Is this needed?
            code = ((code-0xD800)*0x400)+(s.charCodeAt(++i)-0xDC00)+0x10000;
            asc += "\\U" + ("000"+code.toString(16)).slice(-8);
          } else if (code <= 0xFFFF) asc += "\\u" + ("0"+code.toString(16)).slice(-4);
          else if (code <= 0x10FFFF) asc += "\\U" + ("000"+code.toString(16)).slice(-8);
          else; // Invalid value, should probably throw something. It should never get here though as strings shouldn't contain them in the first place
        }
        return asc;
      },
      bool: function(x) {
        return !(x === undefined || // No argument
                 x === null || // None
                 x === false || // False
                 x === 0 || // Zero
                 x.length === 0 || // Empty Sequence
                 // TODO: Empty Mapping, needs more support for python mappings first
                 (x.__bool__ !== undefined && x.__bool__() === false) || // If it has bool conversion defined
                 (x.__len__ !== undefined && (x.__len__() === false || x.__len__() === 0))); // If it has length conversion defined
      },
      chr: function(i) {
        return String.fromCharCode(i); // TODO: Error code for not 0 <= i <= 1114111
      },
      divmod: function(a, b) {
        return pythonRuntime.objects.tuple(Math.floor(a/b), a%b);
      },
      enumerate: function(iterable, start) {
        start = start || 0;
        var ret = new pythonRuntime.objects.list();
        for (var i in iterable) ret.push(new pythonRuntime.objects.tuple(start++, iterable[i]));
        return ret;
      },
      filter: function(fn, iterable) {
        fn = fn || function () { return true; };
        var ret = new pythonRuntime.objects.list();
        for (var i in iterable) if (fn(iterable[i])) ret.push(iterable[i]);
        return ret;
      },
      float: function(x) {
        if (x === undefined) return 0.0;
        else if (typeof x == "string") { // TODO: Fix type check
          x = x.trim().toLowerCase();
          if ((/^[+-]?inf(inity)?$/i).exec(x) !== null) return Infinity*(x[0]==="-"?-1:1);
          else if ((/^nan$/i).exec(x) !== null) return NaN;
          else return parseFloat(x);
        } else if (typeof x == "number") { // TODO: Fix type check
          return x; // TODO: Get python types working right so we can return an actual float
        } else {
          if (x.__float__ !== undefined) return x.__float__();
          else return null; // TODO: Throw TypeError: float() argument must be a string or a number, not '<type of x>'
        }
      },
      hex: function(x) {
        return x.toString(16);
      },
      int: function (s) {
        return parseInt(s);
      },
      len: function (o) {
        return o.length;
      },
      list: function (iterable) {
        var ret = new pythonRuntime.objects.list();
        if (iterable instanceof Array) for (var i in iterable) ret.push(iterable[i]);
        else for (var i in iterable) ret.push(i);
        return ret;
      },
      map: function(fn, iterable) {
        // TODO: support additional iterables passed
        var ret = new pythonRuntime.objects.list();
        for (var i in iterable) ret.push(fn(iterable[i]));
        return ret;
      },
      max: function(arg1, arg2) {
        // TODO: support optional keyword-only arguments
        // TODO: empty iterable raises Python ValueError
        if (!arg2) { // iterable
          var max = null;
          for (var i in arg1) if (max === null || arg1[i] > max) max = arg1[i];
          return max;
        } else return arg1 >= arg2 ? arg1 : arg2;
      },
      min: function(arg1, arg2) {
        // TODO: support optional keyword-only arguments
        // TODO: empty iterable raises Python ValueError
        if (!arg2) { // iterable
          var max = null;
          for (var i in arg1) if (max === null || arg1[i] < max) max = arg1[i];
          return max;
        } else return arg1 <= arg2 ? arg1 : arg2;
      },
      oct: function(x) {
        return x.toString(8);
      },
      ord: function(c) {
        return c.charCodeAt(0);
      },
      pow: function(x, y, z) {
        return z ? Math.pow(x, y) % z : Math.pow(x, y);
      },
      print: function () {
        var s = "";
        for (var i = 0; i < arguments.length; i++)
          s += i === 0 ? arguments[i] : " " + arguments[i];
        console.log(s);
      },
      range: function (start, stop, step) {
        if (stop === undefined) {
          stop = start;
          start = 0;
          step = 1;
        }
        else if (step === undefined) step = 1;
        var r = new pythonRuntime.objects.list();
        if (start < stop && step > 0 || start > stop && step < 0) {
          var i = start;
          while (i < stop && step > 0 || i > stop && step < 0) {
            r.append(i);
            i += step;
          }
        }
        return r;
      },
      repr: function (obj) {
        if (typeof obj === 'string') return "'" + obj + "'"; // TODO: Patch until typesystem comes up.
        if (obj.__repr__ !== undefined) return obj.__repr__();
        else if (obj.__class__ !== undefined && obj.__class__.module !== undefined && obj.__class__.__name__) {
          return '<'+obj.__class__.__module__+'.'+obj.__class__.__name__+' object>';
        } else return obj.toString(); // Raise a please report warning here, we should never reach this piece of code
      },
      reversed: function (seq) {
        var ret = new pythonRuntime.objects.list();
        for (var i in seq) ret.push(seq[i]);
        return ret.reverse();
      },
      round: function (num, ndigits) {
        if (ndigits) {
          var scale = Math.pow(10, ndigits);
          return Math.round(num * scale) / scale;
        }
        return Math.round(num);
      },
      sorted: function (iterable, key, reverse) {
        var ret = new pythonRuntime.objects.list();
        for (var i in iterable) ret.push(iterable[i]);
        if(key) ret.sort(key); else ret.sort();
        if (reverse) ret.reverse();
        return ret;
      },
      str: function (obj) {
        return obj.toString();
      },
      sum: function (iterable, start) {
        // TODO: start can't be a string
        var ret = start || 0;
        for (var i in iterable) ret += iterable[i];
        return ret;
      },
      tuple: function (iterable) {
        var ret = new pythonRuntime.objects.tuple();
        for (var i in iterable) ret.push(iterable[i]);
        return ret;
      }
    },

    // Python imports
    // TODO: from x import y, z

    imports: {
      random: {
        random: function () { return Math.random(); }
      }
    }
  };
});

// Filbert: Loose parser
//
// This module provides an alternative parser (`parse_dammit`) that
// exposes that same interface as `parse`, but will try to parse
// anything as Python, repairing syntax errors the best it can.
// There are circumstances in which it will raise an error and give
// up, but they are very rare. The resulting AST will be a mostly
// valid JavaScript AST (as per the [Mozilla parser API][api], except
// that:
//
// - Return outside functions is allowed
//
// - Bogus Identifier nodes with a name of `"✖"` are inserted whenever
//   the parser got too confused to return anything meaningful.
//
// [api]: https://developer.mozilla.org/en-US/docs/SpiderMonkey/Parser_API
//
// The expected use for this is to *first* try `filbert.parse`, and only
// if that fails switch to `parse_dammit`. The loose parser might
// parse badly indented code incorrectly, so **don't** use it as
// your default parser.
//
// Quite a lot of filbert.js is duplicated here. The alternative was to
// add a *lot* of extra cruft to that file, making it less readable
// and slower. Copying and editing the code allowed invasive changes and 
// simplifications without creating a complicated tangle.

(function(root, mod) {
  if (typeof exports == "object" && typeof module == "object") return mod(exports, require("./filbert")); // CommonJS
  if (typeof define == "function" && define.amd) return define(["exports", "./filbert_loose"], mod); // AMD
  mod(root.filbert_loose || (root.filbert_loose = {}), root.filbert); // Plain browser env
})(this, function(exports, filbert) {
  "use strict";

  var tt = filbert.tokTypes;
  var scope = filbert.scope;
  var indentHist = filbert.indentHist;

  var options, input, inputLen, fetchToken, nc;

  exports.parse_dammit = function(inpt, opts) {
    input = String(inpt); inputLen = input.length;
    setOptions(opts);
    if (!options.tabSize) options.tabSize = 4;
    fetchToken = filbert.tokenize(inpt, options);
    ahead.length = 0;
    newAstIdCount = 0;
    scope.init();
    nc = filbert.getNodeCreator(startNode, startNodeFrom, finishNode, unpackTuple);
    next();
    return parseTopLevel();
  };

  function setOptions(opts) {
    options = opts || {};
    for (var opt in filbert.defaultOptions) if (!Object.prototype.hasOwnProperty.call(options, opt))
      options[opt] = filbert.defaultOptions[opt];
    sourceFile = options.sourceFile || null;
  }

  var lastEnd, token = {start: 0, end: 0}, ahead = [];
  var lastEndLoc, sourceFile;

  var newAstIdCount = 0;

  function next() {
    lastEnd = token.end;
    if (options.locations) lastEndLoc = token.endLoc;

    if (ahead.length) token = ahead.shift();
    else token = readToken();
  }

  function readToken() {
    for (;;) {
      try {
        return fetchToken();
      } catch(e) {
        if (!(e instanceof SyntaxError)) throw e;

        // Try to skip some text, based on the error message, and then continue
        var msg = e.message, pos = e.raisedAt, replace = true;
        if (/unterminated/i.test(msg)) {
          pos = lineEnd(e.pos);
          if (/string/.test(msg)) {
            replace = {start: e.pos, end: pos, type: tt.string, value: input.slice(e.pos + 1, pos)};
          } else if (/regular expr/i.test(msg)) {
            var re = input.slice(e.pos, pos);
            try { re = new RegExp(re); } catch(e) {}
            replace = {start: e.pos, end: pos, type: tt.regexp, value: re};
          } else {
            replace = false;
          }
        } else if (/invalid (unicode|regexp|number)|expecting unicode|octal literal|is reserved|directly after number/i.test(msg)) {
          while (pos < input.length && !isSpace(input.charCodeAt(pos)) && !isNewline(input.charCodeAt(pos))) ++pos;
        } else if (/character escape|expected hexadecimal/i.test(msg)) {
          while (pos < input.length) {
            var ch = input.charCodeAt(pos++);
            if (ch === 34 || ch === 39 || isNewline(ch)) break;
          }
        } else if (/unexpected character/i.test(msg)) {
          pos++;
          replace = false;
        } else if (/regular expression/i.test(msg)) {
          replace = true;
        } else {
          throw e;
        }
        resetTo(pos);
        if (replace === true) replace = {start: pos, end: pos, type: tt.name, value: "✖"};
        if (replace) {
          if (options.locations) {
            replace.startLoc = filbert.getLineInfo(input, replace.start);
            replace.endLoc = filbert.getLineInfo(input, replace.end);
          }
          return replace;
        }
      }
    }
  }

  function resetTo(pos) {
    var ch = input.charAt(pos - 1);
    var reAllowed = !ch || /[\[\{\(,;:?\/*=+\-~!|&%^<>]/.test(ch) ||
      /[enwfd]/.test(ch) && /\b(keywords|case|else|return|throw|new|in|(instance|type)of|delete|void)$/.test(input.slice(pos - 10, pos));
    fetchToken.jumpTo(pos, reAllowed);
  }

  function copyToken(token) {
    var copy = {start: token.start, end: token.end, type: token.type, value: token.value};
    if (options.locations) {
      copy.startLoc = token.startLoc;
      copy.endLoc = token.endLoc;
    }
    return copy;
  }

  function lookAhead(n) {
    // Copy token objects, because fetchToken will overwrite the one
    // it returns, and in this case we still need it
    if (!ahead.length)
      token = copyToken(token);
    while (n > ahead.length)
      ahead.push(copyToken(readToken()));
    return ahead[n-1];
  }

  var newline = /[\n\r\u2028\u2029]/;
  var nonASCIIwhitespace = /[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/;

  function isNewline(ch) {
    return ch === 10 || ch === 13 || ch === 8232 || ch === 8329;
  }
  
  function isSpace(ch) {
    return ch === 9 || ch === 11 || ch === 12 ||
      ch === 32 || // ' '
      ch === 35 || // '#'
      ch === 160 || // '\xa0'
      ch >= 5760 && nonASCIIwhitespace.test(String.fromCharCode(ch));
  }
  
  function lineEnd(pos) {
    while (pos < input.length && !isNewline(input.charCodeAt(pos))) ++pos;
    return pos;
  }

  function skipLine() {
    fetchToken.jumpTo(lineEnd(token.start), false);
  }

  function Node(start) {
    this.type = null;
  }
  Node.prototype = filbert.Node.prototype;

  function SourceLocation(start) {
    this.start = start || token.startLoc || {line: 1, column: 0};
    this.end = null;
    if (sourceFile !== null) this.source = sourceFile;
  }

  function startNode() {
    var node = new Node(token.start);
    if (options.locations)
      node.loc = new SourceLocation();
    if (options.directSourceFile)
      node.sourceFile = options.directSourceFile;
    if (options.ranges)
      node.range = [token.start, 0];
    return node;
  }

  function startNodeFrom(other) {
    var node = new Node(other.start);
    if (options.locations)
      node.loc = new SourceLocation(other.loc.start);
    if (options.ranges)
      node.range = [other.range[0], 0];
    return node;
  }

  function finishNode(node, type) {
    node.type = type;
    if (options.locations)
      node.loc.end = lastEndLoc;
    if (options.ranges)
      node.range[1] = lastEnd;
    return node;
  }

  function getDummyLoc() {
    if (options.locations) {
      var loc = new SourceLocation();
      loc.end = loc.start;
      return loc;
    }
  }

  var dummyCount = 0
  function dummyIdent() {
    var dummy = new Node(token.start);
    dummy.type = "Identifier";
    dummy.end = token.start;
    dummy.name = "dummy" + dummyCount++;
    dummy.loc = getDummyLoc();
    return dummy;
  }
  function isDummy(node) { return node.name && node.name.indexOf("dummy") === 0; }

  function eat(type) {
    if (token.type === type) {
      next();
      return true;
    }
  }

  function expect(type) {
    if (eat(type)) return true;
    if (lookAhead(1).type == type) {
      next(); next();
      return true;
    }
    if (lookAhead(2).type == type) {
      next(); next(); next();
      return true;
    }
  }

  function checkLVal(expr) {
    if (expr.type === "Identifier" || expr.type === "MemberExpression") return expr;
    return dummyIdent();
  }

  // Get args for a new tuple expression

  function getTupleArgs(expr) {
    if (expr.callee && expr.callee.object && expr.callee.object.object &&
      expr.callee.object.object.name === options.runtimeParamName &&
      expr.callee.property && expr.callee.property.name === "tuple")
      return expr.arguments;
    return null;
  }

  // Unpack an lvalue tuple into indivual variable assignments
  // 'arg0, arg1 = right' becomes:
  // var tmp = right
  // arg0 = tmp[0]
  // arg1 = tmp[1]
  // ...

  function unpackTuple(tupleArgs, right) {
    var varStmts = [];

    // var tmp = right

    var tmpId = nc.createNodeSpan(right, right, "Identifier", { name: "__filbertTmp" + newAstIdCount++ });
    var tmpDecl = nc.createVarDeclFromId(right, tmpId, right);
    varStmts.push(tmpDecl);

    // argN = tmp[N]

    if (tupleArgs && tupleArgs.length > 0) {
      for (var i = 0; i < tupleArgs.length; i++) {
        var lval = tupleArgs[i];
        var subTupleArgs = getTupleArgs(lval);
        if (subTupleArgs) {
          var subLit = nc.createNodeSpan(right, right, "Literal", { value: i });
          var subRight = nc.createNodeSpan(right, right, "MemberExpression", { object: tmpId, property: subLit, computed: true });
          var subStmts = unpackTuple(subTupleArgs, subRight);
          for (var j = 0; j < subStmts.length; j++) varStmts.push(subStmts[j]);
        } else {
          checkLVal(lval);
          var indexId = nc.createNodeSpan(right, right, "Literal", { value: i });
          var init = nc.createNodeSpan(right, right, "MemberExpression", { object: tmpId, property: indexId, computed: true });
          if (lval.type === "Identifier" && !scope.exists(lval.name)) {
            scope.addVar(lval.name);
            var varDecl = nc.createVarDeclFromId(lval, lval, init);
            varStmts.push(varDecl);
          }
          else {
            var node = startNodeFrom(lval);
            node.left = lval;
            node.operator = "=";
            node.right = init;
            finishNode(node, "AssignmentExpression");
            varStmts.push(nc.createNodeFrom(node, "ExpressionStatement", { expression: node }));
          }
        }
      }
    }

    return varStmts;
  }

  // ### Statement parsing

  function parseTopLevel() {
    var node = startNode();
    node.body = [];
    while (token.type !== tt.eof) {
      var stmt = parseStatement();
      if (stmt) node.body.push(stmt);
    }
    return finishNode(node, "Program");
  }

  function parseStatement() {
    var starttype = token.type, node = startNode();

    switch (starttype) {

    case tt._break:
      next();
      return finishNode(node, "BreakStatement");

    case tt._continue:
      next();
      return finishNode(node, "ContinueStatement");

    case tt._class:
      next();
      return parseClass(node);

    case tt._def:
      next();
      return parseFunction(node);

    case tt._for:
      next();
      return parseFor(node);

    case tt._from: // Skipping from and import statements for now
      skipLine();
      next();
      return parseStatement();

    case tt._if: case tt._elif:
      next();
      if (token.type === tt.parenL) node.test = parseParenExpression();
      else node.test = parseExpression();
      expect(tt.colon);
      node.consequent = parseSuite();
      if (token.type === tt._elif)
        node.alternate = parseStatement();
      else
        node.alternate = eat(tt._else) && eat(tt.colon) ? parseSuite() : null;
      return finishNode(node, "IfStatement");

    case tt._import: // Skipping from and import statements for now
      skipLine();
      next();
      return parseStatement();

    case tt.newline:
      // TODO: parseStatement() should probably eat it's own newline
      next();
      return null;

    case tt._pass:
      next();
      return finishNode(node, "EmptyStatement");

    case tt._return:
      next();
      if (token.type === tt.newline || token.type === tt.eof) node.argument = null;
      else { node.argument = parseExpression(); }
      return finishNode(node, "ReturnStatement"); 

    case tt._while:
      next();
      if (token.type === tt.parenL) node.test = parseParenExpression();
      else node.test = parseExpression();
      expect(tt.colon);
      node.body = parseSuite();
      return finishNode(node, "WhileStatement");

    case tt.semi:
      next();
      return finishNode(node, "EmptyStatement");

    case tt.indent:
      // Unexpected indent, let's ignore it
      indentHist.undoIndent();
      next();
      return parseStatement();

    default:
      var expr = parseExpression();
      if (isDummy(expr)) {
        next();
        if (token.type === tt.eof) return finishNode(node, "EmptyStatement");
        return parseStatement();
      } else if (expr.type === "VariableDeclaration" || expr.type === "BlockStatement") {
        return expr;
      } else {
        node.expression = expr;
        return finishNode(node, "ExpressionStatement");
      }
    }
  }

  function parseSuite() {
    var node = startNode();
    node.body = [];
    if (eat(tt.newline)) {
      eat(tt.indent);
      while (!eat(tt.dedent) && token.type !== tt.eof) {
        var stmt = parseStatement();
        if (stmt) node.body.push(stmt);
      }
    } else {
      node.body.push(parseStatement());
      next();
    }
    return finishNode(node, "BlockStatement");
  }

  function parseFor(node) {
    var init = parseExpression(false, true);
    var tupleArgs = getTupleArgs(init);
    if (!tupleArgs) checkLVal(init);
    expect(tt._in);
    var right = parseExpression();
    expect(tt.colon);
    var body = parseSuite();
    finishNode(node, "BlockStatement");
    return nc.createFor(node, init, tupleArgs, right, body);
  }

  // ### Expression parsing

  function parseExpression(noComma, noIn) {
    return parseMaybeAssign(noIn);
  }

  function parseParenExpression() {
    expect(tt.parenL);
    var val = parseExpression();
    expect(tt.parenR);
    return val;
  }

  function parseMaybeAssign(noIn) {
    var left = parseMaybeTuple(noIn);
    if (token.type.isAssign) {
      var tupleArgs = getTupleArgs(left);
      if (tupleArgs) {
        next();
        var right = parseMaybeTuple(noIn);
        var blockNode = startNodeFrom(left);
        blockNode.body = unpackTuple(tupleArgs, right);
        return finishNode(blockNode, "BlockStatement");
      }

      if (scope.isClass()) {
        var thisExpr = nc.createNodeFrom(left, "ThisExpression");
        left = nc.createNodeFrom(left, "MemberExpression", { object: thisExpr, property: left });
      }

      var node = startNodeFrom(left);
      node.operator = token.value;
      node.left = checkLVal(left);
      next();
      node.right = parseMaybeTuple(noIn);

      if (node.operator === '+=' || node.operator === '*=') {
        var right = nc.createNodeSpan(node.right, node.right, "CallExpression");
        right.callee = nc.createNodeOpsCallee(right, node.operator === '+=' ? "add" : "multiply");
        right.arguments = [left, node.right];
        node.right = right;
        node.operator = '=';
      }

      if (left.type === "Identifier" && !scope.exists(left.name)) {
        scope.addVar(left.name);
        return nc.createVarDeclFromId(node.left, node.left, node.right);
      }

      return finishNode(node, "AssignmentExpression");
    }
    return left;
  }

  function parseMaybeTuple(noIn) {
    var expr = parseExprOps(noIn);
    if (token.type === tt.comma) {
      return parseTuple(noIn, expr);
    }
    return expr;
  }

  function parseExprOps(noIn) {
    return parseExprOp(parseMaybeUnary(noIn), -1, noIn);
  }

  function parseExprOp(left, minPrec, noIn) {
    var node, exprNode, right, op = token.type, val = token.value;
    var prec = op === tt._not ? tt._in.prec : op.prec;
    if (op === tt.exponentiation && prec >= minPrec) {
      node = startNodeFrom(left);
      next();
      right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
      exprNode = nc.createNodeMemberCall(node, "Math", "pow", [left, right]);
      return parseExprOp(exprNode, minPrec, noIn);
    } else if (prec != null && (!noIn || op !== tt._in)) {
      if (prec > minPrec) {
        next();
        node = startNodeFrom(left);
        if (op === tt.floorDiv) {
          right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
          finishNode(node);
          var binExpr = nc.createNodeSpan(node, node, "BinaryExpression", { left: left, operator: '/', right: right });
          exprNode = nc.createNodeMemberCall(node, "Math", "floor", [binExpr]);
        } else if (op === tt._in || op === tt._not) {
          if (op === tt._in || eat(tt._in)) {
            right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
            finishNode(node);
            var notLit = nc.createNodeSpan(node, node, "Literal", { value: op === tt._not });
            exprNode = nc.createNodeRuntimeCall(node, 'ops', 'in', [left, right, notLit]);
          } else exprNode = dummyIdent();
        } else if (op === tt.plusMin && val === '+' || op === tt.multiplyModulo && val === '*') {
          node.arguments = [left];
          node.arguments.push(parseExprOp(parseMaybeUnary(noIn), prec, noIn));
          finishNode(node, "CallExpression");
          node.callee = nc.createNodeOpsCallee(node, op === tt.plusMin ? "add" : "multiply");
          exprNode = node;
        } else {
          if (op === tt._is) {
            if (eat(tt._not)) node.operator = "!==";
            else node.operator = "===";
          } else node.operator = op.rep != null ? op.rep : val;

          // Accept '===' as '=='
          if (input[token.start - 1] === '=' && input[token.start - 2] === '=') next();

          node.left = left;
          node.right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
          exprNode = finishNode(node, (op === tt._or || op === tt._and) ? "LogicalExpression" : "BinaryExpression");
        }
        return parseExprOp(exprNode, minPrec, noIn);
      }
    }
    return left;
  }

  function parseMaybeUnary(noIn) {
    if (token.type.prefix || token.type === tt.plusMin) {
      var prec = token.type === tt.plusMin ? tt.posNegNot.prec : token.type.prec;
      var node = startNode();
      node.operator = token.type.rep != null ? token.type.rep : token.value;
      node.prefix = true;
      next();
      node.argument = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
      return finishNode(node, "UnaryExpression");
    }
    return parseSubscripts(parseExprAtom(), false);
  }

  function parseSubscripts(base, noCalls) {
    var node = startNodeFrom(base);
    if (eat(tt.dot)) {
      var id = parseIdent(true);
      if (filbert.pythonRuntime.imports[base.name] && filbert.pythonRuntime.imports[base.name][id.name]) {
        // Calling a Python import function
        var runtimeId = nc.createNodeSpan(base, base, "Identifier", { name: options.runtimeParamName });
        var importsId = nc.createNodeSpan(base, base, "Identifier", { name: "imports" });
        var runtimeMember = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeId, property: importsId, computed: false });
        node.object = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeMember, property: base, computed: false });
      } else if (base.name && base.name === scope.getThisReplace()) {
        node.object = nc.createNodeSpan(base, base, "ThisExpression");
      } else node.object = base;
      node.property = id;
      node.computed = false;
      return parseSubscripts(finishNode(node, "MemberExpression"), noCalls);
    } else if (eat(tt.bracketL)) {
      var expr, isSlice = false;
      if (eat(tt.colon)) isSlice = true;
      else expr = parseExpression();
      if (!isSlice && eat(tt.colon)) isSlice = true;
      if (isSlice) return parseSlice(node, base, expr, noCalls);
      var subscriptCall = nc.createNodeSpan(expr, expr, "CallExpression");
      subscriptCall.callee = nc.createNodeOpsCallee(expr, "subscriptIndex");
      subscriptCall.arguments = [base, expr];
      node.object = base;
      node.property = subscriptCall;
      node.computed = true;
      expect(tt.bracketR);
      return parseSubscripts(finishNode(node, "MemberExpression"), noCalls);
    } else if (!noCalls && eat(tt.parenL)) {
      if (scope.isUserFunction(base.name)) {
        // Unpack parameters into JavaScript-friendly parameters, further processed at runtime
        var createParamsCall = nc.createNodeRuntimeCall(node, 'utils', 'createParamsObj', parseParamsList());
        node.arguments = [createParamsCall];
      } else node.arguments = parseExprList(tt.parenR, false);
      
      if (scope.isNewObj(base.name)) finishNode(node, "NewExpression");
      else finishNode(node, "CallExpression");
      if (filbert.pythonRuntime.functions[base.name]) {
        // Calling a Python built-in function
        var runtimeId = nc.createNodeSpan(base, base, "Identifier", { name: options.runtimeParamName });
        var functionsId = nc.createNodeSpan(base, base, "Identifier", { name: "functions" });
        var runtimeMember = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeId, property: functionsId, computed: false });
        node.callee = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeMember, property: base, computed: false });
      } else node.callee = base;
      return parseSubscripts(node, noCalls);
    }
    return base;
  }

  function parseSlice(node, base, start, noCalls) {
    var end, step;
    if (!start) start = nc.createNodeFrom(node, "Literal", { value: null });
    if (token.type === tt.bracketR || eat(tt.colon)) {
      end = nc.createNodeFrom(node, "Literal", { value: null });
    } else {
      end = parseExpression();
      if (token.type !== tt.bracketR) expect(tt.colon);
    }
    if (token.type === tt.bracketR) step = nc.createNodeFrom(node, "Literal", { value: null });
    else step = parseExpression();
    expect(tt.bracketR);

    node.arguments = [start, end, step];
    var sliceId = nc.createNodeFrom(base, "Identifier", { name: "_pySlice" });
    var memberExpr = nc.createNodeSpan(base, base, "MemberExpression", { object: base, property: sliceId, computed: false });
    node.callee = memberExpr;
    return parseSubscripts(finishNode(node, "CallExpression"), noCalls);
  }

  function parseExprAtom() {
    switch (token.type) {

    case tt._dict:
      next();
      return parseDict(tt.parenR);

    case tt.name:
      return parseIdent();

    case tt.num: case tt.string: case tt.regexp:
      var node = startNode();
      node.value = token.value;
      node.raw = input.slice(token.start, token.end);
      next();
      return finishNode(node, "Literal");

    case tt._None: case tt._True: case tt._False:
      var node = startNode();
      node.value = token.type.atomValue;
      node.raw = token.type.keyword;
      next();
      return finishNode(node, "Literal");

    case tt.parenL:
      var tokStartLoc1 = token.startLoc, tokStart1 = token.start;
      next();
      if (token.type === tt.parenR) {
        var node = parseTuple(true);
        eat(tt.parenR);
        return node;
      }
      var val = parseMaybeTuple(true);
      if (options.locations) {
        val.loc.start = tokStartLoc1;
        val.loc.end = token.endLoc;
      }
      if (options.ranges)
        val.range = [tokStart1, token.end];
      expect(tt.parenR);
      return val;

    case tt.bracketL:
      return parseList();

    case tt.braceL:
      return parseDict(tt.braceR);

    default:
      return dummyIdent();
    }
  }

  // Parse list

  // Custom list object is used to simulate native Python list
  // E.g. Python '[]' becomes JavaScript 'new __pythonRuntime.objects.list();'
  // If list comprehension, build something like this:
  //(function() {
  //  var _list = [];
  //  ...
  //  _list.push(expr);
  //  return _list;
  //}());

  function parseList() {
    var node = startNode();
    node.arguments = [];
    next();

    if (!eat(tt.bracketR)) {
      var expr = parseExprOps(false);
      if (token.type === tt._for || token.type === tt._if) {

        // List comprehension
        var tmpVarSuffix = newAstIdCount++;
        expr = nc.createListCompPush(expr, tmpVarSuffix);
        var body = parseCompIter(expr, true);
        finishNode(node);
        return nc.createListCompIife(node, body, tmpVarSuffix);

      } else if (eat(tt.comma)) {
        node.arguments = [expr].concat(parseExprList(tt.bracketR, true, false));
      }
      else {
        expect(tt.bracketR);
        node.arguments = [expr];
      }
    }

    finishNode(node, "NewExpression");
    var runtimeId = nc.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
    var objectsId = nc.createNodeSpan(node, node, "Identifier", { name: "objects" });
    var runtimeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: objectsId, computed: false });
    var listId = nc.createNodeSpan(node, node, "Identifier", { name: "list" });
    node.callee = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeMember, property: listId, computed: false });
    return node;
  }

  // Parse a comp_iter from Python language grammar
  // 'expr' is the body to be used after unrolling the ifs and fors

  function parseCompIter(expr, first) {
    if (first && token.type !== tt._for) return dummyIdent();
    if (eat(tt.bracketR)) return expr;
    var node = startNode();
    if (eat(tt._for)) {
      var init = parseExpression(false, true);
      var tupleArgs = getTupleArgs(init);
      if (!tupleArgs) checkLVal(init);
      expect(tt._in);
      var right = parseExpression();
      var body = parseCompIter(expr, false);
      var block = nc.createNodeSpan(body, body, "BlockStatement", { body: [body] });
      finishNode(node, "BlockStatement");
      return nc.createFor(node, init, tupleArgs, right, block);
    } else if (eat(tt._if)) {
      if (token.type === tt.parenL) node.test = parseParenExpression();
      else node.test = parseExpression();
      node.consequent = parseCompIter(expr, false);
      return finishNode(node, "IfStatement");
    } else return dummyIdent();
  }

  // Parse class

  function parseClass(ctorNode) {
    // Container for class constructor and prototype functions
    var container = startNodeFrom(ctorNode);
    container.body = [];

    // Parse class signature
    ctorNode.id = parseIdent();
    ctorNode.params = [];
    var classParams = [];
    if (eat(tt.parenL)) {
      var first = true;
      while (!eat(tt.parenR) && token.type !== tt.eof) {
        if (!first) expect(tt.comma); else first = false;
        classParams.push(parseIdent());
      }
    }
    expect(tt.colon);

    // Start new namespace for class body
    scope.startClass(ctorNode.id.name);

    // Save a reference for source ranges
    var classBodyRefNode = finishNode(startNode());

    // Parse class body
    var classBlock = parseSuite();

    // Generate additional AST to implement class
    var classStmt = nc.createClass(container, ctorNode, classParams, classBodyRefNode, classBlock);

    scope.end();

    return classStmt;
  }

  // Parse dictionary
  // Custom dict object used to simulate native Python dict
  // E.g. "{'k1':'v1', 'k2':'v2'}" becomes "new __pythonRuntime.objects.dict(['k1', 'v1'], ['k2', 'v2']);"

  function parseDict(tokClose) {
    var node = startNode(), first = true, key, value;
    node.arguments = [];
    next();
    while (!eat(tokClose) && !eat(tt.newline) && token.type !== tt.eof) {
      if (!first) {
        expect(tt.comma);
      } else first = false;

      if (tokClose === tt.braceR) {
        key = parsePropertyName();
        expect(tt.colon);
        value = parseExprOps(false);
      } else if (tokClose === tt.parenR) {
        var keyId = parseIdent(true);
        key = startNodeFrom(keyId);
        key.value = keyId.name;
        finishNode(key, "Literal");
        expect(tt.eq);
        value = parseExprOps(false);
      }
      node.arguments.push(nc.createNodeSpan(key, value, "ArrayExpression", { elements: [key, value] }));
    }
    finishNode(node, "NewExpression");

    var runtimeId = nc.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
    var objectsId = nc.createNodeSpan(node, node, "Identifier", { name: "objects" });
    var runtimeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: objectsId, computed: false });
    var listId = nc.createNodeSpan(node, node, "Identifier", { name: "dict" });
    node.callee = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeMember, property: listId, computed: false });

    return node;
  }

  function parsePropertyName() {
    if (token.type === tt.num || token.type === tt.string) return parseExprAtom();
    if (token.type === tt.name || token.type.keyword) return parseIdent();
  }

  function parseIdent() {
    var node = startNode();
    node.name = token.type === tt.name ? token.value : token.type.keyword;
    if (!node.name) node = dummyIdent();
    next();
    return finishNode(node, "Identifier");
  }

  function parseFunction(node) {
    var suffix = newAstIdCount++;
    node.id = parseIdent();
    node.params = [];

    // Parse parameters

    var formals = [];     // In order, maybe with default value
    var argsId = null;    // *args
    var kwargsId = null;  // **kwargs
    var first = true;
    expect(tt.parenL);
    while (!eat(tt.parenR) && token.type !== tt.eof) {
      if (!first) expect(tt.comma); else first = false;
      if (token.value === '*') {
        next(); argsId = parseIdent();
      } else if (token.value === '**') {
        next(); kwargsId = parseIdent();
      } else {
        var paramId = parseIdent();
        if (eat(tt.eq))
          formals.push({ id: paramId, expr: parseExprOps(false) });
        else
          formals.push({ id: paramId, expr: null });
      }
    }
    expect(tt.colon);

    scope.startFn(node.id.name);

    // If class method, remove class instance var from params and save for 'this' replacement
    if (scope.isParentClass()) {
      var selfId = formals.shift();
      scope.setThisReplace(selfId.id.name);
    }

    var body = parseSuite();
    node.body = nc.createNodeSpan(body, body, "BlockStatement", { body: [] });

    // Add runtime parameter processing

    if (formals.length > 0 || argsId || kwargsId) {
      node.body.body.push(nc.createNodeParamsCheck(node.id, suffix));
      node.body.body.push(nc.createVarDeclFromId(node.id,
        nc.createNodeSpan(node.id, node.id, "Identifier", { name: '__formalsIndex' + suffix }),
        nc.createNodeSpan(node.id, node.id, "Literal", { value: 0 })));
      node.body.body.push(nc.createVarDeclFromId(node.id,
        nc.createNodeSpan(node.id, node.id, "Identifier", { name: '__args' + suffix }),
        nc.createNodeSpan(node.id, node.id, "Identifier", { name: 'arguments' })));
    }
    if (formals.length > 0) {
      node.body.body.push(nc.createNodeGetParamFn(node.id, suffix));
      for (var i = 0; i < formals.length; i++) {
        var __getParamCall = nc.createNodeSpan(formals[i].id, formals[i].id, "CallExpression", {
          callee: nc.createNodeSpan(formals[i].id, formals[i].id, "Identifier", { name: '__getParam' + suffix }),
          arguments: [nc.createNodeSpan(formals[i].id, formals[i].id, "Literal", { value: formals[i].id.name })]
        });
        if (formals[i].expr) __getParamCall.arguments.push(formals[i].expr);
        node.body.body.push(nc.createVarDeclFromId(formals[i].id, formals[i].id, __getParamCall));
      }
    }
    var refNode = argsId || kwargsId;
    if (refNode) {
      if (argsId) {
        var argsAssign = nc.createVarDeclFromId(argsId, argsId, nc.createNodeSpan(argsId, argsId, "ArrayExpression", { elements: [] }));
        node.body.body.push(argsAssign);
      }
      if (kwargsId) {
        var kwargsAssign = nc.createVarDeclFromId(kwargsId, kwargsId, nc.createNodeSpan(kwargsId, kwargsId, "ObjectExpression", { properties: [] }));
        node.body.body.push(kwargsAssign);
      }
      var argsIf = nc.createNodeSpan(refNode, refNode, "IfStatement", {
        test: nc.createNodeSpan(refNode, refNode, "Identifier", { name: '__params' + suffix }),
        consequent: nc.createNodeSpan(refNode, refNode, "BlockStatement", { body: [] })
      })
      if (argsId) {
        argsIf.consequent.body.push(nc.createNodeArgsWhileConsequent(argsId, suffix));
        argsIf.alternate = nc.createNodeArgsAlternate(argsId);
      }
      if (kwargsId) {
        argsIf.consequent.body.push(nc.createNodeSpan(kwargsId, kwargsId, "ExpressionStatement", {
          expression: nc.createNodeSpan(kwargsId, kwargsId, "AssignmentExpression", {
            operator: '=', left: kwargsId, right: nc.createNodeMembIds(kwargsId, '__params' + suffix, 'keywords'),
          })
        }));
      }
      node.body.body.push(argsIf);
    }
    node.body.body.push(nc.createNodeFnBodyIife(body));

    // If class method, replace with prototype function literals
    var retNode;
    if (scope.isParentClass()) {
      finishNode(node);
      var classId = nc.createNodeSpan(node, node, "Identifier", { name: scope.getParentClassName() });
      var prototypeId = nc.createNodeSpan(node, node, "Identifier", { name: "prototype" });
      var functionId = node.id;
      var prototypeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: classId, property: prototypeId, computed: false });
      var functionMember = nc.createNodeSpan(node, node, "MemberExpression", { object: prototypeMember, property: functionId, computed: false });
      var functionExpr = nc.createNodeSpan(node, node, "FunctionExpression", { body: node.body, params: node.params });
      var assignExpr = nc.createNodeSpan(node, node, "AssignmentExpression", { left: functionMember, operator: "=", right: functionExpr });
      retNode = nc.createNodeSpan(node, node, "ExpressionStatement", { expression: assignExpr });
    } else retNode = finishNode(node, "FunctionDeclaration");

    scope.end();

    return retNode;
  }

  function parseExprList(close) {
    var elts = [];
    while (!eat(close) && !eat(tt.newline) && token.type !== tt.eof) {
      var elt = parseExprOps(false);
      if (isDummy(elt)) {
        next();
      } else {
        elts.push(elt);
      }
      while (eat(tt.comma)) {}
    }
    return elts;
  }

  function parseParamsList() {
    var elts = [], first = true;
    while (!eat(tt.parenR) && !eat(tt.newline) && token.type !== tt.eof) {
      if (!first) expect(tt.comma);
      else first = false;
      var expr = parseExprOps(false);
      if (eat(tt.eq)) {
        var right = parseExprOps(false);
        var kwId = nc.createNodeSpan(expr, right, "Identifier", { name: "__kwp" });
        var kwLit = nc.createNodeSpan(expr, right, "Literal", { value: true });
        var left = nc.createNodeSpan(expr, right, "ObjectExpression", { properties: [] });
        left.properties.push({ type: "Property", key: expr, value: right, kind: "init" });
        left.properties.push({ type: "Property", key: kwId, value: kwLit, kind: "init" });
        expr = left;
      }
      elts.push(expr);
    }
    return elts;
  }

  function parseTuple(noIn, expr) {
    var node = expr ? startNodeFrom(expr) : startNode();
    node.arguments = expr ? [expr] : [];

    // Tuple with single element has special trailing comma: t = 'hi',
    // Look ahead and eat comma in this scenario
    if (token.type === tt.comma) {
      var pos = token.start + 1;
      while (isSpace(input.charCodeAt(pos))) ++pos;
      if (pos >= inputLen || input[pos] === ';' || input[pos] === ')' || isNewline(input.charCodeAt(pos)))
        eat(tt.comma);
    }

    while (eat(tt.comma)) {
      node.arguments.push(parseExprOps(noIn));
    }
    finishNode(node, "NewExpression");

    var runtimeId = nc.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
    var objectsId = nc.createNodeSpan(node, node, "Identifier", { name: "objects" });
    var runtimeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: objectsId, computed: false });
    var listId = nc.createNodeSpan(node, node, "Identifier", { name: "tuple" });
    node.callee = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeMember, property: listId, computed: false });

    return node;
  }
});

TarGZ = function(){};

// Load and parse archive, calls onload after loading all files.
TarGZ.load = function(url, onload, onstream, onerror) 
{
  var o = new TarGZ();
  o.onload = onload;
  o.onerror = onerror;
  o.onstream = onstream;
  o.load(url);
  return o;
};

// Streams an archive from the given url, calling onstream after loading each file in archive.
// Calls onload after loading all files.
TarGZ.stream = function(url, onstream, onload, onerror) 
{
  var o = new TarGZ();
  o.onload = onload;
  o.onerror = onerror;
  o.onstream = onstream;
  o.load(url);
  return o;
};

TarGZ.prototype = {
  onerror : null,
  onload : null,
  onstream : null,
  ondata : null,
  
  load : function(url) {
    var self = this;
    var offset = {chunkBytes: 0, chunks: 0};
    var byteOffset = 0;
    this.files = [];
    GZip.load(url,
      function(h) {
        byteOffset = self.processTarChunks(h.data, byteOffset, h.outputSize);
        if (self.onload)
          self.onload(self.files, h);
      },
      function(h) {
        self.gzip = h;
        if (self.ondata) self.ondata(h);
        byteOffset = self.processTarChunks(h.data, byteOffset, h.outputSize);
      },
      function(xhr, e, h) {
        if (self.onerror)
          self.onerror(xhr, e, h);
      }
    );
  },
 
  cleanHighByte : function(s) {
    return s.replace(/./g, function(m) { 
      return String.fromCharCode(m.charCodeAt(0) & 0xff);
    });
  },
  
  parseTar : function(text) {
    this.files = [];
    this.processTarChunks([text], 0, text.length);
  },
  processTarChunks : function (chunks, offset, totalSize) {
    while (totalSize >= offset + 512) {
      var header = this.files.length == 0 ? null : this.files[this.files.length-1];
      if (header && header.data == null) {
        if (offset + header.length <= totalSize) {
          header.data = this.chunkSubstring(chunks, offset, offset+header.length);
          header.toDataURL = this.__toDataURL;
          offset += 512 * Math.ceil(header.length / 512);
          if (this.onstream) 
            this.onstream(header, this.gzip);
        } else { // not loaded yet
          break;
        }
      } else {
        var s = this.chunkSubstring(chunks, offset, offset+512);
        var header = this.parseTarHeader(s, 0);
        if (header.length > 0 || header.filename != '') {
          this.files.push(header);
          offset += 512;
          header.offset = offset;
        } else { // empty header, stop processing
          offset = totalSize;
        }
      }
    }
    return offset;
  },
  parseTarHeader : function(text, offset) {
    var i = offset || 0;
    var h = {};
    h.filename = text.substring(i, i+=100).split("\0", 1)[0];
    h.mode = text.substring(i, i+=8).split("\0", 1)[0];
    h.uid = text.substring(i, i+=8).split("\0", 1)[0];
    h.gid = text.substring(i, i+=8).split("\0", 1)[0];
    h.length = this.parseTarNumber(text.substring(i, i+=12));
    h.lastModified = text.substring(i, i+=12).split("\0", 1)[0];
    h.checkSum = text.substring(i, i+=8).split("\0", 1)[0];
    h.fileType = text.substring(i, i+=1).split("\0", 1)[0];
    h.linkName = text.substring(i, i+=100).split("\0", 1)[0];
    return h;
  },
  parseTarNumber : function(text) {
    // if (text.charCodeAt(0) & 0x80 == 1) {
    // GNU tar 8-byte binary big-endian number
    // } else {
      return parseInt(text.replace(/[^\d]/g, ''), 8);
    // }
  },

  // extract substring from an array of strings
  chunkSubstring : function (chunks, start, end) {
    var soff=0, eoff=0, i=0, j=0;
    for (i=0; i<chunks.length; i++) {
      if (soff + chunks[i].length > start)
        break;
      soff += chunks[i].length;
    }
    var strs = [];
    eoff = soff;
    for (j=i; j<chunks.length; j++) {
      strs.push(chunks[j]);
      if (eoff + chunks[j].length > end)
        break;
      eoff += chunks[j].length;
    }
    var s = strs.join('');
    return s.substring(start-soff, start-soff+(end-start));
  },

  __toDataURL : function() {
    if (this.data.substring(0,40).match(/^data:[^\/]+\/[^,]+,/)) {
      return this.data;
    } else if (TarGZ.prototype.cleanHighByte(this.data.substring(0,10)).match(/\377\330\377\340..JFIF/)) {
      return 'data:image/jpeg;base64,'+btoa(TarGZ.prototype.cleanHighByte(this.data));
    } else if (TarGZ.prototype.cleanHighByte(this.data.substring(0,6)) == "\211PNG\r\n") {
      return 'data:image/png;base64,'+btoa(TarGZ.prototype.cleanHighByte(this.data));
    } else if (TarGZ.prototype.cleanHighByte(this.data.substring(0,6)).match(/GIF8[79]a/)) {
      return 'data:image/gif;base64,'+btoa(TarGZ.prototype.cleanHighByte(this.data));
    } else 
    {
      //console.log("toDataURL: I don't know how to handle " + this.filename);
      return 'data:audio/wav;base64,'+btoa(TarGZ.prototype.cleanHighByte(this.data));
    }
  }
};



Bin = {
  byte : function(s, offset) {
    return s.charCodeAt(offset) & 0xff;
  },

  UInt16BE : function(s, offset) {
    return ((Bin.byte(s, offset) << 8) | Bin.byte(s, offset+1));
  },

  UInt32BE : function(s, offset) {
    return (
      (Bin.byte(s, offset) << 24) |
      (Bin.byte(s, offset+1) << 16) |
      (Bin.byte(s, offset+2) << 8) |
       Bin.byte(s, offset+3));
  },

  UInt16LE : function(s, offset) {
    return ((Bin.byte(s, offset+1) << 8) | Bin.byte(s, offset));
  },

  UInt32LE : function(s, offset) {
    return (
      (Bin.byte(s, offset+3) << 24) |
      (Bin.byte(s, offset+2) << 16) |
      (Bin.byte(s, offset+1) << 8) |
       Bin.byte(s, offset));
  },

  CString : function(s, offset) {
    var zeroIdx = offset;
    for (; zeroIdx<s.length; zeroIdx++) {
      if (Bin.byte(s, zeroIdx) == 0)
        break;
    }
    if (zeroIdx == s.length)
      throw("No null byte encountered");
    return s.substring(offset, zeroIdx);
  },

  CRC16 : function(s, start, length, crc) {
    return crc32(s, start, length, crc) & 0xffff;
  },

  CRC32 : function(s, start, length, crc) {
    return crc32(s, start, length, crc);
  }
};

GZip = {
  DEFLATE:  8,
  FTEXT:    1 << 0,
  FHCRC:    1 << 1,
  FEXTRA:   1 << 2,
  FNAME:    1 << 3,
  FCOMMENT: 1 << 4,

  loadlocal : function(data, onload, onstream, onerror) 
  {
    var self = this;
    var h = null;
    var s = data;

    try 
    {
    	var t = new Date;
    	if (!h) h = self.parseHeader(s);
    	self.parseAllBody(s, h, onstream);
    	self.parseFooter(s, h);
    	var elapsed = new Date() - t;
    	h.decompressionTime += elapsed;
    } 
    catch(e) 
    {
        console.log('error');
        return;
    }
    if (onload)
	{
    	onload(h, null);
	}
  },	

  load : function(data, url, onload, onstream, onerror) 
  {
    var xhr = new XMLHttpRequest();
    var self = this;
    var h = null;
    xhr.onreadystatechange = function() {
      if (xhr.readyState == 4) {
        if (xhr.status == 200 || xhr.status == 0) {
          var s = xhr.responseText;

	      console.log('data');		
		  console.log(s);


          try {
            var t = new Date;
            if (!h) h = self.parseHeader(s);
            self.parseAllBody(s, h, onstream);
            self.parseFooter(s, h);
            var elapsed = new Date() - t;
            h.decompressionTime += elapsed;
          } catch(e) {
            onerror(xhr, e, h);
            return;
          }
          if (onload)
            onload(h, xhr);
        } else {
          if (onerror)
            onerror(xhr);
        }
      } else if (xhr.readyState == 3) {
        if (xhr.status == 200 || xhr.status == 0) {
          var s = xhr.responseText;
          if (s.length < 1024) return; // read in header
          try {
            var t = new Date;
            if (!h) h = self.parseHeader(s);
            self.parseBody(s, h, onstream);
            var elapsed = new Date() - t;
            h.decompressionTime += elapsed;
          } catch(e) {
            return;
          }
        }
      }
    };
    xhr.open("GET", url, true);
    xhr.overrideMimeType("text/plain; charset=x-user-defined");
    xhr.setRequestHeader("Content-Type", "text/plain");
    
    console.log('send');
    xhr.send(null);
  },

  parseHeader : function(s) {
    var h = {};
    h.decompressionTime = 0;
    h.id1 = Bin.byte(s,0);
    h.id2 = Bin.byte(s,1);
    h.compressionMethod = Bin.byte(s,2);
    if (h.id1 != 0x1f || h.id2 != 0x8b || h.compressionMethod != GZip.DEFLATE) {
      throw("Not a GZip file: " + h.id1 + ',' + h.id2 + ',' + h.compressionMethod);
    }
    h.flags = Bin.byte(s,3);
    h.mtime = Bin.UInt32LE(s, 4);
    h.extraFlags = Bin.byte(s, 8);
    h.operatingSystem = Bin.byte(s, 9);
    var offset = 10;
    if (h.flags & GZip.FEXTRA) {
      var xlen = Bin.UInt16LE(s, offset);
      offset += 2;
      h.extraField = s.substring(offset, offset+xlen);
      offset += xlen;
    }
    if (h.flags & GZip.FNAME) {
      h.filename = Bin.CString(s, offset);
      offset += h.filename.length + 1;
    }
    if (h.flags & GZip.FCOMMENT) {
      h.comment = Bin.CString(s, offset);
      offset += h.comment.length + 1;
    }
    h.computedHeaderCRC16 = Bin.CRC16(s, 0, offset, 0);
    if (h.flags & GZip.FHCRC) {
      h.headerCRC16 = Bin.UInt16LE(s, offset);
      if (h.computedHeaderCRC16 != null && h.headerCRC16 != h.computedHeaderCRC16)
        throw("Header CRC16 check failed");
      offset += 2;
    }
    h.offset = offset;
    h.data = [];
    h.outputSize = 0;
    h.inflater = new Inflater();
    h.inflater.start_inflate(h);
    return h;
  },
  
  parseBody : function(s, h, onstream) {
    h.inflater.continue_inflate(s, h, onstream);
    return h;
  },
  
  parseAllBody : function(s, h, onstream) {
    h.inflater.final_inflate(s, h, onstream);
    return h;
  },
  
  parseFooter : function(s, h) {
    h.CRC32 = Bin.UInt32LE(s, s.length-8);
    if (h.computedCRC32 && h.computedCRC32 != h.CRC32)
      throw("Data CRC32 check failed");
    h.inputSize = Bin.UInt32LE(s, s.length-4);
    if (h.data != null && h.inputSize != (h.outputSize % 0xffffffff))
      throw("Data length check failed");
    return h;
  }
};

/*   
=============================================================================== 
Crc32 is a JavaScript function for computing the CRC32 of a string 
............................................................................... 
 
Version: 1.2 - 2006/11 - http://noteslog.com/category/javascript/ 
 
------------------------------------------------------------------------------- 
Copyright (c) 2006 Andrea Ercolino 
http://www.opensource.org/licenses/mit-license.php 
=============================================================================== 
*/ 
 
(function() { 
    var table = "00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";
    var intTable = [];
    for (var i=0; i < table.length / 9; i++) {
      intTable.push(parseInt(table.substr( i*9, 8), 16));
    }
    /* Number */ 
    crc32 = function( /* String */ str, start, length, /* Number */ crc ) { 
        crc = crc ^ (-1);
        var end = Math.min(str.length, start + length);
        for( var i = start; i < end; i++ ) {
            var n = ( crc ^ str.charCodeAt( i ) ) & 0xFF; 
            crc = ( crc >>> 8 ) ^ intTable[n];
        } 
        return crc ^ (-1); 
    }; 
})();

/*
 * $Id: rawinflate.js,v 0.2 2009/03/01 18:32:24 dankogai Exp $
 *
 * original:
 * http://www.onicos.com/staff/iz/amuse/javascript/expert/inflate.txt
 */

Inflater = (function(){

/* Copyright (C) 1999 Masanao Izumo <iz@onicos.co.jp>
 * Version: 1.0.0.1
 * LastModified: Dec 25 1999
 */

/* Interface:
 * data = zip_inflate(src);
 */

/* constant parameters */
var zip_WSIZE = 32768;        // Sliding Window size
var zip_STORED_BLOCK = 0;
var zip_STATIC_TREES = 1;
var zip_DYN_TREES  = 2;

/* for inflate */
var zip_lbits = 9;         // bits in base literal/length lookup table
var zip_dbits = 6;         // bits in base distance lookup table
var zip_INBUFSIZ = 32768;    // Input buffer size
var zip_INBUF_EXTRA = 64;    // Extra buffer

/* variables (inflate) */
var zip_slide;
var zip_wp;            // current position in slide
var zip_fixed_tl = null;    // inflate static
var zip_fixed_td;        // inflate static
var zip_fixed_bl, fixed_bd;    // inflate static
var zip_bit_buf;        // bit buffer
var zip_bit_len;        // bits in bit buffer
var zip_method;
var zip_eof;
var zip_copy_leng;
var zip_copy_dist;
var zip_tl, zip_td;    // literal/length and distance decoder tables
var zip_bl, zip_bd;    // number of bits decoded by tl and td

var zip_inflate_data;
var zip_inflate_pos;


/* constant tables (inflate) */
var zip_MASK_BITS = new Array(
  0x0000,
  0x0001, 0x0003, 0x0007, 0x000f, 0x001f, 0x003f, 0x007f, 0x00ff,
  0x01ff, 0x03ff, 0x07ff, 0x0fff, 0x1fff, 0x3fff, 0x7fff, 0xffff);
// Tables for deflate from PKZIP's appnote.txt.
var zip_cplens = new Array( // Copy lengths for literal codes 257..285
  3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31,
  35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0);
/* note: see note #13 above about the 258 in this list. */
var zip_cplext = new Array( // Extra bits for literal codes 257..285
  0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2,
  3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, 99, 99); // 99==invalid
var zip_cpdist = new Array( // Copy offsets for distance codes 0..29
  1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193,
  257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145,
  8193, 12289, 16385, 24577);
var zip_cpdext = new Array( // Extra bits for distance codes
  0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6,
  7, 7, 8, 8, 9, 9, 10, 10, 11, 11,
  12, 12, 13, 13);
var zip_border = new Array(  // Order of the bit length code lengths
  16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15);
/* objects (inflate) */

var zip_HuftList = function() {
  this.next = null;
  this.list = null;
};

var zip_HuftNode = function() {
  this.e = 0; // number of extra bits or operation
  this.b = 0; // number of bits in this code or subcode

  // union
  this.n = 0; // literal, length base, or distance base
  this.t = null; // (zip_HuftNode) pointer to next level of table
};

var zip_HuftBuild = function(b,    // code lengths in bits (all assumed <= BMAX)
             n,    // number of codes (assumed <= N_MAX)
             s,    // number of simple-valued codes (0..s-1)
             d,    // list of base values for non-simple codes
             e,    // list of extra bits for non-simple codes
             mm    // maximum lookup bits
           ) {
  this.BMAX = 16;   // maximum bit length of any code
  this.N_MAX = 288; // maximum number of codes in any set
  this.status = 0;    // 0: success, 1: incomplete table, 2: bad input
  this.root = null;    // (zip_HuftList) starting table
  this.m = 0;        // maximum lookup bits, returns actual

/* Given a list of code lengths and a maximum table size, make a set of
   tables to decode that set of codes.    Return zero on success, one if
   the given code set is incomplete (the tables are still built in this
   case), two if the input is invalid (all zero length codes or an
   oversubscribed set of lengths), and three if not enough memory.
   The code with value 256 is special, and the tables are constructed
   so that no bits beyond that code are fetched when that code is
   decoded. */
  {
    var a;            // counter for codes of length k
    var c = new Array(this.BMAX+1);    // bit length count table
    var el;            // length of EOB code (value 256)
    var f;            // i repeats in table every f entries
    var g;            // maximum code length
    var h;            // table level
    var i;            // counter, current code
    var j;            // counter
    var k;            // number of bits in current code
    var lx = new Array(this.BMAX+1);    // stack of bits per table
    var p;            // pointer into c[], b[], or v[]
    var pidx;        // index of p
    var q;            // (zip_HuftNode) points to current table
    var r = new zip_HuftNode(); // table entry for structure assignment
    var u = new Array(this.BMAX); // zip_HuftNode[BMAX][]  table stack
    var v = new Array(this.N_MAX); // values in order of bit length
    var w;
    var x = new Array(this.BMAX+1);// bit offsets, then code stack
    var xp;            // pointer into x or c
    var y;            // number of dummy codes added
    var z;            // number of entries in current table
    var o;
    var tail;        // (zip_HuftList)

    tail = this.root = null;
    for(i = 0; i < c.length; i++)
      c[i] = 0;
    for(i = 0; i < lx.length; i++)
      lx[i] = 0;
    for(i = 0; i < u.length; i++)
      u[i] = null;
    for(i = 0; i < v.length; i++)
      v[i] = 0;
    for(i = 0; i < x.length; i++)
      x[i] = 0;

    // Generate counts for each bit length
    el = n > 256 ? b[256] : this.BMAX; // set length of EOB code, if any
    p = b; pidx = 0;
    i = n;
    do {
      c[p[pidx]]++;    // assume all entries <= BMAX
      pidx++;
    } while(--i > 0);
    if(c[0] == n) {    // null input--all zero length codes
      this.root = null;
      this.m = 0;
      this.status = 0;
      return;
    }

    // Find minimum and maximum length, bound *m by those
    for(j = 1; j <= this.BMAX; j++)
      if(c[j] != 0)
        break;
    k = j;            // minimum code length
    if(mm < j)
      mm = j;
    for(i = this.BMAX; i != 0; i--)
      if(c[i] != 0)
        break;
    g = i;            // maximum code length
    if(mm > i)
      mm = i;

    // Adjust last length count to fill out codes, if needed
    for(y = 1 << j; j < i; j++, y <<= 1)
      if((y -= c[j]) < 0) {
        this.status = 2;    // bad input: more codes than bits
        this.m = mm;
        return;
      }
    if((y -= c[i]) < 0) {
      this.status = 2;
      this.m = mm;
      return;
    }
    c[i] += y;

    // Generate starting offsets into the value table for each length
    x[1] = j = 0;
    p = c;
    pidx = 1;
    xp = 2;
    while(--i > 0)        // note that i == g from above
      x[xp++] = (j += p[pidx++]);

    // Make a table of values in order of bit lengths
    p = b; pidx = 0;
    i = 0;
    do {
      if((j = p[pidx++]) != 0)
        v[x[j]++] = i;
    } while(++i < n);
    n = x[g];            // set n to length of v

    // Generate the Huffman codes and for each, make the table entries
    x[0] = i = 0;        // first Huffman code is zero
    p = v; pidx = 0;        // grab values in bit order
    h = -1;            // no tables yet--level -1
    w = lx[0] = 0;        // no bits decoded yet
    q = null;            // ditto
    z = 0;            // ditto

    // go through the bit lengths (k already is bits in shortest code)
    for(; k <= g; k++) {
      a = c[k];
      while(a-- > 0) {
        // here i is the Huffman code of length k bits for value p[pidx]
        // make tables up to required level
        while(k > w + lx[1 + h]) {
          w += lx[1 + h]; // add bits already decoded
          h++;

          // compute minimum size table less than or equal to *m bits
          z = (z = g - w) > mm ? mm : z; // upper limit
          if((f = 1 << (j = k - w)) > a + 1) { // try a k-w bit table
            // too few codes for k-w bit table
            f -= a + 1;    // deduct codes from patterns left
            xp = k;
            while(++j < z) { // try smaller tables up to z bits
              if((f <<= 1) <= c[++xp])
                break;    // enough codes to use up j bits
              f -= c[xp];    // else deduct codes from patterns
            }
          }
          if(w + j > el && w < el)
            j = el - w;    // make EOB code end at table
          z = 1 << j;    // table entries for j-bit table
          lx[1 + h] = j; // set table size in stack

          // allocate and link in new table
          q = new Array(z);
          for(o = 0; o < z; o++) {
            q[o] = new zip_HuftNode();
          }

          if(tail == null)
            tail = this.root = new zip_HuftList();
          else
            tail = tail.next = new zip_HuftList();
          tail.next = null;
          tail.list = q;
          u[h] = q;    // table starts after link

          /* connect to last table, if there is one */
          if(h > 0) {
            x[h] = i;        // save pattern for backing up
            r.b = lx[h];    // bits to dump before this table
            r.e = 16 + j;    // bits in this table
            r.t = q;        // pointer to this table
            j = (i & ((1 << w) - 1)) >> (w - lx[h]);
            u[h-1][j].e = r.e;
            u[h-1][j].b = r.b;
            u[h-1][j].n = r.n;
            u[h-1][j].t = r.t;
          }
        }

        // set up table entry in r
        r.b = k - w;
        if(pidx >= n)
          r.e = 99;        // out of values--invalid code
        else if(p[pidx] < s) {
          r.e = (p[pidx] < 256 ? 16 : 15); // 256 is end-of-block code
          r.n = p[pidx++];    // simple code is just the value
        } else {
          r.e = e[p[pidx] - s];    // non-simple--look up in lists
          r.n = d[p[pidx++] - s];
        }

        // fill code-like entries with r //
        f = 1 << (k - w);
        for(j = i >> w; j < z; j += f) {
          q[j].e = r.e;
          q[j].b = r.b;
          q[j].n = r.n;
          q[j].t = r.t;
        }

        // backwards increment the k-bit code i
        for(j = 1 << (k - 1); (i & j) != 0; j >>= 1)
          i ^= j;
        i ^= j;

        // backup over finished tables
        while((i & ((1 << w) - 1)) != x[h]) {
          w -= lx[h];        // don't need to update q
          h--;
        }
      }
    }

    /* return actual size of base table */
    this.m = lx[1];

    /* Return true (1) if we were given an incomplete table */
    this.status = ((y != 0 && g != 1) ? 1 : 0);
  } /* end of constructor */
};


/* routines (inflate) */

var zip_GET_BYTE = function() {
  if(zip_inflate_data.length <= zip_inflate_pos)
    return -1;
  return zip_inflate_data.charCodeAt(zip_inflate_pos++) & 0xff;
};

var zip_NEEDBITS = function(n) {
  while(zip_bit_len < n) {
    zip_bit_buf |= zip_GET_BYTE() << zip_bit_len;
    zip_bit_len += 8;
  }
};

var zip_GETBITS = function(n) {
  return zip_bit_buf & zip_MASK_BITS[n];
};

var zip_DUMPBITS = function(n) {
  zip_bit_buf >>= n;
  zip_bit_len -= n;
};

var zip_inflate_codes = function(buff, off, size) {
  /* inflate (decompress) the codes in a deflated (compressed) block.
     Return an error code or zero if it all goes ok. */
  var e;        // table entry flag/number of extra bits
  var t;        // (zip_HuftNode) pointer to table entry
  var n;

  if(size == 0)
    return 0;

  // inflate the coded data
  n = 0;
  for(;;) {            // do until end of block
    zip_NEEDBITS(zip_bl);
    t = zip_tl.list[zip_GETBITS(zip_bl)];
    e = t.e;
    while(e > 16) {
      if(e == 99)
        return -1;
      zip_DUMPBITS(t.b);
      e -= 16;
      zip_NEEDBITS(e);
      t = t.t[zip_GETBITS(e)];
      e = t.e;
    }
    zip_DUMPBITS(t.b);

    if(e == 16) {        // then it's a literal
      zip_wp &= zip_WSIZE - 1;
      buff[off + n++] = zip_slide[zip_wp++] = t.n;
      if(n == size)
        return size;
      continue;
    }

    // exit if end of block
    if(e == 15)
      break;

    // it's an EOB or a length

    // get length of block to copy
    zip_NEEDBITS(e);
    zip_copy_leng = t.n + zip_GETBITS(e);
    zip_DUMPBITS(e);

    // decode distance of block to copy
    zip_NEEDBITS(zip_bd);
    t = zip_td.list[zip_GETBITS(zip_bd)];
    e = t.e;

    while(e > 16) {
      if(e == 99)
        return -1;
      zip_DUMPBITS(t.b);
      e -= 16;
      zip_NEEDBITS(e);
      t = t.t[zip_GETBITS(e)];
      e = t.e;
    }
    zip_DUMPBITS(t.b);
    zip_NEEDBITS(e);
    zip_copy_dist = zip_wp - t.n - zip_GETBITS(e);
    zip_DUMPBITS(e);

    // do the copy
    while(zip_copy_leng > 0 && n < size) {
      zip_copy_leng--;
      zip_copy_dist &= zip_WSIZE - 1;
      zip_wp &= zip_WSIZE - 1;
      buff[off + n++] = zip_slide[zip_wp++]
        = zip_slide[zip_copy_dist++];
    }

    if(n == size)
      return size;
  }

  zip_method = -1; // done
  return n;
};

var zip_inflate_stored = function(buff, off, size) {
  /* "decompress" an inflated type 0 (stored) block. */
  var n;

  // go to byte boundary
  n = zip_bit_len & 7;
  zip_DUMPBITS(n);

  // get the length and its complement
  zip_NEEDBITS(16);
  n = zip_GETBITS(16);
  zip_DUMPBITS(16);
  zip_NEEDBITS(16);
  if(n != ((~zip_bit_buf) & 0xffff))
    return -1;            // error in compressed data
  zip_DUMPBITS(16);

  // read and output the compressed data
  zip_copy_leng = n;

  n = 0;
  while(zip_copy_leng > 0 && n < size) {
    zip_copy_leng--;
    zip_wp &= zip_WSIZE - 1;
    zip_NEEDBITS(8);
    buff[off + n++] = zip_slide[zip_wp++] =
      zip_GETBITS(8);
    zip_DUMPBITS(8);
  }

  if(zip_copy_leng == 0)
    zip_method = -1; // done
  return n;
};

var zip_inflate_fixed = function(buff, off, size) {
  /* decompress an inflated type 1 (fixed Huffman codes) block.  We should
     either replace this with a custom decoder, or at least precompute the
     Huffman tables. */

  // if first time, set up tables for fixed blocks
  if(zip_fixed_tl == null) {
    var i;            // temporary variable
    var l = new Array(288);    // length list for huft_build
    var h;    // zip_HuftBuild

    // literal table
    for(i = 0; i < 144; i++)
      l[i] = 8;
    for(; i < 256; i++)
      l[i] = 9;
    for(; i < 280; i++)
      l[i] = 7;
    for(; i < 288; i++)    // make a complete, but wrong code set
      l[i] = 8;
    zip_fixed_bl = 7;

    h = new zip_HuftBuild(l, 288, 257, zip_cplens, zip_cplext,
                zip_fixed_bl);
    if(h.status != 0) {
      alert("HufBuild error: "+h.status);
      return -1;
    }
    zip_fixed_tl = h.root;
    zip_fixed_bl = h.m;

    // distance table
    for(i = 0; i < 30; i++)    // make an incomplete code set
      l[i] = 5;
    zip_fixed_bd = 5;

    h = new zip_HuftBuild(l, 30, 0, zip_cpdist, zip_cpdext, zip_fixed_bd);
    if(h.status > 1) {
      zip_fixed_tl = null;
      throw("HufBuild error: "+h.status);
      return -1;
    }
    zip_fixed_td = h.root;
    zip_fixed_bd = h.m;
  }

  zip_tl = zip_fixed_tl;
  zip_td = zip_fixed_td;
  zip_bl = zip_fixed_bl;
  zip_bd = zip_fixed_bd;
  return zip_inflate_codes(buff, off, size);
};

var zip_inflate_dynamic = function(buff, off, size) {
  // decompress an inflated type 2 (dynamic Huffman codes) block.
  var i;        // temporary variables
  var j;
  var l;        // last length
  var n;        // number of lengths to get
  var t;        // (zip_HuftNode) literal/length code table
  var nb;        // number of bit length codes
  var nl;        // number of literal/length codes
  var nd;        // number of distance codes
  var ll = new Array(286+30); // literal/length and distance code lengths
  var h;        // (zip_HuftBuild)

  for(i = 0; i < ll.length; i++)
    ll[i] = 0;

  // read in table lengths
  zip_NEEDBITS(5);
  nl = 257 + zip_GETBITS(5);    // number of literal/length codes
  zip_DUMPBITS(5);
  zip_NEEDBITS(5);
  nd = 1 + zip_GETBITS(5);    // number of distance codes
  zip_DUMPBITS(5);
  zip_NEEDBITS(4);
  nb = 4 + zip_GETBITS(4);    // number of bit length codes
  zip_DUMPBITS(4);
  if(nl > 286 || nd > 30)
    return -1;        // bad lengths

  // read in bit-length-code lengths
  for(j = 0; j < nb; j++)
  {
    zip_NEEDBITS(3);
    ll[zip_border[j]] = zip_GETBITS(3);
    zip_DUMPBITS(3);
  }
  for(; j < 19; j++)
    ll[zip_border[j]] = 0;

  // build decoding table for trees--single level, 7 bit lookup
  zip_bl = 7;
  h = new zip_HuftBuild(ll, 19, 19, null, null, zip_bl);
  if(h.status != 0)
    return -1;    // incomplete code set

  zip_tl = h.root;
  zip_bl = h.m;

  // read in literal and distance code lengths
  n = nl + nd;
  i = l = 0;
  while(i < n) {
    zip_NEEDBITS(zip_bl);
    t = zip_tl.list[zip_GETBITS(zip_bl)];
    j = t.b;
    zip_DUMPBITS(j);
    j = t.n;
    if(j < 16)        // length of code in bits (0..15)
      ll[i++] = l = j;    // save last length in l
    else if(j == 16) {    // repeat last length 3 to 6 times
      zip_NEEDBITS(2);
      j = 3 + zip_GETBITS(2);
      zip_DUMPBITS(2);
      if(i + j > n)
        return -1;
      while(j-- > 0)
        ll[i++] = l;
    } else if(j == 17) {    // 3 to 10 zero length codes
      zip_NEEDBITS(3);
      j = 3 + zip_GETBITS(3);
      zip_DUMPBITS(3);
      if(i + j > n)
        return -1;
      while(j-- > 0)
        ll[i++] = 0;
      l = 0;
    } else {        // j == 18: 11 to 138 zero length codes
      zip_NEEDBITS(7);
      j = 11 + zip_GETBITS(7);
      zip_DUMPBITS(7);
      if(i + j > n)
        return -1;
      while(j-- > 0)
        ll[i++] = 0;
      l = 0;
    }
  }

  // build the decoding tables for literal/length and distance codes
  zip_bl = zip_lbits;
  h = new zip_HuftBuild(ll, nl, 257, zip_cplens, zip_cplext, zip_bl);
  if(zip_bl == 0)    // no literals or lengths
    h.status = 1;
  if(h.status != 0) {
    if(h.status == 1)
      ;// **incomplete literal tree**
    return -1;        // incomplete code set
  }
  zip_tl = h.root;
  zip_bl = h.m;

  for(i = 0; i < nd; i++)
    ll[i] = ll[i + nl];
  zip_bd = zip_dbits;
  h = new zip_HuftBuild(ll, nd, 0, zip_cpdist, zip_cpdext, zip_bd);
  zip_td = h.root;
  zip_bd = h.m;

  if(zip_bd == 0 && nl > 257) {   // lengths but no distances
    // **incomplete distance tree**
    return -1;
  }

  if(h.status == 1) {
    ;// **incomplete distance tree**
  }
  if(h.status != 0)
    return -1;

  // decompress until an end-of-block code
  return zip_inflate_codes(buff, off, size);
};

var zip_inflate_start = function() {
  var i;

  if(zip_slide == null)
    zip_slide = new Array(2 * zip_WSIZE);
  zip_wp = 0;
  zip_bit_buf = 0;
  zip_bit_len = 0;
  zip_method = -1;
  zip_eof = false;
  zip_copy_leng = zip_copy_dist = 0;
  zip_tl = null;
};

var zip_inflate_internal = function(buff, off, size) {
  // decompress an inflated entry
  var n, i;

  n = 0;
  while(n < size) {
    if(zip_eof && zip_method == -1)
      return n;

    if(zip_copy_leng > 0) {
      if(zip_method != zip_STORED_BLOCK) {
        // STATIC_TREES or DYN_TREES
        while(zip_copy_leng > 0 && n < size) {
          zip_copy_leng--;
          zip_copy_dist &= zip_WSIZE - 1;
          zip_wp &= zip_WSIZE - 1;
          buff[off + n++] = zip_slide[zip_wp++] =
            zip_slide[zip_copy_dist++];
        }
      } else {
        while(zip_copy_leng > 0 && n < size) {
          zip_copy_leng--;
          zip_wp &= zip_WSIZE - 1;
          zip_NEEDBITS(8);
          buff[off + n++] = zip_slide[zip_wp++] = zip_GETBITS(8);
          zip_DUMPBITS(8);
        }
        if(zip_copy_leng == 0)
          zip_method = -1; // done
      }
      if(n == size)
        return n;
    }

    if(zip_method == -1) {
      if(zip_eof)
        break;

      // read in last block bit
      zip_NEEDBITS(1);
      if(zip_GETBITS(1) != 0)
        zip_eof = true;
      zip_DUMPBITS(1);

      // read in block type
      zip_NEEDBITS(2);
      zip_method = zip_GETBITS(2);
      zip_DUMPBITS(2);
      zip_tl = null;
      zip_copy_leng = 0;
    }

    switch(zip_method) {
      case 0: // zip_STORED_BLOCK
      i = zip_inflate_stored(buff, off + n, size - n);
      break;

      case 1: // zip_STATIC_TREES
      if(zip_tl != null)
        i = zip_inflate_codes(buff, off + n, size - n);
      else
        i = zip_inflate_fixed(buff, off + n, size - n);
      break;

      case 2: // zip_DYN_TREES
      if(zip_tl != null)
        i = zip_inflate_codes(buff, off + n, size - n);
      else
        i = zip_inflate_dynamic(buff, off + n, size - n);
      break;

      default: // error
      i = -1;
      break;
    }

    if(i == -1) {
      if(zip_eof)
        return 0;
      return -1;
    }
    n += i;
  }
  return n;
};

var final_data = false;
var start_inflate = function(h) {
  final_data = false;
  zip_inflate_start();
  zip_inflate_pos = h.offset;
  h.computedCRC32 = 0;
};
var continue_inflate = function(str, h, onstream) {
  var i, j;
  var BUFSZ = 4096;
  zip_inflate_data = str;
  if (!final_data && str.length <= zip_inflate_pos+BUFSZ+64)
    return h;

  var buff = new Array(BUFSZ);
  while((i = zip_inflate_internal(buff, 0, buff.length)) > 0) {
    var cbuf = new Array(i);
    for(j = 0; j < i; j++){
      cbuf[j] = String.fromCharCode(buff[j]);
    }
    var s = cbuf.join("");
    h.data.push(s);
    h.outputSize += s.length;
    h.offset = zip_inflate_pos;
    h.computedCRC32 = Bin.CRC32(s, 0, s.length, h.computedCRC32);
    if (!final_data && str.length <= zip_inflate_pos+BUFSZ+64)
      break;
  }
  zip_inflate_data = null; // G.C.
  if (onstream) onstream(h);
  return h;
};
var final_inflate = function(str, h, onstream) {
  final_data = true;
  continue_inflate(str, h, onstream);
};

this.inflate = function(str,h,onstream) {
  start_inflate(h);
  return final_inflate(str,h,onstream);
};
this.start_inflate = start_inflate;
this.continue_inflate = continue_inflate;
this.final_inflate = final_inflate;
});
/*  Prototype JavaScript framework, version 1.7.2
 *  (c) 2005-2010 Sam Stephenson
 *
 *  Prototype is freely distributable under the terms of an MIT-style license.
 *  For details, see the Prototype web site: http://www.prototypejs.org/
 *
 *--------------------------------------------------------------------------*/

var Prototype = {

  Version: '1.7.2',

  Browser: (function(){
    var ua = navigator.userAgent;
    var isOpera = Object.prototype.toString.call(window.opera) == '[object Opera]';
    return {
      IE:             !!window.attachEvent && !isOpera,
      Opera:          isOpera,
      WebKit:         ua.indexOf('AppleWebKit/') > -1,
      Gecko:          ua.indexOf('Gecko') > -1 && ua.indexOf('KHTML') === -1,
      MobileSafari:   /Apple.*Mobile/.test(ua)
    }
  })(),

  BrowserFeatures: {
    XPath: !!document.evaluate,

    SelectorsAPI: !!document.querySelector,

    ElementExtensions: (function() {
      var constructor = window.Element || window.HTMLElement;
      return !!(constructor && constructor.prototype);
    })(),
    SpecificElementExtensions: (function() {
      if (typeof window.HTMLDivElement !== 'undefined')
        return true;

      var div = document.createElement('div'),
          form = document.createElement('form'),
          isSupported = false;

      if (div['__proto__'] && (div['__proto__'] !== form['__proto__'])) {
        isSupported = true;
      }

      div = form = null;

      return isSupported;
    })()
  },

  ScriptFragment: '<script[^>]*>([\\S\\s]*?)<\/script\\s*>',
  JSONFilter: /^\/\*-secure-([\s\S]*)\*\/\s*$/,

  emptyFunction: function() { },

  K: function(x) { return x }
};

if (Prototype.Browser.MobileSafari)
  Prototype.BrowserFeatures.SpecificElementExtensions = false;
/* Based on Alex Arnell's inheritance implementation. */

var Class = (function() {

  var IS_DONTENUM_BUGGY = (function(){
    for (var p in { toString: 1 }) {
      if (p === 'toString') return false;
    }
    return true;
  })();

  function subclass() {};
  function create() {
    var parent = null, properties = $A(arguments);
    if (Object.isFunction(properties[0]))
      parent = properties.shift();

    function klass() {
      this.initialize.apply(this, arguments);
    }

    Object.extend(klass, Class.Methods);
    klass.superclass = parent;
    klass.subclasses = [];

    if (parent) {
      subclass.prototype = parent.prototype;
      klass.prototype = new subclass;
      parent.subclasses.push(klass);
    }

    for (var i = 0, length = properties.length; i < length; i++)
      klass.addMethods(properties[i]);

    if (!klass.prototype.initialize)
      klass.prototype.initialize = Prototype.emptyFunction;

    klass.prototype.constructor = klass;
    return klass;
  }

  function addMethods(source) {
    var ancestor   = this.superclass && this.superclass.prototype,
        properties = Object.keys(source);

    if (IS_DONTENUM_BUGGY) {
      if (source.toString != Object.prototype.toString)
        properties.push("toString");
      if (source.valueOf != Object.prototype.valueOf)
        properties.push("valueOf");
    }

    for (var i = 0, length = properties.length; i < length; i++) {
      var property = properties[i], value = source[property];
      if (ancestor && Object.isFunction(value) &&
          value.argumentNames()[0] == "$super") {
        var method = value;
        value = (function(m) {
          return function() { return ancestor[m].apply(this, arguments); };
        })(property).wrap(method);

        value.valueOf = (function(method) {
          return function() { return method.valueOf.call(method); };
        })(method);

        value.toString = (function(method) {
          return function() { return method.toString.call(method); };
        })(method);
      }
      this.prototype[property] = value;
    }

    return this;
  }

  return {
    create: create,
    Methods: {
      addMethods: addMethods
    }
  };
})();
(function() {

  var _toString = Object.prototype.toString,
      _hasOwnProperty = Object.prototype.hasOwnProperty,
      NULL_TYPE = 'Null',
      UNDEFINED_TYPE = 'Undefined',
      BOOLEAN_TYPE = 'Boolean',
      NUMBER_TYPE = 'Number',
      STRING_TYPE = 'String',
      OBJECT_TYPE = 'Object',
      FUNCTION_CLASS = '[object Function]',
      BOOLEAN_CLASS = '[object Boolean]',
      NUMBER_CLASS = '[object Number]',
      STRING_CLASS = '[object String]',
      ARRAY_CLASS = '[object Array]',
      DATE_CLASS = '[object Date]',
      NATIVE_JSON_STRINGIFY_SUPPORT = window.JSON &&
        typeof JSON.stringify === 'function' &&
        JSON.stringify(0) === '0' &&
        typeof JSON.stringify(Prototype.K) === 'undefined';



  var DONT_ENUMS = ['toString', 'toLocaleString', 'valueOf',
   'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor'];

  var IS_DONTENUM_BUGGY = (function(){
    for (var p in { toString: 1 }) {
      if (p === 'toString') return false;
    }
    return true;
  })();

  function Type(o) {
    switch(o) {
      case null: return NULL_TYPE;
      case (void 0): return UNDEFINED_TYPE;
    }
    var type = typeof o;
    switch(type) {
      case 'boolean': return BOOLEAN_TYPE;
      case 'number':  return NUMBER_TYPE;
      case 'string':  return STRING_TYPE;
    }
    return OBJECT_TYPE;
  }

  function extend(destination, source) {
    for (var property in source)
      destination[property] = source[property];
    return destination;
  }

  function inspect(object) {
    try {
      if (isUndefined(object)) return 'undefined';
      if (object === null) return 'null';
      return object.inspect ? object.inspect() : String(object);
    } catch (e) {
      if (e instanceof RangeError) return '...';
      throw e;
    }
  }

  function toJSON(value) {
    return Str('', { '': value }, []);
  }

  function Str(key, holder, stack) {
    var value = holder[key];
    if (Type(value) === OBJECT_TYPE && typeof value.toJSON === 'function') {
      value = value.toJSON(key);
    }

    var _class = _toString.call(value);

    switch (_class) {
      case NUMBER_CLASS:
      case BOOLEAN_CLASS:
      case STRING_CLASS:
        value = value.valueOf();
    }

    switch (value) {
      case null: return 'null';
      case true: return 'true';
      case false: return 'false';
    }

    var type = typeof value;
    switch (type) {
      case 'string':
        return value.inspect(true);
      case 'number':
        return isFinite(value) ? String(value) : 'null';
      case 'object':

        for (var i = 0, length = stack.length; i < length; i++) {
          if (stack[i] === value) {
            throw new TypeError("Cyclic reference to '" + value + "' in object");
          }
        }
        stack.push(value);

        var partial = [];
        if (_class === ARRAY_CLASS) {
          for (var i = 0, length = value.length; i < length; i++) {
            var str = Str(i, value, stack);
            partial.push(typeof str === 'undefined' ? 'null' : str);
          }
          partial = '[' + partial.join(',') + ']';
        } else {
          var keys = Object.keys(value);
          for (var i = 0, length = keys.length; i < length; i++) {
            var key = keys[i], str = Str(key, value, stack);
            if (typeof str !== "undefined") {
               partial.push(key.inspect(true)+ ':' + str);
             }
          }
          partial = '{' + partial.join(',') + '}';
        }
        stack.pop();
        return partial;
    }
  }

  function stringify(object) {
    return JSON.stringify(object);
  }

  function toQueryString(object) {
    return $H(object).toQueryString();
  }

  function toHTML(object) {
    return object && object.toHTML ? object.toHTML() : String.interpret(object);
  }

  function keys(object) {
    if (Type(object) !== OBJECT_TYPE) { throw new TypeError(); }
    var results = [];
    for (var property in object) {
      if (_hasOwnProperty.call(object, property))
        results.push(property);
    }

    if (IS_DONTENUM_BUGGY) {
      for (var i = 0; property = DONT_ENUMS[i]; i++) {
        if (_hasOwnProperty.call(object, property))
          results.push(property);
      }
    }

    return results;
  }

  function values(object) {
    var results = [];
    for (var property in object)
      results.push(object[property]);
    return results;
  }

  function clone(object) {
    return extend({ }, object);
  }

  function isElement(object) {
    return !!(object && object.nodeType == 1);
  }

  function isArray(object) {
    return _toString.call(object) === ARRAY_CLASS;
  }

  var hasNativeIsArray = (typeof Array.isArray == 'function')
    && Array.isArray([]) && !Array.isArray({});

  if (hasNativeIsArray) {
    isArray = Array.isArray;
  }

  function isHash(object) {
    return object instanceof Hash;
  }

  function isFunction(object) {
    return _toString.call(object) === FUNCTION_CLASS;
  }

  function isString(object) {
    return _toString.call(object) === STRING_CLASS;
  }

  function isNumber(object) {
    return _toString.call(object) === NUMBER_CLASS;
  }

  function isDate(object) {
    return _toString.call(object) === DATE_CLASS;
  }

  function isUndefined(object) {
    return typeof object === "undefined";
  }

  extend(Object, {
    extend:        extend,
    inspect:       inspect,
    toJSON:        NATIVE_JSON_STRINGIFY_SUPPORT ? stringify : toJSON,
    toQueryString: toQueryString,
    toHTML:        toHTML,
    keys:          Object.keys || keys,
    values:        values,
    clone:         clone,
    isElement:     isElement,
    isArray:       isArray,
    isHash:        isHash,
    isFunction:    isFunction,
    isString:      isString,
    isNumber:      isNumber,
    isDate:        isDate,
    isUndefined:   isUndefined
  });
})();
Object.extend(Function.prototype, (function() {
  var slice = Array.prototype.slice;

  function update(array, args) {
    var arrayLength = array.length, length = args.length;
    while (length--) array[arrayLength + length] = args[length];
    return array;
  }

  function merge(array, args) {
    array = slice.call(array, 0);
    return update(array, args);
  }

  function argumentNames() {
    var names = this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1]
      .replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g, '')
      .replace(/\s+/g, '').split(',');
    return names.length == 1 && !names[0] ? [] : names;
  }


  function bind(context) {
    if (arguments.length < 2 && Object.isUndefined(arguments[0]))
      return this;

    if (!Object.isFunction(this))
      throw new TypeError("The object is not callable.");

    var nop = function() {};
    var __method = this, args = slice.call(arguments, 1);

    var bound = function() {
      var a = merge(args, arguments);
      var c = this instanceof bound ? this : context;
      return __method.apply(c, a);
    };

    nop.prototype   = this.prototype;
    bound.prototype = new nop();

    return bound;
  }

  function bindAsEventListener(context) {
    var __method = this, args = slice.call(arguments, 1);
    return function(event) {
      var a = update([event || window.event], args);
      return __method.apply(context, a);
    }
  }

  function curry() {
    if (!arguments.length) return this;
    var __method = this, args = slice.call(arguments, 0);
    return function() {
      var a = merge(args, arguments);
      return __method.apply(this, a);
    }
  }

  function delay(timeout) {
    var __method = this, args = slice.call(arguments, 1);
    timeout = timeout * 1000;
    return window.setTimeout(function() {
      return __method.apply(__method, args);
    }, timeout);
  }

  function defer() {
    var args = update([0.01], arguments);
    return this.delay.apply(this, args);
  }

  function wrap(wrapper) {
    var __method = this;
    return function() {
      var a = update([__method.bind(this)], arguments);
      return wrapper.apply(this, a);
    }
  }

  function methodize() {
    if (this._methodized) return this._methodized;
    var __method = this;
    return this._methodized = function() {
      var a = update([this], arguments);
      return __method.apply(null, a);
    };
  }

  var extensions = {
    argumentNames:       argumentNames,
    bindAsEventListener: bindAsEventListener,
    curry:               curry,
    delay:               delay,
    defer:               defer,
    wrap:                wrap,
    methodize:           methodize
  };

  if (!Function.prototype.bind)
    extensions.bind = bind;

  return extensions;
})());



(function(proto) {


  function toISOString() {
    return this.getUTCFullYear() + '-' +
      (this.getUTCMonth() + 1).toPaddedString(2) + '-' +
      this.getUTCDate().toPaddedString(2) + 'T' +
      this.getUTCHours().toPaddedString(2) + ':' +
      this.getUTCMinutes().toPaddedString(2) + ':' +
      this.getUTCSeconds().toPaddedString(2) + 'Z';
  }


  function toJSON() {
    return this.toISOString();
  }

  if (!proto.toISOString) proto.toISOString = toISOString;
  if (!proto.toJSON) proto.toJSON = toJSON;

})(Date.prototype);


RegExp.prototype.match = RegExp.prototype.test;

RegExp.escape = function(str) {
  return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1');
};
var PeriodicalExecuter = Class.create({
  initialize: function(callback, frequency) {
    this.callback = callback;
    this.frequency = frequency;
    this.currentlyExecuting = false;

    this.registerCallback();
  },

  registerCallback: function() {
    this.timer = setInterval(this.onTimerEvent.bind(this), this.frequency * 1000);
  },

  execute: function() {
    this.callback(this);
  },

  stop: function() {
    if (!this.timer) return;
    clearInterval(this.timer);
    this.timer = null;
  },

  onTimerEvent: function() {
    if (!this.currentlyExecuting) {
      try {
        this.currentlyExecuting = true;
        this.execute();
        this.currentlyExecuting = false;
      } catch(e) {
        this.currentlyExecuting = false;
        throw e;
      }
    }
  }
});
Object.extend(String, {
  interpret: function(value) {
    return value == null ? '' : String(value);
  },
  specialChar: {
    '\b': '\\b',
    '\t': '\\t',
    '\n': '\\n',
    '\f': '\\f',
    '\r': '\\r',
    '\\': '\\\\'
  }
});

Object.extend(String.prototype, (function() {
  var NATIVE_JSON_PARSE_SUPPORT = window.JSON &&
    typeof JSON.parse === 'function' &&
    JSON.parse('{"test": true}').test;

  function prepareReplacement(replacement) {
    if (Object.isFunction(replacement)) return replacement;
    var template = new Template(replacement);
    return function(match) { return template.evaluate(match) };
  }

  function isNonEmptyRegExp(regexp) {
    return regexp.source && regexp.source !== '(?:)';
  }


  function gsub(pattern, replacement) {
    var result = '', source = this, match;
    replacement = prepareReplacement(replacement);

    if (Object.isString(pattern))
      pattern = RegExp.escape(pattern);

    if (!(pattern.length || isNonEmptyRegExp(pattern))) {
      replacement = replacement('');
      return replacement + source.split('').join(replacement) + replacement;
    }

    while (source.length > 0) {
      match = source.match(pattern)
      if (match && match[0].length > 0) {
        result += source.slice(0, match.index);
        result += String.interpret(replacement(match));
        source  = source.slice(match.index + match[0].length);
      } else {
        result += source, source = '';
      }
    }
    return result;
  }

  function sub(pattern, replacement, count) {
    replacement = prepareReplacement(replacement);
    count = Object.isUndefined(count) ? 1 : count;

    return this.gsub(pattern, function(match) {
      if (--count < 0) return match[0];
      return replacement(match);
    });
  }

  function scan(pattern, iterator) {
    this.gsub(pattern, iterator);
    return String(this);
  }

  function truncate(length, truncation) {
    length = length || 30;
    truncation = Object.isUndefined(truncation) ? '...' : truncation;
    return this.length > length ?
      this.slice(0, length - truncation.length) + truncation : String(this);
  }

  function strip() {
    return this.replace(/^\s+/, '').replace(/\s+$/, '');
  }

  function stripTags() {
    return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi, '');
  }

  function stripScripts() {
    return this.replace(new RegExp(Prototype.ScriptFragment, 'img'), '');
  }

  function extractScripts() {
    var matchAll = new RegExp(Prototype.ScriptFragment, 'img'),
        matchOne = new RegExp(Prototype.ScriptFragment, 'im');
    return (this.match(matchAll) || []).map(function(scriptTag) {
      return (scriptTag.match(matchOne) || ['', ''])[1];
    });
  }

  function evalScripts() {
    return this.extractScripts().map(function(script) { return eval(script); });
  }

  function escapeHTML() {
    return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  function unescapeHTML() {
    return this.stripTags().replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&');
  }


  function toQueryParams(separator) {
    var match = this.strip().match(/([^?#]*)(#.*)?$/);
    if (!match) return { };

    return match[1].split(separator || '&').inject({ }, function(hash, pair) {
      if ((pair = pair.split('='))[0]) {
        var key = decodeURIComponent(pair.shift()),
            value = pair.length > 1 ? pair.join('=') : pair[0];

        if (value != undefined) {
          value = value.gsub('+', ' ');
          value = decodeURIComponent(value);
        }

        if (key in hash) {
          if (!Object.isArray(hash[key])) hash[key] = [hash[key]];
          hash[key].push(value);
        }
        else hash[key] = value;
      }
      return hash;
    });
  }

  function toArray() {
    return this.split('');
  }

  function succ() {
    return this.slice(0, this.length - 1) +
      String.fromCharCode(this.charCodeAt(this.length - 1) + 1);
  }

  function times(count) {
    return count < 1 ? '' : new Array(count + 1).join(this);
  }

  function camelize() {
    return this.replace(/-+(.)?/g, function(match, chr) {
      return chr ? chr.toUpperCase() : '';
    });
  }

  function capitalize() {
    return this.charAt(0).toUpperCase() + this.substring(1).toLowerCase();
  }

  function underscore() {
    return this.replace(/::/g, '/')
               .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')
               .replace(/([a-z\d])([A-Z])/g, '$1_$2')
               .replace(/-/g, '_')
               .toLowerCase();
  }

  function dasherize() {
    return this.replace(/_/g, '-');
  }

  function inspect(useDoubleQuotes) {
    var escapedString = this.replace(/[\x00-\x1f\\]/g, function(character) {
      if (character in String.specialChar) {
        return String.specialChar[character];
      }
      return '\\u00' + character.charCodeAt().toPaddedString(2, 16);
    });
    if (useDoubleQuotes) return '"' + escapedString.replace(/"/g, '\\"') + '"';
    return "'" + escapedString.replace(/'/g, '\\\'') + "'";
  }

  function unfilterJSON(filter) {
    return this.replace(filter || Prototype.JSONFilter, '$1');
  }

  function isJSON() {
    var str = this;
    if (str.blank()) return false;
    str = str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@');
    str = str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']');
    str = str.replace(/(?:^|:|,)(?:\s*\[)+/g, '');
    return (/^[\],:{}\s]*$/).test(str);
  }

  function evalJSON(sanitize) {
    var json = this.unfilterJSON(),
        cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
    if (cx.test(json)) {
      json = json.replace(cx, function (a) {
        return '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
      });
    }
    try {
      if (!sanitize || json.isJSON()) return eval('(' + json + ')');
    } catch (e) { }
    throw new SyntaxError('Badly formed JSON string: ' + this.inspect());
  }

  function parseJSON() {
    var json = this.unfilterJSON();
    return JSON.parse(json);
  }

  function include(pattern) {
    return this.indexOf(pattern) > -1;
  }

  function startsWith(pattern, position) {
    position = Object.isNumber(position) ? position : 0;
    return this.lastIndexOf(pattern, position) === position;
  }

  function endsWith(pattern, position) {
    pattern = String(pattern);
    position = Object.isNumber(position) ? position : this.length;
    if (position < 0) position = 0;
    if (position > this.length) position = this.length;
    var d = position - pattern.length;
    return d >= 0 && this.indexOf(pattern, d) === d;
  }

  function empty() {
    return this == '';
  }

  function blank() {
    return /^\s*$/.test(this);
  }

  function interpolate(object, pattern) {
    return new Template(this, pattern).evaluate(object);
  }

  return {
    gsub:           gsub,
    sub:            sub,
    scan:           scan,
    truncate:       truncate,
    strip:          String.prototype.trim || strip,
    stripTags:      stripTags,
    stripScripts:   stripScripts,
    extractScripts: extractScripts,
    evalScripts:    evalScripts,
    escapeHTML:     escapeHTML,
    unescapeHTML:   unescapeHTML,
    toQueryParams:  toQueryParams,
    parseQuery:     toQueryParams,
    toArray:        toArray,
    succ:           succ,
    times:          times,
    camelize:       camelize,
    capitalize:     capitalize,
    underscore:     underscore,
    dasherize:      dasherize,
    inspect:        inspect,
    unfilterJSON:   unfilterJSON,
    isJSON:         isJSON,
    evalJSON:       NATIVE_JSON_PARSE_SUPPORT ? parseJSON : evalJSON,
    include:        include,
    startsWith:     String.prototype.startsWith || startsWith,
    endsWith:       String.prototype.endsWith || endsWith,
    empty:          empty,
    blank:          blank,
    interpolate:    interpolate
  };
})());

var Template = Class.create({
  initialize: function(template, pattern) {
    this.template = template.toString();
    this.pattern = pattern || Template.Pattern;
  },

  evaluate: function(object) {
    if (object && Object.isFunction(object.toTemplateReplacements))
      object = object.toTemplateReplacements();

    return this.template.gsub(this.pattern, function(match) {
      if (object == null) return (match[1] + '');

      var before = match[1] || '';
      if (before == '\\') return match[2];

      var ctx = object, expr = match[3],
          pattern = /^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;

      match = pattern.exec(expr);
      if (match == null) return before;

      while (match != null) {
        var comp = match[1].startsWith('[') ? match[2].replace(/\\\\]/g, ']') : match[1];
        ctx = ctx[comp];
        if (null == ctx || '' == match[3]) break;
        expr = expr.substring('[' == match[3] ? match[1].length : match[0].length);
        match = pattern.exec(expr);
      }

      return before + String.interpret(ctx);
    });
  }
});
Template.Pattern = /(^|.|\r|\n)(#\{(.*?)\})/;

var $break = { };

var Enumerable = (function() {
  function each(iterator, context) {
    try {
      this._each(iterator, context);
    } catch (e) {
      if (e != $break) throw e;
    }
    return this;
  }

  function eachSlice(number, iterator, context) {
    var index = -number, slices = [], array = this.toArray();
    if (number < 1) return array;
    while ((index += number) < array.length)
      slices.push(array.slice(index, index+number));
    return slices.collect(iterator, context);
  }

  function all(iterator, context) {
    iterator = iterator || Prototype.K;
    var result = true;
    this.each(function(value, index) {
      result = result && !!iterator.call(context, value, index, this);
      if (!result) throw $break;
    }, this);
    return result;
  }

  function any(iterator, context) {
    iterator = iterator || Prototype.K;
    var result = false;
    this.each(function(value, index) {
      if (result = !!iterator.call(context, value, index, this))
        throw $break;
    }, this);
    return result;
  }

  function collect(iterator, context) {
    iterator = iterator || Prototype.K;
    var results = [];
    this.each(function(value, index) {
      results.push(iterator.call(context, value, index, this));
    }, this);
    return results;
  }

  function detect(iterator, context) {
    var result;
    this.each(function(value, index) {
      if (iterator.call(context, value, index, this)) {
        result = value;
        throw $break;
      }
    }, this);
    return result;
  }

  function findAll(iterator, context) {
    var results = [];
    this.each(function(value, index) {
      if (iterator.call(context, value, index, this))
        results.push(value);
    }, this);
    return results;
  }

  function grep(filter, iterator, context) {
    iterator = iterator || Prototype.K;
    var results = [];

    if (Object.isString(filter))
      filter = new RegExp(RegExp.escape(filter));

    this.each(function(value, index) {
      if (filter.match(value))
        results.push(iterator.call(context, value, index, this));
    }, this);
    return results;
  }

  function include(object) {
    if (Object.isFunction(this.indexOf) && this.indexOf(object) != -1)
      return true;

    var found = false;
    this.each(function(value) {
      if (value == object) {
        found = true;
        throw $break;
      }
    });
    return found;
  }

  function inGroupsOf(number, fillWith) {
    fillWith = Object.isUndefined(fillWith) ? null : fillWith;
    return this.eachSlice(number, function(slice) {
      while(slice.length < number) slice.push(fillWith);
      return slice;
    });
  }

  function inject(memo, iterator, context) {
    this.each(function(value, index) {
      memo = iterator.call(context, memo, value, index, this);
    }, this);
    return memo;
  }

  function invoke(method) {
    var args = $A(arguments).slice(1);
    return this.map(function(value) {
      return value[method].apply(value, args);
    });
  }

  function max(iterator, context) {
    iterator = iterator || Prototype.K;
    var result;
    this.each(function(value, index) {
      value = iterator.call(context, value, index, this);
      if (result == null || value >= result)
        result = value;
    }, this);
    return result;
  }

  function min(iterator, context) {
    iterator = iterator || Prototype.K;
    var result;
    this.each(function(value, index) {
      value = iterator.call(context, value, index, this);
      if (result == null || value < result)
        result = value;
    }, this);
    return result;
  }

  function partition(iterator, context) {
    iterator = iterator || Prototype.K;
    var trues = [], falses = [];
    this.each(function(value, index) {
      (iterator.call(context, value, index, this) ?
        trues : falses).push(value);
    }, this);
    return [trues, falses];
  }

  function pluck(property) {
    var results = [];
    this.each(function(value) {
      results.push(value[property]);
    });
    return results;
  }

  function reject(iterator, context) {
    var results = [];
    this.each(function(value, index) {
      if (!iterator.call(context, value, index, this))
        results.push(value);
    }, this);
    return results;
  }

  function sortBy(iterator, context) {
    return this.map(function(value, index) {
      return {
        value: value,
        criteria: iterator.call(context, value, index, this)
      };
    }, this).sort(function(left, right) {
      var a = left.criteria, b = right.criteria;
      return a < b ? -1 : a > b ? 1 : 0;
    }).pluck('value');
  }

  function toArray() {
    return this.map();
  }

  function zip() {
    var iterator = Prototype.K, args = $A(arguments);
    if (Object.isFunction(args.last()))
      iterator = args.pop();

    var collections = [this].concat(args).map($A);
    return this.map(function(value, index) {
      return iterator(collections.pluck(index));
    });
  }

  function size() {
    return this.toArray().length;
  }

  function inspect() {
    return '#<Enumerable:' + this.toArray().inspect() + '>';
  }









  return {
    each:       each,
    eachSlice:  eachSlice,
    all:        all,
    every:      all,
    any:        any,
    some:       any,
    collect:    collect,
    map:        collect,
    detect:     detect,
    findAll:    findAll,
    select:     findAll,
    filter:     findAll,
    grep:       grep,
    include:    include,
    member:     include,
    inGroupsOf: inGroupsOf,
    inject:     inject,
    invoke:     invoke,
    max:        max,
    min:        min,
    partition:  partition,
    pluck:      pluck,
    reject:     reject,
    sortBy:     sortBy,
    toArray:    toArray,
    entries:    toArray,
    zip:        zip,
    size:       size,
    inspect:    inspect,
    find:       detect
  };
})();

function $A(iterable) {
  if (!iterable) return [];
  if ('toArray' in Object(iterable)) return iterable.toArray();
  var length = iterable.length || 0, results = new Array(length);
  while (length--) results[length] = iterable[length];
  return results;
}


function $w(string) {
  if (!Object.isString(string)) return [];
  string = string.strip();
  return string ? string.split(/\s+/) : [];
}

Array.from = $A;


(function() {
  var arrayProto = Array.prototype,
      slice = arrayProto.slice,
      _each = arrayProto.forEach; // use native browser JS 1.6 implementation if available

  function each(iterator, context) {
    for (var i = 0, length = this.length >>> 0; i < length; i++) {
      if (i in this) iterator.call(context, this[i], i, this);
    }
  }
  if (!_each) _each = each;

  function clear() {
    this.length = 0;
    return this;
  }

  function first() {
    return this[0];
  }

  function last() {
    return this[this.length - 1];
  }

  function compact() {
    return this.select(function(value) {
      return value != null;
    });
  }

  function flatten() {
    return this.inject([], function(array, value) {
      if (Object.isArray(value))
        return array.concat(value.flatten());
      array.push(value);
      return array;
    });
  }

  function without() {
    var values = slice.call(arguments, 0);
    return this.select(function(value) {
      return !values.include(value);
    });
  }

  function reverse(inline) {
    return (inline === false ? this.toArray() : this)._reverse();
  }

  function uniq(sorted) {
    return this.inject([], function(array, value, index) {
      if (0 == index || (sorted ? array.last() != value : !array.include(value)))
        array.push(value);
      return array;
    });
  }

  function intersect(array) {
    return this.uniq().findAll(function(item) {
      return array.indexOf(item) !== -1;
    });
  }


  function clone() {
    return slice.call(this, 0);
  }

  function size() {
    return this.length;
  }

  function inspect() {
    return '[' + this.map(Object.inspect).join(', ') + ']';
  }

  function indexOf(item, i) {
    if (this == null) throw new TypeError();

    var array = Object(this), length = array.length >>> 0;
    if (length === 0) return -1;

    i = Number(i);
    if (isNaN(i)) {
      i = 0;
    } else if (i !== 0 && isFinite(i)) {
      i = (i > 0 ? 1 : -1) * Math.floor(Math.abs(i));
    }

    if (i > length) return -1;

    var k = i >= 0 ? i : Math.max(length - Math.abs(i), 0);
    for (; k < length; k++)
      if (k in array && array[k] === item) return k;
    return -1;
  }


  function lastIndexOf(item, i) {
    if (this == null) throw new TypeError();

    var array = Object(this), length = array.length >>> 0;
    if (length === 0) return -1;

    if (!Object.isUndefined(i)) {
      i = Number(i);
      if (isNaN(i)) {
        i = 0;
      } else if (i !== 0 && isFinite(i)) {
        i = (i > 0 ? 1 : -1) * Math.floor(Math.abs(i));
      }
    } else {
      i = length;
    }

    var k = i >= 0 ? Math.min(i, length - 1) :
     length - Math.abs(i);

    for (; k >= 0; k--)
      if (k in array && array[k] === item) return k;
    return -1;
  }

  function concat(_) {
    var array = [], items = slice.call(arguments, 0), item, n = 0;
    items.unshift(this);
    for (var i = 0, length = items.length; i < length; i++) {
      item = items[i];
      if (Object.isArray(item) && !('callee' in item)) {
        for (var j = 0, arrayLength = item.length; j < arrayLength; j++) {
          if (j in item) array[n] = item[j];
          n++;
        }
      } else {
        array[n++] = item;
      }
    }
    array.length = n;
    return array;
  }


  function wrapNative(method) {
    return function() {
      if (arguments.length === 0) {
        return method.call(this, Prototype.K);
      } else if (arguments[0] === undefined) {
        var args = slice.call(arguments, 1);
        args.unshift(Prototype.K);
        return method.apply(this, args);
      } else {
        return method.apply(this, arguments);
      }
    };
  }


  function map(iterator) {
    if (this == null) throw new TypeError();
    iterator = iterator || Prototype.K;

    var object = Object(this);
    var results = [], context = arguments[1], n = 0;

    for (var i = 0, length = object.length >>> 0; i < length; i++) {
      if (i in object) {
        results[n] = iterator.call(context, object[i], i, object);
      }
      n++;
    }
    results.length = n;
    return results;
  }

  if (arrayProto.map) {
    map = wrapNative(Array.prototype.map);
  }

  function filter(iterator) {
    if (this == null || !Object.isFunction(iterator))
      throw new TypeError();

    var object = Object(this);
    var results = [], context = arguments[1], value;

    for (var i = 0, length = object.length >>> 0; i < length; i++) {
      if (i in object) {
        value = object[i];
        if (iterator.call(context, value, i, object)) {
          results.push(value);
        }
      }
    }
    return results;
  }

  if (arrayProto.filter) {
    filter = Array.prototype.filter;
  }

  function some(iterator) {
    if (this == null) throw new TypeError();
    iterator = iterator || Prototype.K;
    var context = arguments[1];

    var object = Object(this);
    for (var i = 0, length = object.length >>> 0; i < length; i++) {
      if (i in object && iterator.call(context, object[i], i, object)) {
        return true;
      }
    }

    return false;
  }

  if (arrayProto.some) {
    var some = wrapNative(Array.prototype.some);
  }


  function every(iterator) {
    if (this == null) throw new TypeError();
    iterator = iterator || Prototype.K;
    var context = arguments[1];

    var object = Object(this);
    for (var i = 0, length = object.length >>> 0; i < length; i++) {
      if (i in object && !iterator.call(context, object[i], i, object)) {
        return false;
      }
    }

    return true;
  }

  if (arrayProto.every) {
    var every = wrapNative(Array.prototype.every);
  }

  var _reduce = arrayProto.reduce;
  function inject(memo, iterator) {
    iterator = iterator || Prototype.K;
    var context = arguments[2];
    return _reduce.call(this, iterator.bind(context), memo);
  }

  if (!arrayProto.reduce) {
    var inject = Enumerable.inject;
  }

  Object.extend(arrayProto, Enumerable);

  if (!arrayProto._reverse)
    arrayProto._reverse = arrayProto.reverse;

  Object.extend(arrayProto, {
    _each:     _each,

    map:       map,
    collect:   map,
    select:    filter,
    filter:    filter,
    findAll:   filter,
    some:      some,
    any:       some,
    every:     every,
    all:       every,
    inject:    inject,

    clear:     clear,
    first:     first,
    last:      last,
    compact:   compact,
    flatten:   flatten,
    without:   without,
    reverse:   reverse,
    uniq:      uniq,
    intersect: intersect,
    clone:     clone,
    toArray:   clone,
    size:      size,
    inspect:   inspect
  });

  var CONCAT_ARGUMENTS_BUGGY = (function() {
    return [].concat(arguments)[0][0] !== 1;
  })(1,2);

  if (CONCAT_ARGUMENTS_BUGGY) arrayProto.concat = concat;

  if (!arrayProto.indexOf) arrayProto.indexOf = indexOf;
  if (!arrayProto.lastIndexOf) arrayProto.lastIndexOf = lastIndexOf;
})();
function $H(object) {
  return new Hash(object);
};

var Hash = Class.create(Enumerable, (function() {
  function initialize(object) {
    this._object = Object.isHash(object) ? object.toObject() : Object.clone(object);
  }


  function _each(iterator, context) {
    var i = 0;
    for (var key in this._object) {
      var value = this._object[key], pair = [key, value];
      pair.key = key;
      pair.value = value;
      iterator.call(context, pair, i);
      i++;
    }
  }

  function set(key, value) {
    return this._object[key] = value;
  }

  function get(key) {
    if (this._object[key] !== Object.prototype[key])
      return this._object[key];
  }

  function unset(key) {
    var value = this._object[key];
    delete this._object[key];
    return value;
  }

  function toObject() {
    return Object.clone(this._object);
  }



  function keys() {
    return this.pluck('key');
  }

  function values() {
    return this.pluck('value');
  }

  function index(value) {
    var match = this.detect(function(pair) {
      return pair.value === value;
    });
    return match && match.key;
  }

  function merge(object) {
    return this.clone().update(object);
  }

  function update(object) {
    return new Hash(object).inject(this, function(result, pair) {
      result.set(pair.key, pair.value);
      return result;
    });
  }

  function toQueryPair(key, value) {
    if (Object.isUndefined(value)) return key;

    value = String.interpret(value);

    value = value.gsub(/(\r)?\n/, '\r\n');
    value = encodeURIComponent(value);
    value = value.gsub(/%20/, '+');
    return key + '=' + value;
  }

  function toQueryString() {
    return this.inject([], function(results, pair) {
      var key = encodeURIComponent(pair.key), values = pair.value;

      if (values && typeof values == 'object') {
        if (Object.isArray(values)) {
          var queryValues = [];
          for (var i = 0, len = values.length, value; i < len; i++) {
            value = values[i];
            queryValues.push(toQueryPair(key, value));
          }
          return results.concat(queryValues);
        }
      } else results.push(toQueryPair(key, values));
      return results;
    }).join('&');
  }

  function inspect() {
    return '#<Hash:{' + this.map(function(pair) {
      return pair.map(Object.inspect).join(': ');
    }).join(', ') + '}>';
  }

  function clone() {
    return new Hash(this);
  }

  return {
    initialize:             initialize,
    _each:                  _each,
    set:                    set,
    get:                    get,
    unset:                  unset,
    toObject:               toObject,
    toTemplateReplacements: toObject,
    keys:                   keys,
    values:                 values,
    index:                  index,
    merge:                  merge,
    update:                 update,
    toQueryString:          toQueryString,
    inspect:                inspect,
    toJSON:                 toObject,
    clone:                  clone
  };
})());

Hash.from = $H;
Object.extend(Number.prototype, (function() {
  function toColorPart() {
    return this.toPaddedString(2, 16);
  }

  function succ() {
    return this + 1;
  }

  function times(iterator, context) {
    $R(0, this, true).each(iterator, context);
    return this;
  }

  function toPaddedString(length, radix) {
    var string = this.toString(radix || 10);
    return '0'.times(length - string.length) + string;
  }

  function abs() {
    return Math.abs(this);
  }

  function round() {
    return Math.round(this);
  }

  function ceil() {
    return Math.ceil(this);
  }

  function floor() {
    return Math.floor(this);
  }

  return {
    toColorPart:    toColorPart,
    succ:           succ,
    times:          times,
    toPaddedString: toPaddedString,
    abs:            abs,
    round:          round,
    ceil:           ceil,
    floor:          floor
  };
})());

function $R(start, end, exclusive) {
  return new ObjectRange(start, end, exclusive);
}

var ObjectRange = Class.create(Enumerable, (function() {
  function initialize(start, end, exclusive) {
    this.start = start;
    this.end = end;
    this.exclusive = exclusive;
  }

  function _each(iterator, context) {
    var value = this.start, i;
    for (i = 0; this.include(value); i++) {
      iterator.call(context, value, i);
      value = value.succ();
    }
  }

  function include(value) {
    if (value < this.start)
      return false;
    if (this.exclusive)
      return value < this.end;
    return value <= this.end;
  }

  return {
    initialize: initialize,
    _each:      _each,
    include:    include
  };
})());



var Abstract = { };


var Try = {
  these: function() {
    var returnValue;

    for (var i = 0, length = arguments.length; i < length; i++) {
      var lambda = arguments[i];
      try {
        returnValue = lambda();
        break;
      } catch (e) { }
    }

    return returnValue;
  }
};

var Ajax = {
  getTransport: function() {
    return Try.these(
      function() {return new XMLHttpRequest()},
      function() {return new ActiveXObject('Msxml2.XMLHTTP')},
      function() {return new ActiveXObject('Microsoft.XMLHTTP')}
    ) || false;
  },

  activeRequestCount: 0
};

Ajax.Responders = {
  responders: [],

  _each: function(iterator, context) {
    this.responders._each(iterator, context);
  },

  register: function(responder) {
    if (!this.include(responder))
      this.responders.push(responder);
  },

  unregister: function(responder) {
    this.responders = this.responders.without(responder);
  },

  dispatch: function(callback, request, transport, json) {
    this.each(function(responder) {
      if (Object.isFunction(responder[callback])) {
        try {
          responder[callback].apply(responder, [request, transport, json]);
        } catch (e) { }
      }
    });
  }
};

Object.extend(Ajax.Responders, Enumerable);

Ajax.Responders.register({
  onCreate:   function() { Ajax.activeRequestCount++ },
  onComplete: function() { Ajax.activeRequestCount-- }
});
Ajax.Base = Class.create({
  initialize: function(options) {
    this.options = {
      method:       'post',
      asynchronous: true,
      contentType:  'application/x-www-form-urlencoded',
      encoding:     'UTF-8',
      parameters:   '',
      evalJSON:     true,
      evalJS:       true
    };
    Object.extend(this.options, options || { });

    this.options.method = this.options.method.toLowerCase();

    if (Object.isHash(this.options.parameters))
      this.options.parameters = this.options.parameters.toObject();
  }
});
Ajax.Request = Class.create(Ajax.Base, {
  _complete: false,

  initialize: function($super, url, options) {
    $super(options);
    this.transport = Ajax.getTransport();
    this.request(url);
  },

  request: function(url) {
    this.url = url;
    this.method = this.options.method;
    var params = Object.isString(this.options.parameters) ?
          this.options.parameters :
          Object.toQueryString(this.options.parameters);

    if (!['get', 'post'].include(this.method)) {
      params += (params ? '&' : '') + "_method=" + this.method;
      this.method = 'post';
    }

    if (params && this.method === 'get') {
      this.url += (this.url.include('?') ? '&' : '?') + params;
    }

    this.parameters = params.toQueryParams();

    try {
      var response = new Ajax.Response(this);
      if (this.options.onCreate) this.options.onCreate(response);
      Ajax.Responders.dispatch('onCreate', this, response);

      this.transport.open(this.method.toUpperCase(), this.url,
        this.options.asynchronous);

      if (this.options.asynchronous) this.respondToReadyState.bind(this).defer(1);

      this.transport.onreadystatechange = this.onStateChange.bind(this);
      this.setRequestHeaders();

      this.body = this.method == 'post' ? (this.options.postBody || params) : null;
      this.transport.send(this.body);

      /* Force Firefox to handle ready state 4 for synchronous requests */
      if (!this.options.asynchronous && this.transport.overrideMimeType)
        this.onStateChange();

    }
    catch (e) {
      this.dispatchException(e);
    }
  },

  onStateChange: function() {
    var readyState = this.transport.readyState;
    if (readyState > 1 && !((readyState == 4) && this._complete))
      this.respondToReadyState(this.transport.readyState);
  },

  setRequestHeaders: function() {
    var headers = {
      'X-Requested-With': 'XMLHttpRequest',
      'X-Prototype-Version': Prototype.Version,
      'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
    };

    if (this.method == 'post') {
      headers['Content-type'] = this.options.contentType +
        (this.options.encoding ? '; charset=' + this.options.encoding : '');

      /* Force "Connection: close" for older Mozilla browsers to work
       * around a bug where XMLHttpRequest sends an incorrect
       * Content-length header. See Mozilla Bugzilla #246651.
       */
      if (this.transport.overrideMimeType &&
          (navigator.userAgent.match(/Gecko\/(\d{4})/) || [0,2005])[1] < 2005)
            headers['Connection'] = 'close';
    }

    if (typeof this.options.requestHeaders == 'object') {
      var extras = this.options.requestHeaders;

      if (Object.isFunction(extras.push))
        for (var i = 0, length = extras.length; i < length; i += 2)
          headers[extras[i]] = extras[i+1];
      else
        $H(extras).each(function(pair) { headers[pair.key] = pair.value });
    }

    for (var name in headers)
      if (headers[name] != null)
        this.transport.setRequestHeader(name, headers[name]);
  },

  success: function() {
    var status = this.getStatus();
    return !status || (status >= 200 && status < 300) || status == 304;
  },

  getStatus: function() {
    try {
      if (this.transport.status === 1223) return 204;
      return this.transport.status || 0;
    } catch (e) { return 0 }
  },

  respondToReadyState: function(readyState) {
    var state = Ajax.Request.Events[readyState], response = new Ajax.Response(this);

    if (state == 'Complete') {
      try {
        this._complete = true;
        (this.options['on' + response.status]
         || this.options['on' + (this.success() ? 'Success' : 'Failure')]
         || Prototype.emptyFunction)(response, response.headerJSON);
      } catch (e) {
        this.dispatchException(e);
      }

      var contentType = response.getHeader('Content-type');
      if (this.options.evalJS == 'force'
          || (this.options.evalJS && this.isSameOrigin() && contentType
          && contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
        this.evalResponse();
    }

    try {
      (this.options['on' + state] || Prototype.emptyFunction)(response, response.headerJSON);
      Ajax.Responders.dispatch('on' + state, this, response, response.headerJSON);
    } catch (e) {
      this.dispatchException(e);
    }

    if (state == 'Complete') {
      this.transport.onreadystatechange = Prototype.emptyFunction;
    }
  },

  isSameOrigin: function() {
    var m = this.url.match(/^\s*https?:\/\/[^\/]*/);
    return !m || (m[0] == '#{protocol}//#{domain}#{port}'.interpolate({
      protocol: location.protocol,
      domain: document.domain,
      port: location.port ? ':' + location.port : ''
    }));
  },

  getHeader: function(name) {
    try {
      return this.transport.getResponseHeader(name) || null;
    } catch (e) { return null; }
  },

  evalResponse: function() {
    try {
      return eval((this.transport.responseText || '').unfilterJSON());
    } catch (e) {
      this.dispatchException(e);
    }
  },

  dispatchException: function(exception) {
    (this.options.onException || Prototype.emptyFunction)(this, exception);
    Ajax.Responders.dispatch('onException', this, exception);
  }
});

Ajax.Request.Events =
  ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete'];








Ajax.Response = Class.create({
  initialize: function(request){
    this.request = request;
    var transport  = this.transport  = request.transport,
        readyState = this.readyState = transport.readyState;

    if ((readyState > 2 && !Prototype.Browser.IE) || readyState == 4) {
      this.status       = this.getStatus();
      this.statusText   = this.getStatusText();
      this.responseText = String.interpret(transport.responseText);
      this.headerJSON   = this._getHeaderJSON();
    }

    if (readyState == 4) {
      var xml = transport.responseXML;
      this.responseXML  = Object.isUndefined(xml) ? null : xml;
      this.responseJSON = this._getResponseJSON();
    }
  },

  status:      0,

  statusText: '',

  getStatus: Ajax.Request.prototype.getStatus,

  getStatusText: function() {
    try {
      return this.transport.statusText || '';
    } catch (e) { return '' }
  },

  getHeader: Ajax.Request.prototype.getHeader,

  getAllHeaders: function() {
    try {
      return this.getAllResponseHeaders();
    } catch (e) { return null }
  },

  getResponseHeader: function(name) {
    return this.transport.getResponseHeader(name);
  },

  getAllResponseHeaders: function() {
    return this.transport.getAllResponseHeaders();
  },

  _getHeaderJSON: function() {
    var json = this.getHeader('X-JSON');
    if (!json) return null;

    try {
      json = decodeURIComponent(escape(json));
    } catch(e) {
    }

    try {
      return json.evalJSON(this.request.options.sanitizeJSON ||
        !this.request.isSameOrigin());
    } catch (e) {
      this.request.dispatchException(e);
    }
  },

  _getResponseJSON: function() {
    var options = this.request.options;
    if (!options.evalJSON || (options.evalJSON != 'force' &&
      !(this.getHeader('Content-type') || '').include('application/json')) ||
        this.responseText.blank())
          return null;
    try {
      return this.responseText.evalJSON(options.sanitizeJSON ||
        !this.request.isSameOrigin());
    } catch (e) {
      this.request.dispatchException(e);
    }
  }
});

Ajax.Updater = Class.create(Ajax.Request, {
  initialize: function($super, container, url, options) {
    this.container = {
      success: (container.success || container),
      failure: (container.failure || (container.success ? null : container))
    };

    options = Object.clone(options);
    var onComplete = options.onComplete;
    options.onComplete = (function(response, json) {
      this.updateContent(response.responseText);
      if (Object.isFunction(onComplete)) onComplete(response, json);
    }).bind(this);

    $super(url, options);
  },

  updateContent: function(responseText) {
    var receiver = this.container[this.success() ? 'success' : 'failure'],
        options = this.options;

    if (!options.evalScripts) responseText = responseText.stripScripts();

    if (receiver = $(receiver)) {
      if (options.insertion) {
        if (Object.isString(options.insertion)) {
          var insertion = { }; insertion[options.insertion] = responseText;
          receiver.insert(insertion);
        }
        else options.insertion(receiver, responseText);
      }
      else receiver.update(responseText);
    }
  }
});

Ajax.PeriodicalUpdater = Class.create(Ajax.Base, {
  initialize: function($super, container, url, options) {
    $super(options);
    this.onComplete = this.options.onComplete;

    this.frequency = (this.options.frequency || 2);
    this.decay = (this.options.decay || 1);

    this.updater = { };
    this.container = container;
    this.url = url;

    this.start();
  },

  start: function() {
    this.options.onComplete = this.updateComplete.bind(this);
    this.onTimerEvent();
  },

  stop: function() {
    this.updater.options.onComplete = undefined;
    clearTimeout(this.timer);
    (this.onComplete || Prototype.emptyFunction).apply(this, arguments);
  },

  updateComplete: function(response) {
    if (this.options.decay) {
      this.decay = (response.responseText == this.lastText ?
        this.decay * this.options.decay : 1);

      this.lastText = response.responseText;
    }
    this.timer = this.onTimerEvent.bind(this).delay(this.decay * this.frequency);
  },

  onTimerEvent: function() {
    this.updater = new Ajax.Updater(this.container, this.url, this.options);
  }
});

(function(GLOBAL) {

  var UNDEFINED;
  var SLICE = Array.prototype.slice;

  var DIV = document.createElement('div');


  function $(element) {
    if (arguments.length > 1) {
      for (var i = 0, elements = [], length = arguments.length; i < length; i++)
        elements.push($(arguments[i]));
      return elements;
    }

    if (Object.isString(element))
      element = document.getElementById(element);
    return Element.extend(element);
  }

  GLOBAL.$ = $;


  if (!GLOBAL.Node) GLOBAL.Node = {};

  if (!GLOBAL.Node.ELEMENT_NODE) {
    Object.extend(GLOBAL.Node, {
      ELEMENT_NODE:                1,
      ATTRIBUTE_NODE:              2,
      TEXT_NODE:                   3,
      CDATA_SECTION_NODE:          4,
      ENTITY_REFERENCE_NODE:       5,
      ENTITY_NODE:                 6,
      PROCESSING_INSTRUCTION_NODE: 7,
      COMMENT_NODE:                8,
      DOCUMENT_NODE:               9,
      DOCUMENT_TYPE_NODE:         10,
      DOCUMENT_FRAGMENT_NODE:     11,
      NOTATION_NODE:              12
    });
  }

  var ELEMENT_CACHE = {};

  function shouldUseCreationCache(tagName, attributes) {
    if (tagName === 'select') return false;
    if ('type' in attributes) return false;
    return true;
  }

  var HAS_EXTENDED_CREATE_ELEMENT_SYNTAX = (function(){
    try {
      var el = document.createElement('<input name="x">');
      return el.tagName.toLowerCase() === 'input' && el.name === 'x';
    }
    catch(err) {
      return false;
    }
  })();


  var oldElement = GLOBAL.Element;
  function Element(tagName, attributes) {
    attributes = attributes || {};
    tagName = tagName.toLowerCase();

    if (HAS_EXTENDED_CREATE_ELEMENT_SYNTAX && attributes.name) {
      tagName = '<' + tagName + ' name="' + attributes.name + '">';
      delete attributes.name;
      return Element.writeAttribute(document.createElement(tagName), attributes);
    }

    if (!ELEMENT_CACHE[tagName])
      ELEMENT_CACHE[tagName] = Element.extend(document.createElement(tagName));

    var node = shouldUseCreationCache(tagName, attributes) ?
     ELEMENT_CACHE[tagName].cloneNode(false) : document.createElement(tagName);

    return Element.writeAttribute(node, attributes);
  }

  GLOBAL.Element = Element;

  Object.extend(GLOBAL.Element, oldElement || {});
  if (oldElement) GLOBAL.Element.prototype = oldElement.prototype;

  Element.Methods = { ByTag: {}, Simulated: {} };

  var methods = {};

  var INSPECT_ATTRIBUTES = { id: 'id', className: 'class' };
  function inspect(element) {
    element = $(element);
    var result = '<' + element.tagName.toLowerCase();

    var attribute, value;
    for (var property in INSPECT_ATTRIBUTES) {
      attribute = INSPECT_ATTRIBUTES[property];
      value = (element[property] || '').toString();
      if (value) result += ' ' + attribute + '=' + value.inspect(true);
    }

    return result + '>';
  }

  methods.inspect = inspect;


  function visible(element) {
    return $(element).style.display !== 'none';
  }

  function toggle(element, bool) {
    element = $(element);
    if (Object.isUndefined(bool))
      bool = !Element.visible(element);
    Element[bool ? 'show' : 'hide'](element);

    return element;
  }

  function hide(element) {
    element = $(element);
    element.style.display = 'none';
    return element;
  }

  function show(element) {
    element = $(element);
    element.style.display = '';
    return element;
  }


  Object.extend(methods, {
    visible: visible,
    toggle:  toggle,
    hide:    hide,
    show:    show
  });


  function remove(element) {
    element = $(element);
    element.parentNode.removeChild(element);
    return element;
  }

  var SELECT_ELEMENT_INNERHTML_BUGGY = (function(){
    var el = document.createElement("select"),
        isBuggy = true;
    el.innerHTML = "<option value=\"test\">test</option>";
    if (el.options && el.options[0]) {
      isBuggy = el.options[0].nodeName.toUpperCase() !== "OPTION";
    }
    el = null;
    return isBuggy;
  })();

  var TABLE_ELEMENT_INNERHTML_BUGGY = (function(){
    try {
      var el = document.createElement("table");
      if (el && el.tBodies) {
        el.innerHTML = "<tbody><tr><td>test</td></tr></tbody>";
        var isBuggy = typeof el.tBodies[0] == "undefined";
        el = null;
        return isBuggy;
      }
    } catch (e) {
      return true;
    }
  })();

  var LINK_ELEMENT_INNERHTML_BUGGY = (function() {
    try {
      var el = document.createElement('div');
      el.innerHTML = "<link />";
      var isBuggy = (el.childNodes.length === 0);
      el = null;
      return isBuggy;
    } catch(e) {
      return true;
    }
  })();

  var ANY_INNERHTML_BUGGY = SELECT_ELEMENT_INNERHTML_BUGGY ||
   TABLE_ELEMENT_INNERHTML_BUGGY || LINK_ELEMENT_INNERHTML_BUGGY;

  var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING = (function () {
    var s = document.createElement("script"),
        isBuggy = false;
    try {
      s.appendChild(document.createTextNode(""));
      isBuggy = !s.firstChild ||
        s.firstChild && s.firstChild.nodeType !== 3;
    } catch (e) {
      isBuggy = true;
    }
    s = null;
    return isBuggy;
  })();

  function update(element, content) {
    element = $(element);

    var descendants = element.getElementsByTagName('*'),
     i = descendants.length;
    while (i--) purgeElement(descendants[i]);

    if (content && content.toElement)
      content = content.toElement();

    if (Object.isElement(content))
      return element.update().insert(content);


    content = Object.toHTML(content);
    var tagName = element.tagName.toUpperCase();

    if (tagName === 'SCRIPT' && SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING) {
      element.text = content;
      return element;
    }

    if (ANY_INNERHTML_BUGGY) {
      if (tagName in INSERTION_TRANSLATIONS.tags) {
        while (element.firstChild)
          element.removeChild(element.firstChild);

        var nodes = getContentFromAnonymousElement(tagName, content.stripScripts());
        for (var i = 0, node; node = nodes[i]; i++)
          element.appendChild(node);

      } else if (LINK_ELEMENT_INNERHTML_BUGGY && Object.isString(content) && content.indexOf('<link') > -1) {
        while (element.firstChild)
          element.removeChild(element.firstChild);

        var nodes = getContentFromAnonymousElement(tagName,
         content.stripScripts(), true);

        for (var i = 0, node; node = nodes[i]; i++)
          element.appendChild(node);
      } else {
        element.innerHTML = content.stripScripts();
      }
    } else {
      element.innerHTML = content.stripScripts();
    }

    content.evalScripts.bind(content).defer();
    return element;
  }

  function replace(element, content) {
    element = $(element);

    if (content && content.toElement) {
      content = content.toElement();
    } else if (!Object.isElement(content)) {
      content = Object.toHTML(content);
      var range = element.ownerDocument.createRange();
      range.selectNode(element);
      content.evalScripts.bind(content).defer();
      content = range.createContextualFragment(content.stripScripts());
    }

    element.parentNode.replaceChild(content, element);
    return element;
  }

  var INSERTION_TRANSLATIONS = {
    before: function(element, node) {
      element.parentNode.insertBefore(node, element);
    },
    top: function(element, node) {
      element.insertBefore(node, element.firstChild);
    },
    bottom: function(element, node) {
      element.appendChild(node);
    },
    after: function(element, node) {
      element.parentNode.insertBefore(node, element.nextSibling);
    },

    tags: {
      TABLE:  ['<table>',                '</table>',                   1],
      TBODY:  ['<table><tbody>',         '</tbody></table>',           2],
      TR:     ['<table><tbody><tr>',     '</tr></tbody></table>',      3],
      TD:     ['<table><tbody><tr><td>', '</td></tr></tbody></table>', 4],
      SELECT: ['<select>',               '</select>',                  1]
    }
  };

  var tags = INSERTION_TRANSLATIONS.tags;

  Object.extend(tags, {
    THEAD: tags.TBODY,
    TFOOT: tags.TBODY,
    TH:    tags.TD
  });

  function replace_IE(element, content) {
    element = $(element);
    if (content && content.toElement)
      content = content.toElement();
    if (Object.isElement(content)) {
      element.parentNode.replaceChild(content, element);
      return element;
    }

    content = Object.toHTML(content);
    var parent = element.parentNode, tagName = parent.tagName.toUpperCase();

    if (tagName in INSERTION_TRANSLATIONS.tags) {
      var nextSibling = Element.next(element);
      var fragments = getContentFromAnonymousElement(
       tagName, content.stripScripts());

      parent.removeChild(element);

      var iterator;
      if (nextSibling)
        iterator = function(node) { parent.insertBefore(node, nextSibling) };
      else
        iterator = function(node) { parent.appendChild(node); }

      fragments.each(iterator);
    } else {
      element.outerHTML = content.stripScripts();
    }

    content.evalScripts.bind(content).defer();
    return element;
  }

  if ('outerHTML' in document.documentElement)
    replace = replace_IE;

  function isContent(content) {
    if (Object.isUndefined(content) || content === null) return false;

    if (Object.isString(content) || Object.isNumber(content)) return true;
    if (Object.isElement(content)) return true;
    if (content.toElement || content.toHTML) return true;

    return false;
  }

  function insertContentAt(element, content, position) {
    position   = position.toLowerCase();
    var method = INSERTION_TRANSLATIONS[position];

    if (content && content.toElement) content = content.toElement();
    if (Object.isElement(content)) {
      method(element, content);
      return element;
    }

    content = Object.toHTML(content);
    var tagName = ((position === 'before' || position === 'after') ?
     element.parentNode : element).tagName.toUpperCase();

    var childNodes = getContentFromAnonymousElement(tagName, content.stripScripts());

    if (position === 'top' || position === 'after') childNodes.reverse();

    for (var i = 0, node; node = childNodes[i]; i++)
      method(element, node);

    content.evalScripts.bind(content).defer();
  }

  function insert(element, insertions) {
    element = $(element);

    if (isContent(insertions))
      insertions = { bottom: insertions };

    for (var position in insertions)
      insertContentAt(element, insertions[position], position);

    return element;
  }

  function wrap(element, wrapper, attributes) {
    element = $(element);

    if (Object.isElement(wrapper)) {
      $(wrapper).writeAttribute(attributes || {});
    } else if (Object.isString(wrapper)) {
      wrapper = new Element(wrapper, attributes);
    } else {
      wrapper = new Element('div', wrapper);
    }

    if (element.parentNode)
      element.parentNode.replaceChild(wrapper, element);

    wrapper.appendChild(element);

    return wrapper;
  }

  function cleanWhitespace(element) {
    element = $(element);
    var node = element.firstChild;

    while (node) {
      var nextNode = node.nextSibling;
      if (node.nodeType === Node.TEXT_NODE && !/\S/.test(node.nodeValue))
        element.removeChild(node);
      node = nextNode;
    }
    return element;
  }

  function empty(element) {
    return $(element).innerHTML.blank();
  }

  function getContentFromAnonymousElement(tagName, html, force) {
    var t = INSERTION_TRANSLATIONS.tags[tagName], div = DIV;

    var workaround = !!t;
    if (!workaround && force) {
      workaround = true;
      t = ['', '', 0];
    }

    if (workaround) {
      div.innerHTML = '&#160;' + t[0] + html + t[1];
      div.removeChild(div.firstChild);
      for (var i = t[2]; i--; )
        div = div.firstChild;
    } else {
      div.innerHTML = html;
    }

    return $A(div.childNodes);
  }

  function clone(element, deep) {
    if (!(element = $(element))) return;
    var clone = element.cloneNode(deep);
    if (!HAS_UNIQUE_ID_PROPERTY) {
      clone._prototypeUID = UNDEFINED;
      if (deep) {
        var descendants = Element.select(clone, '*'),
         i = descendants.length;
        while (i--)
          descendants[i]._prototypeUID = UNDEFINED;
      }
    }
    return Element.extend(clone);
  }

  function purgeElement(element) {
    var uid = getUniqueElementID(element);
    if (uid) {
      Element.stopObserving(element);
      if (!HAS_UNIQUE_ID_PROPERTY)
        element._prototypeUID = UNDEFINED;
      delete Element.Storage[uid];
    }
  }

  function purgeCollection(elements) {
    var i = elements.length;
    while (i--)
      purgeElement(elements[i]);
  }

  function purgeCollection_IE(elements) {
    var i = elements.length, element, uid;
    while (i--) {
      element = elements[i];
      uid = getUniqueElementID(element);
      delete Element.Storage[uid];
      delete Event.cache[uid];
    }
  }

  if (HAS_UNIQUE_ID_PROPERTY) {
    purgeCollection = purgeCollection_IE;
  }


  function purge(element) {
    if (!(element = $(element))) return;
    purgeElement(element);

    var descendants = element.getElementsByTagName('*'),
     i = descendants.length;

    while (i--) purgeElement(descendants[i]);

    return null;
  }

  Object.extend(methods, {
    remove:  remove,
    update:  update,
    replace: replace,
    insert:  insert,
    wrap:    wrap,
    cleanWhitespace: cleanWhitespace,
    empty:   empty,
    clone:   clone,
    purge:   purge
  });



  function recursivelyCollect(element, property, maximumLength) {
    element = $(element);
    maximumLength = maximumLength || -1;
    var elements = [];

    while (element = element[property]) {
      if (element.nodeType === Node.ELEMENT_NODE)
        elements.push(Element.extend(element));

      if (elements.length === maximumLength) break;
    }

    return elements;
  }


  function ancestors(element) {
    return recursivelyCollect(element, 'parentNode');
  }

  function descendants(element) {
    return Element.select(element, '*');
  }

  function firstDescendant(element) {
    element = $(element).firstChild;
    while (element && element.nodeType !== Node.ELEMENT_NODE)
      element = element.nextSibling;

    return $(element);
  }

  function immediateDescendants(element) {
    var results = [], child = $(element).firstChild;

    while (child) {
      if (child.nodeType === Node.ELEMENT_NODE)
        results.push(Element.extend(child));

      child = child.nextSibling;
    }

    return results;
  }

  function previousSiblings(element) {
    return recursivelyCollect(element, 'previousSibling');
  }

  function nextSiblings(element) {
    return recursivelyCollect(element, 'nextSibling');
  }

  function siblings(element) {
    element = $(element);
    var previous = previousSiblings(element),
     next = nextSiblings(element);
    return previous.reverse().concat(next);
  }

  function match(element, selector) {
    element = $(element);

    if (Object.isString(selector))
      return Prototype.Selector.match(element, selector);

    return selector.match(element);
  }


  function _recursivelyFind(element, property, expression, index) {
    element = $(element), expression = expression || 0, index = index || 0;
    if (Object.isNumber(expression)) {
      index = expression, expression = null;
    }

    while (element = element[property]) {
      if (element.nodeType !== 1) continue;
      if (expression && !Prototype.Selector.match(element, expression))
        continue;
      if (--index >= 0) continue;

      return Element.extend(element);
    }
  }


  function up(element, expression, index) {
    element = $(element);

    if (arguments.length === 1) return $(element.parentNode);
    return _recursivelyFind(element, 'parentNode', expression, index);
  }

  function down(element, expression, index) {
    if (arguments.length === 1) return firstDescendant(element);
    element = $(element), expression = expression || 0, index = index || 0;

    if (Object.isNumber(expression))
      index = expression, expression = '*';

    var node = Prototype.Selector.select(expression, element)[index];
    return Element.extend(node);
  }

  function previous(element, expression, index) {
    return _recursivelyFind(element, 'previousSibling', expression, index);
  }

  function next(element, expression, index) {
    return _recursivelyFind(element, 'nextSibling', expression, index);
  }

  function select(element) {
    element = $(element);
    var expressions = SLICE.call(arguments, 1).join(', ');
    return Prototype.Selector.select(expressions, element);
  }

  function adjacent(element) {
    element = $(element);
    var expressions = SLICE.call(arguments, 1).join(', ');
    var siblings = Element.siblings(element), results = [];
    for (var i = 0, sibling; sibling = siblings[i]; i++) {
      if (Prototype.Selector.match(sibling, expressions))
        results.push(sibling);
    }

    return results;
  }

  function descendantOf_DOM(element, ancestor) {
    element = $(element), ancestor = $(ancestor);
    while (element = element.parentNode)
      if (element === ancestor) return true;
    return false;
  }

  function descendantOf_contains(element, ancestor) {
    element = $(element), ancestor = $(ancestor);
    if (!ancestor.contains) return descendantOf_DOM(element, ancestor);
    return ancestor.contains(element) && ancestor !== element;
  }

  function descendantOf_compareDocumentPosition(element, ancestor) {
    element = $(element), ancestor = $(ancestor);
    return (element.compareDocumentPosition(ancestor) & 8) === 8;
  }

  var descendantOf;
  if (DIV.compareDocumentPosition) {
    descendantOf = descendantOf_compareDocumentPosition;
  } else if (DIV.contains) {
    descendantOf = descendantOf_contains;
  } else {
    descendantOf = descendantOf_DOM;
  }


  Object.extend(methods, {
    recursivelyCollect:   recursivelyCollect,
    ancestors:            ancestors,
    descendants:          descendants,
    firstDescendant:      firstDescendant,
    immediateDescendants: immediateDescendants,
    previousSiblings:     previousSiblings,
    nextSiblings:         nextSiblings,
    siblings:             siblings,
    match:                match,
    up:                   up,
    down:                 down,
    previous:             previous,
    next:                 next,
    select:               select,
    adjacent:             adjacent,
    descendantOf:         descendantOf,

    getElementsBySelector: select,

    childElements:         immediateDescendants
  });


  var idCounter = 1;
  function identify(element) {
    element = $(element);
    var id = Element.readAttribute(element, 'id');
    if (id) return id;

    do { id = 'anonymous_element_' + idCounter++ } while ($(id));

    Element.writeAttribute(element, 'id', id);
    return id;
  }


  function readAttribute(element, name) {
    return $(element).getAttribute(name);
  }

  function readAttribute_IE(element, name) {
    element = $(element);

    var table = ATTRIBUTE_TRANSLATIONS.read;
    if (table.values[name])
      return table.values[name](element, name);

    if (table.names[name]) name = table.names[name];

    if (name.include(':')) {
      if (!element.attributes || !element.attributes[name]) return null;
      return element.attributes[name].value;
    }

    return element.getAttribute(name);
  }

  function readAttribute_Opera(element, name) {
    if (name === 'title') return element.title;
    return element.getAttribute(name);
  }

  var PROBLEMATIC_ATTRIBUTE_READING = (function() {
    DIV.setAttribute('onclick', []);
    var value = DIV.getAttribute('onclick');
    var isFunction = Object.isArray(value);
    DIV.removeAttribute('onclick');
    return isFunction;
  })();

  if (PROBLEMATIC_ATTRIBUTE_READING) {
    readAttribute = readAttribute_IE;
  } else if (Prototype.Browser.Opera) {
    readAttribute = readAttribute_Opera;
  }


  function writeAttribute(element, name, value) {
    element = $(element);
    var attributes = {}, table = ATTRIBUTE_TRANSLATIONS.write;

    if (typeof name === 'object') {
      attributes = name;
    } else {
      attributes[name] = Object.isUndefined(value) ? true : value;
    }

    for (var attr in attributes) {
      name = table.names[attr] || attr;
      value = attributes[attr];
      if (table.values[attr])
        name = table.values[attr](element, value) || name;
      if (value === false || value === null)
        element.removeAttribute(name);
      else if (value === true)
        element.setAttribute(name, name);
      else element.setAttribute(name, value);
    }

    return element;
  }

  var PROBLEMATIC_HAS_ATTRIBUTE_WITH_CHECKBOXES = (function () {
    if (!HAS_EXTENDED_CREATE_ELEMENT_SYNTAX) {
      return false;
    }
    var checkbox = document.createElement('<input type="checkbox">');
    checkbox.checked = true;
    var node = checkbox.getAttributeNode('checked');
    return !node || !node.specified;
  })();

  function hasAttribute(element, attribute) {
    attribute = ATTRIBUTE_TRANSLATIONS.has[attribute] || attribute;
    var node = $(element).getAttributeNode(attribute);
    return !!(node && node.specified);
  }

  function hasAttribute_IE(element, attribute) {
    if (attribute === 'checked') {
      return element.checked;
    }
    return hasAttribute(element, attribute);
  }

  GLOBAL.Element.Methods.Simulated.hasAttribute =
   PROBLEMATIC_HAS_ATTRIBUTE_WITH_CHECKBOXES ?
   hasAttribute_IE : hasAttribute;

  function classNames(element) {
    return new Element.ClassNames(element);
  }

  var regExpCache = {};
  function getRegExpForClassName(className) {
    if (regExpCache[className]) return regExpCache[className];

    var re = new RegExp("(^|\\s+)" + className + "(\\s+|$)");
    regExpCache[className] = re;
    return re;
  }

  function hasClassName(element, className) {
    if (!(element = $(element))) return;

    var elementClassName = element.className;

    if (elementClassName.length === 0) return false;
    if (elementClassName === className) return true;

    return getRegExpForClassName(className).test(elementClassName);
  }

  function addClassName(element, className) {
    if (!(element = $(element))) return;

    if (!hasClassName(element, className))
      element.className += (element.className ? ' ' : '') + className;

    return element;
  }

  function removeClassName(element, className) {
    if (!(element = $(element))) return;

    element.className = element.className.replace(
     getRegExpForClassName(className), ' ').strip();

    return element;
  }

  function toggleClassName(element, className, bool) {
    if (!(element = $(element))) return;

    if (Object.isUndefined(bool))
      bool = !hasClassName(element, className);

    var method = Element[bool ? 'addClassName' : 'removeClassName'];
    return method(element, className);
  }

  var ATTRIBUTE_TRANSLATIONS = {};

  var classProp = 'className', forProp = 'for';

  DIV.setAttribute(classProp, 'x');
  if (DIV.className !== 'x') {
    DIV.setAttribute('class', 'x');
    if (DIV.className === 'x')
      classProp = 'class';
  }

  var LABEL = document.createElement('label');
  LABEL.setAttribute(forProp, 'x');
  if (LABEL.htmlFor !== 'x') {
    LABEL.setAttribute('htmlFor', 'x');
    if (LABEL.htmlFor === 'x')
      forProp = 'htmlFor';
  }
  LABEL = null;

  function _getAttr(element, attribute) {
    return element.getAttribute(attribute);
  }

  function _getAttr2(element, attribute) {
    return element.getAttribute(attribute, 2);
  }

  function _getAttrNode(element, attribute) {
    var node = element.getAttributeNode(attribute);
    return node ? node.value : '';
  }

  function _getFlag(element, attribute) {
    return $(element).hasAttribute(attribute) ? attribute : null;
  }

  DIV.onclick = Prototype.emptyFunction;
  var onclickValue = DIV.getAttribute('onclick');

  var _getEv;

  if (String(onclickValue).indexOf('{') > -1) {
    _getEv = function(element, attribute) {
      var value = element.getAttribute(attribute);
      if (!value) return null;
      value = value.toString();
      value = value.split('{')[1];
      value = value.split('}')[0];
      return value.strip();
    };
  }
  else if (onclickValue === '') {
    _getEv = function(element, attribute) {
      var value = element.getAttribute(attribute);
      if (!value) return null;
      return value.strip();
    };
  }

  ATTRIBUTE_TRANSLATIONS.read = {
    names: {
      'class':     classProp,
      'className': classProp,
      'for':       forProp,
      'htmlFor':   forProp
    },

    values: {
      style: function(element) {
        return element.style.cssText.toLowerCase();
      },
      title: function(element) {
        return element.title;
      }
    }
  };

  ATTRIBUTE_TRANSLATIONS.write = {
    names: {
      className:   'class',
      htmlFor:     'for',
      cellpadding: 'cellPadding',
      cellspacing: 'cellSpacing'
    },

    values: {
      checked: function(element, value) {
        element.checked = !!value;
      },

      style: function(element, value) {
        element.style.cssText = value ? value : '';
      }
    }
  };

  ATTRIBUTE_TRANSLATIONS.has = { names: {} };

  Object.extend(ATTRIBUTE_TRANSLATIONS.write.names,
   ATTRIBUTE_TRANSLATIONS.read.names);

  var CAMEL_CASED_ATTRIBUTE_NAMES = $w('colSpan rowSpan vAlign dateTime ' +
   'accessKey tabIndex encType maxLength readOnly longDesc frameBorder');

  for (var i = 0, attr; attr = CAMEL_CASED_ATTRIBUTE_NAMES[i]; i++) {
    ATTRIBUTE_TRANSLATIONS.write.names[attr.toLowerCase()] = attr;
    ATTRIBUTE_TRANSLATIONS.has.names[attr.toLowerCase()]   = attr;
  }

  Object.extend(ATTRIBUTE_TRANSLATIONS.read.values, {
    href:        _getAttr2,
    src:         _getAttr2,
    type:        _getAttr,
    action:      _getAttrNode,
    disabled:    _getFlag,
    checked:     _getFlag,
    readonly:    _getFlag,
    multiple:    _getFlag,
    onload:      _getEv,
    onunload:    _getEv,
    onclick:     _getEv,
    ondblclick:  _getEv,
    onmousedown: _getEv,
    onmouseup:   _getEv,
    onmouseover: _getEv,
    onmousemove: _getEv,
    onmouseout:  _getEv,
    onfocus:     _getEv,
    onblur:      _getEv,
    onkeypress:  _getEv,
    onkeydown:   _getEv,
    onkeyup:     _getEv,
    onsubmit:    _getEv,
    onreset:     _getEv,
    onselect:    _getEv,
    onchange:    _getEv
  });


  Object.extend(methods, {
    identify:        identify,
    readAttribute:   readAttribute,
    writeAttribute:  writeAttribute,
    classNames:      classNames,
    hasClassName:    hasClassName,
    addClassName:    addClassName,
    removeClassName: removeClassName,
    toggleClassName: toggleClassName
  });


  function normalizeStyleName(style) {
    if (style === 'float' || style === 'styleFloat')
      return 'cssFloat';
    return style.camelize();
  }

  function normalizeStyleName_IE(style) {
    if (style === 'float' || style === 'cssFloat')
      return 'styleFloat';
    return style.camelize();
  }

  function setStyle(element, styles) {
    element = $(element);
    var elementStyle = element.style, match;

    if (Object.isString(styles)) {
      elementStyle.cssText += ';' + styles;
      if (styles.include('opacity')) {
        var opacity = styles.match(/opacity:\s*(\d?\.?\d*)/)[1];
        Element.setOpacity(element, opacity);
      }
      return element;
    }

    for (var property in styles) {
      if (property === 'opacity') {
        Element.setOpacity(element, styles[property]);
      } else {
        var value = styles[property];
        if (property === 'float' || property === 'cssFloat') {
          property = Object.isUndefined(elementStyle.styleFloat) ?
           'cssFloat' : 'styleFloat';
        }
        elementStyle[property] = value;
      }
    }

    return element;
  }


  function getStyle(element, style) {
    element = $(element);
    style = normalizeStyleName(style);

    var value = element.style[style];
    if (!value || value === 'auto') {
      var css = document.defaultView.getComputedStyle(element, null);
      value = css ? css[style] : null;
    }

    if (style === 'opacity') return value ? parseFloat(value) : 1.0;
    return value === 'auto' ? null : value;
  }

  function getStyle_Opera(element, style) {
    switch (style) {
      case 'height': case 'width':
        if (!Element.visible(element)) return null;

        var dim = parseInt(getStyle(element, style), 10);

        if (dim !== element['offset' + style.capitalize()])
          return dim + 'px';

        return Element.measure(element, style);

      default: return getStyle(element, style);
    }
  }

  function getStyle_IE(element, style) {
    element = $(element);
    style = normalizeStyleName_IE(style);

    var value = element.style[style];
    if (!value && element.currentStyle) {
      value = element.currentStyle[style];
    }

    if (style === 'opacity' && !STANDARD_CSS_OPACITY_SUPPORTED)
      return getOpacity_IE(element);

    if (value === 'auto') {
      if ((style === 'width' || style === 'height') && Element.visible(element))
        return Element.measure(element, style) + 'px';
      return null;
    }

    return value;
  }

  function stripAlphaFromFilter_IE(filter) {
    return (filter || '').replace(/alpha\([^\)]*\)/gi, '');
  }

  function hasLayout_IE(element) {
    if (!element.currentStyle || !element.currentStyle.hasLayout)
      element.style.zoom = 1;
    return element;
  }

  var STANDARD_CSS_OPACITY_SUPPORTED = (function() {
    DIV.style.cssText = "opacity:.55";
    return /^0.55/.test(DIV.style.opacity);
  })();

  function setOpacity(element, value) {
    element = $(element);
    if (value == 1 || value === '') value = '';
    else if (value < 0.00001) value = 0;
    element.style.opacity = value;
    return element;
  }

  function setOpacity_IE(element, value) {
    if (STANDARD_CSS_OPACITY_SUPPORTED)
      return setOpacity(element, value);

    element = hasLayout_IE($(element));
    var filter = Element.getStyle(element, 'filter'),
     style = element.style;

    if (value == 1 || value === '') {
      filter = stripAlphaFromFilter_IE(filter);
      if (filter) style.filter = filter;
      else style.removeAttribute('filter');
      return element;
    }

    if (value < 0.00001) value = 0;

    style.filter = stripAlphaFromFilter_IE(filter) +
     'alpha(opacity=' + (value * 100) + ')';

    return element;
  }


  function getOpacity(element) {
    return Element.getStyle(element, 'opacity');
  }

  function getOpacity_IE(element) {
    if (STANDARD_CSS_OPACITY_SUPPORTED)
      return getOpacity(element);

    var filter = Element.getStyle(element, 'filter');
    if (filter.length === 0) return 1.0;
    var match = (filter || '').match(/alpha\(opacity=(.*)\)/);
    if (match && match[1]) return parseFloat(match[1]) / 100;
    return 1.0;
  }


  Object.extend(methods, {
    setStyle:   setStyle,
    getStyle:   getStyle,
    setOpacity: setOpacity,
    getOpacity: getOpacity
  });

  if ('styleFloat' in DIV.style) {
    methods.getStyle = getStyle_IE;
    methods.setOpacity = setOpacity_IE;
    methods.getOpacity = getOpacity_IE;
  }

  var UID = 0;

  GLOBAL.Element.Storage = { UID: 1 };

  function getUniqueElementID(element) {
    if (element === window) return 0;

    if (typeof element._prototypeUID === 'undefined')
      element._prototypeUID = Element.Storage.UID++;
    return element._prototypeUID;
  }

  function getUniqueElementID_IE(element) {
    if (element === window) return 0;
    if (element == document) return 1;
    return element.uniqueID;
  }

  var HAS_UNIQUE_ID_PROPERTY = ('uniqueID' in DIV);
  if (HAS_UNIQUE_ID_PROPERTY)
    getUniqueElementID = getUniqueElementID_IE;

  function getStorage(element) {
    if (!(element = $(element))) return;

    var uid = getUniqueElementID(element);

    if (!Element.Storage[uid])
      Element.Storage[uid] = $H();

    return Element.Storage[uid];
  }

  function store(element, key, value) {
    if (!(element = $(element))) return;
    var storage = getStorage(element);
    if (arguments.length === 2) {
      storage.update(key);
    } else {
      storage.set(key, value);
    }
    return element;
  }

  function retrieve(element, key, defaultValue) {
    if (!(element = $(element))) return;
    var storage = getStorage(element), value = storage.get(key);

    if (Object.isUndefined(value)) {
      storage.set(key, defaultValue);
      value = defaultValue;
    }

    return value;
  }


  Object.extend(methods, {
    getStorage: getStorage,
    store:      store,
    retrieve:   retrieve
  });


  var Methods = {}, ByTag = Element.Methods.ByTag,
   F = Prototype.BrowserFeatures;

  if (!F.ElementExtensions && ('__proto__' in DIV)) {
    GLOBAL.HTMLElement = {};
    GLOBAL.HTMLElement.prototype = DIV['__proto__'];
    F.ElementExtensions = true;
  }

  function checkElementPrototypeDeficiency(tagName) {
    if (typeof window.Element === 'undefined') return false;
    if (!HAS_EXTENDED_CREATE_ELEMENT_SYNTAX) return false;
    var proto = window.Element.prototype;
    if (proto) {
      var id = '_' + (Math.random() + '').slice(2),
       el = document.createElement(tagName);
      proto[id] = 'x';
      var isBuggy = (el[id] !== 'x');
      delete proto[id];
      el = null;
      return isBuggy;
    }

    return false;
  }

  var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY =
   checkElementPrototypeDeficiency('object');

  function extendElementWith(element, methods) {
    for (var property in methods) {
      var value = methods[property];
      if (Object.isFunction(value) && !(property in element))
        element[property] = value.methodize();
    }
  }

  var EXTENDED = {};
  function elementIsExtended(element) {
    var uid = getUniqueElementID(element);
    return (uid in EXTENDED);
  }

  function extend(element) {
    if (!element || elementIsExtended(element)) return element;
    if (element.nodeType !== Node.ELEMENT_NODE || element == window)
      return element;

    var methods = Object.clone(Methods),
     tagName = element.tagName.toUpperCase();

    if (ByTag[tagName]) Object.extend(methods, ByTag[tagName]);

    extendElementWith(element, methods);
    EXTENDED[getUniqueElementID(element)] = true;
    return element;
  }

  function extend_IE8(element) {
    if (!element || elementIsExtended(element)) return element;

    var t = element.tagName;
    if (t && (/^(?:object|applet|embed)$/i.test(t))) {
      extendElementWith(element, Element.Methods);
      extendElementWith(element, Element.Methods.Simulated);
      extendElementWith(element, Element.Methods.ByTag[t.toUpperCase()]);
    }

    return element;
  }

  if (F.SpecificElementExtensions) {
    extend = HTMLOBJECTELEMENT_PROTOTYPE_BUGGY ? extend_IE8 : Prototype.K;
  }

  function addMethodsToTagName(tagName, methods) {
    tagName = tagName.toUpperCase();
    if (!ByTag[tagName]) ByTag[tagName] = {};
    Object.extend(ByTag[tagName], methods);
  }

  function mergeMethods(destination, methods, onlyIfAbsent) {
    if (Object.isUndefined(onlyIfAbsent)) onlyIfAbsent = false;
    for (var property in methods) {
      var value = methods[property];
      if (!Object.isFunction(value)) continue;
      if (!onlyIfAbsent || !(property in destination))
        destination[property] = value.methodize();
    }
  }

  function findDOMClass(tagName) {
    var klass;
    var trans = {
      "OPTGROUP": "OptGroup", "TEXTAREA": "TextArea", "P": "Paragraph",
      "FIELDSET": "FieldSet", "UL": "UList", "OL": "OList", "DL": "DList",
      "DIR": "Directory", "H1": "Heading", "H2": "Heading", "H3": "Heading",
      "H4": "Heading", "H5": "Heading", "H6": "Heading", "Q": "Quote",
      "INS": "Mod", "DEL": "Mod", "A": "Anchor", "IMG": "Image", "CAPTION":
      "TableCaption", "COL": "TableCol", "COLGROUP": "TableCol", "THEAD":
      "TableSection", "TFOOT": "TableSection", "TBODY": "TableSection", "TR":
      "TableRow", "TH": "TableCell", "TD": "TableCell", "FRAMESET":
      "FrameSet", "IFRAME": "IFrame"
    };
    if (trans[tagName]) klass = 'HTML' + trans[tagName] + 'Element';
    if (window[klass]) return window[klass];
    klass = 'HTML' + tagName + 'Element';
    if (window[klass]) return window[klass];
    klass = 'HTML' + tagName.capitalize() + 'Element';
    if (window[klass]) return window[klass];

    var element = document.createElement(tagName),
     proto = element['__proto__'] || element.constructor.prototype;

    element = null;
    return proto;
  }

  function addMethods(methods) {
    if (arguments.length === 0) addFormMethods();

    if (arguments.length === 2) {
      var tagName = methods;
      methods = arguments[1];
    }

    if (!tagName) {
      Object.extend(Element.Methods, methods || {});
    } else {
      if (Object.isArray(tagName)) {
        for (var i = 0, tag; tag = tagName[i]; i++)
          addMethodsToTagName(tag, methods);
      } else {
        addMethodsToTagName(tagName, methods);
      }
    }

    var ELEMENT_PROTOTYPE = window.HTMLElement ? HTMLElement.prototype :
     Element.prototype;

    if (F.ElementExtensions) {
      mergeMethods(ELEMENT_PROTOTYPE, Element.Methods);
      mergeMethods(ELEMENT_PROTOTYPE, Element.Methods.Simulated, true);
    }

    if (F.SpecificElementExtensions) {
      for (var tag in Element.Methods.ByTag) {
        var klass = findDOMClass(tag);
        if (Object.isUndefined(klass)) continue;
        mergeMethods(klass.prototype, ByTag[tag]);
      }
    }

    Object.extend(Element, Element.Methods);
    Object.extend(Element, Element.Methods.Simulated);
    delete Element.ByTag;
    delete Element.Simulated;

    Element.extend.refresh();

    ELEMENT_CACHE = {};
  }

  Object.extend(GLOBAL.Element, {
    extend:     extend,
    addMethods: addMethods
  });

  if (extend === Prototype.K) {
    GLOBAL.Element.extend.refresh = Prototype.emptyFunction;
  } else {
    GLOBAL.Element.extend.refresh = function() {
      if (Prototype.BrowserFeatures.ElementExtensions) return;
      Object.extend(Methods, Element.Methods);
      Object.extend(Methods, Element.Methods.Simulated);

      EXTENDED = {};
    };
  }

  function addFormMethods() {
    Object.extend(Form, Form.Methods);
    Object.extend(Form.Element, Form.Element.Methods);
    Object.extend(Element.Methods.ByTag, {
      "FORM":     Object.clone(Form.Methods),
      "INPUT":    Object.clone(Form.Element.Methods),
      "SELECT":   Object.clone(Form.Element.Methods),
      "TEXTAREA": Object.clone(Form.Element.Methods),
      "BUTTON":   Object.clone(Form.Element.Methods)
    });
  }

  Element.addMethods(methods);

  function destroyCache_IE() {
    DIV = null;
    ELEMENT_CACHE = null;
  }

  if (window.attachEvent)
    window.attachEvent('onunload', destroyCache_IE);

})(this);
(function() {

  function toDecimal(pctString) {
    var match = pctString.match(/^(\d+)%?$/i);
    if (!match) return null;
    return (Number(match[1]) / 100);
  }

  function getRawStyle(element, style) {
    element = $(element);

    var value = element.style[style];
    if (!value || value === 'auto') {
      var css = document.defaultView.getComputedStyle(element, null);
      value = css ? css[style] : null;
    }

    if (style === 'opacity') return value ? parseFloat(value) : 1.0;
    return value === 'auto' ? null : value;
  }

  function getRawStyle_IE(element, style) {
    var value = element.style[style];
    if (!value && element.currentStyle) {
      value = element.currentStyle[style];
    }
    return value;
  }

  function getContentWidth(element, context) {
    var boxWidth = element.offsetWidth;

    var bl = getPixelValue(element, 'borderLeftWidth',  context) || 0;
    var br = getPixelValue(element, 'borderRightWidth', context) || 0;
    var pl = getPixelValue(element, 'paddingLeft',      context) || 0;
    var pr = getPixelValue(element, 'paddingRight',     context) || 0;

    return boxWidth - bl - br - pl - pr;
  }

  if ('currentStyle' in document.documentElement) {
    getRawStyle = getRawStyle_IE;
  }


  function getPixelValue(value, property, context) {
    var element = null;
    if (Object.isElement(value)) {
      element = value;
      value = getRawStyle(element, property);
    }

    if (value === null || Object.isUndefined(value)) {
      return null;
    }

    if ((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(value)) {
      return window.parseFloat(value);
    }

    var isPercentage = value.include('%'), isViewport = (context === document.viewport);

    if (/\d/.test(value) && element && element.runtimeStyle && !(isPercentage && isViewport)) {
      var style = element.style.left, rStyle = element.runtimeStyle.left;
      element.runtimeStyle.left = element.currentStyle.left;
      element.style.left = value || 0;
      value = element.style.pixelLeft;
      element.style.left = style;
      element.runtimeStyle.left = rStyle;

      return value;
    }

    if (element && isPercentage) {
      context = context || element.parentNode;
      var decimal = toDecimal(value), whole = null;

      var isHorizontal = property.include('left') || property.include('right') ||
       property.include('width');

      var isVertical   = property.include('top') || property.include('bottom') ||
        property.include('height');

      if (context === document.viewport) {
        if (isHorizontal) {
          whole = document.viewport.getWidth();
        } else if (isVertical) {
          whole = document.viewport.getHeight();
        }
      } else {
        if (isHorizontal) {
          whole = $(context).measure('width');
        } else if (isVertical) {
          whole = $(context).measure('height');
        }
      }

      return (whole === null) ? 0 : whole * decimal;
    }

    return 0;
  }

  function toCSSPixels(number) {
    if (Object.isString(number) && number.endsWith('px'))
      return number;
    return number + 'px';
  }

  function isDisplayed(element) {
    while (element && element.parentNode) {
      var display = element.getStyle('display');
      if (display === 'none') {
        return false;
      }
      element = $(element.parentNode);
    }
    return true;
  }

  var hasLayout = Prototype.K;
  if ('currentStyle' in document.documentElement) {
    hasLayout = function(element) {
      if (!element.currentStyle.hasLayout) {
        element.style.zoom = 1;
      }
      return element;
    };
  }

  function cssNameFor(key) {
    if (key.include('border')) key = key + '-width';
    return key.camelize();
  }

  Element.Layout = Class.create(Hash, {
    initialize: function($super, element, preCompute) {
      $super();
      this.element = $(element);

      Element.Layout.PROPERTIES.each( function(property) {
        this._set(property, null);
      }, this);

      if (preCompute) {
        this._preComputing = true;
        this._begin();
        Element.Layout.PROPERTIES.each( this._compute, this );
        this._end();
        this._preComputing = false;
      }
    },

    _set: function(property, value) {
      return Hash.prototype.set.call(this, property, value);
    },

    set: function(property, value) {
      throw "Properties of Element.Layout are read-only.";
    },

    get: function($super, property) {
      var value = $super(property);
      return value === null ? this._compute(property) : value;
    },

    _begin: function() {
      if (this._isPrepared()) return;

      var element = this.element;
      if (isDisplayed(element)) {
        this._setPrepared(true);
        return;
      }


      var originalStyles = {
        position:   element.style.position   || '',
        width:      element.style.width      || '',
        visibility: element.style.visibility || '',
        display:    element.style.display    || ''
      };

      element.store('prototype_original_styles', originalStyles);

      var position = getRawStyle(element, 'position'), width = element.offsetWidth;

      if (width === 0 || width === null) {
        element.style.display = 'block';
        width = element.offsetWidth;
      }

      var context = (position === 'fixed') ? document.viewport :
       element.parentNode;

      var tempStyles = {
        visibility: 'hidden',
        display:    'block'
      };

      if (position !== 'fixed') tempStyles.position = 'absolute';

      element.setStyle(tempStyles);

      var positionedWidth = element.offsetWidth, newWidth;
      if (width && (positionedWidth === width)) {
        newWidth = getContentWidth(element, context);
      } else if (position === 'absolute' || position === 'fixed') {
        newWidth = getContentWidth(element, context);
      } else {
        var parent = element.parentNode, pLayout = $(parent).getLayout();

        newWidth = pLayout.get('width') -
         this.get('margin-left') -
         this.get('border-left') -
         this.get('padding-left') -
         this.get('padding-right') -
         this.get('border-right') -
         this.get('margin-right');
      }

      element.setStyle({ width: newWidth + 'px' });

      this._setPrepared(true);
    },

    _end: function() {
      var element = this.element;
      var originalStyles = element.retrieve('prototype_original_styles');
      element.store('prototype_original_styles', null);
      element.setStyle(originalStyles);
      this._setPrepared(false);
    },

    _compute: function(property) {
      var COMPUTATIONS = Element.Layout.COMPUTATIONS;
      if (!(property in COMPUTATIONS)) {
        throw "Property not found.";
      }

      return this._set(property, COMPUTATIONS[property].call(this, this.element));
    },

    _isPrepared: function() {
      return this.element.retrieve('prototype_element_layout_prepared', false);
    },

    _setPrepared: function(bool) {
      return this.element.store('prototype_element_layout_prepared', bool);
    },

    toObject: function() {
      var args = $A(arguments);
      var keys = (args.length === 0) ? Element.Layout.PROPERTIES :
       args.join(' ').split(' ');
      var obj = {};
      keys.each( function(key) {
        if (!Element.Layout.PROPERTIES.include(key)) return;
        var value = this.get(key);
        if (value != null) obj[key] = value;
      }, this);
      return obj;
    },

    toHash: function() {
      var obj = this.toObject.apply(this, arguments);
      return new Hash(obj);
    },

    toCSS: function() {
      var args = $A(arguments);
      var keys = (args.length === 0) ? Element.Layout.PROPERTIES :
       args.join(' ').split(' ');
      var css = {};

      keys.each( function(key) {
        if (!Element.Layout.PROPERTIES.include(key)) return;
        if (Element.Layout.COMPOSITE_PROPERTIES.include(key)) return;

        var value = this.get(key);
        if (value != null) css[cssNameFor(key)] = value + 'px';
      }, this);
      return css;
    },

    inspect: function() {
      return "#<Element.Layout>";
    }
  });

  Object.extend(Element.Layout, {
    PROPERTIES: $w('height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height'),

    COMPOSITE_PROPERTIES: $w('padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height'),

    COMPUTATIONS: {
      'height': function(element) {
        if (!this._preComputing) this._begin();

        var bHeight = this.get('border-box-height');
        if (bHeight <= 0) {
          if (!this._preComputing) this._end();
          return 0;
        }

        var bTop = this.get('border-top'),
         bBottom = this.get('border-bottom');

        var pTop = this.get('padding-top'),
         pBottom = this.get('padding-bottom');

        if (!this._preComputing) this._end();

        return bHeight - bTop - bBottom - pTop - pBottom;
      },

      'width': function(element) {
        if (!this._preComputing) this._begin();

        var bWidth = this.get('border-box-width');
        if (bWidth <= 0) {
          if (!this._preComputing) this._end();
          return 0;
        }

        var bLeft = this.get('border-left'),
         bRight = this.get('border-right');

        var pLeft = this.get('padding-left'),
         pRight = this.get('padding-right');

        if (!this._preComputing) this._end();
        return bWidth - bLeft - bRight - pLeft - pRight;
      },

      'padding-box-height': function(element) {
        var height = this.get('height'),
         pTop = this.get('padding-top'),
         pBottom = this.get('padding-bottom');

        return height + pTop + pBottom;
      },

      'padding-box-width': function(element) {
        var width = this.get('width'),
         pLeft = this.get('padding-left'),
         pRight = this.get('padding-right');

        return width + pLeft + pRight;
      },

      'border-box-height': function(element) {
        if (!this._preComputing) this._begin();
        var height = element.offsetHeight;
        if (!this._preComputing) this._end();
        return height;
      },

      'border-box-width': function(element) {
        if (!this._preComputing) this._begin();
        var width = element.offsetWidth;
        if (!this._preComputing) this._end();
        return width;
      },

      'margin-box-height': function(element) {
        var bHeight = this.get('border-box-height'),
         mTop = this.get('margin-top'),
         mBottom = this.get('margin-bottom');

        if (bHeight <= 0) return 0;

        return bHeight + mTop + mBottom;
      },

      'margin-box-width': function(element) {
        var bWidth = this.get('border-box-width'),
         mLeft = this.get('margin-left'),
         mRight = this.get('margin-right');

        if (bWidth <= 0) return 0;

        return bWidth + mLeft + mRight;
      },

      'top': function(element) {
        var offset = element.positionedOffset();
        return offset.top;
      },

      'bottom': function(element) {
        var offset = element.positionedOffset(),
         parent = element.getOffsetParent(),
         pHeight = parent.measure('height');

        var mHeight = this.get('border-box-height');

        return pHeight - mHeight - offset.top;
      },

      'left': function(element) {
        var offset = element.positionedOffset();
        return offset.left;
      },

      'right': function(element) {
        var offset = element.positionedOffset(),
         parent = element.getOffsetParent(),
         pWidth = parent.measure('width');

        var mWidth = this.get('border-box-width');

        return pWidth - mWidth - offset.left;
      },

      'padding-top': function(element) {
        return getPixelValue(element, 'paddingTop');
      },

      'padding-bottom': function(element) {
        return getPixelValue(element, 'paddingBottom');
      },

      'padding-left': function(element) {
        return getPixelValue(element, 'paddingLeft');
      },

      'padding-right': function(element) {
        return getPixelValue(element, 'paddingRight');
      },

      'border-top': function(element) {
        return getPixelValue(element, 'borderTopWidth');
      },

      'border-bottom': function(element) {
        return getPixelValue(element, 'borderBottomWidth');
      },

      'border-left': function(element) {
        return getPixelValue(element, 'borderLeftWidth');
      },

      'border-right': function(element) {
        return getPixelValue(element, 'borderRightWidth');
      },

      'margin-top': function(element) {
        return getPixelValue(element, 'marginTop');
      },

      'margin-bottom': function(element) {
        return getPixelValue(element, 'marginBottom');
      },

      'margin-left': function(element) {
        return getPixelValue(element, 'marginLeft');
      },

      'margin-right': function(element) {
        return getPixelValue(element, 'marginRight');
      }
    }
  });

  if ('getBoundingClientRect' in document.documentElement) {
    Object.extend(Element.Layout.COMPUTATIONS, {
      'right': function(element) {
        var parent = hasLayout(element.getOffsetParent());
        var rect = element.getBoundingClientRect(),
         pRect = parent.getBoundingClientRect();

        return (pRect.right - rect.right).round();
      },

      'bottom': function(element) {
        var parent = hasLayout(element.getOffsetParent());
        var rect = element.getBoundingClientRect(),
         pRect = parent.getBoundingClientRect();

        return (pRect.bottom - rect.bottom).round();
      }
    });
  }

  Element.Offset = Class.create({
    initialize: function(left, top) {
      this.left = left.round();
      this.top  = top.round();

      this[0] = this.left;
      this[1] = this.top;
    },

    relativeTo: function(offset) {
      return new Element.Offset(
        this.left - offset.left,
        this.top  - offset.top
      );
    },

    inspect: function() {
      return "#<Element.Offset left: #{left} top: #{top}>".interpolate(this);
    },

    toString: function() {
      return "[#{left}, #{top}]".interpolate(this);
    },

    toArray: function() {
      return [this.left, this.top];
    }
  });

  function getLayout(element, preCompute) {
    return new Element.Layout(element, preCompute);
  }

  function measure(element, property) {
    return $(element).getLayout().get(property);
  }

  function getHeight(element) {
    return Element.getDimensions(element).height;
  }

  function getWidth(element) {
    return Element.getDimensions(element).width;
  }

  function getDimensions(element) {
    element = $(element);
    var display = Element.getStyle(element, 'display');

    if (display && display !== 'none') {
      return { width: element.offsetWidth, height: element.offsetHeight };
    }

    var style = element.style;
    var originalStyles = {
      visibility: style.visibility,
      position:   style.position,
      display:    style.display
    };

    var newStyles = {
      visibility: 'hidden',
      display:    'block'
    };

    if (originalStyles.position !== 'fixed')
      newStyles.position = 'absolute';

    Element.setStyle(element, newStyles);

    var dimensions = {
      width:  element.offsetWidth,
      height: element.offsetHeight
    };

    Element.setStyle(element, originalStyles);

    return dimensions;
  }

  function getOffsetParent(element) {
    element = $(element);

    if (isDocument(element) || isDetached(element) || isBody(element) || isHtml(element))
      return $(document.body);

    var isInline = (Element.getStyle(element, 'display') === 'inline');
    if (!isInline && element.offsetParent) return $(element.offsetParent);

    while ((element = element.parentNode) && element !== document.body) {
      if (Element.getStyle(element, 'position') !== 'static') {
        return isHtml(element) ? $(document.body) : $(element);
      }
    }

    return $(document.body);
  }


  function cumulativeOffset(element) {
    element = $(element);
    var valueT = 0, valueL = 0;
    if (element.parentNode) {
      do {
        valueT += element.offsetTop  || 0;
        valueL += element.offsetLeft || 0;
        element = element.offsetParent;
      } while (element);
    }
    return new Element.Offset(valueL, valueT);
  }

  function positionedOffset(element) {
    element = $(element);

    var layout = element.getLayout();

    var valueT = 0, valueL = 0;
    do {
      valueT += element.offsetTop  || 0;
      valueL += element.offsetLeft || 0;
      element = element.offsetParent;
      if (element) {
        if (isBody(element)) break;
        var p = Element.getStyle(element, 'position');
        if (p !== 'static') break;
      }
    } while (element);

    valueL -= layout.get('margin-top');
    valueT -= layout.get('margin-left');

    return new Element.Offset(valueL, valueT);
  }

  function cumulativeScrollOffset(element) {
    var valueT = 0, valueL = 0;
    do {
      if (element === document.body) {
        var bodyScrollNode = document.documentElement || document.body.parentNode || document.body;
        valueT += !Object.isUndefined(window.pageYOffset) ? window.pageYOffset : bodyScrollNode.scrollTop || 0;
        valueL += !Object.isUndefined(window.pageXOffset) ? window.pageXOffset : bodyScrollNode.scrollLeft || 0;
        break;
      } else {
        valueT += element.scrollTop  || 0;
        valueL += element.scrollLeft || 0;
        element = element.parentNode;
      }
    } while (element);
    return new Element.Offset(valueL, valueT);
  }

  function viewportOffset(forElement) {
    var valueT = 0, valueL = 0, docBody = document.body;

    forElement = $(forElement);
    var element = forElement;
    do {
      valueT += element.offsetTop  || 0;
      valueL += element.offsetLeft || 0;
      if (element.offsetParent == docBody &&
        Element.getStyle(element, 'position') == 'absolute') break;
    } while (element = element.offsetParent);

    element = forElement;
    do {
      if (element != docBody) {
        valueT -= element.scrollTop  || 0;
        valueL -= element.scrollLeft || 0;
      }
    } while (element = element.parentNode);
    return new Element.Offset(valueL, valueT);
  }

  function absolutize(element) {
    element = $(element);

    if (Element.getStyle(element, 'position') === 'absolute') {
      return element;
    }

    var offsetParent = getOffsetParent(element);
    var eOffset = element.viewportOffset(),
     pOffset = offsetParent.viewportOffset();

    var offset = eOffset.relativeTo(pOffset);
    var layout = element.getLayout();

    element.store('prototype_absolutize_original_styles', {
      position: element.getStyle('position'),
      left:     element.getStyle('left'),
      top:      element.getStyle('top'),
      width:    element.getStyle('width'),
      height:   element.getStyle('height')
    });

    element.setStyle({
      position: 'absolute',
      top:    offset.top + 'px',
      left:   offset.left + 'px',
      width:  layout.get('width') + 'px',
      height: layout.get('height') + 'px'
    });

    return element;
  }

  function relativize(element) {
    element = $(element);
    if (Element.getStyle(element, 'position') === 'relative') {
      return element;
    }

    var originalStyles =
     element.retrieve('prototype_absolutize_original_styles');

    if (originalStyles) element.setStyle(originalStyles);
    return element;
  }


  function scrollTo(element) {
    element = $(element);
    var pos = Element.cumulativeOffset(element);
    window.scrollTo(pos.left, pos.top);
    return element;
  }


  function makePositioned(element) {
    element = $(element);
    var position = Element.getStyle(element, 'position'), styles = {};
    if (position === 'static' || !position) {
      styles.position = 'relative';
      if (Prototype.Browser.Opera) {
        styles.top  = 0;
        styles.left = 0;
      }
      Element.setStyle(element, styles);
      Element.store(element, 'prototype_made_positioned', true);
    }
    return element;
  }

  function undoPositioned(element) {
    element = $(element);
    var storage = Element.getStorage(element),
     madePositioned = storage.get('prototype_made_positioned');

    if (madePositioned) {
      storage.unset('prototype_made_positioned');
      Element.setStyle(element, {
        position: '',
        top:      '',
        bottom:   '',
        left:     '',
        right:    ''
      });
    }
    return element;
  }

  function makeClipping(element) {
    element = $(element);

    var storage = Element.getStorage(element),
     madeClipping = storage.get('prototype_made_clipping');

    if (Object.isUndefined(madeClipping)) {
      var overflow = Element.getStyle(element, 'overflow');
      storage.set('prototype_made_clipping', overflow);
      if (overflow !== 'hidden')
        element.style.overflow = 'hidden';
    }

    return element;
  }

  function undoClipping(element) {
    element = $(element);
    var storage = Element.getStorage(element),
     overflow = storage.get('prototype_made_clipping');

    if (!Object.isUndefined(overflow)) {
      storage.unset('prototype_made_clipping');
      element.style.overflow = overflow || '';
    }

    return element;
  }

  function clonePosition(element, source, options) {
    options = Object.extend({
      setLeft:    true,
      setTop:     true,
      setWidth:   true,
      setHeight:  true,
      offsetTop:  0,
      offsetLeft: 0
    }, options || {});

    source  = $(source);
    element = $(element);
    var p, delta, layout, styles = {};

    if (options.setLeft || options.setTop) {
      p = Element.viewportOffset(source);
      delta = [0, 0];
      if (Element.getStyle(element, 'position') === 'absolute') {
        var parent = Element.getOffsetParent(element);
        if (parent !== document.body) delta = Element.viewportOffset(parent);
      }
    }

    if (options.setWidth || options.setHeight) {
      layout = Element.getLayout(source);
    }

    if (options.setLeft)
      styles.left = (p[0] - delta[0] + options.offsetLeft) + 'px';
    if (options.setTop)
      styles.top  = (p[1] - delta[1] + options.offsetTop)  + 'px';

    if (options.setWidth)
      styles.width  = layout.get('border-box-width')  + 'px';
    if (options.setHeight)
      styles.height = layout.get('border-box-height') + 'px';

    return Element.setStyle(element, styles);
  }


  if (Prototype.Browser.IE) {
    getOffsetParent = getOffsetParent.wrap(
      function(proceed, element) {
        element = $(element);

        if (isDocument(element) || isDetached(element) || isBody(element) || isHtml(element))
          return $(document.body);

        var position = element.getStyle('position');
        if (position !== 'static') return proceed(element);

        element.setStyle({ position: 'relative' });
        var value = proceed(element);
        element.setStyle({ position: position });
        return value;
      }
    );

    positionedOffset = positionedOffset.wrap(function(proceed, element) {
      element = $(element);
      if (!element.parentNode) return new Element.Offset(0, 0);
      var position = element.getStyle('position');
      if (position !== 'static') return proceed(element);

      var offsetParent = element.getOffsetParent();
      if (offsetParent && offsetParent.getStyle('position') === 'fixed')
        hasLayout(offsetParent);

      element.setStyle({ position: 'relative' });
      var value = proceed(element);
      element.setStyle({ position: position });
      return value;
    });
  } else if (Prototype.Browser.Webkit) {
    cumulativeOffset = function(element) {
      element = $(element);
      var valueT = 0, valueL = 0;
      do {
        valueT += element.offsetTop  || 0;
        valueL += element.offsetLeft || 0;
        if (element.offsetParent == document.body) {
          if (Element.getStyle(element, 'position') == 'absolute') break;
        }

        element = element.offsetParent;
      } while (element);

      return new Element.Offset(valueL, valueT);
    };
  }


  Element.addMethods({
    getLayout:              getLayout,
    measure:                measure,
    getWidth:               getWidth,
    getHeight:              getHeight,
    getDimensions:          getDimensions,
    getOffsetParent:        getOffsetParent,
    cumulativeOffset:       cumulativeOffset,
    positionedOffset:       positionedOffset,
    cumulativeScrollOffset: cumulativeScrollOffset,
    viewportOffset:         viewportOffset,
    absolutize:             absolutize,
    relativize:             relativize,
    scrollTo:               scrollTo,
    makePositioned:         makePositioned,
    undoPositioned:         undoPositioned,
    makeClipping:           makeClipping,
    undoClipping:           undoClipping,
    clonePosition:          clonePosition
  });

  function isBody(element) {
    return element.nodeName.toUpperCase() === 'BODY';
  }

  function isHtml(element) {
    return element.nodeName.toUpperCase() === 'HTML';
  }

  function isDocument(element) {
    return element.nodeType === Node.DOCUMENT_NODE;
  }

  function isDetached(element) {
    return element !== document.body &&
     !Element.descendantOf(element, document.body);
  }

  if ('getBoundingClientRect' in document.documentElement) {
    Element.addMethods({
      viewportOffset: function(element) {
        element = $(element);
        if (isDetached(element)) return new Element.Offset(0, 0);

        var rect = element.getBoundingClientRect(),
         docEl = document.documentElement;
        return new Element.Offset(rect.left - docEl.clientLeft,
         rect.top - docEl.clientTop);
      }
    });
  }


})();

(function() {

  var IS_OLD_OPERA = Prototype.Browser.Opera &&
   (window.parseFloat(window.opera.version()) < 9.5);
  var ROOT = null;
  function getRootElement() {
    if (ROOT) return ROOT;
    ROOT = IS_OLD_OPERA ? document.body : document.documentElement;
    return ROOT;
  }

  function getDimensions() {
    return { width: this.getWidth(), height: this.getHeight() };
  }

  function getWidth() {
    return getRootElement().clientWidth;
  }

  function getHeight() {
    return getRootElement().clientHeight;
  }

  function getScrollOffsets() {
    var x = window.pageXOffset || document.documentElement.scrollLeft ||
     document.body.scrollLeft;
    var y = window.pageYOffset || document.documentElement.scrollTop ||
     document.body.scrollTop;

    return new Element.Offset(x, y);
  }

  document.viewport = {
    getDimensions:    getDimensions,
    getWidth:         getWidth,
    getHeight:        getHeight,
    getScrollOffsets: getScrollOffsets
  };

})();
window.$$ = function() {
  var expression = $A(arguments).join(', ');
  return Prototype.Selector.select(expression, document);
};

Prototype.Selector = (function() {

  function select() {
    throw new Error('Method "Prototype.Selector.select" must be defined.');
  }

  function match() {
    throw new Error('Method "Prototype.Selector.match" must be defined.');
  }

  function find(elements, expression, index) {
    index = index || 0;
    var match = Prototype.Selector.match, length = elements.length, matchIndex = 0, i;

    for (i = 0; i < length; i++) {
      if (match(elements[i], expression) && index == matchIndex++) {
        return Element.extend(elements[i]);
      }
    }
  }

  function extendElements(elements) {
    for (var i = 0, length = elements.length; i < length; i++) {
      Element.extend(elements[i]);
    }
    return elements;
  }


  var K = Prototype.K;

  return {
    select: select,
    match: match,
    find: find,
    extendElements: (Element.extend === K) ? K : extendElements,
    extendElement: Element.extend
  };
})();
Prototype._original_property = window.Sizzle;
/*!
 * Sizzle CSS Selector Engine v@VERSION
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: @DATE
 */
(function( window ) {

var i,
	support,
	Expr,
	getText,
	isXML,
	compile,
	select,
	outermostContext,
	sortInput,
	hasDuplicate,

	setDocument,
	document,
	docElem,
	documentIsHTML,
	rbuggyQSA,
	rbuggyMatches,
	matches,
	contains,

	expando = "sizzle" + -(new Date()),
	preferredDoc = window.document,
	dirruns = 0,
	done = 0,
	classCache = createCache(),
	tokenCache = createCache(),
	compilerCache = createCache(),
	sortOrder = function( a, b ) {
		if ( a === b ) {
			hasDuplicate = true;
		}
		return 0;
	},

	strundefined = typeof undefined,
	MAX_NEGATIVE = 1 << 31,

	hasOwn = ({}).hasOwnProperty,
	arr = [],
	pop = arr.pop,
	push_native = arr.push,
	push = arr.push,
	slice = arr.slice,
	indexOf = arr.indexOf || function( elem ) {
		var i = 0,
			len = this.length;
		for ( ; i < len; i++ ) {
			if ( this[i] === elem ) {
				return i;
			}
		}
		return -1;
	},

	booleans = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",


	whitespace = "[\\x20\\t\\r\\n\\f]",
	characterEncoding = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",

	identifier = characterEncoding.replace( "w", "w#" ),

	attributes = "\\[" + whitespace + "*(" + characterEncoding + ")" + whitespace +
		"*(?:([*^$|!~]?=)" + whitespace + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + identifier + ")|)|)" + whitespace + "*\\]",

	pseudos = ":(" + characterEncoding + ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" + attributes.replace( 3, 8 ) + ")*)|.*)\\)|)",

	rtrim = new RegExp( "^" + whitespace + "+|((?:^|[^\\\\])(?:\\\\.)*)" + whitespace + "+$", "g" ),

	rcomma = new RegExp( "^" + whitespace + "*," + whitespace + "*" ),
	rcombinators = new RegExp( "^" + whitespace + "*([>+~]|" + whitespace + ")" + whitespace + "*" ),

	rattributeQuotes = new RegExp( "=" + whitespace + "*([^\\]'\"]*?)" + whitespace + "*\\]", "g" ),

	rpseudo = new RegExp( pseudos ),
	ridentifier = new RegExp( "^" + identifier + "$" ),

	matchExpr = {
		"ID": new RegExp( "^#(" + characterEncoding + ")" ),
		"CLASS": new RegExp( "^\\.(" + characterEncoding + ")" ),
		"TAG": new RegExp( "^(" + characterEncoding.replace( "w", "w*" ) + ")" ),
		"ATTR": new RegExp( "^" + attributes ),
		"PSEUDO": new RegExp( "^" + pseudos ),
		"CHILD": new RegExp( "^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + whitespace +
			"*(even|odd|(([+-]|)(\\d*)n|)" + whitespace + "*(?:([+-]|)" + whitespace +
			"*(\\d+)|))" + whitespace + "*\\)|)", "i" ),
		"bool": new RegExp( "^(?:" + booleans + ")$", "i" ),
		"needsContext": new RegExp( "^" + whitespace + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" +
			whitespace + "*((?:-\\d)?\\d*)" + whitespace + "*\\)|)(?=[^-]|$)", "i" )
	},

	rinputs = /^(?:input|select|textarea|button)$/i,
	rheader = /^h\d$/i,

	rnative = /^[^{]+\{\s*\[native \w/,

	rquickExpr = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,

	rsibling = /[+~]/,
	rescape = /'|\\/g,

	runescape = new RegExp( "\\\\([\\da-f]{1,6}" + whitespace + "?|(" + whitespace + ")|.)", "ig" ),
	funescape = function( _, escaped, escapedWhitespace ) {
		var high = "0x" + escaped - 0x10000;
		return high !== high || escapedWhitespace ?
			escaped :
			high < 0 ?
				String.fromCharCode( high + 0x10000 ) :
				String.fromCharCode( high >> 10 | 0xD800, high & 0x3FF | 0xDC00 );
	};

try {
	push.apply(
		(arr = slice.call( preferredDoc.childNodes )),
		preferredDoc.childNodes
	);
	arr[ preferredDoc.childNodes.length ].nodeType;
} catch ( e ) {
	push = { apply: arr.length ?

		function( target, els ) {
			push_native.apply( target, slice.call(els) );
		} :

		function( target, els ) {
			var j = target.length,
				i = 0;
			while ( (target[j++] = els[i++]) ) {}
			target.length = j - 1;
		}
	};
}

function Sizzle( selector, context, results, seed ) {
	var match, elem, m, nodeType,
		i, groups, old, nid, newContext, newSelector;

	if ( ( context ? context.ownerDocument || context : preferredDoc ) !== document ) {
		setDocument( context );
	}

	context = context || document;
	results = results || [];

	if ( !selector || typeof selector !== "string" ) {
		return results;
	}

	if ( (nodeType = context.nodeType) !== 1 && nodeType !== 9 ) {
		return [];
	}

	if ( documentIsHTML && !seed ) {

		if ( (match = rquickExpr.exec( selector )) ) {
			if ( (m = match[1]) ) {
				if ( nodeType === 9 ) {
					elem = context.getElementById( m );
					if ( elem && elem.parentNode ) {
						if ( elem.id === m ) {
							results.push( elem );
							return results;
						}
					} else {
						return results;
					}
				} else {
					if ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&
						contains( context, elem ) && elem.id === m ) {
						results.push( elem );
						return results;
					}
				}

			} else if ( match[2] ) {
				push.apply( results, context.getElementsByTagName( selector ) );
				return results;

			} else if ( (m = match[3]) && support.getElementsByClassName && context.getElementsByClassName ) {
				push.apply( results, context.getElementsByClassName( m ) );
				return results;
			}
		}

		if ( support.qsa && (!rbuggyQSA || !rbuggyQSA.test( selector )) ) {
			nid = old = expando;
			newContext = context;
			newSelector = nodeType === 9 && selector;

			if ( nodeType === 1 && context.nodeName.toLowerCase() !== "object" ) {
				groups = tokenize( selector );

				if ( (old = context.getAttribute("id")) ) {
					nid = old.replace( rescape, "\\$&" );
				} else {
					context.setAttribute( "id", nid );
				}
				nid = "[id='" + nid + "'] ";

				i = groups.length;
				while ( i-- ) {
					groups[i] = nid + toSelector( groups[i] );
				}
				newContext = rsibling.test( selector ) && testContext( context.parentNode ) || context;
				newSelector = groups.join(",");
			}

			if ( newSelector ) {
				try {
					push.apply( results,
						newContext.querySelectorAll( newSelector )
					);
					return results;
				} catch(qsaError) {
				} finally {
					if ( !old ) {
						context.removeAttribute("id");
					}
				}
			}
		}
	}

	return select( selector.replace( rtrim, "$1" ), context, results, seed );
}

/**
 * Create key-value caches of limited size
 * @returns {Function(string, Object)} Returns the Object data after storing it on itself with
 *	property name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)
 *	deleting the oldest entry
 */
function createCache() {
	var keys = [];

	function cache( key, value ) {
		if ( keys.push( key + " " ) > Expr.cacheLength ) {
			delete cache[ keys.shift() ];
		}
		return (cache[ key + " " ] = value);
	}
	return cache;
}

/**
 * Mark a function for special use by Sizzle
 * @param {Function} fn The function to mark
 */
function markFunction( fn ) {
	fn[ expando ] = true;
	return fn;
}

/**
 * Support testing using an element
 * @param {Function} fn Passed the created div and expects a boolean result
 */
function assert( fn ) {
	var div = document.createElement("div");

	try {
		return !!fn( div );
	} catch (e) {
		return false;
	} finally {
		if ( div.parentNode ) {
			div.parentNode.removeChild( div );
		}
		div = null;
	}
}

/**
 * Adds the same handler for all of the specified attrs
 * @param {String} attrs Pipe-separated list of attributes
 * @param {Function} handler The method that will be applied
 */
function addHandle( attrs, handler ) {
	var arr = attrs.split("|"),
		i = attrs.length;

	while ( i-- ) {
		Expr.attrHandle[ arr[i] ] = handler;
	}
}

/**
 * Checks document order of two siblings
 * @param {Element} a
 * @param {Element} b
 * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b
 */
function siblingCheck( a, b ) {
	var cur = b && a,
		diff = cur && a.nodeType === 1 && b.nodeType === 1 &&
			( ~b.sourceIndex || MAX_NEGATIVE ) -
			( ~a.sourceIndex || MAX_NEGATIVE );

	if ( diff ) {
		return diff;
	}

	if ( cur ) {
		while ( (cur = cur.nextSibling) ) {
			if ( cur === b ) {
				return -1;
			}
		}
	}

	return a ? 1 : -1;
}

/**
 * Returns a function to use in pseudos for input types
 * @param {String} type
 */
function createInputPseudo( type ) {
	return function( elem ) {
		var name = elem.nodeName.toLowerCase();
		return name === "input" && elem.type === type;
	};
}

/**
 * Returns a function to use in pseudos for buttons
 * @param {String} type
 */
function createButtonPseudo( type ) {
	return function( elem ) {
		var name = elem.nodeName.toLowerCase();
		return (name === "input" || name === "button") && elem.type === type;
	};
}

/**
 * Returns a function to use in pseudos for positionals
 * @param {Function} fn
 */
function createPositionalPseudo( fn ) {
	return markFunction(function( argument ) {
		argument = +argument;
		return markFunction(function( seed, matches ) {
			var j,
				matchIndexes = fn( [], seed.length, argument ),
				i = matchIndexes.length;

			while ( i-- ) {
				if ( seed[ (j = matchIndexes[i]) ] ) {
					seed[j] = !(matches[j] = seed[j]);
				}
			}
		});
	});
}

/**
 * Checks a node for validity as a Sizzle context
 * @param {Element|Object=} context
 * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value
 */
function testContext( context ) {
	return context && typeof context.getElementsByTagName !== strundefined && context;
}

support = Sizzle.support = {};

/**
 * Detects XML nodes
 * @param {Element|Object} elem An element or a document
 * @returns {Boolean} True iff elem is a non-HTML XML node
 */
isXML = Sizzle.isXML = function( elem ) {
	var documentElement = elem && (elem.ownerDocument || elem).documentElement;
	return documentElement ? documentElement.nodeName !== "HTML" : false;
};

/**
 * Sets document-related variables once based on the current document
 * @param {Element|Object} [doc] An element or document object to use to set the document
 * @returns {Object} Returns the current document
 */
setDocument = Sizzle.setDocument = function( node ) {
	var hasCompare,
		doc = node ? node.ownerDocument || node : preferredDoc,
		parent = doc.defaultView;

	if ( doc === document || doc.nodeType !== 9 || !doc.documentElement ) {
		return document;
	}

	document = doc;
	docElem = doc.documentElement;

	documentIsHTML = !isXML( doc );

	if ( parent && parent !== parent.top ) {
		if ( parent.addEventListener ) {
			parent.addEventListener( "unload", function() {
				setDocument();
			}, false );
		} else if ( parent.attachEvent ) {
			parent.attachEvent( "onunload", function() {
				setDocument();
			});
		}
	}

	/* Attributes
	---------------------------------------------------------------------- */

	support.attributes = assert(function( div ) {
		div.className = "i";
		return !div.getAttribute("className");
	});

	/* getElement(s)By*
	---------------------------------------------------------------------- */

	support.getElementsByTagName = assert(function( div ) {
		div.appendChild( doc.createComment("") );
		return !div.getElementsByTagName("*").length;
	});

	support.getElementsByClassName = rnative.test( doc.getElementsByClassName ) && assert(function( div ) {
		div.innerHTML = "<div class='a'></div><div class='a i'></div>";

		div.firstChild.className = "i";
		return div.getElementsByClassName("i").length === 2;
	});

	support.getById = assert(function( div ) {
		docElem.appendChild( div ).id = expando;
		return !doc.getElementsByName || !doc.getElementsByName( expando ).length;
	});

	if ( support.getById ) {
		Expr.find["ID"] = function( id, context ) {
			if ( typeof context.getElementById !== strundefined && documentIsHTML ) {
				var m = context.getElementById( id );
				return m && m.parentNode ? [m] : [];
			}
		};
		Expr.filter["ID"] = function( id ) {
			var attrId = id.replace( runescape, funescape );
			return function( elem ) {
				return elem.getAttribute("id") === attrId;
			};
		};
	} else {
		delete Expr.find["ID"];

		Expr.filter["ID"] =  function( id ) {
			var attrId = id.replace( runescape, funescape );
			return function( elem ) {
				var node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode("id");
				return node && node.value === attrId;
			};
		};
	}

	Expr.find["TAG"] = support.getElementsByTagName ?
		function( tag, context ) {
			if ( typeof context.getElementsByTagName !== strundefined ) {
				return context.getElementsByTagName( tag );
			}
		} :
		function( tag, context ) {
			var elem,
				tmp = [],
				i = 0,
				results = context.getElementsByTagName( tag );

			if ( tag === "*" ) {
				while ( (elem = results[i++]) ) {
					if ( elem.nodeType === 1 ) {
						tmp.push( elem );
					}
				}

				return tmp;
			}
			return results;
		};

	Expr.find["CLASS"] = support.getElementsByClassName && function( className, context ) {
		if ( typeof context.getElementsByClassName !== strundefined && documentIsHTML ) {
			return context.getElementsByClassName( className );
		}
	};

	/* QSA/matchesSelector
	---------------------------------------------------------------------- */


	rbuggyMatches = [];

	rbuggyQSA = [];

	if ( (support.qsa = rnative.test( doc.querySelectorAll )) ) {
		assert(function( div ) {
			div.innerHTML = "<select t=''><option selected=''></option></select>";

			if ( div.querySelectorAll("[t^='']").length ) {
				rbuggyQSA.push( "[*^$]=" + whitespace + "*(?:''|\"\")" );
			}

			if ( !div.querySelectorAll("[selected]").length ) {
				rbuggyQSA.push( "\\[" + whitespace + "*(?:value|" + booleans + ")" );
			}

			if ( !div.querySelectorAll(":checked").length ) {
				rbuggyQSA.push(":checked");
			}
		});

		assert(function( div ) {
			var input = doc.createElement("input");
			input.setAttribute( "type", "hidden" );
			div.appendChild( input ).setAttribute( "name", "D" );

			if ( div.querySelectorAll("[name=d]").length ) {
				rbuggyQSA.push( "name" + whitespace + "*[*^$|!~]?=" );
			}

			if ( !div.querySelectorAll(":enabled").length ) {
				rbuggyQSA.push( ":enabled", ":disabled" );
			}

			div.querySelectorAll("*,:x");
			rbuggyQSA.push(",.*:");
		});
	}

	if ( (support.matchesSelector = rnative.test( (matches = docElem.webkitMatchesSelector ||
		docElem.mozMatchesSelector ||
		docElem.oMatchesSelector ||
		docElem.msMatchesSelector) )) ) {

		assert(function( div ) {
			support.disconnectedMatch = matches.call( div, "div" );

			matches.call( div, "[s!='']:x" );
			rbuggyMatches.push( "!=", pseudos );
		});
	}

	rbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join("|") );
	rbuggyMatches = rbuggyMatches.length && new RegExp( rbuggyMatches.join("|") );

	/* Contains
	---------------------------------------------------------------------- */
	hasCompare = rnative.test( docElem.compareDocumentPosition );

	contains = hasCompare || rnative.test( docElem.contains ) ?
		function( a, b ) {
			var adown = a.nodeType === 9 ? a.documentElement : a,
				bup = b && b.parentNode;
			return a === bup || !!( bup && bup.nodeType === 1 && (
				adown.contains ?
					adown.contains( bup ) :
					a.compareDocumentPosition && a.compareDocumentPosition( bup ) & 16
			));
		} :
		function( a, b ) {
			if ( b ) {
				while ( (b = b.parentNode) ) {
					if ( b === a ) {
						return true;
					}
				}
			}
			return false;
		};

	/* Sorting
	---------------------------------------------------------------------- */

	sortOrder = hasCompare ?
	function( a, b ) {

		if ( a === b ) {
			hasDuplicate = true;
			return 0;
		}

		var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;
		if ( compare ) {
			return compare;
		}

		compare = ( a.ownerDocument || a ) === ( b.ownerDocument || b ) ?
			a.compareDocumentPosition( b ) :

			1;

		if ( compare & 1 ||
			(!support.sortDetached && b.compareDocumentPosition( a ) === compare) ) {

			if ( a === doc || a.ownerDocument === preferredDoc && contains(preferredDoc, a) ) {
				return -1;
			}
			if ( b === doc || b.ownerDocument === preferredDoc && contains(preferredDoc, b) ) {
				return 1;
			}

			return sortInput ?
				( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :
				0;
		}

		return compare & 4 ? -1 : 1;
	} :
	function( a, b ) {
		if ( a === b ) {
			hasDuplicate = true;
			return 0;
		}

		var cur,
			i = 0,
			aup = a.parentNode,
			bup = b.parentNode,
			ap = [ a ],
			bp = [ b ];

		if ( !aup || !bup ) {
			return a === doc ? -1 :
				b === doc ? 1 :
				aup ? -1 :
				bup ? 1 :
				sortInput ?
				( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :
				0;

		} else if ( aup === bup ) {
			return siblingCheck( a, b );
		}

		cur = a;
		while ( (cur = cur.parentNode) ) {
			ap.unshift( cur );
		}
		cur = b;
		while ( (cur = cur.parentNode) ) {
			bp.unshift( cur );
		}

		while ( ap[i] === bp[i] ) {
			i++;
		}

		return i ?
			siblingCheck( ap[i], bp[i] ) :

			ap[i] === preferredDoc ? -1 :
			bp[i] === preferredDoc ? 1 :
			0;
	};

	return doc;
};

Sizzle.matches = function( expr, elements ) {
	return Sizzle( expr, null, null, elements );
};

Sizzle.matchesSelector = function( elem, expr ) {
	if ( ( elem.ownerDocument || elem ) !== document ) {
		setDocument( elem );
	}

	expr = expr.replace( rattributeQuotes, "='$1']" );

	if ( support.matchesSelector && documentIsHTML &&
		( !rbuggyMatches || !rbuggyMatches.test( expr ) ) &&
		( !rbuggyQSA     || !rbuggyQSA.test( expr ) ) ) {

		try {
			var ret = matches.call( elem, expr );

			if ( ret || support.disconnectedMatch ||
					elem.document && elem.document.nodeType !== 11 ) {
				return ret;
			}
		} catch(e) {}
	}

	return Sizzle( expr, document, null, [elem] ).length > 0;
};

Sizzle.contains = function( context, elem ) {
	if ( ( context.ownerDocument || context ) !== document ) {
		setDocument( context );
	}
	return contains( context, elem );
};

Sizzle.attr = function( elem, name ) {
	if ( ( elem.ownerDocument || elem ) !== document ) {
		setDocument( elem );
	}

	var fn = Expr.attrHandle[ name.toLowerCase() ],
		val = fn && hasOwn.call( Expr.attrHandle, name.toLowerCase() ) ?
			fn( elem, name, !documentIsHTML ) :
			undefined;

	return val !== undefined ?
		val :
		support.attributes || !documentIsHTML ?
			elem.getAttribute( name ) :
			(val = elem.getAttributeNode(name)) && val.specified ?
				val.value :
				null;
};

Sizzle.error = function( msg ) {
	throw new Error( "Syntax error, unrecognized expression: " + msg );
};

/**
 * Document sorting and removing duplicates
 * @param {ArrayLike} results
 */
Sizzle.uniqueSort = function( results ) {
	var elem,
		duplicates = [],
		j = 0,
		i = 0;

	hasDuplicate = !support.detectDuplicates;
	sortInput = !support.sortStable && results.slice( 0 );
	results.sort( sortOrder );

	if ( hasDuplicate ) {
		while ( (elem = results[i++]) ) {
			if ( elem === results[ i ] ) {
				j = duplicates.push( i );
			}
		}
		while ( j-- ) {
			results.splice( duplicates[ j ], 1 );
		}
	}

	sortInput = null;

	return results;
};

/**
 * Utility function for retrieving the text value of an array of DOM nodes
 * @param {Array|Element} elem
 */
getText = Sizzle.getText = function( elem ) {
	var node,
		ret = "",
		i = 0,
		nodeType = elem.nodeType;

	if ( !nodeType ) {
		while ( (node = elem[i++]) ) {
			ret += getText( node );
		}
	} else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {
		if ( typeof elem.textContent === "string" ) {
			return elem.textContent;
		} else {
			for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
				ret += getText( elem );
			}
		}
	} else if ( nodeType === 3 || nodeType === 4 ) {
		return elem.nodeValue;
	}

	return ret;
};

Expr = Sizzle.selectors = {

	cacheLength: 50,

	createPseudo: markFunction,

	match: matchExpr,

	attrHandle: {},

	find: {},

	relative: {
		">": { dir: "parentNode", first: true },
		" ": { dir: "parentNode" },
		"+": { dir: "previousSibling", first: true },
		"~": { dir: "previousSibling" }
	},

	preFilter: {
		"ATTR": function( match ) {
			match[1] = match[1].replace( runescape, funescape );

			match[3] = ( match[4] || match[5] || "" ).replace( runescape, funescape );

			if ( match[2] === "~=" ) {
				match[3] = " " + match[3] + " ";
			}

			return match.slice( 0, 4 );
		},

		"CHILD": function( match ) {
			/* matches from matchExpr["CHILD"]
				1 type (only|nth|...)
				2 what (child|of-type)
				3 argument (even|odd|\d*|\d*n([+-]\d+)?|...)
				4 xn-component of xn+y argument ([+-]?\d*n|)
				5 sign of xn-component
				6 x of xn-component
				7 sign of y-component
				8 y of y-component
			*/
			match[1] = match[1].toLowerCase();

			if ( match[1].slice( 0, 3 ) === "nth" ) {
				if ( !match[3] ) {
					Sizzle.error( match[0] );
				}

				match[4] = +( match[4] ? match[5] + (match[6] || 1) : 2 * ( match[3] === "even" || match[3] === "odd" ) );
				match[5] = +( ( match[7] + match[8] ) || match[3] === "odd" );

			} else if ( match[3] ) {
				Sizzle.error( match[0] );
			}

			return match;
		},

		"PSEUDO": function( match ) {
			var excess,
				unquoted = !match[5] && match[2];

			if ( matchExpr["CHILD"].test( match[0] ) ) {
				return null;
			}

			if ( match[3] && match[4] !== undefined ) {
				match[2] = match[4];

			} else if ( unquoted && rpseudo.test( unquoted ) &&
				(excess = tokenize( unquoted, true )) &&
				(excess = unquoted.indexOf( ")", unquoted.length - excess ) - unquoted.length) ) {

				match[0] = match[0].slice( 0, excess );
				match[2] = unquoted.slice( 0, excess );
			}

			return match.slice( 0, 3 );
		}
	},

	filter: {

		"TAG": function( nodeNameSelector ) {
			var nodeName = nodeNameSelector.replace( runescape, funescape ).toLowerCase();
			return nodeNameSelector === "*" ?
				function() { return true; } :
				function( elem ) {
					return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;
				};
		},

		"CLASS": function( className ) {
			var pattern = classCache[ className + " " ];

			return pattern ||
				(pattern = new RegExp( "(^|" + whitespace + ")" + className + "(" + whitespace + "|$)" )) &&
				classCache( className, function( elem ) {
					return pattern.test( typeof elem.className === "string" && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute("class") || "" );
				});
		},

		"ATTR": function( name, operator, check ) {
			return function( elem ) {
				var result = Sizzle.attr( elem, name );

				if ( result == null ) {
					return operator === "!=";
				}
				if ( !operator ) {
					return true;
				}

				result += "";

				return operator === "=" ? result === check :
					operator === "!=" ? result !== check :
					operator === "^=" ? check && result.indexOf( check ) === 0 :
					operator === "*=" ? check && result.indexOf( check ) > -1 :
					operator === "$=" ? check && result.slice( -check.length ) === check :
					operator === "~=" ? ( " " + result + " " ).indexOf( check ) > -1 :
					operator === "|=" ? result === check || result.slice( 0, check.length + 1 ) === check + "-" :
					false;
			};
		},

		"CHILD": function( type, what, argument, first, last ) {
			var simple = type.slice( 0, 3 ) !== "nth",
				forward = type.slice( -4 ) !== "last",
				ofType = what === "of-type";

			return first === 1 && last === 0 ?

				function( elem ) {
					return !!elem.parentNode;
				} :

				function( elem, context, xml ) {
					var cache, outerCache, node, diff, nodeIndex, start,
						dir = simple !== forward ? "nextSibling" : "previousSibling",
						parent = elem.parentNode,
						name = ofType && elem.nodeName.toLowerCase(),
						useCache = !xml && !ofType;

					if ( parent ) {

						if ( simple ) {
							while ( dir ) {
								node = elem;
								while ( (node = node[ dir ]) ) {
									if ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) {
										return false;
									}
								}
								start = dir = type === "only" && !start && "nextSibling";
							}
							return true;
						}

						start = [ forward ? parent.firstChild : parent.lastChild ];

						if ( forward && useCache ) {
							outerCache = parent[ expando ] || (parent[ expando ] = {});
							cache = outerCache[ type ] || [];
							nodeIndex = cache[0] === dirruns && cache[1];
							diff = cache[0] === dirruns && cache[2];
							node = nodeIndex && parent.childNodes[ nodeIndex ];

							while ( (node = ++nodeIndex && node && node[ dir ] ||

								(diff = nodeIndex = 0) || start.pop()) ) {

								if ( node.nodeType === 1 && ++diff && node === elem ) {
									outerCache[ type ] = [ dirruns, nodeIndex, diff ];
									break;
								}
							}

						} else if ( useCache && (cache = (elem[ expando ] || (elem[ expando ] = {}))[ type ]) && cache[0] === dirruns ) {
							diff = cache[1];

						} else {
							while ( (node = ++nodeIndex && node && node[ dir ] ||
								(diff = nodeIndex = 0) || start.pop()) ) {

								if ( ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) && ++diff ) {
									if ( useCache ) {
										(node[ expando ] || (node[ expando ] = {}))[ type ] = [ dirruns, diff ];
									}

									if ( node === elem ) {
										break;
									}
								}
							}
						}

						diff -= last;
						return diff === first || ( diff % first === 0 && diff / first >= 0 );
					}
				};
		},

		"PSEUDO": function( pseudo, argument ) {
			var args,
				fn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||
					Sizzle.error( "unsupported pseudo: " + pseudo );

			if ( fn[ expando ] ) {
				return fn( argument );
			}

			if ( fn.length > 1 ) {
				args = [ pseudo, pseudo, "", argument ];
				return Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?
					markFunction(function( seed, matches ) {
						var idx,
							matched = fn( seed, argument ),
							i = matched.length;
						while ( i-- ) {
							idx = indexOf.call( seed, matched[i] );
							seed[ idx ] = !( matches[ idx ] = matched[i] );
						}
					}) :
					function( elem ) {
						return fn( elem, 0, args );
					};
			}

			return fn;
		}
	},

	pseudos: {
		"not": markFunction(function( selector ) {
			var input = [],
				results = [],
				matcher = compile( selector.replace( rtrim, "$1" ) );

			return matcher[ expando ] ?
				markFunction(function( seed, matches, context, xml ) {
					var elem,
						unmatched = matcher( seed, null, xml, [] ),
						i = seed.length;

					while ( i-- ) {
						if ( (elem = unmatched[i]) ) {
							seed[i] = !(matches[i] = elem);
						}
					}
				}) :
				function( elem, context, xml ) {
					input[0] = elem;
					matcher( input, null, xml, results );
					return !results.pop();
				};
		}),

		"has": markFunction(function( selector ) {
			return function( elem ) {
				return Sizzle( selector, elem ).length > 0;
			};
		}),

		"contains": markFunction(function( text ) {
			return function( elem ) {
				return ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;
			};
		}),

		"lang": markFunction( function( lang ) {
			if ( !ridentifier.test(lang || "") ) {
				Sizzle.error( "unsupported lang: " + lang );
			}
			lang = lang.replace( runescape, funescape ).toLowerCase();
			return function( elem ) {
				var elemLang;
				do {
					if ( (elemLang = documentIsHTML ?
						elem.lang :
						elem.getAttribute("xml:lang") || elem.getAttribute("lang")) ) {

						elemLang = elemLang.toLowerCase();
						return elemLang === lang || elemLang.indexOf( lang + "-" ) === 0;
					}
				} while ( (elem = elem.parentNode) && elem.nodeType === 1 );
				return false;
			};
		}),

		"target": function( elem ) {
			var hash = window.location && window.location.hash;
			return hash && hash.slice( 1 ) === elem.id;
		},

		"root": function( elem ) {
			return elem === docElem;
		},

		"focus": function( elem ) {
			return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);
		},

		"enabled": function( elem ) {
			return elem.disabled === false;
		},

		"disabled": function( elem ) {
			return elem.disabled === true;
		},

		"checked": function( elem ) {
			var nodeName = elem.nodeName.toLowerCase();
			return (nodeName === "input" && !!elem.checked) || (nodeName === "option" && !!elem.selected);
		},

		"selected": function( elem ) {
			if ( elem.parentNode ) {
				elem.parentNode.selectedIndex;
			}

			return elem.selected === true;
		},

		"empty": function( elem ) {
			for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
				if ( elem.nodeType < 6 ) {
					return false;
				}
			}
			return true;
		},

		"parent": function( elem ) {
			return !Expr.pseudos["empty"]( elem );
		},

		"header": function( elem ) {
			return rheader.test( elem.nodeName );
		},

		"input": function( elem ) {
			return rinputs.test( elem.nodeName );
		},

		"button": function( elem ) {
			var name = elem.nodeName.toLowerCase();
			return name === "input" && elem.type === "button" || name === "button";
		},

		"text": function( elem ) {
			var attr;
			return elem.nodeName.toLowerCase() === "input" &&
				elem.type === "text" &&

				( (attr = elem.getAttribute("type")) == null || attr.toLowerCase() === "text" );
		},

		"first": createPositionalPseudo(function() {
			return [ 0 ];
		}),

		"last": createPositionalPseudo(function( matchIndexes, length ) {
			return [ length - 1 ];
		}),

		"eq": createPositionalPseudo(function( matchIndexes, length, argument ) {
			return [ argument < 0 ? argument + length : argument ];
		}),

		"even": createPositionalPseudo(function( matchIndexes, length ) {
			var i = 0;
			for ( ; i < length; i += 2 ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"odd": createPositionalPseudo(function( matchIndexes, length ) {
			var i = 1;
			for ( ; i < length; i += 2 ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"lt": createPositionalPseudo(function( matchIndexes, length, argument ) {
			var i = argument < 0 ? argument + length : argument;
			for ( ; --i >= 0; ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"gt": createPositionalPseudo(function( matchIndexes, length, argument ) {
			var i = argument < 0 ? argument + length : argument;
			for ( ; ++i < length; ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		})
	}
};

Expr.pseudos["nth"] = Expr.pseudos["eq"];

for ( i in { radio: true, checkbox: true, file: true, password: true, image: true } ) {
	Expr.pseudos[ i ] = createInputPseudo( i );
}
for ( i in { submit: true, reset: true } ) {
	Expr.pseudos[ i ] = createButtonPseudo( i );
}

function setFilters() {}
setFilters.prototype = Expr.filters = Expr.pseudos;
Expr.setFilters = new setFilters();

function tokenize( selector, parseOnly ) {
	var matched, match, tokens, type,
		soFar, groups, preFilters,
		cached = tokenCache[ selector + " " ];

	if ( cached ) {
		return parseOnly ? 0 : cached.slice( 0 );
	}

	soFar = selector;
	groups = [];
	preFilters = Expr.preFilter;

	while ( soFar ) {

		if ( !matched || (match = rcomma.exec( soFar )) ) {
			if ( match ) {
				soFar = soFar.slice( match[0].length ) || soFar;
			}
			groups.push( (tokens = []) );
		}

		matched = false;

		if ( (match = rcombinators.exec( soFar )) ) {
			matched = match.shift();
			tokens.push({
				value: matched,
				type: match[0].replace( rtrim, " " )
			});
			soFar = soFar.slice( matched.length );
		}

		for ( type in Expr.filter ) {
			if ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||
				(match = preFilters[ type ]( match ))) ) {
				matched = match.shift();
				tokens.push({
					value: matched,
					type: type,
					matches: match
				});
				soFar = soFar.slice( matched.length );
			}
		}

		if ( !matched ) {
			break;
		}
	}

	return parseOnly ?
		soFar.length :
		soFar ?
			Sizzle.error( selector ) :
			tokenCache( selector, groups ).slice( 0 );
}

function toSelector( tokens ) {
	var i = 0,
		len = tokens.length,
		selector = "";
	for ( ; i < len; i++ ) {
		selector += tokens[i].value;
	}
	return selector;
}

function addCombinator( matcher, combinator, base ) {
	var dir = combinator.dir,
		checkNonElements = base && dir === "parentNode",
		doneName = done++;

	return combinator.first ?
		function( elem, context, xml ) {
			while ( (elem = elem[ dir ]) ) {
				if ( elem.nodeType === 1 || checkNonElements ) {
					return matcher( elem, context, xml );
				}
			}
		} :

		function( elem, context, xml ) {
			var oldCache, outerCache,
				newCache = [ dirruns, doneName ];

			if ( xml ) {
				while ( (elem = elem[ dir ]) ) {
					if ( elem.nodeType === 1 || checkNonElements ) {
						if ( matcher( elem, context, xml ) ) {
							return true;
						}
					}
				}
			} else {
				while ( (elem = elem[ dir ]) ) {
					if ( elem.nodeType === 1 || checkNonElements ) {
						outerCache = elem[ expando ] || (elem[ expando ] = {});
						if ( (oldCache = outerCache[ dir ]) &&
							oldCache[ 0 ] === dirruns && oldCache[ 1 ] === doneName ) {

							return (newCache[ 2 ] = oldCache[ 2 ]);
						} else {
							outerCache[ dir ] = newCache;

							if ( (newCache[ 2 ] = matcher( elem, context, xml )) ) {
								return true;
							}
						}
					}
				}
			}
		};
}

function elementMatcher( matchers ) {
	return matchers.length > 1 ?
		function( elem, context, xml ) {
			var i = matchers.length;
			while ( i-- ) {
				if ( !matchers[i]( elem, context, xml ) ) {
					return false;
				}
			}
			return true;
		} :
		matchers[0];
}

function multipleContexts( selector, contexts, results ) {
	var i = 0,
		len = contexts.length;
	for ( ; i < len; i++ ) {
		Sizzle( selector, contexts[i], results );
	}
	return results;
}

function condense( unmatched, map, filter, context, xml ) {
	var elem,
		newUnmatched = [],
		i = 0,
		len = unmatched.length,
		mapped = map != null;

	for ( ; i < len; i++ ) {
		if ( (elem = unmatched[i]) ) {
			if ( !filter || filter( elem, context, xml ) ) {
				newUnmatched.push( elem );
				if ( mapped ) {
					map.push( i );
				}
			}
		}
	}

	return newUnmatched;
}

function setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {
	if ( postFilter && !postFilter[ expando ] ) {
		postFilter = setMatcher( postFilter );
	}
	if ( postFinder && !postFinder[ expando ] ) {
		postFinder = setMatcher( postFinder, postSelector );
	}
	return markFunction(function( seed, results, context, xml ) {
		var temp, i, elem,
			preMap = [],
			postMap = [],
			preexisting = results.length,

			elems = seed || multipleContexts( selector || "*", context.nodeType ? [ context ] : context, [] ),

			matcherIn = preFilter && ( seed || !selector ) ?
				condense( elems, preMap, preFilter, context, xml ) :
				elems,

			matcherOut = matcher ?
				postFinder || ( seed ? preFilter : preexisting || postFilter ) ?

					[] :

					results :
				matcherIn;

		if ( matcher ) {
			matcher( matcherIn, matcherOut, context, xml );
		}

		if ( postFilter ) {
			temp = condense( matcherOut, postMap );
			postFilter( temp, [], context, xml );

			i = temp.length;
			while ( i-- ) {
				if ( (elem = temp[i]) ) {
					matcherOut[ postMap[i] ] = !(matcherIn[ postMap[i] ] = elem);
				}
			}
		}

		if ( seed ) {
			if ( postFinder || preFilter ) {
				if ( postFinder ) {
					temp = [];
					i = matcherOut.length;
					while ( i-- ) {
						if ( (elem = matcherOut[i]) ) {
							temp.push( (matcherIn[i] = elem) );
						}
					}
					postFinder( null, (matcherOut = []), temp, xml );
				}

				i = matcherOut.length;
				while ( i-- ) {
					if ( (elem = matcherOut[i]) &&
						(temp = postFinder ? indexOf.call( seed, elem ) : preMap[i]) > -1 ) {

						seed[temp] = !(results[temp] = elem);
					}
				}
			}

		} else {
			matcherOut = condense(
				matcherOut === results ?
					matcherOut.splice( preexisting, matcherOut.length ) :
					matcherOut
			);
			if ( postFinder ) {
				postFinder( null, results, matcherOut, xml );
			} else {
				push.apply( results, matcherOut );
			}
		}
	});
}

function matcherFromTokens( tokens ) {
	var checkContext, matcher, j,
		len = tokens.length,
		leadingRelative = Expr.relative[ tokens[0].type ],
		implicitRelative = leadingRelative || Expr.relative[" "],
		i = leadingRelative ? 1 : 0,

		matchContext = addCombinator( function( elem ) {
			return elem === checkContext;
		}, implicitRelative, true ),
		matchAnyContext = addCombinator( function( elem ) {
			return indexOf.call( checkContext, elem ) > -1;
		}, implicitRelative, true ),
		matchers = [ function( elem, context, xml ) {
			return ( !leadingRelative && ( xml || context !== outermostContext ) ) || (
				(checkContext = context).nodeType ?
					matchContext( elem, context, xml ) :
					matchAnyContext( elem, context, xml ) );
		} ];

	for ( ; i < len; i++ ) {
		if ( (matcher = Expr.relative[ tokens[i].type ]) ) {
			matchers = [ addCombinator(elementMatcher( matchers ), matcher) ];
		} else {
			matcher = Expr.filter[ tokens[i].type ].apply( null, tokens[i].matches );

			if ( matcher[ expando ] ) {
				j = ++i;
				for ( ; j < len; j++ ) {
					if ( Expr.relative[ tokens[j].type ] ) {
						break;
					}
				}
				return setMatcher(
					i > 1 && elementMatcher( matchers ),
					i > 1 && toSelector(
						tokens.slice( 0, i - 1 ).concat({ value: tokens[ i - 2 ].type === " " ? "*" : "" })
					).replace( rtrim, "$1" ),
					matcher,
					i < j && matcherFromTokens( tokens.slice( i, j ) ),
					j < len && matcherFromTokens( (tokens = tokens.slice( j )) ),
					j < len && toSelector( tokens )
				);
			}
			matchers.push( matcher );
		}
	}

	return elementMatcher( matchers );
}

function matcherFromGroupMatchers( elementMatchers, setMatchers ) {
	var bySet = setMatchers.length > 0,
		byElement = elementMatchers.length > 0,
		superMatcher = function( seed, context, xml, results, outermost ) {
			var elem, j, matcher,
				matchedCount = 0,
				i = "0",
				unmatched = seed && [],
				setMatched = [],
				contextBackup = outermostContext,
				elems = seed || byElement && Expr.find["TAG"]( "*", outermost ),
				dirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.random() || 0.1),
				len = elems.length;

			if ( outermost ) {
				outermostContext = context !== document && context;
			}

			for ( ; i !== len && (elem = elems[i]) != null; i++ ) {
				if ( byElement && elem ) {
					j = 0;
					while ( (matcher = elementMatchers[j++]) ) {
						if ( matcher( elem, context, xml ) ) {
							results.push( elem );
							break;
						}
					}
					if ( outermost ) {
						dirruns = dirrunsUnique;
					}
				}

				if ( bySet ) {
					if ( (elem = !matcher && elem) ) {
						matchedCount--;
					}

					if ( seed ) {
						unmatched.push( elem );
					}
				}
			}

			matchedCount += i;
			if ( bySet && i !== matchedCount ) {
				j = 0;
				while ( (matcher = setMatchers[j++]) ) {
					matcher( unmatched, setMatched, context, xml );
				}

				if ( seed ) {
					if ( matchedCount > 0 ) {
						while ( i-- ) {
							if ( !(unmatched[i] || setMatched[i]) ) {
								setMatched[i] = pop.call( results );
							}
						}
					}

					setMatched = condense( setMatched );
				}

				push.apply( results, setMatched );

				if ( outermost && !seed && setMatched.length > 0 &&
					( matchedCount + setMatchers.length ) > 1 ) {

					Sizzle.uniqueSort( results );
				}
			}

			if ( outermost ) {
				dirruns = dirrunsUnique;
				outermostContext = contextBackup;
			}

			return unmatched;
		};

	return bySet ?
		markFunction( superMatcher ) :
		superMatcher;
}

compile = Sizzle.compile = function( selector, match /* Internal Use Only */ ) {
	var i,
		setMatchers = [],
		elementMatchers = [],
		cached = compilerCache[ selector + " " ];

	if ( !cached ) {
		if ( !match ) {
			match = tokenize( selector );
		}
		i = match.length;
		while ( i-- ) {
			cached = matcherFromTokens( match[i] );
			if ( cached[ expando ] ) {
				setMatchers.push( cached );
			} else {
				elementMatchers.push( cached );
			}
		}

		cached = compilerCache( selector, matcherFromGroupMatchers( elementMatchers, setMatchers ) );

		cached.selector = selector;
	}
	return cached;
};

/**
 * A low-level selection function that works with Sizzle's compiled
 *  selector functions
 * @param {String|Function} selector A selector or a pre-compiled
 *  selector function built with Sizzle.compile
 * @param {Element} context
 * @param {Array} [results]
 * @param {Array} [seed] A set of elements to match against
 */
select = Sizzle.select = function( selector, context, results, seed ) {
	var i, tokens, token, type, find,
		compiled = typeof selector === "function" && selector,
		match = !seed && tokenize( (selector = compiled.selector || selector) );

	results = results || [];

	if ( match.length === 1 ) {

		tokens = match[0] = match[0].slice( 0 );
		if ( tokens.length > 2 && (token = tokens[0]).type === "ID" &&
				support.getById && context.nodeType === 9 && documentIsHTML &&
				Expr.relative[ tokens[1].type ] ) {

			context = ( Expr.find["ID"]( token.matches[0].replace(runescape, funescape), context ) || [] )[0];
			if ( !context ) {
				return results;

			} else if ( compiled ) {
				context = context.parentNode;
			}

			selector = selector.slice( tokens.shift().value.length );
		}

		i = matchExpr["needsContext"].test( selector ) ? 0 : tokens.length;
		while ( i-- ) {
			token = tokens[i];

			if ( Expr.relative[ (type = token.type) ] ) {
				break;
			}
			if ( (find = Expr.find[ type ]) ) {
				if ( (seed = find(
					token.matches[0].replace( runescape, funescape ),
					rsibling.test( tokens[0].type ) && testContext( context.parentNode ) || context
				)) ) {

					tokens.splice( i, 1 );
					selector = seed.length && toSelector( tokens );
					if ( !selector ) {
						push.apply( results, seed );
						return results;
					}

					break;
				}
			}
		}
	}

	( compiled || compile( selector, match ) )(
		seed,
		context,
		!documentIsHTML,
		results,
		rsibling.test( selector ) && testContext( context.parentNode ) || context
	);
	return results;
};


support.sortStable = expando.split("").sort( sortOrder ).join("") === expando;

support.detectDuplicates = !!hasDuplicate;

setDocument();

support.sortDetached = assert(function( div1 ) {
	return div1.compareDocumentPosition( document.createElement("div") ) & 1;
});

if ( !assert(function( div ) {
	div.innerHTML = "<a href='#'></a>";
	return div.firstChild.getAttribute("href") === "#" ;
}) ) {
	addHandle( "type|href|height|width", function( elem, name, isXML ) {
		if ( !isXML ) {
			return elem.getAttribute( name, name.toLowerCase() === "type" ? 1 : 2 );
		}
	});
}

if ( !support.attributes || !assert(function( div ) {
	div.innerHTML = "<input/>";
	div.firstChild.setAttribute( "value", "" );
	return div.firstChild.getAttribute( "value" ) === "";
}) ) {
	addHandle( "value", function( elem, name, isXML ) {
		if ( !isXML && elem.nodeName.toLowerCase() === "input" ) {
			return elem.defaultValue;
		}
	});
}

if ( !assert(function( div ) {
	return div.getAttribute("disabled") == null;
}) ) {
	addHandle( booleans, function( elem, name, isXML ) {
		var val;
		if ( !isXML ) {
			return elem[ name ] === true ? name.toLowerCase() :
					(val = elem.getAttributeNode( name )) && val.specified ?
					val.value :
				null;
		}
	});
}

if ( typeof define === "function" && define.amd ) {
	define(function() { return Sizzle; });
} else if ( typeof module !== "undefined" && module.exports ) {
	module.exports = Sizzle;
} else {
	window.Sizzle = Sizzle;
}

})( window );

;(function(engine) {
  var extendElements = Prototype.Selector.extendElements;

  function select(selector, scope) {
    return extendElements(engine(selector, scope || document));
  }

  function match(element, selector) {
    return engine.matches(selector, [element]).length == 1;
  }

  Prototype.Selector.engine = engine;
  Prototype.Selector.select = select;
  Prototype.Selector.match = match;
})(Sizzle);

window.Sizzle = Prototype._original_property;
delete Prototype._original_property;

var Form = {
  reset: function(form) {
    form = $(form);
    form.reset();
    return form;
  },

  serializeElements: function(elements, options) {
    if (typeof options != 'object') options = { hash: !!options };
    else if (Object.isUndefined(options.hash)) options.hash = true;
    var key, value, submitted = false, submit = options.submit, accumulator, initial;

    if (options.hash) {
      initial = {};
      accumulator = function(result, key, value) {
        if (key in result) {
          if (!Object.isArray(result[key])) result[key] = [result[key]];
          result[key] = result[key].concat(value);
        } else result[key] = value;
        return result;
      };
    } else {
      initial = '';
      accumulator = function(result, key, values) {
        if (!Object.isArray(values)) {values = [values];}
        if (!values.length) {return result;}
        var encodedKey = encodeURIComponent(key).gsub(/%20/, '+');
        return result + (result ? "&" : "") + values.map(function (value) {
          value = value.gsub(/(\r)?\n/, '\r\n');
          value = encodeURIComponent(value);
          value = value.gsub(/%20/, '+');
          return encodedKey + "=" + value;
        }).join("&");
      };
    }

    return elements.inject(initial, function(result, element) {
      if (!element.disabled && element.name) {
        key = element.name; value = $(element).getValue();
        if (value != null && element.type != 'file' && (element.type != 'submit' || (!submitted &&
            submit !== false && (!submit || key == submit) && (submitted = true)))) {
          result = accumulator(result, key, value);
        }
      }
      return result;
    });
  }
};

Form.Methods = {
  serialize: function(form, options) {
    return Form.serializeElements(Form.getElements(form), options);
  },


  getElements: function(form) {
    var elements = $(form).getElementsByTagName('*');
    var element, results = [], serializers = Form.Element.Serializers;

    for (var i = 0; element = elements[i]; i++) {
      if (serializers[element.tagName.toLowerCase()])
        results.push(Element.extend(element));
    }
    return results;
  },

  getInputs: function(form, typeName, name) {
    form = $(form);
    var inputs = form.getElementsByTagName('input');

    if (!typeName && !name) return $A(inputs).map(Element.extend);

    for (var i = 0, matchingInputs = [], length = inputs.length; i < length; i++) {
      var input = inputs[i];
      if ((typeName && input.type != typeName) || (name && input.name != name))
        continue;
      matchingInputs.push(Element.extend(input));
    }

    return matchingInputs;
  },

  disable: function(form) {
    form = $(form);
    Form.getElements(form).invoke('disable');
    return form;
  },

  enable: function(form) {
    form = $(form);
    Form.getElements(form).invoke('enable');
    return form;
  },

  findFirstElement: function(form) {
    var elements = $(form).getElements().findAll(function(element) {
      return 'hidden' != element.type && !element.disabled;
    });
    var firstByIndex = elements.findAll(function(element) {
      return element.hasAttribute('tabIndex') && element.tabIndex >= 0;
    }).sortBy(function(element) { return element.tabIndex }).first();

    return firstByIndex ? firstByIndex : elements.find(function(element) {
      return /^(?:input|select|textarea)$/i.test(element.tagName);
    });
  },

  focusFirstElement: function(form) {
    form = $(form);
    var element = form.findFirstElement();
    if (element) element.activate();
    return form;
  },

  request: function(form, options) {
    form = $(form), options = Object.clone(options || { });

    var params = options.parameters, action = form.readAttribute('action') || '';
    if (action.blank()) action = window.location.href;
    options.parameters = form.serialize(true);

    if (params) {
      if (Object.isString(params)) params = params.toQueryParams();
      Object.extend(options.parameters, params);
    }

    if (form.hasAttribute('method') && !options.method)
      options.method = form.method;

    return new Ajax.Request(action, options);
  }
};

/*--------------------------------------------------------------------------*/


Form.Element = {
  focus: function(element) {
    $(element).focus();
    return element;
  },

  select: function(element) {
    $(element).select();
    return element;
  }
};

Form.Element.Methods = {

  serialize: function(element) {
    element = $(element);
    if (!element.disabled && element.name) {
      var value = element.getValue();
      if (value != undefined) {
        var pair = { };
        pair[element.name] = value;
        return Object.toQueryString(pair);
      }
    }
    return '';
  },

  getValue: function(element) {
    element = $(element);
    var method = element.tagName.toLowerCase();
    return Form.Element.Serializers[method](element);
  },

  setValue: function(element, value) {
    element = $(element);
    var method = element.tagName.toLowerCase();
    Form.Element.Serializers[method](element, value);
    return element;
  },

  clear: function(element) {
    $(element).value = '';
    return element;
  },

  present: function(element) {
    return $(element).value != '';
  },

  activate: function(element) {
    element = $(element);
    try {
      element.focus();
      if (element.select && (element.tagName.toLowerCase() != 'input' ||
          !(/^(?:button|reset|submit)$/i.test(element.type))))
        element.select();
    } catch (e) { }
    return element;
  },

  disable: function(element) {
    element = $(element);
    element.disabled = true;
    return element;
  },

  enable: function(element) {
    element = $(element);
    element.disabled = false;
    return element;
  }
};

/*--------------------------------------------------------------------------*/

var Field = Form.Element;

var $F = Form.Element.Methods.getValue;

/*--------------------------------------------------------------------------*/

Form.Element.Serializers = (function() {
  function input(element, value) {
    switch (element.type.toLowerCase()) {
      case 'checkbox':
      case 'radio':
        return inputSelector(element, value);
      default:
        return valueSelector(element, value);
    }
  }

  function inputSelector(element, value) {
    if (Object.isUndefined(value))
      return element.checked ? element.value : null;
    else element.checked = !!value;
  }

  function valueSelector(element, value) {
    if (Object.isUndefined(value)) return element.value;
    else element.value = value;
  }

  function select(element, value) {
    if (Object.isUndefined(value))
      return (element.type === 'select-one' ? selectOne : selectMany)(element);

    var opt, currentValue, single = !Object.isArray(value);
    for (var i = 0, length = element.length; i < length; i++) {
      opt = element.options[i];
      currentValue = this.optionValue(opt);
      if (single) {
        if (currentValue == value) {
          opt.selected = true;
          return;
        }
      }
      else opt.selected = value.include(currentValue);
    }
  }

  function selectOne(element) {
    var index = element.selectedIndex;
    return index >= 0 ? optionValue(element.options[index]) : null;
  }

  function selectMany(element) {
    var values, length = element.length;
    if (!length) return null;

    for (var i = 0, values = []; i < length; i++) {
      var opt = element.options[i];
      if (opt.selected) values.push(optionValue(opt));
    }
    return values;
  }

  function optionValue(opt) {
    return Element.hasAttribute(opt, 'value') ? opt.value : opt.text;
  }

  return {
    input:         input,
    inputSelector: inputSelector,
    textarea:      valueSelector,
    select:        select,
    selectOne:     selectOne,
    selectMany:    selectMany,
    optionValue:   optionValue,
    button:        valueSelector
  };
})();

/*--------------------------------------------------------------------------*/


Abstract.TimedObserver = Class.create(PeriodicalExecuter, {
  initialize: function($super, element, frequency, callback) {
    $super(callback, frequency);
    this.element   = $(element);
    this.lastValue = this.getValue();
  },

  execute: function() {
    var value = this.getValue();
    if (Object.isString(this.lastValue) && Object.isString(value) ?
        this.lastValue != value : String(this.lastValue) != String(value)) {
      this.callback(this.element, value);
      this.lastValue = value;
    }
  }
});

Form.Element.Observer = Class.create(Abstract.TimedObserver, {
  getValue: function() {
    return Form.Element.getValue(this.element);
  }
});

Form.Observer = Class.create(Abstract.TimedObserver, {
  getValue: function() {
    return Form.serialize(this.element);
  }
});

/*--------------------------------------------------------------------------*/

Abstract.EventObserver = Class.create({
  initialize: function(element, callback) {
    this.element  = $(element);
    this.callback = callback;

    this.lastValue = this.getValue();
    if (this.element.tagName.toLowerCase() == 'form')
      this.registerFormCallbacks();
    else
      this.registerCallback(this.element);
  },

  onElementEvent: function() {
    var value = this.getValue();
    if (this.lastValue != value) {
      this.callback(this.element, value);
      this.lastValue = value;
    }
  },

  registerFormCallbacks: function() {
    Form.getElements(this.element).each(this.registerCallback, this);
  },

  registerCallback: function(element) {
    if (element.type) {
      switch (element.type.toLowerCase()) {
        case 'checkbox':
        case 'radio':
          Event.observe(element, 'click', this.onElementEvent.bind(this));
          break;
        default:
          Event.observe(element, 'change', this.onElementEvent.bind(this));
          break;
      }
    }
  }
});

Form.Element.EventObserver = Class.create(Abstract.EventObserver, {
  getValue: function() {
    return Form.Element.getValue(this.element);
  }
});

Form.EventObserver = Class.create(Abstract.EventObserver, {
  getValue: function() {
    return Form.serialize(this.element);
  }
});
(function(GLOBAL) {
  var DIV = document.createElement('div');
  var docEl = document.documentElement;
  var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED = 'onmouseenter' in docEl
   && 'onmouseleave' in docEl;

  var Event = {
    KEY_BACKSPACE: 8,
    KEY_TAB:       9,
    KEY_RETURN:   13,
    KEY_ESC:      27,
    KEY_LEFT:     37,
    KEY_UP:       38,
    KEY_RIGHT:    39,
    KEY_DOWN:     40,
    KEY_DELETE:   46,
    KEY_HOME:     36,
    KEY_END:      35,
    KEY_PAGEUP:   33,
    KEY_PAGEDOWN: 34,
    KEY_INSERT:   45
  };


  var isIELegacyEvent = function(event) { return false; };

  if (window.attachEvent) {
    if (window.addEventListener) {
      isIELegacyEvent = function(event) {
        return !(event instanceof window.Event);
      };
    } else {
      isIELegacyEvent = function(event) { return true; };
    }
  }

  var _isButton;

  function _isButtonForDOMEvents(event, code) {
    return event.which ? (event.which === code + 1) : (event.button === code);
  }

  var legacyButtonMap = { 0: 1, 1: 4, 2: 2 };
  function _isButtonForLegacyEvents(event, code) {
    return event.button === legacyButtonMap[code];
  }

  function _isButtonForWebKit(event, code) {
    switch (code) {
      case 0: return event.which == 1 && !event.metaKey;
      case 1: return event.which == 2 || (event.which == 1 && event.metaKey);
      case 2: return event.which == 3;
      default: return false;
    }
  }

  if (window.attachEvent) {
    if (!window.addEventListener) {
      _isButton = _isButtonForLegacyEvents;
    } else {
      _isButton = function(event, code) {
        return isIELegacyEvent(event) ? _isButtonForLegacyEvents(event, code) :
         _isButtonForDOMEvents(event, code);
      }
    }
  } else if (Prototype.Browser.WebKit) {
    _isButton = _isButtonForWebKit;
  } else {
    _isButton = _isButtonForDOMEvents;
  }

  function isLeftClick(event)   { return _isButton(event, 0) }

  function isMiddleClick(event) { return _isButton(event, 1) }

  function isRightClick(event)  { return _isButton(event, 2) }

  function element(event) {
    return Element.extend(_element(event));
  }

  function _element(event) {
    event = Event.extend(event);

    var node = event.target, type = event.type,
     currentTarget = event.currentTarget;

    if (currentTarget && currentTarget.tagName) {
      if (type === 'load' || type === 'error' ||
        (type === 'click' && currentTarget.tagName.toLowerCase() === 'input'
          && currentTarget.type === 'radio'))
            node = currentTarget;
    }

    return node.nodeType == Node.TEXT_NODE ? node.parentNode : node;
  }

  function findElement(event, expression) {
    var element = _element(event), selector = Prototype.Selector;
    if (!expression) return Element.extend(element);
    while (element) {
      if (Object.isElement(element) && selector.match(element, expression))
        return Element.extend(element);
      element = element.parentNode;
    }
  }

  function pointer(event) {
    return { x: pointerX(event), y: pointerY(event) };
  }

  function pointerX(event) {
    var docElement = document.documentElement,
     body = document.body || { scrollLeft: 0 };

    return event.pageX || (event.clientX +
      (docElement.scrollLeft || body.scrollLeft) -
      (docElement.clientLeft || 0));
  }

  function pointerY(event) {
    var docElement = document.documentElement,
     body = document.body || { scrollTop: 0 };

    return  event.pageY || (event.clientY +
       (docElement.scrollTop || body.scrollTop) -
       (docElement.clientTop || 0));
  }


  function stop(event) {
    Event.extend(event);
    event.preventDefault();
    event.stopPropagation();

    event.stopped = true;
  }


  Event.Methods = {
    isLeftClick:   isLeftClick,
    isMiddleClick: isMiddleClick,
    isRightClick:  isRightClick,

    element:     element,
    findElement: findElement,

    pointer:  pointer,
    pointerX: pointerX,
    pointerY: pointerY,

    stop: stop
  };

  var methods = Object.keys(Event.Methods).inject({ }, function(m, name) {
    m[name] = Event.Methods[name].methodize();
    return m;
  });

  if (window.attachEvent) {
    function _relatedTarget(event) {
      var element;
      switch (event.type) {
        case 'mouseover':
        case 'mouseenter':
          element = event.fromElement;
          break;
        case 'mouseout':
        case 'mouseleave':
          element = event.toElement;
          break;
        default:
          return null;
      }
      return Element.extend(element);
    }

    var additionalMethods = {
      stopPropagation: function() { this.cancelBubble = true },
      preventDefault:  function() { this.returnValue = false },
      inspect: function() { return '[object Event]' }
    };

    Event.extend = function(event, element) {
      if (!event) return false;

      if (!isIELegacyEvent(event)) return event;

      if (event._extendedByPrototype) return event;
      event._extendedByPrototype = Prototype.emptyFunction;

      var pointer = Event.pointer(event);

      Object.extend(event, {
        target: event.srcElement || element,
        relatedTarget: _relatedTarget(event),
        pageX:  pointer.x,
        pageY:  pointer.y
      });

      Object.extend(event, methods);
      Object.extend(event, additionalMethods);

      return event;
    };
  } else {
    Event.extend = Prototype.K;
  }

  if (window.addEventListener) {
    Event.prototype = window.Event.prototype || document.createEvent('HTMLEvents').__proto__;
    Object.extend(Event.prototype, methods);
  }

  var EVENT_TRANSLATIONS = {
    mouseenter: 'mouseover',
    mouseleave: 'mouseout'
  };

  function getDOMEventName(eventName) {
    return EVENT_TRANSLATIONS[eventName] || eventName;
  }

  if (MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED)
    getDOMEventName = Prototype.K;

  function getUniqueElementID(element) {
    if (element === window) return 0;

    if (typeof element._prototypeUID === 'undefined')
      element._prototypeUID = Element.Storage.UID++;
    return element._prototypeUID;
  }

  function getUniqueElementID_IE(element) {
    if (element === window) return 0;
    if (element == document) return 1;
    return element.uniqueID;
  }

  if ('uniqueID' in DIV)
    getUniqueElementID = getUniqueElementID_IE;

  function isCustomEvent(eventName) {
    return eventName.include(':');
  }

  Event._isCustomEvent = isCustomEvent;

  function getRegistryForElement(element, uid) {
    var CACHE = GLOBAL.Event.cache;
    if (Object.isUndefined(uid))
      uid = getUniqueElementID(element);
    if (!CACHE[uid]) CACHE[uid] = { element: element };
    return CACHE[uid];
  }

  function destroyRegistryForElement(element, uid) {
    if (Object.isUndefined(uid))
      uid = getUniqueElementID(element);
    delete GLOBAL.Event.cache[uid];
  }


  function register(element, eventName, handler) {
    var registry = getRegistryForElement(element);
    if (!registry[eventName]) registry[eventName] = [];
    var entries = registry[eventName];

    var i = entries.length;
    while (i--)
      if (entries[i].handler === handler) return null;

    var uid = getUniqueElementID(element);
    var responder = GLOBAL.Event._createResponder(uid, eventName, handler);
    var entry = {
      responder: responder,
      handler:   handler
    };

    entries.push(entry);
    return entry;
  }

  function unregister(element, eventName, handler) {
    var registry = getRegistryForElement(element);
    var entries = registry[eventName];
    if (!entries) return;

    var i = entries.length, entry;
    while (i--) {
      if (entries[i].handler === handler) {
        entry = entries[i];
        break;
      }
    }

    if (!entry) return;

    var index = entries.indexOf(entry);
    entries.splice(index, 1);

    return entry;
  }


  function observe(element, eventName, handler) {
    element = $(element);
    var entry = register(element, eventName, handler);

    if (entry === null) return element;

    var responder = entry.responder;
    if (isCustomEvent(eventName))
      observeCustomEvent(element, eventName, responder);
    else
      observeStandardEvent(element, eventName, responder);

    return element;
  }

  function observeStandardEvent(element, eventName, responder) {
    var actualEventName = getDOMEventName(eventName);
    if (element.addEventListener) {
      element.addEventListener(actualEventName, responder, false);
    } else {
      element.attachEvent('on' + actualEventName, responder);
    }
  }

  function observeCustomEvent(element, eventName, responder) {
    if (element.addEventListener) {
      element.addEventListener('dataavailable', responder, false);
    } else {
      element.attachEvent('ondataavailable', responder);
      element.attachEvent('onlosecapture',   responder);
    }
  }

  function stopObserving(element, eventName, handler) {
    element = $(element);
    var handlerGiven = !Object.isUndefined(handler),
     eventNameGiven = !Object.isUndefined(eventName);

    if (!eventNameGiven && !handlerGiven) {
      stopObservingElement(element);
      return element;
    }

    if (!handlerGiven) {
      stopObservingEventName(element, eventName);
      return element;
    }

    var entry = unregister(element, eventName, handler);

    if (!entry) return element;
    removeEvent(element, eventName, entry.responder);
    return element;
  }

  function stopObservingStandardEvent(element, eventName, responder) {
    var actualEventName = getDOMEventName(eventName);
    if (element.removeEventListener) {
      element.removeEventListener(actualEventName, responder, false);
    } else {
      element.detachEvent('on' + actualEventName, responder);
    }
  }

  function stopObservingCustomEvent(element, eventName, responder) {
    if (element.removeEventListener) {
      element.removeEventListener('dataavailable', responder, false);
    } else {
      element.detachEvent('ondataavailable', responder);
      element.detachEvent('onlosecapture',   responder);
    }
  }



  function stopObservingElement(element) {
    var uid = getUniqueElementID(element), registry = GLOBAL.Event.cache[uid];
    if (!registry) return;

    destroyRegistryForElement(element, uid);

    var entries, i;
    for (var eventName in registry) {
      if (eventName === 'element') continue;

      entries = registry[eventName];
      i = entries.length;
      while (i--)
        removeEvent(element, eventName, entries[i].responder);
    }
  }

  function stopObservingEventName(element, eventName) {
    var registry = getRegistryForElement(element);
    var entries = registry[eventName];
    if (!entries) return;
    delete registry[eventName];

    var i = entries.length;
    while (i--)
      removeEvent(element, eventName, entries[i].responder);
  }


  function removeEvent(element, eventName, handler) {
    if (isCustomEvent(eventName))
      stopObservingCustomEvent(element, eventName, handler);
    else
      stopObservingStandardEvent(element, eventName, handler);
  }



  function getFireTarget(element) {
    if (element !== document) return element;
    if (document.createEvent && !element.dispatchEvent)
      return document.documentElement;
    return element;
  }

  function fire(element, eventName, memo, bubble) {
    element = getFireTarget($(element));
    if (Object.isUndefined(bubble)) bubble = true;
    memo = memo || {};

    var event = fireEvent(element, eventName, memo, bubble);
    return Event.extend(event);
  }

  function fireEvent_DOM(element, eventName, memo, bubble) {
    var event = document.createEvent('HTMLEvents');
    event.initEvent('dataavailable', bubble, true);

    event.eventName = eventName;
    event.memo = memo;

    element.dispatchEvent(event);
    return event;
  }

  function fireEvent_IE(element, eventName, memo, bubble) {
    var event = document.createEventObject();
    event.eventType = bubble ? 'ondataavailable' : 'onlosecapture';

    event.eventName = eventName;
    event.memo = memo;

    element.fireEvent(event.eventType, event);
    return event;
  }

  var fireEvent = document.createEvent ? fireEvent_DOM : fireEvent_IE;



  Event.Handler = Class.create({
    initialize: function(element, eventName, selector, callback) {
      this.element   = $(element);
      this.eventName = eventName;
      this.selector  = selector;
      this.callback  = callback;
      this.handler   = this.handleEvent.bind(this);
    },


    start: function() {
      Event.observe(this.element, this.eventName, this.handler);
      return this;
    },

    stop: function() {
      Event.stopObserving(this.element, this.eventName, this.handler);
      return this;
    },

    handleEvent: function(event) {
      var element = Event.findElement(event, this.selector);
      if (element) this.callback.call(this.element, event, element);
    }
  });

  function on(element, eventName, selector, callback) {
    element = $(element);
    if (Object.isFunction(selector) && Object.isUndefined(callback)) {
      callback = selector, selector = null;
    }

    return new Event.Handler(element, eventName, selector, callback).start();
  }

  Object.extend(Event, Event.Methods);

  Object.extend(Event, {
    fire:          fire,
    observe:       observe,
    stopObserving: stopObserving,
    on:            on
  });

  Element.addMethods({
    fire:          fire,

    observe:       observe,

    stopObserving: stopObserving,

    on:            on
  });

  Object.extend(document, {
    fire:          fire.methodize(),

    observe:       observe.methodize(),

    stopObserving: stopObserving.methodize(),

    on:            on.methodize(),

    loaded:        false
  });

  if (GLOBAL.Event) Object.extend(window.Event, Event);
  else GLOBAL.Event = Event;

  GLOBAL.Event.cache = {};

  function destroyCache_IE() {
    GLOBAL.Event.cache = null;
  }

  if (window.attachEvent)
    window.attachEvent('onunload', destroyCache_IE);

  DIV = null;
  docEl = null;
})(this);

(function(GLOBAL) {
  /* Code for creating leak-free event responders is based on work by
   John-David Dalton. */

  var docEl = document.documentElement;
  var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED = 'onmouseenter' in docEl
    && 'onmouseleave' in docEl;

  function isSimulatedMouseEnterLeaveEvent(eventName) {
    return !MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED &&
     (eventName === 'mouseenter' || eventName === 'mouseleave');
  }

  function createResponder(uid, eventName, handler) {
    if (Event._isCustomEvent(eventName))
      return createResponderForCustomEvent(uid, eventName, handler);
    if (isSimulatedMouseEnterLeaveEvent(eventName))
      return createMouseEnterLeaveResponder(uid, eventName, handler);

    return function(event) {
      if (!Event.cache) return;

      var element = Event.cache[uid].element;
      Event.extend(event, element);
      handler.call(element, event);
    };
  }

  function createResponderForCustomEvent(uid, eventName, handler) {
    return function(event) {
      var element = Event.cache[uid].element;

      if (Object.isUndefined(event.eventName))
        return false;

      if (event.eventName !== eventName)
        return false;

      Event.extend(event, element);
      handler.call(element, event);
    };
  }

  function createMouseEnterLeaveResponder(uid, eventName, handler) {
    return function(event) {
      var element = Event.cache[uid].element;

      Event.extend(event, element);
      var parent = event.relatedTarget;

      while (parent && parent !== element) {
        try { parent = parent.parentNode; }
        catch(e) { parent = element; }
      }

      if (parent === element) return;
      handler.call(element, event);
    }
  }

  GLOBAL.Event._createResponder = createResponder;
  docEl = null;
})(this);

(function(GLOBAL) {
  /* Support for the DOMContentLoaded event is based on work by Dan Webb,
     Matthias Miller, Dean Edwards, John Resig, and Diego Perini. */

  var TIMER;

  function fireContentLoadedEvent() {
    if (document.loaded) return;
    if (TIMER) window.clearTimeout(TIMER);
    document.loaded = true;
    document.fire('dom:loaded');
  }

  function checkReadyState() {
    if (document.readyState === 'complete') {
      document.detachEvent('onreadystatechange', checkReadyState);
      fireContentLoadedEvent();
    }
  }

  function pollDoScroll() {
    try {
      document.documentElement.doScroll('left');
    } catch (e) {
      TIMER = pollDoScroll.defer();
      return;
    }

    fireContentLoadedEvent();
  }


  if (document.readyState === 'complete') {
    fireContentLoadedEvent();
    return;
  }

  if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', fireContentLoadedEvent, false);
  } else {
    document.attachEvent('onreadystatechange', checkReadyState);
    if (window == top) TIMER = pollDoScroll.defer();
  }

  Event.observe(window, 'load', fireContentLoadedEvent);
})(this);


Element.addMethods();
/*------------------------------- DEPRECATED -------------------------------*/

Hash.toQueryString = Object.toQueryString;

var Toggle = { display: Element.toggle };

Element.Methods.childOf = Element.Methods.descendantOf;

var Insertion = {
  Before: function(element, content) {
    return Element.insert(element, {before:content});
  },

  Top: function(element, content) {
    return Element.insert(element, {top:content});
  },

  Bottom: function(element, content) {
    return Element.insert(element, {bottom:content});
  },

  After: function(element, content) {
    return Element.insert(element, {after:content});
  }
};

var $continue = new Error('"throw $continue" is deprecated, use "return" instead');

var Position = {
  includeScrollOffsets: false,

  prepare: function() {
    this.deltaX =  window.pageXOffset
                || document.documentElement.scrollLeft
                || document.body.scrollLeft
                || 0;
    this.deltaY =  window.pageYOffset
                || document.documentElement.scrollTop
                || document.body.scrollTop
                || 0;
  },

  within: function(element, x, y) {
    if (this.includeScrollOffsets)
      return this.withinIncludingScrolloffsets(element, x, y);
    this.xcomp = x;
    this.ycomp = y;
    this.offset = Element.cumulativeOffset(element);

    return (y >= this.offset[1] &&
            y <  this.offset[1] + element.offsetHeight &&
            x >= this.offset[0] &&
            x <  this.offset[0] + element.offsetWidth);
  },

  withinIncludingScrolloffsets: function(element, x, y) {
    var offsetcache = Element.cumulativeScrollOffset(element);

    this.xcomp = x + offsetcache[0] - this.deltaX;
    this.ycomp = y + offsetcache[1] - this.deltaY;
    this.offset = Element.cumulativeOffset(element);

    return (this.ycomp >= this.offset[1] &&
            this.ycomp <  this.offset[1] + element.offsetHeight &&
            this.xcomp >= this.offset[0] &&
            this.xcomp <  this.offset[0] + element.offsetWidth);
  },

  overlap: function(mode, element) {
    if (!mode) return 0;
    if (mode == 'vertical')
      return ((this.offset[1] + element.offsetHeight) - this.ycomp) /
        element.offsetHeight;
    if (mode == 'horizontal')
      return ((this.offset[0] + element.offsetWidth) - this.xcomp) /
        element.offsetWidth;
  },


  cumulativeOffset: Element.Methods.cumulativeOffset,

  positionedOffset: Element.Methods.positionedOffset,

  absolutize: function(element) {
    Position.prepare();
    return Element.absolutize(element);
  },

  relativize: function(element) {
    Position.prepare();
    return Element.relativize(element);
  },

  realOffset: Element.Methods.cumulativeScrollOffset,

  offsetParent: Element.Methods.getOffsetParent,

  page: Element.Methods.viewportOffset,

  clone: function(source, target, options) {
    options = options || { };
    return Element.clonePosition(target, source, options);
  }
};

/*--------------------------------------------------------------------------*/

if (!document.getElementsByClassName) document.getElementsByClassName = function(instanceMethods){
  function iter(name) {
    return name.blank() ? null : "[contains(concat(' ', @class, ' '), ' " + name + " ')]";
  }

  instanceMethods.getElementsByClassName = Prototype.BrowserFeatures.XPath ?
  function(element, className) {
    className = className.toString().strip();
    var cond = /\s/.test(className) ? $w(className).map(iter).join('') : iter(className);
    return cond ? document._getElementsByXPath('.//*' + cond, element) : [];
  } : function(element, className) {
    className = className.toString().strip();
    var elements = [], classNames = (/\s/.test(className) ? $w(className) : null);
    if (!classNames && !className) return elements;

    var nodes = $(element).getElementsByTagName('*');
    className = ' ' + className + ' ';

    for (var i = 0, child, cn; child = nodes[i]; i++) {
      if (child.className && (cn = ' ' + child.className + ' ') && (cn.include(className) ||
          (classNames && classNames.all(function(name) {
            return !name.toString().blank() && cn.include(' ' + name + ' ');
          }))))
        elements.push(Element.extend(child));
    }
    return elements;
  };

  return function(className, parentElement) {
    return $(parentElement || document.body).getElementsByClassName(className);
  };
}(Element.Methods);

/*--------------------------------------------------------------------------*/

Element.ClassNames = Class.create();
Element.ClassNames.prototype = {
  initialize: function(element) {
    this.element = $(element);
  },

  _each: function(iterator, context) {
    this.element.className.split(/\s+/).select(function(name) {
      return name.length > 0;
    })._each(iterator, context);
  },

  set: function(className) {
    this.element.className = className;
  },

  add: function(classNameToAdd) {
    if (this.include(classNameToAdd)) return;
    this.set($A(this).concat(classNameToAdd).join(' '));
  },

  remove: function(classNameToRemove) {
    if (!this.include(classNameToRemove)) return;
    this.set($A(this).without(classNameToRemove).join(' '));
  },

  toString: function() {
    return $A(this).join(' ');
  }
};

Object.extend(Element.ClassNames.prototype, Enumerable);

/*--------------------------------------------------------------------------*/

(function() {
  window.Selector = Class.create({
    initialize: function(expression) {
      this.expression = expression.strip();
    },

    findElements: function(rootElement) {
      return Prototype.Selector.select(this.expression, rootElement);
    },

    match: function(element) {
      return Prototype.Selector.match(element, this.expression);
    },

    toString: function() {
      return this.expression;
    },

    inspect: function() {
      return "#<Selector: " + this.expression + ">";
    }
  });

  Object.extend(Selector, {
    matchElements: function(elements, expression) {
      var match = Prototype.Selector.match,
          results = [];

      for (var i = 0, length = elements.length; i < length; i++) {
        var element = elements[i];
        if (match(element, expression)) {
          results.push(Element.extend(element));
        }
      }
      return results;
    },

    findElement: function(elements, expression, index) {
      index = index || 0;
      var matchIndex = 0, element;
      for (var i = 0, length = elements.length; i < length; i++) {
        element = elements[i];
        if (Prototype.Selector.match(element, expression) && index === matchIndex++) {
          return Element.extend(element);
        }
      }
    },

    findChildElements: function(element, expressions) {
      var selector = expressions.toArray().join(', ');
      return Prototype.Selector.select(selector, element || document);
    }
  });
})();

"use strict";
/*	============================================================================
									Gibson Research Corporation
				UHEPRNG - Ultra High Entropy Pseudo-Random Number Generator
	============================================================================
	This is GRC's cryptographically strong PRNG (pseudo-random number generator)
	for JavaScript. It is driven by 1536 bits of entropy, stored in an array of
	48, 32-bit JavaScript variables.  Since many applications of this generator,
	including ours with the "Off The Grid" Latin Square generator, may require
	the deteriministic re-generation of a sequence of PRNs, this PRNG's initial
	entropic state can be read and written as a static whole, and incrementally
	evolved by pouring new source entropy into the generator's internal state.
	----------------------------------------------------------------------------
	ENDLESS THANKS are due Johannes Baagoe for his careful development of highly
	robust JavaScript implementations of JS PRNGs.  This work was based upon his
	JavaScript "Alea" PRNG which is based upon the extremely robust Multiply-
	With-Carry (MWC) PRNG invented by George Marsaglia. MWC Algorithm References:
	http://www.GRC.com/otg/Marsaglia_PRNGs.pdf
	http://www.GRC.com/otg/Marsaglia_MWC_Generators.pdf
	----------------------------------------------------------------------------
	The quality of this algorithm's pseudo-random numbers have been verified by
	multiple independent researchers. It handily passes the fermilab.ch tests as
	well as the "diehard" and "dieharder" test suites.  For individuals wishing
	to further verify the quality of this algorithm's pseudo-random numbers, a
	256-megabyte file of this algorithm's output may be downloaded from GRC.com,
	and a Microsoft Windows scripting host (WSH) version of this algorithm may be
	downloaded and run from the Windows command prompt to generate unique files
	of any size:
	The Fermilab "ENT" tests: http://fourmilab.ch/random/
	The 256-megabyte sample PRN file at GRC: https://www.GRC.com/otg/uheprng.bin
	The Windows scripting host version: https://www.GRC.com/otg/wsh-uheprng.js
	----------------------------------------------------------------------------
	Qualifying MWC multipliers are: 187884, 686118, 898134, 1104375, 1250205,
	1460910 and 1768863. (We use the largest one that's < 2^21)
	============================================================================ */

function uheprng() {
	return (function() {
  		var o = 48;					// set the 'order' number of ENTROPY-holding 32-bit values
		var c = 1;					// init the 'carry' used by the multiply-with-carry (MWC) algorithm
		var p = o;					// init the 'phase' (max-1) of the intermediate variable pointer
		var s = new Array(o);	// declare our intermediate variables array
		var i,j,k=0;				// general purpose locals

		// when our "uheprng" is initially invoked our PRNG state is initialized from the
		// browser's own local PRNG. This is okay since although its generator might not
		// be wonderful, it's useful for establishing large startup entropy for our usage.		
		var mash = Mash();		// get a pointer to our high-performance "Mash" hash
		for (i = 0; i < o; i++) s[i] = mash( Math.random() );	// fill the array with initial mash hash values

		// this PRIVATE (internal access only) function is the heart of the multiply-with-carry
		// (MWC) PRNG algorithm. When called it returns a pseudo-random number in the form of a
		// 32-bit JavaScript fraction (0.0 to <1.0) it is a PRIVATE function used by the default
		// [0-1] return function, and by the random 'string(n)' function which returns 'n'
		// characters from 33 to 126.
		function rawprng() {
			if (++p >= o) p = 0;
			var t = 1768863 * s[p] + c * 2.3283064365386963e-10; // 2^-32
      	return s[p] = t - (c = t | 0);
		};
		
		// this EXPORTED function is the default function returned by this library.
		// The values returned are integers in the range from 0 to range-1. We first
		// obtain two 32-bit fractions (from rawprng) to synthesize a single high
		// resolution 53-bit prng (0 to <1), then we multiply this by the caller's
		// "range" param and take the "floor" to return a equally probable integer.
		var random = function( range ) {
			return Math.floor(range * (rawprng() + (rawprng() * 0x200000 | 0) * 1.1102230246251565e-16)); // 2^-53
		};

		// this EXPORTED function 'string(n)' returns a pseudo-random string of
		// 'n' printable characters ranging from chr(33) to chr(126) inclusive.
		random.string = function( count ) {
			var i, s='';
			for ( i=0; i<count; i++ ) s += String.fromCharCode( 33+random(94) );
			return s;
		};

		// this PRIVATE "hash" function is used to evolve the generator's internal
		// entropy state. It is also called by the EXPORTED addEntropy() function
		// which is used to pour entropy into the PRNG.
		function hash() {
			var args = Array.prototype.slice.call(arguments)
			for (i = 0; i < args.length; i++) {
				for (j = 0; j < o; j++) {
					s[j] -= mash(args[i]);
					if (s[j] < 0) s[j] += 1;
				}
			}
		};

		// this EXPORTED "clean string" function removes leading and trailing spaces and non-printing
		// control characters, including any embedded carriage-return (CR) and line-feed (LF) characters,
		// from any string it is handed. this is also used by the 'hashstring' function (below) to help
		// users always obtain the same EFFECTIVE uheprng seeding key.
		random.cleanString = function( inStr ) {
			inStr = inStr.replace(/(^\s*)|(\s*$)/gi,""); // remove any/all leading spaces
			inStr = inStr.replace(/[\x00-\x1F]/gi,"");	// remove any/all control characters
			inStr = inStr.replace(/\n /,"\n");				// remove any/all trailing spaces
			return inStr;											// return the cleaned up result
		}
		
		// this EXPORTED "hash string" function hashes the provided character string after first removing
		// any leading or trailing spaces and ignoring any embedded carriage returns (CR) or Line Feeds (LF)
		random.hashString = function( inStr ) {
			inStr = random.cleanString( inStr );
			mash( inStr );											// use the string to evolve the 'mash' state
			for ( i = 0; i < inStr.length; i++) {			// scan through the characters in our string
				k = inStr.charCodeAt( i );						// get the character code at the location
				for (j = 0; j < o; j++) {						//	"mash" it into the UHEPRNG state
					s[j] -= mash( k );
					if (s[j] < 0) s[j] += 1;
				}
			}
		};
				
		// this handy exported function is used to add entropy to our uheprng at any time
		random.addEntropy = function( /* accept zero or more arguments */ ) {
			var args = [];
			for ( i = 0; i < arguments.length; i++ ) args.push( arguments[i] );
			hash( (k++) + (new Date().getTime()) + args.join('') + Math.random() );
		};
		
		// if we want to provide a deterministic startup context for our PRNG,
		// but without directly setting the internal state variables, this allows
		// us to initialize the mash hash and PRNG's internal state before providing
		// some hashing input
		random.initState = function() {
			mash();													// pass a null arg to force mash hash to init
			for (i = 0; i < o; i++) s[i] = mash( ' ' );	// fill the array with initial mash hash values
			c = 1;													// init our multiply-with-carry carry
			p = o;													// init our phase
		};
		
		// we use this (optional) exported function to signal the JavaScript interpreter
		// that we're finished using the "Mash" hash function so that it can free up the
		// local "instance variables" is will have been maintaining.  It's not strictly
		// necessary, of course, but it's good JavaScript citizenship.
		random.done = function() {
			mash = null;
		};

		// when our main outer "uheprng" function is called, after setting up our
		// initial variables and entropic state, we return an "instance pointer"
		// to the internal anonymous function which can then be used to access
		// the uheprng's various exported functions.  As with the ".done" function
		// above, we should set the returned value to 'null' once we're finished
		// using any of these functions.
		return random;
  } ());
};

/*	============================================================================
	This is based upon Johannes Baagoe's carefully designed and efficient hash
	function for use with JavaScript.  It has a proven "avalanche" effect such
	that every bit of the input affects every bit of the output 50% of the time,
	which is good.	See: http://baagoe.com/en/RandomMusings/hash/avalanche.xhtml
	============================================================================
*/
function Mash() {
	var n = 0xefc8249d;
	var mash = function(data) {
		if ( data ) {
			data = data.toString();
			for (var i = 0; i < data.length; i++) {
				n += data.charCodeAt(i);
				var h = 0.02519603282416938 * n;
				n = h >>> 0;
				h -= n;
				h *= n;
				n = h >>> 0;
				h -= n;
				n += h * 0x100000000; // 2^32
			}
			return (n >>> 0) * 2.3283064365386963e-10; // 2^-32
		} else n = 0xefc8249d;
	};
  return mash;
}

/*
 * osweb 
 *  
 * An experiment research tool written in Javascript and HTML to be used in 
 * Qualtrics or other web-based tools. Based upon OpenSesame.         
 *
 * Author: drs. J. Bos
 *
 * Copyright (c) University of Groningen 
 * Faculty of Behavioural and Social Sciences
 * Technical Support Service 
 *
 */

// Use strict mode.     
"use strict";

// Set osweb namespace.
this.osweb = this.osweb||{};

// Definition of osweb version constants. 
osweb.VERSION_NAME   = 'osweb';
osweb.VERSION_NUMBER = '0.041 (19-07-2016)';

// Definition of osweb class utility methods.
osweb.extendClass = function(sub_class, super_class) {
    function o() { 
        this.constructor = sub_class; 
    }
    o.prototype = super_class.prototype;
    return (sub_class.prototype = new o());
}; 

osweb.isClass = function(class_name) {
    // Return true if the classname is defined within the osweb namespace.
    return (this[class_name] !== undefined);
};

osweb.newItemClass = function(type, experiment, name, string) {
    // Create the element.
    var element = new this[type](experiment, name, string);
   
    // Set the type of the item.
    element.type = type;
    
    // Return the element
    return element;
};

osweb.newElementClass = function(type, sketchpad, string) {
    // Create the element.
    var element = new this[type](sketchpad, string);
    
    // Return the element
    return element;
};

osweb.newWidgetClass = function(type, form, variables) {
    // Create the element.
    var widget = new this[type](form, variables);
   	
    // Return the element
    return widget;
}; 

osweb.promoteClass = function(sub_class, prefix) {
    var subP = sub_class.prototype, supP = (Object.getPrototypeOf&&Object.getPrototypeOf(subP))||subP.__proto__;
    if (supP) {
    	subP[(prefix+="_") + "constructor"] = supP.constructor; 
    	for (var n in supP) {
            if (subP.hasOwnProperty(n) && (typeof supP[n] === "function")) {
                subP[prefix + n] = supP[n]; 
            }
	}
    }
    return sub_class;
}; 


(function() {
    // Definition of the class constants.
    function constants() {
    	throw 'The class constants cannot be instantiated!';
    }

    // Definition of error constants. 
    constants.ERROR_001 = 'osweb has stopped running due a fatal error.';
    constants.ERROR_002 = 'No content parameter specified.';
    constants.ERROR_003 = 'No context parameter specified.';
    constants.ERROR_004 = 'Invalid scriptID or scriptURL for retrieving script from external location.';
    constants.ERROR_005 = 'Failure to retrieve script from external location (Ajax call error).';
    constants.ERROR_006 = 'Failure to retrieve script from external location (database response error)';
    constants.ERROR_007 = 'Failure to retrieve script from external location (database retrieve error).';
    constants.ERROR_008 = 'Invalid script definition, parsing error.';
    constants.ERROR_009 = 'Unknown class definition within osweb script - ';

    // Definition of message constants. 
    constants.MESSAGE_001 = 'Os';
    constants.MESSAGE_002 = 'web - version ';
    constants.MESSAGE_003 = 'Start up osweb experiment session.';
    constants.MESSAGE_004 = 'Retrieving stimuli files.';
    constants.MESSAGE_005 = 'Retrieving input parameters.';
    constants.MESSAGE_006 = 'Press with the mouse on this screen to continue.';
    constants.MESSAGE_007 = 'Warning: this method is not implemented in the current version of OsWeb - ';
    constants.MESSAGE_008 = 'Retrieving session information.';

    // Definition of general constants. 
    constants.STATUS_NONE = 0;                   // Running status of an item.   
    constants.STATUS_BUILD = 1;
    constants.STATUS_INITIALIZE = 2;
    constants.STATUS_EXECUTE = 3;
    constants.STATUS_FINALIZE = 4;
    constants.PARSER_NONE = 0;                   // Running status of the parser.
    constants.PARSER_EXECUTE = 1;
    constants.STATUS_PENDING = 2;
    constants.STATUS_DONE = 3;
    constants.PRESSES_ONLY = 1;                  // Type of used collection mode.           
    constants.RELEASES_ONLY = 2;
    constants.PRESSES_AND_RELEASES = 3;
    constants.RESPONSE_NONE = 0;                 // Type of response used.
    constants.RESPONSE_DURATION = 1;
    constants.RESPONSE_KEYBOARD = 2;
    constants.RESPONSE_MOUSE = 3;
    constants.RESPONSE_SOUND = 4;
    constants.RESPONSE_AUTOKEYBOARD = 5;
    constants.RESPONSE_AUTOMOUSE = 6;
    constants.UPDATE_NONE = 0;                  // Item update status flag.
    constants.UPDATE_ONSET = 1;
    constants.UPDATE_OFFSET = 2;
    constants.SEQUENTIAL = 0;                   // Loop randomization type.
    constants.RANDOM = 1;
    constants.RANDOMREPLACEMENT = 2;

    // Bind the constants class to the osweb namespace.
    osweb.constants = constants;
}()); 


(function() {
// Definition of the class canvas.
    function canvas(experiment, auto_prepare) {
	// set the class public properties.
        this.auto_prepare = (typeof auto_prepare === 'undefined') ? true : auto_prepare;              // Set autoprepare toggle (not supported yet). 	
        this.experiment = (typeof experiment === 'undefined') ? osweb.runner.experiment : experiment; // Anchor to the experiment object.
		
        // Set the public properties. 
    	this.background_color = this.experiment.vars.background;                         // Backgropund color of canvas.     
        this.bidi = (this.experiment.vars.bidi === 'yes');                               // If true bidi mode is enabled.
        this.color = this.experiment.vars.foregound;                                     // Foreground color of canvas.
        this.fill = false;                                                               // If true fill mode is used.
        this.font_bold = (this.experiment.vars.font_bold === 'yes');                     // If true font style bold is enabled.
        this.font_family = (this.experiment.vars.font_family);                           // Family name of the font used.
        this.font_italic = (this.experiment.vars.font_italic === 'yes');                 // If true font style italic is enabled.
        this.font_size = (this.experiment.vars.font_size);                               // Size of the font in pixels.
        this.font_underline = (this.experiment.vars.font_underline === 'yes');           // If true font style underline is enabled.
        this.html = true;                                                                // If true html is used (not supported yet).
        this.penwidth = 1;                                                               // Default penwidth for drawing shapes. 
        
        // Set the private properties.  
    	this._container = new createjs.Container();                                      // EASELJS: Container which holds the shapes
        this._font_string = 'bold 18px Courier New';                                     // EASELJS: Default font definition string.
	this._height = osweb.runner._canvas.height;                                      // Height of the HTML canvas used for drawing.
	this._width = osweb.runner._canvas.width;                                        // Width of the HTML canvas used for drawing.
    }; 
	
    // Extend the class from its base class.
    var p = canvas.prototype;
    
    // Definition of public properties. 
    p.auto_prepare= false;
    p.experiment = null;
    p.uniform_coordinates = false;
	
    // Definition of private methods. 
    
    p._arrow_shape = function(sx, sy, ex, ey, body_length, body_width, head_width) {
        // Length
        var d = Math.sqrt(Math.pow(ey - sy,2) + Math.pow(sx - ex,2));
        var angle = Math.atan2(ey - sy, ex - sx);
	var _head_width = (1 - body_width) / 2.0;
	body_width = body_width / 2.0;
	
        // calculate coordinates
	var p4 = [ex, ey];
	var p1 = [sx + body_width * head_width * Math.cos(angle - Math.PI / 2), sy + body_width * head_width * Math.sin(angle - Math.PI / 2)];
	var p2 = [p1[0] + body_length * Math.cos(angle) * d, p1[1] + body_length * Math.sin(angle) * d];
	var p3 = [p2[0] + _head_width * head_width * Math.cos(angle - Math.PI / 2), p2[1] + _head_width * head_width * Math.sin(angle - Math.PI / 2)];
	var p7 = [sx + body_width * head_width * Math.cos(angle + Math.PI / 2), sy + body_width * head_width * Math.sin(angle + Math.PI / 2)];
	var p6 = [p7[0] + body_length * Math.cos(angle) * d, p7[1] + body_length * Math.sin(angle) * d];
	var p5 = [p6[0] + _head_width * head_width * Math.cos(angle + Math.PI / 2), p6[1] + _head_width * head_width * Math.sin(angle + Math.PI / 2)];
	
        return [p1, p2, p3, p4, p5, p6, p7];
    };    
        
    // Definition of public methods. 
    
    p.arrow = function (sx, sy, ex, ey, color, penwidth, body_length, body_width, head_width, fill) {
        var points = this._arrow_shape(sx, sy, ex, ey, body_width, body_length, head_width);
    	var shape = new createjs.Shape();
	shape.graphics.setStrokeStyle(penwidth);
	shape.graphics.beginStroke(color);
        
        shape.graphics.moveTo(points[0][0],points[0][1]);
	shape.graphics.lineTo(points[1][0],points[1][1]);
	shape.graphics.lineTo(points[2][0],points[2][1]);
	shape.graphics.lineTo(points[3][0],points[3][1]);
	shape.graphics.lineTo(points[4][0],points[4][1]);
	shape.graphics.lineTo(points[5][0],points[5][1]);
	shape.graphics.lineTo(points[6][0],points[6][1]);
	shape.graphics.lineTo(points[0][0],points[0][1]);
	
       	// Add the line item to container.
	this._container.addChild(shape); 
    }; 
    		
    p.circle = function(x, y, r, fill, color, penwidth) {
	var shape = new createjs.Shape();
	shape.graphics.setStrokeStyle(penwidth);
	shape.graphics.beginStroke(color);
	if (fill == 1)
	{
            shape.graphics.beginFill(color);
	}
	shape.graphics.drawCircle(x, y, r);
		
	// Add the line item to container.
	this._container.addChild(shape); 
    };

    p.clear = function(backround_color) {
	// Remove the container from the stage object.
	osweb.runner._stage.removeChild(this._container);
	
        // Remove the children from the container.
        this._container.removeAllChildren();
    };

    p.close_display = function(experiment) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas.close_display().');
    };

    p.copy = function(canvas) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas.copy().');
    };

    p.ellipse = function(x, y, w, h, fill, color, penwidth) {
	var shape = new createjs.Shape();
	shape.graphics.setStrokeStyle(penwidth);
	shape.graphics.beginStroke(color);
	if (fill == 1)
	{
            shape.graphics.beginFill(color);
	}
	shape.graphics.drawEllipse(x, y, w, h); 

	// Add the text item to the parten frame.
	this._container.addChild(shape);
    };

    p.fixdot = function(x, y, color, style) {
        // Check the color and style arguments.      
        color = (typeof color === 'undefined') ? 'white' : color;
        style = (typeof style === 'undefined') ? 'default' : style;
        
        if (typeof x === 'undefined') {
            if (this.uniform_coordinates === true) {
		x = 0;
            }
            else {
                x = this._width / 2;
            }
	}
	if (typeof y === 'undefined') {
            if (this.uniform_coordinates === true) {
		y = 0;
            }
            else {
		y = this._height / 2;
            }	
	}
		
	var s = 4;
	var h = 2;
	if (style.indexOf('large') !== -1) {
            s = 16;
	}
	else if ((style.indexOf('medium') !== -1) || (style === 'default')) {
            s = 8;
	}
	else if (style.indexOf('small') !== -1) {
            s = 4;
	}
	else {
            osweb.debug.addError('Unknown style: ' + style);
	}	
		
	if ((style.indexOf('open') !== -1) || (style === 'default')) {	
            this.ellipse(x - s, y - s, 2 * s, 2 * s, 1, color, 1);
            this.ellipse(x - h, y - h, 2 * h, 2 * h, 1, 'black', 1);
	}
	else if (style.indexOf('filled') !== -1)	{	
            this.ellipse(x - s, y - s, 2 * s, 2 * s, 1, color, 1);
	}
        else if (style.indexOf('cross') !== -1)	{
            this.line(x, y - s, x, y + s);
            this.line(x - s, y, x + s, y);
	}
	else {
            osweb.debug.addError('Unknown style: ' + style);
	}	
    };

    p.gabor = function(x, y, orient, freq, env, size, stdev, phase, color1, color2, bgmode) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas.gabor().');
    };

    p.height = function() {
    	return this._heigth();
    };

    p.image = function(fname, center, x, y, scale) {
	// Set the class private properties. 
	var image = new createjs.Bitmap();
    image.image = fname.data;
	image.scaleX = scale;
        image.scaleY = scale;
        image.snapToPixel = true;
        image.x = x - ((image.image.width  * scale) / 2);
    	image.y = y - ((image.image.height * scale) / 2);
	
	// Add the text item to the parten frame.
	this._container.addChild(image);
    };
	
    p.init_display = function(experiment) {
	// Set the dimension properties.
	this._height = experiment.vars.height;
    	this._width  = experiment.vars.width;
	
	// Initialize the display dimensions.
	osweb.runner._canvas.height = experiment.vars.height;
	osweb.runner._canvas.width  = experiment.vars.width;
		
	// Initialize the display color.
	osweb.runner._canvas.style.background = experiment.vars.background;

        // Set the cursor visibility to none (default).
        osweb.runner._canvas.style.cursor = 'none';

        // Set focus to the experiment canvas.
        osweb.runner._canvas.focus(); 
    };

    p.line = function(sx, sy, ex, ey, color, penwidth) {
    	var shape = new createjs.Shape();
	shape.graphics.setStrokeStyle(penwidth);
	shape.graphics.beginStroke(color);
	shape.graphics.moveTo(sx, sy);
	shape.graphics.lineTo(ex, ey); 

	// Add the line item to container..
	this._container.addChild(shape); 
    };
	
    p.noise_patch = function(pX, pY, pEnv, pSize, pStdev, pColor1, pColor2, pBgmode) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas.noise_patch().');
    };
	
    p.polygon = function(verticles) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas.polygon().');
    };
	
    p.prepare = function() {
    };
	
    p.rect = function(x, y, w, h, fill, color, penwidth) {
    	var shape = new createjs.Shape();
	shape.graphics.setStrokeStyle(penwidth);
	shape.graphics.beginStroke(color);
	if (fill == 1)
	{
            shape.graphics.beginFill(color);
	}
	shape.graphics.rect(x, y, w, h); 

	// Add the line item to container..
	this._container.addChild(shape); 
    };
	
    p.set_font = function(family, size, italic, bold, underline) {
   	// Define the the font styles.
    	var font_bold = (bold === true) ? 'bold ' : '';
        var font_italic = (italic === true) ? 'italic ' : '';
        var font_underline = (underline === true) ? 'underline ' : '';
        
        // Set the font string.
        this._font_string = font_bold + font_italic + font_underline + size + 'px ' + family; 
     };
        
    p.show = function() {
    	// Add the container to the stage object and update the stage.
	osweb.runner._stage.addChild(this._container);
	osweb.runner._stage.update(); 

	// Return the current time.
	if (this.experiment != null) {
            return this.experiment.clock.time();
        }    
        else {    
            return null;
        }
    };
	
    p.size = function() {
    	// Create object tuple.
    	var size = {width: this._width, height: this._height};
	return size;
    };
	
    p.text = function(text, center, x, y , color, html) {
	// Create the text element.          
	var text_element = new createjs.Text(text, this._font_string, color);

	// Set the text element properties.
	text_element.x = x - (text_element.getMeasuredWidth() / 2);
	text_element.y = y - (text_element.getMeasuredHeight() / 2);
		 
	// Add the text item to the parten frame.
	this._container.addChild(text_element);
    };

    p.text_size = function(text, max_width, style_args) {
        // Return the text size in pixels.
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas.text_size().');
    };

    // Bind the canvas class to the osweb namespace.
    osweb.canvas = canvas;
}());



(function() {
    // Definition of the class clock.
    function clock(experiment) {
        // Definition of private properties. 
        this._startTime = this._now();                     // Start time anchor of the experiment.
		
        // Set the class public properties. 
	this.experiment = experiment;                      // Anchor to the experiment object.
    }; 
	
    // Extend the class from its base class.
    var p = clock.prototype;
    
    // Definition of public properties. 
    p.experiment = null;

    // Definition of private methods.   
    
    p._now = function() {
	// Get the current time stamp using the best available timing method.
	if (window.performance.now) {
            return Math.round(window.performance.now());
	} 
	else if (window.performance.webkitNow) {
            return Math.round(window.performance.webkitNow());
	} 
	else {
            return new Date().getTime();
	}
    };

    // Definition of public methods.   

    p.initialize = function() {
        // Set the absolute start time of the expeirment.
        this._startTime = this._now();
    };

    p.sleep = function(duration) {
        // Sleeps (pauses) for a duration (in milliseconds).
	if (this.experiment !==  null) {
            // Set the event processor.
            osweb.events._run(this, duration, osweb.constants.RESPONSE_DURATION, null);
	}
    };
	
    p.time = function() {
        // Gives the current timestamp in milliseconds. 
        if (this._startTime !== -1) {
            return (this._now() - this._startTime);
        }    
        else {
            return 0;
        }    
    };
 	
    // Bind the clock class to the osweb namespace.
    osweb.clock = clock;
}());



(function() {
    // Definition of the class keyboard.
    function keyboard(experiment, timeout, keylist) {
        // Set the public properties. 
	this.experiment = experiment;                                          // Anchor to the experiment object. 
	this.keylist = (typeof keylist === 'undefined') ? [] : keylist;	       // List of acceptable response keys. 
	this.timeout = (typeof timeout === 'undefined') ? null : timeout;      // Duration in millisecond for time-out.
    }; 
	
    // Extend the class from its base class.
    var p = keyboard.prototype;
    
    // Definition of public properties. 
    p.experiment = null;
    p.keylist = [];
    p.timeout = null;
	
    // Definition of the synoniem map for all keys.                                  
    p.SYNONIEM_MAP = [[' ','space','SPACE'],['"','quotedbl','QUOTEDBL'],['!','exclaim','EXCLAIM'],['#','hash','HASH'],
        ['$','dollar','DOLLAR'],['&','ampersand','AMPERSAND'],["'",'quote','QUOTE'],['(','leftbracket','leftparen','LEFTBRACKET','LEFTPAREN'],
        [')','rightbracket','rightparen','RIGHTBRACKET','RIGHTPAREN'],['*','asteriks','ASTERISK'],['+','plus','PLUS'],[',','comma','COMMA'],
        ['-','minus','MINUS'],['.','period','PERIOD'],['/','slash','SLASH'],
        ['1'],['2'],['3'],['4'],['5'],['6'],['7'],['8'],['9'],['0'],['=','equals','EQUALS'],
        [':','colon','COLON'],[';','semicolon','SEMICOLON'],['<','less','LESS'],['>','greater','GREATER'],
        ['?','question','QUESTION'],['@','at','AT'],
        ['a','A'],['b','B'],['c','C'],['d','D'],['e','E'],['f','F'],
        ['g','G'],['h','H'],['i','I'],['j','J'],['k','K'],['l','L'],
        ['m','M'],['n','N'],['o','O'],['p','P'],['q','Q'],['r','R'],
        ['s','S'],['t','T'],['u','U'],['v','V'],['w','W'],['x','X'],
        ['y','Y'],['z','Z'],
        ['kp0','KP0'],['kp1','KP1'],['kp2','KP2'],['kp3','KP3'],['kp4','KP4'],['kp5','KP5'],['kp6','KP6'],['kp7','KP7'],['kp8','KP8'],['kp9','KP9'],  
        ['kp_divide','KP_DIVIDE'],['kp_enter','KP_ENTER'],['kp_equals','KP_EQUALS'],['kp_minus','KP_MINUS'],['kp_multiply','KP_MULTIPLY'],['kp_period','KP_PERIOD'],['kp_plus','KP_PLUS'],
        ['\\','backslash','BACKSLASH'],['^','power','caret','POWER','CARET'],['_','underscore','UNDERSCORE'],['`','backquote','BACKQUOTE'],
        ['f1','F1','help','HELP'],['f2','F2'],['f3','F3'],['f4','F4'],['f5','F5'],['f6','F6'],
        ['f7','F7'],['f8','F8'],['f9','F9'],['f10','F10'],['f11','F11'],['f12','F12'],
        ['f13','F13'],['f14','F14'],['f15','F15'],
        ['up','UP'],['down','DOWN'],['left','LEFT'],['right','RIGHT'],['menu','MENU'],
        ['lshift','left shift','LSHIFT','LEFT SHIFT'],['lctrl','left ctrl','LCTRL','LEFT CTRL'],['lalt','left alt','LALT','LEFT ALT'],
        ['rshift','right shift','RSHIFT','RIGHT SHIFT'],['rctrl','right ctrl','RCTRL','RIGHT CTRL'],['ralt','right alt','alt gr','RALT','RIGHT ALT','ALT GR'],
        ['page up','pageup','PAGE UP','PAGEUP'],['page down','pagedown','PAGE DOWN','PAGEDOWN'],['pause','PAUSE'],
        ['scroll lock','scrollock','SCROLL LOCK','SCROLLOCK'],['caps lock','capslock','CAPS LOCK','CAPSLOCK'],['nummlock','NUMMLOCK'],
        ['clear','CLEAR'],['enter','ENTER','return','RETURN'],['tab','TAB'],['backspace','BACKSPACE'],['end','END'],['home','HOME'],['insert','INSERT'],['delete','DELETE'],
        ['sysreq','sys req','SYSREQ','SYS REQ'],['break','BREAK'],['escape','ESCAPE'],['print','PRINT'],['print screen','PRINT SCREEN'],
        ['lmeta','left meta','LMETA','LEFT META',,'lsuper','LSUPER','left super','LEFT SUPER'],                  
        ['rmeta','right meta','RMETA','RIGHT META','rsuper','right super','RSUPER','RIGHT SUPER'],                  
        // key defined below are not supported yet.
        ['euro','EURO'],['first','FIRST'],['last','LAST'],['kp enter','KP ENTER'],['kp equals','KP EQUALS'],
        ['mode','MODE'],['unknown','UNKNOWN'],['unknown key','UNKNOWN KEY']];  

    // Definition of private methods.

    p._get_default_from_synoniem = function(responses) {
        var defaults = [];
        for (var i = 0;i < responses.length; i++) {
            var synoniem = this.synonyms(responses[i]);
            defaults.push(synoniem[0]);
        }
        return defaults;    
    };
    
    // Definition of public methods.

    p.default_config = function() {
        // Return the default configuration.
	return {'timeout': null, 'keylist': []};
    };
    
    p.flush = function() {
	// Clear all pending keyboard input, not limited to the keyboard.
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'keyboard.flush().');
    };
 	
    p.get_key = function(timeout, keylist) {
	// Collects a single key press.
	this.keylist = (typeof keylist === 'undefined') ? this.keylist : keylist;	
	this.timeout = (typeof timeout === 'undefined') ? this.timeout : timeout;
		
	if (this.experiment != null) {
            // Set the event processor.
            osweb.events._run(this, this.timeout, osweb.constants.RESPONSE_KEYBOARD, this.keylist);
	};
    };

    p.get_mods = function() {
    	var moderators = [];
        if (osweb.events._keyboard_event !== null) {
            if (osweb.events._keyboard_event.shiftKey === true) {
                moderators.push('shift');
            };    
            if (osweb.events._keyboard_event.ctrlKey === true) {
                moderators.push('ctrl');
            };    
            if (osweb.events._keyboard_event.altKey === true) {
                moderators.push('alt');
            };    
        } 
        return moderators;    
    };

    p.set_config = function(timeout, keylist) {
	// Set the properties.
	this.keylist = keylist;	
	this.timeout = timeout;
    };
	
    p.show_virtual_keyboard = function(visible) {
        // Shows or hides a virtual keyboard.		
    	if (visible === true) {
            // Hack to show the virutal keyboard. ## Must be tested!
            osweb.runner._canvas.setfocus();
	}
	else {
            // Hack to hide the virtual keyboard. ## Must be tested!
            var tmp = document.createElement("input");
            document.body.appendChild(tmp);
            tmp.focus();
            document.body.removeChild(tmp);
	}
    };

    p.synonyms = function(button) {
        if (typeof button !== 'undefined') {
            for (var i = 0;i < this.SYNONIEM_MAP.length;i++) {
                for (var j = 0;j < this.SYNONIEM_MAP[i].length; j++) {
                    if (this.SYNONIEM_MAP[i][j] == button) {
                        return this.SYNONIEM_MAP[i];
                        break;
                    }
                }   
            }
        }
        else {
            return null;
        }    
    };

    // Bind the keyboard class to the osweb namespace.
    osweb.keyboard = keyboard;
}());


(function() {
    // Definition of the class log.
    function log(experiment, path) {
        // Set the class private properties. 
    	this._all_vars = null;                             // If true all variables are written to the log.  
	this._header_written = false;	                   // If true the header has been written to the log.
	this._log = [];                                    // Array containing the log entries.
	this._path = '';                                   // Path to wich the log is written.

        // Set the class public properties. 
	this.experiment = experiment;                      // Anchor to the experiment object.
    	this.experiment.vars.logfile = path;               // Store the path location into the vars list.   
    }; 
	
    // Extend the class from its base class.
    var p = log.prototype;
    
    // Definition of public properties. 
    p.experiment = null;
	
    // Definition of public methods.   

    p.all_vars = function() {
	// Retrieves a list of all variables that exist in the experiment.
	if (this._all_vars === null) {
            this._all_vars = this.experiment.vars.inspect();
	}
	return this._all_vars;
    };

    p.close = function() {
	// Closes the current log.
	if (this._log.length > 0) {
            // Echo the data to the runner.
            osweb.runner.data = this._log.join('');    
        };

	// Clear the log file.
	this._log = [];
    };

    p.flush = function() {
    	// Flush the log file.
        this._log = [];
    };

    p.open = function(path) {	
	// Opens the current log. If a log was already open, it is closed.
	this._header_written = false;
	this._path = path; 
	
	// Check for old data.
	if (this._log !== null) {
            // Clear the old data.
            this.close();
	}
    };

    p.write = function(msg, new_line) {
    	// Write one message to the log.
	new_line = (typeof new_line === 'undefined') ? true : new_line;
	
	// Write a new line.
	if (new_line === true) {
            this._log.push(msg + '\n');
	}
	else {
            // Write the Message line.
            this._log.push(msg);
	}
    };

    p.write_vars = function(var_list) {
    	// Writes variables to the log.
	var_list = (typeof var_list === 'undefined') ? null : var_list;
		
	var value; 
	var l = [];
        // If no var list defines, retrieve all variable.
	if (var_list == null) {
            var_list = this.all_vars();
	}

        // Sort the var list.
        var_list.sort();
        
	// Add the header to the log file.
        if (this._header_written === false) {
            for (var i = 0; i < var_list.length; i++) {
		l.push('"' + var_list[i] + '"');
            }		
            this.write(l.join());
            this._header_written = true;
	}
		
        // Add the data entries to the log file.        
        l = [];
	for (var i = 0; i < var_list.length; i++) {
            value = this.experiment.vars.get(var_list[i], 'NA', false);
            l.push('"' + value + '"');
	}
        this.write(l.join());
    };
 	
    // Bind the log class to the osweb namespace.
    osweb.log = log;
}());


(function() {
    // Definition of the class mouse.
    function mouse(experiment, timeout, buttonlist, visible)
    {
        // Set the class public properties. 
	this.experiment = experiment;                                               // Anchor to the experiment object.
	this.timeout = (typeof timeout === 'undefined') ? null : timeout;           // Duration in millisecond for time-out. 
	this.buttonlist = (typeof buttonlist === 'undefined') ? null : buttonlist;  // List of acceptable response buttons.	
	this.visible = (typeof visible === 'undefined') ? false : visible;	    // if true the mouse cursor is visible.
    }; 
	
    // Extend the class from its base class.
    var p = mouse.prototype;
    
    // Definition of public properties. 
    p.experiment = null;
    p.buttonlist = [];
    p.timeout = -1;
    p.visible = false;
	
    // Definition of the synoniem map for all keys.                                  
    p.SYNONIEM_MAP = [['1','left_button'], ['2','middle_button'], ['3','right_button'], ['4','scroll_up'], ['5','scroll_down']];
        
    // Definition of private methods.

    p._get_default_from_synoniem = function(responses) {
        // Return the default synoniem value from a response.
        var defaults = [];
        for (var i = 0;i < responses.length;i++) {
            var synoniem = this.synonyms(responses[i]);
            defaults.push(synoniem[0]);
        }
        return defaults;    
    };

    // Definition of class public methods.
    
    p.default_config = function() {
        // Return the default configuration.
        return {'timeout': null, 'buttonlist': null, 'visible': false};
    };

    p.flush = function() {
	// Clears all pending mouse input, not limited to the mouse.
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'mouse.flush().');
    };
 	
    p.get_click = function(timeout, buttonlist, visible) {
	// Collects a single mouse click.
	this.timeout = (typeof timeout === 'undefined') ? this.timeout : timeout;
	this.buttonlist = (typeof buttonlist === 'undefined') ? this.buttonlist : buttonlist;	
	this.visible = (typeof visible === 'undefined') ? this.visible : visible;	

	if (this.experiment != null) {
            // Hide or show the mouse.
            this.show_cursor(this.visible);
	
            // Set the event processor.
            osweb.events._run(this, this.timeout, osweb.constants.RESPONSE_MOUSE, this.buttonlist);
	};
    };

    p.get_pos = function() {
    	// Returns the current mouse position. !Warning: this methods uses the state in the last known mouse respone, not the current state.
        if (osweb.events._mouse_move !== null) {
            return {'rtTime': osweb.events._mouse_move.rtTime, 'x': osweb.events._mouse_move.event.clientX, 'y': osweb.events._mouse_move.event.clientY};
        }
        else {
            return {'rtTime': -1, 'x': -1, 'y': -1};
        }    
    };

    p.get_pressed = function() {
        // Returns the current button state of the mouse buttons. !Warning: this methods uses the state in the last known mouse respone, not the current state.
        if (osweb.events._mouse_press !== null) {
            return { 'buttons': [(osweb.events._mouse_press.button === 0), (osweb.events._mouse_press.button === 1), (osweb.events._mouse_press.button === 2)]};
        }
        else {
            return { 'buttons': [null, null, null]};
        }    
    };

    p.set_config = function(timeout, buttonlist, visible) {
	// Set mouse properties.          
	this.timeout = timeout;
	this.buttonlist = buttonlist;	
	this.visible = visible;	
    };

    p.set_pos = function(pos) {
    	// Returns the current position of the cursor.	
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'mouse.set_pos().');
    };

    p.show_cursor = function(visible) {
    	// Set the property
	this.visible = visible;
		
	// Immediately changes the visibility of the mouse cursor.	
	if (visible === true) {
            // Show the mouse cursor.
            osweb.runner._stage.canvas.style.cursor = "default";
	}
	else {
            // Set the cursor visibility to none.
            osweb.runner._stage.canvas.style.cursor = "none";
        }
    };

    p.synonyms = function(button)
    {
        if (typeof button !== 'undefined') {
            for (var i = 0;i < this.SYNONIEM_MAP.length;i++) {
                for (var j = 0;j < this.SYNONIEM_MAP[i].length;j++) {
                    if (this.SYNONIEM_MAP[i][j] == button) {
                        return this.SYNONIEM_MAP[i];
                        break;
                    }
                }   
            }
        }
        else {
            return null;
        }    
    };

    // Bind the mouse class to the osweb namespace.
    osweb.mouse = mouse;
}()); 



(function() {
    // Definition of the class sampler.
    function sampler(experiment, src, volume, pitch, pan, duration, fade, block) {
      	// Set the class public properties. 
	this.experiment = experiment;
	
	// Check if optional parameters are defined.
	this.block = (typeof block === 'undefined') ? false : block;	
	this.duration = (typeof duration === 'undefined') ? 'sound' : duration;	
	this.fade = (typeof fade === 'undefined') ? 0 : fade;	
	this.pan = (typeof pan === 'undefined') ? 0 : pan;	
	this.pitch = (typeof pitch === 'undefined') ? 1 : pitch;	
	this.src = (typeof src === 'undefined') ? '' : src;	
	this.volume = (typeof volume   === 'undefined') ? 1 : volume;	

	// Create the sound instance
	if (src !== null) {
            // Set the sound object.
            this._instance = src.data;
		
            // Set the event anchor for 
            this._instance.on("ended", osweb.events._audioEnded.bind(this));
    	}
    }; 
	
    // Extend the class from its base class.
    var p = sampler.prototype;
    
    // Definition of public properties. 
    p.duration = 'sound';	
    p.block = false;
    p.fade = '0';
    p.pan = '0';
    p.pitch = '1';
    p.src = null;
    p.volume = 1;
    
    // Definition of public methods.

    p.play = function(volume, pitch, pan, duration, fade, block) {
	// Check if optional parameters are defined.
	this.block = (typeof block === 'undefined') ? this.block : block;	
	this.duration = (typeof duration === 'undefined') ? this.duration : duration;	
	this.fade = (typeof fade === 'undefined') ? this.fade : fade;	
	this.pan = (typeof pan === 'undefined') ? this.pan : pan;	
	this.pitch = (typeof pitch === 'undefined') ? this.pitch : pitch;	
	this.volume = (typeof volume === 'undefined') ? this.volume : volume;	

	// Set the sound properties.
	this._instance.volume = this.volume;
		
	// Play the actual sound.
	this._instance.play();	
    };

    p.wait = function() {
        // Set the blocking of the sound.
        osweb.events._run(this, -1, osweb.constants.RESPONSE_SOUND,[]);
    };
    
    // Bind the sampler class to the osweb namespace.
    osweb.sampler_backend = sampler;
}());



(function() {
    // Definition of the class video.
    function video(experiment, src) {
      	// Set the class public properties. 
	this.experiment = experiment;
	
        // Set the class pivate properties. 
        this._playing = false; 
        this._script = null;

	// Create the video instance
	if (src !== null) {
            // Set the video object.
            this._ctx = osweb.runner._canvas.getContext('2d');
            this._video = src.data;
            
            // Set the event anchors.
            this._video.on("ended", osweb.events._videoEnded.bind(this));
            this._video.on("play" , osweb.events._videoPlay.bind(this));
    	}
    }; 
	
    // Extend the class from its base class.
    var p = video.prototype;
    
    // Definition of public properties. 
    p.audio = true;
    p.duration = 'keypress';	
    p.full_screen = false;
    
    // Definition of private methods.
    
    p._update_video_canvas = function() {
        // Clip the content of the video to the canvas.
        if (this._playing === true) {    
            this._ctx.drawImage(this._video, 0, 0);

            // execute script.
            if ((this._script !== null) && (this._event_handler_always === true)) {
                // Start the parser
                osweb.parser._run(null, this._script);    		
            }    
        }    
    };    
    
    // Definition of public methods.
    
    p.play = function() {
	// Play the actual video.
        this._video.play();
        
        // Set the volume
        this._video.volume = (this.audio === true) ? 1 : 0;
        
        // Check if the video must be scaled.
        if (this.full_screen == true) {    
            // Draw the first image with scaling.
            var xScale = (this.experiment._canvas._width  / this._video.videoWidth);
            var yScale = (this.experiment._canvas._height / this._video.videoHeight);
            this._ctx.scale(xScale,yScale);
        }
        
        // Draw the first frame.
        this._ctx.drawImage(this._video, 0, 0);
        
        // Set the play toggle.
        this._playing = true;
    };

    p.stop = function() {
	// Pause the actual sound.
	this._video.pause();
        this._playing = false;
    };

    p.wait = function() {
        // Set the blocking of the sound.
        osweb.events._run(this, -1, osweb.constants.RESPONSE_VIDEO,[]);
    };
    
    // Bind the video class to the osweb namespace.
    osweb.video_backend = video;
}());


(function() {
    // Definition of the class debug.
    function debug() {
    	throw 'The class debug cannot be instantiated!';
    }

    // Definition of public properties.
    debug.enabled = false;                        // Enable the debugger  
    debug.error = false;                         // true if an error occured.
    debug.messageLog = new Array();              // Arraty with alle log messages.

    // Definition of class private methods.               
   
    debug._initialize = function() {
    	// Enabled/disable the debugger.
    	this.debug = osweb.runner.debug;
    	// Clear the log.
        this.messageLog = [];
    };	

    debug._finalize = function() {
	// If enabled push the messages to the javascript console.
	if (this.enabled === true) {
            console.log(this.messageLog);			
	}

	// Clear the log.
	this.messageLog = [];
    };

    // Definition of the public methods.               
   
    debug.addError = function(error_text) {
    	// Set the error flag.
    	this.error = true;

        // Show the fatal error warning.
	console.log(error_text);
	console.log(osweb.constants.ERROR_001);

	// Throw the exception.
	throw new Error(error_text);	
    };
	
    debug.addMessage = function(message_text) {
        // Push the error message to the log.
	this.messageLog.push(message_text);		
	
	if (debug.enabled === true) {
            console.log(message_text);
        }    
    };

    debug.msg = function(message_text) {
	// Push the error message to the log.
	this.addMesage(message_text);
    };

    // Bind the debug class to the osweb namespace.
    osweb.debug = debug;
}());


/*
 * Definition of the class file_pool_store.
 */

(function() 
{
    function file_pool_store()
    {
    	throw "The class file_pool_store cannot be instantiated!";
    }; 
	
    // Definition of private class properties.
    file_pool_store._data  = [];
    file_pool_store._items = [];  
	
    /*
     * Definition of private class methods.   
     */

    file_pool_store.add_from_local_source = function(pItem)
    {
        var ext = pItem.filename.substr(pItem.filename.lastIndexOf('.') + 1);
        
        if ((ext == 'jpg') || (ext == 'png'))
	{
            // Create a new file pool mage item.
            var img = new Image();
            img.src = pItem.toDataURL();
            var item = {data: img, folder: pItem.filename, name: pItem.filename.replace(/^.*[\\\/]/, ''), size: pItem.length, type: 'image'};
	}
        else if ((ext == 'wav') || (ext == 'ogg'))
	{
            var ado = new Audio();
            ado.src = pItem.toDataURL();
            var item = {data: ado, folder: pItem.filename, name: pItem.filename.replace(/^.*[\\\/]/, ''), size: pItem.length, type: 'sound'};
	}
	else if (ext == 'ogv')
        {
            var ado = document.createElement("VIDEO");
            ado.src = pItem.toDataURL();
            var item = {data: ado, folder: pItem.filename, name: pItem.filename.replace(/^.*[\\\/]/, ''), size: pItem.length, type: 'video'};
        }    
        
	// Add the item to the pool.
	this._items.push(item);

	// Link the item as property
	this[item.name] = item;
    };

    file_pool_store.add_from_server_source = function(pPath, pFiles)
    {
        console.log('--');
        console.log(pFiles);

        // Check if there are stimuli files.
        if (pFiles.length > 0)
	{
            // Set the preloader.
            this._queue = new createjs.LoadQueue(false);
            createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin]);  // need this so it doesn't default to Web Audio
            this._queue.installPlugin(createjs.Sound);
 		
            this._queue.on("fileload", this._file_complete, this);
            this._queue.on("complete", this._load_complete, this);

            // Add the stimuli information to the loader.
            for (var i=0;i < pFiles.length;i++)
            {
                var re = /(?:\.([^.]+))?$/;
                var extention = re.exec(pFiles[i]);
                console.log(extention);
                
                if (extention[0] == '.ogg')
                {
                    console.log('sound');
                    this._queue.loadFile({id: pFiles[i], src: pPath + pFiles[i], type: createjs.AbstractLoader.SOUND});
                }    
                else
                { 
                    this._queue.loadFile({id: pFiles[i], src: pPath + pFiles[i], type: createjs.AbstractLoader.IMAGE});
                }        
            }
	
            // Load the stimuli files.
            this._queue.load();
        }
        else
        {
            // Build the experiment objects using the given script.
            osweb.runner._buildExperiment();
        } 
    }; 
    
    file_pool_store._file_complete = function(pEvent)
    {
	// Update the loader text.
	osweb.runner._updateIntroScreen(osweb.constants.MESSAGE_007);

        // Push the stimulus item to the stimuli object.
        var item = {data: pEvent.result, folder: pEvent.item.id, name: pEvent.item.id.replace(/^.*[\\\/]/, ''), size: pEvent.item.id, type: 'image'};
        
        // Add the item to the pool.
	this._items.push(item);

	// Link the item as property
	this[item.name] = item;
    };	
	
    file_pool_store._load_complete = function()
    {
	// Update the loader text.
	osweb.runner._updateIntroScreen(osweb.constants.MESSAGE_006);

        console.log(this._items);

	// Building is done, go to next phase.
        osweb.runner._buildExperiment();
    };	

    /*
     * Definition of public class methods.   
     */

    file_pool_store.add = function(pPath, pNew_Name)
    {
    	// Copies a file to the file pool. 
    };
	
    file_pool_store.fallback_folder = function()
    {	
    	// The full path to the fallback pool folder.
    };
	
    file_pool_store.files = function()
    {
    	// Returns all files in the file pool.
    };

    file_pool_store.folder = function()
    {
    	// The full path to the (main) pool folder.
    };
	
    file_pool_store.folders = function()
    {
    	// Gives a list of all folders that are searched when retrieving the full path to a file. 
    };

    file_pool_store.in_folder = function(pPath)
    {
    	// Checks whether path is in the pool folder. 
    };

    file_pool_store.rename = function(pOld_path, pNew_path)
    {
	// Renames a file in the pool folder.
    };
	
    file_pool_store.size = function()
    {
	// The combined size in bytes of all files in the file pool.
    };

    // Bind the stack file_pole_store to the osweb namespace.
    osweb.pool = file_pool_store;
}());

/*
 * Definition of the class heartbeat.
 */

(function() 
{
    function heartbeat(pExperiment, pInterval)
    {
        // Set the class public properties. 
    	this.experiment = pExperiment;
	this.interval   = (typeof pInterval === 'undefined') ? 1 : pInterval;	
    }; 
	
    // Extend the class from its base class.
    var p = heartbeat.prototype;
    
    // Define the class public properties. 
    p.experiment = null;
    p.interval   = -1;

    /*
     * Definition of class private methods.   
     */

    p.beat = function()
    {
    };

    p.run = function()
    {
    };

    p.start = function()
    {
    };
	
    // Bind the heartbeat class to the osweb namespace.
    osweb.heartbeat = heartbeat;
}());


/*
 * Definition of the class item_stack.
 */

(function() 
{
    function item_stack()
    {
   	throw "The class item_stack cannot be instantiated!";
    }; 
	
    // Definition of private class properties.
    item_stack._items = [];  
	
    /*
     * Definition of public class methods.   
     */

    item_stack.clear = function()
    {
    	// Clears the stack.
	this._items = [];
    };

    item_stack.push = function(pItem, pPhase)
    {
    	// Create the stack item.
	var StackItem = {'item': pItem, 'phase': pPhase};

	// Push the item onto the stack.
	this._items.push(StackItem);
    };	

    item_stack.pop = function()
    {
	// Pops the last item from the stack.
	return this._items.pop();
    };

    // Bind the item_stack class to the osweb namespace.
    osweb.item_stack = item_stack;
}());


/*
 * Definition of the class item_store.
 */

(function() 
{
    function item_store()
    {
	throw "The class item_store cannot be instantiated!";
    } 
		
    // Set the class private properties. 
    item_store._experiment = null;
    item_store._items      = {};
    
    /*
     * Definition of public methods - running item.         
     */
    
    item_store.execute = function(pName, pParent)
    {
	// Executes the run and prepare phases of an item, and updates the item stack.
	this.prepare(pName);
	this.run(pName, pParent);
    };

    item_store.items = function()
    {
	// Create a list o keys.
        var items = [];
        for (var key in this._items) 
        {
            items.push([key ,this._items[key]]);
        }    
        
        // Returns a list of item names.
	return items;
    };

    item_store.keys = function()
    {
	// Create a list o keys.
        var keys = [];
        for (var key in this._items) 
        {
            keys.push(key);
        }    
        
        // Returns a list of item names.
	return keys;
    };

    item_store.new = function(pType, pName, pScript)
    {
	// Check if the element is part of the osweb name space
	if (osweb.isClass(pType) == true)
	{
            // Add the new item as property of items.
            this._items[pName] = osweb.newItemClass(pType, this._experiment, pName, pScript);
        }
	else
	{
            // Unkwone class definition, show error message.
            osweb.debug.addError(osweb.constants.ERROR_009 + pType);
	}
    };
    
    item_store.prepare = function(pName, pParent)
    {
        // Executes the prepare phase of an item, and updates the item stack.
	osweb.item_stack.push(pName, 'prepare');
        
        this._items[pName]._parent = pParent;
        this._items[pName].prepare();
    };	

    item_store.run = function(pName, pParent)
    {
	// Set the current and its parent item.
	osweb.events._current_item         = this._items[pName];
	osweb.events._current_item._parent = pParent;
		
	// Executes the run phase of an item, and updates the item stack.
	osweb.item_stack.push(pName, 'run');
	this._items[pName].run();
    };

    item_store.valid_name = function(pItem_type, pSuggestion)
    {
        // Check the optional parameters.
        pSuggestion = (typeof pSuggestion === 'undefined') ? null : pSuggestion;
        
        if (pSuggestion == null)
        {
            var name = 'new_' + pItem_type;
        }
        else
        {
            var name = this._experiment.syntax.sanitize(pSuggestion, true, false);
        }   
        
        // Create a unique name.
        var i     = 1;
        var _name = name;
        while (this._items.hasOwnProperty(_name) == true)
        {
            _name = name + '_' + String(i);
	    i++;
        } 

        // Return function result
        return _name; 
    };    
    
    item_store.values = function()
    {
  	// Create a list o keys.
        var values = [];
        for (var key in this._items) 
        {
            values.push(this._items[key]);
        }    
        
        // Returns a list of item names.
	return values;
    };

    // Bind the item_store class to the osweb namespace.
    osweb.item_store = item_store;
}());


/*
 * Definition of the class python_workspace.
 */

(function() 
{
    function python_workspace()
    {
    	throw "The class python_workspace cannot be instantiated!";
    }; 
	
    /*
     * Definition of public class methods.   
     */
    
    python_workspace._eval = function(pBytecode)
    {
        // Check wich type of expression must be evaled.
        if (typeof pBytecode === 'boolean')    
        {
            return pBytecode;
        }
        else if (typeof pBytecode === 'string')
        {
            // Open sesame script, first check for parameter values. 
            pBytecode = osweb.syntax.eval_text(pBytecode);
           
            // Evaluate the expression.
            eval_string = osweb.syntax.remove_quotes(pBytecode)
            if(eval_string == "always"){
                return true;
            }else if(eval_string == "never"){
                return false;
            }else{
                return eval(eval_string);
            }    
        }
        else
        {
            console.log('>python script - not supported yet');
            return eval(pBytecode);
        }    
    };
	
    python_workspace.init_globals = function()
    {
    };
	
    // Bind the python_workspace class to the osweb namespace.
    osweb.python_workspace = python_workspace;
}());


(function() {
    // Definition of the class python_workspace.
    function python_workspace_api() {
    	throw 'The class python_workspace_api cannot be instantiated!';
    }; 
	
    // Definition of private methods.   

    python_workspace_api._initialize = function() {
	// Create the global function calls for use in the inlide script item.
	window['canvas'] = this.canvas;
	window['copy_sketchpad'] = this.copy_sketchpad;
	window['keyboard'] = this.keyboard;
	window['mouse'] = this.mouse;
	window['pause'] = this.pause;
	window['reset_feedback'] = this.reset_feedback;	
	window['sampler'] = this.sampler;
	window['set_response'] = this.set_response;
	window['set_subject_nr'] = this.set_subject_nr;	
	window['sometimes'] = this.sometimes;
	window['synth'] = this.synth;
	window['xy_circle'] = this.xy_circle;
	window['xy_distance'] = this.xy_distance;
	window['xy_from_polar'] = this.xy_from_polar;
	window['xy_grid'] = this.xy_grid;
	window['xy_random'] = this.xy_random;
	window['xy_to_polar'] = this.xy_to_polar;
    };

    // Definition of public methods - global functions.   

    python_workspace_api.canvas = function(auto_prepare, style_args) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas().');
    };

    python_workspace_api.copy_sketchpad = function(name) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'copy_sketchpad().');
    };

    python_workspace_api.keyboard = function(resp_args) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'keyboard().');
    };

    python_workspace_api.mouse = function(resp_args) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'mouse().');
    };

    python_workspace_api.pause = function() {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'pause().');
    };

    python_workspace_api.reset_feedback = function() {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'pause().');
    };

    python_workspace_api.sampler = function(src, playback_args) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'pause().');
    };

    python_workspace_api.set_response = function(response, response_time, correct) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'pause().');
    };
	
    python_workspace_api.set_subject_nr = function(nr) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'pause().');
    };

    python_workspace_api.sometimes = function(p) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'pause().');
    };

    python_workspace_api.synth = function(osc, freq, length, attack, decay) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'pause().');
    };

    python_workspace_api.xy_circle = function(n, rho, phi0, pole) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'cy_circle().');
    };

    python_workspace_api.xy_distance = function(x1, y1, x2, y2) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'xy_distance().');
    };

    python_workspace_api.xy_from_polar = function(rho, phi, pole) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'xy_from_polar().');
    };

    python_workspace_api.xy_grid = function(n, spacing, pole) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'xy_grid().');
    };

    python_workspace_api.xy_random = function(n, width, height, min_dist, pole) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'xy_random().');
    };

    python_workspace_api.xy_to_polar = function(x, y, pole) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'xy_to_polar().');
    };

    // Bind the python_workspace_api class to the osweb namespace.
    osweb.python_workspace_api = python_workspace_api;
}());


(function() {
    // Definition of the class response_info.
    function response_info(response_store, response, correct, response_time, item, feedback) {
    }; 
	
    // Extend the class from its base class.
    var p = response_info.prototype;
    
    // Definition of public methods - properties.   

    p.match = function(kwdict) {
    };    
        
    p.matchnot = function(kwdict) {
    };    
	
    // Bind the response_info class to the osweb namespace.
    osweb.response_info = response_info;
}());


(function() {
    // Definition of the class response_store.
    function response_store(experiment) {
        // Definition of private properties.
        this._experiment = experiment;
	this._feedback_from = 0;
	this._responses = [];
    }; 
	
    // Extend the class from its base class.
    var p = response_store.prototype;
    
    // Definition of public methods - properties.   

    p.acc = function() {
    };    
        
    p.avg_rt = function() {
    };    
        
    p.correct = function() {
    };    

    p.feedback = function() {
    };    

    p.item = function() {
    };    
        
    p.response = function() {
    };    
        
    p.response_time = function() {
    };    
    
    p.var = function() {
    };    
        
    // Definition of public methods - edit.   

    p.add = function(response, correct, response_time, item,feedback) {
    };    
        
    p.clear = function() {
    };    
        
    p.reset_feedback = function() {
    };    
	
    // Bind the response_store class to the osweb namespace.
    osweb.response_store = response_store;
}());

 
/*
 * Definition of the class syntax.
 */

(function() 
{
    function syntax()
    {
    	throw "The class syntax cannot be instantiated!";
    }; 

    /*
     * Definition of private class methods.   
     */

    syntax._convertPython = function(pScript)
    {
    	return pScript;
    };

    syntax.isNumber = function(n)
    {
        return Number(n) == n; // aangepast van == naar === en weer terug naar '==' anders werkt duration niet.
    };

    syntax.isFloat = function(n)
    {
        return Number(n) === n && n % 1 !== 0;
    };

    syntax.remove_quotes = function(pString)
    {
        if (pString == '""')
        {
            return '';
        }    
        else if ((pString[0] == '"') && (pString[pString.length - 1] == '"'))
	{
            return pString.slice(1, pString.length - 1);
	}
	else
	{
            return pString;
	}	
    };

    /*
     * Definition of public class methods.   
     */
    
    syntax.compile_cond = function(pCnd, pBytecode)
    {
	// Check for conditional paramters.
	pBytecode = (typeof pBytecode === 'undefined') ? true : pBytecode;	
		
	if (pCnd == 'always')
	{
            return true;
	} 
	else if (pCnd == 'never')
	{
            return false;
	} 
        else
	{
            if (pCnd.substring(0,1) == '=')
            {
                // Python script, compile it to an ast tree.
                console.log('python script is not supported yet');
            } 
            else
            {
                // opensesame script, convert it to javascript.
                pCnd = pCnd.replace(/[^(!=)][=]/g, '==');
            }
        }    

        return pCnd;
    };
	
    syntax.eval_text = function(pTxt, pVars, pRound_float, pVar)
    {
	// Evaluates variables and inline Python in a text string.
	var result     = pTxt;
	var processing = result.search(/[^[\]]+(?=])/g);
		
	while (processing != -1)
	{
            // Replace the found value with the variable.
            var variable = result.slice(processing,result.indexOf(']'));
           
            if (typeof pVars === 'undefined')
            {
                var value = osweb.runner.experiment.vars[variable];
            }
            else
            {
                var value = pVars[variable];
            } 
            
            result	 = result.replace('[' + variable + ']',value);			
            processing   = result.search(/[^[\]]+(?=])/g);
        }

        return result;
    };

    syntax.parse_cmd = function(pString)
    {
	// split the astring.
	var tokens = this.split(pString);
	tokens.shift();
	tokens.shift();
	return tokens;
    };

    syntax.sanitize = function(pString, pStrict, pAllowVars)
    {
	// Removes invalid characters (notably quotes) from the string.
	return pString;
    };

    syntax.split = function(pLine)
    {
    	// Return an array with tokens ignoring whitespaces within. 
	var result = pLine.match(/(?:[^\s"]+|"[^"]*")+/g);
        
        return (result != null) ? result : [];
    };    

    // Bind the syntax class to the osweb namespace.
    osweb.syntax = syntax;
}());


/*
 * Definition of the class var_store.
 */

(function() 
{
    function var_store(pItem, pParent)
    {
        // Set the class properties. 
        this._item   = pItem;
        this._parent = pParent;
    }; 
	
    // Extend the class from its base class.
    var p = var_store.prototype;
    
    // Set the class default properties. 
    p._item   = null;
    p._parent = null;        
	
    /*
     * Definition of public class methods.   
     */

    p.get = function(pVar, pDefault, pEval, pValid)
    {
	// Set the optional arguments
	pDefault = (typeof pDefault === 'undefined') ? null : pDefault;
	pEval    = (typeof pEval === 'undefined')    ? true : pEval;
	pValid   = (typeof pValid === 'undefined')   ? null : pValid;
		
	var value = null;

	// Gets an experimental variable.
	if (pVar in this)
	{
            if (typeof this[pVar] == 'string')
            {
	 	value = osweb.syntax.eval_text(this[pVar]);
            }
            else
            {
 		value = this[pVar];
            }
 	}

	// Return function result.
	return value;
    };

    p.inspect = function()
    {
	var keys = [];
	for(var key in this)
  	{
            keys.push(key);
   	}
   		
   	// Slide default properties. 
   	keys = keys.slice(2,keys.length - 3);
   		
	return keys;
    };

    p.set = function(pVar, pVal)
    {
	// Sets and experimental variable.
	this[pVar] = pVal;
    };
	
    // Bind the vars class to the osweb namespace.
    osweb.var_store = var_store;
}());

	
/*
 * Definition of the class item.
 */

(function() 
{
    function item(pExperiment, pName, pScript)
    {
	// Set the class private properties.
	this._get_lock = null;
	this._parent   = null;
	this._status   = osweb.constants.STATUS_NONE;

        // Set the class public properties.
	this.count      = 0;	
	this.debug	= osweb.debug.enabled;
	this.experiment = (pExperiment == null) ? this : pExperiment;
	this.name       = pName;	
	this.vars 	= (this.vars) ? this.vars : new osweb.var_store(this, null);

        // Set the object realted properties.
	this.clock            = this.experiment._clock;		
	this.log              = this.experiment._log;
	this.python_workspace = this.experiment._python_workspace;	
        this.syntax           = this.experiment._syntax; 	
	
        // Read the item definition string.	
	this.from_string(pScript);
    } 
	
    // Extend the class from its base class.
    var p = item.prototype;

    // Definition of class public properties. 
    p.clock            = null;
    p.comments         = null;
    p.count            = 0;
    p.debug            = false;
    p.experiment       = null;
    p.log              = null;
    p.name             = '';
    p.syntax           = null;
    p.python_workspace = null;
    p.vars             = null;
    p.variables        = null;

    /*
     * Definition of public methods - general function.
     */

    p.dummy = function()
    {
    	// Dummy function, continue execution of an item directly.
    };
   
    p.resolution = function()
    {
    	/* // Returns the display resolution and checks whether the resolution is valid.
        var w = this.vars.get('width');
	var h = this.vars.get('height');
	if ((typeof w !== 'number') || (typeof h !== 'number'))
	{
            osweb.debug.addError('(' + String(w) + ',' + String(h) + ') is not a valid resolution');
        }
        
        return [w, h]; */
    };
   
    p.set_response = function(pResponse, pResponse_time, pCorrect)
    {
	// Processes a response in such a way that feedback variables are updated as well.
        console.log('warning: method "item.set_response" not implemented yet.');
    };
 
    p.sleep = function(pMs)
    {
	// Pauses the object execution. !WARNING This function can not be implemented due the script blocking of javascript.
	this.clock.sleep(pMs);
    };

    p.time = function()
    {
	// Returns the current time.
    	return this.clock.time();
    };

     /*
     * Definition of public methods - build cycle.         
     */

    p.from_string = function(pString)
    {
	// Parses the item from a definition string.
	osweb.debug.addMessage('');
        this.variables = {};
	this.reset();
	this.comments = [];
	this.reset();
		
	// Split the string into an array of lines.  
	if (pString != null)
	{
            var lines = pString.split('\n');
            for (var i=0; i < lines.length; i++)
            {
                if ((lines[i] != '') && (this.parse_variable(lines[i]) == false))
		{
                   
                    this.parse_line(lines[i]);
                }
            }
	}					
    };
	
    p.parse_comment = function(pLine)
    {
	// Parses comments from a single definition line, indicated by # // or '.
	pLine = pLine.trim();
	if ((pLine.length > 0) && (pLine.charAt(0) == '#'))
	{
            // Add comments to the array removing the first character.
            this.comments.push(pLine.slice(1));

            return true;
	}	
	else if ((pLine.length > 1) && (pLine.charAt(0) == '/'))
	{
            // Add comments to the array removing the first two characters.
            this.comments.push(pLine.slice(2));
            
            return true;			
	}
	else
	{
            return false;
	}
    };	
	
    p.parse_keyword = function(pLine, pFrom_ascii, pEval)
    {
    };

    p.parse_line = function(pLine)
    {
	// Allows for arbitrary line parsing, for item-specific requirements.
    };

    p.parse_variable = function(pLine)
    {
        // Reads a single variable from a single definition line.
        if (this.parse_comment(pLine))
        {
            return true;
        }
        else
        {
            var tokens = osweb.syntax.split(pLine);
            if ((tokens != null) && (tokens.length > 0) && (tokens[0] == 'set'))
            {
		if (tokens.length != 3)
		{
                    osweb.debug.addError('Error parsing variable definition: ' + pLine);
		}	
            	else
		{
                    // Rettrieve the value of the variable, remove additional quotes.
                    var value = osweb.syntax.remove_quotes(tokens[2]);
                 
                    // Check for number types.
                    value = osweb.syntax.isNumber(value) ? Number(value) : value;
                    
                    this.vars.set(tokens[1], value);

                    return true;
		}
            }
            else
            {
		return false;
            }
        }	
    };
	
    /*
     * Definition of public methods - runn cycle. 
     */
    
    p.reset = function()
    {
	// Resets all item variables to their default value.
    };

    p.prepare = function()
    {
	// Implements the prepare phase of the item.
	this.experiment.vars.set('count_' + this.name, this.count);
	this.count++;
		
	// Set the status to initialize.
	this._status = osweb.constants.STATUS_INITIALIZE;
    	
        // For debugging.
        osweb.debug.addMessage('prepare' + this.name);
        
        // Implements the complete phase of the item (to support blocking script in the prepare phase).
	if ((this._parent !== null) && (this.type !== 'feedback'))
	{
            // Prepare cycle of parent.
            this._parent.prepare_complete();
        }
    };

    p.prepare_complete = function()
    {
        // Dummy function for completion process.
    };

    p.set_item_onset = function(pTime)
    {
 	// Set a timestamp for the item's executions
	var time = (pTime != null) ? pTime : this.clock.time();
	this.experiment.vars.set('time_' + this.name, time);
    };	

    p.run = function()
    {
    	// Implements the run phase of the item.
        osweb.debug.addMessage('run' + this.name);
    };

    p.update = function()
    {
    	// Implements the update phase of the item.
    };
    
    p.update_response = function(pResponse)
    {
	// Implements the update_response phase of an item.
    };	

    p.complete = function()
    {
    	// Implements the complete phase of the item.
	if (this._parent !== null)
	{
            // Return the process control to the parent of the element.
            osweb.events._current_item = this._parent;
            osweb.events._current_item.run();  
	}
    };
  
    // Bind the item class to the osweb namespace.
    osweb.item = item;
}());


/*
 * Definition of the class generic_response.
 */

(function() 
{
    function generic_response(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.item_constructor(pExperiment, pName, pScript);
	
	// Definition of private properties.
	this._allowed_responses = null;
	this._duration          = 0;
	this._duration_func 	= null;
	this._keyboard		= null;
	this._mouse             = null;
	this._responsetype	= osweb.constants.RESPONSE_NONE;
	this._timeout           = -1;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(generic_response, osweb.item);

    // Definition of public properties.
    p.auto_response    = "a";
    p.process_feedback = false;
    p.synonyms         = null;
  
    /*
     * Definition of public methods - build cycle. 
     */

    p.auto_responser = function()
    {
    };

    p.auto_responser_mouse = function()
    {
    };

    p.prepare_allowed_responses = function()
    {
        // Prepare the allowed responses..
        if (this.vars.get('allowed_responses') == null)
	{
            this._allowed_responses = null;
	}
	else
	{	
            // Create a list of allowed responses that are separated by semicolons. Also trim any whitespace.
            var allowed_responses = String(this.vars.allowed_responses).split(';');
            
            if (this.vars.duration == 'keypress')
            {	
		//this._allowed_responses = allowed_responses;
                this._allowed_responses = this._keyboard._get_default_from_synoniem(allowed_responses);
            }
            else if (this.vars.duration == 'mouseclick')
            {
                // For mouse responses, we don't check if the allowed responses make sense.
            	this._allowed_responses = this._mouse._get_default_from_synoniem(allowed_responses);
            }
            
            // If allowed responses are provided, the list should not be empty.
            if (this._allowed_responses.length == 0)
            {
		osweb.debug.addError(this.vars.get('allowed_responses') + ' are not valid allowed responses in keyboard_response '+ this.name);	
            } 
	}
    };
		
    p.prepare_duration = function()
    {
	// Prepare the duration.
        if (this.vars.get('duration') != null)
	{
            if (typeof this.vars.duration == 'number')
            {
        	// Prepare a duration in milliseconds
		this._duration = this.vars.duration;
		if (this._duration == 0)
		{
                    this._responsetype = osweb.constants.RESPONSE_NONE;
		}
		else
		{	
                    this._responsetype = osweb.constants.RESPONSE_DURATION;
		}
            }
            else
            {
		this._duration = -1;
		if (this.vars.duration == 'keypress')
		{
                    this.prepare_duration_keypress();
                    this._responsetype = osweb.constants.RESPONSE_KEYBOARD;
		}
		else if (this.vars.duration == 'mouseclick')
		{
                    this.prepare_duration_mouseclick();
                    this._responsetype = osweb.constants.RESPONSE_MOUSE;
		}
                else if (this.vars.duration == 'sound')
                {
                    this._responsetype = osweb.constants.RESPONSE_SOUND;
                } 
                else if (this.vars.duration == 'video')
                {
                    this._responsetype = osweb.constants.RESPONSE_VIDEO;
                } 
            }		
	}
    };
	
    p.prepare_duration_keypress = function()
    {
        // Prepare a keyboard duration.
	this._keyboard = new osweb.keyboard(this.experiment);
	if (this.experiment.auto_response == true)
	{
            this._duration_func = this.auto_responder;
	}
	else
	{
            var final_duration = (this._timeout != -1) ? this._timeout : this._duration;
            this._keyboard.set_config(final_duration, this._allowed_responses);
	}
    };
	
    p.prepare_duration_mouseclick = function(self)
    {
	// Prepare a mouseclick duration.
	this._mouse = new osweb.mouse(this.experiment);
	if (this.experiment.auto_response == true)
	{
            this._duration_func = this.auto_responder_mouse;
	}
	else
	{
            var final_duration = (this._timeout != -1) ? this._timeout : this._duration;
            this._mouse.set_config(final_duration, this._allowed_responses, false);
	}
    };	

    p.prepare_timeout = function()
    {
	// Prepare the timeout.
	if (this.vars.get('timeout') != null) 
	{
            if (typeof this.vars.timeout == 'number')
            {
		// Prepare a duration in milliseconds
            	this._timeout = this.vars.timeout;
            }
            else
            {
		this._timeout = -1;
            }		
	}
    };	
    
    /*
     * Definition of public methods - run cycle. 
     */

    p.process_response_keypress = function(pRetval)
    {
	this.experiment._start_response_interval = this.sri;
	this.experiment._end_response_interval   = pRetval.rtTime;
	this.experiment.vars.response            = this.syntax.sanitize(pRetval.resp);
	this.synonyms                            = this._keyboard.synonyms(this.experiment.vars.response); 
	this.response_bookkeeping();
    };
	
    p.process_response_mouseclick = function(pRetval)
    {
 	this.experiment._start_response_interval = this.sri;
	this.experiment._end_response_interval   = pRetval.rtTime;
	this.experiment.vars.response		 = pRetval.resp;
	this.synonyms                            = this._mouse.synonyms(this.experiment.vars.response);
	this.experiment.vars.cursor_x            = pRetval.event.clientX;
	this.experiment.vars.cursor_y            = pRetval.event.clientY;
	this.response_bookkeeping();
    };

    p.response_bookkeeping = function()
    {
	// The respone and response_time variables are always set, for every response item
	this.experiment.vars.set('response_time', this.experiment._end_response_interval - this.experiment._start_response_interval);
	this.experiment.vars.set('response_' + this.name, this.experiment.vars.get('response'));
	this.experiment.vars.set('response_time_' + this.name, this.experiment.vars.get('response_time'));
	this.experiment._start_response_interval = null;

	// But correctness information is only set for dedicated response items, such as keyboard_response items, because otherwise we might confound the feedback
	if (this.process_feedback == true)
	{
            // debug.msg(u"processing feedback for '%s'" % self.name)
            if (this.vars.correct_response != null)
            {
                // If a correct_resbponse has been defined, we use it to determine accuracy etc.
		if (this.synonyms != null)  
		{
                    if (this.synonyms.indexOf(String(this.vars.get('correct_response'))) != -1)
                    { 
                        this.experiment.vars.correct       = 1;
			this.experiment.vars.total_correct = this.experiment.vars.total_correct + 1;
                    }
                    else
                    {
                        this.experiment.vars.correct = 0;
                    }
		}	
		else
		{
                    this.experiment.vars.correct = 'undefined';
                    /* if self.experiment.response in (correct_response, safe_decode(correct_response)):
                    	self.experiment.var.correct = 1
			self.experiment.var.total_correct += 1
                    else:
                    	self.experiment.var.correct = 0 */
		}
            }
            else
            {
                // If a correct_response hasn't been defined, we simply set correct to undefined.
		this.experiment.vars.correct = 'undefined';
            }	

            // Do some response bookkeeping
            this.experiment.vars.total_response_time   = this.experiment.vars.total_response_time + this.experiment.vars.response_time;
            this.experiment.vars.total_responses       = this.experiment.vars.total_responses + 1;
            this.experiment.vars.accuracy              = Math.round(100.0 * this.experiment.vars.total_correct / this.experiment.vars.total_responses);
            this.experiment.vars.acc        	       = this.experiment.vars.accuracy;
            this.experiment.vars.average_response_time = Math.round(this.experiment.vars.total_response_time / this.experiment.vars.total_responses);
            this.experiment.vars.avg_rt                = this.experiment.vars.average_response_time;
            this.experiment.vars.set('correct_' + this.name, this.vars.correct); 
	} 
    };	
	
    p.process_response = function()
    {
        // Start stimulus response cycle.
   	switch (this._responsetype)
   	{
            case osweb.constants.RESPONSE_NONE:
 		// Duration is 0, so complete the stimulus/response cycle.
 		this._status = osweb.constants.STATUS_FINALIZE;
                this.complete();
           
            break;
            case osweb.constants.RESPONSE_DURATION:
		this.sleep_for_duration();
            
            break;
            case osweb.constants.RESPONSE_KEYBOARD:
                this._keyboard.get_key();
            
            break;
            case osweb.constants.RESPONSE_MOUSE:
                this._mouse.get_click();
            
            break;
            case osweb.constants.RESPONSE_SOUND:
               this._sampler.wait();

            break;
            case osweb.constants.RESPONSE_VIDEO:
               this._video.wait();
            
            break;
   	}		
    };

    p.set_sri = function(pReset)
    {
	// Sets the start of the response interval.
	if (pReset == true)
	{
            this.sri = self.vars.get('time_' + this.name);
            this.experiment._start_response_interval = this.vars.get('time_' + this.name);
	}
	
	if (this.experiment._start_response_interval == null)
	{
            this.sri = this.experiment.vars.get('time_' + this.name);
	}
	else
	{
            this.sri = this.experiment._start_response_interval;
	}
    };		

    p.sleep_for_duration = function()
    {
	// Sleep for a specified time.
	this.sleep(this._duration);		
    };
   
    /*
     * Definition of public methods - running item. 
     */
    
    p.prepare = function()
    {
	// Implements the prepare phase of the item.
	this.prepare_timeout();
	this.prepare_allowed_responses();
	this.prepare_duration();
    
        // Inherited.	
	this.item_prepare();
    };
    
    p.update_response = function(pResponse)
    {
        // Implements the update response phase of the item.
	if ((this._responsetype == osweb.constants.RESPONSE_KEYBOARD) && (pResponse.type == osweb.constants.RESPONSE_KEYBOARD)) 
	{
            this.process_response_keypress(pResponse);
	}
	else if ((this._responsetype == osweb.constants.RESPONSE_MOUSE) && (pResponse.type == osweb.constants.RESPONSE_MOUSE)) 
	{
            this.process_response_mouseclick(pResponse);     
	}
    }; 

    // Bind the generic_response class to the osweb namespace.
    osweb.generic_response = osweb.promoteClass(generic_response, "item");
}());


/*
 * Definition of the class experiment.
 */

(function() 
{
    function experiment(pExperiment, pName, pScript, pPool_folder, pExperiment_path, pFullscreen, pAuto_response, pLogfile, pSubject_nr, pWorkspace, pResources, pHeartbeat_interval)
    {
	// Set the items property for this experiment.
	osweb.item_store._experiment = this;

	// Set the optional arguments
	pLogfile = (typeof pLogfile === 'undefined') ? null : pLogfile;

	// Set the private properties. 
	this._end_response_interval   = null;
	this._start_response_interval = null;
	this._syntax                  = osweb.syntax;
	this._python_workspace        = (pWorkspace) ? pWorkspace : osweb.python_workspace;

	// Set the public properties. 
	this.auto_response      = (pAuto_response) ? pAuto_response : false;
	this.cleanup_functions  = [];
	this.heartbeat_interval = (pHeartbeat_interval) ? pHeartbeat_interval : 1;
	this.items              = osweb.item_store;
	this.output_channel 	= null;
	this.paused 		= false;
	this.plugin_folder 	= 'plugins';
	this.pool               = osweb.file_pool_store;
	this.resources 		= (pResources) ? pResources : {};
	this.restart 		= false;
	this.running		= false;
	this.vars               = new osweb.var_store(this, null);
		
	// Set default variables
	this.vars.start               = 'experiment';
	this.vars.title               = 'My Experiment';
	this.vars.bidi                = 'no';
	this.vars.round_decimals      = 2;
	this.vars.form_clicks         = 'no';
	this.vars.uniform_coordinates = 'no';

        // Sound parameters.
	this.vars.sound_freq          = 48000;
	this.vars.sound_sample_size   = -16; 
	this.vars.sound_channels      = 2;
	this.vars.sound_buf_size      = 1024;

	// Default backend
	this.vars.canvas_backend      = 'xpyriment';

	// Display parameters.
	this.vars.width               = 1024;
	this.vars.height              = 768;
	this.vars.background          = 'black';
	this.vars.foreground          = 'white';
	this.vars.fullscreen          = (pFullscreen) ? 'yes' : 'no';

	// Font parameters.
	this.vars.font_size           = 18;
	this.vars.font_family         = 'mono';
	this.vars.font_italic         = 'no';
	this.vars.font_bold 	      = 'no';
	this.vars.font_underline      = 'no'; 

	// Logfile parameters
	this.logfile = pLogfile;
	this.debug   = osweb.debug.enabled;

	// Create the backend objects.
	this._canvas = new osweb.canvas(this);
	this._clock  = new osweb.clock(this);
	this._log    = new osweb.log(this, this.logfile);
	
        // Set the global anchors.
        window['clock'] = this._clock;
        window['log']   = this._log;    
        
	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(experiment, osweb.item);
  
    // Definition of public properties. 
    p.auto_response      = false;
    p.cleanup_functions  = [];
    p.heartbeat_interval = 1;
    p.items              = null;
    p.output_channel     = null;
    p.paused             = false;
    p.plugin_folder      = '';
    p.pool               = null;
    p.resources          = null;
    p.restart            = false;
    p.running            = false;
  	
    /*
     * Definition of public methods - general function.
     */

    p.item_prefix = function()
    {
	// A prefix for the plug-in classes, so that [prefix][plugin] class is used instead of the [plugin] class.
	return '';		
    };

    p.reset_feedback = function()
    {
	// Resets the feedback variables (acc, avg_rt, etc.)."""
	this.vars.total_responses       = 0;
	this.vars.total_correct         = 0;
	this.vars.total_response_time   = 0;
	this.vars.avg_rt                = 'undefined';
	this.vars.average_response_time = 'undefined';
	this.vars.accuracy              = 'undefined';
	this.vars.acc                   = 'undefined';
    };

    p.set_subject = function(pNr)
    {
	// Sets the subject number and parity (even/ odd). This function is called automatically when an experiment is started, so you do not generally need to call it yourself.
	this.vars.subject_nr = pNr;
	if ((pNr % 2) == 0)
	{
            this.vars.subject_parity = 'even';
	}
	else
	{
            this.vars.subject_parity = 'odd';
	}
    };
  
    /*
     * Definition of public methods - building item.         
     */

    p.read_definition = function(pString)
    {
    	// Extracts a the definition of a single item from the string.
	var line = pString.shift();
	var def_str = '';
    	while ((line != null) && (line.length > 0) && (line.charAt(0) == '\t'))
	{
            def_str = def_str + line + '\n';
            line = pString.shift();
	}	
	return def_str;
    };	

    p.from_string = function(pString)
    {
    	// Set debug message.
	osweb.debug.addMessage('building experiment');
		
	// Split the string into an array of lines.  
	if (pString != null)
	{
            this._source = pString.split('\n');
            var l = this._source.shift();
            while (l != null)
            {
		// Set the processing of the next line.
		var get_next = true;

                try
		{
                    // Split the single line into a set of tokens.
                    var t = osweb.syntax.split(l);					
		}
		catch(e)
		{
                    // u"Failed to parse script. Maybe it contains illegal characters or unclosed quotes?", \
		}	

		if ((t != null) && (t.length > 0))
		{
                    // Try to parse the line as variable (or comment)
                    if (this.parse_variable(l) == false)
                    {
                        if (t[0] == 'define') 
			{
                            if (t.length == 3)
                            {
				// Get the type, name and definition string of an item.
				var item_type = t[1];
                                var item_name = osweb.syntax.sanitize(t[2]);
				var def_str = this.read_definition(this._source);
					
				osweb.item_store.new(item_type, item_name, def_str); 
                            }
                            else
                            {
                                // raise osexception(u'Failed to parse definition',line=line);
                            }
			}
                    }
		}

		// Get the next line.
		if (get_next == true)
		{
                    l = this._source.shift();
		}
            }
	};
    };
    
    /*
     * Definition of public methods - backends.
     */

    p.init_clock = function()
    {
	// Initializes the clock backend.
	this._clock.initialize;
    };	

    p.init_display = function()
    {
	// Initializes the canvas backend.
	this._canvas.init_display(this);

        this._python_workspace['win'] = window;
    };

    p.init_heartbeat = function()
    {
	// Initializes heartbeat.
	if ((this.heartbeat_interval <= 0) || (this.vars.fullscreen == 'yes') || (this.output_channel == null))
	{
            this.heartbeat = null;
	}
	else
	{
            this.heartbeat = new osweb.heartbeat(this, 1); 	
            this.heartbeat.start();
	}
    };	

    p.init_log = function()
    {
    	// Open a connection to the log file.
	this._log.open(this.logfile); 	
    };

    p.init_random = function()
    {
	// Initializes the random number generators. For some reason
	/* import random
	random.seed()
	try:
            # Don't assume that numpy is available
            import numpy
            numpy.random.seed()
            except:
            pass */
    };

    p.init_sound = function()
    {
	// Intializes the sound backend.
	/* from openexp import sampler
	sampler.init_sound(self) */
    };

    /*
     * Definition of public methods - running item.         
     */

    p.run = function()
    {
	// Inherited.	
	this.item_run();
	
	// Runs the experiment.
        switch (this._status)
        {
            case osweb.constants.STATUS_INITIALIZE:

                // Set the status to finalize.
		this._status = osweb.constants.STATUS_FINALIZE;

		// Save the date and time, and the version of OpenSesame
		this.vars.datetime = new Date().toString();
		this.vars.opensesame_version  = osweb.VERSION_NUMBER; 
		this.vars.opensesame_codename = osweb.VERSION_NAME; 
		this.running = true;
		this.init_random();
		this.init_display();
		this.init_clock();
		this.init_sound();
		this.init_log();
		this.python_workspace.init_globals();
		this.reset_feedback();
		this.init_heartbeat(); 
	
		// Add closing message to debug system.
		osweb.debug.addMessage('experiment.run(): experiment started at ' + new Date().toUTCString()); 

		if (osweb.item_store._items[this.vars.start] != null)
		{
                    osweb.item_stack.clear();
                    osweb.item_store.prepare(this.vars.start, this);
                    //osweb.item_store.execute(this.vars.start, this);
		}
		else
		{
                    osweb.debug.addError('Could not find item ' + self.vars.start +  ' , which is the entry point of the experiment');
		}

            break;
            case osweb.constants.STATUS_FINALIZE:

		// Add closing message to debug system.
                osweb.debug.addMessage('experiment.run(): experiment finished at ' +  new Date().toUTCString());

		// Complete the run process.
		this.end();
	
            break;
        }; 
    };

    p.end = function()
    {
	// Disable the run toggle.
        this.running = false;
	
        // Close the log file.
        this._log.close();
		
	// Disable the processing unit.
	osweb.events._current_item = null;
	
	// Clear the exprimental stage and enabled the mouse.
	osweb.runner._canvas.style.cursor = 'default';
        osweb.runner._stage.update(); 
			
	// Finalize the parent (runner).	
    	osweb.runner._finalize();
    };

    // Bind the experiment class to the osweb namespace.
    osweb.experiment = osweb.promoteClass(experiment, "item");
}());


/*
 * Definition of the class inline_script.
 */

(function() 
{
    function inline_script(pExperiment, pName, pScript)
    {
	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
	
	// Define and set the public properties. 
	this._prepare_run  = false;   
        this._prepare_tree = null;
	this._run_tree     = null;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(inline_script, osweb.item);

    // Define and set the public properties. 
    p.description = 'Executes Python code';

    /*
     * Definition of private methods - compiling script.
     */

    p._compile = function(pScript)
    {
        if (pScript != '')
        {
            var locations = false;
            var parseFn   = filbert_loose.parse_dammit;
            var ranges    = false;
        		
            try 
	    {
        	var code  = pScript;
         	var ast   = parseFn(code, { locations: locations, ranges: ranges });
        
	       	return ast;
    	    }
       	    catch (e) 
            {
        	console.log('error');
        	console.log(e.toString());
    	   	
                return null;
            }
	}
	else
	{
            return null;
        }	   	
    };

    /*
     * Definition of public methods - building item.         
     */
		
    p.reset = function()
    {
	// Resets all item variables to their default value.
	this._var_info     = null;
	this.vars._prepare = '';
	this.vars._run     = '';
    };

    p.from_string = function(pString)
    {
    	// Parses a definition string.
	this.reset();
		
	// Split the string into an array of lines.  
	if (pString != null)
	{
            var read_run_lines     = false;
            var read_prepare_lines = false;
            var lines = pString.split('\n');
            for (var i=0; i < lines.length; i++)
            {
		var tokens = osweb.syntax.split(lines[i]);
			
		if ((tokens != null) && (tokens.length > 0))
		{
                    switch (tokens[0])
                    {
			case 'set': 
                            this.parse_variable(lines[i]);
                            
                        break;
			case '__end__':
                            read_run_lines     = false;
                            read_prepare_lines = false;
                            
			break;	
			case '___prepare__':
                            read_prepare_lines = true;
                            
			break;
			case '___run__':
                            read_run_lines = true;
                            
			break;
			default:
                            if (read_run_lines == true)
                            {
				this.vars._run = this.vars._run + lines[i] + '\n';
                            }
                            else if (read_prepare_lines == true)
                            {
                            	this.vars._prepare = this.vars._prepare + lines[i] + '\n';
                            }
                    }
		}
		else 
		{
                    if (read_run_lines == true)
                    {
			this.vars._run = this.vars._run + lines[i] + '\n';
                    }
                    else if (read_prepare_lines == true)
                    {
			this.vars._prepare = this.vars._prepare + lines[i] + '\n';
                    }
            	} 
            }
	}
    };

    /*
     * Definition of public methods - running item.         
     */

    p.prepare = function()
    {
        // Compile the script code to ast trees.
        this._prepare_tree = osweb.parser._prepare(this.vars._prepare);
        this._run_tree     = osweb.parser._prepare(this.vars._run);
	
        // Execute the run code.
 	if (this._prepare_tree != null)
    	{
            // Set the current item.
            osweb.events._current_item = this;
            
            // Set the prepare run toggle.
            this._prepare_run = true;
            
            // Start the parser
            osweb.parser._run(this, this._prepare_tree);    		
        }
        else
        {
            // Inherited.	
            this.item_prepare();
        }    
    };

    p.run = function()
    {
    	// Inherited.	
	this.item_run();
        
        // Record the onset of the current item.
	this.set_item_onset(); 

        // Execute the run code.
 	if (this._run_tree != null)
    	{
            // Set the prepare run toggle.
            this._prepare_run = false;
            
            // Start the parser
            osweb.parser._run(this, this._run_tree);    		
    	}
    };

    p.complete = function()
    {
        // Check if the parser is ready. 
        if (osweb.parser._status == 1)
        {
            // Process the current active node.
            osweb.parser._process_node();
        }
        else
        {    
            if (this._prepare_run === true)             
            {
                // Inherited prepare.	
                this.item_prepare();
            }    
            else
            { 
                // Inherited.           
                this.item_complete();
            }
        }    
    }; 
	
    p.complete_script = function()
    {
        // Added for video script functionaliry.
        this.complete();
    };

    // Bind the Sequence class to the osweb namespace.
    osweb.inline_script = osweb.promoteClass(inline_script, "item");
}());


/*
 * Definition of the class keyboard_response.
 */

(function() 
{
    function keyboard_response(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.generic_response_constructor(pExperiment, pName, pScript);

        // Definition of private properties. 
	this._flush    = 'yes';
	this._keyboard = new osweb.keyboard(this.experiment); 
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(keyboard_response, osweb.generic_response);

        // Definition of public properties. 
    p.description = 'Collects keyboard responses';
	
    /*
     * Definition of public methods - build cycle.
     */

    p.reset = function()
    {
	// Resets all item variables to their default value.
	this.auto_response          = 'space';
	this.process_feedback       = true; 
	this.vars.allowed_responses = null;
	this.vars.correct_response  = null;
	this.vars.duration          = 'keypress';
	this.vars.flush             = 'yes';
	this.vars.timeout           = 'infinite';
    };

    /*
     * Definition of public methods - run cycle.
     */

    p.prepare = function()
    {	
	// Set the internal flush property.
	this._flush = (this.vars.flush) ? this.vars.flush : 'yes';

    	// Inherited.	
	this.generic_response_prepare();
    };

    p.run = function()
    {
	// Inherited.	
	this.generic_response_run();

        // Record the onset of the current item.
	this.set_item_onset(); 
	
	// Flush responses, to make sure that earlier responses are not carried over.
        if (this._flush == 'yes')
	{	
            this._keyboard.flush();
	}		
	
        this.set_sri();
	this.process_response();
    };
	
    // Bind the keyboard_response class to the osweb namespace.
    osweb.keyboard_response = osweb.promoteClass(keyboard_response, "generic_response");
}());


/*
 * Definition of the class logger.
 */

(function() 
{
    function logger(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.item_constructor(pExperiment, pName, pScript);
	
        // Definition of private properties. 
	this._logvars = null;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(logger, osweb.item);

    // Definition of public properties. 
    p.description = 'Logs experimental data';
    p.logvars	  = [];
	
    /*
     * Definition of public class methods - build cycle.
     */

    p.reset = function()
    {
        // Resets all item variables to their default value.
	this._logvars      = null;
	this.logvars       = [];
	this.vars.auto_log = 'yes';
    };

    p.from_string = function(pString)
    {
	// Parses a definition string.
	this.variables = {};
	this.comments  = [];
	this.reset();

	// Split the string into an array of lines.  
	if (pString != null)
	{
            var lines = pString.split('\n');
            for (var i=0; i < lines.length; i++)
            {
		if ((lines[i] != '') && (this.parse_variable(lines[i]) == false))
		{
                    var tokens = osweb.syntax.split(lines[i]);
                    if ((tokens[0] == 'log') && (tokens.length > 0))
                    {
			this.logvars.push(tokens[1]);
                    }	
		}
            }
        }
    };	

    /*
     * Definition of public class methods - run cycle.
     */

    p.run = function()
    {
	// Inherited.	
	this.item_run();
		
	// Run item only one time.   
	if (this._status != osweb.constants.STATUS_FINALIZE)
	{
            // item is finalized.
            this._status = osweb.constants.STATUS_FINALIZE;

            this.set_item_onset();
            if (this._logvars == null)
            {
		if (this.vars.auto_log == 'yes')
		{
                    this._logvars = this.experiment._log.all_vars();
		}
		else
		{
                    this._logvars = [];
                    for (variable in this.logvars)
                    {
 			if ((variable in this._logvars) == false)
 			{
                            this._logvars.push(variable);
			}
                    }
                    this._logvars.sort();		
		}
            }
            this.experiment._log.write_vars(this._logvars); 

            // Complete the cycle.
            this.complete();
        };
    };

    p.complete = function()
    {
        // Inherited.	
        this.item_complete();
    };

    // Bind the logger class to the osweb namespace.
    osweb.logger = osweb.promoteClass(logger, "item");
}());


/*
 * Definition of the class loop.
 */

(function() 
{
    function loop(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.item_constructor(pExperiment, pName, pScript);

        // Definition of private properties. 
        this._break_if = '';
        this._cycles   = [];
        this._index    = -1;
        this._keyboard = null;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(loop, osweb.item);

    // Definition of public properties. 
    p.description = 'Repeatedly runs another item';
    p.matrix      = null;

    /*
     * Definition of public methods - building cycle.         
     */

    p.reset = function()
    {
	// Resets all item variables to their default value.
	this.matrix        = {};
	this.vars.cycles   = 1;
	this.vars.repeat   = 1;
	this.vars.skip     = 0;
	this.vars.offset   = 'no';
	this.vars.order    = 'random';
	this.vars.item     = '';
	this.vars.break_if = 'never';
    };

    p.from_string = function(pString)
    {
    	// Creates a loop from a definition in a string.
    	this.comments  = [];
	this.variables = {};
	this.reset();
		
	// Split the string into an array of lines.  
	if (pString != null)
	{
            var lines = pString.split('\n');
            for (var i=0; i < lines.length; i++)
            {
		if ((lines[i] != '') && (this.parse_variable(lines[i]) == false))
		{
                    var tokens = osweb.syntax.split(lines[i]);
                    if ((tokens[0] == 'run') && (tokens.length > 1))
                    {
                    	this.vars.item = tokens[1];
                    }	
                    else if ((tokens[0] == 'setcycle') && (tokens.length > 3))
                    {
			var cycle = tokens[1];
			var name  = tokens[2];
			var value = osweb.syntax.remove_quotes(tokens[3]);
					
			// Check if the value is numeric
                        value = osweb.syntax.isNumber(value) ? Number(value) : value;

                        // Convert the python expression to javascript.
			if (value[0] == '=')
			{
                            // Parse the python statement. 
                            value = osweb.parser._prepare(value.slice(1));
                            
                            if (value !== null)        
                            {
                                value = value.body[0];
                            }    
			}

                        if (this.matrix[cycle] == undefined)
			{
                            this.matrix[cycle] = {};
			}
			
                        this.matrix[cycle][name] = value;
                    }	
		}
            }	
	}
    };
  
    /*
     * Definition of public methods - runn cycle.         
     */

    p.shuffle = function(list)
    {
        var i, j, t;
	for (i = 1; i < list.length; i++) 
	{
	    j = Math.floor(Math.random() * (1 + i));  
	    if (j != i) 
	    {
	        t       = list[i];                        
                list[i] = list[j];
	        list[j] = t;
            }
	}			
    };

    p.apply_cycle = function(cycle)
    {
	// Sets all the loop variables according to the cycle.
	if (cycle in this.matrix)
	{
            for (var variable in this.matrix[cycle])
            {
		// Get the value of the variable.
		var value = this.matrix[cycle][variable];

		// Check for python expression.
		if (typeof value === 'object')
                {
                    // value contains ast tree, run the parser.
                    try
                    {	
                        // Evaluate the expression
                        value = osweb.parser._runstatement(value);
                    }
                    catch (e)
                    {
                        // Error during evaluation.
                        osweb.debug.addError('Failed to evaluate ' + value + ' in loop item ' + this.name);
                    }						
                }
				
                // Set the variable.
                this.experiment.vars.set(variable, value);
            }
	}
    };
	
    p.prepare = function()
    {
	// Prepare the break if condition.
	if ((this.vars.break_if != '') && (this.vars.break_if != 'never'))
	{
            this._break_if = this.syntax.compile_cond(this.vars.break_if);
        }
	else
	{
            this._break_if = null;
	}

	//  First generate a list of cycle numbers
	this._cycles = [];
	this._index  = 0;
		
	// Walk through all complete repeats
	var whole_repeats = Math.floor(this.vars.repeat);
	for (var j = 0; j < whole_repeats; j++)
	{
            for (var i = 0; i < this.vars.cycles; i++)
            {
		this._cycles.push(i);
            }
	}
				
	// Add the leftover repeats.
	var partial_repeats = this.vars.repeat - whole_repeats;
	if (partial_repeats > 0)
	{
            var all_cycles = Array.apply(null, {length: this.vars.cycles}).map(Number.call, Number);    
            var remainder  = Math.floor(this.vars.cycles * partial_repeats);
            for (var i = 0; i < remainder; i++)
            {
                // Calculate random position.
                var position = Math.floor(Math.random() * all_cycles.length);     
                // Add position to cycles.
                this._cycles.push(position);
                // Remove position from array.
                all_cycles.splice(position,1);
            }
	}		

	// Randomize the list if necessary.
	if (this.vars.order == 'random')
	{
            this.shuffle(this._cycles);
	}	
	else
	{
            // In sequential order, the offset and the skip are relevant.
            if (this._cycles.length < this.vars.skip)  
            {
		osweb.debug.addError('The value of skip is too high in loop item ' + this.name + '. You cannot skip more cycles than there are.');
            }
            else
            {
		if (this.vars.offset == 'yes')
		{
                    // Get the skip elements.
                    var skip = this._cycles.slice(0, this.vars.skip);
					
                    // Remove the skip elements from the original location.
                    this._cycles = this._cycles.slice(this.vars.skip);

                    // Add the skip element to the end.
                    this._cycles = this._cycles.concat(skip);										
		}
		else
		{
                    this._cycles = this._cycles.slice(this.vars.skip);
		}
            }
	}
		
	// Create a keyboard to flush responses between cycles.
	this._keyboard = new osweb.keyboard(this.experiment);
	
        // Make sure the item to run exists.
	if (this.experiment.items._items[this.vars.item] === 'undefined')
        {
            osweb.debug.addError('Could not find item ' + this.vars.item + ', which is called by loop item ' + this.name);
        }    

        // Inherited.	
	this.item_prepare();
	
	// Set the onset time.
	this.set_item_onset();
    };

    p.run = function()
    {
        // Inherited.	
        this.item_run();

        if (this._cycles.length > 0)
        {
            var exit = false;
            this._index = this._cycles.shift();
            this.apply_cycle(this._index);
		
            if (this._break_if != null)
            {
                this.python_workspace['this'] = this;
                
                var break_if = osweb.syntax.eval_text(this._break_if); 
                
                if (this.python_workspace._eval(break_if) == true)
                {
                    exit = true;
                }	
            }
			
            if (exit == false)
            {
		this.experiment.vars.repeat_cycle = 0;
		
                osweb.item_store.prepare(this.vars.item, this);
                //osweb.item_store.execute(this.vars.item, this);
            }
            else
            {
                // Break the loop.
                this.complete();
            }
        }
        else
        {
            // Break the loop.
            this.complete();
        }
    };	

    p.complete = function()
    {
        // Check if if the cycle must be repeated.
	if (this.experiment.vars.repeat_cycle == 1)
	{
            osweb.debug.msg('repeating cycle ' + this._index);
			
            this._cycles.push(this._index);
            
            if (this.vars.order == 'random')
            {
		this.shuffle(this._cycles);
            }
    	}
        else
        {
            // All items are processed, set the status to finalized.
            this._status = osweb.constants.STATUS_FINALIZE;

            // Inherited.	
            this.item_complete();
        }    
    };

    // Bind the loop class to the osweb namespace.
    osweb.loop = osweb.promoteClass(loop, "item");
}());


/*
 * Definition of the class mouse_response.
 */

(function() 
{
    function mouse_response(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.generic_response_constructor(pExperiment, pName, pScript);

        // Definition of private properties. 
	this._flush = 'yes';
	this._mouse = new osweb.mouse(this.experiment);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(mouse_response, osweb.generic_response);

    // Definition of public properties. 
    p.description = 'Collects mouse responses';
    p.resp_codes  = {};
	
    /*
     * Definition of public methods - build cycle.
     */
	
    p.reset = function()
    {
	// Resets all item variables to their default value.
	this.auto_response          = 1;
	this.process_feedback       = true;
	this.resp_codes             = {};
	this.resp_codes['0']        = 'timeout';
	this.resp_codes['1']        = 'left_button';
	this.resp_codes['2']        = 'middle_button';
	this.resp_codes['3']        = 'right_button';
	this.resp_codes['4']        = 'scroll_up';
	this.resp_codes['5']        = 'scroll_down';
	this.vars.allowed_responses = null;
	this.vars.correct_response  = null;
	this.vars.duration          = 'mouseclick';
	this.vars.flush             = 'yes';
	this.vars.show_cursor       = 'yes';
	this.vars.timeout           = 'infinite';
    };

    /*
     * Definition of public methods - run cycle.
     */

    p.prepare = function()
    {	
	// Set the internal flush property.
	this._flush = (this.vars.flush) ? this.vars.flush : 'yes';
 
        // Inherited.	
	this.generic_response_prepare();
   };

    p.run = function()
    {
	// Inherited.	
	this.generic_response_run();

        // Record the onset of the current item.
	this.set_item_onset(); 
        
	// Show the cursor if defined.
        if (this.vars.show_cursor == 'yes')
	{	
            this._mouse.show_cursor(true);
        }

	// Flush responses, to make sure that earlier responses are not carried over.
	if (this._flush == 'yes')
	{	
            this._mouse.flush();
	}		
    
        this.set_sri();
        this.process_response();
    };

    p.complete = function()
    {
        // Hide the mouse cursor.    
        this._mouse.show_cursor(false);
       
        // Inherited.	
        this.generic_response_complete();
    };

    // Bind the mouse_response class to the osweb namespace.
    osweb.mouse_response = osweb.promoteClass(mouse_response, "generic_response");
}());


/*
 * Definition of the class sampler.
 */

(function() 
{
    function sampler(pExperiment, pName, pScript)
    {
	// Inherited.
	this.generic_response_constructor(pExperiment, pName, pScript);

    	// Definition of private properties.
        this._sample  = null;
        this._sampler = null;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(sampler, osweb.generic_response);

    // Definition of public properties.
    p.block	  = false;
    p.description = 'Plays a sound file in .wav or .ogg format';
    
    /*
     * Definition of public methods - build cycle. 
     */

    p.reset = function()
    {
	// Resets all item variables to their default value.
	this.block           = false;
	this.vars.sample     = '';
	this.vars.pan        = 0;
	this.vars.pitch      = 1;
	this.vars.fade_in    = 0;
	this.vars.stop_after = 0;
	this.vars.volume     = 1;
	this.vars.duration   = 'sound';
    };

    /*
     * Definition of public methods - run cycle. 
     */

    p.prepare = function()
    {
        // Create the sample
	if (this.vars.sample != '')
	{
            // Retrieve the content from the file pool.
            this._sample         = osweb.pool[this.syntax.eval_text(this.vars.sample)];  
            this._sampler        = new osweb.sampler_backend(this.experiment, this._sample);
            this._sampler.volume = this.vars.volume;
	}
	else
	{
            /* raise osexception(
            u'No sample has been specified in sampler "%s"' % self.name) */
	}
    
        // Inherited.	
	this.generic_response_prepare();
    };

    p.run = function()
    {
    	this.set_item_onset();
	this.set_sri();
	this._sampler.play();
	this.process_response();
    };	

    // Bind the sampler class to the osweb namespace.
    osweb.sampler = osweb.promoteClass(sampler, "generic_response");
}());


/*
 * Definition of the class sequence.
 */

(function() 
{
    function sequence(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.item_constructor(pExperiment, pName, pScript);
	
        // Definition of private properties. 
	this._index         = -1;
	this._index_prepare = -1;
        this._items         = null;
        this._keyboard      = null;    
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(sequence, osweb.item);

    // Definition of public properties. 
    p.description    = 'Runs a number of items in sequence';
    p.flush_keyboard = 'yes';
    p.items          = null;
	
    /*
     * Definition of public methods - build cycle.         
     */

    p.reset = function()
    {
	// Resets all item variables to their default value..
	this.items               = [];
	this.vars.flush_keyboard = 'yes';
    };

    p.from_string = function(pString)
    {
	// Parses a definition string.
	this.variables = {};
	this.comments  = [];
	this.reset();
		
	// Split the string into an array of lines.  
	if (pString != null)
	{
            var lines = pString.split('\n');
            for (var i=0; i < lines.length; i++)
            {
		if ((lines[i] != '') && (this.parse_variable(lines[i]) == false))
		{
                    var tokens = osweb.syntax.split(lines[i]);
                    if ((tokens.length > 0) && (tokens[0] == 'run'))
                    {
                        var item = tokens[1];
			var cond = 'always';
			if (tokens.length > 2)
			{
                            cond = tokens[2];
			}	

			// Push the item and condition definition to the items list.
			this.items.push({'item': item, 'cond': cond});
                    }	
            	} 
            }
	}					
    };

    /*
     * Definition of public methods - run cycle.         
     */

    p.prepare = function()
    {
	// Inherited.	
	this.item_prepare();
	
        // Create a keyboard to flush responses at the start of the run phase
	if (this.vars.flush_keyboard == 'yes')
        {	
            this._keyboard = new osweb.keyboard(this.experiment);
        }
        else
        {    
            this._keyboard = null;
        }    
	
        // Generate the items list for the run cycle.
        this._index = 0;
	this._items = [];
        
        // Prepare the items.
        this.prepare_complete();
        
                /* this._items = [];
	for (var i=0; i < this.items.length; i++)
	{
            if ((this.items[i].item in osweb.item_store._items) === false)
            {
		osweb.debug.addError('Could not find item ' + this.items[i].item.name + ' which is called by sequence item ' + this.name);
            }
            else 
            {
                // Prepare the items.
                osweb.item_store.prepare(this.items[i].item);
		
                // Add the item to the internal list.
                this._items.push({'item': this.items[i].item, 'cond': osweb.syntax.compile_cond(this.items[i].cond)});
            }
	} */	
    };
    
    p.prepare_complete = function()
    {
        // Generate the items list for the run cycle.
        if (this._index < this.items.length)
        {
            if ((this.items[this._index].item in osweb.item_store._items) === false)
            {
		osweb.debug.addError('Could not find item ' + this.items[this._index].item.name + ' which is called by sequence item ' + this.name);
            }
            else 
            {
                // Increase the current index.
                this._index++;
                
                // Add the item to the internal list.
                this._items.push({'item': this.items[this._index - 1].item, 'cond': osweb.syntax.compile_cond(this.items[this._index - 1].cond)});
                
                // Prepare the item.
                osweb.item_store.prepare(this.items[this._index - 1].item, this);
	       }
        }
        else
        {
            // Prepare process is done, start execution.
            this._index = 0;
            
            // Remove the prepare phase form the stack.    
            osweb.item_stack.pop();
    
  	    // Execute the next cycle of the sequnce itself.
            osweb.item_store.run(this.name, this._parent);
        }    
    };
    
    p.run = function()
    {
        // Inherited.	
        this.item_run();

        // Check if all items have been processed.
        if (this._index < this._items.length)
        {
            // Flush the keyboard at the beginning of the sequence.
            if ((this._index == 0) && (this.vars.flush_keyboard == 'yes'))
            {
                this._keyboard.flush();
            }

            // Increase the current index.
            this._index++;
            current_item = this._items[this._index - 1]

            // Set the workspace.
            osweb.python_workspace['self'] = this;

            // Check if the item may run.                            
            if (osweb.python_workspace._eval(current_item.cond) == true) 
            {   
                // run the current item of the sequence object.
                osweb.item_store.run(current_item.item, this);
            }
  	    else
  	    {
  	    	// Execute the next cycle of the sequnce itself.
  	    	this.run();	
  	    }
	}
	else
	{
            // sequence is finalized.
            this.complete();
        }
    };
	
    p.complete = function()
    {
        // sequence is finalized.
        this._status = osweb.constants.STATUS_FINALIZE;
 
        // Inherited.	
        this.item_complete();
    };

    // Bind the sequence class to the osweb namespace.
    osweb.sequence = osweb.promoteClass(sequence, "item");
}());

/*
 * Definition of the class sketchpad.
 */

(function() 
{
    function sketchpad(pExperiment, pName, pScript)
    {
	// Set publice properties.
    	this.canvas   = new osweb.canvas(pExperiment, false);
	this.elements = [];

	// Inherited create.
	this.generic_response_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(sketchpad, osweb.generic_response);

    // Definition of public properties. 
    p.canvas   = null;
    p.elements = [];

    /*
     * Definition of private methods - build cycle.         
     */
    
    p._compare = function(a,b) 
    {
        // Sort function used for determining the draw index (z-index) of alle elemente.
        if (a.z_index() < b.z_index())
            return 1;
        else if (a.z_index() > b.z_index())
            return -1;
        else 
            return 0;
    };
    
    /*
     * Definition of public methods - build cycle..         
     */

    p.reset = function()
    {
    	// Resets all item variables to their default value.
    	this.elements      = [];
	this.vars.duration = 'keypress';
    };

    p.from_string = function(pString)
    {
        // Define and reset variables to their defaults.
        this.variables = {};
        this.comments  = [];
 	this.reset();
		
	// Split the string into an array of lines.  
	if (pString != null)
	{
            var lines = pString.split('\n');
            for (var i=0; i < lines.length; i++)
            {
		if ((lines[i] != '') && (this.parse_variable(lines[i]) == false))
		{
                    var tokens = osweb.syntax.split(lines[i]);
                    if ((tokens.length > 0) && (tokens[0] == 'draw'))
                    {
			if (osweb.isClass(tokens[1]) == true)
			{
                            var element = osweb.newElementClass(tokens[1], this, lines[i]);
                            this.elements.push(element);	
			}	
                        else
			{
                            // error.
			}
                    }
		}
            }

            // Sort the elements usin the z-index.
            this.elements.sort(this._compare);
        }					
    };
	
    /*
     * Definition of public methods - runn cycle.         
     */

    p.prepare = function()
    {
        // Draw the elements. 
	for (var i=0; i < this.elements.length; i++)
	{
            if (this.elements[i].is_shown() == true)
            {
		this.elements[i].draw();
            }			
	}				
    
        // Inherited.	
	this.generic_response_prepare();
    };

    p.run = function()
    {
	// Inherited.	
	this.generic_response_run();
		
        // Set the onset and start the stimulus response process.        
	this.set_item_onset(this.canvas.show()); 
	this.set_sri(false);
	this.process_response();
    };
	
    p.complete = function()
    {
	// Clear the canvas.
	this.canvas.clear();
		
	// Inherited.	
	this.generic_response_complete();
    };

    // Bind the sketchpad class to the osweb namespace.
    osweb.sketchpad = osweb.promoteClass(sketchpad, "generic_response");
}());


/*
 * Definition of the class feedback.
 */

(function() 
{
    function feedback(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.sketchpad_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(feedback, osweb.sketchpad);

    // Definition of public properties. 
    p.description = 'Provides feedback to the participant';

    /*
     * Definition of public methods - build cycle.
     */

    p.reset = function()
    {
    	// Resets all item variables to their default value.
	this.sketchpad_reset();
	this.vars.reset_variables = 'yes';
    };	
    
    /*
     * Definition of public methods - run cycle.
     */

    p.prepare = function()
    {
        // Prepares the item.
        this._parent.prepare_complete();
    };

    p.run = function()
    {
    	// Inherited.	
	this.sketchpad_prepare();
	this.sketchpad_run();
    };

    p.complete = function()
    {
    	// Inherited.	
	this.sketchpad_complete();

	// Reset feedback variables.
	if (this.vars.reset_variables == 'yes')
	{
            this.experiment.reset_feedback();
	}
    };

    // Bind the feedback class to the osweb namespace.
    osweb.feedback = osweb.promoteClass(feedback, "sketchpad");
}());


/*
 * Definition of the class synth.
 */

(function() 
{
    function synth(pExperiment, pName, pScript)
    {
	// Inherited.
	this.sampler_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(synth, osweb.sampler);

    // Define and set the public properties. 
    p.description = 'A basic sound synthesizer';

    /*
     * Definition of public class methods.
     */

    // Bind the synth class to the osweb namespace.
    osweb.synth = osweb.promoteClass(synth, "sampler");
}());


/*
 * Definition of the class advanced_delay.
 */

(function() 
{
    function advanced_delay(pExperiment, pName, pScript)
    {
	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
    
        // Set private properties.
        this._duration = -1;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(advanced_delay, osweb.item);

    // Define and set the public properties. 
    p.description = 'Waits for a specified duration';

    /*
     * Definition of public class methods - build cycle.
     */

    p.reset = function()
    {
    	// Resets all item variables to their default value.
	this.vars.duration    = 1000;
	this.vars.jitter      = 0;
	this.vars.jitter_mode = 'Uniform';
    }; 
    
    /*
     * Definition of public class methods - run cycle.
     */

    p.prepare = function()
    {
	this._duration = this.vars.duration;
        /* # Sanity check on the duration value, which should be a positive numeric
	# value.
	if type(self.var.duration) not in (int, float) or self.var.duration < 0:
		raise osexception(
			u'Duration should be a positive numeric value in advanced_delay %s' \
			% self.name)
	if self.var.jitter_mode == u'Uniform':
		self._duration = random.uniform(self.var.duration-self.var.jitter/2,
			self.var.duration+self.var.jitter/2)
	elif self.var.jitter_mode == u'Std. Dev.':
		self._duration = random.gauss(self.var.duration, self.var.jitter)
	else:
		raise osexception(
			u'Unknown jitter mode in advanced_delay %s' % self.name)
	# Don't allow negative durations.
	if self._duration < 0:
		self._duration = 0
	self._duration = int(self._duration)
	self.experiment.var.set(u'delay_%s' % self.name, self._duration)
	debug.msg(u"delay for %s ms" % self._duration) */

        // Inherited.	
	this.item_prepare();
    };
    
    p.run = function() 
    {
        // Inherited.	
    	this.item_run();

        // Set the onset time.
        this.set_item_onset(this.time());
        this.sleep(this._duration);		
    };

    // Bind the advanced_delay class to the osweb namespace.
    osweb.advanced_delay = osweb.promoteClass(advanced_delay, "item");
}());


/*
 * Definition of the class form_base.
 */

(function() 
{
    function form_base(pName, pExperiment, pScript, pItem_type, pDescription)
    {
	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);

        // Set the class private properties.
        this._form_text = false;
    
        // Set the class public properties.
        this.description = pDescription;
        this.item_type   = pItem_type;
    }   
	
    // Extend the class from its base class.
    var p = osweb.extendClass(form_base, osweb.item);

    // Define and set the public properties. 
    p.cols        = [];
    p.description = 'A generic form plug-in';
    p.form        = null;
    p.rows        = [];
    
    /*
     * Definition of public class methods - build cycle.
     */

    p.reset = function() 
    {
      	// Resets all item variables to their default value.
      	this.vars.cols        = '2;2';
    	this.vars.rows        = '2;2';
    	this.vars.spacing     = 10;
    	this.vars._theme      = 'gray';
    	this.vars.only_render = 'no';
    	this.vars.timeout     = 'infinite';
    	this.vars.margins     = '50;50;50;50';
    	this._variables       = [];   
    	this._widgets         = [];
    };    

    p.parse_line = function(pString)
    {
        // Split the line in tokens.
        var list = this.syntax.split(pString);

        if ((this._form_text == true) && (list[0] != '__end__'))
        {
            this.vars['form_text'] = this.vars['form_text'] + pString.replace('\t','');
        };

        // Check for widget definition.
        if (list[0] == 'widget')
        {
            // Remove widget command.
            list.shift();

            // Add widget to the list.
            this._widgets.push(list);
        }
        else if (list[0] == '__form_text__')
        {
            this.vars['form_text'] = '';
            this._form_text        = true;
        }
        else if (list[0] == '__end__')
        {
            this._form_text = false;
        }
        
        /* if u'var' in kwdict:
	 self._variables.append(kwdict[u'var'])   */  
    };

    /*
     * Definition of public class methods - run cycle.
     */

    p.prepare = function()
    {
        // Retrieve the column, rows and margins.
        var cols    = this.vars.cols.split(';');
        var rows    = this.vars.rows.split(';');
        var margins = this.vars.margins.split(';'); 
        
        // Get the time out paramter.
        if (this.vars.timeout == 'infinite')
        {                
            var timeout = null;
        }    
        else
        {    
            var timeout = this.vars.timeout;
        }    
               
        // Create the basic form.    
        this.form = new osweb.form(this.experiment, cols, rows, this.vars.spacing, margins, this.vars._theme, this, timeout, this.vars.form_clicks == 'yes');
        
        for (var i=0;i < this._widgets.length; i++)
        {
            this.focus_widget = null;
            var kwdict = {};
            var parameters = [];
            parameters.push(this.form);
            if (this._widgets[i].length > 5) 
            {
                for (var j=5;j < this._widgets[i].length;j++)
                {
                    var varName  = String(this._widgets[i][j]).substr(0,String(this._widgets[i][j]).indexOf('='));
                    var varValue = String(this._widgets[i][j]).substring(String(this._widgets[i][j]).indexOf('=') + 1,String(this._widgets[i][j]).length);
                    kwdict[varName] = osweb.syntax.remove_quotes(varValue);
                    kwdict[varName] = osweb.syntax.eval_text(kwdict[varName], this.vars);
                
                    parameters.push(osweb.syntax.remove_quotes(varValue));
                } 
            }

            /* # Process focus keyword
            focus = False
            if u'focus' in kwdict:
                if kwdict[u'focus'] == u'yes':
                    focus = True
                del kwdict[u'focus'] */
            
            // Parse arguments
            var _type   = this._widgets[i][4];
            var col     = this._widgets[i][0];
            var row     = this._widgets[i][1];
            var colspan = this._widgets[i][2];
            var rowspan = this._widgets[i][3];
	
            // Create the widget.
            try 
            {
                var _w = osweb.newWidgetClass(_type, this.form, kwdict);
                //console.log(parameters);
                //var _w = osweb.newWidgetClass(_type, parameters);
            }
            catch(e)
            {
                osweb.debug.addError('Failed to create widget ' + _type + ', error:' + e);
            }    
                
            // Set the width position and form.                    
            this.form.set_widget(_w, [col, row], colspan, rowspan);
            
            // Add as focus widget
            if (focus == true) 
            {
            	if (this.focus_widget != null)
                {
                    osweb.debug.addError('Osweb error: You can only specify one focus widget');
                } 
                else
                {
                    this.focus_widget = _w;
                }
            }    
        }

        // Inherited.   
        this.item_prepare();
    };

    p.run = function() 
    {
        // Inherited.	
    	this.item_run();

        console.log(this.form);
        // Set dimensions.
        this.form._parentform.style.width      = osweb.runner._canvas.width;
        this.form._parentform.style.height     = osweb.runner._canvas.height;
        this.form._parentform.style.background = this.experiment.vars.background;
                
        // Hide the canvas, show the form.
        osweb.runner._canvas.style.display  = 'none';
        this.form._parentform.style.display = 'block';
        this.form._form.style.display       = 'block';
    };

    p.complete = function()
    {
        // Hide the form
        this.form._parentform.style.display = 'none';
        this.form._form.style.display       = 'none';
        osweb.runner._canvas.style.display  = 'inline';

        // form is finalized.
        this._status = osweb.constants.STATUS_FINALIZE;

        // Inherited.	
        this.item_complete();
    };

    // Bind the form_base class to the osweb namespace.
    osweb.form_base = osweb.promoteClass(form_base, "item");
}());


/*
 * Definition of the class form_consent.
 */

(function() 
{
    function form_consent(pExperiment, pName, pScript)
    {
        // Inherited.
	this.form_base_constructor(pName, pExperiment, pScript, 'form_consent', 'A simple consent form');
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(form_consent, osweb.form_base);

    // Define and set the public properties. 
    p.description = 'A simple consent form';

    /*
     * Definition of public class methods - run cycle.
     */

    p.run = function() 
    {
        // Inherited.	
    	this.form_base_run();
    };

    p.complete = function()
    {
        // Inherited.	
    	this.form_base_complete();
    };

    // Bind the form_consent class to the osweb namespace.
    osweb.form_consent = osweb.promoteClass(form_consent, "form_base");
}());


/*
 * Definition of the class form_multiple_choice.
 */

(function() 
{
    function form_multiple_choice(pExperiment, pName, pScript)
    {
	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(form_multiple_choice, osweb.item);
    
    // Define and set the public properties. 
    p.description = 'A simple multiple choice item';

    // Bind the form_base class to the osweb namespace.
    osweb.form_multiple_choice = osweb.promoteClass(form_multiple_choice, "item");
}());


/*
 * Definition of the class form_text_display.
 */

(function() 
{
    function form_text_display(pExperiment, pName, pScript)
    {
        // Inherited.
	this.form_base_constructor(pName, pExperiment, pScript, 'form_text_display', 'A simple text display form');
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(form_text_display, osweb.form_base);

    // Define and set the public properties. 
    p.description = 'A simple text display form';

    /*
     * Definition of public class methods - run cycle.
     */

    p.run = function() 
    {
        // Inherited.	
    	this.form_base_run();
     };

    p.complete = function()
    {
        // Inherited.	
    	this.form_base_complete();
    };

    // Bind the form_text_display class to the osweb namespace.
    osweb.form_text_display = osweb.promoteClass(form_text_display, "form_base");
}());


/*
 * Definition of the class form_text_input.
 */

(function() 
{
    function form_text_input(pExperiment, pName, pScript)
    {
	// Inherited.
	this.form_base_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(form_text_input, osweb.form_base);

    // Define and set the public properties. 
    p.description = 'A simple text input form';

    // Bind the form_base class to the osweb namespace.
    osweb.form_text_input = osweb.promoteClass(form_text_input, "form_base");
}());


/*
 * Definition of the class form_text_render.
 */

(function() 
{
    function form_text_render(pExperiment, pName, pScript)
    {
	// Inherited.
	this.form_base_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(form_text_render, osweb.form_base);

    // Define and set the public properties. 
    p.description = 'A simple text display form';

    // Bind the form_base class to the osweb namespace.
    osweb.form_text_render = osweb.promoteClass(form_text_render, "form_base");
}());


/*
 * Definition of the class media_player_vlc.
 */

(function() 
{
    function media_player_vlc(pExperiment, pName, pScript)
    {
	// Inherited.
	this.generic_response_constructor(pExperiment, pName, pScript);
    
        // Define and set the private properties. 
        this._script_executed = false;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(media_player_vlc, osweb.generic_response);

    // Define and set the public properties. 
    p.description = 'A video player';

    /*
     * Definition of public class methods - run cycle.
     */

    p.prepare = function()
    {
        // Opens the video file for playback.
        this._video        = osweb.pool[this.vars.get('video_src')];  
        this._video_player = new osweb.video_backend(this.experiment, this._video);
        
        // Set the inline code options.
        if (this.vars.event_handler !== '')
        {
            this._video_player._script = osweb.parser._prepare(this.vars.event_handler);
        }
        this._video_player._event_handler_always = (this.vars.event_handler_trigger == 'after every frame');
		
        // Set the audio option.
        this._video_player.audio = (this.vars.get('playaudio') == 'yes');
        
        // Set the full screen option (if enabled).
        this._video_player.full_screen = (this.vars.get('resizeVideo') == 'yes');
	
      	// Inherited.	
	this.generic_response_prepare();
    };    
    
    p.run = function() 
    {
        // Set the onset time.
        this.set_item_onset();
	this.set_sri();

        // Start the video player.
        this._video_player.play();    

        // Start response processing.
        this.process_response();
    };

    p.complete = function() 
    {
        if (this._script_executed == false)
        {
            // Stop the video playing.  
            this._video_player.stop();
	
            // execute script.
            if ((this._video_player._script !== null) && (this.vars.get('event_handler_trigger') == 'on keypress'))
            {
                // Set the execute toggle.
                this._script_executed = true;
            
                // Execute the script code.
                osweb.parser._run(this, this._video_player._script);
            }   
            else
            {    
                // Inherited.	
                this.generic_response_complete();
            }
        }
        else
        {
            // Inherited.	
            this.generic_response_complete();
        };    
    };    

    p.update = function()
    {
        // Update the video canvas.
        this._video_player._update_video_canvas();
    };
    
    // Bind the media_player_vlc class to the osweb namespace.
    osweb.media_player_vlc = osweb.promoteClass(media_player_vlc, "generic_response");
}());


/*
 * Definition of the class notepad.
 */

(function() 
{
    function notepad(pExperiment, pName, pScript)
    {
	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(notepad, osweb.item);

    // Define and set the public properties. 
    p.description = 'A simple notepad to document your experiment. This plug-in does nothing.';
    p.note        = '';

    /*
     * Definition of public class methods - run cycle.
     */

    p.run = function() 
    {
        // Inherited.	
    	this.item_run();

	// Show the information of the notepad on the console.
	//osweb.debug.addMessage(this.note);

        // Complete the current cycle.
        this.complete();
    };

    p.complete = function()
    {
        // sequence is finalized.
        this._status = osweb.constants.STATUS_FINALIZE;
 
        // Inherited.	
        this.item_complete();
    };

    // Bind the notepad class to the osweb namespace.
    osweb.notepad = osweb.promoteClass(notepad, "item");
}());


/*
 * Definition of the class repeat_cycle.
 */

(function() 
{
    function repeat_cycle(pExperiment, pName, pScript)
    {
    	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(repeat_cycle, osweb.item);

   // Define and set the public properties. 
    p.description = 'Optionally repeat a cycle from a loop';
    
    /*
     * Definition of public class methods - run cycle.
     */

    p.prepare = function()
    {
        // Prepare the condtion for which the repeat_cycle must fire.
        this._condition = osweb.syntax.compile_cond(this.vars.get('condition'));

        // Inherited.	
	this.item_prepare();
    }; 

    p.run = function()
    {
    	// Inherited.	
	this.item_run();
		
	// Run item only one time.   
	if (this._status != osweb.constants.STATUS_FINALIZE)
        {
            if (osweb.python_workspace._eval(this._condition) == true) 
            {            
                this.experiment.vars.repeat_cycle = 1;
            }
            
            // Complete the current cycle.
            this.complete();
        }
    };

    p.complete = function()
    {
        // sequence is finalized.
        this._status = osweb.constants.STATUS_FINALIZE;
 
        // Inherited.	
        this.item_complete();
    };
    
    // Bind the repeat_cycle class to the osweb namespace.
    osweb.repeat_cycle = osweb.promoteClass(repeat_cycle, "item");
}());


/*
 * Definition of the class reset_feedback.
 */

(function() 
{
    function reset_feedback(pExperiment, pName, pScript)
    {
    	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(reset_feedback, osweb.item);

    // Define and set the public properties. 
    p.description = 'Resets the feedback variables, such as "avg_rt" and "acc"';

    /*
     * Definition of public class methods - run cycle.
     */

    p.run = function()
    {
    	// Inherited.	
	this.item_run();
		
	// Run item only one time.   
	if (this._status != osweb.constants.STATUS_FINALIZE)
	{
            // Run the item.
            this.experiment.reset_feedback();

            // Complete the current cycle.
            this.complete();
        }
    };

    p.complete = function()
    {
        // sequence is finalized.
        this._status = osweb.constants.STATUS_FINALIZE;
 
        // Inherited.	
        this.item_complete();
    };
    
    // Bind the reset_feedback class to the osweb namespace.
    osweb.reset_feedback = osweb.promoteClass(reset_feedback, "item");
}());


/*
 * Definition of the class touch_response.
 */

(function() 
{
    function touch_response(pExperiment, pName, pScript)
    {
	// Inherited.
	this.mouse_response_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(touch_response, osweb.mouse_response);

    // Define and set the public properties. 
    p.description = 'A grid-based response item, convenient for touch screens';

    /*
     * Definition of public methods - build cycle.
     */
	
    p.reset = function()
    {
        // Inherited.
        this.mouse_response_reset();
        this.vars.set('allowed_responses',null);
	
        // Resets all item variables to their default value.
        this.vars._ncol = 2;
	this.vars._nrow = 1;
    };

    /*
     * Definition of public methods - run cycle.
     */
    
    p.prepare = function()
    {
        // Temp hack
        this.experiment.vars.correct = -1;
   
        // Inherited.
        this.mouse_response_prepare();
    };
        
    p.process_response_mouseclick = function(pRetval)
    {
        // Processes a mouseclick response.
	this.experiment._start_response_interval = this.sri;
	this.experiment._end_response_interval   = pRetval.rtTime;
	this.experiment.vars.response		 = pRetval.resp;
	this.synonyms                            = this._mouse.synonyms(this.experiment.vars.response);
	this.experiment.vars.cursor_x            = pRetval.event.clientX;
	this.experiment.vars.cursor_y            = pRetval.event.clientY;
	
        var rect = osweb.runner._canvas.getBoundingClientRect();
        if (this.experiment.vars.uniform_coordinates == 'yes')
        {
            this._x = pRetval.event.clientX + (this.experiment.vars.width / 2);
	    this._y = pRetval.event.clientY + (this.experiment.vars.height / 2);
        }
        else
        {
            this._x = pRetval.event.clientX - rect.left;
	    this._y = pRetval.event.clientY - rect.top;
        }    
        
        // Calulate the row, column and cell. 
        this.col  = Math.floor(this._x / (this.experiment.vars.width  / this.vars._ncol));
	this.row  = Math.floor(this._y / (this.experiment.vars.height / this.vars._nrow));
	this.cell = this.row * this.vars._ncol + this.col + 1;
        this.experiment.vars.response = this.cell;
        this.synonyms                 = [String(this.experiment.vars.response)];
                
        // Do the bookkeeping 
        this.response_bookkeeping();
    };            

    // Bind the touch_response class to the osweb namespace.
    osweb.touch_response = osweb.promoteClass(touch_response, "mouse_response");
}());


/*
 * Definition of the class base_element.
 */

(function() 
{
    function base_element(pSketchpad, pScript, pDefaults)
    {
	// Set the public properties.		
	this.canvas           = pSketchpad.canvas;
	this.defaults         = pDefaults;
	this.defaults.show_if = 'always';
	this.defaults.z_index = 0;
        this.experiment       = pSketchpad.experiment;
	this.fix_coordinates  = (pSketchpad.vars.uniform_coordinates == 'yes');
	this.name             = pSketchpad.name;
	this.only_keywords    = false;
	this.pool             = pSketchpad.experiment.pool;
	this.sketchpad        = pSketchpad;
	this.syntax           = pSketchpad.syntax;
	this.vars             = pSketchpad.vars;

        // Set the private properties.		
        this._properties      = null;   

        // Read the definition string.
	this.from_string(pScript);
    }; 
	
    // Extend the class from its base class.
    var p = base_element.prototype;

    // Set the class public properties. 
    p.defaults        = {};
    p.fix_coordinates = true;
    p.only_keywords   = false;
    p.properties      = {};
    p.sketchpad       = null;	
    p.vars            = null;
	        	
    /*
     * Definition of public methods - building cycle.         
     */

    p.from_string = function(pString)
    {
	var tokens = osweb.syntax.parse_cmd(pString);
	
	// Set the default properties.
	this.properties = {};
			
	// Set the define properties.
	for (var i=0; i < tokens.length; i++)
	{
            var name  = tokens[i].slice(0,tokens[i].indexOf('='));
            var value = tokens[i].slice(tokens[i].indexOf('=') + 1,tokens[i].length);
            var value = osweb.syntax.remove_quotes(value);
			
            // Set (and overwrite) the properties.
            this.properties[name] = value;
	}
    };

    /*
     * Definition of public methods - running cycle.         
     */

    p.z_index = function()
    {
    	//  Determines the drawing order of the elements. 
    	return this.properties.z_index;
    };

    p.eval_properties = function()
    {
	// Evaluates all properties and return them.
	this._properties = {};
		
	var xc = this.experiment.vars.width / 2;
	var yc = this.experiment.vars.height / 2;

    	for (var property in this.properties) 
	{
            var value = this.sketchpad.syntax.eval_text(this.properties[property]);
            /* if var == u'text':
			round_float = True
                else:
			round_float = False
		val = self.sketchpad.syntax.auto_type(
			self.sketchpad.syntax.eval_text(val, round_float=round_float))
		if self.fix_coordinates and type(val) in (int, float): */
            if ((property  == 'x') || (property  == 'x1') || (property  == 'x2'))
            {
            	value = Number(value) + xc;
            };
            if ((property  == 'y') || (property  == 'y1') || (property  == 'y2'))
            {
		value = Number(value) + yc;
            };

            this._properties[property] = value; 
	}
    };		
		
    p.is_shown = function()
    {
        // Set the self of the current workspace.
        this.experiment.python_workspace['self'] = this.sketchpad;
        
        // Determines whether the element should be shown, based on the show-if statement.
	return this.experiment.python_workspace._eval(this.experiment.syntax.compile_cond(this.properties['show_if']));
    };
	
    p.draw = function()
    {
        // Calculate the dynamic properties.
        this.eval_properties();
    };

    // Bind the base_element class to the osweb namespace.
    osweb.base_element = base_element;
}());


/*
 * Definition of the class arrow.
 */

(function() 
{
    function arrow(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults		        = {};
	this.defaults.arrow_body_length = 0.8;
	this.defaults.arrow_body_width  = 0.5;
	this.defaults.arrow_head_width  = 30;
	this.defaults.fill     		= 1;
	this.defaults.color    		= pSketchpad.vars.get('foreground');
	this.defaults.penwidth 		= 1;
	this.defaults.x1       		= null;
	this.defaults.y1       		= null;
	this.defaults.x2                = null;
	this.defaults.y2       		= null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(arrow, osweb.base_element);

    /*
     * Definition of public methods - run cycle.   
     */

    p.draw = function()
    {
        // Inherited.	
	this.base_element_draw();
		
	// Draw the arrow element to the canvas of the sketchpad.
	this.sketchpad.canvas.arrow(this._properties.x1, this._properties.y1, this._properties.x2, this._properties.y2, this._properties.color, this._properties.penwidth, 
                                    this._properties.arrow_head_width, this._properties.arrow_body_width, this._properties.arrow_body_length, this._properties.fill);
    };
    
    // Bind the Arrow class to the osweb namespace.
    osweb.arrow = osweb.promoteClass(arrow, "base_element");
}());


/*
 * Definition of the class circle.
 */

(function() 
{
    function circle(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults          = {};
	this.defaults.color    = pSketchpad.vars.get('foreground');
	this.defaults.fill     = 0;
	this.defaults.penwidth = 1;
	this.defaults.x        = null;
	this.defaults.y        = null;
	this.defaults.r        = null;
		
	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(circle, osweb.base_element);

    /*
     * Definition of public methods - run cycle.   
     */
	
    p.draw = function()
    {
        // Inherited.	
	this.base_element_draw();
		
	// Draw the circle element to the canvas of the sketchpad.
	this.sketchpad.canvas.circle(this._properties.x, this._properties.y, this._properties.r, this._properties.fill, this._properties.color, this._properties.penwidth);
    };
    
    // Bind the Circle class to the osweb namespace.
    osweb.circle = osweb.promoteClass(circle,"base_element");
}());


/*
 * Definition of the class ellipse.
 */

(function() 
{
    function ellipse(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults          = {};
	this.defaults.fill     = 1;
	this.defaults.color    = pSketchpad.vars.get('foreground');
	this.defaults.penwidth = 1;
	this.defaults.x        = null;
	this.defaults.y        = null;
	this.defaults.w        = null;
	this.defaults.h        = null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(ellipse, osweb.base_element);

    /*
     * Definition of public methods - run cycle.   
     */
	
    p.draw = function()
    {
        // Inherited.	
	this.base_element_draw();
		
	// Draw the ellipse element to the canvas of the sketchpad.
        this.sketchpad.canvas.ellipse(Number(this._properties.x), Number(this._properties.y), Number(this._properties.w), Number(this._properties.h), 
                                      this._properties.fill, this._properties.color, this._properties.penwidth);
    };
    
    // Bind the ellipse class to the osweb namespace.
    osweb.ellipse = osweb.promoteClass(ellipse,"base_element");
}());


/*
 * Definition of the class fixdot.
 */

(function() 
{
    function fixdot(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults          = {};
	this.defaults.color    = pSketchpad.vars.get('foreground');
	this.defaults.style    = 'default';
	this.defaults.x        = null;
	this.defaults.y        = null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(fixdot, osweb.base_element);

    /*
     * Definition of public methods - running cycle.         
     */
	
    p.draw = function()
    {
        // Inherited.	
	this.base_element_draw();
		
	// Draw the fixdot element to the canvas of the sketchpad.
	this.sketchpad.canvas.fixdot(this._properties.x, this._properties.y, this._properties.color, this._properties.style);
    };
    
    // Bind the fixdot class to the osweb namespace.
    osweb.fixdot = osweb.promoteClass(fixdot,"base_element");
}());


/*
 * Definition of the class gabor.
 */

(function() 
{
    function gabor(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults        = {};
	this.defaults.bgmode = 'avg';
	this.defaults.color1 = 'white';
	this.defaults.color2 = 'black';
	this.defaults.env    = 'gaussian';
	this.defaults.freq   = 1;
	this.defaults.orient = 0;
	this.defaults.phase  = 0;
	this.defaults.size   = 96;
	this.defaults.stdev  = 12;
	this.defaults.x      = null;
	this.defaults.y      = null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(gabor, osweb.base_element);

    /*
     * Definition of public methods (run cycle).   
     */

    p.draw = function()
    {
        // Inherited.	
    	this.base_element_draw();
		
	// Draw the gabor element to the canvas of the sketchpad.
	this.sketchpad.canvas.gabor(this._properties.x, this._properties.y, this._properties.orient, this._properties.freq, this._properties.env, 
                                    this._properties.size, this._properties.stdev, this._properties.phase, this._properties.color1, this._properties.color2, this._properties.bgmode);
    };
    
    // Bind the gabor class to the osweb namespace.
    osweb.gabor = osweb.promoteClass(gabor,"base_element");
}());


/*
 * Definition of the class image.
 */

(function() 
{
    function image(pSketchpad, pScript)
    {
	// Set the class public properties.
	this.defaults	     = {};
	this.defaults.center = 1;
	this.defaults.file   = null;
	this.defaults.scale  = 1;
	this.defaults.x      = null;
	this.defaults.y      = null;

	// Set the class private properties. 
	this._file           = null;
		
	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(image, osweb.base_element);

    /*
     * Definition of public methods - run cycle.   
     */

    p.draw = function()
    {
        // Inherited.	
	this.base_element_draw();

    	// Retrieve the content from the file pool.
	this._file = osweb.pool[this._properties['file']];  

	// Draw the image element to the canvas of the sketchpad.
	this.sketchpad.canvas.image(this._file, this._properties.center, this._properties.x, this._properties.y, this._properties.scale);
    };
    
    // Bind the image class to the osweb namespace.
    osweb.image = osweb.promoteClass(image, "base_element");
}());


/*
 * Definition of the class line.
 */

(function() 
{
    function line(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults          = {};
	this.defaults.color    = pSketchpad.vars.get('foreground');
	this.defaults.penwidth = 1;
	this.defaults.x1       = null;
	this.defaults.y1       = null;
	this.defaults.x2       = null;
	this.defaults.y2       = null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 

    // Extend the class from its base class.
    var p = osweb.extendClass(line, osweb.base_element);

    /*
     * Definition of public methods - run cycle.   
     */
	
    p.draw = function()
    {
        // Inherited.	
	this.base_element_draw();
		
	// Draw the line element to the canvas of the sketchpad.
	this.sketchpad.canvas.line(this._properties.x1, this._properties.y1, this._properties.x2, this._properties.y2, 
                                   this._properties.color, this._properties.penwidth);
    };
        
    // Bind the line class to the osweb namespace.
    osweb.line = osweb.promoteClass(line,"base_element");
}());


/*
 * Definition of the class noise.
 */

(function() 
{
    function noise(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults	     = {};
	this.defaults.color1 = 'white';
	this.defaults.color2 = 'black';
	this.defaults.env    = 'gaussian';
	this.defaults.size   = 96;
	this.defaults.stdev  = 12;
	this.defaults.x      = null;
	this.defaults.y      = null;
	this.defaults.bgmode = 'avg';

        // Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(noise, osweb.base_element);

    /*
     * Definition of public methods (run cycle).   
     */

    p.draw = function()
    {
        // Inherited.	
    	this.base_element_draw();
		
	// Draw the noise element to the canvas of the sketchpad.
	this.sketchpad.canvas.noise(this._properties.x, this._properties.y, this._properties.env, this._properties.size, 
                                    this._properties.stdev, this._properties.color1, this._properties.color2, this._properties.bgmode);
    };
    
    // Bind the noise class to the osweb namespace.
    osweb.noise = osweb.promoteClass(noise,"base_element");
}());


/*
 * Definition of the class rect.
 */

(function() 
{
    function rect(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults          = {};
	this.defaults.fill     = 1;
	this.defaults.color    = pSketchpad.vars.get('foreground');
	this.defaults.penwidth = 1;
	this.defaults.x        = null;
	this.defaults.y        = null;
	this.defaults.w        = null;
	this.defaults.h        = null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(rect, osweb.base_element);
	
    /*
     * Definition of public methods - run cycle.   
     */

    p.draw = function()
    {
        // Inherited.	
    	this.base_element_draw();
		
	// Draw the rectangle element to the canvas of the sketchpad.
	this.sketchpad.canvas.rect(this._properties.x, this._properties.y, this._properties.w, this._properties.h, 
                                   this._properties.fill, this._properties.color, this._properties.penwidth);
    };
    
    // Bind the Rect class to the osweb namespace.
    osweb.rect = osweb.promoteClass(rect,"base_element");
}());


/*
 * Definition of the class textline.
 */

(function() 
{
    function textline(pSketchpad, pScript)
    {
        // Set the default properties.
	this.defaults             = {};
	this.defaults.center      = 1;
	this.defaults.color       = pSketchpad.vars.get('foreground');
	this.defaults.font_family = pSketchpad.vars.get('font_family');
	this.defaults.font_size   = pSketchpad.vars.get('font_size');
	this.defaults.font_bold   = pSketchpad.vars.get('font_bold');
	this.defaults.font_italic = pSketchpad.vars.get('font_italic');
	this.defaults.html        = 'yes';
	this.defaults.text        = null;
	this.defaults.x           = null;
	this.defaults.y           = null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(textline, osweb.base_element);
	
    /*
     * Definition of public methods - running cycle.         
     */

    p.draw = function()
    {
        // Inherited.	
    	this.base_element_draw();
		
    	// Set the font style and draw the text element to the canvas of the sketchpad.
	this.sketchpad.canvas.set_font(this._properties.font_family, this._properties.font_size, this._properties.font_italic == 'yes', this._properties.font_bold == 'yes', this._properties.font_underline == 'yes');		
        this.sketchpad.canvas.text(this._properties.text, this._properties.center, this._properties.x, this._properties.y, this._properties.color, this._properties.html);
    };
    
    // Bind the Text class to the osweb namespace.
    osweb.textline = osweb.promoteClass(textline, "base_element");
}());

	
/*
 * Definition of the class form.
 */

(function() 
{
    function form(pExperiment, pCols, pRows, pSpacing, pMargins, pTheme, pItem, pTimeout, pClicks)
    {
        // Set the class public properties.
        this.clicks     = pClicks;
	this.experiment = pExperiment;
	this.height     = this.experiment.vars.height;
	this.item       = (pItem != null) ? pItem : pExperiment;
	this.margins    = pMargins;
        this.spacing    = pSpacing;
	this.span       = [];
        this.timeout    = pTimeout;
	this.widgets    = []; 
        this.width      = this.experiment.vars.width;
        
        // Set the class public properties - columns and rows.
        var colSize = 0;
        for (var i=0;i < pCols.length;i++)
        {
            colSize = colSize + Number(pCols[i]);
        }
        this.cols = [];
        for (var i=0;i < pCols.length;i++)
        {
            this.cols.push(Math.round((pCols[i] / colSize) * 100));
        }    
        var rowSize = 0;
        for (var i=0;i < pRows.length;i++)
        {
            rowSize = rowSize + Number(pRows[i]);
        }
        this.rows = [];
        for (var i=0;i < pRows.length;i++)
        {
            this.rows.push(Math.round((pRows[i] / rowSize) * 100));
        }

        // Set the class private properties.
        this._parentform         = document.getElementById('osweb_form');
        this._form               = document.createElement("DIV");
        this._form.style.height  = '100%';
        this._form.style.width   = '100%';
        this._form.style.display = 'none';
        
        // Set the table properties and content.
        this._table                  = document.createElement("TABLE");
        this._table.style.padding    = this.margins[0] + 'px ' + this.margins[1] + 'px ' + this.margins[2] + 'px ' + this.margins[3] + 'px';
        this._table.style.height     = '100%';
        this._table.style.width      = '100%';
        this._table.style.fontStyle  = this.experiment.vars.font_italic == 'yes' ? 'italic' : 'normal'; 
        this._table.style.fontWeight = this.experiment.vars.font_bold   == 'yes' ? 'bold'   : 'normal'; 
        this._table.style.fontFamily = this.experiment.vars.font_family;
        this._table.style.color      = this.experiment.vars.foreground;
        this._table.style.fontSize   = this.experiment.vars.font_size + 'px';
        
        for (var i=0;i < this.rows.length;i++)
        {
            // Insert the row into the table.
            var row          = this._table.insertRow();
            row.style.height = this.rows[i] + '%';
            
            // Inser the cells.
            for (var j=0;j < this.cols.length;j++)
            {
                var cell = row.insertCell(j);
                cell.style.width   = this.cols[j] + '%';
                cell.style.padding = '5px';
            }    
        }        

        // Append the table to the form.
        this._parentform.appendChild(this._form);
        this._form.appendChild(this._table);
        
        // Dynamically load the theme object
	/* theme_mod = __import__(u'libopensesame.widgets.themes.%s' % theme, fromlist=[u'dummy'])
	theme_cls = getattr(theme_mod, theme)
	self.theme_engine = theme_cls(self) */
    } 
	
    // Extend the class from its base class.
    var p = form.prototype;

    // Definition of class public properties. 
    p.clicks     = null;
    p.experiment = null;
    p.height     = -1;
    p.item       = null;
    p.spacing    = null;
    p.timeout    = -1;
    p.width      = -1;
    
    /*
     * Definition of public methods - general function.
     */

    p._exec = function(pFocus_widget)
    {
    };   

    p.timed_out = function()
    {
    };

    p.cell_index = function(pPos)
    {
    };

    p.validate_geometry = function()
    {
    };

    p.get_cell = function(pIndex)
    {
    };
    
    p.get_rect = function(pIndex)
    {
    };

    p.render = function()
    {
	this.validate_geometry();
	this.canvas.clear();
	for (var widget in this.widgets)
	{
            if (widget !== null)
            {
                widget.render();
            }    
        }		
        
        this.canvas.show();
    };    

    p.set_widget = function(pWidget, pPos, pColspan, pRowspan)
    {
        // Get the row postition of the widget.
        var row  = this._table.rows[Number(pPos[1])];
        var cell = row.cells[Number(pPos[0])]; 
        if (Number(pColspan) > 1)
        {
            cell.colSpan = Number(pColspan);
        }
        if (Number(pRowspan) > 1)
        {
            cell.rowSpan = Number(pRowspan);
        }
        
        // Append widget to the cell.
        cell.appendChild(pWidget._element);
        
        /* var index = this.cell_index(nPos;)
	if (index >= len(this.widgets)
        {
            // raise osexception(u'Widget position (%s, %s) is outside of the form' % pos)
        }
        if type(colspan) != int or colspan < 1 or colspan > len(self.cols):
			raise osexception( \
				u'Column span %s is invalid (i.e. too large, too small, or not a number)' \
				% colspan)
		if type(rowspan) != int or rowspan < 1 or rowspan > len(self.rows):
			raise osexception( \
				u'Row span %s is invalid (i.e. too large, too small, or not a number)' \
				% rowspan) 
	this.widgets[index] = widget;
	this.span[index]    = colspan, rowspan
        this.widget.set_rect(this.get_rect(index)) */
    };

    p.xy_to_index = function(pXy)
    {
    };
  
    // Bind the form class to the osweb namespace.
    osweb.form = form;
}());

	
/*
 * Definition of the class widget.
 */

(function() 
{
    function widget(pForm)
    {
        // Set the class public properties.
	this.focus = false;
	this.form  = pForm;
	this.rect  = null;
	this.type  = 'widget';
	this.vars  = null;
    } 
	
    // Extend the class from its base class.
    var p = widget.prototype;

    // Definition of class public properties. 
    p.form  = null;
    p.focus = false;
    p.rect  = null;
    p.type  = '';	
    p.vars  = null;

    /*
     * Definition of public methods - general function.
     */

    p.box_size = function()
    {
        return null;
    };            

    p.theme_engine = function()
    {
        return null;
    };
    
    p.draw_frame = function(pRect, pStyle)
    {
    };    

    p.on_mouse_click = function(pevent)
    {
    };        

    p.render = function()
    {
    };

    p.set_rect = function(pRect)
    {
    };
    
    p.set_var = function(pVal, pVar)
    {
        // Sets an experimental variable.
        if (pVar == null)
        {
            pVar = this.vars;
        }    
	
        if (pVar != null)
        {
            this.form.experiment.vars.set(pVar, pVal);  
        }  
    };    
    
    // Bind the widget class to the osweb namespace.
    osweb.widget = widget;
}());


/*
 * Definition of the class button.
 */

(function() 
{
    function button(pForm, pProperties)
    {
	// Inherited create.
	this.widget_constructor(pForm);
	
        // Set the class private properties.
        this._element = document.createElement("BUTTON");
        this._element.style.width  = '100%';
        this._element.style.height = '100%';
        this._element.textContent = pProperties['text'];
        this._element.style.fontStyle  = this.form.experiment.vars.font_italic == 'yes' ? 'italic' : 'normal'; 
        this._element.style.fontWeight = this.form.experiment.vars.font_bold   == 'yes' ? 'bold'   : 'normal'; 
        this._element.style.fontFamily = this.form.experiment.vars.font_family;
        this._element.style.color      = this.form.experiment.vars.foreground;
        this._element.style.fontSize   = this.form.experiment.vars.font_size + 'px';

        // Add event listener to the element.
        this._element.addEventListener("click", this.response.bind(this));

        // Set the class public properties.
	this.center  = (typeof pProperties['center'] == 'boolean') ? pProperties['center'] : false; 
        this.frame   = (typeof pProperties['frame']  == 'boolean') ? pProperties['frame']  : false; 
        this.tab_str = '    ';
	this.type    = 'button';
	this.x_pad   = 8;
	this.y_pad   = 8;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(button, osweb.widget);

    // Definition of public properties. 
    p.center  = false;
    p.frame   = null;
    p.tab_str = '';
    p.text    = '';
    p.x_pad   = 0;
    p.y_pad   = 0;

    /*
     * Definition of public class methods - build cycle.
     */

    p.response = function(event)
    {
        console.log(this);
        // Complete the parent form.
        this.form.item.complete();
    };

    p.draw_text = function(pText, pHtml)
    {
        // Draws text inside the widget.
	pText = this.form.experiment.syntax.eval_text(pText);
	pText = safe_decode(pText).replace('\t', this.tab_str);

        if (this.center == true)
        {
            var x = this.rect.x + this.rect.w / 2;
            var y = this.rect.y + this.rect.h / 2;
        }  
        else
        {        
            var x = this.rect.x + this.x_pad;
            var y = this.rect.y + this.y_pad;
        }
        
        var w = this.rect.w - 2 * this.x_pad;
        
	this.form.canvas.text(pText, this.center, x, y, w, pHtml);
    };    

    p.render = function()
    {
	// Draws the widget.
        if (this.frame == true)
        {    
            this.draw_frame(this.rect);
        }
        
        this.draw_text(this.text); 
    };            
                
    // Bind the button class to the osweb namespace.
    osweb.button = osweb.promoteClass(button, "widget");
}());


/*
 * Definition of the class checkbox.
 */

(function() 
{
    function checkbox(pForm, pProperties)
    {
	// Inherited create.
	this.widget_constructor(pForm);
	
        // Set the class private properties.
        this._element       = document.createElement("LABEL"); 
        this._element_check = document.createElement("INPUT");
        this._element_check.setAttribute("type", "checkbox");
        this._element.style.width      = '100%';
        this._element.style.height     = '100%';
        this._element.textContent        = pProperties['text'];
        
        //this._element.innerHTML        = pProperties['text'];
        this._element.style.fontStyle  = this.form.experiment.vars.font_italic == 'yes' ? 'italic' : 'normal'; 
        this._element.style.fontWeight = this.form.experiment.vars.font_bold   == 'yes' ? 'bold'   : 'normal'; 
        this._element.style.fontFamily = this.form.experiment.vars.font_family;
        this._element.style.color      = this.form.experiment.vars.foreground;
        this._element.style.fontSize   = this.form.experiment.vars.font_size + 'px';
        this._element.appendChild(this._element_check);

        // Add event listener to the element.
        this._element.addEventListener("click", this.on_mouse_click.bind(this));

        console.log('---');
        console.log(pProperties);

        // Set the class public properties.
	this.click_accepts = (typeof pProperties.click_accepts === 'undefined') ? false : pProperties.click_accepts;
	this.group         = (typeof pProperties.group === 'undefined') ? null : pProperties.group;
	this.type          = 'checkbox';
        this.var           = (typeof pProperties.var === 'undefined') ? null : pProperties.var;
        this.checked       = (typeof pProperties.checked === 'checked') ? false  : pProperties.checked;
        
        // Set the current status of the checkbox.
        this.set_var(this.checked);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(checkbox, osweb.widget);

    // Definition of public properties. 
    p.center  = false;
    p.frame   = null;
    p.tab_str = '';
    p.text    = '';
    p.x_pad   = 0;
    p.y_pad   = 0;

    /*
     * Definition of public class methods.
     */

    p.on_mouse_click = function(event)
    {
       console.log('checkbox clicked'); 
    
    };
                
    // Bind the checkbox class to the osweb namespace.
    osweb.checkbox = osweb.promoteClass(checkbox, "widget");
}());


/*
 * Definition of the class label.
 */

(function() 
{
    function label(pForm, pProperties)
    {
	// Inherited create.
	this.widget_constructor(pForm);
	
        // Set the class private properties.
        this._element = document.createElement("SPAN");
        this._element.innerHTML = pProperties['text'];
        
        // Set the class public properties.
	this.center  = (typeof pProperties['center'] == 'boolean') ? pProperties['center'] : false; 
        this.frame   = (typeof pProperties['frame']  == 'boolean') ? pProperties['frame']  : false; 
        this.tab_str = '    ';
	this.type    = 'label';
	this.x_pad   = 8;
	this.y_pad   = 8;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(label, osweb.widget);

    // Definition of public properties. 
    p.center  = false;
    p.frame   = false;
    p.tab_str = '';
    p.text    = '';
    p.x_pad   = 0;
    p.y_pad   = 0;

    /*
     * Definition of public class methods - build cycle.
     */

    p.draw_text = function(pText, pHtml)
    {
        // Draws text inside the widget.
	pText = this.form.experiment.syntax.eval_text(pText);
	pText = safe_decode(pText).replace('\t', this.tab_str);

        if (this.center == true)
        {
            var x = this.rect.x + this.rect.w / 2;
            var y = this.rect.y + this.rect.h / 2;
        }  
        else
        {        
            var x = this.rect.x + this.x_pad;
            var y = this.rect.y + this.y_pad;
        }
        
        var w = this.rect.w - 2 * this.x_pad;
        
	this.form.canvas.text(pText, this.center, x, y, w, pHtml);
    };    

    p.render = function()
    {
	// Draws the widget.
        if (this.frame == true)
        {    
            this.draw_frame(this.rect);
        }
        
        this.draw_text(this.text); 
    };            
                
    // Bind the label class to the osweb namespace.
    osweb.label = osweb.promoteClass(label, "widget");
}());


(function() {
    // Class events - processing all user and system evens within osweb.
    function events() {
    	throw 'The class events cannot be instantiated!';
    }; 
	
    // Definition of private properties.
    events._active = false;                                // If true event processing is active.
    events._caller = null;                                 // The caller object (clock, keyboard, mouse).
    events._current_item = null;			   // Contain the current active item. 			
    events._keyboard_mode = osweb.constants.PRESSES_ONLY;  // Keyboard collecting mode (down/up/both).
    events._keyboard_event = null;                         // Contains the last known keyboard event.
    events._mouse_mode = osweb.constants.PRESSES_ONLY;     // Mouse collecting mode (down/up/both).
    events._mouse_move = null;                             // Contains the last known mouse move event (used within the mouse class).
    events._mouse_press = null;				   // Contains the last known mouse press event (used within the mouse class).	
    events._response_given = false;			   // Valid response toggle
    events._response_type = -1;				   // Set type of response (0 = none, 1 = keyboard, 2 = mouse, 3 = sound). 
    events._response_list = null;	                   // Items to respond on.
    events._sound_ended = false;			   // Sound play is finished.
    events._timeout = -1;                                  // Duration for timeout.
    events._video_ended = false;			   // Video play is finished.
    
    // Definition of the conversion table to convert keycodes to OpenSesame codes.
    events.KEY_CODES = ['','','','','','','help','','backspace','tab','','','clear','enter','enter_special','','shift','ctrl','alt','pause',         // 00  .. 19
        'caps','','','','','','','escape','','','','','space','page up','page down','end','home','left','up','right',                                // 20  .. 39
        'down','select','print','execute','print screen','insert','delete','','0','1','2','3','4','5','6','7','8','9',':',';',                       // 40  .. 59
        '<','=','>','?','@','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o',                                                             // 60  .. 79
        'p','q','r','s','t','u','v','w','x','y','z','left meta','right meta','menu','','','kp0','kp1','kp2','kp3',                                   // 80  .. 99
        'kp4','kp5','kp6','kp7','kp8','kp9','kp_multiply','kp_plus','','kp_minus','kp_period','kp_divide','f1','f2','f3','f4','f5','f6','f7','f8',   // 100 .. 119
        'f9','f10','f11','f12','','','','','','','','','','','','','','','','',                                                                      // 120 .. 139
        '','','','','numlock','scrollock','','','','','','','','','','','','','','',                                                                 // 140 .. 159
        '^','!','"','#','$','%','&','_','(',')','*','+','|','_','{','}','~','','','',                                                                // 160 .. 179
        '','','','','','',';','=',',','-','.','/','`','','','','','','','',                                                                          // 180 .. 199
        '','','','','','','','','','','','','','','','','','','','[',                                                                                // 200 .. 219
        '\\',']','\'','','','','','','','','','','','','','','','','','',                                                                            // 220 .. 239
        '','','','','','','','','','','','','','','',''];                                                                                            // 240 .. 255
    // Definition of the conversion table to convert shift keycodes to OpenSesame codes.
    events.KEY_SCODES = ['','','','','','','','','','','','','','','','','','','','pause',                                                           // 00  .. 19
        '','','','','','','','','','','','','','','','','','','','',                                                                                 // 20  .. 39
        '','','','','','','','',')','!','@','#','$','%','^','&','*','(','',':',                                                                      // 40  .. 59
        '','+','','','','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o',                                                                 // 60  .. 79
        'p','q','r','s','t','u','v','w','y','z','','','','','','','','','','',                                                                       // 80  .. 99
        '','','','','','','','','','','','','','','','','','','','',                                                                                 // 100 .. 119
        '','','','','','','','','','','','','','','','','','','','',                                                                                 // 120 .. 139
        '','','','','','','','','','','','','','','','','','','','',                                                                                 // 140 .. 159
        '','','','','','','','','','','','','','_','','','','','','',                                                                                // 160 .. 179
        '','','','','','','','','<','','>','?','~','','','','','','','',                                                                             // 180 .. 199
        '','','','','','','','','','','','','','','','','','','','{',                                                                                // 200 .. 219
        '|','}','"','','','','','','','','','','','','','','','','','',                                                                              // 220 .. 239
        '','','','','','','','','','','','','','','',''];                                                                                            // 240 .. 255
   
    // Definition of methods for general event processing.    

    events._initialize = function() {
	// Initialize the keyboard event listeners.
        window.addEventListener("keydown", this._keyDown.bind(this), false); 
        window.addEventListener("keyup", this._keyUp.bind(this), false);

	// Initialize the mouse event listeners.
    	osweb.runner._canvas.addEventListener("mousedown", this._mouseDown.bind(this), false);
	osweb.runner._canvas.addEventListener("mousemove", this._mouseMove.bind(this), false);
	osweb.runner._canvas.addEventListener("mouseup", this._mouseUp.bind(this), false);
        
    	// Initialize the mouse context event listeners.
        osweb.runner._canvas.addEventListener("contextmenu", this._mouseContext.bind(this), false);

	// Initialize the tick event listener.
	createjs.Ticker.setInterval(15);
	createjs.Ticker.addEventListener("tick", this._tick.bind(this));	
    };
 
    events._finalize = function() {
    	// Finalize the tick event listener.             
	createjs.Ticker.removeEventListener("tick");

	// Finalize the mouse context event listeners.
	osweb.runner._canvas.removeEventListener("contextmenu", this._mouseContext, false);

	// Finalize the mouse event listeners.
	osweb.runner._canvas.removeEventListener("mousedown", this._mouseDown, false);
	osweb.runner._canvas.removeEventListener("mousemove", this._mouseMove, false); 
	osweb.runner._canvas.removeEventListener("mouseup", this._mouseUp, false); 

	// Finalize the keyboard event listeners.
        window.removeEventListener("keydown", this._keyDown, false);
	window.removeEventListener("keyup", this._keyUp, false);
    };
	
    events._run = function(caller, timeout, response_type, response_list) {
	// Set the event running properties.     
	this._caller = caller;
	this._response_list = response_list;
	this._response_type = response_type;
	this._timeout = timeout;

	// Activate the event running.  
	this._response_given = false;
	this._sound_ended = false;							    
	this._video_ended = false;
        this._active = true;	
    };

    events._update = function() {
    	// Check if the duration is finisdhed.
   	if (((this._timeout === -1) && ((this._response_given === true) || (this._sound_ended === true) || (this._video_ended === true))) ||
            ((this._timeout > 0) && ((this._response_type === osweb.constants.RESPONSE_KEYBOARD) || (this._response_type === osweb.constants.RESPONSE_MOUSE)) && (this._response_given === true)) ||
            (((this._timeout > 0) && (this._current_item.clock.time() - this._current_item.experiment.vars.get('time_' + this._current_item.name)) > this._timeout))) {
            // Set the status of the current item to finalize.
            this._current_item._status = osweb.constants.STATUS_FINALIZE;
  	}
        else {
            // Update the current item.
            this._current_item.update();
        }    
    };
    
    events._complete = function() {
        // Disable the ticker
        this._active = false;
        
        // Remove the items from the general stack.
	osweb.item_stack.pop();

        // Execute the post-run phase after duration is finished or response is received.
	this._current_item.complete();
    };

    // Definition of methods for keyboard event processing.
	
    events._convertKeyCode = function(event)
    {
        // Check for special characters
        var key = '';
        if ((event.shiftKey === true) && (event.keyCode !== 16))
        {
            // Shift key pressed with other key, so convert shift keys.
            key = this.KEY_SCODES[event.keyCode];
        } 
        else if ((event.shiftKey === true) && (event.keyCode === 16))
        {
            // Shift code pressed, check for location (left or right)
            key = (event.location == 1) ? 'lshift' : 'rshift'; 
        } 
        else if ((event.ctrlKey === true) && (event.keyCode === 17))
        {
            // Ctrl code pressed, check for location (left or right)
            key = (event.location == 1) ? 'lctrl' : 'rctrl'; 
        } 
        else if ((event.altKey === true) && (event.keyCode === 18))
        {
            // Alt code pressed, check for location (left or right)
            key = (event.location == 1) ? 'lalt' : 'ralt'; 
        } 
        else
        {
            // Convert standard keycode.
            key  = this.KEY_CODES[event.keyCode];
        } 
        
        // Return function result.
        return key;
    };
        
    events._keyDown = function(event) {
        // Store the keyboard event.    
	this.keyboard_event = event;

        // Only select this event when the collection mode is set for this.
    	if ((this._keyboard_mode === osweb.constants.PRESSES_ONLY) || (this._keyboard_mode === osweb.constants.PRESSES_AND_RELEASES)) {
            // Process the event.
            this._processKeyboardEvent(event, 1);
    	} 
    };	 

    events._keyUp = function(event) {
    	// Only select this event when the collection mode is set for this.
    	if ((this._keyboard_mode === osweb.constants.RELEASES_ONLY) || (this._keyboard_mode === osweb.constants.PRESSES_AND_RELEASES)) {
            // Process the event.
            this._processKeyboardEvent(event, 0);
    	} 	 
    };

    events._processKeyboardEvent = function(event, keyboard_state) {
        // Create a new keyboard response object.
        var KeyboardResponses = {'event': event, 'rtTime':  osweb.runner.experiment.clock.time(), 'state': keyboard_state, 'type': osweb.constants.RESPONSE_KEYBOARD};
      
        // Convert response to proper keyboard token. 
        KeyboardResponses.resp = this._convertKeyCode(event);
        
        // Process the response to the current object.
        if ((this._response_type === osweb.constants.RESPONSE_KEYBOARD) && ((this._response_list === null) || (this._response_list.indexOf(KeyboardResponses.resp) >= 0))) {
            // Process the current item.
	    if (this._current_item !== null) {
                // Process the response.
                this._current_item.update_response(KeyboardResponses);
            } 	 
        
            // Set the valid response given toggle.
            this._response_given = true;
        }
    };
	
    // Definition of methods for mouse event processing.
 
    events._mouseContext = function(event) {
        // Prevent default action. 
        event.preventDefault();
        
        // Return false to prevent the context menu from pushing up.
        return false;
    };            
 
    events._mouseDown = function(event) {
        // Store the mouse press status for use in the mousee class.
        this._mouse_press = event;

	// Only select this event when the collection mode is set for this.
    	if ((this._mouse_mode === osweb.constants.PRESSES_ONLY) || (this._mouse_mode === osweb.constants.PRESSES_AND_RELEASES)) {
            // Process the event.
            this._processMouseEvent(event, 1);
    	}	
    };	

    events._mouseMove = function(event) {
        // Store the mouse move event and its timestamp for use in the mouse class.
        this._mouse_move = {'event': event, 'rtTime': osweb.runner.experiment.clock.time()};
    };	

    events._mouseUp = function(event) {
	// Only select this event when the collection mode is set for this.
    	if ((this._mouse_mode === osweb.constants.RELEASES_ONLY) || (this._mouse_mode === osweb.constants.PRESSES_AND_RELEASES)) {
            // Process the event.
            this._processMouseEvent(event, 0);
    	} 	
    };

    events._processMouseEvent = function(event, mouse_state) {
        // Create a new mouse response object.
        var MouseResponses = {'event': event, 'rtTime': osweb.runner.experiment.clock.time(), 'state': mouse_state, 'type': osweb.constants.RESPONSE_MOUSE};
     	
     	// Adjust mouse response.  
     	MouseResponses.resp = String(event.button + 1);  
     	 
        // Process the response to the current object.
        if ((this._response_type === osweb.constants.RESPONSE_MOUSE) && ((this._response_list === null) || (this._response_list.indexOf(MouseResponses.resp) >= 0))) {
            // Process the response to the current object.
            if (this._current_item !== null) {
                this._current_item.update_response(MouseResponses);
            }   

            // Set the valid response given toggle.
            this._response_given = true;
	}
    };
	
    // Definition of methods for sound event processing.

    events._audioEnded = function() {
        // If duration isequal to sound exit the sound item.
        osweb.events._sound_ended = true;
    };

    // Definition of methods for video event processing.

    events._videoEnded = function() {
        osweb.events._video_ended = true;
    };

    events._videoPlay = function(event) {
    };

    // Definition of methods for tick event processing (timing).
 
    events._tick = function(event) {
    	// Only check for status if there is a current item and the ticker is activated.
        if ((this._current_item !== null) && (this._active === true)) {
            switch (this._current_item._status) {
                case osweb.constants.STATUS_FINALIZE:
                   // End action. Complete current active item.
                    events._complete();
                break;
		default:
                    // Default action, update section of the current active item.
                    events._update();
            }
	}
    };	 

    // Bind the events class to the osweb namespace.
    osweb.events = events;
}());


(function() {
    // Definition of the class functions.
    function functions() {
	throw 'The class functions cannot be instantiated!';
    }

    // Definition of private methods.   

    functions._initialize = function() {
	// Create the general function calls for use in the inlide script item.
	window['print'] = this.print;
	window['randint'] = this.randint;
    };
		
    // Definition of public methods - global inline functions.

    functions.print = function(text) {
	console.log('print output:' + text);
    };

    functions.randint = function(start, end) {
        var multiplier = end - start;
        var rand = Math.floor(Math.random() * multiplier);
        return rand + start;
    };

    // Bind the functions class to the osweb namespace.
    osweb.functions = functions;
}()); 



(function() {
    // Definition of the class Parameters.
    function parameters() {
	throw 'The class parameters cannot be instantiated!';
    } 

    // Define the private properties. 
    parameters._itemCounter = 0;
    parameters._parameters  = new Array();

    // Define the public properties. 
    parameters.displaySummary   = false;
    parameters.useDefaultValues = false;

    // Definition of private methods - initialize parameters.   

    parameters._initialize = function() {
      	// Set properties if defined.
    	var parameter = {dataType: '0', defaultValue: '0', name: 'subject_nr', prompt: 'Please enter the subject number', promptEnabled: true};
        
        // Add the subject parameter to the parameters list.
        this._parameters.push(parameter);
    };

    // Definition of private methods - process parameters.   
    
    parameters._processParameters = function() {
    	// Process all items for which a user input is required.
        if (this._itemCounter < this._parameters.length) {	
            // Process the Parameter.
            if (this.useDefaultValues == false) {
                this._processParameter(this._parameters[this._itemCounter]);
            }
            else {
                // Transfer the startup info to the context.
                this._transferParameters();
            }    
        }
        else {
            // All items have been processed, contine the Runner processing.
            if (this.displaySummary == true) {
                // Show a summary of the the startup information. 
                this._showParameters();
            }
            else {            
                // Transfer the startup info to the context.
                this._transferParameters();
            }
        }
    };

    parameters._processParameter = function(parameter) {
        // Check if a user request is required.
        if (parameter.promptEnabled == true) {
            this._showDialog(parameter.dataType);

            // Set the dialog interface.
            if (parameter.response == '') {
            	document.getElementById('qpdialoginput').value = parameter.defaultValue;
            }
            else {
            	document.getElementById('qpdialoginput').value = parameter.defaultValue;
            }

            document.getElementById('dialogboxhead').innerHTML = parameter.prompt;
            document.getElementById('qpbuttonyes').onclick = function() {
                // Get the response information
                parameter.response = document.getElementById('qpdialoginput').value;
                            
                // Close the dialog.
                this._hideDialog();
            
                // Increase the counter.
                this._itemCounter++;

                // Continue processing.
                this._processParameters();

            }.bind(this);
        	
            document.getElementById('qpbuttonno').onclick = function() {
                // Close the dialog.
	        this._hideDialog();
                
   		// Finalize the introscreen elements.
		osweb.runner._exit();
            }.bind(this);
        }
        else {
            // Assign default value to the Startup item.
            parameter.response = parameter.defaultValue;
           
            // Increase the counter.
            this._itemCounter++;

            // Continue processing.
            this._processParameters();
        }    
    };

    parameters._showParameters = function() {
        document.getElementById('dialogboxhead').innerHTML = 'Summary of startup info';
        document.getElementById('qpbuttonyes').onclick = function() {
            // Close the dialog.
	    this._hideDialog();
                        
            // Transfer the startup info to the context.
            this._transferParameters(); 
        
        }.bind(this);    
        
        document.getElementById('qpbuttonno').onclick = function() {
            // Close the dialog.
            this._hideDialog();
                       
            // Reset the item counter.
            this._itemCounter = 0;
                        
            // Restat the input process.    
            this._processParameters(); 
            
        }.bind(this);    

        document.getElementById('qpbuttoncancel').onclick = function() {
            // Close the dialog.
	    this._hideDialog();
        
            // Finalize the introscreen elements.
            osweb.runner._exit();
        }.bind(this);    
       
  	// Set the dialog interface.
        var TmpString = '';
        for (var i = 0;i < this._parameters.length; i++) {
            if ((this._parameters[i].enabled != 0) && (this._parameters[i].promptEnabled != 0)) {
		TmpString = TmpString + this._parameters[i].name + ': ' + this._parameters[i].response + '\r\n';  	        	
            }
        }

        document.getElementById('qpdialogtextarea').innerHTML = TmpString;
    };

    parameters._transferParameters = function() {
    	// Transfer the startup info items to the context.
        for (var i = 0;i < this._parameters.length; i++) {
            osweb.runner.experiment.vars.set(this._parameters[i].name,this._parameters[i].response);
        }
        
	// Parameters are processed, next phase.
        osweb.runner._prepareStartScreen();
    };
    
     // Definition of class methods (dialogs).   
     
    parameters._showDialog = function(dialog_type) {
        var dialogoverlay = document.getElementById('dialogoverlay');
	var dialogbox = document.getElementById('dialogbox');
		                
	dialogoverlay.style.display = "block";
	dialogoverlay.style.height = window.innerHeight + "px";
	dialogbox.style.left = (window.innerWidth / 2) - (400 * .5) + "px";
	dialogbox.style.top = "200px";
	dialogbox.style.display = "inline";

	switch (dialog_type) {
	    case "0": 
                document.getElementById('dialogboxbody').innerHTML = '<input id="qpdialoginput"></input>';
	    	document.getElementById('dialogboxfoot').innerHTML = '<button id="qpbuttonyes">Ok</button><button id="qpbuttonno">Cancel</button>';
                document.getElementById('qpdialoginput').focus();
            break;
            case "1": 
	        document.getElementById('dialogboxbody').innerHTML = '<input id="qpdialoginput"></input>';
		document.getElementById('dialogboxfoot').innerHTML = '<button id="qpbuttonyes">Ok</button><button id="qpbuttonno">Cancel</button>';
                document.getElementById('qpdialoginput').focus();
            break;
            case "2": 
	        document.getElementById('dialogboxbody').innerHTML = '<input id="qpdialoginput"></input>';
		document.getElementById('dialogboxfoot').innerHTML = '<button id="qpbuttonyes">Ok</button><button id="qpbuttonno">Cancel</button>';
                document.getElementById('qpdialoginput').focus();
            break;
            case "3": 
	        document.getElementById('dialogboxbody').innerHTML = '<textarea id="qpdialogtextarea"></textarea>';
                document.getElementById('dialogboxfoot').innerHTML = '<button id="qpbuttonyes">Yes</button><button id="qpbuttonno">No</button><button id="qpbuttoncancel">Cancel</button>';
                document.getElementById('qpdialogtextarea').focus();
            break;
	}
    };
	 
    parameters._hideDialog = function() {
        dialogoverlay.style.display = "none";
	dialogbox.style.display = "none";
	document.getElementById('dialogboxbody').innerHTML = '';
	document.getElementById('dialogboxfoot').innerHTML = '';
    };	

    // Bind the parameters class to the osweb namespace.
    osweb.parameters = parameters;
}());


(function() {
    // Definition of the class session.
    function parser() {
	throw 'The class parser cannot be instantiated!';
    }

    // Definition of private properties.
    parser._ast_tree = null;    
    parser._current_node = null;
    parser._inline_script = null;
    parser._status = 0;                      
                
    // Definition of private methods - prepare cycle.   

    parser._prepare = function(script) {
        if (script !== '') {
            var locations = false;
            var parseFn = filbert_loose.parse_dammit;
            var ranges = false;
        		
	    try {
                var code = script;
           	var ast = parseFn(code, { locations: locations, ranges: ranges });
	        return ast;
    	    }
       	    catch (e) {
        	console.log('error');
        	console.log(e.toString());
                return null;
            }
        } else
	{
            return null;
        }	   	
    };
    
    // Definition of private methods - general parser functions.

    parser._set_return_value = function(node, value) {
        var index = 0;
        while (typeof node['returnvalue' + String(index)] !== 'undefined') {
            index++;
        }    
        
        // Set the return value\
        node['returnvalue' + String(index)] = value;
    };
    
    // Definition of private methods - node processing.
    
    parser._node_binary_expression = function() {
        // Initialize status property.
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0  : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // process right expression;
                this._current_node.status = 1;
                this._current_node.right.parent = this._current_node;
                this._current_node = this._current_node.right;

                // Return to the node processessor.
                this._process_node();
            break;        
            case 1: 
                // process right expression;
                this._current_node.status = 2;
                this._current_node.left.parent = this._current_node;
                this._current_node = this._current_node.left;

                // Return to the node processessor.
                this._process_node();
            break;        
            case 2: 
                var left,right;
                if  (typeof window[this._current_node.returnvalue0] === 'undefined') {
                    var right = this._current_node.returnvalue0;
                }
                else {
                    var right = window[this._current_node.returnvalue0];
                }
                var left,right;
                if  (typeof window[this._current_node.returnvalue1] === 'undefined') {
                    var left = this._current_node.returnvalue1;
                }
                else {
                    var left = window[this._current_node.returnvalue1];
                }
            
                // Select the binary operator to perform.
                switch (this._current_node.operator) {
                    case '-':
                        // Process call - check for blocking methods.
                        this._set_return_value(this._current_node.parent,left - right);
                    break;
                }

                // Set parent node.
                this._current_node.status = 3;
                this._current_node = this._current_node.parent;

                // Return to the node processessor.
                this._process_node();
            break;        
        }    
    };    

    parser._node_call_expression = function() {
        // Initialize status property.
        this._current_node.arguments = (typeof this._current_node.arguments === 'undefined') ? [] : this._current_node.arguments;
        this._current_node.index = (typeof this._current_node.index === 'undefined') ? 0  : this._current_node.index; 
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0  : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // Process arguments.
                if (this._current_node.index < this._current_node.arguments.length) {
                    // Set current node to next node in list.
                    this._current_node.index++;
                    this._current_node.arguments[this._current_node.index - 1].parent = this._current_node;
                    this._current_node = this._current_node.arguments[this._current_node.index - 1];
        
                    // Return to the node processessor.
                    this._process_node();
                } 
                else { 
                    // Set parent node.
                    this._current_node.status = 1;

                    // Return to the node processessor.
                    this._process_node();
                }
            break;
            case 1: 
                // Set parent node.
                this._current_node.status = 2;
                this._current_node.callee.parent = this._current_node;
                this._current_node = this._current_node.callee;

                // Return to the node processessor.
                this._process_node();
            break;    
            case 2: 
                // Set status of node.
                this._current_node.status = 3;
            
                // Create the aruments array.
                var tmp_arguments = [];
                for (var i=0;i< this._current_node.arguments.length; i++) {
                    if (typeof window[this._current_node['returnvalue' + String(i)]] !== 'undefined') {
                        tmp_arguments.push(window[this._current_node['returnvalue' + String(i)]]);
                    }    
                    else {    
                        tmp_arguments.push(this._current_node['returnvalue' + String(i)]);
                    }    
                }    
                    
                // Select the type of call to process
                var callee = this._current_node['returnvalue' + String(this._current_node.arguments.length)];
                var returnvalue = null;
                if (callee.type == 'function') {
                    // function call
                    returnvalue = window[callee.obj].apply(null, tmp_arguments);
                    
                    // Process call - check for blocking methods.
                    this._current_node.parent['returnvalue' + String(this._current_node.arguments.length)] = returnvalue;
                
                    // Return to the node processessor.
                    this._process_node();
                }    
                else if (callee.type == 'object') {
                    if ((callee.obj == 'clock') && (callee.prop == 'sleep')) {
                        // Process special calls with blocking (no direct result processing).
                        window[callee.obj][callee.prop].apply(window[callee.obj], tmp_arguments);
                    }    
                    else {    
                        // object methods calls.
                        returnvalue = window[callee.obj][callee.prop]();
                    
                        // Process call - check for blocking methods.
                        this._current_node.parent['returnvalue' + String(this._current_node.arguments.length)] = returnvalue;
                
                        // Return to the node processessor.
                        this._process_node();
                    }        
                }
                else {
                    switch (callee) {   
                        case 'canvas':
                            returnvalue = new osweb.canvas();
                        break;    
                    }    
                  
                    // Process call - check for blocking methods.
                    this._current_node.parent['returnvalue' + String(this._current_node.arguments.length)] = returnvalue;
                
                    // Return to the node processessor.
                    this._process_node();
                }    
            break;    
            case 3: 
                // Set parent node.
                this._current_node.status = 4;
                this._current_node = this._current_node.parent;

                // Return to the node processessor.
                this._process_node();
            break;        
        }    
    };

    parser._node_expression_statement = function() {
        // Initialize status property.
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0  : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // Set parent node.
                this._current_node.status = 1;
                this._current_node.expression.parent = this._current_node;
                this._current_node = this._current_node.expression;

                // Return to the node processessor.
                 this._process_node();
            break;
            case 1: 
                // Set parent node.
                this._current_node.status = 2;
                this._current_node = this._current_node.parent;

                // Return to the node processessor.
                this._process_node();
            break;
        ;}    
    };

    parser._node_identifier = function() {
        // Return function result.
        if (typeof window[this._current_node.name] === 'undefined') {
            // Item is undefined, create it without value/type definition.
            window[this._current_node.name] = null;
        }
        
        // Set the return value.
        this._set_return_value(this._current_node.parent, this._current_node.name);

        // Set parent node.
        this._current_node = this._current_node.parent;

        // Return to the node processessor.
        this._process_node();
    };

    parser._node_literal = function()
    {
        // Set the return value.
        this._set_return_value(this._current_node.parent, this._current_node.value);
        
        // Set parent node.
        this._current_node = this._current_node.parent;

        // Return to the node processessor.
        this._process_node();
    };

    parser._node_member_expression = function()
    {
        // Initialize status property.
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0 : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // Process object.
                this._current_node.status = 1;
                this._current_node.object.parent = this._current_node;
                this._current_node = this._current_node.object;
                
                // Return to the node processessor.
                this._process_node();
            break;    
            case 1: 
                // Process object.
                this._current_node.status = 2;
                this._current_node.property.parent = this._current_node;
                this._current_node = this._current_node.property;

                // Return to the node processessor.
                this._process_node();
            break;    
            case 2: 
                // Set the return value.
                //console.log('member->');
                //console.log(typeof this._current_node.returnvalue0);
                    
                if (typeof this._current_node.returnvalue0 == 'object') {
                    this._set_return_value(this._current_node.parent,{ 'obj': this._current_node.returnvalue1, 'prop': null, 'type': 'function'});
                }
                else {    
                    this._set_return_value(this._current_node.parent,{ 'obj': this._current_node.returnvalue0, 'prop': this._current_node.returnvalue1,'type':'object'});
                }
                
                // Set parent node.
                this._current_node.status = 3;
                this._current_node = this._current_node.parent;

                // Return to the node processessor.
                this._process_node();
            break;    
        }        
    };

    parser._node_program = function()
    {
        // Initialize index counter only the fitst time.
        this._current_node.index = (typeof this._current_node.index === 'undefined') ? 0 : this._current_node.index; 
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0 : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // Check if all nodes in script have been processed.
                if (this._current_node.index < this._current_node.body.length) {
                    // Set current node to next node in list.
                    this._current_node.index++;
                    this._current_node.body[this._current_node.index - 1].parent = this._current_node;
                    this._current_node = this._current_node.body[this._current_node.index - 1];

                    // Return to the node processessor.
                    this._process_node();
                }
                else {
                    // End status.
                    this._current_node.status = 1;
                
                    // Return to the node processessor.
                    this._process_node();
                }    
            break;
            case 1:
                // Change the node stats.                                
                this._current_node.status = 2;

                // All nodes are processed, set status to finished.
                this._status = 2;
        
                // Complete the inline item.    
                if (this._inline_script != null) {    
                    this._inline_script.complete();
                }    
            break;    
        }   
    };    

    parser._node_variable_declaration = function()
    {
        // Initialize index counter only the fitst time.
        this._current_node.index = (typeof this._current_node.index === 'undefined') ? 0 : this._current_node.index; 
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0 : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // Check if all nodes in script have been processed.
                if (this._current_node.index < this._current_node.declarations.length) {
                    // Set current node to next node in list.
                    this._current_node.index++;
                    this._current_node.declarations[this._current_node.index - 1].parent = this._current_node;
                    this._current_node = this._current_node.declarations[this._current_node.index - 1];

                    // Return to the node processessor.
                    this._process_node();
                } 
                else {
                    // Change the node stats.                                
                    this._current_node.status = 1;

                    // Return to the node processessor.
                    this._process_node();
                }    
            break; 
            case 1:
                // Change the node stats.                                
                this._current_node.status = 2;

                // Set parent node.
                this._current_node = this._current_node.parent;

                // Return to the node processessor.
                this._process_node();
            break;
        }   
    };

    parser._node_variable_declarator = function()
    {
        // Initialize status property.
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0 : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // Process init.
                this._current_node.status      = 1;
                this._current_node.init.parent = this._current_node;
                this._current_node             = this._current_node.init;
                
                // Return to the node processessor.
                this._process_node();
            break;    
            case 1: 
                // process id.
                this._current_node.status    = 2;
                this._current_node.id.parent = this._current_node;
                this._current_node           = this._current_node.id;

                // Return to the node processessor.
                this._process_node();
            break;    
            case 2: 
                // Set variable.
                window[this._current_node.returnvalue1] = this._current_node.returnvalue0;      
                
                // Set parent node.
                this._current_node.status = 3;
                this._current_node = this._current_node.parent;

                // Return to the node processessor.
                this._process_node();
            break;    
        }
    };

    // Definition of private methods - general node processing.

    parser._process_node = function() {
        console.log('processing node');
        console.log(this._current_node);
        
        // Select the type of node to process
        switch(this._current_node.type) { 
            case 'BinaryExpression':
                this._node_binary_expression();
            break;
            case 'CallExpression':
                this._node_call_expression();
            break;
            case 'ExpressionStatement':
                this._node_expression_statement();
            break;
            case 'Identifier':
                this._node_identifier();
            break;
            case 'Literal':
                this._node_literal();
            break;
            case 'MemberExpression':
                this._node_member_expression();
            break;
            case 'Program':
                this._node_program();
            break;
            case 'VariableDeclaration':
                this._node_variable_declaration();
            break; 
            case 'VariableDeclarator':
                this._node_variable_declarator();
            break; 
        }
    };

    // Definition of private methods - run cycle.

    parser._runstatement = function(node) {
        // Call the expression statement en return the value.       
        return this._node_call_expression(node.expression);
    };
    
    parser._run = function(inline_script, ast_tree) {
        // Set the inline item. 
	this._inline_script = inline_script;
	
	// Set the first node and its parent.
	this._current_node = ast_tree;
        this._current_node.parent = null;
        this._status = 1;
        
    	// Process the nodes. 
	osweb.parser._process_node();
    };

    // Bind the parser class to the osweb namespace.
    osweb.parser = parser;
}()); 


/*
 * Definition of the class prng.
 */

(function() 
{
    function prng()
    {
    	throw "The class prng cannot be instantiated!";
    }; 
	
    // Set the class private properties. 
    prng._previous = 0;
    prng._prng     = uheprng();    
    prng._seed     = '0';

    /*
     * Definition of class methods - run cycle.   
     */
    
    prng._initialize = function()
    {
        // Create the random seed. 
        this._prng.initState();
        this._prng.hashString(this._seed); 
    };

    /*
     * Definition of class methods.   
     */

    prng._getNext = function() 
    {
        // Get the next random number.
        this._previous = (this._prng(1000000000000000) / 1000000000000000);
        
        // Return function result.
        return this._previous;
	};

    prng._getPrevious = function() 
    {
        // Return function result.
        return this._previous;
    };

    prng._getSeed = function() 
    {
        // Return the current seed value.
        return this._seed;        
    };

    prng._random = function(pMin, pMax) 
    {
        // Calculate the range devider.
        var devider = (1 / ((pMax - pMin) + 1));
         
        // Get the random number and devide it.
        this._previous = ((this._prng(1000000000000000) / 1000000000000000));
        
        // Set the devider.
        this._previous = pMin + Math.floor(this._previous / devider);
               
        // Return function result. 
        return this._previous;
    };

    prng._reset = function() 
    {
        // Set the random seed value to 0. 
        this._seed = '0';

        // Reset the PRNG range.
        this._prng.initState();
        this._prng.hashString(String(this._seed));
    };
    
    prng._setSeed = function(pSeed) 
    {
        // Set the random seed value. 
        this._seed = String(pSeed);
        
        // Reset the PRNG range.
        this._prng.initState();
        this._prng.hashString(this._seed);
    };

    // Bind the prng class to the osweb namespace.
    osweb.prng = prng;
}());


(function() {
    // Definition of the class session - store user session information. 
    function session() {
    	throw 'The class session cannot be instantiated!';
    }

    // Definition of private methods.   

    session._initialize = function() {
    	// Update the loader text.
    	osweb.runner._updateIntroScreen(osweb.constants.MESSAGE_008);
	
    	// Get the session information.
	this._getSessionInformation();
    };

    session._getSessionInformation = function() {
    	// Get the session information from the client system.
    	this._date = new Date();
	this._session = {
            'browser': {
                'codename': navigator.appCodeName,
                'name': navigator.appName,
                'version': navigator.appVersion
            },
            'date': {
                'startdate': ('0' + this._date.getDate()).slice(-2) + '-' + ('0' + this._date.getMonth()).slice(-2) + '-' + ('0' + this._date.getFullYear()).slice(-2),
                'starttime': ('0' + this._date.getHours()).slice(-2) + ':' + ('0' + this._date.getMinutes()).slice(-2) + ':' + ('0' + this._date.getSeconds()).slice(-2),
                'startdateUTC' : ('0' + this._date.getUTCDate()).slice(-2) + '-' + ('0' + this._date.getUTCMonth()).slice(-2) + '-' + ('0' + this._date.getUTCFullYear()).slice(-2)
            },
            'experiment': {
		'debug': 0,
                'parameters': 0,
		'pilot': 0,
                'taskname': 0,
                'taskversion': 0
            },
            'screen': {
                'availableHeight': screen.availHeight,
                'availableWidth': screen.availWidth,
                'colorDepth': screen.colorDepth,
                'height': screen.height,
                'outerheight': window.outerheight,
                'outerwidth': window.outerwidth,
                'pixelDepth': screen.pixelDepth,
                'screenX': window.screenX,
                'screenY': window.screenY,
                'width': screen.width
            },
            'system': {
                'os': navigator.platform
            }
        };
    };

    // Bind the session class to the osweb namespace.
    osweb.session = session;
}()); 


(function() {
    // Definition of the class runner.
    function runner() {
    	throw 'The class runner cannot be instantiated!';
    };

    // Show library name and library version number in the console.
    console.log(osweb.VERSION_NAME + ' - ' + osweb.VERSION_NUMBER);	

    // Definition of private properties.
    runner._canvas = null;                       // Canvas on which the experiment is shown.
    runner._qualtrics = null;                    // Link to the qualtrics interface (optional)
    runner._stage = null;                        // Links to the stage object (CreateJS).

    // Definition of public properties.
    runner.data = null;                          // Container for the experiment result data (if defined).
    runner.debug = false;                        // Debug toggle.
    runner.experiment = null;                    // The root experiment object to run.           
    runner.onFinished = null;                    // Event triggered on finishing the experiment.
    runner.screenIntro = true;                   // Show introscreen toggle.
    runner.screenClick = true;                   // Show clickscreen toggle
    runner.script = null;                        // Container for the JSON script definition of the experiment.
    runner.scriptID = 0;                         // Id used when retrieving the script from the database.
    runner.scriptURL = '';                       // Path pointing to the AMFPHP database files.
    runner.session = null;                       // Container for the JSON session information.
    
    /*
    // Definition of private methods - setup runner.      
     */

    runner._setupContent = function(content) {
    	// Check if the experiment container is defined.                     
	if (typeof content !== "undefined") {
            // Get the canvas from the DOM Element tree.
            this._canvas = (typeof content === 'string') ? document.getElementById(content) : content; 		
		
            // Set the stage object (easelJS). 
            this._stage = new createjs.Stage(this._canvas);
            this._stage.snapToPixelEnabled = true;
            this._stage.regX = -.5;
            this._stage.regY = -.5;
		
            // Build the initialization screen.
            this._setupIntroScreen();
	}
	else {
            osweb.debug.addError(osweb.constants.ERROR_002);
	}
    };

    runner._setupContext = function(context) {
	// Check if the script parameter is defined.                        
	if (typeof context !== "undefined") {
            // Initialize the context parameters.
            this.debug = (typeof context.debug !== 'undefined') ? context.debug : false; 
            this.file = (typeof context.file !== 'undefined') ? context.file : null;
            this.onFinished = (typeof context.onFinished !== 'undefined') ? context.onFinished : null;
            this.screenClick = (typeof context.screenClick !== 'undefined') ? context.screenClick : true;				      
            this.screenIntro = (typeof context.screenIntro !== 'undefined') ? context.screenIntro : true; 
            this.script = (typeof context.script !== 'undefined') ? context.script : null;      
            this.scriptID = (typeof context.scriptID !== 'undefined') ? context.scriptID : 0;         
            this.scriptURL = (typeof context.scriptURL !== 'undefined') ? context.scriptURL : '';		 
            this.session = (typeof context.session !== 'undefined') ? context.session : null;
					
            // Check if an osexp script is given as parameter.                            
            if (this.script !== null) {	
                // Start building the experiment structure.      
		this._buildExperiment();
            }
            // Check if an osexp file is given as parameter. 
            else if (this.file !== null) {
                this._setupScriptFromFile();
            }	
            else {
                // Retrieve the script from an external location.
		this._setupScriptFromDatabase();
            }
	}
	else {
            osweb.debug.addError(osweb.constants.ERROR_003);
	}
    };

    runner._setupScriptFromFile = function() {
        // Check for binary or text file definition.
        if (this.file.substring(0,3) == '---') {
            this.script = String(this.file);
        } 
        else {
            // Decompress the gizp file and splitt the tar result.	
            GZip.loadlocal(this.file, function(h) {
                var tar = new TarGZ;
                tar.parseTar(h.data.join(''));
                tar.files.forEach(this.setupScriptFromFileResult.bind(this)); 
            }.bind(this), this.setupScriptFromFileProgress, this.setupScriptFromFileAlert);
        }    
        
        // Start building the experiment structure.      
	this._buildExperiment();
    };

    runner.setupScriptFromFileAlert = function() {
    };

    runner.setupScriptFromFileProgress = function() {
    };

    runner.setupScriptFromFileResult = function(pFile) {
	// Check if the file is the scriptfile.
    	if (pFile.filename === 'script.opensesame') {
            // Create the script.
            this.script = String(pFile.data);
   	}
	else if ((pFile.data !== null) && (pFile.data !== '')) {
            // Create a file pool element.
            osweb.pool.add_from_local_source(pFile);			
	}
    };

    runner._setupScriptFromDatabase = function() {
	// Check if the URL and ID is propertly defined.
       	if ((this.scriptID >= 0) && (this.scriptURL !== '')) {
            var url = this.scriptURL + '/php/index.php?/ajax/group/get_status';
            var parameters = {group_id: 99, task_number: this.scriptID};
		
            new Ajax.Request(url, {
            	parameters: parameters,
		onCreate: function(response) {
                    var t = response.transport;
                    t.setRequestHeader = t.setRequestHeader.wrap(function(original, k, v) {
			if (/^(accept|accept-language|content-language)$/i.test(k))
                            return original(k, v);
			if (/^content-type$/i.test(k) &&
                            /^(application\/x-www-form-urlencoded|multipart\/form-data|text\/plain)(;.+)?$/i.test(v))
                            return original(k, v);
			return;
                    });
		},
		onSuccess: function(transport) {
                    // Process the response
                    if (transport.responseText) {
                        // Retrieve the response text.
			var jsonresponse = JSON.parse(transport.responseText);
					
			// Check if the task is available.
			if (jsonresponse.task_available === '1') {
                            // Set the script parameter.
                            this.script = jsonresponse.data_available;
                            this.files  = jsonresponse.file_available.split('\r\n');    
                                    
                            // Create a file pool element.
                            osweb.pool.add_from_server_source(this.scriptURL + '/user/4/', this.files);			
                        }
			else {
                            // Show erorr message within the concole.
                            osweb.debug.addError(osweb.constants.ERROR_007);
			}
                    }	
                    else {
			// Show erorr message within the concole.
			osweb.debug.addError(osweb.constants.ERROR_006);
                    }
		}.bind(this),
		onFailure: function() {
                    // Show erorr message within the concole.
                    osweb.debug.addError(osweb.constants.ERROR_005);
		}.bind(this) 
            }); 
	}
	else {
            // Show erorr message within the concole.
            osweb.debug.addError(osweb.constants.ERROR_004);
	} 
    };

    // Definition of private methods - Introduction screen.

    runner._setupIntroScreen =  function() {
    	// Set the introscreen elements.
	if (this.screenIntro === true) {
            this._introScreen  = new createjs.Shape();
            this._introScreen.graphics.beginFill('#000000').drawRect(0,0,this._stage.width,this._stage.height);
            this._introLine    = new createjs.Shape();
            this._introLine.graphics.beginFill('#AAAAAA').drawRect(200,155,400,1);
            this._introText1   = new createjs.Text('OS', "24px bold Times", "#FF0000");
            this._introText1.x = 200;
            this._introText1.y = 135;
            this._introText2   = new createjs.Text(osweb.constants.MESSAGE_002 + osweb.VERSION_NUMBER, "14px Arial", "#FFFFFF");
            this._introText2.x = 231;
            this._introText2.y = 142;
            this._introText3   = new createjs.Text(osweb.constants.MESSAGE_003,"12px Arial", "#FFFFFF");
            this._introText3.x = 200;
            this._introText3.y = 168;
            this._stage.addChild(this._introScreen,this._introLine,this._introText1,this._introText2,this._introText3);
            this._stage.update();
	}
    };
	
    runner._clearIntroScreen = function(){
        // Update the introscreen elements.
	if (this.screenIntro === true) {
            this._stage.removeChild(this._introScreen,this._introLine,this._introText1,this._introText2,this._introText3);
            this._stage.update();
	}		
    };
	
    runner._updateIntroScreen = function(text) {
	// Update the introscreen elements.
	if (this.screenIntro === true) {
            this._introText3.text = text;
            this._stage.update();
	}		
    };

    // Definition of the private methods - build cycle.      

    runner._buildExperiment = function() {
    	// Build the base experiment object.
	this.experiment = new osweb.experiment(null, 'test', this.script);
	
        // Create the global static object classes.
	window['items'] = osweb.item_store;
	window['pool']  = osweb.file_pole_store;
	window['vars']  = this.experiment.vars;
		
	// Pepare the experiment to run.
	this._prepare();
    };

    // Definition of private methods - prepare cycle.   

    runner._prepare = function() {
	// Update inroscreen.
	this._updateIntroScreen(osweb.constants.MESSAGE_004);
		
	// Start the stimuli loader.
	osweb.parameters._initialize();
        osweb.functions._initialize();
	osweb.python_workspace_api._initialize();
        osweb.session._initialize();

        // Start the parameter screen (subject number).
        this._prepareParameters();
    };

    runner._prepareParameters = function() {
        // Update inroscreen.
	this._updateIntroScreen(osweb.constants.MESSAGE_005);

	// Check if items must be processed. 
	if (osweb.parameters._parameters.length > 0) {
		// Process the Parameters.        
   	    osweb.parameters._processParameters();
	}
	else { 
            // Start the experiment.
   	    this._prepareStartScreen();
	}
    };

    runner._prepareStartScreen = function() {
        // Check if the experiment must be clicked to start.
        if (this.screenClick === true) {
            // Update inroscreen.
            this._updateIntroScreen(osweb.constants.MESSAGE_006);
		
            // Setup the mouse click response handler.
            var clickHandler = function(event) {
		// Remove the handler.
		this._canvas.removeEventListener("click", clickHandler);

		// Finalize the introscreen elements.
		this._clearIntroScreen();

                // Start the task.
		this._initialize();
            }.bind(this); 

            // Set the temporary mouse click.
            this._canvas.addEventListener("click", clickHandler, false);
	}
	else {
            // Finalize the introscreen elements.
            this._clearIntroScreen();

            // Start the runner.
            this._initialize(); 
	}
    };

    // Definition of private methods - run cycle.   
    
    runner._initialize = function() {
	// Initialize the debugger. 
	osweb.debug._initialize();

        // Initialize the devices.
	osweb.events._initialize();

        // Prepare and execute the experiment item.
	this.experiment.prepare();
	this.experiment.run();
    };
	
    runner._finalize = function() {   
        // Finalize the devices.
    	osweb.events._finalize();
        
    	// Finalize the debugger. 
	osweb.debug._finalize();

        // Exit the application.
        this._exit();
    };

    runner._exit = function() {
        // Clear the canvas.
        this._stage.clear();
        
        // Set the cursor visibility to default.
        this._stage.canvas.style.cursor = "default";

        // Check if an event handler is attached.
	if (this.onFinished) {
            // Execute.
            this.onFinished(this.data, osweb.session._session);
	}
    };

    // Definition of public methods - run cycle.      

    runner.run = function(content, context) {
        // Initialize the content container.
	this._setupContent(content);

	// Initialize the context parameter
	this._setupContext(context);
    };

    // Bind the runner class to the osweb namespace.
    osweb.runner = runner;
}()); 

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZWpzLmpzIiwiZmlsYmVydC5qcyIsImZpbGJlcnRfbG9vc2UuanMiLCJnemlwLmpzIiwicHJvdG90eXBlLmpzIiwidWhlcHJuZy5qcyIsIm9zd2ViLmpzIiwiY29uc3RhbnRzLmpzIiwiY2FudmFzLmpzIiwiY2xvY2suanMiLCJrZXlib2FyZC5qcyIsImxvZy5qcyIsIm1vdXNlLmpzIiwic2FtcGxlci5qcyIsInZpZGVvLmpzIiwiZGVidWcuanMiLCJmaWxlX3Bvb2xfc3RvcmUuanMiLCJoZWFydGJlYXQuanMiLCJpdGVtX3N0YWNrLmpzIiwiaXRlbV9zdG9yZS5qcyIsInB5dGhvbl93b3Jrc3BhY2UuanMiLCJweXRob25fd29ya3NwYWNlX2FwaS5qcyIsInJlc3BvbnNlX2luZm8uanMiLCJyZXNwb25zZV9zdG9yZS5qcyIsInN5bnRheC5qcyIsInZhcl9zdG9yZS5qcyIsIml0ZW0uanMiLCJnZW5lcmljX3Jlc3BvbnNlLmpzIiwiZXhwZXJpbWVudC5qcyIsImlubGluZV9zY3JpcHQuanMiLCJrZXlib2FyZF9yZXNwb25zZS5qcyIsImxvZ2dlci5qcyIsImxvb3AuanMiLCJtb3VzZV9yZXNwb25zZS5qcyIsInNlcXVlbmNlLmpzIiwic2tldGNocGFkLmpzIiwiZmVlZGJhY2suanMiLCJzeW50aC5qcyIsImFkdmFuY2VkX2RlbGF5LmpzIiwiZm9ybV9iYXNlLmpzIiwiZm9ybV9jb25zZW50LmpzIiwiZm9ybV9tdWx0aXBsZV9jaG9pY2UuanMiLCJmb3JtX3RleHRfZGlzcGxheS5qcyIsImZvcm1fdGV4dF9pbnB1dC5qcyIsImZvcm1fdGV4dF9yZW5kZXIuanMiLCJtZWRpYV9wbGF5ZXJfdmxjLmpzIiwibm90ZXBhZC5qcyIsInJlcGVhdF9jeWNsZS5qcyIsInJlc2V0X2ZlZWRiYWNrLmpzIiwidG91Y2hfcmVzcG9uc2UuanMiLCJiYXNlX2VsZW1lbnQuanMiLCJhcnJvdy5qcyIsImNpcmNsZS5qcyIsImVsbGlwc2UuanMiLCJmaXhkb3QuanMiLCJnYWJvci5qcyIsImltYWdlLmpzIiwibGluZS5qcyIsIm5vaXNlLmpzIiwicmVjdC5qcyIsInRleHRsaW5lLmpzIiwiZm9ybS5qcyIsIndpZGdldC5qcyIsImJ1dHRvbi5qcyIsImNoZWNrYm94LmpzIiwibGFiZWwuanMiLCJldmVudHMuanMiLCJmdW5jdGlvbnMuanMiLCJwYXJhbWV0ZXJzLmpzIiwicGFyc2VyLmpzIiwicHJuZy5qcyIsInNlc3Npb24uanMiLCJydW5uZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNzRHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hnQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0b0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0MU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25MQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9TQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25JQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1VkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25OQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FwQmpHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FxQjVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25GQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJvc3dlYi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuKiBAbGljZW5zZSBDcmVhdGVKU1xuKiBWaXNpdCBodHRwOi8vY3JlYXRlanMuY29tLyBmb3IgZG9jdW1lbnRhdGlvbiwgdXBkYXRlcyBhbmQgZXhhbXBsZXMuXG4qXG4qIENvcHlyaWdodCAoYykgMjAxMS0yMDE1IGdza2lubmVyLmNvbSwgaW5jLlxuKlxuKiBEaXN0cmlidXRlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlLlxuKiBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLmh0bWxcbipcbiogVGhpcyBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4qL1xudGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxjcmVhdGVqcy5leHRlbmQ9ZnVuY3Rpb24oYSxiKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBjKCl7dGhpcy5jb25zdHJ1Y3Rvcj1hfXJldHVybiBjLnByb3RvdHlwZT1iLnByb3RvdHlwZSxhLnByb3RvdHlwZT1uZXcgY30sdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxjcmVhdGVqcy5wcm9tb3RlPWZ1bmN0aW9uKGEsYil7XCJ1c2Ugc3RyaWN0XCI7dmFyIGM9YS5wcm90b3R5cGUsZD1PYmplY3QuZ2V0UHJvdG90eXBlT2YmJk9iamVjdC5nZXRQcm90b3R5cGVPZihjKXx8Yy5fX3Byb3RvX187aWYoZCl7Y1soYis9XCJfXCIpK1wiY29uc3RydWN0b3JcIl09ZC5jb25zdHJ1Y3Rvcjtmb3IodmFyIGUgaW4gZCljLmhhc093blByb3BlcnR5KGUpJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBkW2VdJiYoY1tiK2VdPWRbZV0pfXJldHVybiBhfSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGNyZWF0ZWpzLmluZGV4T2Y9ZnVuY3Rpb24oYSxiKXtcInVzZSBzdHJpY3RcIjtmb3IodmFyIGM9MCxkPWEubGVuZ3RoO2Q+YztjKyspaWYoYj09PWFbY10pcmV0dXJuIGM7cmV0dXJuLTF9LHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjKXt0aGlzLnR5cGU9YSx0aGlzLnRhcmdldD1udWxsLHRoaXMuY3VycmVudFRhcmdldD1udWxsLHRoaXMuZXZlbnRQaGFzZT0wLHRoaXMuYnViYmxlcz0hIWIsdGhpcy5jYW5jZWxhYmxlPSEhYyx0aGlzLnRpbWVTdGFtcD0obmV3IERhdGUpLmdldFRpbWUoKSx0aGlzLmRlZmF1bHRQcmV2ZW50ZWQ9ITEsdGhpcy5wcm9wYWdhdGlvblN0b3BwZWQ9ITEsdGhpcy5pbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ9ITEsdGhpcy5yZW1vdmVkPSExfXZhciBiPWEucHJvdG90eXBlO2IucHJldmVudERlZmF1bHQ9ZnVuY3Rpb24oKXt0aGlzLmRlZmF1bHRQcmV2ZW50ZWQ9dGhpcy5jYW5jZWxhYmxlJiYhMH0sYi5zdG9wUHJvcGFnYXRpb249ZnVuY3Rpb24oKXt0aGlzLnByb3BhZ2F0aW9uU3RvcHBlZD0hMH0sYi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb249ZnVuY3Rpb24oKXt0aGlzLmltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZD10aGlzLnByb3BhZ2F0aW9uU3RvcHBlZD0hMH0sYi5yZW1vdmU9ZnVuY3Rpb24oKXt0aGlzLnJlbW92ZWQ9ITB9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGEodGhpcy50eXBlLHRoaXMuYnViYmxlcyx0aGlzLmNhbmNlbGFibGUpfSxiLnNldD1mdW5jdGlvbihhKXtmb3IodmFyIGIgaW4gYSl0aGlzW2JdPWFbYl07cmV0dXJuIHRoaXN9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltFdmVudCAodHlwZT1cIit0aGlzLnR5cGUrXCIpXVwifSxjcmVhdGVqcy5FdmVudD1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKCl7dGhpcy5fbGlzdGVuZXJzPW51bGwsdGhpcy5fY2FwdHVyZUxpc3RlbmVycz1udWxsfXZhciBiPWEucHJvdG90eXBlO2EuaW5pdGlhbGl6ZT1mdW5jdGlvbihhKXthLmFkZEV2ZW50TGlzdGVuZXI9Yi5hZGRFdmVudExpc3RlbmVyLGEub249Yi5vbixhLnJlbW92ZUV2ZW50TGlzdGVuZXI9YS5vZmY9Yi5yZW1vdmVFdmVudExpc3RlbmVyLGEucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnM9Yi5yZW1vdmVBbGxFdmVudExpc3RlbmVycyxhLmhhc0V2ZW50TGlzdGVuZXI9Yi5oYXNFdmVudExpc3RlbmVyLGEuZGlzcGF0Y2hFdmVudD1iLmRpc3BhdGNoRXZlbnQsYS5fZGlzcGF0Y2hFdmVudD1iLl9kaXNwYXRjaEV2ZW50LGEud2lsbFRyaWdnZXI9Yi53aWxsVHJpZ2dlcn0sYi5hZGRFdmVudExpc3RlbmVyPWZ1bmN0aW9uKGEsYixjKXt2YXIgZDtkPWM/dGhpcy5fY2FwdHVyZUxpc3RlbmVycz10aGlzLl9jYXB0dXJlTGlzdGVuZXJzfHx7fTp0aGlzLl9saXN0ZW5lcnM9dGhpcy5fbGlzdGVuZXJzfHx7fTt2YXIgZT1kW2FdO3JldHVybiBlJiZ0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoYSxiLGMpLGU9ZFthXSxlP2UucHVzaChiKTpkW2FdPVtiXSxifSxiLm9uPWZ1bmN0aW9uKGEsYixjLGQsZSxmKXtyZXR1cm4gYi5oYW5kbGVFdmVudCYmKGM9Y3x8YixiPWIuaGFuZGxlRXZlbnQpLGM9Y3x8dGhpcyx0aGlzLmFkZEV2ZW50TGlzdGVuZXIoYSxmdW5jdGlvbihhKXtiLmNhbGwoYyxhLGUpLGQmJmEucmVtb3ZlKCl9LGYpfSxiLnJlbW92ZUV2ZW50TGlzdGVuZXI9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWM/dGhpcy5fY2FwdHVyZUxpc3RlbmVyczp0aGlzLl9saXN0ZW5lcnM7aWYoZCl7dmFyIGU9ZFthXTtpZihlKWZvcih2YXIgZj0wLGc9ZS5sZW5ndGg7Zz5mO2YrKylpZihlW2ZdPT1iKXsxPT1nP2RlbGV0ZSBkW2FdOmUuc3BsaWNlKGYsMSk7YnJlYWt9fX0sYi5vZmY9Yi5yZW1vdmVFdmVudExpc3RlbmVyLGIucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnM9ZnVuY3Rpb24oYSl7YT8odGhpcy5fbGlzdGVuZXJzJiZkZWxldGUgdGhpcy5fbGlzdGVuZXJzW2FdLHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMmJmRlbGV0ZSB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzW2FdKTp0aGlzLl9saXN0ZW5lcnM9dGhpcy5fY2FwdHVyZUxpc3RlbmVycz1udWxsfSxiLmRpc3BhdGNoRXZlbnQ9ZnVuY3Rpb24oYSxiLGMpe2lmKFwic3RyaW5nXCI9PXR5cGVvZiBhKXt2YXIgZD10aGlzLl9saXN0ZW5lcnM7aWYoIShifHxkJiZkW2FdKSlyZXR1cm4hMDthPW5ldyBjcmVhdGVqcy5FdmVudChhLGIsYyl9ZWxzZSBhLnRhcmdldCYmYS5jbG9uZSYmKGE9YS5jbG9uZSgpKTt0cnl7YS50YXJnZXQ9dGhpc31jYXRjaChlKXt9aWYoYS5idWJibGVzJiZ0aGlzLnBhcmVudCl7Zm9yKHZhciBmPXRoaXMsZz1bZl07Zi5wYXJlbnQ7KWcucHVzaChmPWYucGFyZW50KTt2YXIgaCxpPWcubGVuZ3RoO2ZvcihoPWktMTtoPj0wJiYhYS5wcm9wYWdhdGlvblN0b3BwZWQ7aC0tKWdbaF0uX2Rpc3BhdGNoRXZlbnQoYSwxKygwPT1oKSk7Zm9yKGg9MTtpPmgmJiFhLnByb3BhZ2F0aW9uU3RvcHBlZDtoKyspZ1toXS5fZGlzcGF0Y2hFdmVudChhLDMpfWVsc2UgdGhpcy5fZGlzcGF0Y2hFdmVudChhLDIpO3JldHVybiFhLmRlZmF1bHRQcmV2ZW50ZWR9LGIuaGFzRXZlbnRMaXN0ZW5lcj1mdW5jdGlvbihhKXt2YXIgYj10aGlzLl9saXN0ZW5lcnMsYz10aGlzLl9jYXB0dXJlTGlzdGVuZXJzO3JldHVybiEhKGImJmJbYV18fGMmJmNbYV0pfSxiLndpbGxUcmlnZ2VyPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYj10aGlzO2I7KXtpZihiLmhhc0V2ZW50TGlzdGVuZXIoYSkpcmV0dXJuITA7Yj1iLnBhcmVudH1yZXR1cm4hMX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0V2ZW50RGlzcGF0Y2hlcl1cIn0sYi5fZGlzcGF0Y2hFdmVudD1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9MT09Yj90aGlzLl9jYXB0dXJlTGlzdGVuZXJzOnRoaXMuX2xpc3RlbmVycztpZihhJiZkKXt2YXIgZT1kW2EudHlwZV07aWYoIWV8fCEoYz1lLmxlbmd0aCkpcmV0dXJuO3RyeXthLmN1cnJlbnRUYXJnZXQ9dGhpc31jYXRjaChmKXt9dHJ5e2EuZXZlbnRQaGFzZT1ifWNhdGNoKGYpe31hLnJlbW92ZWQ9ITEsZT1lLnNsaWNlKCk7Zm9yKHZhciBnPTA7Yz5nJiYhYS5pbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ7ZysrKXt2YXIgaD1lW2ddO2guaGFuZGxlRXZlbnQ/aC5oYW5kbGVFdmVudChhKTpoKGEpLGEucmVtb3ZlZCYmKHRoaXMub2ZmKGEudHlwZSxoLDE9PWIpLGEucmVtb3ZlZD0hMSl9fX0sY3JlYXRlanMuRXZlbnREaXNwYXRjaGVyPWF9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt0aHJvd1wiVGlja2VyIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQuXCJ9YS5SQUZfU1lOQ0hFRD1cInN5bmNoZWRcIixhLlJBRj1cInJhZlwiLGEuVElNRU9VVD1cInRpbWVvdXRcIixhLnVzZVJBRj0hMSxhLnRpbWluZ01vZGU9bnVsbCxhLm1heERlbHRhPTAsYS5wYXVzZWQ9ITEsYS5yZW1vdmVFdmVudExpc3RlbmVyPW51bGwsYS5yZW1vdmVBbGxFdmVudExpc3RlbmVycz1udWxsLGEuZGlzcGF0Y2hFdmVudD1udWxsLGEuaGFzRXZlbnRMaXN0ZW5lcj1udWxsLGEuX2xpc3RlbmVycz1udWxsLGNyZWF0ZWpzLkV2ZW50RGlzcGF0Y2hlci5pbml0aWFsaXplKGEpLGEuX2FkZEV2ZW50TGlzdGVuZXI9YS5hZGRFdmVudExpc3RlbmVyLGEuYWRkRXZlbnRMaXN0ZW5lcj1mdW5jdGlvbigpe3JldHVybiFhLl9pbml0ZWQmJmEuaW5pdCgpLGEuX2FkZEV2ZW50TGlzdGVuZXIuYXBwbHkoYSxhcmd1bWVudHMpfSxhLl9pbml0ZWQ9ITEsYS5fc3RhcnRUaW1lPTAsYS5fcGF1c2VkVGltZT0wLGEuX3RpY2tzPTAsYS5fcGF1c2VkVGlja3M9MCxhLl9pbnRlcnZhbD01MCxhLl9sYXN0VGltZT0wLGEuX3RpbWVzPW51bGwsYS5fdGlja1RpbWVzPW51bGwsYS5fdGltZXJJZD1udWxsLGEuX3JhZj0hMCxhLnNldEludGVydmFsPWZ1bmN0aW9uKGIpe2EuX2ludGVydmFsPWIsYS5faW5pdGVkJiZhLl9zZXR1cFRpY2soKX0sYS5nZXRJbnRlcnZhbD1mdW5jdGlvbigpe3JldHVybiBhLl9pbnRlcnZhbH0sYS5zZXRGUFM9ZnVuY3Rpb24oYil7YS5zZXRJbnRlcnZhbCgxZTMvYil9LGEuZ2V0RlBTPWZ1bmN0aW9uKCl7cmV0dXJuIDFlMy9hLl9pbnRlcnZhbH07dHJ5e09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGEse2ludGVydmFsOntnZXQ6YS5nZXRJbnRlcnZhbCxzZXQ6YS5zZXRJbnRlcnZhbH0sZnJhbWVyYXRlOntnZXQ6YS5nZXRGUFMsc2V0OmEuc2V0RlBTfX0pfWNhdGNoKGIpe2NvbnNvbGUubG9nKGIpfWEuaW5pdD1mdW5jdGlvbigpe2EuX2luaXRlZHx8KGEuX2luaXRlZD0hMCxhLl90aW1lcz1bXSxhLl90aWNrVGltZXM9W10sYS5fc3RhcnRUaW1lPWEuX2dldFRpbWUoKSxhLl90aW1lcy5wdXNoKGEuX2xhc3RUaW1lPTApLGEuaW50ZXJ2YWw9YS5faW50ZXJ2YWwpfSxhLnJlc2V0PWZ1bmN0aW9uKCl7aWYoYS5fcmFmKXt2YXIgYj13aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWV8fHdpbmRvdy53ZWJraXRDYW5jZWxBbmltYXRpb25GcmFtZXx8d2luZG93Lm1vekNhbmNlbEFuaW1hdGlvbkZyYW1lfHx3aW5kb3cub0NhbmNlbEFuaW1hdGlvbkZyYW1lfHx3aW5kb3cubXNDYW5jZWxBbmltYXRpb25GcmFtZTtiJiZiKGEuX3RpbWVySWQpfWVsc2UgY2xlYXJUaW1lb3V0KGEuX3RpbWVySWQpO2EucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnMoXCJ0aWNrXCIpLGEuX3RpbWVySWQ9YS5fdGltZXM9YS5fdGlja1RpbWVzPW51bGwsYS5fc3RhcnRUaW1lPWEuX2xhc3RUaW1lPWEuX3RpY2tzPTAsYS5faW5pdGVkPSExfSxhLmdldE1lYXN1cmVkVGlja1RpbWU9ZnVuY3Rpb24oYil7dmFyIGM9MCxkPWEuX3RpY2tUaW1lcztpZighZHx8ZC5sZW5ndGg8MSlyZXR1cm4tMTtiPU1hdGgubWluKGQubGVuZ3RoLGJ8fDB8YS5nZXRGUFMoKSk7Zm9yKHZhciBlPTA7Yj5lO2UrKyljKz1kW2VdO3JldHVybiBjL2J9LGEuZ2V0TWVhc3VyZWRGUFM9ZnVuY3Rpb24oYil7dmFyIGM9YS5fdGltZXM7cmV0dXJuIWN8fGMubGVuZ3RoPDI/LTE6KGI9TWF0aC5taW4oYy5sZW5ndGgtMSxifHwwfGEuZ2V0RlBTKCkpLDFlMy8oKGNbMF0tY1tiXSkvYikpfSxhLnNldFBhdXNlZD1mdW5jdGlvbihiKXthLnBhdXNlZD1ifSxhLmdldFBhdXNlZD1mdW5jdGlvbigpe3JldHVybiBhLnBhdXNlZH0sYS5nZXRUaW1lPWZ1bmN0aW9uKGIpe3JldHVybiBhLl9zdGFydFRpbWU/YS5fZ2V0VGltZSgpLShiP2EuX3BhdXNlZFRpbWU6MCk6LTF9LGEuZ2V0RXZlbnRUaW1lPWZ1bmN0aW9uKGIpe3JldHVybiBhLl9zdGFydFRpbWU/KGEuX2xhc3RUaW1lfHxhLl9zdGFydFRpbWUpLShiP2EuX3BhdXNlZFRpbWU6MCk6LTF9LGEuZ2V0VGlja3M9ZnVuY3Rpb24oYil7cmV0dXJuIGEuX3RpY2tzLShiP2EuX3BhdXNlZFRpY2tzOjApfSxhLl9oYW5kbGVTeW5jaD1mdW5jdGlvbigpe2EuX3RpbWVySWQ9bnVsbCxhLl9zZXR1cFRpY2soKSxhLl9nZXRUaW1lKCktYS5fbGFzdFRpbWU+PS45NyooYS5faW50ZXJ2YWwtMSkmJmEuX3RpY2soKX0sYS5faGFuZGxlUkFGPWZ1bmN0aW9uKCl7YS5fdGltZXJJZD1udWxsLGEuX3NldHVwVGljaygpLGEuX3RpY2soKX0sYS5faGFuZGxlVGltZW91dD1mdW5jdGlvbigpe2EuX3RpbWVySWQ9bnVsbCxhLl9zZXR1cFRpY2soKSxhLl90aWNrKCl9LGEuX3NldHVwVGljaz1mdW5jdGlvbigpe2lmKG51bGw9PWEuX3RpbWVySWQpe3ZhciBiPWEudGltaW5nTW9kZXx8YS51c2VSQUYmJmEuUkFGX1NZTkNIRUQ7aWYoYj09YS5SQUZfU1lOQ0hFRHx8Yj09YS5SQUYpe3ZhciBjPXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWV8fHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWV8fHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWV8fHdpbmRvdy5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lfHx3aW5kb3cubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWU7aWYoYylyZXR1cm4gYS5fdGltZXJJZD1jKGI9PWEuUkFGP2EuX2hhbmRsZVJBRjphLl9oYW5kbGVTeW5jaCksdm9pZChhLl9yYWY9ITApfWEuX3JhZj0hMSxhLl90aW1lcklkPXNldFRpbWVvdXQoYS5faGFuZGxlVGltZW91dCxhLl9pbnRlcnZhbCl9fSxhLl90aWNrPWZ1bmN0aW9uKCl7dmFyIGI9YS5wYXVzZWQsYz1hLl9nZXRUaW1lKCksZD1jLWEuX2xhc3RUaW1lO2lmKGEuX2xhc3RUaW1lPWMsYS5fdGlja3MrKyxiJiYoYS5fcGF1c2VkVGlja3MrKyxhLl9wYXVzZWRUaW1lKz1kKSxhLmhhc0V2ZW50TGlzdGVuZXIoXCJ0aWNrXCIpKXt2YXIgZT1uZXcgY3JlYXRlanMuRXZlbnQoXCJ0aWNrXCIpLGY9YS5tYXhEZWx0YTtlLmRlbHRhPWYmJmQ+Zj9mOmQsZS5wYXVzZWQ9YixlLnRpbWU9YyxlLnJ1blRpbWU9Yy1hLl9wYXVzZWRUaW1lLGEuZGlzcGF0Y2hFdmVudChlKX1mb3IoYS5fdGlja1RpbWVzLnVuc2hpZnQoYS5fZ2V0VGltZSgpLWMpO2EuX3RpY2tUaW1lcy5sZW5ndGg+MTAwOylhLl90aWNrVGltZXMucG9wKCk7Zm9yKGEuX3RpbWVzLnVuc2hpZnQoYyk7YS5fdGltZXMubGVuZ3RoPjEwMDspYS5fdGltZXMucG9wKCl9O3ZhciBjPXdpbmRvdy5wZXJmb3JtYW5jZSYmKHBlcmZvcm1hbmNlLm5vd3x8cGVyZm9ybWFuY2UubW96Tm93fHxwZXJmb3JtYW5jZS5tc05vd3x8cGVyZm9ybWFuY2Uub05vd3x8cGVyZm9ybWFuY2Uud2Via2l0Tm93KTthLl9nZXRUaW1lPWZ1bmN0aW9uKCl7cmV0dXJuKGMmJmMuY2FsbChwZXJmb3JtYW5jZSl8fChuZXcgRGF0ZSkuZ2V0VGltZSgpKS1hLl9zdGFydFRpbWV9LGNyZWF0ZWpzLlRpY2tlcj1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKCl7dGhyb3dcIlVJRCBjYW5ub3QgYmUgaW5zdGFudGlhdGVkXCJ9YS5fbmV4dElEPTAsYS5nZXQ9ZnVuY3Rpb24oKXtyZXR1cm4gYS5fbmV4dElEKyt9LGNyZWF0ZWpzLlVJRD1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjLGQsZSxmLGcsaCxpLGosayl7dGhpcy5FdmVudF9jb25zdHJ1Y3RvcihhLGIsYyksdGhpcy5zdGFnZVg9ZCx0aGlzLnN0YWdlWT1lLHRoaXMucmF3WD1udWxsPT1pP2Q6aSx0aGlzLnJhd1k9bnVsbD09aj9lOmosdGhpcy5uYXRpdmVFdmVudD1mLHRoaXMucG9pbnRlcklEPWcsdGhpcy5wcmltYXJ5PSEhaCx0aGlzLnJlbGF0ZWRUYXJnZXQ9a312YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5FdmVudCk7Yi5fZ2V0X2xvY2FsWD1mdW5jdGlvbigpe3JldHVybiB0aGlzLmN1cnJlbnRUYXJnZXQuZ2xvYmFsVG9Mb2NhbCh0aGlzLnJhd1gsdGhpcy5yYXdZKS54fSxiLl9nZXRfbG9jYWxZPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY3VycmVudFRhcmdldC5nbG9iYWxUb0xvY2FsKHRoaXMucmF3WCx0aGlzLnJhd1kpLnl9LGIuX2dldF9pc1RvdWNoPWZ1bmN0aW9uKCl7cmV0dXJuLTEhPT10aGlzLnBvaW50ZXJJRH07dHJ5e09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGIse2xvY2FsWDp7Z2V0OmIuX2dldF9sb2NhbFh9LGxvY2FsWTp7Z2V0OmIuX2dldF9sb2NhbFl9LGlzVG91Y2g6e2dldDpiLl9nZXRfaXNUb3VjaH19KX1jYXRjaChjKXt9Yi5jbG9uZT1mdW5jdGlvbigpe3JldHVybiBuZXcgYSh0aGlzLnR5cGUsdGhpcy5idWJibGVzLHRoaXMuY2FuY2VsYWJsZSx0aGlzLnN0YWdlWCx0aGlzLnN0YWdlWSx0aGlzLm5hdGl2ZUV2ZW50LHRoaXMucG9pbnRlcklELHRoaXMucHJpbWFyeSx0aGlzLnJhd1gsdGhpcy5yYXdZKX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW01vdXNlRXZlbnQgKHR5cGU9XCIrdGhpcy50eXBlK1wiIHN0YWdlWD1cIit0aGlzLnN0YWdlWCtcIiBzdGFnZVk9XCIrdGhpcy5zdGFnZVkrXCIpXVwifSxjcmVhdGVqcy5Nb3VzZUV2ZW50PWNyZWF0ZWpzLnByb21vdGUoYSxcIkV2ZW50XCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjLGQsZSxmKXt0aGlzLnNldFZhbHVlcyhhLGIsYyxkLGUsZil9dmFyIGI9YS5wcm90b3R5cGU7YS5ERUdfVE9fUkFEPU1hdGguUEkvMTgwLGEuaWRlbnRpdHk9bnVsbCxiLnNldFZhbHVlcz1mdW5jdGlvbihhLGIsYyxkLGUsZil7cmV0dXJuIHRoaXMuYT1udWxsPT1hPzE6YSx0aGlzLmI9Ynx8MCx0aGlzLmM9Y3x8MCx0aGlzLmQ9bnVsbD09ZD8xOmQsdGhpcy50eD1lfHwwLHRoaXMudHk9Znx8MCx0aGlzfSxiLmFwcGVuZD1mdW5jdGlvbihhLGIsYyxkLGUsZil7dmFyIGc9dGhpcy5hLGg9dGhpcy5iLGk9dGhpcy5jLGo9dGhpcy5kO3JldHVybigxIT1hfHwwIT1ifHwwIT1jfHwxIT1kKSYmKHRoaXMuYT1nKmEraSpiLHRoaXMuYj1oKmEraipiLHRoaXMuYz1nKmMraSpkLHRoaXMuZD1oKmMraipkKSx0aGlzLnR4PWcqZStpKmYrdGhpcy50eCx0aGlzLnR5PWgqZStqKmYrdGhpcy50eSx0aGlzfSxiLnByZXBlbmQ9ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe3ZhciBnPXRoaXMuYSxoPXRoaXMuYyxpPXRoaXMudHg7cmV0dXJuIHRoaXMuYT1hKmcrYyp0aGlzLmIsdGhpcy5iPWIqZytkKnRoaXMuYix0aGlzLmM9YSpoK2MqdGhpcy5kLHRoaXMuZD1iKmgrZCp0aGlzLmQsdGhpcy50eD1hKmkrYyp0aGlzLnR5K2UsdGhpcy50eT1iKmkrZCp0aGlzLnR5K2YsdGhpc30sYi5hcHBlbmRNYXRyaXg9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuYXBwZW5kKGEuYSxhLmIsYS5jLGEuZCxhLnR4LGEudHkpfSxiLnByZXBlbmRNYXRyaXg9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucHJlcGVuZChhLmEsYS5iLGEuYyxhLmQsYS50eCxhLnR5KX0sYi5hcHBlbmRUcmFuc2Zvcm09ZnVuY3Rpb24oYixjLGQsZSxmLGcsaCxpLGope2lmKGYlMzYwKXZhciBrPWYqYS5ERUdfVE9fUkFELGw9TWF0aC5jb3MoayksbT1NYXRoLnNpbihrKTtlbHNlIGw9MSxtPTA7cmV0dXJuIGd8fGg/KGcqPWEuREVHX1RPX1JBRCxoKj1hLkRFR19UT19SQUQsdGhpcy5hcHBlbmQoTWF0aC5jb3MoaCksTWF0aC5zaW4oaCksLU1hdGguc2luKGcpLE1hdGguY29zKGcpLGIsYyksdGhpcy5hcHBlbmQobCpkLG0qZCwtbSplLGwqZSwwLDApKTp0aGlzLmFwcGVuZChsKmQsbSpkLC1tKmUsbCplLGIsYyksKGl8fGopJiYodGhpcy50eC09aSp0aGlzLmEraip0aGlzLmMsdGhpcy50eS09aSp0aGlzLmIraip0aGlzLmQpLHRoaXN9LGIucHJlcGVuZFRyYW5zZm9ybT1mdW5jdGlvbihiLGMsZCxlLGYsZyxoLGksail7aWYoZiUzNjApdmFyIGs9ZiphLkRFR19UT19SQUQsbD1NYXRoLmNvcyhrKSxtPU1hdGguc2luKGspO2Vsc2UgbD0xLG09MDtyZXR1cm4oaXx8aikmJih0aGlzLnR4LT1pLHRoaXMudHktPWopLGd8fGg/KGcqPWEuREVHX1RPX1JBRCxoKj1hLkRFR19UT19SQUQsdGhpcy5wcmVwZW5kKGwqZCxtKmQsLW0qZSxsKmUsMCwwKSx0aGlzLnByZXBlbmQoTWF0aC5jb3MoaCksTWF0aC5zaW4oaCksLU1hdGguc2luKGcpLE1hdGguY29zKGcpLGIsYykpOnRoaXMucHJlcGVuZChsKmQsbSpkLC1tKmUsbCplLGIsYyksdGhpc30sYi5yb3RhdGU9ZnVuY3Rpb24oYil7Yio9YS5ERUdfVE9fUkFEO3ZhciBjPU1hdGguY29zKGIpLGQ9TWF0aC5zaW4oYiksZT10aGlzLmEsZj10aGlzLmI7cmV0dXJuIHRoaXMuYT1lKmMrdGhpcy5jKmQsdGhpcy5iPWYqYyt0aGlzLmQqZCx0aGlzLmM9LWUqZCt0aGlzLmMqYyx0aGlzLmQ9LWYqZCt0aGlzLmQqYyx0aGlzfSxiLnNrZXc9ZnVuY3Rpb24oYixjKXtyZXR1cm4gYio9YS5ERUdfVE9fUkFELGMqPWEuREVHX1RPX1JBRCx0aGlzLmFwcGVuZChNYXRoLmNvcyhjKSxNYXRoLnNpbihjKSwtTWF0aC5zaW4oYiksTWF0aC5jb3MoYiksMCwwKSx0aGlzfSxiLnNjYWxlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuYSo9YSx0aGlzLmIqPWEsdGhpcy5jKj1iLHRoaXMuZCo9Yix0aGlzfSxiLnRyYW5zbGF0ZT1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLnR4Kz10aGlzLmEqYSt0aGlzLmMqYix0aGlzLnR5Kz10aGlzLmIqYSt0aGlzLmQqYix0aGlzfSxiLmlkZW50aXR5PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYT10aGlzLmQ9MSx0aGlzLmI9dGhpcy5jPXRoaXMudHg9dGhpcy50eT0wLHRoaXN9LGIuaW52ZXJ0PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5hLGI9dGhpcy5iLGM9dGhpcy5jLGQ9dGhpcy5kLGU9dGhpcy50eCxmPWEqZC1iKmM7cmV0dXJuIHRoaXMuYT1kL2YsdGhpcy5iPS1iL2YsdGhpcy5jPS1jL2YsdGhpcy5kPWEvZix0aGlzLnR4PShjKnRoaXMudHktZCplKS9mLHRoaXMudHk9LShhKnRoaXMudHktYiplKS9mLHRoaXN9LGIuaXNJZGVudGl0eT1mdW5jdGlvbigpe3JldHVybiAwPT09dGhpcy50eCYmMD09PXRoaXMudHkmJjE9PT10aGlzLmEmJjA9PT10aGlzLmImJjA9PT10aGlzLmMmJjE9PT10aGlzLmR9LGIuZXF1YWxzPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnR4PT09YS50eCYmdGhpcy50eT09PWEudHkmJnRoaXMuYT09PWEuYSYmdGhpcy5iPT09YS5iJiZ0aGlzLmM9PT1hLmMmJnRoaXMuZD09PWEuZH0sYi50cmFuc2Zvcm1Qb2ludD1mdW5jdGlvbihhLGIsYyl7cmV0dXJuIGM9Y3x8e30sYy54PWEqdGhpcy5hK2IqdGhpcy5jK3RoaXMudHgsYy55PWEqdGhpcy5iK2IqdGhpcy5kK3RoaXMudHksY30sYi5kZWNvbXBvc2U9ZnVuY3Rpb24oYil7bnVsbD09YiYmKGI9e30pLGIueD10aGlzLnR4LGIueT10aGlzLnR5LGIuc2NhbGVYPU1hdGguc3FydCh0aGlzLmEqdGhpcy5hK3RoaXMuYip0aGlzLmIpLGIuc2NhbGVZPU1hdGguc3FydCh0aGlzLmMqdGhpcy5jK3RoaXMuZCp0aGlzLmQpO3ZhciBjPU1hdGguYXRhbjIoLXRoaXMuYyx0aGlzLmQpLGQ9TWF0aC5hdGFuMih0aGlzLmIsdGhpcy5hKSxlPU1hdGguYWJzKDEtYy9kKTtyZXR1cm4gMWUtNT5lPyhiLnJvdGF0aW9uPWQvYS5ERUdfVE9fUkFELHRoaXMuYTwwJiZ0aGlzLmQ+PTAmJihiLnJvdGF0aW9uKz1iLnJvdGF0aW9uPD0wPzE4MDotMTgwKSxiLnNrZXdYPWIuc2tld1k9MCk6KGIuc2tld1g9Yy9hLkRFR19UT19SQUQsYi5za2V3WT1kL2EuREVHX1RPX1JBRCksYn0sYi5jb3B5PWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnNldFZhbHVlcyhhLmEsYS5iLGEuYyxhLmQsYS50eCxhLnR5KX0sYi5jbG9uZT1mdW5jdGlvbigpe3JldHVybiBuZXcgYSh0aGlzLmEsdGhpcy5iLHRoaXMuYyx0aGlzLmQsdGhpcy50eCx0aGlzLnR5KX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW01hdHJpeDJEIChhPVwiK3RoaXMuYStcIiBiPVwiK3RoaXMuYitcIiBjPVwiK3RoaXMuYytcIiBkPVwiK3RoaXMuZCtcIiB0eD1cIit0aGlzLnR4K1wiIHR5PVwiK3RoaXMudHkrXCIpXVwifSxhLmlkZW50aXR5PW5ldyBhLGNyZWF0ZWpzLk1hdHJpeDJEPWF9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiLGMsZCxlKXt0aGlzLnNldFZhbHVlcyhhLGIsYyxkLGUpfXZhciBiPWEucHJvdG90eXBlO2Iuc2V0VmFsdWVzPWZ1bmN0aW9uKGEsYixjLGQsZSl7cmV0dXJuIHRoaXMudmlzaWJsZT1udWxsPT1hPyEwOiEhYSx0aGlzLmFscGhhPW51bGw9PWI/MTpiLHRoaXMuc2hhZG93PWMsdGhpcy5jb21wb3NpdGVPcGVyYXRpb249ZCx0aGlzLm1hdHJpeD1lfHx0aGlzLm1hdHJpeCYmdGhpcy5tYXRyaXguaWRlbnRpdHkoKXx8bmV3IGNyZWF0ZWpzLk1hdHJpeDJELHRoaXN9LGIuYXBwZW5kPWZ1bmN0aW9uKGEsYixjLGQsZSl7cmV0dXJuIHRoaXMuYWxwaGEqPWIsdGhpcy5zaGFkb3c9Y3x8dGhpcy5zaGFkb3csdGhpcy5jb21wb3NpdGVPcGVyYXRpb249ZHx8dGhpcy5jb21wb3NpdGVPcGVyYXRpb24sdGhpcy52aXNpYmxlPXRoaXMudmlzaWJsZSYmYSxlJiZ0aGlzLm1hdHJpeC5hcHBlbmRNYXRyaXgoZSksdGhpc30sYi5wcmVwZW5kPWZ1bmN0aW9uKGEsYixjLGQsZSl7cmV0dXJuIHRoaXMuYWxwaGEqPWIsdGhpcy5zaGFkb3c9dGhpcy5zaGFkb3d8fGMsdGhpcy5jb21wb3NpdGVPcGVyYXRpb249dGhpcy5jb21wb3NpdGVPcGVyYXRpb258fGQsdGhpcy52aXNpYmxlPXRoaXMudmlzaWJsZSYmYSxlJiZ0aGlzLm1hdHJpeC5wcmVwZW5kTWF0cml4KGUpLHRoaXN9LGIuaWRlbnRpdHk9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy52aXNpYmxlPSEwLHRoaXMuYWxwaGE9MSx0aGlzLnNoYWRvdz10aGlzLmNvbXBvc2l0ZU9wZXJhdGlvbj1udWxsLHRoaXMubWF0cml4LmlkZW50aXR5KCksdGhpc30sYi5jbG9uZT1mdW5jdGlvbigpe3JldHVybiBuZXcgYSh0aGlzLmFscGhhLHRoaXMuc2hhZG93LHRoaXMuY29tcG9zaXRlT3BlcmF0aW9uLHRoaXMudmlzaWJsZSx0aGlzLm1hdHJpeC5jbG9uZSgpKX0sY3JlYXRlanMuRGlzcGxheVByb3BzPWF9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiKXt0aGlzLnNldFZhbHVlcyhhLGIpfXZhciBiPWEucHJvdG90eXBlO2Iuc2V0VmFsdWVzPWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMueD1hfHwwLHRoaXMueT1ifHwwLHRoaXN9LGIuY29weT1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy54PWEueCx0aGlzLnk9YS55LHRoaXN9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGEodGhpcy54LHRoaXMueSl9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltQb2ludCAoeD1cIit0aGlzLngrXCIgeT1cIit0aGlzLnkrXCIpXVwifSxjcmVhdGVqcy5Qb2ludD1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjLGQpe3RoaXMuc2V0VmFsdWVzKGEsYixjLGQpfXZhciBiPWEucHJvdG90eXBlO2Iuc2V0VmFsdWVzPWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLng9YXx8MCx0aGlzLnk9Ynx8MCx0aGlzLndpZHRoPWN8fDAsdGhpcy5oZWlnaHQ9ZHx8MCx0aGlzfSxiLmV4dGVuZD1mdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gYz1jfHwwLGQ9ZHx8MCxhK2M+dGhpcy54K3RoaXMud2lkdGgmJih0aGlzLndpZHRoPWErYy10aGlzLngpLGIrZD50aGlzLnkrdGhpcy5oZWlnaHQmJih0aGlzLmhlaWdodD1iK2QtdGhpcy55KSxhPHRoaXMueCYmKHRoaXMud2lkdGgrPXRoaXMueC1hLHRoaXMueD1hKSxiPHRoaXMueSYmKHRoaXMuaGVpZ2h0Kz10aGlzLnktYix0aGlzLnk9YiksdGhpc30sYi5wYWQ9ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIHRoaXMueC09Yix0aGlzLnktPWEsdGhpcy53aWR0aCs9YitkLHRoaXMuaGVpZ2h0Kz1hK2MsdGhpc30sYi5jb3B5PWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnNldFZhbHVlcyhhLngsYS55LGEud2lkdGgsYS5oZWlnaHQpfSxiLmNvbnRhaW5zPWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiBjPWN8fDAsZD1kfHwwLGE+PXRoaXMueCYmYStjPD10aGlzLngrdGhpcy53aWR0aCYmYj49dGhpcy55JiZiK2Q8PXRoaXMueSt0aGlzLmhlaWdodH0sYi51bmlvbj1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5jbG9uZSgpLmV4dGVuZChhLngsYS55LGEud2lkdGgsYS5oZWlnaHQpfSxiLmludGVyc2VjdGlvbj1mdW5jdGlvbihiKXt2YXIgYz1iLngsZD1iLnksZT1jK2Iud2lkdGgsZj1kK2IuaGVpZ2h0O3JldHVybiB0aGlzLng+YyYmKGM9dGhpcy54KSx0aGlzLnk+ZCYmKGQ9dGhpcy55KSx0aGlzLngrdGhpcy53aWR0aDxlJiYoZT10aGlzLngrdGhpcy53aWR0aCksdGhpcy55K3RoaXMuaGVpZ2h0PGYmJihmPXRoaXMueSt0aGlzLmhlaWdodCksYz49ZXx8ZD49Zj9udWxsOm5ldyBhKGMsZCxlLWMsZi1kKX0sYi5pbnRlcnNlY3RzPWZ1bmN0aW9uKGEpe3JldHVybiBhLng8PXRoaXMueCt0aGlzLndpZHRoJiZ0aGlzLng8PWEueCthLndpZHRoJiZhLnk8PXRoaXMueSt0aGlzLmhlaWdodCYmdGhpcy55PD1hLnkrYS5oZWlnaHR9LGIuaXNFbXB0eT1mdW5jdGlvbigpe3JldHVybiB0aGlzLndpZHRoPD0wfHx0aGlzLmhlaWdodDw9MH0sYi5jbG9uZT1mdW5jdGlvbigpe3JldHVybiBuZXcgYSh0aGlzLngsdGhpcy55LHRoaXMud2lkdGgsdGhpcy5oZWlnaHQpfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbUmVjdGFuZ2xlICh4PVwiK3RoaXMueCtcIiB5PVwiK3RoaXMueStcIiB3aWR0aD1cIit0aGlzLndpZHRoK1wiIGhlaWdodD1cIit0aGlzLmhlaWdodCtcIildXCJ9LGNyZWF0ZWpzLlJlY3RhbmdsZT1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjLGQsZSxmLGcpe2EuYWRkRXZlbnRMaXN0ZW5lciYmKHRoaXMudGFyZ2V0PWEsdGhpcy5vdmVyTGFiZWw9bnVsbD09Yz9cIm92ZXJcIjpjLHRoaXMub3V0TGFiZWw9bnVsbD09Yj9cIm91dFwiOmIsdGhpcy5kb3duTGFiZWw9bnVsbD09ZD9cImRvd25cIjpkLHRoaXMucGxheT1lLHRoaXMuX2lzUHJlc3NlZD0hMSx0aGlzLl9pc092ZXI9ITEsdGhpcy5fZW5hYmxlZD0hMSxhLm1vdXNlQ2hpbGRyZW49ITEsdGhpcy5lbmFibGVkPSEwLHRoaXMuaGFuZGxlRXZlbnQoe30pLGYmJihnJiYoZi5hY3Rpb25zRW5hYmxlZD0hMSxmLmdvdG9BbmRTdG9wJiZmLmdvdG9BbmRTdG9wKGcpKSxhLmhpdEFyZWE9ZikpfXZhciBiPWEucHJvdG90eXBlO2Iuc2V0RW5hYmxlZD1mdW5jdGlvbihhKXtpZihhIT10aGlzLl9lbmFibGVkKXt2YXIgYj10aGlzLnRhcmdldDt0aGlzLl9lbmFibGVkPWEsYT8oYi5jdXJzb3I9XCJwb2ludGVyXCIsYi5hZGRFdmVudExpc3RlbmVyKFwicm9sbG92ZXJcIix0aGlzKSxiLmFkZEV2ZW50TGlzdGVuZXIoXCJyb2xsb3V0XCIsdGhpcyksYi5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsdGhpcyksYi5hZGRFdmVudExpc3RlbmVyKFwicHJlc3N1cFwiLHRoaXMpLGIuX3Jlc2V0JiYoYi5fX3Jlc2V0PWIuX3Jlc2V0LGIuX3Jlc2V0PXRoaXMuX3Jlc2V0KSk6KGIuY3Vyc29yPW51bGwsYi5yZW1vdmVFdmVudExpc3RlbmVyKFwicm9sbG92ZXJcIix0aGlzKSxiLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJyb2xsb3V0XCIsdGhpcyksYi5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsdGhpcyksYi5yZW1vdmVFdmVudExpc3RlbmVyKFwicHJlc3N1cFwiLHRoaXMpLGIuX19yZXNldCYmKGIuX3Jlc2V0PWIuX19yZXNldCxkZWxldGUgYi5fX3Jlc2V0KSl9fSxiLmdldEVuYWJsZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZW5hYmxlZH07dHJ5e09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGIse2VuYWJsZWQ6e2dldDpiLmdldEVuYWJsZWQsc2V0OmIuc2V0RW5hYmxlZH19KX1jYXRjaChjKXt9Yi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0J1dHRvbkhlbHBlcl1cIn0sYi5oYW5kbGVFdmVudD1mdW5jdGlvbihhKXt2YXIgYixjPXRoaXMudGFyZ2V0LGQ9YS50eXBlO1wibW91c2Vkb3duXCI9PWQ/KHRoaXMuX2lzUHJlc3NlZD0hMCxiPXRoaXMuZG93bkxhYmVsKTpcInByZXNzdXBcIj09ZD8odGhpcy5faXNQcmVzc2VkPSExLGI9dGhpcy5faXNPdmVyP3RoaXMub3ZlckxhYmVsOnRoaXMub3V0TGFiZWwpOlwicm9sbG92ZXJcIj09ZD8odGhpcy5faXNPdmVyPSEwLGI9dGhpcy5faXNQcmVzc2VkP3RoaXMuZG93bkxhYmVsOnRoaXMub3ZlckxhYmVsKToodGhpcy5faXNPdmVyPSExLGI9dGhpcy5faXNQcmVzc2VkP3RoaXMub3ZlckxhYmVsOnRoaXMub3V0TGFiZWwpLHRoaXMucGxheT9jLmdvdG9BbmRQbGF5JiZjLmdvdG9BbmRQbGF5KGIpOmMuZ290b0FuZFN0b3AmJmMuZ290b0FuZFN0b3AoYil9LGIuX3Jlc2V0PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5wYXVzZWQ7dGhpcy5fX3Jlc2V0KCksdGhpcy5wYXVzZWQ9YX0sY3JlYXRlanMuQnV0dG9uSGVscGVyPWF9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiLGMsZCl7dGhpcy5jb2xvcj1hfHxcImJsYWNrXCIsdGhpcy5vZmZzZXRYPWJ8fDAsdGhpcy5vZmZzZXRZPWN8fDAsdGhpcy5ibHVyPWR8fDB9dmFyIGI9YS5wcm90b3R5cGU7YS5pZGVudGl0eT1uZXcgYShcInRyYW5zcGFyZW50XCIsMCwwLDApLGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltTaGFkb3ddXCJ9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGEodGhpcy5jb2xvcix0aGlzLm9mZnNldFgsdGhpcy5vZmZzZXRZLHRoaXMuYmx1cil9LGNyZWF0ZWpzLlNoYWRvdz1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMuRXZlbnREaXNwYXRjaGVyX2NvbnN0cnVjdG9yKCksdGhpcy5jb21wbGV0ZT0hMCx0aGlzLmZyYW1lcmF0ZT0wLHRoaXMuX2FuaW1hdGlvbnM9bnVsbCx0aGlzLl9mcmFtZXM9bnVsbCx0aGlzLl9pbWFnZXM9bnVsbCx0aGlzLl9kYXRhPW51bGwsdGhpcy5fbG9hZENvdW50PTAsdGhpcy5fZnJhbWVIZWlnaHQ9MCx0aGlzLl9mcmFtZVdpZHRoPTAsdGhpcy5fbnVtRnJhbWVzPTAsdGhpcy5fcmVnWD0wLHRoaXMuX3JlZ1k9MCx0aGlzLl9zcGFjaW5nPTAsdGhpcy5fbWFyZ2luPTAsdGhpcy5fcGFyc2VEYXRhKGEpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkV2ZW50RGlzcGF0Y2hlcik7Yi5nZXRBbmltYXRpb25zPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2FuaW1hdGlvbnMuc2xpY2UoKX07dHJ5e09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGIse2FuaW1hdGlvbnM6e2dldDpiLmdldEFuaW1hdGlvbnN9fSl9Y2F0Y2goYyl7fWIuZ2V0TnVtRnJhbWVzPWZ1bmN0aW9uKGEpe2lmKG51bGw9PWEpcmV0dXJuIHRoaXMuX2ZyYW1lcz90aGlzLl9mcmFtZXMubGVuZ3RoOnRoaXMuX251bUZyYW1lc3x8MDt2YXIgYj10aGlzLl9kYXRhW2FdO3JldHVybiBudWxsPT1iPzA6Yi5mcmFtZXMubGVuZ3RofSxiLmdldEFuaW1hdGlvbj1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5fZGF0YVthXX0sYi5nZXRGcmFtZT1mdW5jdGlvbihhKXt2YXIgYjtyZXR1cm4gdGhpcy5fZnJhbWVzJiYoYj10aGlzLl9mcmFtZXNbYV0pP2I6bnVsbH0sYi5nZXRGcmFtZUJvdW5kcz1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuZ2V0RnJhbWUoYSk7cmV0dXJuIGM/KGJ8fG5ldyBjcmVhdGVqcy5SZWN0YW5nbGUpLnNldFZhbHVlcygtYy5yZWdYLC1jLnJlZ1ksYy5yZWN0LndpZHRoLGMucmVjdC5oZWlnaHQpOm51bGx9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltTcHJpdGVTaGVldF1cIn0sYi5jbG9uZT1mdW5jdGlvbigpe3Rocm93XCJTcHJpdGVTaGVldCBjYW5ub3QgYmUgY2xvbmVkLlwifSxiLl9wYXJzZURhdGE9ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGU7aWYobnVsbCE9YSl7aWYodGhpcy5mcmFtZXJhdGU9YS5mcmFtZXJhdGV8fDAsYS5pbWFnZXMmJihjPWEuaW1hZ2VzLmxlbmd0aCk+MClmb3IoZT10aGlzLl9pbWFnZXM9W10sYj0wO2M+YjtiKyspe3ZhciBmPWEuaW1hZ2VzW2JdO2lmKFwic3RyaW5nXCI9PXR5cGVvZiBmKXt2YXIgZz1mO2Y9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKSxmLnNyYz1nfWUucHVzaChmKSxmLmdldENvbnRleHR8fGYubmF0dXJhbFdpZHRofHwodGhpcy5fbG9hZENvdW50KyssdGhpcy5jb21wbGV0ZT0hMSxmdW5jdGlvbihhLGIpe2Yub25sb2FkPWZ1bmN0aW9uKCl7YS5faGFuZGxlSW1hZ2VMb2FkKGIpfX0odGhpcyxnKSxmdW5jdGlvbihhLGIpe2Yub25lcnJvcj1mdW5jdGlvbigpe2EuX2hhbmRsZUltYWdlRXJyb3IoYil9fSh0aGlzLGcpKX1pZihudWxsPT1hLmZyYW1lcyk7ZWxzZSBpZihBcnJheS5pc0FycmF5KGEuZnJhbWVzKSlmb3IodGhpcy5fZnJhbWVzPVtdLGU9YS5mcmFtZXMsYj0wLGM9ZS5sZW5ndGg7Yz5iO2IrKyl7dmFyIGg9ZVtiXTt0aGlzLl9mcmFtZXMucHVzaCh7aW1hZ2U6dGhpcy5faW1hZ2VzW2hbNF0/aFs0XTowXSxyZWN0Om5ldyBjcmVhdGVqcy5SZWN0YW5nbGUoaFswXSxoWzFdLGhbMl0saFszXSkscmVnWDpoWzVdfHwwLHJlZ1k6aFs2XXx8MH0pfWVsc2UgZD1hLmZyYW1lcyx0aGlzLl9mcmFtZVdpZHRoPWQud2lkdGgsdGhpcy5fZnJhbWVIZWlnaHQ9ZC5oZWlnaHQsdGhpcy5fcmVnWD1kLnJlZ1h8fDAsdGhpcy5fcmVnWT1kLnJlZ1l8fDAsdGhpcy5fc3BhY2luZz1kLnNwYWNpbmd8fDAsdGhpcy5fbWFyZ2luPWQubWFyZ2lufHwwLHRoaXMuX251bUZyYW1lcz1kLmNvdW50LDA9PXRoaXMuX2xvYWRDb3VudCYmdGhpcy5fY2FsY3VsYXRlRnJhbWVzKCk7aWYodGhpcy5fYW5pbWF0aW9ucz1bXSxudWxsIT0oZD1hLmFuaW1hdGlvbnMpKXt0aGlzLl9kYXRhPXt9O3ZhciBpO2ZvcihpIGluIGQpe3ZhciBqPXtuYW1lOml9LGs9ZFtpXTtpZihcIm51bWJlclwiPT10eXBlb2YgayllPWouZnJhbWVzPVtrXTtlbHNlIGlmKEFycmF5LmlzQXJyYXkoaykpaWYoMT09ay5sZW5ndGgpai5mcmFtZXM9W2tbMF1dO2Vsc2UgZm9yKGouc3BlZWQ9a1szXSxqLm5leHQ9a1syXSxlPWouZnJhbWVzPVtdLGI9a1swXTtiPD1rWzFdO2IrKyllLnB1c2goYik7ZWxzZXtqLnNwZWVkPWsuc3BlZWQsai5uZXh0PWsubmV4dDt2YXIgbD1rLmZyYW1lcztlPWouZnJhbWVzPVwibnVtYmVyXCI9PXR5cGVvZiBsP1tsXTpsLnNsaWNlKDApfShqLm5leHQ9PT0hMHx8dm9pZCAwPT09ai5uZXh0KSYmKGoubmV4dD1pKSwoai5uZXh0PT09ITF8fGUubGVuZ3RoPDImJmoubmV4dD09aSkmJihqLm5leHQ9bnVsbCksai5zcGVlZHx8KGouc3BlZWQ9MSksdGhpcy5fYW5pbWF0aW9ucy5wdXNoKGkpLHRoaXMuX2RhdGFbaV09an19fX0sYi5faGFuZGxlSW1hZ2VMb2FkPWZ1bmN0aW9uKGEpezA9PS0tdGhpcy5fbG9hZENvdW50JiYodGhpcy5fY2FsY3VsYXRlRnJhbWVzKCksdGhpcy5jb21wbGV0ZT0hMCx0aGlzLmRpc3BhdGNoRXZlbnQoXCJjb21wbGV0ZVwiKSl9LGIuX2hhbmRsZUltYWdlRXJyb3I9ZnVuY3Rpb24oYSl7dmFyIGI9bmV3IGNyZWF0ZWpzLkV2ZW50KFwiZXJyb3JcIik7Yi5zcmM9YSx0aGlzLmRpc3BhdGNoRXZlbnQoYiksMD09LS10aGlzLl9sb2FkQ291bnQmJnRoaXMuZGlzcGF0Y2hFdmVudChcImNvbXBsZXRlXCIpfSxiLl9jYWxjdWxhdGVGcmFtZXM9ZnVuY3Rpb24oKXtpZighdGhpcy5fZnJhbWVzJiYwIT10aGlzLl9mcmFtZVdpZHRoKXt0aGlzLl9mcmFtZXM9W107dmFyIGE9dGhpcy5fbnVtRnJhbWVzfHwxZTUsYj0wLGM9dGhpcy5fZnJhbWVXaWR0aCxkPXRoaXMuX2ZyYW1lSGVpZ2h0LGU9dGhpcy5fc3BhY2luZyxmPXRoaXMuX21hcmdpbjthOmZvcih2YXIgZz0wLGg9dGhpcy5faW1hZ2VzO2c8aC5sZW5ndGg7ZysrKWZvcih2YXIgaT1oW2ddLGo9aS53aWR0aCxrPWkuaGVpZ2h0LGw9ZjtrLWYtZD49bDspe2Zvcih2YXIgbT1mO2otZi1jPj1tOyl7aWYoYj49YSlicmVhayBhO2IrKyx0aGlzLl9mcmFtZXMucHVzaCh7aW1hZ2U6aSxyZWN0Om5ldyBjcmVhdGVqcy5SZWN0YW5nbGUobSxsLGMsZCkscmVnWDp0aGlzLl9yZWdYLHJlZ1k6dGhpcy5fcmVnWX0pLG0rPWMrZX1sKz1kK2V9dGhpcy5fbnVtRnJhbWVzPWJ9fSxjcmVhdGVqcy5TcHJpdGVTaGVldD1jcmVhdGVqcy5wcm9tb3RlKGEsXCJFdmVudERpc3BhdGNoZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt0aGlzLmNvbW1hbmQ9bnVsbCx0aGlzLl9zdHJva2U9bnVsbCx0aGlzLl9zdHJva2VTdHlsZT1udWxsLHRoaXMuX29sZFN0cm9rZVN0eWxlPW51bGwsdGhpcy5fc3Ryb2tlRGFzaD1udWxsLHRoaXMuX29sZFN0cm9rZURhc2g9bnVsbCx0aGlzLl9zdHJva2VJZ25vcmVTY2FsZT0hMSx0aGlzLl9maWxsPW51bGwsdGhpcy5faW5zdHJ1Y3Rpb25zPVtdLHRoaXMuX2NvbW1pdEluZGV4PTAsdGhpcy5fYWN0aXZlSW5zdHJ1Y3Rpb25zPVtdLHRoaXMuX2RpcnR5PSExLHRoaXMuX3N0b3JlSW5kZXg9MCx0aGlzLmNsZWFyKCl9dmFyIGI9YS5wcm90b3R5cGUsYz1hO2EuZ2V0UkdCPWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiBudWxsIT1hJiZudWxsPT1jJiYoZD1iLGM9MjU1JmEsYj1hPj44JjI1NSxhPWE+PjE2JjI1NSksbnVsbD09ZD9cInJnYihcIithK1wiLFwiK2IrXCIsXCIrYytcIilcIjpcInJnYmEoXCIrYStcIixcIitiK1wiLFwiK2MrXCIsXCIrZCtcIilcIn0sYS5nZXRIU0w9ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIG51bGw9PWQ/XCJoc2woXCIrYSUzNjArXCIsXCIrYitcIiUsXCIrYytcIiUpXCI6XCJoc2xhKFwiK2ElMzYwK1wiLFwiK2IrXCIlLFwiK2MrXCIlLFwiK2QrXCIpXCJ9LGEuQkFTRV82ND17QTowLEI6MSxDOjIsRDozLEU6NCxGOjUsRzo2LEg6NyxJOjgsSjo5LEs6MTAsTDoxMSxNOjEyLE46MTMsTzoxNCxQOjE1LFE6MTYsUjoxNyxTOjE4LFQ6MTksVToyMCxWOjIxLFc6MjIsWDoyMyxZOjI0LFo6MjUsYToyNixiOjI3LGM6MjgsZDoyOSxlOjMwLGY6MzEsZzozMixoOjMzLGk6MzQsajozNSxrOjM2LGw6MzcsbTozOCxuOjM5LG86NDAscDo0MSxxOjQyLHI6NDMsczo0NCx0OjQ1LHU6NDYsdjo0Nyx3OjQ4LHg6NDkseTo1MCx6OjUxLDA6NTIsMTo1MywyOjU0LDM6NTUsNDo1Niw1OjU3LDY6NTgsNzo1OSw4OjYwLDk6NjEsXCIrXCI6NjIsXCIvXCI6NjN9LGEuU1RST0tFX0NBUFNfTUFQPVtcImJ1dHRcIixcInJvdW5kXCIsXCJzcXVhcmVcIl0sYS5TVFJPS0VfSk9JTlRTX01BUD1bXCJtaXRlclwiLFwicm91bmRcIixcImJldmVsXCJdO3ZhciBkPWNyZWF0ZWpzLmNyZWF0ZUNhbnZhcz9jcmVhdGVqcy5jcmVhdGVDYW52YXMoKTpkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO2QuZ2V0Q29udGV4dCYmKGEuX2N0eD1kLmdldENvbnRleHQoXCIyZFwiKSxkLndpZHRoPWQuaGVpZ2h0PTEpLGIuZ2V0SW5zdHJ1Y3Rpb25zPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3VwZGF0ZUluc3RydWN0aW9ucygpLHRoaXMuX2luc3RydWN0aW9uc307dHJ5e09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGIse2luc3RydWN0aW9uczp7Z2V0OmIuZ2V0SW5zdHJ1Y3Rpb25zfX0pfWNhdGNoKGUpe31iLmlzRW1wdHk9ZnVuY3Rpb24oKXtyZXR1cm4hKHRoaXMuX2luc3RydWN0aW9ucy5sZW5ndGh8fHRoaXMuX2FjdGl2ZUluc3RydWN0aW9ucy5sZW5ndGgpfSxiLmRyYXc9ZnVuY3Rpb24oYSxiKXt0aGlzLl91cGRhdGVJbnN0cnVjdGlvbnMoKTtmb3IodmFyIGM9dGhpcy5faW5zdHJ1Y3Rpb25zLGQ9dGhpcy5fc3RvcmVJbmRleCxlPWMubGVuZ3RoO2U+ZDtkKyspY1tkXS5leGVjKGEsYil9LGIuZHJhd0FzUGF0aD1mdW5jdGlvbihhKXt0aGlzLl91cGRhdGVJbnN0cnVjdGlvbnMoKTtmb3IodmFyIGIsYz10aGlzLl9pbnN0cnVjdGlvbnMsZD10aGlzLl9zdG9yZUluZGV4LGU9Yy5sZW5ndGg7ZT5kO2QrKykoYj1jW2RdKS5wYXRoIT09ITEmJmIuZXhlYyhhKX0sYi5tb3ZlVG89ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5hcHBlbmQobmV3IGMuTW92ZVRvKGEsYiksITApfSxiLmxpbmVUbz1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmFwcGVuZChuZXcgYy5MaW5lVG8oYSxiKSl9LGIuYXJjVG89ZnVuY3Rpb24oYSxiLGQsZSxmKXtyZXR1cm4gdGhpcy5hcHBlbmQobmV3IGMuQXJjVG8oYSxiLGQsZSxmKSl9LGIuYXJjPWZ1bmN0aW9uKGEsYixkLGUsZixnKXtyZXR1cm4gdGhpcy5hcHBlbmQobmV3IGMuQXJjKGEsYixkLGUsZixnKSl9LGIucXVhZHJhdGljQ3VydmVUbz1mdW5jdGlvbihhLGIsZCxlKXtyZXR1cm4gdGhpcy5hcHBlbmQobmV3IGMuUXVhZHJhdGljQ3VydmVUbyhhLGIsZCxlKSl9LGIuYmV6aWVyQ3VydmVUbz1mdW5jdGlvbihhLGIsZCxlLGYsZyl7cmV0dXJuIHRoaXMuYXBwZW5kKG5ldyBjLkJlemllckN1cnZlVG8oYSxiLGQsZSxmLGcpKX0sYi5yZWN0PWZ1bmN0aW9uKGEsYixkLGUpe3JldHVybiB0aGlzLmFwcGVuZChuZXcgYy5SZWN0KGEsYixkLGUpKX0sYi5jbG9zZVBhdGg9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fYWN0aXZlSW5zdHJ1Y3Rpb25zLmxlbmd0aD90aGlzLmFwcGVuZChuZXcgYy5DbG9zZVBhdGgpOnRoaXN9LGIuY2xlYXI9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5faW5zdHJ1Y3Rpb25zLmxlbmd0aD10aGlzLl9hY3RpdmVJbnN0cnVjdGlvbnMubGVuZ3RoPXRoaXMuX2NvbW1pdEluZGV4PTAsdGhpcy5fc3Ryb2tlU3R5bGU9dGhpcy5fb2xkU3Ryb2tlU3R5bGU9dGhpcy5fc3Ryb2tlPXRoaXMuX2ZpbGw9dGhpcy5fc3Ryb2tlRGFzaD10aGlzLl9vbGRTdHJva2VEYXNoPW51bGwsdGhpcy5fZGlydHk9dGhpcy5fc3Ryb2tlSWdub3JlU2NhbGU9ITEsdGhpc30sYi5iZWdpbkZpbGw9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX3NldEZpbGwoYT9uZXcgYy5GaWxsKGEpOm51bGwpfSxiLmJlZ2luTGluZWFyR3JhZGllbnRGaWxsPWZ1bmN0aW9uKGEsYixkLGUsZixnKXtyZXR1cm4gdGhpcy5fc2V0RmlsbCgobmV3IGMuRmlsbCkubGluZWFyR3JhZGllbnQoYSxiLGQsZSxmLGcpKX0sYi5iZWdpblJhZGlhbEdyYWRpZW50RmlsbD1mdW5jdGlvbihhLGIsZCxlLGYsZyxoLGkpe3JldHVybiB0aGlzLl9zZXRGaWxsKChuZXcgYy5GaWxsKS5yYWRpYWxHcmFkaWVudChhLGIsZCxlLGYsZyxoLGkpKX0sYi5iZWdpbkJpdG1hcEZpbGw9ZnVuY3Rpb24oYSxiLGQpe3JldHVybiB0aGlzLl9zZXRGaWxsKG5ldyBjLkZpbGwobnVsbCxkKS5iaXRtYXAoYSxiKSl9LGIuZW5kRmlsbD1mdW5jdGlvbigpe3JldHVybiB0aGlzLmJlZ2luRmlsbCgpfSxiLnNldFN0cm9rZVN0eWxlPWZ1bmN0aW9uKGEsYixkLGUsZil7cmV0dXJuIHRoaXMuX3VwZGF0ZUluc3RydWN0aW9ucyghMCksdGhpcy5fc3Ryb2tlU3R5bGU9dGhpcy5jb21tYW5kPW5ldyBjLlN0cm9rZVN0eWxlKGEsYixkLGUsZiksdGhpcy5fc3Ryb2tlJiYodGhpcy5fc3Ryb2tlLmlnbm9yZVNjYWxlPWYpLHRoaXMuX3N0cm9rZUlnbm9yZVNjYWxlPWYsdGhpc30sYi5zZXRTdHJva2VEYXNoPWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuX3VwZGF0ZUluc3RydWN0aW9ucyghMCksdGhpcy5fc3Ryb2tlRGFzaD10aGlzLmNvbW1hbmQ9bmV3IGMuU3Ryb2tlRGFzaChhLGIpLHRoaXN9LGIuYmVnaW5TdHJva2U9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX3NldFN0cm9rZShhP25ldyBjLlN0cm9rZShhKTpudWxsKX0sYi5iZWdpbkxpbmVhckdyYWRpZW50U3Ryb2tlPWZ1bmN0aW9uKGEsYixkLGUsZixnKXtyZXR1cm4gdGhpcy5fc2V0U3Ryb2tlKChuZXcgYy5TdHJva2UpLmxpbmVhckdyYWRpZW50KGEsYixkLGUsZixnKSl9LGIuYmVnaW5SYWRpYWxHcmFkaWVudFN0cm9rZT1mdW5jdGlvbihhLGIsZCxlLGYsZyxoLGkpe3JldHVybiB0aGlzLl9zZXRTdHJva2UoKG5ldyBjLlN0cm9rZSkucmFkaWFsR3JhZGllbnQoYSxiLGQsZSxmLGcsaCxpKSl9LGIuYmVnaW5CaXRtYXBTdHJva2U9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5fc2V0U3Ryb2tlKChuZXcgYy5TdHJva2UpLmJpdG1hcChhLGIpKX0sYi5lbmRTdHJva2U9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5iZWdpblN0cm9rZSgpfSxiLmN1cnZlVG89Yi5xdWFkcmF0aWNDdXJ2ZVRvLGIuZHJhd1JlY3Q9Yi5yZWN0LGIuZHJhd1JvdW5kUmVjdD1mdW5jdGlvbihhLGIsYyxkLGUpe3JldHVybiB0aGlzLmRyYXdSb3VuZFJlY3RDb21wbGV4KGEsYixjLGQsZSxlLGUsZSl9LGIuZHJhd1JvdW5kUmVjdENvbXBsZXg9ZnVuY3Rpb24oYSxiLGQsZSxmLGcsaCxpKXtyZXR1cm4gdGhpcy5hcHBlbmQobmV3IGMuUm91bmRSZWN0KGEsYixkLGUsZixnLGgsaSkpfSxiLmRyYXdDaXJjbGU9ZnVuY3Rpb24oYSxiLGQpe3JldHVybiB0aGlzLmFwcGVuZChuZXcgYy5DaXJjbGUoYSxiLGQpKX0sYi5kcmF3RWxsaXBzZT1mdW5jdGlvbihhLGIsZCxlKXtyZXR1cm4gdGhpcy5hcHBlbmQobmV3IGMuRWxsaXBzZShhLGIsZCxlKSl9LGIuZHJhd1BvbHlTdGFyPWZ1bmN0aW9uKGEsYixkLGUsZixnKXtyZXR1cm4gdGhpcy5hcHBlbmQobmV3IGMuUG9seVN0YXIoYSxiLGQsZSxmLGcpKX0sYi5hcHBlbmQ9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5fYWN0aXZlSW5zdHJ1Y3Rpb25zLnB1c2goYSksdGhpcy5jb21tYW5kPWEsYnx8KHRoaXMuX2RpcnR5PSEwKSx0aGlzfSxiLmRlY29kZVBhdGg9ZnVuY3Rpb24oYil7Zm9yKHZhciBjPVt0aGlzLm1vdmVUbyx0aGlzLmxpbmVUbyx0aGlzLnF1YWRyYXRpY0N1cnZlVG8sdGhpcy5iZXppZXJDdXJ2ZVRvLHRoaXMuY2xvc2VQYXRoXSxkPVsyLDIsNCw2LDBdLGU9MCxmPWIubGVuZ3RoLGc9W10saD0wLGk9MCxqPWEuQkFTRV82NDtmPmU7KXt2YXIgaz1iLmNoYXJBdChlKSxsPWpba10sbT1sPj4zLG49Y1ttXTtpZighbnx8MyZsKXRocm93XCJiYWQgcGF0aCBkYXRhIChAXCIrZStcIik6IFwiK2s7dmFyIG89ZFttXTttfHwoaD1pPTApLGcubGVuZ3RoPTAsZSsrO2Zvcih2YXIgcD0obD4+MiYxKSsyLHE9MDtvPnE7cSsrKXt2YXIgcj1qW2IuY2hhckF0KGUpXSxzPXI+PjU/LTE6MTtyPSgzMSZyKTw8NnxqW2IuY2hhckF0KGUrMSldLDM9PXAmJihyPXI8PDZ8altiLmNoYXJBdChlKzIpXSkscj1zKnIvMTAscSUyP2g9cis9aDppPXIrPWksZ1txXT1yLGUrPXB9bi5hcHBseSh0aGlzLGcpfXJldHVybiB0aGlzfSxiLnN0b3JlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3VwZGF0ZUluc3RydWN0aW9ucyghMCksdGhpcy5fc3RvcmVJbmRleD10aGlzLl9pbnN0cnVjdGlvbnMubGVuZ3RoLHRoaXN9LGIudW5zdG9yZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9zdG9yZUluZGV4PTAsdGhpc30sYi5jbG9uZT1mdW5jdGlvbigpe3ZhciBiPW5ldyBhO3JldHVybiBiLmNvbW1hbmQ9dGhpcy5jb21tYW5kLGIuX3N0cm9rZT10aGlzLl9zdHJva2UsYi5fc3Ryb2tlU3R5bGU9dGhpcy5fc3Ryb2tlU3R5bGUsYi5fc3Ryb2tlRGFzaD10aGlzLl9zdHJva2VEYXNoLGIuX3N0cm9rZUlnbm9yZVNjYWxlPXRoaXMuX3N0cm9rZUlnbm9yZVNjYWxlLGIuX2ZpbGw9dGhpcy5fZmlsbCxiLl9pbnN0cnVjdGlvbnM9dGhpcy5faW5zdHJ1Y3Rpb25zLnNsaWNlKCksYi5fY29tbWl0SW5kZXg9dGhpcy5fY29tbWl0SW5kZXgsYi5fYWN0aXZlSW5zdHJ1Y3Rpb25zPXRoaXMuX2FjdGl2ZUluc3RydWN0aW9ucy5zbGljZSgpLGIuX2RpcnR5PXRoaXMuX2RpcnR5LGIuX3N0b3JlSW5kZXg9dGhpcy5fc3RvcmVJbmRleCxifSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbR3JhcGhpY3NdXCJ9LGIubXQ9Yi5tb3ZlVG8sYi5sdD1iLmxpbmVUbyxiLmF0PWIuYXJjVG8sYi5idD1iLmJlemllckN1cnZlVG8sYi5xdD1iLnF1YWRyYXRpY0N1cnZlVG8sYi5hPWIuYXJjLGIucj1iLnJlY3QsYi5jcD1iLmNsb3NlUGF0aCxiLmM9Yi5jbGVhcixiLmY9Yi5iZWdpbkZpbGwsYi5sZj1iLmJlZ2luTGluZWFyR3JhZGllbnRGaWxsLGIucmY9Yi5iZWdpblJhZGlhbEdyYWRpZW50RmlsbCxiLmJmPWIuYmVnaW5CaXRtYXBGaWxsLGIuZWY9Yi5lbmRGaWxsLGIuc3M9Yi5zZXRTdHJva2VTdHlsZSxiLnNkPWIuc2V0U3Ryb2tlRGFzaCxiLnM9Yi5iZWdpblN0cm9rZSxiLmxzPWIuYmVnaW5MaW5lYXJHcmFkaWVudFN0cm9rZSxiLnJzPWIuYmVnaW5SYWRpYWxHcmFkaWVudFN0cm9rZSxiLmJzPWIuYmVnaW5CaXRtYXBTdHJva2UsYi5lcz1iLmVuZFN0cm9rZSxiLmRyPWIuZHJhd1JlY3QsYi5ycj1iLmRyYXdSb3VuZFJlY3QsYi5yYz1iLmRyYXdSb3VuZFJlY3RDb21wbGV4LGIuZGM9Yi5kcmF3Q2lyY2xlLGIuZGU9Yi5kcmF3RWxsaXBzZSxiLmRwPWIuZHJhd1BvbHlTdGFyLGIucD1iLmRlY29kZVBhdGgsYi5fdXBkYXRlSW5zdHJ1Y3Rpb25zPWZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuX2luc3RydWN0aW9ucyxkPXRoaXMuX2FjdGl2ZUluc3RydWN0aW9ucyxlPXRoaXMuX2NvbW1pdEluZGV4O2lmKHRoaXMuX2RpcnR5JiZkLmxlbmd0aCl7Yy5sZW5ndGg9ZSxjLnB1c2goYS5iZWdpbkNtZCk7dmFyIGY9ZC5sZW5ndGgsZz1jLmxlbmd0aDtjLmxlbmd0aD1nK2Y7Zm9yKHZhciBoPTA7Zj5oO2grKyljW2grZ109ZFtoXTt0aGlzLl9maWxsJiZjLnB1c2godGhpcy5fZmlsbCksdGhpcy5fc3Ryb2tlJiYodGhpcy5fc3Ryb2tlRGFzaCE9PXRoaXMuX29sZFN0cm9rZURhc2gmJih0aGlzLl9vbGRTdHJva2VEYXNoPXRoaXMuX3N0cm9rZURhc2gsYy5wdXNoKHRoaXMuX3N0cm9rZURhc2gpKSx0aGlzLl9zdHJva2VTdHlsZSE9PXRoaXMuX29sZFN0cm9rZVN0eWxlJiYodGhpcy5fb2xkU3Ryb2tlU3R5bGU9dGhpcy5fc3Ryb2tlU3R5bGUsYy5wdXNoKHRoaXMuX3N0cm9rZVN0eWxlKSksYy5wdXNoKHRoaXMuX3N0cm9rZSkpLHRoaXMuX2RpcnR5PSExfWImJihkLmxlbmd0aD0wLHRoaXMuX2NvbW1pdEluZGV4PWMubGVuZ3RoKX0sYi5fc2V0RmlsbD1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5fdXBkYXRlSW5zdHJ1Y3Rpb25zKCEwKSx0aGlzLmNvbW1hbmQ9dGhpcy5fZmlsbD1hLHRoaXN9LGIuX3NldFN0cm9rZT1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5fdXBkYXRlSW5zdHJ1Y3Rpb25zKCEwKSwodGhpcy5jb21tYW5kPXRoaXMuX3N0cm9rZT1hKSYmKGEuaWdub3JlU2NhbGU9dGhpcy5fc3Ryb2tlSWdub3JlU2NhbGUpLHRoaXN9LChjLkxpbmVUbz1mdW5jdGlvbihhLGIpe3RoaXMueD1hLHRoaXMueT1ifSkucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oYSl7YS5saW5lVG8odGhpcy54LHRoaXMueSl9LChjLk1vdmVUbz1mdW5jdGlvbihhLGIpe3RoaXMueD1hLHRoaXMueT1ifSkucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oYSl7YS5tb3ZlVG8odGhpcy54LHRoaXMueSl9LChjLkFyY1RvPWZ1bmN0aW9uKGEsYixjLGQsZSl7dGhpcy54MT1hLHRoaXMueTE9Yix0aGlzLngyPWMsdGhpcy55Mj1kLHRoaXMucmFkaXVzPWV9KS5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbihhKXthLmFyY1RvKHRoaXMueDEsdGhpcy55MSx0aGlzLngyLHRoaXMueTIsdGhpcy5yYWRpdXMpfSwoYy5BcmM9ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe3RoaXMueD1hLHRoaXMueT1iLHRoaXMucmFkaXVzPWMsdGhpcy5zdGFydEFuZ2xlPWQsdGhpcy5lbmRBbmdsZT1lLHRoaXMuYW50aWNsb2Nrd2lzZT0hIWZ9KS5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbihhKXthLmFyYyh0aGlzLngsdGhpcy55LHRoaXMucmFkaXVzLHRoaXMuc3RhcnRBbmdsZSx0aGlzLmVuZEFuZ2xlLHRoaXMuYW50aWNsb2Nrd2lzZSl9LChjLlF1YWRyYXRpY0N1cnZlVG89ZnVuY3Rpb24oYSxiLGMsZCl7dGhpcy5jcHg9YSx0aGlzLmNweT1iLHRoaXMueD1jLHRoaXMueT1kfSkucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oYSl7YS5xdWFkcmF0aWNDdXJ2ZVRvKHRoaXMuY3B4LHRoaXMuY3B5LHRoaXMueCx0aGlzLnkpfSwoYy5CZXppZXJDdXJ2ZVRvPWZ1bmN0aW9uKGEsYixjLGQsZSxmKXt0aGlzLmNwMXg9YSx0aGlzLmNwMXk9Yix0aGlzLmNwMng9Yyx0aGlzLmNwMnk9ZCx0aGlzLng9ZSx0aGlzLnk9Zn0pLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKGEpe2EuYmV6aWVyQ3VydmVUbyh0aGlzLmNwMXgsdGhpcy5jcDF5LHRoaXMuY3AyeCx0aGlzLmNwMnksdGhpcy54LHRoaXMueSl9LChjLlJlY3Q9ZnVuY3Rpb24oYSxiLGMsZCl7dGhpcy54PWEsdGhpcy55PWIsdGhpcy53PWMsdGhpcy5oPWR9KS5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbihhKXthLnJlY3QodGhpcy54LHRoaXMueSx0aGlzLncsdGhpcy5oKX0sKGMuQ2xvc2VQYXRoPWZ1bmN0aW9uKCl7fSkucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oYSl7YS5jbG9zZVBhdGgoKX0sKGMuQmVnaW5QYXRoPWZ1bmN0aW9uKCl7fSkucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oYSl7YS5iZWdpblBhdGgoKX0sYj0oYy5GaWxsPWZ1bmN0aW9uKGEsYil7dGhpcy5zdHlsZT1hLHRoaXMubWF0cml4PWJ9KS5wcm90b3R5cGUsYi5leGVjPWZ1bmN0aW9uKGEpe2lmKHRoaXMuc3R5bGUpe2EuZmlsbFN0eWxlPXRoaXMuc3R5bGU7dmFyIGI9dGhpcy5tYXRyaXg7YiYmKGEuc2F2ZSgpLGEudHJhbnNmb3JtKGIuYSxiLmIsYi5jLGIuZCxiLnR4LGIudHkpKSxhLmZpbGwoKSxiJiZhLnJlc3RvcmUoKX19LGIubGluZWFyR3JhZGllbnQ9ZnVuY3Rpb24oYixjLGQsZSxmLGcpe2Zvcih2YXIgaD10aGlzLnN0eWxlPWEuX2N0eC5jcmVhdGVMaW5lYXJHcmFkaWVudChkLGUsZixnKSxpPTAsaj1iLmxlbmd0aDtqPmk7aSsrKWguYWRkQ29sb3JTdG9wKGNbaV0sYltpXSk7cmV0dXJuIGgucHJvcHM9e2NvbG9yczpiLHJhdGlvczpjLHgwOmQseTA6ZSx4MTpmLHkxOmcsdHlwZTpcImxpbmVhclwifSx0aGlzfSxiLnJhZGlhbEdyYWRpZW50PWZ1bmN0aW9uKGIsYyxkLGUsZixnLGgsaSl7Zm9yKHZhciBqPXRoaXMuc3R5bGU9YS5fY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KGQsZSxmLGcsaCxpKSxrPTAsbD1iLmxlbmd0aDtsPms7aysrKWouYWRkQ29sb3JTdG9wKGNba10sYltrXSk7cmV0dXJuIGoucHJvcHM9e2NvbG9yczpiLHJhdGlvczpjLHgwOmQseTA6ZSxyMDpmLHgxOmcseTE6aCxyMTppLHR5cGU6XCJyYWRpYWxcIn0sdGhpc30sYi5iaXRtYXA9ZnVuY3Rpb24oYixjKXtpZihiLm5hdHVyYWxXaWR0aHx8Yi5nZXRDb250ZXh0fHxiLnJlYWR5U3RhdGU+PTIpe3ZhciBkPXRoaXMuc3R5bGU9YS5fY3R4LmNyZWF0ZVBhdHRlcm4oYixjfHxcIlwiKTtkLnByb3BzPXtpbWFnZTpiLHJlcGV0aXRpb246Yyx0eXBlOlwiYml0bWFwXCJ9fXJldHVybiB0aGlzfSxiLnBhdGg9ITEsYj0oYy5TdHJva2U9ZnVuY3Rpb24oYSxiKXt0aGlzLnN0eWxlPWEsdGhpcy5pZ25vcmVTY2FsZT1ifSkucHJvdG90eXBlLGIuZXhlYz1mdW5jdGlvbihhKXt0aGlzLnN0eWxlJiYoYS5zdHJva2VTdHlsZT10aGlzLnN0eWxlLHRoaXMuaWdub3JlU2NhbGUmJihhLnNhdmUoKSxhLnNldFRyYW5zZm9ybSgxLDAsMCwxLDAsMCkpLGEuc3Ryb2tlKCksdGhpcy5pZ25vcmVTY2FsZSYmYS5yZXN0b3JlKCkpfSxiLmxpbmVhckdyYWRpZW50PWMuRmlsbC5wcm90b3R5cGUubGluZWFyR3JhZGllbnQsYi5yYWRpYWxHcmFkaWVudD1jLkZpbGwucHJvdG90eXBlLnJhZGlhbEdyYWRpZW50LGIuYml0bWFwPWMuRmlsbC5wcm90b3R5cGUuYml0bWFwLGIucGF0aD0hMSxiPShjLlN0cm9rZVN0eWxlPWZ1bmN0aW9uKGEsYixjLGQsZSl7dGhpcy53aWR0aD1hLHRoaXMuY2Fwcz1iLHRoaXMuam9pbnRzPWMsdGhpcy5taXRlckxpbWl0PWQsdGhpcy5pZ25vcmVTY2FsZT1lfSkucHJvdG90eXBlLGIuZXhlYz1mdW5jdGlvbihiKXtiLmxpbmVXaWR0aD1udWxsPT10aGlzLndpZHRoP1wiMVwiOnRoaXMud2lkdGgsYi5saW5lQ2FwPW51bGw9PXRoaXMuY2Fwcz9cImJ1dHRcIjppc05hTih0aGlzLmNhcHMpP3RoaXMuY2FwczphLlNUUk9LRV9DQVBTX01BUFt0aGlzLmNhcHNdLGIubGluZUpvaW49bnVsbD09dGhpcy5qb2ludHM/XCJtaXRlclwiOmlzTmFOKHRoaXMuam9pbnRzKT90aGlzLmpvaW50czphLlNUUk9LRV9KT0lOVFNfTUFQW3RoaXMuam9pbnRzXSxiLm1pdGVyTGltaXQ9bnVsbD09dGhpcy5taXRlckxpbWl0P1wiMTBcIjp0aGlzLm1pdGVyTGltaXQsYi5pZ25vcmVTY2FsZT1udWxsPT10aGlzLmlnbm9yZVNjYWxlPyExOnRoaXMuaWdub3JlU2NhbGV9LGIucGF0aD0hMSwoYy5TdHJva2VEYXNoPWZ1bmN0aW9uKGEsYil7dGhpcy5zZWdtZW50cz1hLHRoaXMub2Zmc2V0PWJ8fDB9KS5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbihhKXthLnNldExpbmVEYXNoJiYoYS5zZXRMaW5lRGFzaCh0aGlzLnNlZ21lbnRzfHxjLlN0cm9rZURhc2guRU1QVFlfU0VHTUVOVFMpLGEubGluZURhc2hPZmZzZXQ9dGhpcy5vZmZzZXR8fDApfSxjLlN0cm9rZURhc2guRU1QVFlfU0VHTUVOVFM9W10sKGMuUm91bmRSZWN0PWZ1bmN0aW9uKGEsYixjLGQsZSxmLGcsaCl7dGhpcy54PWEsdGhpcy55PWIsdGhpcy53PWMsdGhpcy5oPWQsdGhpcy5yYWRpdXNUTD1lLHRoaXMucmFkaXVzVFI9Zix0aGlzLnJhZGl1c0JSPWcsdGhpcy5yYWRpdXNCTD1ofSkucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oYSl7dmFyIGI9KGo+aT9pOmopLzIsYz0wLGQ9MCxlPTAsZj0wLGc9dGhpcy54LGg9dGhpcy55LGk9dGhpcy53LGo9dGhpcy5oLGs9dGhpcy5yYWRpdXNUTCxsPXRoaXMucmFkaXVzVFIsbT10aGlzLnJhZGl1c0JSLG49dGhpcy5yYWRpdXNCTDswPmsmJihrKj1jPS0xKSxrPmImJihrPWIpLDA+bCYmKGwqPWQ9LTEpLGw+YiYmKGw9YiksMD5tJiYobSo9ZT0tMSksbT5iJiYobT1iKSwwPm4mJihuKj1mPS0xKSxuPmImJihuPWIpLGEubW92ZVRvKGcraS1sLGgpLGEuYXJjVG8oZytpK2wqZCxoLWwqZCxnK2ksaCtsLGwpLGEubGluZVRvKGcraSxoK2otbSksYS5hcmNUbyhnK2krbSplLGgraittKmUsZytpLW0saCtqLG0pLGEubGluZVRvKGcrbixoK2opLGEuYXJjVG8oZy1uKmYsaCtqK24qZixnLGgrai1uLG4pLGEubGluZVRvKGcsaCtrKSxhLmFyY1RvKGctaypjLGgtaypjLGcrayxoLGspLGEuY2xvc2VQYXRoKCl9LChjLkNpcmNsZT1mdW5jdGlvbihhLGIsYyl7dGhpcy54PWEsdGhpcy55PWIsdGhpcy5yYWRpdXM9Y30pLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKGEpe2EuYXJjKHRoaXMueCx0aGlzLnksdGhpcy5yYWRpdXMsMCwyKk1hdGguUEkpfSwoYy5FbGxpcHNlPWZ1bmN0aW9uKGEsYixjLGQpe3RoaXMueD1hLHRoaXMueT1iLHRoaXMudz1jLHRoaXMuaD1kfSkucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy54LGM9dGhpcy55LGQ9dGhpcy53LGU9dGhpcy5oLGY9LjU1MjI4NDgsZz1kLzIqZixoPWUvMipmLGk9YitkLGo9YytlLGs9YitkLzIsbD1jK2UvMjthLm1vdmVUbyhiLGwpLGEuYmV6aWVyQ3VydmVUbyhiLGwtaCxrLWcsYyxrLGMpLGEuYmV6aWVyQ3VydmVUbyhrK2csYyxpLGwtaCxpLGwpLGEuYmV6aWVyQ3VydmVUbyhpLGwraCxrK2csaixrLGopLGEuYmV6aWVyQ3VydmVUbyhrLWcsaixiLGwraCxiLGwpfSwoYy5Qb2x5U3Rhcj1mdW5jdGlvbihhLGIsYyxkLGUsZil7dGhpcy54PWEsdGhpcy55PWIsdGhpcy5yYWRpdXM9Yyx0aGlzLnNpZGVzPWQsdGhpcy5wb2ludFNpemU9ZSx0aGlzLmFuZ2xlPWZ9KS5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbihhKXt2YXIgYj10aGlzLngsYz10aGlzLnksZD10aGlzLnJhZGl1cyxlPSh0aGlzLmFuZ2xlfHwwKS8xODAqTWF0aC5QSSxmPXRoaXMuc2lkZXMsZz0xLSh0aGlzLnBvaW50U2l6ZXx8MCksaD1NYXRoLlBJL2Y7YS5tb3ZlVG8oYitNYXRoLmNvcyhlKSpkLGMrTWF0aC5zaW4oZSkqZCk7Zm9yKHZhciBpPTA7Zj5pO2krKyllKz1oLDEhPWcmJmEubGluZVRvKGIrTWF0aC5jb3MoZSkqZCpnLGMrTWF0aC5zaW4oZSkqZCpnKSxlKz1oLGEubGluZVRvKGIrTWF0aC5jb3MoZSkqZCxjK01hdGguc2luKGUpKmQpO2EuY2xvc2VQYXRoKCl9LGEuYmVnaW5DbWQ9bmV3IGMuQmVnaW5QYXRoLGNyZWF0ZWpzLkdyYXBoaWNzPWF9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt0aGlzLkV2ZW50RGlzcGF0Y2hlcl9jb25zdHJ1Y3RvcigpLHRoaXMuYWxwaGE9MSx0aGlzLmNhY2hlQ2FudmFzPW51bGwsdGhpcy5jYWNoZUlEPTAsdGhpcy5pZD1jcmVhdGVqcy5VSUQuZ2V0KCksdGhpcy5tb3VzZUVuYWJsZWQ9ITAsdGhpcy50aWNrRW5hYmxlZD0hMCx0aGlzLm5hbWU9bnVsbCx0aGlzLnBhcmVudD1udWxsLHRoaXMucmVnWD0wLHRoaXMucmVnWT0wLHRoaXMucm90YXRpb249MCx0aGlzLnNjYWxlWD0xLHRoaXMuc2NhbGVZPTEsdGhpcy5za2V3WD0wLHRoaXMuc2tld1k9MCx0aGlzLnNoYWRvdz1udWxsLHRoaXMudmlzaWJsZT0hMCx0aGlzLng9MCx0aGlzLnk9MCx0aGlzLnRyYW5zZm9ybU1hdHJpeD1udWxsLHRoaXMuY29tcG9zaXRlT3BlcmF0aW9uPW51bGwsdGhpcy5zbmFwVG9QaXhlbD0hMCx0aGlzLmZpbHRlcnM9bnVsbCxcbnRoaXMubWFzaz1udWxsLHRoaXMuaGl0QXJlYT1udWxsLHRoaXMuY3Vyc29yPW51bGwsdGhpcy5fY2FjaGVPZmZzZXRYPTAsdGhpcy5fY2FjaGVPZmZzZXRZPTAsdGhpcy5fZmlsdGVyT2Zmc2V0WD0wLHRoaXMuX2ZpbHRlck9mZnNldFk9MCx0aGlzLl9jYWNoZVNjYWxlPTEsdGhpcy5fY2FjaGVEYXRhVVJMSUQ9MCx0aGlzLl9jYWNoZURhdGFVUkw9bnVsbCx0aGlzLl9wcm9wcz1uZXcgY3JlYXRlanMuRGlzcGxheVByb3BzLHRoaXMuX3JlY3RhbmdsZT1uZXcgY3JlYXRlanMuUmVjdGFuZ2xlLHRoaXMuX2JvdW5kcz1udWxsfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkV2ZW50RGlzcGF0Y2hlcik7YS5fTU9VU0VfRVZFTlRTPVtcImNsaWNrXCIsXCJkYmxjbGlja1wiLFwibW91c2Vkb3duXCIsXCJtb3VzZW91dFwiLFwibW91c2VvdmVyXCIsXCJwcmVzc21vdmVcIixcInByZXNzdXBcIixcInJvbGxvdXRcIixcInJvbGxvdmVyXCJdLGEuc3VwcHJlc3NDcm9zc0RvbWFpbkVycm9ycz0hMSxhLl9zbmFwVG9QaXhlbEVuYWJsZWQ9ITE7dmFyIGM9Y3JlYXRlanMuY3JlYXRlQ2FudmFzP2NyZWF0ZWpzLmNyZWF0ZUNhbnZhcygpOmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7Yy5nZXRDb250ZXh0JiYoYS5faGl0VGVzdENhbnZhcz1jLGEuX2hpdFRlc3RDb250ZXh0PWMuZ2V0Q29udGV4dChcIjJkXCIpLGMud2lkdGg9Yy5oZWlnaHQ9MSksYS5fbmV4dENhY2hlSUQ9MSxiLmdldFN0YWdlPWZ1bmN0aW9uKCl7Zm9yKHZhciBhPXRoaXMsYj1jcmVhdGVqcy5TdGFnZTthLnBhcmVudDspYT1hLnBhcmVudDtyZXR1cm4gYSBpbnN0YW5jZW9mIGI/YTpudWxsfTt0cnl7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMoYix7c3RhZ2U6e2dldDpiLmdldFN0YWdlfX0pfWNhdGNoKGQpe31iLmlzVmlzaWJsZT1mdW5jdGlvbigpe3JldHVybiEhKHRoaXMudmlzaWJsZSYmdGhpcy5hbHBoYT4wJiYwIT10aGlzLnNjYWxlWCYmMCE9dGhpcy5zY2FsZVkpfSxiLmRyYXc9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLmNhY2hlQ2FudmFzO2lmKGJ8fCFjKXJldHVybiExO3ZhciBkPXRoaXMuX2NhY2hlU2NhbGU7cmV0dXJuIGEuZHJhd0ltYWdlKGMsdGhpcy5fY2FjaGVPZmZzZXRYK3RoaXMuX2ZpbHRlck9mZnNldFgsdGhpcy5fY2FjaGVPZmZzZXRZK3RoaXMuX2ZpbHRlck9mZnNldFksYy53aWR0aC9kLGMuaGVpZ2h0L2QpLCEwfSxiLnVwZGF0ZUNvbnRleHQ9ZnVuY3Rpb24oYil7dmFyIGM9dGhpcyxkPWMubWFzayxlPWMuX3Byb3BzLm1hdHJpeDtkJiZkLmdyYXBoaWNzJiYhZC5ncmFwaGljcy5pc0VtcHR5KCkmJihkLmdldE1hdHJpeChlKSxiLnRyYW5zZm9ybShlLmEsZS5iLGUuYyxlLmQsZS50eCxlLnR5KSxkLmdyYXBoaWNzLmRyYXdBc1BhdGgoYiksYi5jbGlwKCksZS5pbnZlcnQoKSxiLnRyYW5zZm9ybShlLmEsZS5iLGUuYyxlLmQsZS50eCxlLnR5KSksdGhpcy5nZXRNYXRyaXgoZSk7dmFyIGY9ZS50eCxnPWUudHk7YS5fc25hcFRvUGl4ZWxFbmFibGVkJiZjLnNuYXBUb1BpeGVsJiYoZj1mKygwPmY/LS41Oi41KXwwLGc9ZysoMD5nPy0uNTouNSl8MCksYi50cmFuc2Zvcm0oZS5hLGUuYixlLmMsZS5kLGYsZyksYi5nbG9iYWxBbHBoYSo9Yy5hbHBoYSxjLmNvbXBvc2l0ZU9wZXJhdGlvbiYmKGIuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uPWMuY29tcG9zaXRlT3BlcmF0aW9uKSxjLnNoYWRvdyYmdGhpcy5fYXBwbHlTaGFkb3coYixjLnNoYWRvdyl9LGIuY2FjaGU9ZnVuY3Rpb24oYSxiLGMsZCxlKXtlPWV8fDEsdGhpcy5jYWNoZUNhbnZhc3x8KHRoaXMuY2FjaGVDYW52YXM9Y3JlYXRlanMuY3JlYXRlQ2FudmFzP2NyZWF0ZWpzLmNyZWF0ZUNhbnZhcygpOmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIikpLHRoaXMuX2NhY2hlV2lkdGg9Yyx0aGlzLl9jYWNoZUhlaWdodD1kLHRoaXMuX2NhY2hlT2Zmc2V0WD1hLHRoaXMuX2NhY2hlT2Zmc2V0WT1iLHRoaXMuX2NhY2hlU2NhbGU9ZSx0aGlzLnVwZGF0ZUNhY2hlKCl9LGIudXBkYXRlQ2FjaGU9ZnVuY3Rpb24oYil7dmFyIGM9dGhpcy5jYWNoZUNhbnZhcztpZighYyl0aHJvd1wiY2FjaGUoKSBtdXN0IGJlIGNhbGxlZCBiZWZvcmUgdXBkYXRlQ2FjaGUoKVwiO3ZhciBkPXRoaXMuX2NhY2hlU2NhbGUsZT10aGlzLl9jYWNoZU9mZnNldFgqZCxmPXRoaXMuX2NhY2hlT2Zmc2V0WSpkLGc9dGhpcy5fY2FjaGVXaWR0aCxoPXRoaXMuX2NhY2hlSGVpZ2h0LGk9Yy5nZXRDb250ZXh0KFwiMmRcIiksaj10aGlzLl9nZXRGaWx0ZXJCb3VuZHMoKTtlKz10aGlzLl9maWx0ZXJPZmZzZXRYPWoueCxmKz10aGlzLl9maWx0ZXJPZmZzZXRZPWoueSxnPU1hdGguY2VpbChnKmQpK2oud2lkdGgsaD1NYXRoLmNlaWwoaCpkKStqLmhlaWdodCxnIT1jLndpZHRofHxoIT1jLmhlaWdodD8oYy53aWR0aD1nLGMuaGVpZ2h0PWgpOmJ8fGkuY2xlYXJSZWN0KDAsMCxnKzEsaCsxKSxpLnNhdmUoKSxpLmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbj1iLGkuc2V0VHJhbnNmb3JtKGQsMCwwLGQsLWUsLWYpLHRoaXMuZHJhdyhpLCEwKSx0aGlzLl9hcHBseUZpbHRlcnMoKSxpLnJlc3RvcmUoKSx0aGlzLmNhY2hlSUQ9YS5fbmV4dENhY2hlSUQrK30sYi51bmNhY2hlPWZ1bmN0aW9uKCl7dGhpcy5fY2FjaGVEYXRhVVJMPXRoaXMuY2FjaGVDYW52YXM9bnVsbCx0aGlzLmNhY2hlSUQ9dGhpcy5fY2FjaGVPZmZzZXRYPXRoaXMuX2NhY2hlT2Zmc2V0WT10aGlzLl9maWx0ZXJPZmZzZXRYPXRoaXMuX2ZpbHRlck9mZnNldFk9MCx0aGlzLl9jYWNoZVNjYWxlPTF9LGIuZ2V0Q2FjaGVEYXRhVVJMPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY2FjaGVDYW52YXM/KHRoaXMuY2FjaGVJRCE9dGhpcy5fY2FjaGVEYXRhVVJMSUQmJih0aGlzLl9jYWNoZURhdGFVUkw9dGhpcy5jYWNoZUNhbnZhcy50b0RhdGFVUkwoKSksdGhpcy5fY2FjaGVEYXRhVVJMKTpudWxsfSxiLmxvY2FsVG9HbG9iYWw9ZnVuY3Rpb24oYSxiLGMpe3JldHVybiB0aGlzLmdldENvbmNhdGVuYXRlZE1hdHJpeCh0aGlzLl9wcm9wcy5tYXRyaXgpLnRyYW5zZm9ybVBvaW50KGEsYixjfHxuZXcgY3JlYXRlanMuUG9pbnQpfSxiLmdsb2JhbFRvTG9jYWw9ZnVuY3Rpb24oYSxiLGMpe3JldHVybiB0aGlzLmdldENvbmNhdGVuYXRlZE1hdHJpeCh0aGlzLl9wcm9wcy5tYXRyaXgpLmludmVydCgpLnRyYW5zZm9ybVBvaW50KGEsYixjfHxuZXcgY3JlYXRlanMuUG9pbnQpfSxiLmxvY2FsVG9Mb2NhbD1mdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gZD10aGlzLmxvY2FsVG9HbG9iYWwoYSxiLGQpLGMuZ2xvYmFsVG9Mb2NhbChkLngsZC55LGQpfSxiLnNldFRyYW5zZm9ybT1mdW5jdGlvbihhLGIsYyxkLGUsZixnLGgsaSl7cmV0dXJuIHRoaXMueD1hfHwwLHRoaXMueT1ifHwwLHRoaXMuc2NhbGVYPW51bGw9PWM/MTpjLHRoaXMuc2NhbGVZPW51bGw9PWQ/MTpkLHRoaXMucm90YXRpb249ZXx8MCx0aGlzLnNrZXdYPWZ8fDAsdGhpcy5za2V3WT1nfHwwLHRoaXMucmVnWD1ofHwwLHRoaXMucmVnWT1pfHwwLHRoaXN9LGIuZ2V0TWF0cml4PWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMsYz1hJiZhLmlkZW50aXR5KCl8fG5ldyBjcmVhdGVqcy5NYXRyaXgyRDtyZXR1cm4gYi50cmFuc2Zvcm1NYXRyaXg/Yy5jb3B5KGIudHJhbnNmb3JtTWF0cml4KTpjLmFwcGVuZFRyYW5zZm9ybShiLngsYi55LGIuc2NhbGVYLGIuc2NhbGVZLGIucm90YXRpb24sYi5za2V3WCxiLnNrZXdZLGIucmVnWCxiLnJlZ1kpfSxiLmdldENvbmNhdGVuYXRlZE1hdHJpeD1mdW5jdGlvbihhKXtmb3IodmFyIGI9dGhpcyxjPXRoaXMuZ2V0TWF0cml4KGEpO2I9Yi5wYXJlbnQ7KWMucHJlcGVuZE1hdHJpeChiLmdldE1hdHJpeChiLl9wcm9wcy5tYXRyaXgpKTtyZXR1cm4gY30sYi5nZXRDb25jYXRlbmF0ZWREaXNwbGF5UHJvcHM9ZnVuY3Rpb24oYSl7YT1hP2EuaWRlbnRpdHkoKTpuZXcgY3JlYXRlanMuRGlzcGxheVByb3BzO3ZhciBiPXRoaXMsYz1iLmdldE1hdHJpeChhLm1hdHJpeCk7ZG8gYS5wcmVwZW5kKGIudmlzaWJsZSxiLmFscGhhLGIuc2hhZG93LGIuY29tcG9zaXRlT3BlcmF0aW9uKSxiIT10aGlzJiZjLnByZXBlbmRNYXRyaXgoYi5nZXRNYXRyaXgoYi5fcHJvcHMubWF0cml4KSk7d2hpbGUoYj1iLnBhcmVudCk7cmV0dXJuIGF9LGIuaGl0VGVzdD1mdW5jdGlvbihiLGMpe3ZhciBkPWEuX2hpdFRlc3RDb250ZXh0O2Quc2V0VHJhbnNmb3JtKDEsMCwwLDEsLWIsLWMpLHRoaXMuZHJhdyhkKTt2YXIgZT10aGlzLl90ZXN0SGl0KGQpO3JldHVybiBkLnNldFRyYW5zZm9ybSgxLDAsMCwxLDAsMCksZC5jbGVhclJlY3QoMCwwLDIsMiksZX0sYi5zZXQ9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiIGluIGEpdGhpc1tiXT1hW2JdO3JldHVybiB0aGlzfSxiLmdldEJvdW5kcz1mdW5jdGlvbigpe2lmKHRoaXMuX2JvdW5kcylyZXR1cm4gdGhpcy5fcmVjdGFuZ2xlLmNvcHkodGhpcy5fYm91bmRzKTt2YXIgYT10aGlzLmNhY2hlQ2FudmFzO2lmKGEpe3ZhciBiPXRoaXMuX2NhY2hlU2NhbGU7cmV0dXJuIHRoaXMuX3JlY3RhbmdsZS5zZXRWYWx1ZXModGhpcy5fY2FjaGVPZmZzZXRYLHRoaXMuX2NhY2hlT2Zmc2V0WSxhLndpZHRoL2IsYS5oZWlnaHQvYil9cmV0dXJuIG51bGx9LGIuZ2V0VHJhbnNmb3JtZWRCb3VuZHM9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZ2V0Qm91bmRzKCl9LGIuc2V0Qm91bmRzPWZ1bmN0aW9uKGEsYixjLGQpe251bGw9PWEmJih0aGlzLl9ib3VuZHM9YSksdGhpcy5fYm91bmRzPSh0aGlzLl9ib3VuZHN8fG5ldyBjcmVhdGVqcy5SZWN0YW5nbGUpLnNldFZhbHVlcyhhLGIsYyxkKX0sYi5jbG9uZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9jbG9uZVByb3BzKG5ldyBhKX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0Rpc3BsYXlPYmplY3QgKG5hbWU9XCIrdGhpcy5uYW1lK1wiKV1cIn0sYi5fY2xvbmVQcm9wcz1mdW5jdGlvbihhKXtyZXR1cm4gYS5hbHBoYT10aGlzLmFscGhhLGEubW91c2VFbmFibGVkPXRoaXMubW91c2VFbmFibGVkLGEudGlja0VuYWJsZWQ9dGhpcy50aWNrRW5hYmxlZCxhLm5hbWU9dGhpcy5uYW1lLGEucmVnWD10aGlzLnJlZ1gsYS5yZWdZPXRoaXMucmVnWSxhLnJvdGF0aW9uPXRoaXMucm90YXRpb24sYS5zY2FsZVg9dGhpcy5zY2FsZVgsYS5zY2FsZVk9dGhpcy5zY2FsZVksYS5zaGFkb3c9dGhpcy5zaGFkb3csYS5za2V3WD10aGlzLnNrZXdYLGEuc2tld1k9dGhpcy5za2V3WSxhLnZpc2libGU9dGhpcy52aXNpYmxlLGEueD10aGlzLngsYS55PXRoaXMueSxhLmNvbXBvc2l0ZU9wZXJhdGlvbj10aGlzLmNvbXBvc2l0ZU9wZXJhdGlvbixhLnNuYXBUb1BpeGVsPXRoaXMuc25hcFRvUGl4ZWwsYS5maWx0ZXJzPW51bGw9PXRoaXMuZmlsdGVycz9udWxsOnRoaXMuZmlsdGVycy5zbGljZSgwKSxhLm1hc2s9dGhpcy5tYXNrLGEuaGl0QXJlYT10aGlzLmhpdEFyZWEsYS5jdXJzb3I9dGhpcy5jdXJzb3IsYS5fYm91bmRzPXRoaXMuX2JvdW5kcyxhfSxiLl9hcHBseVNoYWRvdz1mdW5jdGlvbihhLGIpe2I9Ynx8U2hhZG93LmlkZW50aXR5LGEuc2hhZG93Q29sb3I9Yi5jb2xvcixhLnNoYWRvd09mZnNldFg9Yi5vZmZzZXRYLGEuc2hhZG93T2Zmc2V0WT1iLm9mZnNldFksYS5zaGFkb3dCbHVyPWIuYmx1cn0sYi5fdGljaz1mdW5jdGlvbihhKXt2YXIgYj10aGlzLl9saXN0ZW5lcnM7YiYmYi50aWNrJiYoYS50YXJnZXQ9bnVsbCxhLnByb3BhZ2F0aW9uU3RvcHBlZD1hLmltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZD0hMSx0aGlzLmRpc3BhdGNoRXZlbnQoYSkpfSxiLl90ZXN0SGl0PWZ1bmN0aW9uKGIpe3RyeXt2YXIgYz1iLmdldEltYWdlRGF0YSgwLDAsMSwxKS5kYXRhWzNdPjF9Y2F0Y2goZCl7aWYoIWEuc3VwcHJlc3NDcm9zc0RvbWFpbkVycm9ycyl0aHJvd1wiQW4gZXJyb3IgaGFzIG9jY3VycmVkLiBUaGlzIGlzIG1vc3QgbGlrZWx5IGR1ZSB0byBzZWN1cml0eSByZXN0cmljdGlvbnMgb24gcmVhZGluZyBjYW52YXMgcGl4ZWwgZGF0YSB3aXRoIGxvY2FsIG9yIGNyb3NzLWRvbWFpbiBpbWFnZXMuXCJ9cmV0dXJuIGN9LGIuX2FwcGx5RmlsdGVycz1mdW5jdGlvbigpe2lmKHRoaXMuZmlsdGVycyYmMCE9dGhpcy5maWx0ZXJzLmxlbmd0aCYmdGhpcy5jYWNoZUNhbnZhcylmb3IodmFyIGE9dGhpcy5maWx0ZXJzLmxlbmd0aCxiPXRoaXMuY2FjaGVDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpLGM9dGhpcy5jYWNoZUNhbnZhcy53aWR0aCxkPXRoaXMuY2FjaGVDYW52YXMuaGVpZ2h0LGU9MDthPmU7ZSsrKXRoaXMuZmlsdGVyc1tlXS5hcHBseUZpbHRlcihiLDAsMCxjLGQpfSxiLl9nZXRGaWx0ZXJCb3VuZHM9ZnVuY3Rpb24oYSl7dmFyIGIsYz10aGlzLmZpbHRlcnMsZD10aGlzLl9yZWN0YW5nbGUuc2V0VmFsdWVzKDAsMCwwLDApO2lmKCFjfHwhKGI9Yy5sZW5ndGgpKXJldHVybiBkO2Zvcih2YXIgZT0wO2I+ZTtlKyspe3ZhciBmPXRoaXMuZmlsdGVyc1tlXTtmLmdldEJvdW5kcyYmZi5nZXRCb3VuZHMoZCl9cmV0dXJuIGR9LGIuX2dldEJvdW5kcz1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLl90cmFuc2Zvcm1Cb3VuZHModGhpcy5nZXRCb3VuZHMoKSxhLGIpfSxiLl90cmFuc2Zvcm1Cb3VuZHM9ZnVuY3Rpb24oYSxiLGMpe2lmKCFhKXJldHVybiBhO3ZhciBkPWEueCxlPWEueSxmPWEud2lkdGgsZz1hLmhlaWdodCxoPXRoaXMuX3Byb3BzLm1hdHJpeDtoPWM/aC5pZGVudGl0eSgpOnRoaXMuZ2V0TWF0cml4KGgpLChkfHxlKSYmaC5hcHBlbmRUcmFuc2Zvcm0oMCwwLDEsMSwwLDAsMCwtZCwtZSksYiYmaC5wcmVwZW5kTWF0cml4KGIpO3ZhciBpPWYqaC5hLGo9ZipoLmIsaz1nKmguYyxsPWcqaC5kLG09aC50eCxuPWgudHksbz1tLHA9bSxxPW4scj1uO3JldHVybihkPWkrbSk8bz9vPWQ6ZD5wJiYocD1kKSwoZD1pK2srbSk8bz9vPWQ6ZD5wJiYocD1kKSwoZD1rK20pPG8/bz1kOmQ+cCYmKHA9ZCksKGU9aituKTxxP3E9ZTplPnImJihyPWUpLChlPWorbCtuKTxxP3E9ZTplPnImJihyPWUpLChlPWwrbik8cT9xPWU6ZT5yJiYocj1lKSxhLnNldFZhbHVlcyhvLHEscC1vLHItcSl9LGIuX2hhc01vdXNlRXZlbnRMaXN0ZW5lcj1mdW5jdGlvbigpe2Zvcih2YXIgYj1hLl9NT1VTRV9FVkVOVFMsYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKylpZih0aGlzLmhhc0V2ZW50TGlzdGVuZXIoYltjXSkpcmV0dXJuITA7cmV0dXJuISF0aGlzLmN1cnNvcn0sY3JlYXRlanMuRGlzcGxheU9iamVjdD1jcmVhdGVqcy5wcm9tb3RlKGEsXCJFdmVudERpc3BhdGNoZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt0aGlzLkRpc3BsYXlPYmplY3RfY29uc3RydWN0b3IoKSx0aGlzLmNoaWxkcmVuPVtdLHRoaXMubW91c2VDaGlsZHJlbj0hMCx0aGlzLnRpY2tDaGlsZHJlbj0hMH12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5EaXNwbGF5T2JqZWN0KTtiLmdldE51bUNoaWxkcmVuPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY2hpbGRyZW4ubGVuZ3RofTt0cnl7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMoYix7bnVtQ2hpbGRyZW46e2dldDpiLmdldE51bUNoaWxkcmVufX0pfWNhdGNoKGMpe31iLmluaXRpYWxpemU9YSxiLmlzVmlzaWJsZT1mdW5jdGlvbigpe3ZhciBhPXRoaXMuY2FjaGVDYW52YXN8fHRoaXMuY2hpbGRyZW4ubGVuZ3RoO3JldHVybiEhKHRoaXMudmlzaWJsZSYmdGhpcy5hbHBoYT4wJiYwIT10aGlzLnNjYWxlWCYmMCE9dGhpcy5zY2FsZVkmJmEpfSxiLmRyYXc9ZnVuY3Rpb24oYSxiKXtpZih0aGlzLkRpc3BsYXlPYmplY3RfZHJhdyhhLGIpKXJldHVybiEwO2Zvcih2YXIgYz10aGlzLmNoaWxkcmVuLnNsaWNlKCksZD0wLGU9Yy5sZW5ndGg7ZT5kO2QrKyl7dmFyIGY9Y1tkXTtmLmlzVmlzaWJsZSgpJiYoYS5zYXZlKCksZi51cGRhdGVDb250ZXh0KGEpLGYuZHJhdyhhKSxhLnJlc3RvcmUoKSl9cmV0dXJuITB9LGIuYWRkQ2hpbGQ9ZnVuY3Rpb24oYSl7aWYobnVsbD09YSlyZXR1cm4gYTt2YXIgYj1hcmd1bWVudHMubGVuZ3RoO2lmKGI+MSl7Zm9yKHZhciBjPTA7Yj5jO2MrKyl0aGlzLmFkZENoaWxkKGFyZ3VtZW50c1tjXSk7cmV0dXJuIGFyZ3VtZW50c1tiLTFdfXJldHVybiBhLnBhcmVudCYmYS5wYXJlbnQucmVtb3ZlQ2hpbGQoYSksYS5wYXJlbnQ9dGhpcyx0aGlzLmNoaWxkcmVuLnB1c2goYSksYS5kaXNwYXRjaEV2ZW50KFwiYWRkZWRcIiksYX0sYi5hZGRDaGlsZEF0PWZ1bmN0aW9uKGEsYil7dmFyIGM9YXJndW1lbnRzLmxlbmd0aCxkPWFyZ3VtZW50c1tjLTFdO2lmKDA+ZHx8ZD50aGlzLmNoaWxkcmVuLmxlbmd0aClyZXR1cm4gYXJndW1lbnRzW2MtMl07aWYoYz4yKXtmb3IodmFyIGU9MDtjLTE+ZTtlKyspdGhpcy5hZGRDaGlsZEF0KGFyZ3VtZW50c1tlXSxkK2UpO3JldHVybiBhcmd1bWVudHNbYy0yXX1yZXR1cm4gYS5wYXJlbnQmJmEucGFyZW50LnJlbW92ZUNoaWxkKGEpLGEucGFyZW50PXRoaXMsdGhpcy5jaGlsZHJlbi5zcGxpY2UoYiwwLGEpLGEuZGlzcGF0Y2hFdmVudChcImFkZGVkXCIpLGF9LGIucmVtb3ZlQ2hpbGQ9ZnVuY3Rpb24oYSl7dmFyIGI9YXJndW1lbnRzLmxlbmd0aDtpZihiPjEpe2Zvcih2YXIgYz0hMCxkPTA7Yj5kO2QrKyljPWMmJnRoaXMucmVtb3ZlQ2hpbGQoYXJndW1lbnRzW2RdKTtyZXR1cm4gY31yZXR1cm4gdGhpcy5yZW1vdmVDaGlsZEF0KGNyZWF0ZWpzLmluZGV4T2YodGhpcy5jaGlsZHJlbixhKSl9LGIucmVtb3ZlQ2hpbGRBdD1mdW5jdGlvbihhKXt2YXIgYj1hcmd1bWVudHMubGVuZ3RoO2lmKGI+MSl7Zm9yKHZhciBjPVtdLGQ9MDtiPmQ7ZCsrKWNbZF09YXJndW1lbnRzW2RdO2Muc29ydChmdW5jdGlvbihhLGIpe3JldHVybiBiLWF9KTtmb3IodmFyIGU9ITAsZD0wO2I+ZDtkKyspZT1lJiZ0aGlzLnJlbW92ZUNoaWxkQXQoY1tkXSk7cmV0dXJuIGV9aWYoMD5hfHxhPnRoaXMuY2hpbGRyZW4ubGVuZ3RoLTEpcmV0dXJuITE7dmFyIGY9dGhpcy5jaGlsZHJlblthXTtyZXR1cm4gZiYmKGYucGFyZW50PW51bGwpLHRoaXMuY2hpbGRyZW4uc3BsaWNlKGEsMSksZi5kaXNwYXRjaEV2ZW50KFwicmVtb3ZlZFwiKSwhMH0sYi5yZW1vdmVBbGxDaGlsZHJlbj1mdW5jdGlvbigpe2Zvcih2YXIgYT10aGlzLmNoaWxkcmVuO2EubGVuZ3RoOyl0aGlzLnJlbW92ZUNoaWxkQXQoMCl9LGIuZ2V0Q2hpbGRBdD1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5jaGlsZHJlblthXX0sYi5nZXRDaGlsZEJ5TmFtZT1mdW5jdGlvbihhKXtmb3IodmFyIGI9dGhpcy5jaGlsZHJlbixjPTAsZD1iLmxlbmd0aDtkPmM7YysrKWlmKGJbY10ubmFtZT09YSlyZXR1cm4gYltjXTtyZXR1cm4gbnVsbH0sYi5zb3J0Q2hpbGRyZW49ZnVuY3Rpb24oYSl7dGhpcy5jaGlsZHJlbi5zb3J0KGEpfSxiLmdldENoaWxkSW5kZXg9ZnVuY3Rpb24oYSl7cmV0dXJuIGNyZWF0ZWpzLmluZGV4T2YodGhpcy5jaGlsZHJlbixhKX0sYi5zd2FwQ2hpbGRyZW5BdD1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuY2hpbGRyZW4sZD1jW2FdLGU9Y1tiXTtkJiZlJiYoY1thXT1lLGNbYl09ZCl9LGIuc3dhcENoaWxkcmVuPWZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjLGQsZT10aGlzLmNoaWxkcmVuLGY9MCxnPWUubGVuZ3RoO2c+ZiYmKGVbZl09PWEmJihjPWYpLGVbZl09PWImJihkPWYpLG51bGw9PWN8fG51bGw9PWQpO2YrKyk7ZiE9ZyYmKGVbY109YixlW2RdPWEpfSxiLnNldENoaWxkSW5kZXg9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLmNoaWxkcmVuLGQ9Yy5sZW5ndGg7aWYoIShhLnBhcmVudCE9dGhpc3x8MD5ifHxiPj1kKSl7Zm9yKHZhciBlPTA7ZD5lJiZjW2VdIT1hO2UrKyk7ZSE9ZCYmZSE9YiYmKGMuc3BsaWNlKGUsMSksYy5zcGxpY2UoYiwwLGEpKX19LGIuY29udGFpbnM9ZnVuY3Rpb24oYSl7Zm9yKDthOyl7aWYoYT09dGhpcylyZXR1cm4hMDthPWEucGFyZW50fXJldHVybiExfSxiLmhpdFRlc3Q9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbnVsbCE9dGhpcy5nZXRPYmplY3RVbmRlclBvaW50KGEsYil9LGIuZ2V0T2JqZWN0c1VuZGVyUG9pbnQ9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPVtdLGU9dGhpcy5sb2NhbFRvR2xvYmFsKGEsYik7cmV0dXJuIHRoaXMuX2dldE9iamVjdHNVbmRlclBvaW50KGUueCxlLnksZCxjPjAsMT09YyksZH0sYi5nZXRPYmplY3RVbmRlclBvaW50PWZ1bmN0aW9uKGEsYixjKXt2YXIgZD10aGlzLmxvY2FsVG9HbG9iYWwoYSxiKTtyZXR1cm4gdGhpcy5fZ2V0T2JqZWN0c1VuZGVyUG9pbnQoZC54LGQueSxudWxsLGM+MCwxPT1jKX0sYi5nZXRCb3VuZHM9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZ2V0Qm91bmRzKG51bGwsITApfSxiLmdldFRyYW5zZm9ybWVkQm91bmRzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2dldEJvdW5kcygpfSxiLmNsb25lPWZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuX2Nsb25lUHJvcHMobmV3IGEpO3JldHVybiBiJiZ0aGlzLl9jbG9uZUNoaWxkcmVuKGMpLGN9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltDb250YWluZXIgKG5hbWU9XCIrdGhpcy5uYW1lK1wiKV1cIn0sYi5fdGljaz1mdW5jdGlvbihhKXtpZih0aGlzLnRpY2tDaGlsZHJlbilmb3IodmFyIGI9dGhpcy5jaGlsZHJlbi5sZW5ndGgtMTtiPj0wO2ItLSl7dmFyIGM9dGhpcy5jaGlsZHJlbltiXTtjLnRpY2tFbmFibGVkJiZjLl90aWNrJiZjLl90aWNrKGEpfXRoaXMuRGlzcGxheU9iamVjdF9fdGljayhhKX0sYi5fY2xvbmVDaGlsZHJlbj1mdW5jdGlvbihhKXthLmNoaWxkcmVuLmxlbmd0aCYmYS5yZW1vdmVBbGxDaGlsZHJlbigpO2Zvcih2YXIgYj1hLmNoaWxkcmVuLGM9MCxkPXRoaXMuY2hpbGRyZW4ubGVuZ3RoO2Q+YztjKyspe3ZhciBlPXRoaXMuY2hpbGRyZW5bY10uY2xvbmUoITApO2UucGFyZW50PWEsYi5wdXNoKGUpfX0sYi5fZ2V0T2JqZWN0c1VuZGVyUG9pbnQ9ZnVuY3Rpb24oYixjLGQsZSxmLGcpe2lmKGc9Z3x8MCwhZyYmIXRoaXMuX3Rlc3RNYXNrKHRoaXMsYixjKSlyZXR1cm4gbnVsbDt2YXIgaCxpPWNyZWF0ZWpzLkRpc3BsYXlPYmplY3QuX2hpdFRlc3RDb250ZXh0O2Y9Znx8ZSYmdGhpcy5faGFzTW91c2VFdmVudExpc3RlbmVyKCk7Zm9yKHZhciBqPXRoaXMuY2hpbGRyZW4saz1qLmxlbmd0aCxsPWstMTtsPj0wO2wtLSl7dmFyIG09altsXSxuPW0uaGl0QXJlYTtpZihtLnZpc2libGUmJihufHxtLmlzVmlzaWJsZSgpKSYmKCFlfHxtLm1vdXNlRW5hYmxlZCkmJihufHx0aGlzLl90ZXN0TWFzayhtLGIsYykpKWlmKCFuJiZtIGluc3RhbmNlb2YgYSl7dmFyIG89bS5fZ2V0T2JqZWN0c1VuZGVyUG9pbnQoYixjLGQsZSxmLGcrMSk7aWYoIWQmJm8pcmV0dXJuIGUmJiF0aGlzLm1vdXNlQ2hpbGRyZW4/dGhpczpvfWVsc2V7aWYoZSYmIWYmJiFtLl9oYXNNb3VzZUV2ZW50TGlzdGVuZXIoKSljb250aW51ZTt2YXIgcD1tLmdldENvbmNhdGVuYXRlZERpc3BsYXlQcm9wcyhtLl9wcm9wcyk7aWYoaD1wLm1hdHJpeCxuJiYoaC5hcHBlbmRNYXRyaXgobi5nZXRNYXRyaXgobi5fcHJvcHMubWF0cml4KSkscC5hbHBoYT1uLmFscGhhKSxpLmdsb2JhbEFscGhhPXAuYWxwaGEsaS5zZXRUcmFuc2Zvcm0oaC5hLGguYixoLmMsaC5kLGgudHgtYixoLnR5LWMpLChufHxtKS5kcmF3KGkpLCF0aGlzLl90ZXN0SGl0KGkpKWNvbnRpbnVlO2lmKGkuc2V0VHJhbnNmb3JtKDEsMCwwLDEsMCwwKSxpLmNsZWFyUmVjdCgwLDAsMiwyKSwhZClyZXR1cm4gZSYmIXRoaXMubW91c2VDaGlsZHJlbj90aGlzOm07ZC5wdXNoKG0pfX1yZXR1cm4gbnVsbH0sYi5fdGVzdE1hc2s9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWEubWFzaztpZighZHx8IWQuZ3JhcGhpY3N8fGQuZ3JhcGhpY3MuaXNFbXB0eSgpKXJldHVybiEwO3ZhciBlPXRoaXMuX3Byb3BzLm1hdHJpeCxmPWEucGFyZW50O2U9Zj9mLmdldENvbmNhdGVuYXRlZE1hdHJpeChlKTplLmlkZW50aXR5KCksZT1kLmdldE1hdHJpeChkLl9wcm9wcy5tYXRyaXgpLnByZXBlbmRNYXRyaXgoZSk7dmFyIGc9Y3JlYXRlanMuRGlzcGxheU9iamVjdC5faGl0VGVzdENvbnRleHQ7cmV0dXJuIGcuc2V0VHJhbnNmb3JtKGUuYSxlLmIsZS5jLGUuZCxlLnR4LWIsZS50eS1jKSxkLmdyYXBoaWNzLmRyYXdBc1BhdGgoZyksZy5maWxsU3R5bGU9XCIjMDAwXCIsZy5maWxsKCksdGhpcy5fdGVzdEhpdChnKT8oZy5zZXRUcmFuc2Zvcm0oMSwwLDAsMSwwLDApLGcuY2xlYXJSZWN0KDAsMCwyLDIpLCEwKTohMX0sYi5fZ2V0Qm91bmRzPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5EaXNwbGF5T2JqZWN0X2dldEJvdW5kcygpO2lmKGMpcmV0dXJuIHRoaXMuX3RyYW5zZm9ybUJvdW5kcyhjLGEsYik7dmFyIGQ9dGhpcy5fcHJvcHMubWF0cml4O2Q9Yj9kLmlkZW50aXR5KCk6dGhpcy5nZXRNYXRyaXgoZCksYSYmZC5wcmVwZW5kTWF0cml4KGEpO2Zvcih2YXIgZT10aGlzLmNoaWxkcmVuLmxlbmd0aCxmPW51bGwsZz0wO2U+ZztnKyspe3ZhciBoPXRoaXMuY2hpbGRyZW5bZ107aC52aXNpYmxlJiYoYz1oLl9nZXRCb3VuZHMoZCkpJiYoZj9mLmV4dGVuZChjLngsYy55LGMud2lkdGgsYy5oZWlnaHQpOmY9Yy5jbG9uZSgpKX1yZXR1cm4gZn0sY3JlYXRlanMuQ29udGFpbmVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkRpc3BsYXlPYmplY3RcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSl7dGhpcy5Db250YWluZXJfY29uc3RydWN0b3IoKSx0aGlzLmF1dG9DbGVhcj0hMCx0aGlzLmNhbnZhcz1cInN0cmluZ1wiPT10eXBlb2YgYT9kb2N1bWVudC5nZXRFbGVtZW50QnlJZChhKTphLHRoaXMubW91c2VYPTAsdGhpcy5tb3VzZVk9MCx0aGlzLmRyYXdSZWN0PW51bGwsdGhpcy5zbmFwVG9QaXhlbEVuYWJsZWQ9ITEsdGhpcy5tb3VzZUluQm91bmRzPSExLHRoaXMudGlja09uVXBkYXRlPSEwLHRoaXMubW91c2VNb3ZlT3V0c2lkZT0hMSx0aGlzLnByZXZlbnRTZWxlY3Rpb249ITAsdGhpcy5fcG9pbnRlckRhdGE9e30sdGhpcy5fcG9pbnRlckNvdW50PTAsdGhpcy5fcHJpbWFyeVBvaW50ZXJJRD1udWxsLHRoaXMuX21vdXNlT3ZlckludGVydmFsSUQ9bnVsbCx0aGlzLl9uZXh0U3RhZ2U9bnVsbCx0aGlzLl9wcmV2U3RhZ2U9bnVsbCx0aGlzLmVuYWJsZURPTUV2ZW50cyghMCl9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQ29udGFpbmVyKTtiLl9nZXRfbmV4dFN0YWdlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX25leHRTdGFnZX0sYi5fc2V0X25leHRTdGFnZT1mdW5jdGlvbihhKXt0aGlzLl9uZXh0U3RhZ2UmJih0aGlzLl9uZXh0U3RhZ2UuX3ByZXZTdGFnZT1udWxsKSxhJiYoYS5fcHJldlN0YWdlPXRoaXMpLHRoaXMuX25leHRTdGFnZT1hfTt0cnl7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMoYix7bmV4dFN0YWdlOntnZXQ6Yi5fZ2V0X25leHRTdGFnZSxzZXQ6Yi5fc2V0X25leHRTdGFnZX19KX1jYXRjaChjKXt9Yi51cGRhdGU9ZnVuY3Rpb24oYSl7aWYodGhpcy5jYW52YXMmJih0aGlzLnRpY2tPblVwZGF0ZSYmdGhpcy50aWNrKGEpLHRoaXMuZGlzcGF0Y2hFdmVudChcImRyYXdzdGFydFwiLCExLCEwKSE9PSExKSl7Y3JlYXRlanMuRGlzcGxheU9iamVjdC5fc25hcFRvUGl4ZWxFbmFibGVkPXRoaXMuc25hcFRvUGl4ZWxFbmFibGVkO3ZhciBiPXRoaXMuZHJhd1JlY3QsYz10aGlzLmNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7Yy5zZXRUcmFuc2Zvcm0oMSwwLDAsMSwwLDApLHRoaXMuYXV0b0NsZWFyJiYoYj9jLmNsZWFyUmVjdChiLngsYi55LGIud2lkdGgsYi5oZWlnaHQpOmMuY2xlYXJSZWN0KDAsMCx0aGlzLmNhbnZhcy53aWR0aCsxLHRoaXMuY2FudmFzLmhlaWdodCsxKSksYy5zYXZlKCksdGhpcy5kcmF3UmVjdCYmKGMuYmVnaW5QYXRoKCksYy5yZWN0KGIueCxiLnksYi53aWR0aCxiLmhlaWdodCksYy5jbGlwKCkpLHRoaXMudXBkYXRlQ29udGV4dChjKSx0aGlzLmRyYXcoYywhMSksYy5yZXN0b3JlKCksdGhpcy5kaXNwYXRjaEV2ZW50KFwiZHJhd2VuZFwiKX19LGIudGljaz1mdW5jdGlvbihhKXtpZih0aGlzLnRpY2tFbmFibGVkJiZ0aGlzLmRpc3BhdGNoRXZlbnQoXCJ0aWNrc3RhcnRcIiwhMSwhMCkhPT0hMSl7dmFyIGI9bmV3IGNyZWF0ZWpzLkV2ZW50KFwidGlja1wiKTtpZihhKWZvcih2YXIgYyBpbiBhKWEuaGFzT3duUHJvcGVydHkoYykmJihiW2NdPWFbY10pO3RoaXMuX3RpY2soYiksdGhpcy5kaXNwYXRjaEV2ZW50KFwidGlja2VuZFwiKX19LGIuaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oYSl7XCJ0aWNrXCI9PWEudHlwZSYmdGhpcy51cGRhdGUoYSl9LGIuY2xlYXI9ZnVuY3Rpb24oKXtpZih0aGlzLmNhbnZhcyl7dmFyIGE9dGhpcy5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO2Euc2V0VHJhbnNmb3JtKDEsMCwwLDEsMCwwKSxhLmNsZWFyUmVjdCgwLDAsdGhpcy5jYW52YXMud2lkdGgrMSx0aGlzLmNhbnZhcy5oZWlnaHQrMSl9fSxiLnRvRGF0YVVSTD1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9dGhpcy5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpLGU9dGhpcy5jYW52YXMud2lkdGgsZj10aGlzLmNhbnZhcy5oZWlnaHQ7aWYoYSl7Yz1kLmdldEltYWdlRGF0YSgwLDAsZSxmKTt2YXIgZz1kLmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbjtkLmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbj1cImRlc3RpbmF0aW9uLW92ZXJcIixkLmZpbGxTdHlsZT1hLGQuZmlsbFJlY3QoMCwwLGUsZil9dmFyIGg9dGhpcy5jYW52YXMudG9EYXRhVVJMKGJ8fFwiaW1hZ2UvcG5nXCIpO3JldHVybiBhJiYoZC5wdXRJbWFnZURhdGEoYywwLDApLGQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uPWcpLGh9LGIuZW5hYmxlTW91c2VPdmVyPWZ1bmN0aW9uKGEpe2lmKHRoaXMuX21vdXNlT3ZlckludGVydmFsSUQmJihjbGVhckludGVydmFsKHRoaXMuX21vdXNlT3ZlckludGVydmFsSUQpLHRoaXMuX21vdXNlT3ZlckludGVydmFsSUQ9bnVsbCwwPT1hJiZ0aGlzLl90ZXN0TW91c2VPdmVyKCEwKSksbnVsbD09YSlhPTIwO2Vsc2UgaWYoMD49YSlyZXR1cm47dmFyIGI9dGhpczt0aGlzLl9tb3VzZU92ZXJJbnRlcnZhbElEPXNldEludGVydmFsKGZ1bmN0aW9uKCl7Yi5fdGVzdE1vdXNlT3ZlcigpfSwxZTMvTWF0aC5taW4oNTAsYSkpfSxiLmVuYWJsZURPTUV2ZW50cz1mdW5jdGlvbihhKXtudWxsPT1hJiYoYT0hMCk7dmFyIGIsYyxkPXRoaXMuX2V2ZW50TGlzdGVuZXJzO2lmKCFhJiZkKXtmb3IoYiBpbiBkKWM9ZFtiXSxjLnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihiLGMuZiwhMSk7dGhpcy5fZXZlbnRMaXN0ZW5lcnM9bnVsbH1lbHNlIGlmKGEmJiFkJiZ0aGlzLmNhbnZhcyl7dmFyIGU9d2luZG93LmFkZEV2ZW50TGlzdGVuZXI/d2luZG93OmRvY3VtZW50LGY9dGhpcztkPXRoaXMuX2V2ZW50TGlzdGVuZXJzPXt9LGQubW91c2V1cD17dDplLGY6ZnVuY3Rpb24oYSl7Zi5faGFuZGxlTW91c2VVcChhKX19LGQubW91c2Vtb3ZlPXt0OmUsZjpmdW5jdGlvbihhKXtmLl9oYW5kbGVNb3VzZU1vdmUoYSl9fSxkLmRibGNsaWNrPXt0OnRoaXMuY2FudmFzLGY6ZnVuY3Rpb24oYSl7Zi5faGFuZGxlRG91YmxlQ2xpY2soYSl9fSxkLm1vdXNlZG93bj17dDp0aGlzLmNhbnZhcyxmOmZ1bmN0aW9uKGEpe2YuX2hhbmRsZU1vdXNlRG93bihhKX19O2ZvcihiIGluIGQpYz1kW2JdLGMudC5hZGRFdmVudExpc3RlbmVyKGIsYy5mLCExKX19LGIuY2xvbmU9ZnVuY3Rpb24oKXt0aHJvd1wiU3RhZ2UgY2Fubm90IGJlIGNsb25lZC5cIn0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1N0YWdlIChuYW1lPVwiK3RoaXMubmFtZStcIildXCJ9LGIuX2dldEVsZW1lbnRSZWN0PWZ1bmN0aW9uKGEpe3ZhciBiO3RyeXtiPWEuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCl9Y2F0Y2goYyl7Yj17dG9wOmEub2Zmc2V0VG9wLGxlZnQ6YS5vZmZzZXRMZWZ0LHdpZHRoOmEub2Zmc2V0V2lkdGgsaGVpZ2h0OmEub2Zmc2V0SGVpZ2h0fX12YXIgZD0od2luZG93LnBhZ2VYT2Zmc2V0fHxkb2N1bWVudC5zY3JvbGxMZWZ0fHwwKS0oZG9jdW1lbnQuY2xpZW50TGVmdHx8ZG9jdW1lbnQuYm9keS5jbGllbnRMZWZ0fHwwKSxlPSh3aW5kb3cucGFnZVlPZmZzZXR8fGRvY3VtZW50LnNjcm9sbFRvcHx8MCktKGRvY3VtZW50LmNsaWVudFRvcHx8ZG9jdW1lbnQuYm9keS5jbGllbnRUb3B8fDApLGY9d2luZG93LmdldENvbXB1dGVkU3R5bGU/Z2V0Q29tcHV0ZWRTdHlsZShhLG51bGwpOmEuY3VycmVudFN0eWxlLGc9cGFyc2VJbnQoZi5wYWRkaW5nTGVmdCkrcGFyc2VJbnQoZi5ib3JkZXJMZWZ0V2lkdGgpLGg9cGFyc2VJbnQoZi5wYWRkaW5nVG9wKStwYXJzZUludChmLmJvcmRlclRvcFdpZHRoKSxpPXBhcnNlSW50KGYucGFkZGluZ1JpZ2h0KStwYXJzZUludChmLmJvcmRlclJpZ2h0V2lkdGgpLGo9cGFyc2VJbnQoZi5wYWRkaW5nQm90dG9tKStwYXJzZUludChmLmJvcmRlckJvdHRvbVdpZHRoKTtyZXR1cm57bGVmdDpiLmxlZnQrZCtnLHJpZ2h0OmIucmlnaHQrZC1pLHRvcDpiLnRvcCtlK2gsYm90dG9tOmIuYm90dG9tK2Utan19LGIuX2dldFBvaW50ZXJEYXRhPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuX3BvaW50ZXJEYXRhW2FdO3JldHVybiBifHwoYj10aGlzLl9wb2ludGVyRGF0YVthXT17eDowLHk6MH0pLGJ9LGIuX2hhbmRsZU1vdXNlTW92ZT1mdW5jdGlvbihhKXthfHwoYT13aW5kb3cuZXZlbnQpLHRoaXMuX2hhbmRsZVBvaW50ZXJNb3ZlKC0xLGEsYS5wYWdlWCxhLnBhZ2VZKX0sYi5faGFuZGxlUG9pbnRlck1vdmU9ZnVuY3Rpb24oYSxiLGMsZCxlKXtpZigoIXRoaXMuX3ByZXZTdGFnZXx8dm9pZCAwIT09ZSkmJnRoaXMuY2FudmFzKXt2YXIgZj10aGlzLl9uZXh0U3RhZ2UsZz10aGlzLl9nZXRQb2ludGVyRGF0YShhKSxoPWcuaW5Cb3VuZHM7dGhpcy5fdXBkYXRlUG9pbnRlclBvc2l0aW9uKGEsYixjLGQpLChofHxnLmluQm91bmRzfHx0aGlzLm1vdXNlTW92ZU91dHNpZGUpJiYoLTE9PT1hJiZnLmluQm91bmRzPT0haCYmdGhpcy5fZGlzcGF0Y2hNb3VzZUV2ZW50KHRoaXMsaD9cIm1vdXNlbGVhdmVcIjpcIm1vdXNlZW50ZXJcIiwhMSxhLGcsYiksdGhpcy5fZGlzcGF0Y2hNb3VzZUV2ZW50KHRoaXMsXCJzdGFnZW1vdXNlbW92ZVwiLCExLGEsZyxiKSx0aGlzLl9kaXNwYXRjaE1vdXNlRXZlbnQoZy50YXJnZXQsXCJwcmVzc21vdmVcIiwhMCxhLGcsYikpLGYmJmYuX2hhbmRsZVBvaW50ZXJNb3ZlKGEsYixjLGQsbnVsbCl9fSxiLl91cGRhdGVQb2ludGVyUG9zaXRpb249ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9dGhpcy5fZ2V0RWxlbWVudFJlY3QodGhpcy5jYW52YXMpO2MtPWUubGVmdCxkLT1lLnRvcDt2YXIgZj10aGlzLmNhbnZhcy53aWR0aCxnPXRoaXMuY2FudmFzLmhlaWdodDtjLz0oZS5yaWdodC1lLmxlZnQpL2YsZC89KGUuYm90dG9tLWUudG9wKS9nO3ZhciBoPXRoaXMuX2dldFBvaW50ZXJEYXRhKGEpOyhoLmluQm91bmRzPWM+PTAmJmQ+PTAmJmYtMT49YyYmZy0xPj1kKT8oaC54PWMsaC55PWQpOnRoaXMubW91c2VNb3ZlT3V0c2lkZSYmKGgueD0wPmM/MDpjPmYtMT9mLTE6YyxoLnk9MD5kPzA6ZD5nLTE/Zy0xOmQpLGgucG9zRXZ0T2JqPWIsaC5yYXdYPWMsaC5yYXdZPWQsKGE9PT10aGlzLl9wcmltYXJ5UG9pbnRlcklEfHwtMT09PWEpJiYodGhpcy5tb3VzZVg9aC54LHRoaXMubW91c2VZPWgueSx0aGlzLm1vdXNlSW5Cb3VuZHM9aC5pbkJvdW5kcyl9LGIuX2hhbmRsZU1vdXNlVXA9ZnVuY3Rpb24oYSl7dGhpcy5faGFuZGxlUG9pbnRlclVwKC0xLGEsITEpfSxiLl9oYW5kbGVQb2ludGVyVXA9ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9dGhpcy5fbmV4dFN0YWdlLGY9dGhpcy5fZ2V0UG9pbnRlckRhdGEoYSk7aWYoIXRoaXMuX3ByZXZTdGFnZXx8dm9pZCAwIT09ZCl7dmFyIGc9bnVsbCxoPWYudGFyZ2V0O2R8fCFoJiYhZXx8KGc9dGhpcy5fZ2V0T2JqZWN0c1VuZGVyUG9pbnQoZi54LGYueSxudWxsLCEwKSksZi5kb3duJiYodGhpcy5fZGlzcGF0Y2hNb3VzZUV2ZW50KHRoaXMsXCJzdGFnZW1vdXNldXBcIiwhMSxhLGYsYixnKSxmLmRvd249ITEpLGc9PWgmJnRoaXMuX2Rpc3BhdGNoTW91c2VFdmVudChoLFwiY2xpY2tcIiwhMCxhLGYsYiksdGhpcy5fZGlzcGF0Y2hNb3VzZUV2ZW50KGgsXCJwcmVzc3VwXCIsITAsYSxmLGIpLGM/KGE9PXRoaXMuX3ByaW1hcnlQb2ludGVySUQmJih0aGlzLl9wcmltYXJ5UG9pbnRlcklEPW51bGwpLGRlbGV0ZSB0aGlzLl9wb2ludGVyRGF0YVthXSk6Zi50YXJnZXQ9bnVsbCxlJiZlLl9oYW5kbGVQb2ludGVyVXAoYSxiLGMsZHx8ZyYmdGhpcyl9fSxiLl9oYW5kbGVNb3VzZURvd249ZnVuY3Rpb24oYSl7dGhpcy5faGFuZGxlUG9pbnRlckRvd24oLTEsYSxhLnBhZ2VYLGEucGFnZVkpfSxiLl9oYW5kbGVQb2ludGVyRG93bj1mdW5jdGlvbihhLGIsYyxkLGUpe3RoaXMucHJldmVudFNlbGVjdGlvbiYmYi5wcmV2ZW50RGVmYXVsdCgpLChudWxsPT10aGlzLl9wcmltYXJ5UG9pbnRlcklEfHwtMT09PWEpJiYodGhpcy5fcHJpbWFyeVBvaW50ZXJJRD1hKSxudWxsIT1kJiZ0aGlzLl91cGRhdGVQb2ludGVyUG9zaXRpb24oYSxiLGMsZCk7dmFyIGY9bnVsbCxnPXRoaXMuX25leHRTdGFnZSxoPXRoaXMuX2dldFBvaW50ZXJEYXRhKGEpO2V8fChmPWgudGFyZ2V0PXRoaXMuX2dldE9iamVjdHNVbmRlclBvaW50KGgueCxoLnksbnVsbCwhMCkpLGguaW5Cb3VuZHMmJih0aGlzLl9kaXNwYXRjaE1vdXNlRXZlbnQodGhpcyxcInN0YWdlbW91c2Vkb3duXCIsITEsYSxoLGIsZiksaC5kb3duPSEwKSx0aGlzLl9kaXNwYXRjaE1vdXNlRXZlbnQoZixcIm1vdXNlZG93blwiLCEwLGEsaCxiKSxnJiZnLl9oYW5kbGVQb2ludGVyRG93bihhLGIsYyxkLGV8fGYmJnRoaXMpfSxiLl90ZXN0TW91c2VPdmVyPWZ1bmN0aW9uKGEsYixjKXtpZighdGhpcy5fcHJldlN0YWdlfHx2b2lkIDAhPT1iKXt2YXIgZD10aGlzLl9uZXh0U3RhZ2U7aWYoIXRoaXMuX21vdXNlT3ZlckludGVydmFsSUQpcmV0dXJuIHZvaWQoZCYmZC5fdGVzdE1vdXNlT3ZlcihhLGIsYykpO3ZhciBlPXRoaXMuX2dldFBvaW50ZXJEYXRhKC0xKTtpZihlJiYoYXx8dGhpcy5tb3VzZVghPXRoaXMuX21vdXNlT3Zlclh8fHRoaXMubW91c2VZIT10aGlzLl9tb3VzZU92ZXJZfHwhdGhpcy5tb3VzZUluQm91bmRzKSl7dmFyIGYsZyxoLGk9ZS5wb3NFdnRPYmosaj1jfHxpJiZpLnRhcmdldD09dGhpcy5jYW52YXMsaz1udWxsLGw9LTEsbT1cIlwiOyFiJiYoYXx8dGhpcy5tb3VzZUluQm91bmRzJiZqKSYmKGs9dGhpcy5fZ2V0T2JqZWN0c1VuZGVyUG9pbnQodGhpcy5tb3VzZVgsdGhpcy5tb3VzZVksbnVsbCwhMCksdGhpcy5fbW91c2VPdmVyWD10aGlzLm1vdXNlWCx0aGlzLl9tb3VzZU92ZXJZPXRoaXMubW91c2VZKTt2YXIgbj10aGlzLl9tb3VzZU92ZXJUYXJnZXR8fFtdLG89bltuLmxlbmd0aC0xXSxwPXRoaXMuX21vdXNlT3ZlclRhcmdldD1bXTtmb3IoZj1rO2Y7KXAudW5zaGlmdChmKSxtfHwobT1mLmN1cnNvciksZj1mLnBhcmVudDtmb3IodGhpcy5jYW52YXMuc3R5bGUuY3Vyc29yPW0sIWImJmMmJihjLmNhbnZhcy5zdHlsZS5jdXJzb3I9bSksZz0wLGg9cC5sZW5ndGg7aD5nJiZwW2ddPT1uW2ddO2crKylsPWc7Zm9yKG8hPWsmJnRoaXMuX2Rpc3BhdGNoTW91c2VFdmVudChvLFwibW91c2VvdXRcIiwhMCwtMSxlLGksayksZz1uLmxlbmd0aC0xO2c+bDtnLS0pdGhpcy5fZGlzcGF0Y2hNb3VzZUV2ZW50KG5bZ10sXCJyb2xsb3V0XCIsITEsLTEsZSxpLGspO2ZvcihnPXAubGVuZ3RoLTE7Zz5sO2ctLSl0aGlzLl9kaXNwYXRjaE1vdXNlRXZlbnQocFtnXSxcInJvbGxvdmVyXCIsITEsLTEsZSxpLG8pO28hPWsmJnRoaXMuX2Rpc3BhdGNoTW91c2VFdmVudChrLFwibW91c2VvdmVyXCIsITAsLTEsZSxpLG8pLGQmJmQuX3Rlc3RNb3VzZU92ZXIoYSxifHxrJiZ0aGlzLGN8fGomJnRoaXMpfX19LGIuX2hhbmRsZURvdWJsZUNsaWNrPWZ1bmN0aW9uKGEsYil7dmFyIGM9bnVsbCxkPXRoaXMuX25leHRTdGFnZSxlPXRoaXMuX2dldFBvaW50ZXJEYXRhKC0xKTtifHwoYz10aGlzLl9nZXRPYmplY3RzVW5kZXJQb2ludChlLngsZS55LG51bGwsITApLHRoaXMuX2Rpc3BhdGNoTW91c2VFdmVudChjLFwiZGJsY2xpY2tcIiwhMCwtMSxlLGEpKSxkJiZkLl9oYW5kbGVEb3VibGVDbGljayhhLGJ8fGMmJnRoaXMpfSxiLl9kaXNwYXRjaE1vdXNlRXZlbnQ9ZnVuY3Rpb24oYSxiLGMsZCxlLGYsZyl7aWYoYSYmKGN8fGEuaGFzRXZlbnRMaXN0ZW5lcihiKSkpe3ZhciBoPW5ldyBjcmVhdGVqcy5Nb3VzZUV2ZW50KGIsYywhMSxlLngsZS55LGYsZCxkPT09dGhpcy5fcHJpbWFyeVBvaW50ZXJJRHx8LTE9PT1kLGUucmF3WCxlLnJhd1ksZyk7YS5kaXNwYXRjaEV2ZW50KGgpfX0sY3JlYXRlanMuU3RhZ2U9Y3JlYXRlanMucHJvbW90ZShhLFwiQ29udGFpbmVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGEpe3RoaXMuRGlzcGxheU9iamVjdF9jb25zdHJ1Y3RvcigpLFwic3RyaW5nXCI9PXR5cGVvZiBhPyh0aGlzLmltYWdlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIiksdGhpcy5pbWFnZS5zcmM9YSk6dGhpcy5pbWFnZT1hLHRoaXMuc291cmNlUmVjdD1udWxsfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkRpc3BsYXlPYmplY3QpO2IuaW5pdGlhbGl6ZT1hLGIuaXNWaXNpYmxlPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5pbWFnZSxiPXRoaXMuY2FjaGVDYW52YXN8fGEmJihhLm5hdHVyYWxXaWR0aHx8YS5nZXRDb250ZXh0fHxhLnJlYWR5U3RhdGU+PTIpO3JldHVybiEhKHRoaXMudmlzaWJsZSYmdGhpcy5hbHBoYT4wJiYwIT10aGlzLnNjYWxlWCYmMCE9dGhpcy5zY2FsZVkmJmIpfSxiLmRyYXc9ZnVuY3Rpb24oYSxiKXtpZih0aGlzLkRpc3BsYXlPYmplY3RfZHJhdyhhLGIpfHwhdGhpcy5pbWFnZSlyZXR1cm4hMDt2YXIgYz10aGlzLmltYWdlLGQ9dGhpcy5zb3VyY2VSZWN0O2lmKGQpe3ZhciBlPWQueCxmPWQueSxnPWUrZC53aWR0aCxoPWYrZC5oZWlnaHQsaT0wLGo9MCxrPWMud2lkdGgsbD1jLmhlaWdodDswPmUmJihpLT1lLGU9MCksZz5rJiYoZz1rKSwwPmYmJihqLT1mLGY9MCksaD5sJiYoaD1sKSxhLmRyYXdJbWFnZShjLGUsZixnLWUsaC1mLGksaixnLWUsaC1mKX1lbHNlIGEuZHJhd0ltYWdlKGMsMCwwKTtyZXR1cm4hMH0sYi5nZXRCb3VuZHM9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLkRpc3BsYXlPYmplY3RfZ2V0Qm91bmRzKCk7aWYoYSlyZXR1cm4gYTt2YXIgYj10aGlzLmltYWdlLGM9dGhpcy5zb3VyY2VSZWN0fHxiLGQ9YiYmKGIubmF0dXJhbFdpZHRofHxiLmdldENvbnRleHR8fGIucmVhZHlTdGF0ZT49Mik7cmV0dXJuIGQ/dGhpcy5fcmVjdGFuZ2xlLnNldFZhbHVlcygwLDAsYy53aWR0aCxjLmhlaWdodCk6bnVsbH0sYi5jbG9uZT1mdW5jdGlvbigpe3ZhciBiPW5ldyBhKHRoaXMuaW1hZ2UpO3JldHVybiB0aGlzLnNvdXJjZVJlY3QmJihiLnNvdXJjZVJlY3Q9dGhpcy5zb3VyY2VSZWN0LmNsb25lKCkpLHRoaXMuX2Nsb25lUHJvcHMoYiksYn0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0JpdG1hcCAobmFtZT1cIit0aGlzLm5hbWUrXCIpXVwifSxjcmVhdGVqcy5CaXRtYXA9Y3JlYXRlanMucHJvbW90ZShhLFwiRGlzcGxheU9iamVjdFwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIpe3RoaXMuRGlzcGxheU9iamVjdF9jb25zdHJ1Y3RvcigpLHRoaXMuY3VycmVudEZyYW1lPTAsdGhpcy5jdXJyZW50QW5pbWF0aW9uPW51bGwsdGhpcy5wYXVzZWQ9ITAsdGhpcy5zcHJpdGVTaGVldD1hLHRoaXMuY3VycmVudEFuaW1hdGlvbkZyYW1lPTAsdGhpcy5mcmFtZXJhdGU9MCx0aGlzLl9hbmltYXRpb249bnVsbCx0aGlzLl9jdXJyZW50RnJhbWU9bnVsbCx0aGlzLl9za2lwQWR2YW5jZT0hMSxudWxsIT1iJiZ0aGlzLmdvdG9BbmRQbGF5KGIpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkRpc3BsYXlPYmplY3QpO2IuaW5pdGlhbGl6ZT1hLGIuaXNWaXNpYmxlPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5jYWNoZUNhbnZhc3x8dGhpcy5zcHJpdGVTaGVldC5jb21wbGV0ZTtyZXR1cm4hISh0aGlzLnZpc2libGUmJnRoaXMuYWxwaGE+MCYmMCE9dGhpcy5zY2FsZVgmJjAhPXRoaXMuc2NhbGVZJiZhKX0sYi5kcmF3PWZ1bmN0aW9uKGEsYil7aWYodGhpcy5EaXNwbGF5T2JqZWN0X2RyYXcoYSxiKSlyZXR1cm4hMDt0aGlzLl9ub3JtYWxpemVGcmFtZSgpO3ZhciBjPXRoaXMuc3ByaXRlU2hlZXQuZ2V0RnJhbWUoMHx0aGlzLl9jdXJyZW50RnJhbWUpO2lmKCFjKXJldHVybiExO3ZhciBkPWMucmVjdDtyZXR1cm4gZC53aWR0aCYmZC5oZWlnaHQmJmEuZHJhd0ltYWdlKGMuaW1hZ2UsZC54LGQueSxkLndpZHRoLGQuaGVpZ2h0LC1jLnJlZ1gsLWMucmVnWSxkLndpZHRoLGQuaGVpZ2h0KSwhMH0sYi5wbGF5PWZ1bmN0aW9uKCl7dGhpcy5wYXVzZWQ9ITF9LGIuc3RvcD1mdW5jdGlvbigpe3RoaXMucGF1c2VkPSEwfSxiLmdvdG9BbmRQbGF5PWZ1bmN0aW9uKGEpe3RoaXMucGF1c2VkPSExLHRoaXMuX3NraXBBZHZhbmNlPSEwLHRoaXMuX2dvdG8oYSl9LGIuZ290b0FuZFN0b3A9ZnVuY3Rpb24oYSl7dGhpcy5wYXVzZWQ9ITAsdGhpcy5fZ290byhhKX0sYi5hZHZhbmNlPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuZnJhbWVyYXRlfHx0aGlzLnNwcml0ZVNoZWV0LmZyYW1lcmF0ZSxjPWImJm51bGwhPWE/YS8oMWUzL2IpOjE7dGhpcy5fbm9ybWFsaXplRnJhbWUoYyl9LGIuZ2V0Qm91bmRzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuRGlzcGxheU9iamVjdF9nZXRCb3VuZHMoKXx8dGhpcy5zcHJpdGVTaGVldC5nZXRGcmFtZUJvdW5kcyh0aGlzLmN1cnJlbnRGcmFtZSx0aGlzLl9yZWN0YW5nbGUpfSxiLmNsb25lPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2Nsb25lUHJvcHMobmV3IGEodGhpcy5zcHJpdGVTaGVldCkpfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbU3ByaXRlIChuYW1lPVwiK3RoaXMubmFtZStcIildXCJ9LGIuX2Nsb25lUHJvcHM9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuRGlzcGxheU9iamVjdF9fY2xvbmVQcm9wcyhhKSxhLmN1cnJlbnRGcmFtZT10aGlzLmN1cnJlbnRGcmFtZSxhLmN1cnJlbnRBbmltYXRpb249dGhpcy5jdXJyZW50QW5pbWF0aW9uLGEucGF1c2VkPXRoaXMucGF1c2VkLGEuY3VycmVudEFuaW1hdGlvbkZyYW1lPXRoaXMuY3VycmVudEFuaW1hdGlvbkZyYW1lLGEuZnJhbWVyYXRlPXRoaXMuZnJhbWVyYXRlLGEuX2FuaW1hdGlvbj10aGlzLl9hbmltYXRpb24sYS5fY3VycmVudEZyYW1lPXRoaXMuX2N1cnJlbnRGcmFtZSxhLl9za2lwQWR2YW5jZT10aGlzLl9za2lwQWR2YW5jZSxhfSxiLl90aWNrPWZ1bmN0aW9uKGEpe3RoaXMucGF1c2VkfHwodGhpcy5fc2tpcEFkdmFuY2V8fHRoaXMuYWR2YW5jZShhJiZhLmRlbHRhKSx0aGlzLl9za2lwQWR2YW5jZT0hMSksdGhpcy5EaXNwbGF5T2JqZWN0X190aWNrKGEpfSxiLl9ub3JtYWxpemVGcmFtZT1mdW5jdGlvbihhKXthPWF8fDA7dmFyIGIsYz10aGlzLl9hbmltYXRpb24sZD10aGlzLnBhdXNlZCxlPXRoaXMuX2N1cnJlbnRGcmFtZTtpZihjKXt2YXIgZj1jLnNwZWVkfHwxLGc9dGhpcy5jdXJyZW50QW5pbWF0aW9uRnJhbWU7aWYoYj1jLmZyYW1lcy5sZW5ndGgsZythKmY+PWIpe3ZhciBoPWMubmV4dDtpZih0aGlzLl9kaXNwYXRjaEFuaW1hdGlvbkVuZChjLGUsZCxoLGItMSkpcmV0dXJuO2lmKGgpcmV0dXJuIHRoaXMuX2dvdG8oaCxhLShiLWcpL2YpO3RoaXMucGF1c2VkPSEwLGc9Yy5mcmFtZXMubGVuZ3RoLTF9ZWxzZSBnKz1hKmY7dGhpcy5jdXJyZW50QW5pbWF0aW9uRnJhbWU9Zyx0aGlzLl9jdXJyZW50RnJhbWU9Yy5mcmFtZXNbMHxnXX1lbHNlIGlmKGU9dGhpcy5fY3VycmVudEZyYW1lKz1hLGI9dGhpcy5zcHJpdGVTaGVldC5nZXROdW1GcmFtZXMoKSxlPj1iJiZiPjAmJiF0aGlzLl9kaXNwYXRjaEFuaW1hdGlvbkVuZChjLGUsZCxiLTEpJiYodGhpcy5fY3VycmVudEZyYW1lLT1iKT49YilyZXR1cm4gdGhpcy5fbm9ybWFsaXplRnJhbWUoKTtlPTB8dGhpcy5fY3VycmVudEZyYW1lLHRoaXMuY3VycmVudEZyYW1lIT1lJiYodGhpcy5jdXJyZW50RnJhbWU9ZSx0aGlzLmRpc3BhdGNoRXZlbnQoXCJjaGFuZ2VcIikpfSxiLl9kaXNwYXRjaEFuaW1hdGlvbkVuZD1mdW5jdGlvbihhLGIsYyxkLGUpe3ZhciBmPWE/YS5uYW1lOm51bGw7aWYodGhpcy5oYXNFdmVudExpc3RlbmVyKFwiYW5pbWF0aW9uZW5kXCIpKXt2YXIgZz1uZXcgY3JlYXRlanMuRXZlbnQoXCJhbmltYXRpb25lbmRcIik7Zy5uYW1lPWYsZy5uZXh0PWQsdGhpcy5kaXNwYXRjaEV2ZW50KGcpfXZhciBoPXRoaXMuX2FuaW1hdGlvbiE9YXx8dGhpcy5fY3VycmVudEZyYW1lIT1iO3JldHVybiBofHxjfHwhdGhpcy5wYXVzZWR8fCh0aGlzLmN1cnJlbnRBbmltYXRpb25GcmFtZT1lLGg9ITApLGh9LGIuX2dvdG89ZnVuY3Rpb24oYSxiKXtpZih0aGlzLmN1cnJlbnRBbmltYXRpb25GcmFtZT0wLGlzTmFOKGEpKXt2YXIgYz10aGlzLnNwcml0ZVNoZWV0LmdldEFuaW1hdGlvbihhKTtjJiYodGhpcy5fYW5pbWF0aW9uPWMsdGhpcy5jdXJyZW50QW5pbWF0aW9uPWEsdGhpcy5fbm9ybWFsaXplRnJhbWUoYikpfWVsc2UgdGhpcy5jdXJyZW50QW5pbWF0aW9uPXRoaXMuX2FuaW1hdGlvbj1udWxsLHRoaXMuX2N1cnJlbnRGcmFtZT1hLHRoaXMuX25vcm1hbGl6ZUZyYW1lKCl9LGNyZWF0ZWpzLlNwcml0ZT1jcmVhdGVqcy5wcm9tb3RlKGEsXCJEaXNwbGF5T2JqZWN0XCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMuRGlzcGxheU9iamVjdF9jb25zdHJ1Y3RvcigpLHRoaXMuZ3JhcGhpY3M9YT9hOm5ldyBjcmVhdGVqcy5HcmFwaGljc312YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5EaXNwbGF5T2JqZWN0KTtiLmlzVmlzaWJsZT1mdW5jdGlvbigpe3ZhciBhPXRoaXMuY2FjaGVDYW52YXN8fHRoaXMuZ3JhcGhpY3MmJiF0aGlzLmdyYXBoaWNzLmlzRW1wdHkoKTtyZXR1cm4hISh0aGlzLnZpc2libGUmJnRoaXMuYWxwaGE+MCYmMCE9dGhpcy5zY2FsZVgmJjAhPXRoaXMuc2NhbGVZJiZhKX0sYi5kcmF3PWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuRGlzcGxheU9iamVjdF9kcmF3KGEsYik/ITA6KHRoaXMuZ3JhcGhpY3MuZHJhdyhhLHRoaXMpLCEwKX0sYi5jbG9uZT1mdW5jdGlvbihiKXt2YXIgYz1iJiZ0aGlzLmdyYXBoaWNzP3RoaXMuZ3JhcGhpY3MuY2xvbmUoKTp0aGlzLmdyYXBoaWNzO3JldHVybiB0aGlzLl9jbG9uZVByb3BzKG5ldyBhKGMpKX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1NoYXBlIChuYW1lPVwiK3RoaXMubmFtZStcIildXCJ9LGNyZWF0ZWpzLlNoYXBlPWNyZWF0ZWpzLnByb21vdGUoYSxcIkRpc3BsYXlPYmplY3RcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiLGMpe3RoaXMuRGlzcGxheU9iamVjdF9jb25zdHJ1Y3RvcigpLHRoaXMudGV4dD1hLHRoaXMuZm9udD1iLHRoaXMuY29sb3I9Yyx0aGlzLnRleHRBbGlnbj1cImxlZnRcIix0aGlzLnRleHRCYXNlbGluZT1cInRvcFwiLHRoaXMubWF4V2lkdGg9bnVsbCx0aGlzLm91dGxpbmU9MCx0aGlzLmxpbmVIZWlnaHQ9MCx0aGlzLmxpbmVXaWR0aD1udWxsfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkRpc3BsYXlPYmplY3QpLGM9Y3JlYXRlanMuY3JlYXRlQ2FudmFzP2NyZWF0ZWpzLmNyZWF0ZUNhbnZhcygpOmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7Yy5nZXRDb250ZXh0JiYoYS5fd29ya2luZ0NvbnRleHQ9Yy5nZXRDb250ZXh0KFwiMmRcIiksYy53aWR0aD1jLmhlaWdodD0xKSxhLkhfT0ZGU0VUUz17c3RhcnQ6MCxsZWZ0OjAsY2VudGVyOi0uNSxlbmQ6LTEscmlnaHQ6LTF9LGEuVl9PRkZTRVRTPXt0b3A6MCxoYW5naW5nOi0uMDEsbWlkZGxlOi0uNCxhbHBoYWJldGljOi0uOCxpZGVvZ3JhcGhpYzotLjg1LGJvdHRvbTotMX0sYi5pc1Zpc2libGU9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmNhY2hlQ2FudmFzfHxudWxsIT10aGlzLnRleHQmJlwiXCIhPT10aGlzLnRleHQ7cmV0dXJuISEodGhpcy52aXNpYmxlJiZ0aGlzLmFscGhhPjAmJjAhPXRoaXMuc2NhbGVYJiYwIT10aGlzLnNjYWxlWSYmYSl9LGIuZHJhdz1mdW5jdGlvbihhLGIpe2lmKHRoaXMuRGlzcGxheU9iamVjdF9kcmF3KGEsYikpcmV0dXJuITA7dmFyIGM9dGhpcy5jb2xvcnx8XCIjMDAwXCI7cmV0dXJuIHRoaXMub3V0bGluZT8oYS5zdHJva2VTdHlsZT1jLGEubGluZVdpZHRoPTEqdGhpcy5vdXRsaW5lKTphLmZpbGxTdHlsZT1jLHRoaXMuX2RyYXdUZXh0KHRoaXMuX3ByZXBDb250ZXh0KGEpKSwhMH0sYi5nZXRNZWFzdXJlZFdpZHRoPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2dldE1lYXN1cmVkV2lkdGgodGhpcy50ZXh0KX0sYi5nZXRNZWFzdXJlZExpbmVIZWlnaHQ9ZnVuY3Rpb24oKXtyZXR1cm4gMS4yKnRoaXMuX2dldE1lYXN1cmVkV2lkdGgoXCJNXCIpfSxiLmdldE1lYXN1cmVkSGVpZ2h0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2RyYXdUZXh0KG51bGwse30pLmhlaWdodH0sYi5nZXRCb3VuZHM9ZnVuY3Rpb24oKXt2YXIgYj10aGlzLkRpc3BsYXlPYmplY3RfZ2V0Qm91bmRzKCk7aWYoYilyZXR1cm4gYjtpZihudWxsPT10aGlzLnRleHR8fFwiXCI9PT10aGlzLnRleHQpcmV0dXJuIG51bGw7dmFyIGM9dGhpcy5fZHJhd1RleHQobnVsbCx7fSksZD10aGlzLm1heFdpZHRoJiZ0aGlzLm1heFdpZHRoPGMud2lkdGg/dGhpcy5tYXhXaWR0aDpjLndpZHRoLGU9ZCphLkhfT0ZGU0VUU1t0aGlzLnRleHRBbGlnbnx8XCJsZWZ0XCJdLGY9dGhpcy5saW5lSGVpZ2h0fHx0aGlzLmdldE1lYXN1cmVkTGluZUhlaWdodCgpLGc9ZiphLlZfT0ZGU0VUU1t0aGlzLnRleHRCYXNlbGluZXx8XCJ0b3BcIl07cmV0dXJuIHRoaXMuX3JlY3RhbmdsZS5zZXRWYWx1ZXMoZSxnLGQsYy5oZWlnaHQpfSxiLmdldE1ldHJpY3M9ZnVuY3Rpb24oKXt2YXIgYj17bGluZXM6W119O3JldHVybiBiLmxpbmVIZWlnaHQ9dGhpcy5saW5lSGVpZ2h0fHx0aGlzLmdldE1lYXN1cmVkTGluZUhlaWdodCgpLGIudk9mZnNldD1iLmxpbmVIZWlnaHQqYS5WX09GRlNFVFNbdGhpcy50ZXh0QmFzZWxpbmV8fFwidG9wXCJdLHRoaXMuX2RyYXdUZXh0KG51bGwsYixiLmxpbmVzKX0sYi5jbG9uZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9jbG9uZVByb3BzKG5ldyBhKHRoaXMudGV4dCx0aGlzLmZvbnQsdGhpcy5jb2xvcikpfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbVGV4dCAodGV4dD1cIisodGhpcy50ZXh0Lmxlbmd0aD4yMD90aGlzLnRleHQuc3Vic3RyKDAsMTcpK1wiLi4uXCI6dGhpcy50ZXh0KStcIildXCJ9LGIuX2Nsb25lUHJvcHM9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuRGlzcGxheU9iamVjdF9fY2xvbmVQcm9wcyhhKSxhLnRleHRBbGlnbj10aGlzLnRleHRBbGlnbixhLnRleHRCYXNlbGluZT10aGlzLnRleHRCYXNlbGluZSxhLm1heFdpZHRoPXRoaXMubWF4V2lkdGgsYS5vdXRsaW5lPXRoaXMub3V0bGluZSxhLmxpbmVIZWlnaHQ9dGhpcy5saW5lSGVpZ2h0LGEubGluZVdpZHRoPXRoaXMubGluZVdpZHRoLGF9LGIuX3ByZXBDb250ZXh0PWZ1bmN0aW9uKGEpe3JldHVybiBhLmZvbnQ9dGhpcy5mb250fHxcIjEwcHggc2Fucy1zZXJpZlwiLGEudGV4dEFsaWduPXRoaXMudGV4dEFsaWdufHxcImxlZnRcIixhLnRleHRCYXNlbGluZT10aGlzLnRleHRCYXNlbGluZXx8XCJ0b3BcIixhfSxiLl9kcmF3VGV4dD1mdW5jdGlvbihiLGMsZCl7dmFyIGU9ISFiO2V8fChiPWEuX3dvcmtpbmdDb250ZXh0LGIuc2F2ZSgpLHRoaXMuX3ByZXBDb250ZXh0KGIpKTtmb3IodmFyIGY9dGhpcy5saW5lSGVpZ2h0fHx0aGlzLmdldE1lYXN1cmVkTGluZUhlaWdodCgpLGc9MCxoPTAsaT1TdHJpbmcodGhpcy50ZXh0KS5zcGxpdCgvKD86XFxyXFxufFxccnxcXG4pLyksaj0wLGs9aS5sZW5ndGg7az5qO2orKyl7dmFyIGw9aVtqXSxtPW51bGw7aWYobnVsbCE9dGhpcy5saW5lV2lkdGgmJihtPWIubWVhc3VyZVRleHQobCkud2lkdGgpPnRoaXMubGluZVdpZHRoKXt2YXIgbj1sLnNwbGl0KC8oXFxzKS8pO2w9blswXSxtPWIubWVhc3VyZVRleHQobCkud2lkdGg7Zm9yKHZhciBvPTEscD1uLmxlbmd0aDtwPm87bys9Mil7dmFyIHE9Yi5tZWFzdXJlVGV4dChuW29dK25bbysxXSkud2lkdGg7bStxPnRoaXMubGluZVdpZHRoPyhlJiZ0aGlzLl9kcmF3VGV4dExpbmUoYixsLGgqZiksZCYmZC5wdXNoKGwpLG0+ZyYmKGc9bSksbD1uW28rMV0sbT1iLm1lYXN1cmVUZXh0KGwpLndpZHRoLGgrKyk6KGwrPW5bb10rbltvKzFdLG0rPXEpfX1lJiZ0aGlzLl9kcmF3VGV4dExpbmUoYixsLGgqZiksZCYmZC5wdXNoKGwpLGMmJm51bGw9PW0mJihtPWIubWVhc3VyZVRleHQobCkud2lkdGgpLG0+ZyYmKGc9bSksaCsrfXJldHVybiBjJiYoYy53aWR0aD1nLGMuaGVpZ2h0PWgqZiksZXx8Yi5yZXN0b3JlKCksY30sYi5fZHJhd1RleHRMaW5lPWZ1bmN0aW9uKGEsYixjKXt0aGlzLm91dGxpbmU/YS5zdHJva2VUZXh0KGIsMCxjLHRoaXMubWF4V2lkdGh8fDY1NTM1KTphLmZpbGxUZXh0KGIsMCxjLHRoaXMubWF4V2lkdGh8fDY1NTM1KX0sYi5fZ2V0TWVhc3VyZWRXaWR0aD1mdW5jdGlvbihiKXt2YXIgYz1hLl93b3JraW5nQ29udGV4dDtjLnNhdmUoKTt2YXIgZD10aGlzLl9wcmVwQ29udGV4dChjKS5tZWFzdXJlVGV4dChiKS53aWR0aDtyZXR1cm4gYy5yZXN0b3JlKCksZH0sY3JlYXRlanMuVGV4dD1jcmVhdGVqcy5wcm9tb3RlKGEsXCJEaXNwbGF5T2JqZWN0XCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYil7dGhpcy5Db250YWluZXJfY29uc3RydWN0b3IoKSx0aGlzLnRleHQ9YXx8XCJcIix0aGlzLnNwcml0ZVNoZWV0PWIsdGhpcy5saW5lSGVpZ2h0PTAsdGhpcy5sZXR0ZXJTcGFjaW5nPTAsdGhpcy5zcGFjZVdpZHRoPTAsdGhpcy5fb2xkUHJvcHM9e3RleHQ6MCxzcHJpdGVTaGVldDowLGxpbmVIZWlnaHQ6MCxsZXR0ZXJTcGFjaW5nOjAsc3BhY2VXaWR0aDowfX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5Db250YWluZXIpO2EubWF4UG9vbFNpemU9MTAwLGEuX3Nwcml0ZVBvb2w9W10sYi5kcmF3PWZ1bmN0aW9uKGEsYil7dGhpcy5EaXNwbGF5T2JqZWN0X2RyYXcoYSxiKXx8KHRoaXMuX3VwZGF0ZVRleHQoKSx0aGlzLkNvbnRhaW5lcl9kcmF3KGEsYikpfSxiLmdldEJvdW5kcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLl91cGRhdGVUZXh0KCksdGhpcy5Db250YWluZXJfZ2V0Qm91bmRzKCl9LGIuaXNWaXNpYmxlPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5jYWNoZUNhbnZhc3x8dGhpcy5zcHJpdGVTaGVldCYmdGhpcy5zcHJpdGVTaGVldC5jb21wbGV0ZSYmdGhpcy50ZXh0O3JldHVybiEhKHRoaXMudmlzaWJsZSYmdGhpcy5hbHBoYT4wJiYwIT09dGhpcy5zY2FsZVgmJjAhPT10aGlzLnNjYWxlWSYmYSl9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fY2xvbmVQcm9wcyhuZXcgYSh0aGlzLnRleHQsdGhpcy5zcHJpdGVTaGVldCkpfSxiLmFkZENoaWxkPWIuYWRkQ2hpbGRBdD1iLnJlbW92ZUNoaWxkPWIucmVtb3ZlQ2hpbGRBdD1iLnJlbW92ZUFsbENoaWxkcmVuPWZ1bmN0aW9uKCl7fSxiLl9jbG9uZVByb3BzPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLkNvbnRhaW5lcl9fY2xvbmVQcm9wcyhhKSxhLmxpbmVIZWlnaHQ9dGhpcy5saW5lSGVpZ2h0LGEubGV0dGVyU3BhY2luZz10aGlzLmxldHRlclNwYWNpbmcsYS5zcGFjZVdpZHRoPXRoaXMuc3BhY2VXaWR0aCxhfSxiLl9nZXRGcmFtZUluZGV4PWZ1bmN0aW9uKGEsYil7dmFyIGMsZD1iLmdldEFuaW1hdGlvbihhKTtyZXR1cm4gZHx8KGEhPShjPWEudG9VcHBlckNhc2UoKSl8fGEhPShjPWEudG9Mb3dlckNhc2UoKSl8fChjPW51bGwpLGMmJihkPWIuZ2V0QW5pbWF0aW9uKGMpKSksZCYmZC5mcmFtZXNbMF19LGIuX2dldEZyYW1lPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5fZ2V0RnJhbWVJbmRleChhLGIpO3JldHVybiBudWxsPT1jP2M6Yi5nZXRGcmFtZShjKX0sYi5fZ2V0TGluZUhlaWdodD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLl9nZXRGcmFtZShcIjFcIixhKXx8dGhpcy5fZ2V0RnJhbWUoXCJUXCIsYSl8fHRoaXMuX2dldEZyYW1lKFwiTFwiLGEpfHxhLmdldEZyYW1lKDApO3JldHVybiBiP2IucmVjdC5oZWlnaHQ6MX0sYi5fZ2V0U3BhY2VXaWR0aD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLl9nZXRGcmFtZShcIjFcIixhKXx8dGhpcy5fZ2V0RnJhbWUoXCJsXCIsYSl8fHRoaXMuX2dldEZyYW1lKFwiZVwiLGEpfHx0aGlzLl9nZXRGcmFtZShcImFcIixhKXx8YS5nZXRGcmFtZSgwKTtyZXR1cm4gYj9iLnJlY3Qud2lkdGg6MX0sYi5fdXBkYXRlVGV4dD1mdW5jdGlvbigpe3ZhciBiLGM9MCxkPTAsZT10aGlzLl9vbGRQcm9wcyxmPSExLGc9dGhpcy5zcGFjZVdpZHRoLGg9dGhpcy5saW5lSGVpZ2h0LGk9dGhpcy5zcHJpdGVTaGVldCxqPWEuX3Nwcml0ZVBvb2wsaz10aGlzLmNoaWxkcmVuLGw9MCxtPWsubGVuZ3RoO2Zvcih2YXIgbiBpbiBlKWVbbl0hPXRoaXNbbl0mJihlW25dPXRoaXNbbl0sZj0hMCk7aWYoZil7dmFyIG89ISF0aGlzLl9nZXRGcmFtZShcIiBcIixpKTtvfHxnfHwoZz10aGlzLl9nZXRTcGFjZVdpZHRoKGkpKSxofHwoaD10aGlzLl9nZXRMaW5lSGVpZ2h0KGkpKTtmb3IodmFyIHA9MCxxPXRoaXMudGV4dC5sZW5ndGg7cT5wO3ArKyl7dmFyIHI9dGhpcy50ZXh0LmNoYXJBdChwKTtpZihcIiBcIiE9cnx8bylpZihcIlxcblwiIT1yJiZcIlxcclwiIT1yKXt2YXIgcz10aGlzLl9nZXRGcmFtZUluZGV4KHIsaSk7bnVsbCE9cyYmKG0+bD9iPWtbbF06KGsucHVzaChiPWoubGVuZ3RoP2oucG9wKCk6bmV3IGNyZWF0ZWpzLlNwcml0ZSksYi5wYXJlbnQ9dGhpcyxtKyspLGIuc3ByaXRlU2hlZXQ9aSxiLmdvdG9BbmRTdG9wKHMpLGIueD1jLGIueT1kLGwrKyxjKz1iLmdldEJvdW5kcygpLndpZHRoK3RoaXMubGV0dGVyU3BhY2luZyl9ZWxzZVwiXFxyXCI9PXImJlwiXFxuXCI9PXRoaXMudGV4dC5jaGFyQXQocCsxKSYmcCsrLGM9MCxkKz1oO2Vsc2UgYys9Z31mb3IoO20+bDspai5wdXNoKGI9ay5wb3AoKSksYi5wYXJlbnQ9bnVsbCxtLS07ai5sZW5ndGg+YS5tYXhQb29sU2l6ZSYmKGoubGVuZ3RoPWEubWF4UG9vbFNpemUpfX0sY3JlYXRlanMuQml0bWFwVGV4dD1jcmVhdGVqcy5wcm9tb3RlKGEsXCJDb250YWluZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYixjLGQsZSl7dGhpcy5Db250YWluZXJfY29uc3RydWN0b3IoKSwhYS5pbml0ZWQmJmEuaW5pdCgpLHRoaXMubW9kZT1ifHxhLklOREVQRU5ERU5ULHRoaXMuc3RhcnRQb3NpdGlvbj1jfHwwLHRoaXMubG9vcD1kLHRoaXMuY3VycmVudEZyYW1lPTAsdGhpcy50aW1lbGluZT1uZXcgY3JlYXRlanMuVGltZWxpbmUobnVsbCxlLHtwYXVzZWQ6ITAscG9zaXRpb246Yyx1c2VUaWNrczohMH0pLHRoaXMucGF1c2VkPSExLHRoaXMuYWN0aW9uc0VuYWJsZWQ9ITAsdGhpcy5hdXRvUmVzZXQ9ITAsdGhpcy5mcmFtZUJvdW5kcz10aGlzLmZyYW1lQm91bmRzfHxudWxsLHRoaXMuZnJhbWVyYXRlPW51bGwsdGhpcy5fc3luY2hPZmZzZXQ9MCx0aGlzLl9wcmV2UG9zPS0xLHRoaXMuX3ByZXZQb3NpdGlvbj0wLHRoaXMuX3Q9MCx0aGlzLl9tYW5hZ2VkPXt9fWZ1bmN0aW9uIGIoKXt0aHJvd1wiTW92aWVDbGlwUGx1Z2luIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQuXCJ9dmFyIGM9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQ29udGFpbmVyKTthLklOREVQRU5ERU5UPVwiaW5kZXBlbmRlbnRcIixhLlNJTkdMRV9GUkFNRT1cInNpbmdsZVwiLGEuU1lOQ0hFRD1cInN5bmNoZWRcIixhLmluaXRlZD0hMSxhLmluaXQ9ZnVuY3Rpb24oKXthLmluaXRlZHx8KGIuaW5zdGFsbCgpLGEuaW5pdGVkPSEwKX0sYy5nZXRMYWJlbHM9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy50aW1lbGluZS5nZXRMYWJlbHMoKX0sYy5nZXRDdXJyZW50TGFiZWw9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fdXBkYXRlVGltZWxpbmUoKSx0aGlzLnRpbWVsaW5lLmdldEN1cnJlbnRMYWJlbCgpfSxjLmdldER1cmF0aW9uPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudGltZWxpbmUuZHVyYXRpb247XG59O3RyeXtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhjLHtsYWJlbHM6e2dldDpjLmdldExhYmVsc30sY3VycmVudExhYmVsOntnZXQ6Yy5nZXRDdXJyZW50TGFiZWx9LHRvdGFsRnJhbWVzOntnZXQ6Yy5nZXREdXJhdGlvbn0sZHVyYXRpb246e2dldDpjLmdldER1cmF0aW9ufX0pfWNhdGNoKGQpe31jLmluaXRpYWxpemU9YSxjLmlzVmlzaWJsZT1mdW5jdGlvbigpe3JldHVybiEhKHRoaXMudmlzaWJsZSYmdGhpcy5hbHBoYT4wJiYwIT10aGlzLnNjYWxlWCYmMCE9dGhpcy5zY2FsZVkpfSxjLmRyYXc9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5EaXNwbGF5T2JqZWN0X2RyYXcoYSxiKT8hMDoodGhpcy5fdXBkYXRlVGltZWxpbmUoKSx0aGlzLkNvbnRhaW5lcl9kcmF3KGEsYiksITApfSxjLnBsYXk9ZnVuY3Rpb24oKXt0aGlzLnBhdXNlZD0hMX0sYy5zdG9wPWZ1bmN0aW9uKCl7dGhpcy5wYXVzZWQ9ITB9LGMuZ290b0FuZFBsYXk9ZnVuY3Rpb24oYSl7dGhpcy5wYXVzZWQ9ITEsdGhpcy5fZ290byhhKX0sYy5nb3RvQW5kU3RvcD1mdW5jdGlvbihhKXt0aGlzLnBhdXNlZD0hMCx0aGlzLl9nb3RvKGEpfSxjLmFkdmFuY2U9ZnVuY3Rpb24oYil7dmFyIGM9YS5JTkRFUEVOREVOVDtpZih0aGlzLm1vZGU9PWMpe2Zvcih2YXIgZD10aGlzLGU9ZC5mcmFtZXJhdGU7KGQ9ZC5wYXJlbnQpJiZudWxsPT1lOylkLm1vZGU9PWMmJihlPWQuX2ZyYW1lcmF0ZSk7dGhpcy5fZnJhbWVyYXRlPWU7dmFyIGY9bnVsbCE9ZSYmLTEhPWUmJm51bGwhPWI/Yi8oMWUzL2UpK3RoaXMuX3Q6MSxnPTB8Zjtmb3IodGhpcy5fdD1mLWc7IXRoaXMucGF1c2VkJiZnLS07KXRoaXMuX3ByZXZQb3NpdGlvbj10aGlzLl9wcmV2UG9zPDA/MDp0aGlzLl9wcmV2UG9zaXRpb24rMSx0aGlzLl91cGRhdGVUaW1lbGluZSgpfX0sYy5jbG9uZT1mdW5jdGlvbigpe3Rocm93XCJNb3ZpZUNsaXAgY2Fubm90IGJlIGNsb25lZC5cIn0sYy50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW01vdmllQ2xpcCAobmFtZT1cIit0aGlzLm5hbWUrXCIpXVwifSxjLl90aWNrPWZ1bmN0aW9uKGEpe3RoaXMuYWR2YW5jZShhJiZhLmRlbHRhKSx0aGlzLkNvbnRhaW5lcl9fdGljayhhKX0sYy5fZ290bz1mdW5jdGlvbihhKXt2YXIgYj10aGlzLnRpbWVsaW5lLnJlc29sdmUoYSk7bnVsbCE9YiYmKC0xPT10aGlzLl9wcmV2UG9zJiYodGhpcy5fcHJldlBvcz1OYU4pLHRoaXMuX3ByZXZQb3NpdGlvbj1iLHRoaXMuX3Q9MCx0aGlzLl91cGRhdGVUaW1lbGluZSgpKX0sYy5fcmVzZXQ9ZnVuY3Rpb24oKXt0aGlzLl9wcmV2UG9zPS0xLHRoaXMuX3Q9dGhpcy5jdXJyZW50RnJhbWU9MCx0aGlzLnBhdXNlZD0hMX0sYy5fdXBkYXRlVGltZWxpbmU9ZnVuY3Rpb24oKXt2YXIgYj10aGlzLnRpbWVsaW5lLGM9dGhpcy5tb2RlIT1hLklOREVQRU5ERU5UO2IubG9vcD1udWxsPT10aGlzLmxvb3A/ITA6dGhpcy5sb29wO3ZhciBkPWM/dGhpcy5zdGFydFBvc2l0aW9uKyh0aGlzLm1vZGU9PWEuU0lOR0xFX0ZSQU1FPzA6dGhpcy5fc3luY2hPZmZzZXQpOnRoaXMuX3ByZXZQb3M8MD8wOnRoaXMuX3ByZXZQb3NpdGlvbixlPWN8fCF0aGlzLmFjdGlvbnNFbmFibGVkP2NyZWF0ZWpzLlR3ZWVuLk5PTkU6bnVsbDtpZih0aGlzLmN1cnJlbnRGcmFtZT1iLl9jYWxjUG9zaXRpb24oZCksYi5zZXRQb3NpdGlvbihkLGUpLHRoaXMuX3ByZXZQb3NpdGlvbj1iLl9wcmV2UG9zaXRpb24sdGhpcy5fcHJldlBvcyE9Yi5fcHJldlBvcyl7dGhpcy5jdXJyZW50RnJhbWU9dGhpcy5fcHJldlBvcz1iLl9wcmV2UG9zO2Zvcih2YXIgZiBpbiB0aGlzLl9tYW5hZ2VkKXRoaXMuX21hbmFnZWRbZl09MTtmb3IodmFyIGc9Yi5fdHdlZW5zLGg9MCxpPWcubGVuZ3RoO2k+aDtoKyspe3ZhciBqPWdbaF0saz1qLl90YXJnZXQ7aWYoayE9dGhpcyYmIWoucGFzc2l2ZSl7dmFyIGw9ai5fc3RlcFBvc2l0aW9uO2sgaW5zdGFuY2VvZiBjcmVhdGVqcy5EaXNwbGF5T2JqZWN0P3RoaXMuX2FkZE1hbmFnZWRDaGlsZChrLGwpOnRoaXMuX3NldFN0YXRlKGsuc3RhdGUsbCl9fXZhciBtPXRoaXMuY2hpbGRyZW47Zm9yKGg9bS5sZW5ndGgtMTtoPj0wO2gtLSl7dmFyIG49bVtoXS5pZDsxPT10aGlzLl9tYW5hZ2VkW25dJiYodGhpcy5yZW1vdmVDaGlsZEF0KGgpLGRlbGV0ZSB0aGlzLl9tYW5hZ2VkW25dKX19fSxjLl9zZXRTdGF0ZT1mdW5jdGlvbihhLGIpe2lmKGEpZm9yKHZhciBjPWEubGVuZ3RoLTE7Yz49MDtjLS0pe3ZhciBkPWFbY10sZT1kLnQsZj1kLnA7Zm9yKHZhciBnIGluIGYpZVtnXT1mW2ddO3RoaXMuX2FkZE1hbmFnZWRDaGlsZChlLGIpfX0sYy5fYWRkTWFuYWdlZENoaWxkPWZ1bmN0aW9uKGIsYyl7Yi5fb2ZmfHwodGhpcy5hZGRDaGlsZEF0KGIsMCksYiBpbnN0YW5jZW9mIGEmJihiLl9zeW5jaE9mZnNldD1jLGIubW9kZT09YS5JTkRFUEVOREVOVCYmYi5hdXRvUmVzZXQmJiF0aGlzLl9tYW5hZ2VkW2IuaWRdJiZiLl9yZXNldCgpKSx0aGlzLl9tYW5hZ2VkW2IuaWRdPTIpfSxjLl9nZXRCb3VuZHM9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLkRpc3BsYXlPYmplY3RfZ2V0Qm91bmRzKCk7cmV0dXJuIGN8fCh0aGlzLl91cGRhdGVUaW1lbGluZSgpLHRoaXMuZnJhbWVCb3VuZHMmJihjPXRoaXMuX3JlY3RhbmdsZS5jb3B5KHRoaXMuZnJhbWVCb3VuZHNbdGhpcy5jdXJyZW50RnJhbWVdKSkpLGM/dGhpcy5fdHJhbnNmb3JtQm91bmRzKGMsYSxiKTp0aGlzLkNvbnRhaW5lcl9fZ2V0Qm91bmRzKGEsYil9LGNyZWF0ZWpzLk1vdmllQ2xpcD1jcmVhdGVqcy5wcm9tb3RlKGEsXCJDb250YWluZXJcIiksYi5wcmlvcml0eT0xMDAsYi5pbnN0YWxsPWZ1bmN0aW9uKCl7Y3JlYXRlanMuVHdlZW4uaW5zdGFsbFBsdWdpbihiLFtcInN0YXJ0UG9zaXRpb25cIl0pfSxiLmluaXQ9ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBjfSxiLnN0ZXA9ZnVuY3Rpb24oKXt9LGIudHdlZW49ZnVuY3Rpb24oYixjLGQsZSxmLGcsaCxpKXtyZXR1cm4gYi50YXJnZXQgaW5zdGFuY2VvZiBhPzE9PWc/ZltjXTplW2NdOmR9fSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKCl7dGhyb3dcIlNwcml0ZVNoZWV0VXRpbHMgY2Fubm90IGJlIGluc3RhbnRpYXRlZFwifXZhciBiPWNyZWF0ZWpzLmNyZWF0ZUNhbnZhcz9jcmVhdGVqcy5jcmVhdGVDYW52YXMoKTpkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO2IuZ2V0Q29udGV4dCYmKGEuX3dvcmtpbmdDYW52YXM9YixhLl93b3JraW5nQ29udGV4dD1iLmdldENvbnRleHQoXCIyZFwiKSxiLndpZHRoPWIuaGVpZ2h0PTEpLGEuYWRkRmxpcHBlZEZyYW1lcz1mdW5jdGlvbihiLGMsZCxlKXtpZihjfHxkfHxlKXt2YXIgZj0wO2MmJmEuX2ZsaXAoYiwrK2YsITAsITEpLGQmJmEuX2ZsaXAoYiwrK2YsITEsITApLGUmJmEuX2ZsaXAoYiwrK2YsITAsITApfX0sYS5leHRyYWN0RnJhbWU9ZnVuY3Rpb24oYixjKXtpc05hTihjKSYmKGM9Yi5nZXRBbmltYXRpb24oYykuZnJhbWVzWzBdKTt2YXIgZD1iLmdldEZyYW1lKGMpO2lmKCFkKXJldHVybiBudWxsO3ZhciBlPWQucmVjdCxmPWEuX3dvcmtpbmdDYW52YXM7Zi53aWR0aD1lLndpZHRoLGYuaGVpZ2h0PWUuaGVpZ2h0LGEuX3dvcmtpbmdDb250ZXh0LmRyYXdJbWFnZShkLmltYWdlLGUueCxlLnksZS53aWR0aCxlLmhlaWdodCwwLDAsZS53aWR0aCxlLmhlaWdodCk7dmFyIGc9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtyZXR1cm4gZy5zcmM9Zi50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIiksZ30sYS5tZXJnZUFscGhhPWZ1bmN0aW9uKGEsYixjKXtjfHwoYz1jcmVhdGVqcy5jcmVhdGVDYW52YXM/Y3JlYXRlanMuY3JlYXRlQ2FudmFzKCk6ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKSksYy53aWR0aD1NYXRoLm1heChiLndpZHRoLGEud2lkdGgpLGMuaGVpZ2h0PU1hdGgubWF4KGIuaGVpZ2h0LGEuaGVpZ2h0KTt2YXIgZD1jLmdldENvbnRleHQoXCIyZFwiKTtyZXR1cm4gZC5zYXZlKCksZC5kcmF3SW1hZ2UoYSwwLDApLGQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uPVwiZGVzdGluYXRpb24taW5cIixkLmRyYXdJbWFnZShiLDAsMCksZC5yZXN0b3JlKCksY30sYS5fZmxpcD1mdW5jdGlvbihiLGMsZCxlKXtmb3IodmFyIGY9Yi5faW1hZ2VzLGc9YS5fd29ya2luZ0NhbnZhcyxoPWEuX3dvcmtpbmdDb250ZXh0LGk9Zi5sZW5ndGgvYyxqPTA7aT5qO2orKyl7dmFyIGs9ZltqXTtrLl9fdG1wPWosaC5zZXRUcmFuc2Zvcm0oMSwwLDAsMSwwLDApLGguY2xlYXJSZWN0KDAsMCxnLndpZHRoKzEsZy5oZWlnaHQrMSksZy53aWR0aD1rLndpZHRoLGcuaGVpZ2h0PWsuaGVpZ2h0LGguc2V0VHJhbnNmb3JtKGQ/LTE6MSwwLDAsZT8tMToxLGQ/ay53aWR0aDowLGU/ay5oZWlnaHQ6MCksaC5kcmF3SW1hZ2UoaywwLDApO3ZhciBsPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7bC5zcmM9Zy50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIiksbC53aWR0aD1rLndpZHRoLGwuaGVpZ2h0PWsuaGVpZ2h0LGYucHVzaChsKX12YXIgbT1iLl9mcmFtZXMsbj1tLmxlbmd0aC9jO2ZvcihqPTA7bj5qO2orKyl7az1tW2pdO3ZhciBvPWsucmVjdC5jbG9uZSgpO2w9ZltrLmltYWdlLl9fdG1wK2kqY107dmFyIHA9e2ltYWdlOmwscmVjdDpvLHJlZ1g6ay5yZWdYLHJlZ1k6ay5yZWdZfTtkJiYoby54PWwud2lkdGgtby54LW8ud2lkdGgscC5yZWdYPW8ud2lkdGgtay5yZWdYKSxlJiYoby55PWwuaGVpZ2h0LW8ueS1vLmhlaWdodCxwLnJlZ1k9by5oZWlnaHQtay5yZWdZKSxtLnB1c2gocCl9dmFyIHE9XCJfXCIrKGQ/XCJoXCI6XCJcIikrKGU/XCJ2XCI6XCJcIikscj1iLl9hbmltYXRpb25zLHM9Yi5fZGF0YSx0PXIubGVuZ3RoL2M7Zm9yKGo9MDt0Pmo7aisrKXt2YXIgdT1yW2pdO2s9c1t1XTt2YXIgdj17bmFtZTp1K3Esc3BlZWQ6ay5zcGVlZCxuZXh0OmsubmV4dCxmcmFtZXM6W119O2submV4dCYmKHYubmV4dCs9cSksbT1rLmZyYW1lcztmb3IodmFyIHc9MCx4PW0ubGVuZ3RoO3g+dzt3Kyspdi5mcmFtZXMucHVzaChtW3ddK24qYyk7c1t2Lm5hbWVdPXYsci5wdXNoKHYubmFtZSl9fSxjcmVhdGVqcy5TcHJpdGVTaGVldFV0aWxzPWF9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSl7dGhpcy5FdmVudERpc3BhdGNoZXJfY29uc3RydWN0b3IoKSx0aGlzLm1heFdpZHRoPTIwNDgsdGhpcy5tYXhIZWlnaHQ9MjA0OCx0aGlzLnNwcml0ZVNoZWV0PW51bGwsdGhpcy5zY2FsZT0xLHRoaXMucGFkZGluZz0xLHRoaXMudGltZVNsaWNlPS4zLHRoaXMucHJvZ3Jlc3M9LTEsdGhpcy5mcmFtZXJhdGU9YXx8MCx0aGlzLl9mcmFtZXM9W10sdGhpcy5fYW5pbWF0aW9ucz17fSx0aGlzLl9kYXRhPW51bGwsdGhpcy5fbmV4dEZyYW1lSW5kZXg9MCx0aGlzLl9pbmRleD0wLHRoaXMuX3RpbWVySUQ9bnVsbCx0aGlzLl9zY2FsZT0xfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkV2ZW50RGlzcGF0Y2hlcik7YS5FUlJfRElNRU5TSU9OUz1cImZyYW1lIGRpbWVuc2lvbnMgZXhjZWVkIG1heCBzcHJpdGVzaGVldCBkaW1lbnNpb25zXCIsYS5FUlJfUlVOTklORz1cImEgYnVpbGQgaXMgYWxyZWFkeSBydW5uaW5nXCIsYi5hZGRGcmFtZT1mdW5jdGlvbihiLGMsZCxlLGYpe2lmKHRoaXMuX2RhdGEpdGhyb3cgYS5FUlJfUlVOTklORzt2YXIgZz1jfHxiLmJvdW5kc3x8Yi5ub21pbmFsQm91bmRzO3JldHVybiFnJiZiLmdldEJvdW5kcyYmKGc9Yi5nZXRCb3VuZHMoKSksZz8oZD1kfHwxLHRoaXMuX2ZyYW1lcy5wdXNoKHtzb3VyY2U6Yixzb3VyY2VSZWN0Omcsc2NhbGU6ZCxmdW5jdDplLGRhdGE6ZixpbmRleDp0aGlzLl9mcmFtZXMubGVuZ3RoLGhlaWdodDpnLmhlaWdodCpkfSktMSk6bnVsbH0sYi5hZGRBbmltYXRpb249ZnVuY3Rpb24oYixjLGQsZSl7aWYodGhpcy5fZGF0YSl0aHJvdyBhLkVSUl9SVU5OSU5HO3RoaXMuX2FuaW1hdGlvbnNbYl09e2ZyYW1lczpjLG5leHQ6ZCxzcGVlZDplfX0sYi5hZGRNb3ZpZUNsaXA9ZnVuY3Rpb24oYixjLGQsZSxmLGcpe2lmKHRoaXMuX2RhdGEpdGhyb3cgYS5FUlJfUlVOTklORzt2YXIgaD1iLmZyYW1lQm91bmRzLGk9Y3x8Yi5ib3VuZHN8fGIubm9taW5hbEJvdW5kcztpZighaSYmYi5nZXRCb3VuZHMmJihpPWIuZ2V0Qm91bmRzKCkpLGl8fGgpe3ZhciBqLGssbD10aGlzLl9mcmFtZXMubGVuZ3RoLG09Yi50aW1lbGluZS5kdXJhdGlvbjtmb3Ioaj0wO20+ajtqKyspe3ZhciBuPWgmJmhbal0/aFtqXTppO3RoaXMuYWRkRnJhbWUoYixuLGQsdGhpcy5fc2V0dXBNb3ZpZUNsaXBGcmFtZSx7aTpqLGY6ZSxkOmZ9KX12YXIgbz1iLnRpbWVsaW5lLl9sYWJlbHMscD1bXTtmb3IodmFyIHEgaW4gbylwLnB1c2goe2luZGV4Om9bcV0sbGFiZWw6cX0pO2lmKHAubGVuZ3RoKWZvcihwLnNvcnQoZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5pbmRleC1iLmluZGV4fSksaj0wLGs9cC5sZW5ndGg7az5qO2orKyl7Zm9yKHZhciByPXBbal0ubGFiZWwscz1sK3Bbal0uaW5kZXgsdD1sKyhqPT1rLTE/bTpwW2orMV0uaW5kZXgpLHU9W10sdj1zO3Q+djt2KyspdS5wdXNoKHYpOyghZ3x8KHI9ZyhyLGIscyx0KSkpJiZ0aGlzLmFkZEFuaW1hdGlvbihyLHUsITApfX19LGIuYnVpbGQ9ZnVuY3Rpb24oKXtpZih0aGlzLl9kYXRhKXRocm93IGEuRVJSX1JVTk5JTkc7Zm9yKHRoaXMuX3N0YXJ0QnVpbGQoKTt0aGlzLl9kcmF3TmV4dCgpOyk7cmV0dXJuIHRoaXMuX2VuZEJ1aWxkKCksdGhpcy5zcHJpdGVTaGVldH0sYi5idWlsZEFzeW5jPWZ1bmN0aW9uKGIpe2lmKHRoaXMuX2RhdGEpdGhyb3cgYS5FUlJfUlVOTklORzt0aGlzLnRpbWVTbGljZT1iLHRoaXMuX3N0YXJ0QnVpbGQoKTt2YXIgYz10aGlzO3RoaXMuX3RpbWVySUQ9c2V0VGltZW91dChmdW5jdGlvbigpe2MuX3J1bigpfSw1MC01MCpNYXRoLm1heCguMDEsTWF0aC5taW4oLjk5LHRoaXMudGltZVNsaWNlfHwuMykpKX0sYi5zdG9wQXN5bmM9ZnVuY3Rpb24oKXtjbGVhclRpbWVvdXQodGhpcy5fdGltZXJJRCksdGhpcy5fZGF0YT1udWxsfSxiLmNsb25lPWZ1bmN0aW9uKCl7dGhyb3dcIlNwcml0ZVNoZWV0QnVpbGRlciBjYW5ub3QgYmUgY2xvbmVkLlwifSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbU3ByaXRlU2hlZXRCdWlsZGVyXVwifSxiLl9zdGFydEJ1aWxkPWZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5wYWRkaW5nfHwwO3RoaXMucHJvZ3Jlc3M9MCx0aGlzLnNwcml0ZVNoZWV0PW51bGwsdGhpcy5faW5kZXg9MCx0aGlzLl9zY2FsZT10aGlzLnNjYWxlO3ZhciBjPVtdO3RoaXMuX2RhdGE9e2ltYWdlczpbXSxmcmFtZXM6YyxmcmFtZXJhdGU6dGhpcy5mcmFtZXJhdGUsYW5pbWF0aW9uczp0aGlzLl9hbmltYXRpb25zfTt2YXIgZD10aGlzLl9mcmFtZXMuc2xpY2UoKTtpZihkLnNvcnQoZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5oZWlnaHQ8PWIuaGVpZ2h0Py0xOjF9KSxkW2QubGVuZ3RoLTFdLmhlaWdodCsyKmI+dGhpcy5tYXhIZWlnaHQpdGhyb3cgYS5FUlJfRElNRU5TSU9OUztmb3IodmFyIGU9MCxmPTAsZz0wO2QubGVuZ3RoOyl7dmFyIGg9dGhpcy5fZmlsbFJvdyhkLGUsZyxjLGIpO2lmKGgudz5mJiYoZj1oLncpLGUrPWguaCwhaC5ofHwhZC5sZW5ndGgpe3ZhciBpPWNyZWF0ZWpzLmNyZWF0ZUNhbnZhcz9jcmVhdGVqcy5jcmVhdGVDYW52YXMoKTpkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO2kud2lkdGg9dGhpcy5fZ2V0U2l6ZShmLHRoaXMubWF4V2lkdGgpLGkuaGVpZ2h0PXRoaXMuX2dldFNpemUoZSx0aGlzLm1heEhlaWdodCksdGhpcy5fZGF0YS5pbWFnZXNbZ109aSxoLmh8fChmPWU9MCxnKyspfX19LGIuX3NldHVwTW92aWVDbGlwRnJhbWU9ZnVuY3Rpb24oYSxiKXt2YXIgYz1hLmFjdGlvbnNFbmFibGVkO2EuYWN0aW9uc0VuYWJsZWQ9ITEsYS5nb3RvQW5kU3RvcChiLmkpLGEuYWN0aW9uc0VuYWJsZWQ9YyxiLmYmJmIuZihhLGIuZCxiLmkpfSxiLl9nZXRTaXplPWZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPTQ7TWF0aC5wb3coMiwrK2MpPGE7KTtyZXR1cm4gTWF0aC5taW4oYixNYXRoLnBvdygyLGMpKX0sYi5fZmlsbFJvdz1mdW5jdGlvbihiLGMsZCxlLGYpe3ZhciBnPXRoaXMubWF4V2lkdGgsaD10aGlzLm1heEhlaWdodDtjKz1mO2Zvcih2YXIgaT1oLWMsaj1mLGs9MCxsPWIubGVuZ3RoLTE7bD49MDtsLS0pe3ZhciBtPWJbbF0sbj10aGlzLl9zY2FsZSptLnNjYWxlLG89bS5zb3VyY2VSZWN0LHA9bS5zb3VyY2UscT1NYXRoLmZsb29yKG4qby54LWYpLHI9TWF0aC5mbG9vcihuKm8ueS1mKSxzPU1hdGguY2VpbChuKm8uaGVpZ2h0KzIqZiksdD1NYXRoLmNlaWwobipvLndpZHRoKzIqZik7aWYodD5nKXRocm93IGEuRVJSX0RJTUVOU0lPTlM7cz5pfHxqK3Q+Z3x8KG0uaW1nPWQsbS5yZWN0PW5ldyBjcmVhdGVqcy5SZWN0YW5nbGUoaixjLHQscyksaz1rfHxzLGIuc3BsaWNlKGwsMSksZVttLmluZGV4XT1baixjLHQscyxkLE1hdGgucm91bmQoLXErbipwLnJlZ1gtZiksTWF0aC5yb3VuZCgtcituKnAucmVnWS1mKV0sais9dCl9cmV0dXJue3c6aixoOmt9fSxiLl9lbmRCdWlsZD1mdW5jdGlvbigpe3RoaXMuc3ByaXRlU2hlZXQ9bmV3IGNyZWF0ZWpzLlNwcml0ZVNoZWV0KHRoaXMuX2RhdGEpLHRoaXMuX2RhdGE9bnVsbCx0aGlzLnByb2dyZXNzPTEsdGhpcy5kaXNwYXRjaEV2ZW50KFwiY29tcGxldGVcIil9LGIuX3J1bj1mdW5jdGlvbigpe2Zvcih2YXIgYT01MCpNYXRoLm1heCguMDEsTWF0aC5taW4oLjk5LHRoaXMudGltZVNsaWNlfHwuMykpLGI9KG5ldyBEYXRlKS5nZXRUaW1lKCkrYSxjPSExO2I+KG5ldyBEYXRlKS5nZXRUaW1lKCk7KWlmKCF0aGlzLl9kcmF3TmV4dCgpKXtjPSEwO2JyZWFrfWlmKGMpdGhpcy5fZW5kQnVpbGQoKTtlbHNle3ZhciBkPXRoaXM7dGhpcy5fdGltZXJJRD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZC5fcnVuKCl9LDUwLWEpfXZhciBlPXRoaXMucHJvZ3Jlc3M9dGhpcy5faW5kZXgvdGhpcy5fZnJhbWVzLmxlbmd0aDtpZih0aGlzLmhhc0V2ZW50TGlzdGVuZXIoXCJwcm9ncmVzc1wiKSl7dmFyIGY9bmV3IGNyZWF0ZWpzLkV2ZW50KFwicHJvZ3Jlc3NcIik7Zi5wcm9ncmVzcz1lLHRoaXMuZGlzcGF0Y2hFdmVudChmKX19LGIuX2RyYXdOZXh0PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5fZnJhbWVzW3RoaXMuX2luZGV4XSxiPWEuc2NhbGUqdGhpcy5fc2NhbGUsYz1hLnJlY3QsZD1hLnNvdXJjZVJlY3QsZT10aGlzLl9kYXRhLmltYWdlc1thLmltZ10sZj1lLmdldENvbnRleHQoXCIyZFwiKTtyZXR1cm4gYS5mdW5jdCYmYS5mdW5jdChhLnNvdXJjZSxhLmRhdGEpLGYuc2F2ZSgpLGYuYmVnaW5QYXRoKCksZi5yZWN0KGMueCxjLnksYy53aWR0aCxjLmhlaWdodCksZi5jbGlwKCksZi50cmFuc2xhdGUoTWF0aC5jZWlsKGMueC1kLngqYiksTWF0aC5jZWlsKGMueS1kLnkqYikpLGYuc2NhbGUoYixiKSxhLnNvdXJjZS5kcmF3KGYpLGYucmVzdG9yZSgpLCsrdGhpcy5faW5kZXg8dGhpcy5fZnJhbWVzLmxlbmd0aH0sY3JlYXRlanMuU3ByaXRlU2hlZXRCdWlsZGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkV2ZW50RGlzcGF0Y2hlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhKXt0aGlzLkRpc3BsYXlPYmplY3RfY29uc3RydWN0b3IoKSxcInN0cmluZ1wiPT10eXBlb2YgYSYmKGE9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYSkpLHRoaXMubW91c2VFbmFibGVkPSExO3ZhciBiPWEuc3R5bGU7Yi5wb3NpdGlvbj1cImFic29sdXRlXCIsYi50cmFuc2Zvcm1PcmlnaW49Yi5XZWJraXRUcmFuc2Zvcm1PcmlnaW49Yi5tc1RyYW5zZm9ybU9yaWdpbj1iLk1velRyYW5zZm9ybU9yaWdpbj1iLk9UcmFuc2Zvcm1PcmlnaW49XCIwJSAwJVwiLHRoaXMuaHRtbEVsZW1lbnQ9YSx0aGlzLl9vbGRQcm9wcz1udWxsfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkRpc3BsYXlPYmplY3QpO2IuaXNWaXNpYmxlPWZ1bmN0aW9uKCl7cmV0dXJuIG51bGwhPXRoaXMuaHRtbEVsZW1lbnR9LGIuZHJhdz1mdW5jdGlvbihhLGIpe3JldHVybiEwfSxiLmNhY2hlPWZ1bmN0aW9uKCl7fSxiLnVuY2FjaGU9ZnVuY3Rpb24oKXt9LGIudXBkYXRlQ2FjaGU9ZnVuY3Rpb24oKXt9LGIuaGl0VGVzdD1mdW5jdGlvbigpe30sYi5sb2NhbFRvR2xvYmFsPWZ1bmN0aW9uKCl7fSxiLmdsb2JhbFRvTG9jYWw9ZnVuY3Rpb24oKXt9LGIubG9jYWxUb0xvY2FsPWZ1bmN0aW9uKCl7fSxiLmNsb25lPWZ1bmN0aW9uKCl7dGhyb3dcIkRPTUVsZW1lbnQgY2Fubm90IGJlIGNsb25lZC5cIn0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0RPTUVsZW1lbnQgKG5hbWU9XCIrdGhpcy5uYW1lK1wiKV1cIn0sYi5fdGljaz1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmdldFN0YWdlKCk7YiYmYi5vbihcImRyYXdlbmRcIix0aGlzLl9oYW5kbGVEcmF3RW5kLHRoaXMsITApLHRoaXMuRGlzcGxheU9iamVjdF9fdGljayhhKX0sYi5faGFuZGxlRHJhd0VuZD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmh0bWxFbGVtZW50O2lmKGIpe3ZhciBjPWIuc3R5bGUsZD10aGlzLmdldENvbmNhdGVuYXRlZERpc3BsYXlQcm9wcyh0aGlzLl9wcm9wcyksZT1kLm1hdHJpeCxmPWQudmlzaWJsZT9cInZpc2libGVcIjpcImhpZGRlblwiO2lmKGYhPWMudmlzaWJpbGl0eSYmKGMudmlzaWJpbGl0eT1mKSxkLnZpc2libGUpe3ZhciBnPXRoaXMuX29sZFByb3BzLGg9ZyYmZy5tYXRyaXgsaT0xZTQ7aWYoIWh8fCFoLmVxdWFscyhlKSl7dmFyIGo9XCJtYXRyaXgoXCIrKGUuYSppfDApL2krXCIsXCIrKGUuYippfDApL2krXCIsXCIrKGUuYyppfDApL2krXCIsXCIrKGUuZCppfDApL2krXCIsXCIrKGUudHgrLjV8MCk7Yy50cmFuc2Zvcm09Yy5XZWJraXRUcmFuc2Zvcm09Yy5PVHJhbnNmb3JtPWMubXNUcmFuc2Zvcm09aitcIixcIisoZS50eSsuNXwwKStcIilcIixjLk1velRyYW5zZm9ybT1qK1wicHgsXCIrKGUudHkrLjV8MCkrXCJweClcIixnfHwoZz10aGlzLl9vbGRQcm9wcz1uZXcgY3JlYXRlanMuRGlzcGxheVByb3BzKCEwLE5hTikpLGcubWF0cml4LmNvcHkoZSl9Zy5hbHBoYSE9ZC5hbHBoYSYmKGMub3BhY2l0eT1cIlwiKyhkLmFscGhhKml8MCkvaSxnLmFscGhhPWQuYWxwaGEpfX19LGNyZWF0ZWpzLkRPTUVsZW1lbnQ9Y3JlYXRlanMucHJvbW90ZShhLFwiRGlzcGxheU9iamVjdFwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYSgpe312YXIgYj1hLnByb3RvdHlwZTtiLmdldEJvdW5kcz1mdW5jdGlvbihhKXtyZXR1cm4gYX0sYi5hcHBseUZpbHRlcj1mdW5jdGlvbihhLGIsYyxkLGUsZixnLGgpe2Y9Znx8YSxudWxsPT1nJiYoZz1iKSxudWxsPT1oJiYoaD1jKTt0cnl7dmFyIGk9YS5nZXRJbWFnZURhdGEoYixjLGQsZSl9Y2F0Y2goail7cmV0dXJuITF9cmV0dXJuIHRoaXMuX2FwcGx5RmlsdGVyKGkpPyhmLnB1dEltYWdlRGF0YShpLGcsaCksITApOiExfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbRmlsdGVyXVwifSxiLmNsb25lPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBhfSxiLl9hcHBseUZpbHRlcj1mdW5jdGlvbihhKXtyZXR1cm4hMH0sY3JlYXRlanMuRmlsdGVyPWF9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiLGMpeyhpc05hTihhKXx8MD5hKSYmKGE9MCksKGlzTmFOKGIpfHwwPmIpJiYoYj0wKSwoaXNOYU4oYyl8fDE+YykmJihjPTEpLHRoaXMuYmx1clg9MHxhLHRoaXMuYmx1clk9MHxiLHRoaXMucXVhbGl0eT0wfGN9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuRmlsdGVyKTthLk1VTF9UQUJMRT1bMSwxNzEsMjA1LDI5Myw1NywzNzMsNzksMTM3LDI0MSwyNywzOTEsMzU3LDQxLDE5LDI4MywyNjUsNDk3LDQ2OSw0NDMsNDIxLDI1LDE5MSwzNjUsMzQ5LDMzNSwxNjEsMTU1LDE0OSw5LDI3OCwyNjksMjYxLDUwNSwyNDUsNDc1LDIzMSw0NDksNDM3LDIxMyw0MTUsNDA1LDM5NSwxOTMsMzc3LDM2OSwzNjEsMzUzLDM0NSwxNjksMzMxLDMyNSwzMTksMzEzLDMwNywzMDEsMzcsMTQ1LDI4NSwyODEsNjksMjcxLDI2NywyNjMsMjU5LDUwOSw1MDEsNDkzLDI0Myw0NzksMTE4LDQ2NSw0NTksMTEzLDQ0Niw1NSw0MzUsNDI5LDQyMywyMDksNDEzLDUxLDQwMywxOTksMzkzLDk3LDMsMzc5LDM3NSwzNzEsMzY3LDM2MywzNTksMzU1LDM1MSwzNDcsNDMsODUsMzM3LDMzMywxNjUsMzI3LDMyMyw1LDMxNywxNTcsMzExLDc3LDMwNSwzMDMsNzUsMjk3LDI5NCw3MywyODksMjg3LDcxLDE0MSwyNzksMjc3LDI3NSw2OCwxMzUsNjcsMTMzLDMzLDI2MiwyNjAsMTI5LDUxMSw1MDcsNTAzLDQ5OSw0OTUsNDkxLDYxLDEyMSw0ODEsNDc3LDIzNywyMzUsNDY3LDIzMiwxMTUsNDU3LDIyNyw0NTEsNyw0NDUsMjIxLDQzOSwyMTgsNDMzLDIxNSw0MjcsNDI1LDIxMSw0MTksNDE3LDIwNyw0MTEsNDA5LDIwMywyMDIsNDAxLDM5OSwzOTYsMTk3LDQ5LDM4OSwzODcsMzg1LDM4Myw5NSwxODksNDcsMTg3LDkzLDE4NSwyMywxODMsOTEsMTgxLDQ1LDE3OSw4OSwxNzcsMTEsMTc1LDg3LDE3MywzNDUsMzQzLDM0MSwzMzksMzM3LDIxLDE2Nyw4MywzMzEsMzI5LDMyNywxNjMsODEsMzIzLDMyMSwzMTksMTU5LDc5LDMxNSwzMTMsMzksMTU1LDMwOSwzMDcsMTUzLDMwNSwzMDMsMTUxLDc1LDI5OSwxNDksMzcsMjk1LDE0Nyw3MywyOTEsMTQ1LDI4OSwyODcsMTQzLDI4NSw3MSwxNDEsMjgxLDM1LDI3OSwxMzksNjksMjc1LDEzNywyNzMsMTcsMjcxLDEzNSwyNjksMjY3LDEzMywyNjUsMzMsMjYzLDEzMSwyNjEsMTMwLDI1OSwxMjksMjU3LDFdLGEuU0hHX1RBQkxFPVswLDksMTAsMTEsOSwxMiwxMCwxMSwxMiw5LDEzLDEzLDEwLDksMTMsMTMsMTQsMTQsMTQsMTQsMTAsMTMsMTQsMTQsMTQsMTMsMTMsMTMsOSwxNCwxNCwxNCwxNSwxNCwxNSwxNCwxNSwxNSwxNCwxNSwxNSwxNSwxNCwxNSwxNSwxNSwxNSwxNSwxNCwxNSwxNSwxNSwxNSwxNSwxNSwxMiwxNCwxNSwxNSwxMywxNSwxNSwxNSwxNSwxNiwxNiwxNiwxNSwxNiwxNCwxNiwxNiwxNCwxNiwxMywxNiwxNiwxNiwxNSwxNiwxMywxNiwxNSwxNiwxNCw5LDE2LDE2LDE2LDE2LDE2LDE2LDE2LDE2LDE2LDEzLDE0LDE2LDE2LDE1LDE2LDE2LDEwLDE2LDE1LDE2LDE0LDE2LDE2LDE0LDE2LDE2LDE0LDE2LDE2LDE0LDE1LDE2LDE2LDE2LDE0LDE1LDE0LDE1LDEzLDE2LDE2LDE1LDE3LDE3LDE3LDE3LDE3LDE3LDE0LDE1LDE3LDE3LDE2LDE2LDE3LDE2LDE1LDE3LDE2LDE3LDExLDE3LDE2LDE3LDE2LDE3LDE2LDE3LDE3LDE2LDE3LDE3LDE2LDE3LDE3LDE2LDE2LDE3LDE3LDE3LDE2LDE0LDE3LDE3LDE3LDE3LDE1LDE2LDE0LDE2LDE1LDE2LDEzLDE2LDE1LDE2LDE0LDE2LDE1LDE2LDEyLDE2LDE1LDE2LDE3LDE3LDE3LDE3LDE3LDEzLDE2LDE1LDE3LDE3LDE3LDE2LDE1LDE3LDE3LDE3LDE2LDE1LDE3LDE3LDE0LDE2LDE3LDE3LDE2LDE3LDE3LDE2LDE1LDE3LDE2LDE0LDE3LDE2LDE1LDE3LDE2LDE3LDE3LDE2LDE3LDE1LDE2LDE3LDE0LDE3LDE2LDE1LDE3LDE2LDE3LDEzLDE3LDE2LDE3LDE3LDE2LDE3LDE0LDE3LDE2LDE3LDE2LDE3LDE2LDE3LDldLGIuZ2V0Qm91bmRzPWZ1bmN0aW9uKGEpe3ZhciBiPTB8dGhpcy5ibHVyWCxjPTB8dGhpcy5ibHVyWTtpZigwPj1iJiYwPj1jKXJldHVybiBhO3ZhciBkPU1hdGgucG93KHRoaXMucXVhbGl0eSwuMik7cmV0dXJuKGF8fG5ldyBjcmVhdGVqcy5SZWN0YW5nbGUpLnBhZChiKmQrMSxjKmQrMSxiKmQrMSxjKmQrMSl9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGEodGhpcy5ibHVyWCx0aGlzLmJsdXJZLHRoaXMucXVhbGl0eSl9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltCbHVyRmlsdGVyXVwifSxiLl9hcHBseUZpbHRlcj1mdW5jdGlvbihiKXt2YXIgYz10aGlzLmJsdXJYPj4xO2lmKGlzTmFOKGMpfHwwPmMpcmV0dXJuITE7dmFyIGQ9dGhpcy5ibHVyWT4+MTtpZihpc05hTihkKXx8MD5kKXJldHVybiExO2lmKDA9PWMmJjA9PWQpcmV0dXJuITE7dmFyIGU9dGhpcy5xdWFsaXR5Oyhpc05hTihlKXx8MT5lKSYmKGU9MSksZXw9MCxlPjMmJihlPTMpLDE+ZSYmKGU9MSk7dmFyIGY9Yi5kYXRhLGc9MCxoPTAsaT0wLGo9MCxrPTAsbD0wLG09MCxuPTAsbz0wLHA9MCxxPTAscj0wLHM9MCx0PTAsdT0wLHY9YytjKzF8MCx3PWQrZCsxfDAseD0wfGIud2lkdGgseT0wfGIuaGVpZ2h0LHo9eC0xfDAsQT15LTF8MCxCPWMrMXwwLEM9ZCsxfDAsRD17cjowLGI6MCxnOjAsYTowfSxFPUQ7Zm9yKGk9MTt2Pmk7aSsrKUU9RS5uPXtyOjAsYjowLGc6MCxhOjB9O0Uubj1EO3ZhciBGPXtyOjAsYjowLGc6MCxhOjB9LEc9Rjtmb3IoaT0xO3c+aTtpKyspRz1HLm49e3I6MCxiOjAsZzowLGE6MH07Ry5uPUY7Zm9yKHZhciBIPW51bGwsST0wfGEuTVVMX1RBQkxFW2NdLEo9MHxhLlNIR19UQUJMRVtjXSxLPTB8YS5NVUxfVEFCTEVbZF0sTD0wfGEuU0hHX1RBQkxFW2RdO2UtLT4wOyl7bT1sPTA7dmFyIE09SSxOPUo7Zm9yKGg9eTstLWg+LTE7KXtmb3Iobj1CKihyPWZbMHxsXSksbz1CKihzPWZbbCsxfDBdKSxwPUIqKHQ9ZltsKzJ8MF0pLHE9QioodT1mW2wrM3wwXSksRT1ELGk9QjstLWk+LTE7KUUucj1yLEUuZz1zLEUuYj10LEUuYT11LEU9RS5uO2ZvcihpPTE7Qj5pO2krKylqPWwrKChpPno/ejppKTw8Mil8MCxuKz1FLnI9ZltqXSxvKz1FLmc9ZltqKzFdLHArPUUuYj1mW2orMl0scSs9RS5hPWZbaiszXSxFPUUubjtmb3IoSD1ELGc9MDt4Pmc7ZysrKWZbbCsrXT1uKk0+Pj5OLGZbbCsrXT1vKk0+Pj5OLGZbbCsrXT1wKk0+Pj5OLGZbbCsrXT1xKk0+Pj5OLGo9bSsoKGo9ZytjKzEpPHo/ajp6KTw8MixuLT1ILnItKEgucj1mW2pdKSxvLT1ILmctKEguZz1mW2orMV0pLHAtPUguYi0oSC5iPWZbaisyXSkscS09SC5hLShILmE9ZltqKzNdKSxIPUgubjttKz14fWZvcihNPUssTj1MLGc9MDt4Pmc7ZysrKXtmb3IobD1nPDwyfDAsbj1DKihyPWZbbF0pfDAsbz1DKihzPWZbbCsxfDBdKXwwLHA9QyoodD1mW2wrMnwwXSl8MCxxPUMqKHU9ZltsKzN8MF0pfDAsRz1GLGk9MDtDPmk7aSsrKUcucj1yLEcuZz1zLEcuYj10LEcuYT11LEc9Ry5uO2ZvcihrPXgsaT0xO2Q+PWk7aSsrKWw9aytnPDwyLG4rPUcucj1mW2xdLG8rPUcuZz1mW2wrMV0scCs9Ry5iPWZbbCsyXSxxKz1HLmE9ZltsKzNdLEc9Ry5uLEE+aSYmKGsrPXgpO2lmKGw9ZyxIPUYsZT4wKWZvcihoPTA7eT5oO2grKylqPWw8PDIsZltqKzNdPXU9cSpNPj4+Tix1PjA/KGZbal09bipNPj4+TixmW2orMV09bypNPj4+TixmW2orMl09cCpNPj4+Tik6ZltqXT1mW2orMV09ZltqKzJdPTAsaj1nKygoaj1oK0MpPEE/ajpBKSp4PDwyLG4tPUguci0oSC5yPWZbal0pLG8tPUguZy0oSC5nPWZbaisxXSkscC09SC5iLShILmI9ZltqKzJdKSxxLT1ILmEtKEguYT1mW2orM10pLEg9SC5uLGwrPXg7ZWxzZSBmb3IoaD0wO3k+aDtoKyspaj1sPDwyLGZbaiszXT11PXEqTT4+Pk4sdT4wPyh1PTI1NS91LGZbal09KG4qTT4+Pk4pKnUsZltqKzFdPShvKk0+Pj5OKSp1LGZbaisyXT0ocCpNPj4+TikqdSk6ZltqXT1mW2orMV09ZltqKzJdPTAsaj1nKygoaj1oK0MpPEE/ajpBKSp4PDwyLG4tPUguci0oSC5yPWZbal0pLG8tPUguZy0oSC5nPWZbaisxXSkscC09SC5iLShILmI9ZltqKzJdKSxxLT1ILmEtKEguYT1mW2orM10pLEg9SC5uLGwrPXh9fXJldHVybiEwfSxjcmVhdGVqcy5CbHVyRmlsdGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkZpbHRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhKXt0aGlzLmFscGhhTWFwPWEsdGhpcy5fYWxwaGFNYXA9bnVsbCx0aGlzLl9tYXBEYXRhPW51bGx9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuRmlsdGVyKTtiLmNsb25lPWZ1bmN0aW9uKCl7dmFyIGI9bmV3IGEodGhpcy5hbHBoYU1hcCk7cmV0dXJuIGIuX2FscGhhTWFwPXRoaXMuX2FscGhhTWFwLGIuX21hcERhdGE9dGhpcy5fbWFwRGF0YSxifSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbQWxwaGFNYXBGaWx0ZXJdXCJ9LGIuX2FwcGx5RmlsdGVyPWZ1bmN0aW9uKGEpe2lmKCF0aGlzLmFscGhhTWFwKXJldHVybiEwO2lmKCF0aGlzLl9wcmVwQWxwaGFNYXAoKSlyZXR1cm4hMTtmb3IodmFyIGI9YS5kYXRhLGM9dGhpcy5fbWFwRGF0YSxkPTAsZT1iLmxlbmd0aDtlPmQ7ZCs9NCliW2QrM109Y1tkXXx8MDtyZXR1cm4hMH0sYi5fcHJlcEFscGhhTWFwPWZ1bmN0aW9uKCl7aWYoIXRoaXMuYWxwaGFNYXApcmV0dXJuITE7aWYodGhpcy5hbHBoYU1hcD09dGhpcy5fYWxwaGFNYXAmJnRoaXMuX21hcERhdGEpcmV0dXJuITA7dGhpcy5fbWFwRGF0YT1udWxsO3ZhciBhLGI9dGhpcy5fYWxwaGFNYXA9dGhpcy5hbHBoYU1hcCxjPWI7YiBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50P2E9Yy5nZXRDb250ZXh0KFwiMmRcIik6KGM9Y3JlYXRlanMuY3JlYXRlQ2FudmFzP2NyZWF0ZWpzLmNyZWF0ZUNhbnZhcygpOmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIiksYy53aWR0aD1iLndpZHRoLGMuaGVpZ2h0PWIuaGVpZ2h0LGE9Yy5nZXRDb250ZXh0KFwiMmRcIiksYS5kcmF3SW1hZ2UoYiwwLDApKTt0cnl7dmFyIGQ9YS5nZXRJbWFnZURhdGEoMCwwLGIud2lkdGgsYi5oZWlnaHQpfWNhdGNoKGUpe3JldHVybiExfXJldHVybiB0aGlzLl9tYXBEYXRhPWQuZGF0YSwhMH0sY3JlYXRlanMuQWxwaGFNYXBGaWx0ZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiRmlsdGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMubWFzaz1hfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkZpbHRlcik7Yi5hcHBseUZpbHRlcj1mdW5jdGlvbihhLGIsYyxkLGUsZixnLGgpe3JldHVybiB0aGlzLm1hc2s/KGY9Znx8YSxudWxsPT1nJiYoZz1iKSxudWxsPT1oJiYoaD1jKSxmLnNhdmUoKSxhIT1mPyExOihmLmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbj1cImRlc3RpbmF0aW9uLWluXCIsZi5kcmF3SW1hZ2UodGhpcy5tYXNrLGcsaCksZi5yZXN0b3JlKCksITApKTohMH0sYi5jbG9uZT1mdW5jdGlvbigpe3JldHVybiBuZXcgYSh0aGlzLm1hc2spfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbQWxwaGFNYXNrRmlsdGVyXVwifSxjcmVhdGVqcy5BbHBoYU1hc2tGaWx0ZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiRmlsdGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjLGQsZSxmLGcsaCl7dGhpcy5yZWRNdWx0aXBsaWVyPW51bGwhPWE/YToxLHRoaXMuZ3JlZW5NdWx0aXBsaWVyPW51bGwhPWI/YjoxLHRoaXMuYmx1ZU11bHRpcGxpZXI9bnVsbCE9Yz9jOjEsdGhpcy5hbHBoYU11bHRpcGxpZXI9bnVsbCE9ZD9kOjEsdGhpcy5yZWRPZmZzZXQ9ZXx8MCx0aGlzLmdyZWVuT2Zmc2V0PWZ8fDAsdGhpcy5ibHVlT2Zmc2V0PWd8fDAsdGhpcy5hbHBoYU9mZnNldD1ofHwwfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkZpbHRlcik7Yi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0NvbG9yRmlsdGVyXVwifSxiLmNsb25lPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBhKHRoaXMucmVkTXVsdGlwbGllcix0aGlzLmdyZWVuTXVsdGlwbGllcix0aGlzLmJsdWVNdWx0aXBsaWVyLHRoaXMuYWxwaGFNdWx0aXBsaWVyLHRoaXMucmVkT2Zmc2V0LHRoaXMuZ3JlZW5PZmZzZXQsdGhpcy5ibHVlT2Zmc2V0LHRoaXMuYWxwaGFPZmZzZXQpfSxiLl9hcHBseUZpbHRlcj1mdW5jdGlvbihhKXtmb3IodmFyIGI9YS5kYXRhLGM9Yi5sZW5ndGgsZD0wO2M+ZDtkKz00KWJbZF09YltkXSp0aGlzLnJlZE11bHRpcGxpZXIrdGhpcy5yZWRPZmZzZXQsYltkKzFdPWJbZCsxXSp0aGlzLmdyZWVuTXVsdGlwbGllcit0aGlzLmdyZWVuT2Zmc2V0LGJbZCsyXT1iW2QrMl0qdGhpcy5ibHVlTXVsdGlwbGllcit0aGlzLmJsdWVPZmZzZXQsYltkKzNdPWJbZCszXSp0aGlzLmFscGhhTXVsdGlwbGllcit0aGlzLmFscGhhT2Zmc2V0O3JldHVybiEwfSxjcmVhdGVqcy5Db2xvckZpbHRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJGaWx0ZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiLGMsZCl7dGhpcy5zZXRDb2xvcihhLGIsYyxkKX12YXIgYj1hLnByb3RvdHlwZTthLkRFTFRBX0lOREVYPVswLC4wMSwuMDIsLjA0LC4wNSwuMDYsLjA3LC4wOCwuMSwuMTEsLjEyLC4xNCwuMTUsLjE2LC4xNywuMTgsLjIsLjIxLC4yMiwuMjQsLjI1LC4yNywuMjgsLjMsLjMyLC4zNCwuMzYsLjM4LC40LC40MiwuNDQsLjQ2LC40OCwuNSwuNTMsLjU2LC41OSwuNjIsLjY1LC42OCwuNzEsLjc0LC43NywuOCwuODMsLjg2LC44OSwuOTIsLjk1LC45OCwxLDEuMDYsMS4xMiwxLjE4LDEuMjQsMS4zLDEuMzYsMS40MiwxLjQ4LDEuNTQsMS42LDEuNjYsMS43MiwxLjc4LDEuODQsMS45LDEuOTYsMiwyLjEyLDIuMjUsMi4zNywyLjUsMi42MiwyLjc1LDIuODcsMywzLjIsMy40LDMuNiwzLjgsNCw0LjMsNC43LDQuOSw1LDUuNSw2LDYuNSw2LjgsNyw3LjMsNy41LDcuOCw4LDguNCw4LjcsOSw5LjQsOS42LDkuOCwxMF0sYS5JREVOVElUWV9NQVRSSVg9WzEsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDFdLGEuTEVOR1RIPWEuSURFTlRJVFlfTUFUUklYLmxlbmd0aCxiLnNldENvbG9yPWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLnJlc2V0KCkuYWRqdXN0Q29sb3IoYSxiLGMsZCl9LGIucmVzZXQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb3B5KGEuSURFTlRJVFlfTUFUUklYKX0sYi5hZGp1c3RDb2xvcj1mdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5hZGp1c3RIdWUoZCksdGhpcy5hZGp1c3RDb250cmFzdChiKSx0aGlzLmFkanVzdEJyaWdodG5lc3MoYSksdGhpcy5hZGp1c3RTYXR1cmF0aW9uKGMpfSxiLmFkanVzdEJyaWdodG5lc3M9ZnVuY3Rpb24oYSl7cmV0dXJuIDA9PWF8fGlzTmFOKGEpP3RoaXM6KGE9dGhpcy5fY2xlYW5WYWx1ZShhLDI1NSksdGhpcy5fbXVsdGlwbHlNYXRyaXgoWzEsMCwwLDAsYSwwLDEsMCwwLGEsMCwwLDEsMCxhLDAsMCwwLDEsMCwwLDAsMCwwLDFdKSx0aGlzKX0sYi5hZGp1c3RDb250cmFzdD1mdW5jdGlvbihiKXtpZigwPT1ifHxpc05hTihiKSlyZXR1cm4gdGhpcztiPXRoaXMuX2NsZWFuVmFsdWUoYiwxMDApO3ZhciBjO3JldHVybiAwPmI/Yz0xMjcrYi8xMDAqMTI3OihjPWIlMSxjPTA9PWM/YS5ERUxUQV9JTkRFWFtiXTphLkRFTFRBX0lOREVYW2I8PDBdKigxLWMpK2EuREVMVEFfSU5ERVhbKGI8PDApKzFdKmMsYz0xMjcqYysxMjcpLHRoaXMuX211bHRpcGx5TWF0cml4KFtjLzEyNywwLDAsMCwuNSooMTI3LWMpLDAsYy8xMjcsMCwwLC41KigxMjctYyksMCwwLGMvMTI3LDAsLjUqKDEyNy1jKSwwLDAsMCwxLDAsMCwwLDAsMCwxXSksdGhpc30sYi5hZGp1c3RTYXR1cmF0aW9uPWZ1bmN0aW9uKGEpe2lmKDA9PWF8fGlzTmFOKGEpKXJldHVybiB0aGlzO2E9dGhpcy5fY2xlYW5WYWx1ZShhLDEwMCk7dmFyIGI9MSsoYT4wPzMqYS8xMDA6YS8xMDApLGM9LjMwODYsZD0uNjA5NCxlPS4wODI7cmV0dXJuIHRoaXMuX211bHRpcGx5TWF0cml4KFtjKigxLWIpK2IsZCooMS1iKSxlKigxLWIpLDAsMCxjKigxLWIpLGQqKDEtYikrYixlKigxLWIpLDAsMCxjKigxLWIpLGQqKDEtYiksZSooMS1iKStiLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwxXSksdGhpc30sYi5hZGp1c3RIdWU9ZnVuY3Rpb24oYSl7aWYoMD09YXx8aXNOYU4oYSkpcmV0dXJuIHRoaXM7YT10aGlzLl9jbGVhblZhbHVlKGEsMTgwKS8xODAqTWF0aC5QSTt2YXIgYj1NYXRoLmNvcyhhKSxjPU1hdGguc2luKGEpLGQ9LjIxMyxlPS43MTUsZj0uMDcyO3JldHVybiB0aGlzLl9tdWx0aXBseU1hdHJpeChbZCtiKigxLWQpK2MqLWQsZStiKi1lK2MqLWUsZitiKi1mK2MqKDEtZiksMCwwLGQrYiotZCsuMTQzKmMsZStiKigxLWUpKy4xNCpjLGYrYiotZitjKi0uMjgzLDAsMCxkK2IqLWQrYyotKDEtZCksZStiKi1lK2MqZSxmK2IqKDEtZikrYypmLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwxXSksdGhpc30sYi5jb25jYXQ9ZnVuY3Rpb24oYil7cmV0dXJuIGI9dGhpcy5fZml4TWF0cml4KGIpLGIubGVuZ3RoIT1hLkxFTkdUSD90aGlzOih0aGlzLl9tdWx0aXBseU1hdHJpeChiKSx0aGlzKX0sYi5jbG9uZT1mdW5jdGlvbigpe3JldHVybihuZXcgYSkuY29weSh0aGlzKX0sYi50b0FycmF5PWZ1bmN0aW9uKCl7Zm9yKHZhciBiPVtdLGM9MCxkPWEuTEVOR1RIO2Q+YztjKyspYltjXT10aGlzW2NdO3JldHVybiBifSxiLmNvcHk9ZnVuY3Rpb24oYil7Zm9yKHZhciBjPWEuTEVOR1RILGQ9MDtjPmQ7ZCsrKXRoaXNbZF09YltkXTtyZXR1cm4gdGhpc30sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0NvbG9yTWF0cml4XVwifSxiLl9tdWx0aXBseU1hdHJpeD1mdW5jdGlvbihhKXt2YXIgYixjLGQsZT1bXTtmb3IoYj0wOzU+YjtiKyspe2ZvcihjPTA7NT5jO2MrKyllW2NdPXRoaXNbYys1KmJdO2ZvcihjPTA7NT5jO2MrKyl7dmFyIGY9MDtmb3IoZD0wOzU+ZDtkKyspZis9YVtjKzUqZF0qZVtkXTt0aGlzW2MrNSpiXT1mfX19LGIuX2NsZWFuVmFsdWU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gTWF0aC5taW4oYixNYXRoLm1heCgtYixhKSl9LGIuX2ZpeE1hdHJpeD1mdW5jdGlvbihiKXtyZXR1cm4gYiBpbnN0YW5jZW9mIGEmJihiPWIudG9BcnJheSgpKSxiLmxlbmd0aDxhLkxFTkdUSD9iPWIuc2xpY2UoMCxiLmxlbmd0aCkuY29uY2F0KGEuSURFTlRJVFlfTUFUUklYLnNsaWNlKGIubGVuZ3RoLGEuTEVOR1RIKSk6Yi5sZW5ndGg+YS5MRU5HVEgmJihiPWIuc2xpY2UoMCxhLkxFTkdUSCkpLGJ9LGNyZWF0ZWpzLkNvbG9yTWF0cml4PWF9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSl7dGhpcy5tYXRyaXg9YX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5GaWx0ZXIpO2IudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltDb2xvck1hdHJpeEZpbHRlcl1cIn0sYi5jbG9uZT1mdW5jdGlvbigpe3JldHVybiBuZXcgYSh0aGlzLm1hdHJpeCl9LGIuX2FwcGx5RmlsdGVyPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYixjLGQsZSxmPWEuZGF0YSxnPWYubGVuZ3RoLGg9dGhpcy5tYXRyaXgsaT1oWzBdLGo9aFsxXSxrPWhbMl0sbD1oWzNdLG09aFs0XSxuPWhbNV0sbz1oWzZdLHA9aFs3XSxxPWhbOF0scj1oWzldLHM9aFsxMF0sdD1oWzExXSx1PWhbMTJdLHY9aFsxM10sdz1oWzE0XSx4PWhbMTVdLHk9aFsxNl0sej1oWzE3XSxBPWhbMThdLEI9aFsxOV0sQz0wO2c+QztDKz00KWI9ZltDXSxjPWZbQysxXSxkPWZbQysyXSxlPWZbQyszXSxmW0NdPWIqaStjKmorZCprK2UqbCttLGZbQysxXT1iKm4rYypvK2QqcCtlKnErcixmW0MrMl09YipzK2MqdCtkKnUrZSp2K3csZltDKzNdPWIqeCtjKnkrZCp6K2UqQStCO3JldHVybiEwfSxjcmVhdGVqcy5Db2xvck1hdHJpeEZpbHRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJGaWx0ZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt0aHJvd1wiVG91Y2ggY2Fubm90IGJlIGluc3RhbnRpYXRlZFwifWEuaXNTdXBwb3J0ZWQ9ZnVuY3Rpb24oKXtyZXR1cm4hIShcIm9udG91Y2hzdGFydFwiaW4gd2luZG93fHx3aW5kb3cubmF2aWdhdG9yLm1zUG9pbnRlckVuYWJsZWQmJndpbmRvdy5uYXZpZ2F0b3IubXNNYXhUb3VjaFBvaW50cz4wfHx3aW5kb3cubmF2aWdhdG9yLnBvaW50ZXJFbmFibGVkJiZ3aW5kb3cubmF2aWdhdG9yLm1heFRvdWNoUG9pbnRzPjApfSxhLmVuYWJsZT1mdW5jdGlvbihiLGMsZCl7cmV0dXJuIGImJmIuY2FudmFzJiZhLmlzU3VwcG9ydGVkKCk/Yi5fX3RvdWNoPyEwOihiLl9fdG91Y2g9e3BvaW50ZXJzOnt9LG11bHRpdG91Y2g6IWMscHJldmVudERlZmF1bHQ6IWQsY291bnQ6MH0sXCJvbnRvdWNoc3RhcnRcImluIHdpbmRvdz9hLl9JT1NfZW5hYmxlKGIpOih3aW5kb3cubmF2aWdhdG9yLm1zUG9pbnRlckVuYWJsZWR8fHdpbmRvdy5uYXZpZ2F0b3IucG9pbnRlckVuYWJsZWQpJiZhLl9JRV9lbmFibGUoYiksITApOiExfSxhLmRpc2FibGU9ZnVuY3Rpb24oYil7YiYmKFwib250b3VjaHN0YXJ0XCJpbiB3aW5kb3c/YS5fSU9TX2Rpc2FibGUoYik6KHdpbmRvdy5uYXZpZ2F0b3IubXNQb2ludGVyRW5hYmxlZHx8d2luZG93Lm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZCkmJmEuX0lFX2Rpc2FibGUoYiksZGVsZXRlIGIuX190b3VjaCl9LGEuX0lPU19lbmFibGU9ZnVuY3Rpb24oYil7dmFyIGM9Yi5jYW52YXMsZD1iLl9fdG91Y2guZj1mdW5jdGlvbihjKXthLl9JT1NfaGFuZGxlRXZlbnQoYixjKX07Yy5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLGQsITEpLGMuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLGQsITEpLGMuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsZCwhMSksYy5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hjYW5jZWxcIixkLCExKX0sYS5fSU9TX2Rpc2FibGU9ZnVuY3Rpb24oYSl7dmFyIGI9YS5jYW52YXM7aWYoYil7dmFyIGM9YS5fX3RvdWNoLmY7Yi5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLGMsITEpLGIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLGMsITEpLGIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsYywhMSksYi5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2hjYW5jZWxcIixjLCExKX19LGEuX0lPU19oYW5kbGVFdmVudD1mdW5jdGlvbihhLGIpe2lmKGEpe2EuX190b3VjaC5wcmV2ZW50RGVmYXVsdCYmYi5wcmV2ZW50RGVmYXVsdCYmYi5wcmV2ZW50RGVmYXVsdCgpO2Zvcih2YXIgYz1iLmNoYW5nZWRUb3VjaGVzLGQ9Yi50eXBlLGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspe3ZhciBnPWNbZV0saD1nLmlkZW50aWZpZXI7Zy50YXJnZXQ9PWEuY2FudmFzJiYoXCJ0b3VjaHN0YXJ0XCI9PWQ/dGhpcy5faGFuZGxlU3RhcnQoYSxoLGIsZy5wYWdlWCxnLnBhZ2VZKTpcInRvdWNobW92ZVwiPT1kP3RoaXMuX2hhbmRsZU1vdmUoYSxoLGIsZy5wYWdlWCxnLnBhZ2VZKTooXCJ0b3VjaGVuZFwiPT1kfHxcInRvdWNoY2FuY2VsXCI9PWQpJiZ0aGlzLl9oYW5kbGVFbmQoYSxoLGIpKX19fSxhLl9JRV9lbmFibGU9ZnVuY3Rpb24oYil7dmFyIGM9Yi5jYW52YXMsZD1iLl9fdG91Y2guZj1mdW5jdGlvbihjKXthLl9JRV9oYW5kbGVFdmVudChiLGMpfTt2b2lkIDA9PT13aW5kb3cubmF2aWdhdG9yLnBvaW50ZXJFbmFibGVkPyhjLmFkZEV2ZW50TGlzdGVuZXIoXCJNU1BvaW50ZXJEb3duXCIsZCwhMSksd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJNU1BvaW50ZXJNb3ZlXCIsZCwhMSksd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJNU1BvaW50ZXJVcFwiLGQsITEpLHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiTVNQb2ludGVyQ2FuY2VsXCIsZCwhMSksYi5fX3RvdWNoLnByZXZlbnREZWZhdWx0JiYoYy5zdHlsZS5tc1RvdWNoQWN0aW9uPVwibm9uZVwiKSk6KGMuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJkb3duXCIsZCwhMSksd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVybW92ZVwiLGQsITEpLHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcnVwXCIsZCwhMSksd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVyY2FuY2VsXCIsZCwhMSksYi5fX3RvdWNoLnByZXZlbnREZWZhdWx0JiYoYy5zdHlsZS50b3VjaEFjdGlvbj1cIm5vbmVcIikpLGIuX190b3VjaC5hY3RpdmVJRHM9e319LGEuX0lFX2Rpc2FibGU9ZnVuY3Rpb24oYSl7dmFyIGI9YS5fX3RvdWNoLmY7dm9pZCAwPT09d2luZG93Lm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZD8od2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJNU1BvaW50ZXJNb3ZlXCIsYiwhMSksd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJNU1BvaW50ZXJVcFwiLGIsITEpLHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiTVNQb2ludGVyQ2FuY2VsXCIsYiwhMSksYS5jYW52YXMmJmEuY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJNU1BvaW50ZXJEb3duXCIsYiwhMSkpOih3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJtb3ZlXCIsYiwhMSksd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2ludGVydXBcIixiLCExKSx3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJjYW5jZWxcIixiLCExKSxhLmNhbnZhcyYmYS5jYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJkb3duXCIsYiwhMSkpfSxhLl9JRV9oYW5kbGVFdmVudD1mdW5jdGlvbihhLGIpe2lmKGEpe2EuX190b3VjaC5wcmV2ZW50RGVmYXVsdCYmYi5wcmV2ZW50RGVmYXVsdCYmYi5wcmV2ZW50RGVmYXVsdCgpO3ZhciBjPWIudHlwZSxkPWIucG9pbnRlcklkLGU9YS5fX3RvdWNoLmFjdGl2ZUlEcztpZihcIk1TUG9pbnRlckRvd25cIj09Y3x8XCJwb2ludGVyZG93blwiPT1jKXtpZihiLnNyY0VsZW1lbnQhPWEuY2FudmFzKXJldHVybjtlW2RdPSEwLHRoaXMuX2hhbmRsZVN0YXJ0KGEsZCxiLGIucGFnZVgsYi5wYWdlWSl9ZWxzZSBlW2RdJiYoXCJNU1BvaW50ZXJNb3ZlXCI9PWN8fFwicG9pbnRlcm1vdmVcIj09Yz90aGlzLl9oYW5kbGVNb3ZlKGEsZCxiLGIucGFnZVgsYi5wYWdlWSk6KFwiTVNQb2ludGVyVXBcIj09Y3x8XCJNU1BvaW50ZXJDYW5jZWxcIj09Y3x8XCJwb2ludGVydXBcIj09Y3x8XCJwb2ludGVyY2FuY2VsXCI9PWMpJiYoZGVsZXRlIGVbZF0sdGhpcy5faGFuZGxlRW5kKGEsZCxiKSkpfX0sYS5faGFuZGxlU3RhcnQ9ZnVuY3Rpb24oYSxiLGMsZCxlKXt2YXIgZj1hLl9fdG91Y2g7aWYoZi5tdWx0aXRvdWNofHwhZi5jb3VudCl7dmFyIGc9Zi5wb2ludGVycztnW2JdfHwoZ1tiXT0hMCxmLmNvdW50KyssYS5faGFuZGxlUG9pbnRlckRvd24oYixjLGQsZSkpfX0sYS5faGFuZGxlTW92ZT1mdW5jdGlvbihhLGIsYyxkLGUpe2EuX190b3VjaC5wb2ludGVyc1tiXSYmYS5faGFuZGxlUG9pbnRlck1vdmUoYixjLGQsZSl9LGEuX2hhbmRsZUVuZD1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9YS5fX3RvdWNoLGU9ZC5wb2ludGVycztlW2JdJiYoZC5jb3VudC0tLGEuX2hhbmRsZVBvaW50ZXJVcChiLGMsITApLGRlbGV0ZSBlW2JdKX0sY3JlYXRlanMuVG91Y2g9YX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7dmFyIGE9Y3JlYXRlanMuRWFzZWxKUz1jcmVhdGVqcy5FYXNlbEpTfHx7fTthLnZlcnNpb249XCIwLjguMlwiLGEuYnVpbGREYXRlPVwiVGh1LCAyNiBOb3YgMjAxNSAyMDo0NDozNCBHTVRcIn0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7dmFyIGE9Y3JlYXRlanMuUHJlbG9hZEpTPWNyZWF0ZWpzLlByZWxvYWRKU3x8e307YS52ZXJzaW9uPVwiMC42LjJcIixhLmJ1aWxkRGF0ZT1cIlRodSwgMjYgTm92IDIwMTUgMjA6NDQ6MzEgR01UXCJ9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2NyZWF0ZWpzLnByb3h5PWZ1bmN0aW9uKGEsYil7dmFyIGM9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDIpO3JldHVybiBmdW5jdGlvbigpe3JldHVybiBhLmFwcGx5KGIsQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApLmNvbmNhdChjKSl9fX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIsYyl7dGhpcy5FdmVudF9jb25zdHJ1Y3RvcihcImVycm9yXCIpLHRoaXMudGl0bGU9YSx0aGlzLm1lc3NhZ2U9Yix0aGlzLmRhdGE9Y312YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5FdmVudCk7Yi5jbG9uZT1mdW5jdGlvbigpe3JldHVybiBuZXcgY3JlYXRlanMuRXJyb3JFdmVudCh0aGlzLnRpdGxlLHRoaXMubWVzc2FnZSx0aGlzLmRhdGEpfSxjcmVhdGVqcy5FcnJvckV2ZW50PWNyZWF0ZWpzLnByb21vdGUoYSxcIkV2ZW50XCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oYSl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYihhLGIpe3RoaXMuRXZlbnRfY29uc3RydWN0b3IoXCJwcm9ncmVzc1wiKSx0aGlzLmxvYWRlZD1hLHRoaXMudG90YWw9bnVsbD09Yj8xOmIsdGhpcy5wcm9ncmVzcz0wPT1iPzA6dGhpcy5sb2FkZWQvdGhpcy50b3RhbH12YXIgYz1jcmVhdGVqcy5leHRlbmQoYixjcmVhdGVqcy5FdmVudCk7Yy5jbG9uZT1mdW5jdGlvbigpe3JldHVybiBuZXcgY3JlYXRlanMuUHJvZ3Jlc3NFdmVudCh0aGlzLmxvYWRlZCx0aGlzLnRvdGFsKX0sY3JlYXRlanMuUHJvZ3Jlc3NFdmVudD1jcmVhdGVqcy5wcm9tb3RlKGIsXCJFdmVudFwiKX0od2luZG93KSxmdW5jdGlvbigpe2Z1bmN0aW9uIGEoYixkKXtmdW5jdGlvbiBmKGEpe2lmKGZbYV0hPT1xKXJldHVybiBmW2FdO3ZhciBiO2lmKFwiYnVnLXN0cmluZy1jaGFyLWluZGV4XCI9PWEpYj1cImFcIiE9XCJhXCJbMF07ZWxzZSBpZihcImpzb25cIj09YSliPWYoXCJqc29uLXN0cmluZ2lmeVwiKSYmZihcImpzb24tcGFyc2VcIik7ZWxzZXt2YXIgYyxlPSd7XCJhXCI6WzEsdHJ1ZSxmYWxzZSxudWxsLFwiXFxcXHUwMDAwXFxcXGJcXFxcblxcXFxmXFxcXHJcXFxcdFwiXX0nO2lmKFwianNvbi1zdHJpbmdpZnlcIj09YSl7dmFyIGk9ZC5zdHJpbmdpZnksaz1cImZ1bmN0aW9uXCI9PXR5cGVvZiBpJiZ0O2lmKGspeyhjPWZ1bmN0aW9uKCl7cmV0dXJuIDF9KS50b0pTT049Yzt0cnl7az1cIjBcIj09PWkoMCkmJlwiMFwiPT09aShuZXcgZykmJidcIlwiJz09aShuZXcgaCkmJmkocyk9PT1xJiZpKHEpPT09cSYmaSgpPT09cSYmXCIxXCI9PT1pKGMpJiZcIlsxXVwiPT1pKFtjXSkmJlwiW251bGxdXCI9PWkoW3FdKSYmXCJudWxsXCI9PWkobnVsbCkmJlwiW251bGwsbnVsbCxudWxsXVwiPT1pKFtxLHMsbnVsbF0pJiZpKHthOltjLCEwLCExLG51bGwsXCJcXHgwMFxcYlxcblxcZlxcclx0XCJdfSk9PWUmJlwiMVwiPT09aShudWxsLGMpJiZcIltcXG4gMSxcXG4gMlxcbl1cIj09aShbMSwyXSxudWxsLDEpJiYnXCItMjcxODIxLTA0LTIwVDAwOjAwOjAwLjAwMFpcIic9PWkobmV3IGooLTg2NGUxMykpJiYnXCIrMjc1NzYwLTA5LTEzVDAwOjAwOjAwLjAwMFpcIic9PWkobmV3IGooODY0ZTEzKSkmJidcIi0wMDAwMDEtMDEtMDFUMDA6MDA6MDAuMDAwWlwiJz09aShuZXcgaigtNjIxOTg3NTUyZTUpKSYmJ1wiMTk2OS0xMi0zMVQyMzo1OTo1OS45OTlaXCInPT1pKG5ldyBqKC0xKSl9Y2F0Y2gobCl7az0hMX19Yj1rfWlmKFwianNvbi1wYXJzZVwiPT1hKXt2YXIgbT1kLnBhcnNlO2lmKFwiZnVuY3Rpb25cIj09dHlwZW9mIG0pdHJ5e2lmKDA9PT1tKFwiMFwiKSYmIW0oITEpKXtjPW0oZSk7dmFyIG49NT09Yy5hLmxlbmd0aCYmMT09PWMuYVswXTtpZihuKXt0cnl7bj0hbSgnXCJcdFwiJyl9Y2F0Y2gobCl7fWlmKG4pdHJ5e249MSE9PW0oXCIwMVwiKX1jYXRjaChsKXt9aWYobil0cnl7bj0xIT09bShcIjEuXCIpfWNhdGNoKGwpe319fX1jYXRjaChsKXtuPSExfWI9bn19cmV0dXJuIGZbYV09ISFifWJ8fChiPWUuT2JqZWN0KCkpLGR8fChkPWUuT2JqZWN0KCkpO3ZhciBnPWIuTnVtYmVyfHxlLk51bWJlcixoPWIuU3RyaW5nfHxlLlN0cmluZyxpPWIuT2JqZWN0fHxlLk9iamVjdCxqPWIuRGF0ZXx8ZS5EYXRlLGs9Yi5TeW50YXhFcnJvcnx8ZS5TeW50YXhFcnJvcixsPWIuVHlwZUVycm9yfHxlLlR5cGVFcnJvcixtPWIuTWF0aHx8ZS5NYXRoLG49Yi5KU09OfHxlLkpTT047XCJvYmplY3RcIj09dHlwZW9mIG4mJm4mJihkLnN0cmluZ2lmeT1uLnN0cmluZ2lmeSxkLnBhcnNlPW4ucGFyc2UpO3ZhciBvLHAscSxyPWkucHJvdG90eXBlLHM9ci50b1N0cmluZyx0PW5ldyBqKC0weGM3ODJiNWI4MDBjZWMpO3RyeXt0PS0xMDkyNTI9PXQuZ2V0VVRDRnVsbFllYXIoKSYmMD09PXQuZ2V0VVRDTW9udGgoKSYmMT09PXQuZ2V0VVRDRGF0ZSgpJiYxMD09dC5nZXRVVENIb3VycygpJiYzNz09dC5nZXRVVENNaW51dGVzKCkmJjY9PXQuZ2V0VVRDU2Vjb25kcygpJiY3MDg9PXQuZ2V0VVRDTWlsbGlzZWNvbmRzKCl9Y2F0Y2godSl7fWlmKCFmKFwianNvblwiKSl7dmFyIHY9XCJbb2JqZWN0IEZ1bmN0aW9uXVwiLHc9XCJbb2JqZWN0IERhdGVdXCIseD1cIltvYmplY3QgTnVtYmVyXVwiLHk9XCJbb2JqZWN0IFN0cmluZ11cIix6PVwiW29iamVjdCBBcnJheV1cIixBPVwiW29iamVjdCBCb29sZWFuXVwiLEI9ZihcImJ1Zy1zdHJpbmctY2hhci1pbmRleFwiKTtpZighdCl2YXIgQz1tLmZsb29yLEQ9WzAsMzEsNTksOTAsMTIwLDE1MSwxODEsMjEyLDI0MywyNzMsMzA0LDMzNF0sRT1mdW5jdGlvbihhLGIpe3JldHVybiBEW2JdKzM2NSooYS0xOTcwKStDKChhLTE5NjkrKGI9KyhiPjEpKSkvNCktQygoYS0xOTAxK2IpLzEwMCkrQygoYS0xNjAxK2IpLzQwMCl9O2lmKChvPXIuaGFzT3duUHJvcGVydHkpfHwobz1mdW5jdGlvbihhKXt2YXIgYixjPXt9O3JldHVybihjLl9fcHJvdG9fXz1udWxsLGMuX19wcm90b19fPXt0b1N0cmluZzoxfSxjKS50b1N0cmluZyE9cz9vPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuX19wcm90b19fLGM9YSBpbih0aGlzLl9fcHJvdG9fXz1udWxsLHRoaXMpO3JldHVybiB0aGlzLl9fcHJvdG9fXz1iLGN9OihiPWMuY29uc3RydWN0b3Isbz1mdW5jdGlvbihhKXt2YXIgYz0odGhpcy5jb25zdHJ1Y3Rvcnx8YikucHJvdG90eXBlO3JldHVybiBhIGluIHRoaXMmJiEoYSBpbiBjJiZ0aGlzW2FdPT09Y1thXSl9KSxjPW51bGwsby5jYWxsKHRoaXMsYSl9KSxwPWZ1bmN0aW9uKGEsYil7dmFyIGQsZSxmLGc9MDsoZD1mdW5jdGlvbigpe3RoaXMudmFsdWVPZj0wfSkucHJvdG90eXBlLnZhbHVlT2Y9MCxlPW5ldyBkO2ZvcihmIGluIGUpby5jYWxsKGUsZikmJmcrKztyZXR1cm4gZD1lPW51bGwsZz9wPTI9PWc/ZnVuY3Rpb24oYSxiKXt2YXIgYyxkPXt9LGU9cy5jYWxsKGEpPT12O2ZvcihjIGluIGEpZSYmXCJwcm90b3R5cGVcIj09Y3x8by5jYWxsKGQsYyl8fCEoZFtjXT0xKXx8IW8uY2FsbChhLGMpfHxiKGMpfTpmdW5jdGlvbihhLGIpe3ZhciBjLGQsZT1zLmNhbGwoYSk9PXY7Zm9yKGMgaW4gYSllJiZcInByb3RvdHlwZVwiPT1jfHwhby5jYWxsKGEsYyl8fChkPVwiY29uc3RydWN0b3JcIj09PWMpfHxiKGMpOyhkfHxvLmNhbGwoYSxjPVwiY29uc3RydWN0b3JcIikpJiZiKGMpfTooZT1bXCJ2YWx1ZU9mXCIsXCJ0b1N0cmluZ1wiLFwidG9Mb2NhbGVTdHJpbmdcIixcInByb3BlcnR5SXNFbnVtZXJhYmxlXCIsXCJpc1Byb3RvdHlwZU9mXCIsXCJoYXNPd25Qcm9wZXJ0eVwiLFwiY29uc3RydWN0b3JcIl0scD1mdW5jdGlvbihhLGIpe3ZhciBkLGYsZz1zLmNhbGwoYSk9PXYsaD0hZyYmXCJmdW5jdGlvblwiIT10eXBlb2YgYS5jb25zdHJ1Y3RvciYmY1t0eXBlb2YgYS5oYXNPd25Qcm9wZXJ0eV0mJmEuaGFzT3duUHJvcGVydHl8fG87Zm9yKGQgaW4gYSlnJiZcInByb3RvdHlwZVwiPT1kfHwhaC5jYWxsKGEsZCl8fGIoZCk7Zm9yKGY9ZS5sZW5ndGg7ZD1lWy0tZl07aC5jYWxsKGEsZCkmJmIoZCkpO30pLHAoYSxiKX0sIWYoXCJqc29uLXN0cmluZ2lmeVwiKSl7dmFyIEY9ezkyOlwiXFxcXFxcXFxcIiwzNDonXFxcXFwiJyw4OlwiXFxcXGJcIiwxMjpcIlxcXFxmXCIsMTA6XCJcXFxcblwiLDEzOlwiXFxcXHJcIiw5OlwiXFxcXHRcIn0sRz1cIjAwMDAwMFwiLEg9ZnVuY3Rpb24oYSxiKXtyZXR1cm4oRysoYnx8MCkpLnNsaWNlKC1hKX0sST1cIlxcXFx1MDBcIixKPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYj0nXCInLGM9MCxkPWEubGVuZ3RoLGU9IUJ8fGQ+MTAsZj1lJiYoQj9hLnNwbGl0KFwiXCIpOmEpO2Q+YztjKyspe3ZhciBnPWEuY2hhckNvZGVBdChjKTtzd2l0Y2goZyl7Y2FzZSA4OmNhc2UgOTpjYXNlIDEwOmNhc2UgMTI6Y2FzZSAxMzpjYXNlIDM0OmNhc2UgOTI6Yis9RltnXTticmVhaztkZWZhdWx0OmlmKDMyPmcpe2IrPUkrSCgyLGcudG9TdHJpbmcoMTYpKTticmVha31iKz1lP2ZbY106YS5jaGFyQXQoYyl9fXJldHVybiBiKydcIid9LEs9ZnVuY3Rpb24oYSxiLGMsZCxlLGYsZyl7dmFyIGgsaSxqLGssbSxuLHIsdCx1LHYsQixELEYsRyxJLEw7dHJ5e2g9YlthXX1jYXRjaChNKXt9aWYoXCJvYmplY3RcIj09dHlwZW9mIGgmJmgpaWYoaT1zLmNhbGwoaCksaSE9d3x8by5jYWxsKGgsXCJ0b0pTT05cIikpXCJmdW5jdGlvblwiPT10eXBlb2YgaC50b0pTT04mJihpIT14JiZpIT15JiZpIT16fHxvLmNhbGwoaCxcInRvSlNPTlwiKSkmJihoPWgudG9KU09OKGEpKTtlbHNlIGlmKGg+LTEvMCYmMS8wPmgpe2lmKEUpe2ZvcihtPUMoaC84NjRlNSksaj1DKG0vMzY1LjI0MjUpKzE5NzAtMTtFKGorMSwwKTw9bTtqKyspO2ZvcihrPUMoKG0tRShqLDApKS8zMC40Mik7RShqLGsrMSk8PW07aysrKTttPTErbS1FKGosayksbj0oaCU4NjRlNSs4NjRlNSklODY0ZTUscj1DKG4vMzZlNSklMjQsdD1DKG4vNmU0KSU2MCx1PUMobi8xZTMpJTYwLHY9biUxZTN9ZWxzZSBqPWguZ2V0VVRDRnVsbFllYXIoKSxrPWguZ2V0VVRDTW9udGgoKSxtPWguZ2V0VVRDRGF0ZSgpLHI9aC5nZXRVVENIb3VycygpLHQ9aC5nZXRVVENNaW51dGVzKCksdT1oLmdldFVUQ1NlY29uZHMoKSx2PWguZ2V0VVRDTWlsbGlzZWNvbmRzKCk7aD0oMD49anx8aj49MWU0PygwPmo/XCItXCI6XCIrXCIpK0goNiwwPmo/LWo6aik6SCg0LGopKStcIi1cIitIKDIsaysxKStcIi1cIitIKDIsbSkrXCJUXCIrSCgyLHIpK1wiOlwiK0goMix0KStcIjpcIitIKDIsdSkrXCIuXCIrSCgzLHYpK1wiWlwifWVsc2UgaD1udWxsO2lmKGMmJihoPWMuY2FsbChiLGEsaCkpLG51bGw9PT1oKXJldHVyblwibnVsbFwiO2lmKGk9cy5jYWxsKGgpLGk9PUEpcmV0dXJuXCJcIitoO2lmKGk9PXgpcmV0dXJuIGg+LTEvMCYmMS8wPmg/XCJcIitoOlwibnVsbFwiO2lmKGk9PXkpcmV0dXJuIEooXCJcIitoKTtpZihcIm9iamVjdFwiPT10eXBlb2YgaCl7Zm9yKEc9Zy5sZW5ndGg7Ry0tOylpZihnW0ddPT09aCl0aHJvdyBsKCk7aWYoZy5wdXNoKGgpLEI9W10sST1mLGYrPWUsaT09eil7Zm9yKEY9MCxHPWgubGVuZ3RoO0c+RjtGKyspRD1LKEYsaCxjLGQsZSxmLGcpLEIucHVzaChEPT09cT9cIm51bGxcIjpEKTtMPUIubGVuZ3RoP2U/XCJbXFxuXCIrZitCLmpvaW4oXCIsXFxuXCIrZikrXCJcXG5cIitJK1wiXVwiOlwiW1wiK0Iuam9pbihcIixcIikrXCJdXCI6XCJbXVwifWVsc2UgcChkfHxoLGZ1bmN0aW9uKGEpe3ZhciBiPUsoYSxoLGMsZCxlLGYsZyk7YiE9PXEmJkIucHVzaChKKGEpK1wiOlwiKyhlP1wiIFwiOlwiXCIpK2IpfSksTD1CLmxlbmd0aD9lP1wie1xcblwiK2YrQi5qb2luKFwiLFxcblwiK2YpK1wiXFxuXCIrSStcIn1cIjpcIntcIitCLmpvaW4oXCIsXCIpK1wifVwiOlwie31cIjtyZXR1cm4gZy5wb3AoKSxMfX07ZC5zdHJpbmdpZnk9ZnVuY3Rpb24oYSxiLGQpe3ZhciBlLGYsZyxoO2lmKGNbdHlwZW9mIGJdJiZiKWlmKChoPXMuY2FsbChiKSk9PXYpZj1iO2Vsc2UgaWYoaD09eil7Zz17fTtmb3IodmFyIGksaj0wLGs9Yi5sZW5ndGg7az5qO2k9YltqKytdLGg9cy5jYWxsKGkpLChoPT15fHxoPT14KSYmKGdbaV09MSkpO31pZihkKWlmKChoPXMuY2FsbChkKSk9PXgpe2lmKChkLT1kJTEpPjApZm9yKGU9XCJcIixkPjEwJiYoZD0xMCk7ZS5sZW5ndGg8ZDtlKz1cIiBcIik7fWVsc2UgaD09eSYmKGU9ZC5sZW5ndGg8PTEwP2Q6ZC5zbGljZSgwLDEwKSk7cmV0dXJuIEsoXCJcIiwoaT17fSxpW1wiXCJdPWEsaSksZixnLGUsXCJcIixbXSl9fWlmKCFmKFwianNvbi1wYXJzZVwiKSl7dmFyIEwsTSxOPWguZnJvbUNoYXJDb2RlLE89ezkyOlwiXFxcXFwiLDM0OidcIicsNDc6XCIvXCIsOTg6XCJcXGJcIiwxMTY6XCJcdFwiLDExMDpcIlxcblwiLDEwMjpcIlxcZlwiLDExNDpcIlxcclwifSxQPWZ1bmN0aW9uKCl7dGhyb3cgTD1NPW51bGwsaygpfSxRPWZ1bmN0aW9uKCl7Zm9yKHZhciBhLGIsYyxkLGUsZj1NLGc9Zi5sZW5ndGg7Zz5MOylzd2l0Y2goZT1mLmNoYXJDb2RlQXQoTCkpe2Nhc2UgOTpjYXNlIDEwOmNhc2UgMTM6Y2FzZSAzMjpMKys7YnJlYWs7Y2FzZSAxMjM6Y2FzZSAxMjU6Y2FzZSA5MTpjYXNlIDkzOmNhc2UgNTg6Y2FzZSA0NDpyZXR1cm4gYT1CP2YuY2hhckF0KEwpOmZbTF0sTCsrLGE7Y2FzZSAzNDpmb3IoYT1cIkBcIixMKys7Zz5MOylpZihlPWYuY2hhckNvZGVBdChMKSwzMj5lKVAoKTtlbHNlIGlmKDkyPT1lKXN3aXRjaChlPWYuY2hhckNvZGVBdCgrK0wpKXtjYXNlIDkyOmNhc2UgMzQ6XG5jYXNlIDQ3OmNhc2UgOTg6Y2FzZSAxMTY6Y2FzZSAxMTA6Y2FzZSAxMDI6Y2FzZSAxMTQ6YSs9T1tlXSxMKys7YnJlYWs7Y2FzZSAxMTc6Zm9yKGI9KytMLGM9TCs0O2M+TDtMKyspZT1mLmNoYXJDb2RlQXQoTCksZT49NDgmJjU3Pj1lfHxlPj05NyYmMTAyPj1lfHxlPj02NSYmNzA+PWV8fFAoKTthKz1OKFwiMHhcIitmLnNsaWNlKGIsTCkpO2JyZWFrO2RlZmF1bHQ6UCgpfWVsc2V7aWYoMzQ9PWUpYnJlYWs7Zm9yKGU9Zi5jaGFyQ29kZUF0KEwpLGI9TDtlPj0zMiYmOTIhPWUmJjM0IT1lOyllPWYuY2hhckNvZGVBdCgrK0wpO2ErPWYuc2xpY2UoYixMKX1pZigzND09Zi5jaGFyQ29kZUF0KEwpKXJldHVybiBMKyssYTtQKCk7ZGVmYXVsdDppZihiPUwsNDU9PWUmJihkPSEwLGU9Zi5jaGFyQ29kZUF0KCsrTCkpLGU+PTQ4JiY1Nz49ZSl7Zm9yKDQ4PT1lJiYoZT1mLmNoYXJDb2RlQXQoTCsxKSxlPj00OCYmNTc+PWUpJiZQKCksZD0hMTtnPkwmJihlPWYuY2hhckNvZGVBdChMKSxlPj00OCYmNTc+PWUpO0wrKyk7aWYoNDY9PWYuY2hhckNvZGVBdChMKSl7Zm9yKGM9KytMO2c+YyYmKGU9Zi5jaGFyQ29kZUF0KGMpLGU+PTQ4JiY1Nz49ZSk7YysrKTtjPT1MJiZQKCksTD1jfWlmKGU9Zi5jaGFyQ29kZUF0KEwpLDEwMT09ZXx8Njk9PWUpe2ZvcihlPWYuY2hhckNvZGVBdCgrK0wpLCg0Mz09ZXx8NDU9PWUpJiZMKyssYz1MO2c+YyYmKGU9Zi5jaGFyQ29kZUF0KGMpLGU+PTQ4JiY1Nz49ZSk7YysrKTtjPT1MJiZQKCksTD1jfXJldHVybitmLnNsaWNlKGIsTCl9aWYoZCYmUCgpLFwidHJ1ZVwiPT1mLnNsaWNlKEwsTCs0KSlyZXR1cm4gTCs9NCwhMDtpZihcImZhbHNlXCI9PWYuc2xpY2UoTCxMKzUpKXJldHVybiBMKz01LCExO2lmKFwibnVsbFwiPT1mLnNsaWNlKEwsTCs0KSlyZXR1cm4gTCs9NCxudWxsO1AoKX1yZXR1cm5cIiRcIn0sUj1mdW5jdGlvbihhKXt2YXIgYixjO2lmKFwiJFwiPT1hJiZQKCksXCJzdHJpbmdcIj09dHlwZW9mIGEpe2lmKFwiQFwiPT0oQj9hLmNoYXJBdCgwKTphWzBdKSlyZXR1cm4gYS5zbGljZSgxKTtpZihcIltcIj09YSl7Zm9yKGI9W107YT1RKCksXCJdXCIhPWE7Y3x8KGM9ITApKWMmJihcIixcIj09YT8oYT1RKCksXCJdXCI9PWEmJlAoKSk6UCgpKSxcIixcIj09YSYmUCgpLGIucHVzaChSKGEpKTtyZXR1cm4gYn1pZihcIntcIj09YSl7Zm9yKGI9e307YT1RKCksXCJ9XCIhPWE7Y3x8KGM9ITApKWMmJihcIixcIj09YT8oYT1RKCksXCJ9XCI9PWEmJlAoKSk6UCgpKSwoXCIsXCI9PWF8fFwic3RyaW5nXCIhPXR5cGVvZiBhfHxcIkBcIiE9KEI/YS5jaGFyQXQoMCk6YVswXSl8fFwiOlwiIT1RKCkpJiZQKCksYlthLnNsaWNlKDEpXT1SKFEoKSk7cmV0dXJuIGJ9UCgpfXJldHVybiBhfSxTPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1UKGEsYixjKTtkPT09cT9kZWxldGUgYVtiXTphW2JdPWR9LFQ9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGU9YVtiXTtpZihcIm9iamVjdFwiPT10eXBlb2YgZSYmZSlpZihzLmNhbGwoZSk9PXopZm9yKGQ9ZS5sZW5ndGg7ZC0tOylTKGUsZCxjKTtlbHNlIHAoZSxmdW5jdGlvbihhKXtTKGUsYSxjKX0pO3JldHVybiBjLmNhbGwoYSxiLGUpfTtkLnBhcnNlPWZ1bmN0aW9uKGEsYil7dmFyIGMsZDtyZXR1cm4gTD0wLE09XCJcIithLGM9UihRKCkpLFwiJFwiIT1RKCkmJlAoKSxMPU09bnVsbCxiJiZzLmNhbGwoYik9PXY/VCgoZD17fSxkW1wiXCJdPWMsZCksXCJcIixiKTpjfX19cmV0dXJuIGQucnVuSW5Db250ZXh0PWEsZH12YXIgYj1cImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQsYz17XCJmdW5jdGlvblwiOiEwLG9iamVjdDohMH0sZD1jW3R5cGVvZiBleHBvcnRzXSYmZXhwb3J0cyYmIWV4cG9ydHMubm9kZVR5cGUmJmV4cG9ydHMsZT1jW3R5cGVvZiB3aW5kb3ddJiZ3aW5kb3d8fHRoaXMsZj1kJiZjW3R5cGVvZiBtb2R1bGVdJiZtb2R1bGUmJiFtb2R1bGUubm9kZVR5cGUmJlwib2JqZWN0XCI9PXR5cGVvZiBnbG9iYWwmJmdsb2JhbDtpZighZnx8Zi5nbG9iYWwhPT1mJiZmLndpbmRvdyE9PWYmJmYuc2VsZiE9PWZ8fChlPWYpLGQmJiFiKWEoZSxkKTtlbHNle3ZhciBnPWUuSlNPTixoPWUuSlNPTjMsaT0hMSxqPWEoZSxlLkpTT04zPXtub0NvbmZsaWN0OmZ1bmN0aW9uKCl7cmV0dXJuIGl8fChpPSEwLGUuSlNPTj1nLGUuSlNPTjM9aCxnPWg9bnVsbCksan19KTtlLkpTT049e3BhcnNlOmoucGFyc2Usc3RyaW5naWZ5Omouc3RyaW5naWZ5fX1iJiZkZWZpbmUoZnVuY3Rpb24oKXtyZXR1cm4gan0pfS5jYWxsKHRoaXMpLGZ1bmN0aW9uKCl7dmFyIGE9e307YS5hcHBlbmRUb0hlYWQ9ZnVuY3Rpb24oYil7YS5nZXRIZWFkKCkuYXBwZW5kQ2hpbGQoYil9LGEuZ2V0SGVhZD1mdW5jdGlvbigpe3JldHVybiBkb2N1bWVudC5oZWFkfHxkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF19LGEuZ2V0Qm9keT1mdW5jdGlvbigpe3JldHVybiBkb2N1bWVudC5ib2R5fHxkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImJvZHlcIilbMF19LGNyZWF0ZWpzLkRvbVV0aWxzPWF9KCksZnVuY3Rpb24oKXt2YXIgYT17fTthLnBhcnNlWE1MPWZ1bmN0aW9uKGEsYil7dmFyIGM9bnVsbDt0cnl7aWYod2luZG93LkRPTVBhcnNlcil7dmFyIGQ9bmV3IERPTVBhcnNlcjtjPWQucGFyc2VGcm9tU3RyaW5nKGEsYil9fWNhdGNoKGUpe31pZighYyl0cnl7Yz1uZXcgQWN0aXZlWE9iamVjdChcIk1pY3Jvc29mdC5YTUxET01cIiksYy5hc3luYz0hMSxjLmxvYWRYTUwoYSl9Y2F0Y2goZSl7Yz1udWxsfXJldHVybiBjfSxhLnBhcnNlSlNPTj1mdW5jdGlvbihhKXtpZihudWxsPT1hKXJldHVybiBudWxsO3RyeXtyZXR1cm4gSlNPTi5wYXJzZShhKX1jYXRjaChiKXt0aHJvdyBifX0sY3JlYXRlanMuRGF0YVV0aWxzPWF9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt0aGlzLnNyYz1udWxsLHRoaXMudHlwZT1udWxsLHRoaXMuaWQ9bnVsbCx0aGlzLm1haW50YWluT3JkZXI9ITEsdGhpcy5jYWxsYmFjaz1udWxsLHRoaXMuZGF0YT1udWxsLHRoaXMubWV0aG9kPWNyZWF0ZWpzLkxvYWRJdGVtLkdFVCx0aGlzLnZhbHVlcz1udWxsLHRoaXMuaGVhZGVycz1udWxsLHRoaXMud2l0aENyZWRlbnRpYWxzPSExLHRoaXMubWltZVR5cGU9bnVsbCx0aGlzLmNyb3NzT3JpZ2luPW51bGwsdGhpcy5sb2FkVGltZW91dD1jLkxPQURfVElNRU9VVF9ERUZBVUxUfXZhciBiPWEucHJvdG90eXBlPXt9LGM9YTtjLkxPQURfVElNRU9VVF9ERUZBVUxUPThlMyxjLmNyZWF0ZT1mdW5jdGlvbihiKXtpZihcInN0cmluZ1wiPT10eXBlb2YgYil7dmFyIGQ9bmV3IGE7cmV0dXJuIGQuc3JjPWIsZH1pZihiIGluc3RhbmNlb2YgYylyZXR1cm4gYjtpZihiIGluc3RhbmNlb2YgT2JqZWN0JiZiLnNyYylyZXR1cm4gbnVsbD09Yi5sb2FkVGltZW91dCYmKGIubG9hZFRpbWVvdXQ9Yy5MT0FEX1RJTUVPVVRfREVGQVVMVCksYjt0aHJvdyBuZXcgRXJyb3IoXCJUeXBlIG5vdCByZWNvZ25pemVkLlwiKX0sYi5zZXQ9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiIGluIGEpdGhpc1tiXT1hW2JdO3JldHVybiB0aGlzfSxjcmVhdGVqcy5Mb2FkSXRlbT1jfSgpLGZ1bmN0aW9uKCl7dmFyIGE9e307YS5BQlNPTFVURV9QQVRUPS9eKD86XFx3KzopP1xcL3syfS9pLGEuUkVMQVRJVkVfUEFUVD0vXlsuXFwvXSo/XFwvL2ksYS5FWFRFTlNJT05fUEFUVD0vXFwvP1teXFwvXStcXC4oXFx3ezEsNX0pJC9pLGEucGFyc2VVUkk9ZnVuY3Rpb24oYil7dmFyIGM9e2Fic29sdXRlOiExLHJlbGF0aXZlOiExfTtpZihudWxsPT1iKXJldHVybiBjO3ZhciBkPWIuaW5kZXhPZihcIj9cIik7ZD4tMSYmKGI9Yi5zdWJzdHIoMCxkKSk7dmFyIGU7cmV0dXJuIGEuQUJTT0xVVEVfUEFUVC50ZXN0KGIpP2MuYWJzb2x1dGU9ITA6YS5SRUxBVElWRV9QQVRULnRlc3QoYikmJihjLnJlbGF0aXZlPSEwKSwoZT1iLm1hdGNoKGEuRVhURU5TSU9OX1BBVFQpKSYmKGMuZXh0ZW5zaW9uPWVbMV0udG9Mb3dlckNhc2UoKSksY30sYS5mb3JtYXRRdWVyeVN0cmluZz1mdW5jdGlvbihhLGIpe2lmKG51bGw9PWEpdGhyb3cgbmV3IEVycm9yKFwiWW91IG11c3Qgc3BlY2lmeSBkYXRhLlwiKTt2YXIgYz1bXTtmb3IodmFyIGQgaW4gYSljLnB1c2goZCtcIj1cIitlc2NhcGUoYVtkXSkpO3JldHVybiBiJiYoYz1jLmNvbmNhdChiKSksYy5qb2luKFwiJlwiKX0sYS5idWlsZFBhdGg9ZnVuY3Rpb24oYSxiKXtpZihudWxsPT1iKXJldHVybiBhO3ZhciBjPVtdLGQ9YS5pbmRleE9mKFwiP1wiKTtpZigtMSE9ZCl7dmFyIGU9YS5zbGljZShkKzEpO2M9Yy5jb25jYXQoZS5zcGxpdChcIiZcIikpfXJldHVybi0xIT1kP2Euc2xpY2UoMCxkKStcIj9cIit0aGlzLmZvcm1hdFF1ZXJ5U3RyaW5nKGIsYyk6YStcIj9cIit0aGlzLmZvcm1hdFF1ZXJ5U3RyaW5nKGIsYyl9LGEuaXNDcm9zc0RvbWFpbj1mdW5jdGlvbihhKXt2YXIgYj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtiLmhyZWY9YS5zcmM7dmFyIGM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7Yy5ocmVmPWxvY2F0aW9uLmhyZWY7dmFyIGQ9XCJcIiE9Yi5ob3N0bmFtZSYmKGIucG9ydCE9Yy5wb3J0fHxiLnByb3RvY29sIT1jLnByb3RvY29sfHxiLmhvc3RuYW1lIT1jLmhvc3RuYW1lKTtyZXR1cm4gZH0sYS5pc0xvY2FsPWZ1bmN0aW9uKGEpe3ZhciBiPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO3JldHVybiBiLmhyZWY9YS5zcmMsXCJcIj09Yi5ob3N0bmFtZSYmXCJmaWxlOlwiPT1iLnByb3RvY29sfSxhLmlzQmluYXJ5PWZ1bmN0aW9uKGEpe3N3aXRjaChhKXtjYXNlIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLklNQUdFOmNhc2UgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuQklOQVJZOnJldHVybiEwO2RlZmF1bHQ6cmV0dXJuITF9fSxhLmlzSW1hZ2VUYWc9ZnVuY3Rpb24oYSl7cmV0dXJuIGEgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50fSxhLmlzQXVkaW9UYWc9ZnVuY3Rpb24oYSl7cmV0dXJuIHdpbmRvdy5IVE1MQXVkaW9FbGVtZW50P2EgaW5zdGFuY2VvZiBIVE1MQXVkaW9FbGVtZW50OiExfSxhLmlzVmlkZW9UYWc9ZnVuY3Rpb24oYSl7cmV0dXJuIHdpbmRvdy5IVE1MVmlkZW9FbGVtZW50P2EgaW5zdGFuY2VvZiBIVE1MVmlkZW9FbGVtZW50OiExfSxhLmlzVGV4dD1mdW5jdGlvbihhKXtzd2l0Y2goYSl7Y2FzZSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5URVhUOmNhc2UgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSlNPTjpjYXNlIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLk1BTklGRVNUOmNhc2UgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuWE1MOmNhc2UgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuQ1NTOmNhc2UgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU1ZHOmNhc2UgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSkFWQVNDUklQVDpjYXNlIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNQUklURVNIRUVUOnJldHVybiEwO2RlZmF1bHQ6cmV0dXJuITF9fSxhLmdldFR5cGVCeUV4dGVuc2lvbj1mdW5jdGlvbihhKXtpZihudWxsPT1hKXJldHVybiBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5URVhUO3N3aXRjaChhLnRvTG93ZXJDYXNlKCkpe2Nhc2VcImpwZWdcIjpjYXNlXCJqcGdcIjpjYXNlXCJnaWZcIjpjYXNlXCJwbmdcIjpjYXNlXCJ3ZWJwXCI6Y2FzZVwiYm1wXCI6cmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLklNQUdFO2Nhc2VcIm9nZ1wiOmNhc2VcIm1wM1wiOmNhc2VcIndlYm1cIjpyZXR1cm4gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU09VTkQ7Y2FzZVwibXA0XCI6Y2FzZVwid2VibVwiOmNhc2VcInRzXCI6cmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlZJREVPO2Nhc2VcImpzb25cIjpyZXR1cm4gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSlNPTjtjYXNlXCJ4bWxcIjpyZXR1cm4gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuWE1MO2Nhc2VcImNzc1wiOnJldHVybiBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5DU1M7Y2FzZVwianNcIjpyZXR1cm4gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSkFWQVNDUklQVDtjYXNlXCJzdmdcIjpyZXR1cm4gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU1ZHO2RlZmF1bHQ6cmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlRFWFR9fSxjcmVhdGVqcy5SZXF1ZXN0VXRpbHM9YX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIsYyl7dGhpcy5FdmVudERpc3BhdGNoZXJfY29uc3RydWN0b3IoKSx0aGlzLmxvYWRlZD0hMSx0aGlzLmNhbmNlbGVkPSExLHRoaXMucHJvZ3Jlc3M9MCx0aGlzLnR5cGU9Yyx0aGlzLnJlc3VsdEZvcm1hdHRlcj1udWxsLGE/dGhpcy5faXRlbT1jcmVhdGVqcy5Mb2FkSXRlbS5jcmVhdGUoYSk6dGhpcy5faXRlbT1udWxsLHRoaXMuX3ByZWZlclhIUj1iLHRoaXMuX3Jlc3VsdD1udWxsLHRoaXMuX3Jhd1Jlc3VsdD1udWxsLHRoaXMuX2xvYWRlZEl0ZW1zPW51bGwsdGhpcy5fdGFnU3JjQXR0cmlidXRlPW51bGwsdGhpcy5fdGFnPW51bGx9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuRXZlbnREaXNwYXRjaGVyKSxjPWE7Yy5QT1NUPVwiUE9TVFwiLGMuR0VUPVwiR0VUXCIsYy5CSU5BUlk9XCJiaW5hcnlcIixjLkNTUz1cImNzc1wiLGMuSU1BR0U9XCJpbWFnZVwiLGMuSkFWQVNDUklQVD1cImphdmFzY3JpcHRcIixjLkpTT049XCJqc29uXCIsYy5KU09OUD1cImpzb25wXCIsYy5NQU5JRkVTVD1cIm1hbmlmZXN0XCIsYy5TT1VORD1cInNvdW5kXCIsYy5WSURFTz1cInZpZGVvXCIsYy5TUFJJVEVTSEVFVD1cInNwcml0ZXNoZWV0XCIsYy5TVkc9XCJzdmdcIixjLlRFWFQ9XCJ0ZXh0XCIsYy5YTUw9XCJ4bWxcIixiLmdldEl0ZW09ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5faXRlbX0sYi5nZXRSZXN1bHQ9ZnVuY3Rpb24oYSl7cmV0dXJuIGE/dGhpcy5fcmF3UmVzdWx0OnRoaXMuX3Jlc3VsdH0sYi5nZXRUYWc9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fdGFnfSxiLnNldFRhZz1mdW5jdGlvbihhKXt0aGlzLl90YWc9YX0sYi5sb2FkPWZ1bmN0aW9uKCl7dGhpcy5fY3JlYXRlUmVxdWVzdCgpLHRoaXMuX3JlcXVlc3Qub24oXCJjb21wbGV0ZVwiLHRoaXMsdGhpcyksdGhpcy5fcmVxdWVzdC5vbihcInByb2dyZXNzXCIsdGhpcyx0aGlzKSx0aGlzLl9yZXF1ZXN0Lm9uKFwibG9hZFN0YXJ0XCIsdGhpcyx0aGlzKSx0aGlzLl9yZXF1ZXN0Lm9uKFwiYWJvcnRcIix0aGlzLHRoaXMpLHRoaXMuX3JlcXVlc3Qub24oXCJ0aW1lb3V0XCIsdGhpcyx0aGlzKSx0aGlzLl9yZXF1ZXN0Lm9uKFwiZXJyb3JcIix0aGlzLHRoaXMpO3ZhciBhPW5ldyBjcmVhdGVqcy5FdmVudChcImluaXRpYWxpemVcIik7YS5sb2FkZXI9dGhpcy5fcmVxdWVzdCx0aGlzLmRpc3BhdGNoRXZlbnQoYSksdGhpcy5fcmVxdWVzdC5sb2FkKCl9LGIuY2FuY2VsPWZ1bmN0aW9uKCl7dGhpcy5jYW5jZWxlZD0hMCx0aGlzLmRlc3Ryb3koKX0sYi5kZXN0cm95PWZ1bmN0aW9uKCl7dGhpcy5fcmVxdWVzdCYmKHRoaXMuX3JlcXVlc3QucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnMoKSx0aGlzLl9yZXF1ZXN0LmRlc3Ryb3koKSksdGhpcy5fcmVxdWVzdD1udWxsLHRoaXMuX2l0ZW09bnVsbCx0aGlzLl9yYXdSZXN1bHQ9bnVsbCx0aGlzLl9yZXN1bHQ9bnVsbCx0aGlzLl9sb2FkSXRlbXM9bnVsbCx0aGlzLnJlbW92ZUFsbEV2ZW50TGlzdGVuZXJzKCl9LGIuZ2V0TG9hZGVkSXRlbXM9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbG9hZGVkSXRlbXN9LGIuX2NyZWF0ZVJlcXVlc3Q9ZnVuY3Rpb24oKXt0aGlzLl9wcmVmZXJYSFI/dGhpcy5fcmVxdWVzdD1uZXcgY3JlYXRlanMuWEhSUmVxdWVzdCh0aGlzLl9pdGVtKTp0aGlzLl9yZXF1ZXN0PW5ldyBjcmVhdGVqcy5UYWdSZXF1ZXN0KHRoaXMuX2l0ZW0sdGhpcy5fdGFnfHx0aGlzLl9jcmVhdGVUYWcoKSx0aGlzLl90YWdTcmNBdHRyaWJ1dGUpfSxiLl9jcmVhdGVUYWc9ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGx9LGIuX3NlbmRMb2FkU3RhcnQ9ZnVuY3Rpb24oKXt0aGlzLl9pc0NhbmNlbGVkKCl8fHRoaXMuZGlzcGF0Y2hFdmVudChcImxvYWRzdGFydFwiKX0sYi5fc2VuZFByb2dyZXNzPWZ1bmN0aW9uKGEpe2lmKCF0aGlzLl9pc0NhbmNlbGVkKCkpe3ZhciBiPW51bGw7XCJudW1iZXJcIj09dHlwZW9mIGE/KHRoaXMucHJvZ3Jlc3M9YSxiPW5ldyBjcmVhdGVqcy5Qcm9ncmVzc0V2ZW50KHRoaXMucHJvZ3Jlc3MpKTooYj1hLHRoaXMucHJvZ3Jlc3M9YS5sb2FkZWQvYS50b3RhbCxiLnByb2dyZXNzPXRoaXMucHJvZ3Jlc3MsKGlzTmFOKHRoaXMucHJvZ3Jlc3MpfHx0aGlzLnByb2dyZXNzPT0xLzApJiYodGhpcy5wcm9ncmVzcz0wKSksdGhpcy5oYXNFdmVudExpc3RlbmVyKFwicHJvZ3Jlc3NcIikmJnRoaXMuZGlzcGF0Y2hFdmVudChiKX19LGIuX3NlbmRDb21wbGV0ZT1mdW5jdGlvbigpe2lmKCF0aGlzLl9pc0NhbmNlbGVkKCkpe3RoaXMubG9hZGVkPSEwO3ZhciBhPW5ldyBjcmVhdGVqcy5FdmVudChcImNvbXBsZXRlXCIpO2EucmF3UmVzdWx0PXRoaXMuX3Jhd1Jlc3VsdCxudWxsIT10aGlzLl9yZXN1bHQmJihhLnJlc3VsdD10aGlzLl9yZXN1bHQpLHRoaXMuZGlzcGF0Y2hFdmVudChhKX19LGIuX3NlbmRFcnJvcj1mdW5jdGlvbihhKXshdGhpcy5faXNDYW5jZWxlZCgpJiZ0aGlzLmhhc0V2ZW50TGlzdGVuZXIoXCJlcnJvclwiKSYmKG51bGw9PWEmJihhPW5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwiUFJFTE9BRF9FUlJPUl9FTVBUWVwiKSksdGhpcy5kaXNwYXRjaEV2ZW50KGEpKX0sYi5faXNDYW5jZWxlZD1mdW5jdGlvbigpe3JldHVybiBudWxsPT13aW5kb3cuY3JlYXRlanN8fHRoaXMuY2FuY2VsZWQ/ITA6ITF9LGIucmVzdWx0Rm9ybWF0dGVyPW51bGwsYi5oYW5kbGVFdmVudD1mdW5jdGlvbihhKXtzd2l0Y2goYS50eXBlKXtjYXNlXCJjb21wbGV0ZVwiOnRoaXMuX3Jhd1Jlc3VsdD1hLnRhcmdldC5fcmVzcG9uc2U7dmFyIGI9dGhpcy5yZXN1bHRGb3JtYXR0ZXImJnRoaXMucmVzdWx0Rm9ybWF0dGVyKHRoaXMpO2IgaW5zdGFuY2VvZiBGdW5jdGlvbj9iLmNhbGwodGhpcyxjcmVhdGVqcy5wcm94eSh0aGlzLl9yZXN1bHRGb3JtYXRTdWNjZXNzLHRoaXMpLGNyZWF0ZWpzLnByb3h5KHRoaXMuX3Jlc3VsdEZvcm1hdEZhaWxlZCx0aGlzKSk6KHRoaXMuX3Jlc3VsdD1ifHx0aGlzLl9yYXdSZXN1bHQsdGhpcy5fc2VuZENvbXBsZXRlKCkpO2JyZWFrO2Nhc2VcInByb2dyZXNzXCI6dGhpcy5fc2VuZFByb2dyZXNzKGEpO2JyZWFrO2Nhc2VcImVycm9yXCI6dGhpcy5fc2VuZEVycm9yKGEpO2JyZWFrO2Nhc2VcImxvYWRzdGFydFwiOnRoaXMuX3NlbmRMb2FkU3RhcnQoKTticmVhaztjYXNlXCJhYm9ydFwiOmNhc2VcInRpbWVvdXRcIjp0aGlzLl9pc0NhbmNlbGVkKCl8fHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgY3JlYXRlanMuRXJyb3JFdmVudChcIlBSRUxPQURfXCIrYS50eXBlLnRvVXBwZXJDYXNlKCkrXCJfRVJST1JcIikpfX0sYi5fcmVzdWx0Rm9ybWF0U3VjY2Vzcz1mdW5jdGlvbihhKXt0aGlzLl9yZXN1bHQ9YSx0aGlzLl9zZW5kQ29tcGxldGUoKX0sYi5fcmVzdWx0Rm9ybWF0RmFpbGVkPWZ1bmN0aW9uKGEpe3RoaXMuX3NlbmRFcnJvcihhKX0sYi5idWlsZFBhdGg9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gY3JlYXRlanMuUmVxdWVzdFV0aWxzLmJ1aWxkUGF0aChhLGIpfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbUHJlbG9hZEpTIEFic3RyYWN0TG9hZGVyXVwifSxjcmVhdGVqcy5BYnN0cmFjdExvYWRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJFdmVudERpc3BhdGNoZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiLGMpe3RoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSxiLGMpLHRoaXMucmVzdWx0Rm9ybWF0dGVyPXRoaXMuX2Zvcm1hdFJlc3VsdCx0aGlzLl90YWdTcmNBdHRyaWJ1dGU9XCJzcmNcIix0aGlzLm9uKFwiaW5pdGlhbGl6ZVwiLHRoaXMuX3VwZGF0ZVhIUix0aGlzKX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5BYnN0cmFjdExvYWRlcik7Yi5sb2FkPWZ1bmN0aW9uKCl7dGhpcy5fdGFnfHwodGhpcy5fdGFnPXRoaXMuX2NyZWF0ZVRhZyh0aGlzLl9pdGVtLnNyYykpLHRoaXMuX3RhZy5wcmVsb2FkPVwiYXV0b1wiLHRoaXMuX3RhZy5sb2FkKCksdGhpcy5BYnN0cmFjdExvYWRlcl9sb2FkKCl9LGIuX2NyZWF0ZVRhZz1mdW5jdGlvbigpe30sYi5fY3JlYXRlUmVxdWVzdD1mdW5jdGlvbigpe3RoaXMuX3ByZWZlclhIUj90aGlzLl9yZXF1ZXN0PW5ldyBjcmVhdGVqcy5YSFJSZXF1ZXN0KHRoaXMuX2l0ZW0pOnRoaXMuX3JlcXVlc3Q9bmV3IGNyZWF0ZWpzLk1lZGlhVGFnUmVxdWVzdCh0aGlzLl9pdGVtLHRoaXMuX3RhZ3x8dGhpcy5fY3JlYXRlVGFnKCksdGhpcy5fdGFnU3JjQXR0cmlidXRlKX0sYi5fdXBkYXRlWEhSPWZ1bmN0aW9uKGEpe2EubG9hZGVyLnNldFJlc3BvbnNlVHlwZSYmYS5sb2FkZXIuc2V0UmVzcG9uc2VUeXBlKFwiYmxvYlwiKX0sYi5fZm9ybWF0UmVzdWx0PWZ1bmN0aW9uKGEpe2lmKHRoaXMuX3RhZy5yZW1vdmVFdmVudExpc3RlbmVyJiZ0aGlzLl90YWcucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNhbnBsYXl0aHJvdWdoXCIsdGhpcy5fbG9hZGVkSGFuZGxlciksdGhpcy5fdGFnLm9uc3RhbGxlZD1udWxsLHRoaXMuX3ByZWZlclhIUil7dmFyIGI9d2luZG93LlVSTHx8d2luZG93LndlYmtpdFVSTCxjPWEuZ2V0UmVzdWx0KCEwKTthLmdldFRhZygpLnNyYz1iLmNyZWF0ZU9iamVjdFVSTChjKX1yZXR1cm4gYS5nZXRUYWcoKX0sY3JlYXRlanMuQWJzdHJhY3RNZWRpYUxvYWRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdExvYWRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7dmFyIGE9ZnVuY3Rpb24oYSl7dGhpcy5faXRlbT1hfSxiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkV2ZW50RGlzcGF0Y2hlcik7Yi5sb2FkPWZ1bmN0aW9uKCl7fSxiLmRlc3Ryb3k9ZnVuY3Rpb24oKXt9LGIuY2FuY2VsPWZ1bmN0aW9uKCl7fSxjcmVhdGVqcy5BYnN0cmFjdFJlcXVlc3Q9Y3JlYXRlanMucHJvbW90ZShhLFwiRXZlbnREaXNwYXRjaGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjKXt0aGlzLkFic3RyYWN0UmVxdWVzdF9jb25zdHJ1Y3RvcihhKSx0aGlzLl90YWc9Yix0aGlzLl90YWdTcmNBdHRyaWJ1dGU9Yyx0aGlzLl9sb2FkZWRIYW5kbGVyPWNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVRhZ0NvbXBsZXRlLHRoaXMpLHRoaXMuX2FkZGVkVG9ET009ITEsdGhpcy5fc3RhcnRUYWdWaXNpYmlsaXR5PW51bGx9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RSZXF1ZXN0KTtiLmxvYWQ9ZnVuY3Rpb24oKXt0aGlzLl90YWcub25sb2FkPWNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVRhZ0NvbXBsZXRlLHRoaXMpLHRoaXMuX3RhZy5vbnJlYWR5c3RhdGVjaGFuZ2U9Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZSx0aGlzKSx0aGlzLl90YWcub25lcnJvcj1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVFcnJvcix0aGlzKTt2YXIgYT1uZXcgY3JlYXRlanMuRXZlbnQoXCJpbml0aWFsaXplXCIpO2EubG9hZGVyPXRoaXMuX3RhZyx0aGlzLmRpc3BhdGNoRXZlbnQoYSksdGhpcy5faGlkZVRhZygpLHRoaXMuX2xvYWRUaW1lb3V0PXNldFRpbWVvdXQoY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGltZW91dCx0aGlzKSx0aGlzLl9pdGVtLmxvYWRUaW1lb3V0KSx0aGlzLl90YWdbdGhpcy5fdGFnU3JjQXR0cmlidXRlXT10aGlzLl9pdGVtLnNyYyxudWxsPT10aGlzLl90YWcucGFyZW50Tm9kZSYmKHdpbmRvdy5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuX3RhZyksdGhpcy5fYWRkZWRUb0RPTT0hMCl9LGIuZGVzdHJveT1mdW5jdGlvbigpe3RoaXMuX2NsZWFuKCksdGhpcy5fdGFnPW51bGwsdGhpcy5BYnN0cmFjdFJlcXVlc3RfZGVzdHJveSgpfSxiLl9oYW5kbGVSZWFkeVN0YXRlQ2hhbmdlPWZ1bmN0aW9uKCl7Y2xlYXJUaW1lb3V0KHRoaXMuX2xvYWRUaW1lb3V0KTt2YXIgYT10aGlzLl90YWc7KFwibG9hZGVkXCI9PWEucmVhZHlTdGF0ZXx8XCJjb21wbGV0ZVwiPT1hLnJlYWR5U3RhdGUpJiZ0aGlzLl9oYW5kbGVUYWdDb21wbGV0ZSgpfSxiLl9oYW5kbGVFcnJvcj1mdW5jdGlvbigpe3RoaXMuX2NsZWFuKCksdGhpcy5kaXNwYXRjaEV2ZW50KFwiZXJyb3JcIil9LGIuX2hhbmRsZVRhZ0NvbXBsZXRlPWZ1bmN0aW9uKCl7dGhpcy5fcmF3UmVzdWx0PXRoaXMuX3RhZyx0aGlzLl9yZXN1bHQ9dGhpcy5yZXN1bHRGb3JtYXR0ZXImJnRoaXMucmVzdWx0Rm9ybWF0dGVyKHRoaXMpfHx0aGlzLl9yYXdSZXN1bHQsdGhpcy5fY2xlYW4oKSx0aGlzLl9zaG93VGFnKCksdGhpcy5kaXNwYXRjaEV2ZW50KFwiY29tcGxldGVcIil9LGIuX2hhbmRsZVRpbWVvdXQ9ZnVuY3Rpb24oKXt0aGlzLl9jbGVhbigpLHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgY3JlYXRlanMuRXZlbnQoXCJ0aW1lb3V0XCIpKX0sYi5fY2xlYW49ZnVuY3Rpb24oKXt0aGlzLl90YWcub25sb2FkPW51bGwsdGhpcy5fdGFnLm9ucmVhZHlzdGF0ZWNoYW5nZT1udWxsLHRoaXMuX3RhZy5vbmVycm9yPW51bGwsdGhpcy5fYWRkZWRUb0RPTSYmbnVsbCE9dGhpcy5fdGFnLnBhcmVudE5vZGUmJnRoaXMuX3RhZy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuX3RhZyksY2xlYXJUaW1lb3V0KHRoaXMuX2xvYWRUaW1lb3V0KX0sYi5faGlkZVRhZz1mdW5jdGlvbigpe3RoaXMuX3N0YXJ0VGFnVmlzaWJpbGl0eT10aGlzLl90YWcuc3R5bGUudmlzaWJpbGl0eSx0aGlzLl90YWcuc3R5bGUudmlzaWJpbGl0eT1cImhpZGRlblwifSxiLl9zaG93VGFnPWZ1bmN0aW9uKCl7dGhpcy5fdGFnLnN0eWxlLnZpc2liaWxpdHk9dGhpcy5fc3RhcnRUYWdWaXNpYmlsaXR5fSxiLl9oYW5kbGVTdGFsbGVkPWZ1bmN0aW9uKCl7fSxjcmVhdGVqcy5UYWdSZXF1ZXN0PWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0UmVxdWVzdFwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIsYyl7dGhpcy5BYnN0cmFjdFJlcXVlc3RfY29uc3RydWN0b3IoYSksdGhpcy5fdGFnPWIsdGhpcy5fdGFnU3JjQXR0cmlidXRlPWMsdGhpcy5fbG9hZGVkSGFuZGxlcj1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVUYWdDb21wbGV0ZSx0aGlzKX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5UYWdSZXF1ZXN0KTtiLmxvYWQ9ZnVuY3Rpb24oKXt2YXIgYT1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVTdGFsbGVkLHRoaXMpO3RoaXMuX3N0YWxsZWRDYWxsYmFjaz1hO3ZhciBiPWNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVByb2dyZXNzLHRoaXMpO3RoaXMuX2hhbmRsZVByb2dyZXNzPWIsdGhpcy5fdGFnLmFkZEV2ZW50TGlzdGVuZXIoXCJzdGFsbGVkXCIsYSksdGhpcy5fdGFnLmFkZEV2ZW50TGlzdGVuZXIoXCJwcm9ncmVzc1wiLGIpLHRoaXMuX3RhZy5hZGRFdmVudExpc3RlbmVyJiZ0aGlzLl90YWcuYWRkRXZlbnRMaXN0ZW5lcihcImNhbnBsYXl0aHJvdWdoXCIsdGhpcy5fbG9hZGVkSGFuZGxlciwhMSksdGhpcy5UYWdSZXF1ZXN0X2xvYWQoKX0sYi5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZT1mdW5jdGlvbigpe2NsZWFyVGltZW91dCh0aGlzLl9sb2FkVGltZW91dCk7dmFyIGE9dGhpcy5fdGFnOyhcImxvYWRlZFwiPT1hLnJlYWR5U3RhdGV8fFwiY29tcGxldGVcIj09YS5yZWFkeVN0YXRlKSYmdGhpcy5faGFuZGxlVGFnQ29tcGxldGUoKX0sYi5faGFuZGxlU3RhbGxlZD1mdW5jdGlvbigpe30sYi5faGFuZGxlUHJvZ3Jlc3M9ZnVuY3Rpb24oYSl7aWYoYSYmIShhLmxvYWRlZD4wJiYwPT1hLnRvdGFsKSl7dmFyIGI9bmV3IGNyZWF0ZWpzLlByb2dyZXNzRXZlbnQoYS5sb2FkZWQsYS50b3RhbCk7dGhpcy5kaXNwYXRjaEV2ZW50KGIpfX0sYi5fY2xlYW49ZnVuY3Rpb24oKXt0aGlzLl90YWcucmVtb3ZlRXZlbnRMaXN0ZW5lciYmdGhpcy5fdGFnLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjYW5wbGF5dGhyb3VnaFwiLHRoaXMuX2xvYWRlZEhhbmRsZXIpLHRoaXMuX3RhZy5yZW1vdmVFdmVudExpc3RlbmVyKFwic3RhbGxlZFwiLHRoaXMuX3N0YWxsZWRDYWxsYmFjayksdGhpcy5fdGFnLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwcm9ncmVzc1wiLHRoaXMuX3Byb2dyZXNzQ2FsbGJhY2spLHRoaXMuVGFnUmVxdWVzdF9fY2xlYW4oKX0sY3JlYXRlanMuTWVkaWFUYWdSZXF1ZXN0PWNyZWF0ZWpzLnByb21vdGUoYSxcIlRhZ1JlcXVlc3RcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSl7dGhpcy5BYnN0cmFjdFJlcXVlc3RfY29uc3RydWN0b3IoYSksdGhpcy5fcmVxdWVzdD1udWxsLHRoaXMuX2xvYWRUaW1lb3V0PW51bGwsdGhpcy5feGhyTGV2ZWw9MSx0aGlzLl9yZXNwb25zZT1udWxsLHRoaXMuX3Jhd1Jlc3BvbnNlPW51bGwsdGhpcy5fY2FuY2VsZWQ9ITEsdGhpcy5faGFuZGxlTG9hZFN0YXJ0UHJveHk9Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlTG9hZFN0YXJ0LHRoaXMpLHRoaXMuX2hhbmRsZVByb2dyZXNzUHJveHk9Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlUHJvZ3Jlc3MsdGhpcyksdGhpcy5faGFuZGxlQWJvcnRQcm94eT1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVBYm9ydCx0aGlzKSx0aGlzLl9oYW5kbGVFcnJvclByb3h5PWNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUVycm9yLHRoaXMpLHRoaXMuX2hhbmRsZVRpbWVvdXRQcm94eT1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVUaW1lb3V0LHRoaXMpLHRoaXMuX2hhbmRsZUxvYWRQcm94eT1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVMb2FkLHRoaXMpLHRoaXMuX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2VQcm94eT1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVSZWFkeVN0YXRlQ2hhbmdlLHRoaXMpLCF0aGlzLl9jcmVhdGVYSFIoYSl9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RSZXF1ZXN0KTthLkFDVElWRVhfVkVSU0lPTlM9W1wiTXN4bWwyLlhNTEhUVFAuNi4wXCIsXCJNc3htbDIuWE1MSFRUUC41LjBcIixcIk1zeG1sMi5YTUxIVFRQLjQuMFwiLFwiTVNYTUwyLlhNTEhUVFAuMy4wXCIsXCJNU1hNTDIuWE1MSFRUUFwiLFwiTWljcm9zb2Z0LlhNTEhUVFBcIl0sYi5nZXRSZXN1bHQ9ZnVuY3Rpb24oYSl7cmV0dXJuIGEmJnRoaXMuX3Jhd1Jlc3BvbnNlP3RoaXMuX3Jhd1Jlc3BvbnNlOnRoaXMuX3Jlc3BvbnNlfSxiLmNhbmNlbD1mdW5jdGlvbigpe3RoaXMuY2FuY2VsZWQ9ITAsdGhpcy5fY2xlYW4oKSx0aGlzLl9yZXF1ZXN0LmFib3J0KCl9LGIubG9hZD1mdW5jdGlvbigpe2lmKG51bGw9PXRoaXMuX3JlcXVlc3QpcmV0dXJuIHZvaWQgdGhpcy5faGFuZGxlRXJyb3IoKTtudWxsIT10aGlzLl9yZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXI/KHRoaXMuX3JlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRzdGFydFwiLHRoaXMuX2hhbmRsZUxvYWRTdGFydFByb3h5LCExKSx0aGlzLl9yZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJwcm9ncmVzc1wiLHRoaXMuX2hhbmRsZVByb2dyZXNzUHJveHksITEpLHRoaXMuX3JlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcihcImFib3J0XCIsdGhpcy5faGFuZGxlQWJvcnRQcm94eSwhMSksdGhpcy5fcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIix0aGlzLl9oYW5kbGVFcnJvclByb3h5LCExKSx0aGlzLl9yZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJ0aW1lb3V0XCIsdGhpcy5faGFuZGxlVGltZW91dFByb3h5LCExKSx0aGlzLl9yZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsdGhpcy5faGFuZGxlTG9hZFByb3h5LCExKSx0aGlzLl9yZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJyZWFkeXN0YXRlY2hhbmdlXCIsdGhpcy5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZVByb3h5LCExKSk6KHRoaXMuX3JlcXVlc3Qub25sb2Fkc3RhcnQ9dGhpcy5faGFuZGxlTG9hZFN0YXJ0UHJveHksdGhpcy5fcmVxdWVzdC5vbnByb2dyZXNzPXRoaXMuX2hhbmRsZVByb2dyZXNzUHJveHksdGhpcy5fcmVxdWVzdC5vbmFib3J0PXRoaXMuX2hhbmRsZUFib3J0UHJveHksdGhpcy5fcmVxdWVzdC5vbmVycm9yPXRoaXMuX2hhbmRsZUVycm9yUHJveHksdGhpcy5fcmVxdWVzdC5vbnRpbWVvdXQ9dGhpcy5faGFuZGxlVGltZW91dFByb3h5LHRoaXMuX3JlcXVlc3Qub25sb2FkPXRoaXMuX2hhbmRsZUxvYWRQcm94eSx0aGlzLl9yZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZT10aGlzLl9oYW5kbGVSZWFkeVN0YXRlQ2hhbmdlUHJveHkpLDE9PXRoaXMuX3hockxldmVsJiYodGhpcy5fbG9hZFRpbWVvdXQ9c2V0VGltZW91dChjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVUaW1lb3V0LHRoaXMpLHRoaXMuX2l0ZW0ubG9hZFRpbWVvdXQpKTt0cnl7dGhpcy5faXRlbS52YWx1ZXMmJnRoaXMuX2l0ZW0ubWV0aG9kIT1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5HRVQ/dGhpcy5faXRlbS5tZXRob2Q9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlBPU1QmJnRoaXMuX3JlcXVlc3Quc2VuZChjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuZm9ybWF0UXVlcnlTdHJpbmcodGhpcy5faXRlbS52YWx1ZXMpKTp0aGlzLl9yZXF1ZXN0LnNlbmQoKX1jYXRjaChhKXt0aGlzLmRpc3BhdGNoRXZlbnQobmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJYSFJfU0VORFwiLG51bGwsYSkpfX0sYi5zZXRSZXNwb25zZVR5cGU9ZnVuY3Rpb24oYSl7XCJibG9iXCI9PT1hJiYoYT13aW5kb3cuVVJMP1wiYmxvYlwiOlwiYXJyYXlidWZmZXJcIix0aGlzLl9yZXNwb25zZVR5cGU9YSksdGhpcy5fcmVxdWVzdC5yZXNwb25zZVR5cGU9YX0sYi5nZXRBbGxSZXNwb25zZUhlYWRlcnM9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcmVxdWVzdC5nZXRBbGxSZXNwb25zZUhlYWRlcnMgaW5zdGFuY2VvZiBGdW5jdGlvbj90aGlzLl9yZXF1ZXN0LmdldEFsbFJlc3BvbnNlSGVhZGVycygpOm51bGx9LGIuZ2V0UmVzcG9uc2VIZWFkZXI9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX3JlcXVlc3QuZ2V0UmVzcG9uc2VIZWFkZXIgaW5zdGFuY2VvZiBGdW5jdGlvbj90aGlzLl9yZXF1ZXN0LmdldFJlc3BvbnNlSGVhZGVyKGEpOm51bGx9LGIuX2hhbmRsZVByb2dyZXNzPWZ1bmN0aW9uKGEpe2lmKGEmJiEoYS5sb2FkZWQ+MCYmMD09YS50b3RhbCkpe3ZhciBiPW5ldyBjcmVhdGVqcy5Qcm9ncmVzc0V2ZW50KGEubG9hZGVkLGEudG90YWwpO3RoaXMuZGlzcGF0Y2hFdmVudChiKX19LGIuX2hhbmRsZUxvYWRTdGFydD1mdW5jdGlvbihhKXtjbGVhclRpbWVvdXQodGhpcy5fbG9hZFRpbWVvdXQpLHRoaXMuZGlzcGF0Y2hFdmVudChcImxvYWRzdGFydFwiKX0sYi5faGFuZGxlQWJvcnQ9ZnVuY3Rpb24oYSl7dGhpcy5fY2xlYW4oKSx0aGlzLmRpc3BhdGNoRXZlbnQobmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJYSFJfQUJPUlRFRFwiLG51bGwsYSkpfSxiLl9oYW5kbGVFcnJvcj1mdW5jdGlvbihhKXt0aGlzLl9jbGVhbigpLHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgY3JlYXRlanMuRXJyb3JFdmVudChhLm1lc3NhZ2UpKX0sYi5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZT1mdW5jdGlvbihhKXs0PT10aGlzLl9yZXF1ZXN0LnJlYWR5U3RhdGUmJnRoaXMuX2hhbmRsZUxvYWQoKX0sYi5faGFuZGxlTG9hZD1mdW5jdGlvbihhKXtpZighdGhpcy5sb2FkZWQpe3RoaXMubG9hZGVkPSEwO3ZhciBiPXRoaXMuX2NoZWNrRXJyb3IoKTtpZihiKXJldHVybiB2b2lkIHRoaXMuX2hhbmRsZUVycm9yKGIpO2lmKHRoaXMuX3Jlc3BvbnNlPXRoaXMuX2dldFJlc3BvbnNlKCksXCJhcnJheWJ1ZmZlclwiPT09dGhpcy5fcmVzcG9uc2VUeXBlKXRyeXt0aGlzLl9yZXNwb25zZT1uZXcgQmxvYihbdGhpcy5fcmVzcG9uc2VdKX1jYXRjaChjKXtpZih3aW5kb3cuQmxvYkJ1aWxkZXI9d2luZG93LkJsb2JCdWlsZGVyfHx3aW5kb3cuV2ViS2l0QmxvYkJ1aWxkZXJ8fHdpbmRvdy5Nb3pCbG9iQnVpbGRlcnx8d2luZG93Lk1TQmxvYkJ1aWxkZXIsXCJUeXBlRXJyb3JcIj09PWMubmFtZSYmd2luZG93LkJsb2JCdWlsZGVyKXt2YXIgZD1uZXcgQmxvYkJ1aWxkZXI7ZC5hcHBlbmQodGhpcy5fcmVzcG9uc2UpLHRoaXMuX3Jlc3BvbnNlPWQuZ2V0QmxvYigpfX10aGlzLl9jbGVhbigpLHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgY3JlYXRlanMuRXZlbnQoXCJjb21wbGV0ZVwiKSl9fSxiLl9oYW5kbGVUaW1lb3V0PWZ1bmN0aW9uKGEpe3RoaXMuX2NsZWFuKCksdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwiUFJFTE9BRF9USU1FT1VUXCIsbnVsbCxhKSl9LGIuX2NoZWNrRXJyb3I9ZnVuY3Rpb24oKXt2YXIgYT1wYXJzZUludCh0aGlzLl9yZXF1ZXN0LnN0YXR1cyk7c3dpdGNoKGEpe2Nhc2UgNDA0OmNhc2UgMDpyZXR1cm4gbmV3IEVycm9yKGEpfXJldHVybiBudWxsfSxiLl9nZXRSZXNwb25zZT1mdW5jdGlvbigpe2lmKG51bGwhPXRoaXMuX3Jlc3BvbnNlKXJldHVybiB0aGlzLl9yZXNwb25zZTtpZihudWxsIT10aGlzLl9yZXF1ZXN0LnJlc3BvbnNlKXJldHVybiB0aGlzLl9yZXF1ZXN0LnJlc3BvbnNlO3RyeXtpZihudWxsIT10aGlzLl9yZXF1ZXN0LnJlc3BvbnNlVGV4dClyZXR1cm4gdGhpcy5fcmVxdWVzdC5yZXNwb25zZVRleHR9Y2F0Y2goYSl7fXRyeXtpZihudWxsIT10aGlzLl9yZXF1ZXN0LnJlc3BvbnNlWE1MKXJldHVybiB0aGlzLl9yZXF1ZXN0LnJlc3BvbnNlWE1MfWNhdGNoKGEpe31yZXR1cm4gbnVsbH0sYi5fY3JlYXRlWEhSPWZ1bmN0aW9uKGEpe3ZhciBiPWNyZWF0ZWpzLlJlcXVlc3RVdGlscy5pc0Nyb3NzRG9tYWluKGEpLGM9e30sZD1udWxsO2lmKHdpbmRvdy5YTUxIdHRwUmVxdWVzdClkPW5ldyBYTUxIdHRwUmVxdWVzdCxiJiZ2b2lkIDA9PT1kLndpdGhDcmVkZW50aWFscyYmd2luZG93LlhEb21haW5SZXF1ZXN0JiYoZD1uZXcgWERvbWFpblJlcXVlc3QpO2Vsc2V7Zm9yKHZhciBlPTAsZj1zLkFDVElWRVhfVkVSU0lPTlMubGVuZ3RoO2Y+ZTtlKyspe3ZhciBnPXMuQUNUSVZFWF9WRVJTSU9OU1tlXTt0cnl7ZD1uZXcgQWN0aXZlWE9iamVjdChnKTticmVha31jYXRjaChoKXt9fWlmKG51bGw9PWQpcmV0dXJuITF9bnVsbD09YS5taW1lVHlwZSYmY3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzVGV4dChhLnR5cGUpJiYoYS5taW1lVHlwZT1cInRleHQvcGxhaW47IGNoYXJzZXQ9dXRmLThcIiksYS5taW1lVHlwZSYmZC5vdmVycmlkZU1pbWVUeXBlJiZkLm92ZXJyaWRlTWltZVR5cGUoYS5taW1lVHlwZSksdGhpcy5feGhyTGV2ZWw9XCJzdHJpbmdcIj09dHlwZW9mIGQucmVzcG9uc2VUeXBlPzI6MTt2YXIgaT1udWxsO2lmKGk9YS5tZXRob2Q9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkdFVD9jcmVhdGVqcy5SZXF1ZXN0VXRpbHMuYnVpbGRQYXRoKGEuc3JjLGEudmFsdWVzKTphLnNyYyxkLm9wZW4oYS5tZXRob2R8fGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkdFVCxpLCEwKSxiJiZkIGluc3RhbmNlb2YgWE1MSHR0cFJlcXVlc3QmJjE9PXRoaXMuX3hockxldmVsJiYoYy5PcmlnaW49bG9jYXRpb24ub3JpZ2luKSxhLnZhbHVlcyYmYS5tZXRob2Q9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlBPU1QmJihjW1wiQ29udGVudC1UeXBlXCJdPVwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIpLGJ8fGNbXCJYLVJlcXVlc3RlZC1XaXRoXCJdfHwoY1tcIlgtUmVxdWVzdGVkLVdpdGhcIl09XCJYTUxIdHRwUmVxdWVzdFwiKSxhLmhlYWRlcnMpZm9yKHZhciBqIGluIGEuaGVhZGVycyljW2pdPWEuaGVhZGVyc1tqXTtmb3IoaiBpbiBjKWQuc2V0UmVxdWVzdEhlYWRlcihqLGNbal0pO3JldHVybiBkIGluc3RhbmNlb2YgWE1MSHR0cFJlcXVlc3QmJnZvaWQgMCE9PWEud2l0aENyZWRlbnRpYWxzJiYoZC53aXRoQ3JlZGVudGlhbHM9YS53aXRoQ3JlZGVudGlhbHMpLHRoaXMuX3JlcXVlc3Q9ZCwhMH0sYi5fY2xlYW49ZnVuY3Rpb24oKXtjbGVhclRpbWVvdXQodGhpcy5fbG9hZFRpbWVvdXQpLG51bGwhPXRoaXMuX3JlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcj8odGhpcy5fcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKFwibG9hZHN0YXJ0XCIsdGhpcy5faGFuZGxlTG9hZFN0YXJ0UHJveHkpLHRoaXMuX3JlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInByb2dyZXNzXCIsdGhpcy5faGFuZGxlUHJvZ3Jlc3NQcm94eSksdGhpcy5fcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKFwiYWJvcnRcIix0aGlzLl9oYW5kbGVBYm9ydFByb3h5KSx0aGlzLl9yZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLHRoaXMuX2hhbmRsZUVycm9yUHJveHkpLHRoaXMuX3JlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRpbWVvdXRcIix0aGlzLl9oYW5kbGVUaW1lb3V0UHJveHkpLHRoaXMuX3JlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImxvYWRcIix0aGlzLl9oYW5kbGVMb2FkUHJveHkpLHRoaXMuX3JlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInJlYWR5c3RhdGVjaGFuZ2VcIix0aGlzLl9oYW5kbGVSZWFkeVN0YXRlQ2hhbmdlUHJveHkpKToodGhpcy5fcmVxdWVzdC5vbmxvYWRzdGFydD1udWxsLHRoaXMuX3JlcXVlc3Qub25wcm9ncmVzcz1udWxsLHRoaXMuX3JlcXVlc3Qub25hYm9ydD1udWxsLHRoaXMuX3JlcXVlc3Qub25lcnJvcj1udWxsLHRoaXMuX3JlcXVlc3Qub250aW1lb3V0PW51bGwsdGhpcy5fcmVxdWVzdC5vbmxvYWQ9bnVsbCx0aGlzLl9yZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZT1udWxsKX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1ByZWxvYWRKUyBYSFJSZXF1ZXN0XVwifSxjcmVhdGVqcy5YSFJSZXF1ZXN0PWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0UmVxdWVzdFwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIsYyl7dGhpcy5BYnN0cmFjdExvYWRlcl9jb25zdHJ1Y3RvcigpLHRoaXMuX3BsdWdpbnM9W10sdGhpcy5fdHlwZUNhbGxiYWNrcz17fSx0aGlzLl9leHRlbnNpb25DYWxsYmFja3M9e30sdGhpcy5uZXh0PW51bGwsdGhpcy5tYWludGFpblNjcmlwdE9yZGVyPSEwLHRoaXMuc3RvcE9uRXJyb3I9ITEsdGhpcy5fbWF4Q29ubmVjdGlvbnM9MSx0aGlzLl9hdmFpbGFibGVMb2FkZXJzPVtjcmVhdGVqcy5JbWFnZUxvYWRlcixjcmVhdGVqcy5KYXZhU2NyaXB0TG9hZGVyLGNyZWF0ZWpzLkNTU0xvYWRlcixjcmVhdGVqcy5KU09OTG9hZGVyLGNyZWF0ZWpzLkpTT05QTG9hZGVyLGNyZWF0ZWpzLlNvdW5kTG9hZGVyLGNyZWF0ZWpzLk1hbmlmZXN0TG9hZGVyLGNyZWF0ZWpzLlNwcml0ZVNoZWV0TG9hZGVyLGNyZWF0ZWpzLlhNTExvYWRlcixjcmVhdGVqcy5TVkdMb2FkZXIsY3JlYXRlanMuQmluYXJ5TG9hZGVyLGNyZWF0ZWpzLlZpZGVvTG9hZGVyLGNyZWF0ZWpzLlRleHRMb2FkZXJdLHRoaXMuX2RlZmF1bHRMb2FkZXJMZW5ndGg9dGhpcy5fYXZhaWxhYmxlTG9hZGVycy5sZW5ndGgsdGhpcy5pbml0KGEsYixjKX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5BYnN0cmFjdExvYWRlciksYz1hO2IuaW5pdD1mdW5jdGlvbihhLGIsYyl7dGhpcy51c2VYSFI9ITAsdGhpcy5wcmVmZXJYSFI9ITAsdGhpcy5fcHJlZmVyWEhSPSEwLHRoaXMuc2V0UHJlZmVyWEhSKGEpLHRoaXMuX3BhdXNlZD0hMSx0aGlzLl9iYXNlUGF0aD1iLHRoaXMuX2Nyb3NzT3JpZ2luPWMsdGhpcy5fbG9hZFN0YXJ0V2FzRGlzcGF0Y2hlZD0hMSx0aGlzLl9jdXJyZW50bHlMb2FkaW5nU2NyaXB0PW51bGwsdGhpcy5fY3VycmVudExvYWRzPVtdLHRoaXMuX2xvYWRRdWV1ZT1bXSx0aGlzLl9sb2FkUXVldWVCYWNrdXA9W10sdGhpcy5fbG9hZEl0ZW1zQnlJZD17fSx0aGlzLl9sb2FkSXRlbXNCeVNyYz17fSx0aGlzLl9sb2FkZWRSZXN1bHRzPXt9LHRoaXMuX2xvYWRlZFJhd1Jlc3VsdHM9e30sdGhpcy5fbnVtSXRlbXM9MCx0aGlzLl9udW1JdGVtc0xvYWRlZD0wLHRoaXMuX3NjcmlwdE9yZGVyPVtdLHRoaXMuX2xvYWRlZFNjcmlwdHM9W10sdGhpcy5fbGFzdFByb2dyZXNzPU5hTn0sYy5sb2FkVGltZW91dD04ZTMsYy5MT0FEX1RJTUVPVVQ9MCxjLkJJTkFSWT1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5CSU5BUlksYy5DU1M9Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuQ1NTLGMuSU1BR0U9Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSU1BR0UsYy5KQVZBU0NSSVBUPWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpBVkFTQ1JJUFQsYy5KU09OPWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpTT04sYy5KU09OUD1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KU09OUCxjLk1BTklGRVNUPWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLk1BTklGRVNULGMuU09VTkQ9Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU09VTkQsYy5WSURFTz1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5WSURFTyxjLlNWRz1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5TVkcsYy5URVhUPWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlRFWFQsYy5YTUw9Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuWE1MLGMuUE9TVD1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5QT1NULGMuR0VUPWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkdFVCxiLnJlZ2lzdGVyTG9hZGVyPWZ1bmN0aW9uKGEpe2lmKCFhfHwhYS5jYW5Mb2FkSXRlbSl0aHJvdyBuZXcgRXJyb3IoXCJsb2FkZXIgaXMgb2YgYW4gaW5jb3JyZWN0IHR5cGUuXCIpO2lmKC0xIT10aGlzLl9hdmFpbGFibGVMb2FkZXJzLmluZGV4T2YoYSkpdGhyb3cgbmV3IEVycm9yKFwibG9hZGVyIGFscmVhZHkgZXhpc3RzLlwiKTt0aGlzLl9hdmFpbGFibGVMb2FkZXJzLnVuc2hpZnQoYSl9LGIudW5yZWdpc3RlckxvYWRlcj1mdW5jdGlvbihhKXt2YXIgYj10aGlzLl9hdmFpbGFibGVMb2FkZXJzLmluZGV4T2YoYSk7LTEhPWImJmI8dGhpcy5fZGVmYXVsdExvYWRlckxlbmd0aC0xJiZ0aGlzLl9hdmFpbGFibGVMb2FkZXJzLnNwbGljZShiLDEpfSxiLnNldFVzZVhIUj1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5zZXRQcmVmZXJYSFIoYSl9LGIuc2V0UHJlZmVyWEhSPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnByZWZlclhIUj0wIT1hJiZudWxsIT13aW5kb3cuWE1MSHR0cFJlcXVlc3QsdGhpcy5wcmVmZXJYSFJ9LGIucmVtb3ZlQWxsPWZ1bmN0aW9uKCl7dGhpcy5yZW1vdmUoKX0sYi5yZW1vdmU9ZnVuY3Rpb24oYSl7dmFyIGI9bnVsbDtpZihhJiYhQXJyYXkuaXNBcnJheShhKSliPVthXTtlbHNlIGlmKGEpYj1hO2Vsc2UgaWYoYXJndW1lbnRzLmxlbmd0aD4wKXJldHVybjt2YXIgYz0hMTtpZihiKXtmb3IoO2IubGVuZ3RoOyl7dmFyIGQ9Yi5wb3AoKSxlPXRoaXMuZ2V0UmVzdWx0KGQpO2ZvcihmPXRoaXMuX2xvYWRRdWV1ZS5sZW5ndGgtMTtmPj0wO2YtLSlpZihnPXRoaXMuX2xvYWRRdWV1ZVtmXS5nZXRJdGVtKCksZy5pZD09ZHx8Zy5zcmM9PWQpe3RoaXMuX2xvYWRRdWV1ZS5zcGxpY2UoZiwxKVswXS5jYW5jZWwoKTticmVha31mb3IoZj10aGlzLl9sb2FkUXVldWVCYWNrdXAubGVuZ3RoLTE7Zj49MDtmLS0paWYoZz10aGlzLl9sb2FkUXVldWVCYWNrdXBbZl0uZ2V0SXRlbSgpLGcuaWQ9PWR8fGcuc3JjPT1kKXt0aGlzLl9sb2FkUXVldWVCYWNrdXAuc3BsaWNlKGYsMSlbMF0uY2FuY2VsKCk7YnJlYWt9aWYoZSl0aGlzLl9kaXNwb3NlSXRlbSh0aGlzLmdldEl0ZW0oZCkpO2Vsc2UgZm9yKHZhciBmPXRoaXMuX2N1cnJlbnRMb2Fkcy5sZW5ndGgtMTtmPj0wO2YtLSl7dmFyIGc9dGhpcy5fY3VycmVudExvYWRzW2ZdLmdldEl0ZW0oKTtpZihnLmlkPT1kfHxnLnNyYz09ZCl7dGhpcy5fY3VycmVudExvYWRzLnNwbGljZShmLDEpWzBdLmNhbmNlbCgpLGM9ITA7YnJlYWt9fX1jJiZ0aGlzLl9sb2FkTmV4dCgpfWVsc2V7dGhpcy5jbG9zZSgpO2Zvcih2YXIgaCBpbiB0aGlzLl9sb2FkSXRlbXNCeUlkKXRoaXMuX2Rpc3Bvc2VJdGVtKHRoaXMuX2xvYWRJdGVtc0J5SWRbaF0pO3RoaXMuaW5pdCh0aGlzLnByZWZlclhIUix0aGlzLl9iYXNlUGF0aCl9fSxiLnJlc2V0PWZ1bmN0aW9uKCl7dGhpcy5jbG9zZSgpO2Zvcih2YXIgYSBpbiB0aGlzLl9sb2FkSXRlbXNCeUlkKXRoaXMuX2Rpc3Bvc2VJdGVtKHRoaXMuX2xvYWRJdGVtc0J5SWRbYV0pO2Zvcih2YXIgYj1bXSxjPTAsZD10aGlzLl9sb2FkUXVldWVCYWNrdXAubGVuZ3RoO2Q+YztjKyspYi5wdXNoKHRoaXMuX2xvYWRRdWV1ZUJhY2t1cFtjXS5nZXRJdGVtKCkpO3RoaXMubG9hZE1hbmlmZXN0KGIsITEpfSxiLmluc3RhbGxQbHVnaW49ZnVuY3Rpb24oYSl7aWYobnVsbCE9YSYmbnVsbCE9YS5nZXRQcmVsb2FkSGFuZGxlcnMpe3RoaXMuX3BsdWdpbnMucHVzaChhKTt2YXIgYj1hLmdldFByZWxvYWRIYW5kbGVycygpO2lmKGIuc2NvcGU9YSxudWxsIT1iLnR5cGVzKWZvcih2YXIgYz0wLGQ9Yi50eXBlcy5sZW5ndGg7ZD5jO2MrKyl0aGlzLl90eXBlQ2FsbGJhY2tzW2IudHlwZXNbY11dPWI7aWYobnVsbCE9Yi5leHRlbnNpb25zKWZvcihjPTAsZD1iLmV4dGVuc2lvbnMubGVuZ3RoO2Q+YztjKyspdGhpcy5fZXh0ZW5zaW9uQ2FsbGJhY2tzW2IuZXh0ZW5zaW9uc1tjXV09Yn19LGIuc2V0TWF4Q29ubmVjdGlvbnM9ZnVuY3Rpb24oYSl7dGhpcy5fbWF4Q29ubmVjdGlvbnM9YSwhdGhpcy5fcGF1c2VkJiZ0aGlzLl9sb2FkUXVldWUubGVuZ3RoPjAmJnRoaXMuX2xvYWROZXh0KCl9LGIubG9hZEZpbGU9ZnVuY3Rpb24oYSxiLGMpe2lmKG51bGw9PWEpe3ZhciBkPW5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwiUFJFTE9BRF9OT19GSUxFXCIpO3JldHVybiB2b2lkIHRoaXMuX3NlbmRFcnJvcihkKX10aGlzLl9hZGRJdGVtKGEsbnVsbCxjKSxiIT09ITE/dGhpcy5zZXRQYXVzZWQoITEpOnRoaXMuc2V0UGF1c2VkKCEwKX0sYi5sb2FkTWFuaWZlc3Q9ZnVuY3Rpb24oYSxiLGQpe3ZhciBlPW51bGwsZj1udWxsO2lmKEFycmF5LmlzQXJyYXkoYSkpe2lmKDA9PWEubGVuZ3RoKXt2YXIgZz1uZXcgY3JlYXRlanMuRXJyb3JFdmVudChcIlBSRUxPQURfTUFOSUZFU1RfRU1QVFlcIik7cmV0dXJuIHZvaWQgdGhpcy5fc2VuZEVycm9yKGcpfWU9YX1lbHNlIGlmKFwic3RyaW5nXCI9PXR5cGVvZiBhKWU9W3tzcmM6YSx0eXBlOmMuTUFOSUZFU1R9XTtlbHNle2lmKFwib2JqZWN0XCIhPXR5cGVvZiBhKXt2YXIgZz1uZXcgY3JlYXRlanMuRXJyb3JFdmVudChcIlBSRUxPQURfTUFOSUZFU1RfTlVMTFwiKTtyZXR1cm4gdm9pZCB0aGlzLl9zZW5kRXJyb3IoZyl9aWYodm9pZCAwIT09YS5zcmMpe2lmKG51bGw9PWEudHlwZSlhLnR5cGU9Yy5NQU5JRkVTVDtlbHNlIGlmKGEudHlwZSE9Yy5NQU5JRkVTVCl7dmFyIGc9bmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJQUkVMT0FEX01BTklGRVNUX1RZUEVcIik7dGhpcy5fc2VuZEVycm9yKGcpfWU9W2FdfWVsc2Ugdm9pZCAwIT09YS5tYW5pZmVzdCYmKGU9YS5tYW5pZmVzdCxmPWEucGF0aCl9Zm9yKHZhciBoPTAsaT1lLmxlbmd0aDtpPmg7aCsrKXRoaXMuX2FkZEl0ZW0oZVtoXSxmLGQpO2IhPT0hMT90aGlzLnNldFBhdXNlZCghMSk6dGhpcy5zZXRQYXVzZWQoITApfSxiLmxvYWQ9ZnVuY3Rpb24oKXt0aGlzLnNldFBhdXNlZCghMSl9LGIuZ2V0SXRlbT1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5fbG9hZEl0ZW1zQnlJZFthXXx8dGhpcy5fbG9hZEl0ZW1zQnlTcmNbYV19LGIuZ2V0UmVzdWx0PWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5fbG9hZEl0ZW1zQnlJZFthXXx8dGhpcy5fbG9hZEl0ZW1zQnlTcmNbYV07aWYobnVsbD09YylyZXR1cm4gbnVsbDt2YXIgZD1jLmlkO3JldHVybiBiJiZ0aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2RdP3RoaXMuX2xvYWRlZFJhd1Jlc3VsdHNbZF06dGhpcy5fbG9hZGVkUmVzdWx0c1tkXX0sYi5nZXRJdGVtcz1mdW5jdGlvbihhKXt2YXIgYj1bXTtmb3IodmFyIGMgaW4gdGhpcy5fbG9hZEl0ZW1zQnlJZCl7dmFyIGQ9dGhpcy5fbG9hZEl0ZW1zQnlJZFtjXSxlPXRoaXMuZ2V0UmVzdWx0KGMpOyhhIT09ITB8fG51bGwhPWUpJiZiLnB1c2goe2l0ZW06ZCxyZXN1bHQ6ZSxyYXdSZXN1bHQ6dGhpcy5nZXRSZXN1bHQoYywhMCl9KX1yZXR1cm4gYn0sYi5zZXRQYXVzZWQ9ZnVuY3Rpb24oYSl7dGhpcy5fcGF1c2VkPWEsdGhpcy5fcGF1c2VkfHx0aGlzLl9sb2FkTmV4dCgpfSxiLmNsb3NlPWZ1bmN0aW9uKCl7Zm9yKDt0aGlzLl9jdXJyZW50TG9hZHMubGVuZ3RoOyl0aGlzLl9jdXJyZW50TG9hZHMucG9wKCkuY2FuY2VsKCk7dGhpcy5fc2NyaXB0T3JkZXIubGVuZ3RoPTAsdGhpcy5fbG9hZGVkU2NyaXB0cy5sZW5ndGg9MCx0aGlzLmxvYWRTdGFydFdhc0Rpc3BhdGNoZWQ9ITEsdGhpcy5faXRlbUNvdW50PTAsdGhpcy5fbGFzdFByb2dyZXNzPU5hTn0sYi5fYWRkSXRlbT1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5fY3JlYXRlTG9hZEl0ZW0oYSxiLGMpO2lmKG51bGwhPWQpe3ZhciBlPXRoaXMuX2NyZWF0ZUxvYWRlcihkKTtudWxsIT1lJiYoXCJwbHVnaW5zXCJpbiBlJiYoZS5wbHVnaW5zPXRoaXMuX3BsdWdpbnMpLGQuX2xvYWRlcj1lLHRoaXMuX2xvYWRRdWV1ZS5wdXNoKGUpLHRoaXMuX2xvYWRRdWV1ZUJhY2t1cC5wdXNoKGUpLHRoaXMuX251bUl0ZW1zKyssdGhpcy5fdXBkYXRlUHJvZ3Jlc3MoKSwodGhpcy5tYWludGFpblNjcmlwdE9yZGVyJiZkLnR5cGU9PWNyZWF0ZWpzLkxvYWRRdWV1ZS5KQVZBU0NSSVBUfHxkLm1haW50YWluT3JkZXI9PT0hMCkmJih0aGlzLl9zY3JpcHRPcmRlci5wdXNoKGQpLHRoaXMuX2xvYWRlZFNjcmlwdHMucHVzaChudWxsKSkpfX0sYi5fY3JlYXRlTG9hZEl0ZW09ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWNyZWF0ZWpzLkxvYWRJdGVtLmNyZWF0ZShhKTtpZihudWxsPT1kKXJldHVybiBudWxsO3ZhciBlPVwiXCIsZj1jfHx0aGlzLl9iYXNlUGF0aDtpZihkLnNyYyBpbnN0YW5jZW9mIE9iamVjdCl7aWYoIWQudHlwZSlyZXR1cm4gbnVsbDtpZihiKXtlPWI7dmFyIGc9Y3JlYXRlanMuUmVxdWVzdFV0aWxzLnBhcnNlVVJJKGIpO251bGw9PWZ8fGcuYWJzb2x1dGV8fGcucmVsYXRpdmV8fChlPWYrZSl9ZWxzZSBudWxsIT1mJiYoZT1mKX1lbHNle3ZhciBoPWNyZWF0ZWpzLlJlcXVlc3RVdGlscy5wYXJzZVVSSShkLnNyYyk7aC5leHRlbnNpb24mJihkLmV4dD1oLmV4dGVuc2lvbiksbnVsbD09ZC50eXBlJiYoZC50eXBlPWNyZWF0ZWpzLlJlcXVlc3RVdGlscy5nZXRUeXBlQnlFeHRlbnNpb24oZC5leHQpKTt2YXIgaT1kLnNyYztpZighaC5hYnNvbHV0ZSYmIWgucmVsYXRpdmUpaWYoYil7ZT1iO3ZhciBnPWNyZWF0ZWpzLlJlcXVlc3RVdGlscy5wYXJzZVVSSShiKTtpPWIraSxudWxsPT1mfHxnLmFic29sdXRlfHxnLnJlbGF0aXZlfHwoZT1mK2UpfWVsc2UgbnVsbCE9ZiYmKGU9Zik7ZC5zcmM9ZStkLnNyY31kLnBhdGg9ZSwodm9pZCAwPT09ZC5pZHx8bnVsbD09PWQuaWR8fFwiXCI9PT1kLmlkKSYmKGQuaWQ9aSk7dmFyIGo9dGhpcy5fdHlwZUNhbGxiYWNrc1tkLnR5cGVdfHx0aGlzLl9leHRlbnNpb25DYWxsYmFja3NbZC5leHRdO2lmKGope3ZhciBrPWouY2FsbGJhY2suY2FsbChqLnNjb3BlLGQsdGhpcyk7aWYoaz09PSExKXJldHVybiBudWxsO2s9PT0hMHx8bnVsbCE9ayYmKGQuX2xvYWRlcj1rKSxoPWNyZWF0ZWpzLlJlcXVlc3RVdGlscy5wYXJzZVVSSShkLnNyYyksbnVsbCE9aC5leHRlbnNpb24mJihkLmV4dD1oLmV4dGVuc2lvbil9cmV0dXJuIHRoaXMuX2xvYWRJdGVtc0J5SWRbZC5pZF09ZCx0aGlzLl9sb2FkSXRlbXNCeVNyY1tkLnNyY109ZCxudWxsPT1kLmNyb3NzT3JpZ2luJiYoZC5jcm9zc09yaWdpbj10aGlzLl9jcm9zc09yaWdpbiksZH0sYi5fY3JlYXRlTG9hZGVyPWZ1bmN0aW9uKGEpe2lmKG51bGwhPWEuX2xvYWRlcilyZXR1cm4gYS5fbG9hZGVyO2Zvcih2YXIgYj10aGlzLnByZWZlclhIUixjPTA7Yzx0aGlzLl9hdmFpbGFibGVMb2FkZXJzLmxlbmd0aDtjKyspe3ZhciBkPXRoaXMuX2F2YWlsYWJsZUxvYWRlcnNbY107aWYoZCYmZC5jYW5Mb2FkSXRlbShhKSlyZXR1cm4gbmV3IGQoYSxiKX1yZXR1cm4gbnVsbH0sYi5fbG9hZE5leHQ9ZnVuY3Rpb24oKXtpZighdGhpcy5fcGF1c2VkKXt0aGlzLl9sb2FkU3RhcnRXYXNEaXNwYXRjaGVkfHwodGhpcy5fc2VuZExvYWRTdGFydCgpLHRoaXMuX2xvYWRTdGFydFdhc0Rpc3BhdGNoZWQ9ITApLHRoaXMuX251bUl0ZW1zPT10aGlzLl9udW1JdGVtc0xvYWRlZD8odGhpcy5sb2FkZWQ9ITAsdGhpcy5fc2VuZENvbXBsZXRlKCksdGhpcy5uZXh0JiZ0aGlzLm5leHQubG9hZCYmdGhpcy5uZXh0LmxvYWQoKSk6dGhpcy5sb2FkZWQ9ITE7Zm9yKHZhciBhPTA7YTx0aGlzLl9sb2FkUXVldWUubGVuZ3RoJiYhKHRoaXMuX2N1cnJlbnRMb2Fkcy5sZW5ndGg+PXRoaXMuX21heENvbm5lY3Rpb25zKTthKyspe3ZhciBiPXRoaXMuX2xvYWRRdWV1ZVthXTt0aGlzLl9jYW5TdGFydExvYWQoYikmJih0aGlzLl9sb2FkUXVldWUuc3BsaWNlKGEsMSksYS0tLHRoaXMuX2xvYWRJdGVtKGIpKX19fSxiLl9sb2FkSXRlbT1mdW5jdGlvbihhKXthLm9uKFwiZmlsZWxvYWRcIix0aGlzLl9oYW5kbGVGaWxlTG9hZCx0aGlzKSxhLm9uKFwicHJvZ3Jlc3NcIix0aGlzLl9oYW5kbGVQcm9ncmVzcyx0aGlzKSxhLm9uKFwiY29tcGxldGVcIix0aGlzLl9oYW5kbGVGaWxlQ29tcGxldGUsdGhpcyksYS5vbihcImVycm9yXCIsdGhpcy5faGFuZGxlRXJyb3IsdGhpcyksYS5vbihcImZpbGVlcnJvclwiLHRoaXMuX2hhbmRsZUZpbGVFcnJvcix0aGlzKSx0aGlzLl9jdXJyZW50TG9hZHMucHVzaChhKSx0aGlzLl9zZW5kRmlsZVN0YXJ0KGEuZ2V0SXRlbSgpKSxhLmxvYWQoKX0sYi5faGFuZGxlRmlsZUxvYWQ9ZnVuY3Rpb24oYSl7YS50YXJnZXQ9bnVsbCx0aGlzLmRpc3BhdGNoRXZlbnQoYSl9LGIuX2hhbmRsZUZpbGVFcnJvcj1mdW5jdGlvbihhKXt2YXIgYj1uZXcgY3JlYXRlanMuRXJyb3JFdmVudChcIkZJTEVfTE9BRF9FUlJPUlwiLG51bGwsYS5pdGVtKTt0aGlzLl9zZW5kRXJyb3IoYil9LGIuX2hhbmRsZUVycm9yPWZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0O3RoaXMuX251bUl0ZW1zTG9hZGVkKyssdGhpcy5fZmluaXNoT3JkZXJlZEl0ZW0oYiwhMCksdGhpcy5fdXBkYXRlUHJvZ3Jlc3MoKTt2YXIgYz1uZXcgY3JlYXRlanMuRXJyb3JFdmVudChcIkZJTEVfTE9BRF9FUlJPUlwiLG51bGwsYi5nZXRJdGVtKCkpO3RoaXMuX3NlbmRFcnJvcihjKSx0aGlzLnN0b3BPbkVycm9yP3RoaXMuc2V0UGF1c2VkKCEwKToodGhpcy5fcmVtb3ZlTG9hZEl0ZW0oYiksdGhpcy5fY2xlYW5Mb2FkSXRlbShiKSx0aGlzLl9sb2FkTmV4dCgpKX0sYi5faGFuZGxlRmlsZUNvbXBsZXRlPWZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0LGM9Yi5nZXRJdGVtKCksZD1iLmdldFJlc3VsdCgpO3RoaXMuX2xvYWRlZFJlc3VsdHNbYy5pZF09ZDt2YXIgZT1iLmdldFJlc3VsdCghMCk7bnVsbCE9ZSYmZSE9PWQmJih0aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2MuaWRdPWUpLHRoaXMuX3NhdmVMb2FkZWRJdGVtcyhiKSx0aGlzLl9yZW1vdmVMb2FkSXRlbShiKSx0aGlzLl9maW5pc2hPcmRlcmVkSXRlbShiKXx8dGhpcy5fcHJvY2Vzc0ZpbmlzaGVkTG9hZChjLGIpLHRoaXMuX2NsZWFuTG9hZEl0ZW0oYil9LGIuX3NhdmVMb2FkZWRJdGVtcz1mdW5jdGlvbihhKXt2YXIgYj1hLmdldExvYWRlZEl0ZW1zKCk7aWYobnVsbCE9PWIpZm9yKHZhciBjPTA7YzxiLmxlbmd0aDtjKyspe3ZhciBkPWJbY10uaXRlbTt0aGlzLl9sb2FkSXRlbXNCeVNyY1tkLnNyY109ZCx0aGlzLl9sb2FkSXRlbXNCeUlkW2QuaWRdPWQsdGhpcy5fbG9hZGVkUmVzdWx0c1tkLmlkXT1iW2NdLnJlc3VsdCx0aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2QuaWRdPWJbY10ucmF3UmVzdWx0fX0sYi5fZmluaXNoT3JkZXJlZEl0ZW09ZnVuY3Rpb24oYSxiKXt2YXIgYz1hLmdldEl0ZW0oKTtpZih0aGlzLm1haW50YWluU2NyaXB0T3JkZXImJmMudHlwZT09Y3JlYXRlanMuTG9hZFF1ZXVlLkpBVkFTQ1JJUFR8fGMubWFpbnRhaW5PcmRlcil7YSBpbnN0YW5jZW9mIGNyZWF0ZWpzLkphdmFTY3JpcHRMb2FkZXImJih0aGlzLl9jdXJyZW50bHlMb2FkaW5nU2NyaXB0PSExKTt2YXIgZD1jcmVhdGVqcy5pbmRleE9mKHRoaXMuX3NjcmlwdE9yZGVyLGMpO3JldHVybi0xPT1kPyExOih0aGlzLl9sb2FkZWRTY3JpcHRzW2RdPWI9PT0hMD8hMDpjLHRoaXMuX2NoZWNrU2NyaXB0TG9hZE9yZGVyKCksITApfXJldHVybiExfSxiLl9jaGVja1NjcmlwdExvYWRPcmRlcj1mdW5jdGlvbigpe2Zvcih2YXIgYT10aGlzLl9sb2FkZWRTY3JpcHRzLmxlbmd0aCxiPTA7YT5iO2IrKyl7dmFyIGM9dGhpcy5fbG9hZGVkU2NyaXB0c1tiXTtpZihudWxsPT09YylicmVhaztpZihjIT09ITApe3ZhciBkPXRoaXMuX2xvYWRlZFJlc3VsdHNbYy5pZF07Yy50eXBlPT1jcmVhdGVqcy5Mb2FkUXVldWUuSkFWQVNDUklQVCYmY3JlYXRlanMuRG9tVXRpbHMuYXBwZW5kVG9IZWFkKGQpO3ZhciBlPWMuX2xvYWRlcjt0aGlzLl9wcm9jZXNzRmluaXNoZWRMb2FkKGMsZSksdGhpcy5fbG9hZGVkU2NyaXB0c1tiXT0hMH19fSxiLl9wcm9jZXNzRmluaXNoZWRMb2FkPWZ1bmN0aW9uKGEsYil7aWYodGhpcy5fbnVtSXRlbXNMb2FkZWQrKywhdGhpcy5tYWludGFpblNjcmlwdE9yZGVyJiZhLnR5cGU9PWNyZWF0ZWpzLkxvYWRRdWV1ZS5KQVZBU0NSSVBUKXt2YXIgYz1iLmdldFRhZygpO2NyZWF0ZWpzLkRvbVV0aWxzLmFwcGVuZFRvSGVhZChjKX10aGlzLl91cGRhdGVQcm9ncmVzcygpLHRoaXMuX3NlbmRGaWxlQ29tcGxldGUoYSxiKSx0aGlzLl9sb2FkTmV4dCgpfSxiLl9jYW5TdGFydExvYWQ9ZnVuY3Rpb24oYSl7aWYoIXRoaXMubWFpbnRhaW5TY3JpcHRPcmRlcnx8YS5wcmVmZXJYSFIpcmV0dXJuITA7dmFyIGI9YS5nZXRJdGVtKCk7aWYoYi50eXBlIT1jcmVhdGVqcy5Mb2FkUXVldWUuSkFWQVNDUklQVClyZXR1cm4hMDtpZih0aGlzLl9jdXJyZW50bHlMb2FkaW5nU2NyaXB0KXJldHVybiExO2Zvcih2YXIgYz10aGlzLl9zY3JpcHRPcmRlci5pbmRleE9mKGIpLGQ9MDtjPmQ7KXt2YXIgZT10aGlzLl9sb2FkZWRTY3JpcHRzW2RdO2lmKG51bGw9PWUpcmV0dXJuITE7ZCsrfXJldHVybiB0aGlzLl9jdXJyZW50bHlMb2FkaW5nU2NyaXB0PSEwLCEwfSxiLl9yZW1vdmVMb2FkSXRlbT1mdW5jdGlvbihhKXtmb3IodmFyIGI9dGhpcy5fY3VycmVudExvYWRzLmxlbmd0aCxjPTA7Yj5jO2MrKylpZih0aGlzLl9jdXJyZW50TG9hZHNbY109PWEpe3RoaXMuX2N1cnJlbnRMb2Fkcy5zcGxpY2UoYywxKTticmVha319LGIuX2NsZWFuTG9hZEl0ZW09ZnVuY3Rpb24oYSl7dmFyIGI9YS5nZXRJdGVtKCk7YiYmZGVsZXRlIGIuX2xvYWRlcn0sYi5faGFuZGxlUHJvZ3Jlc3M9ZnVuY3Rpb24oYSl7dmFyIGI9YS50YXJnZXQ7dGhpcy5fc2VuZEZpbGVQcm9ncmVzcyhiLmdldEl0ZW0oKSxiLnByb2dyZXNzKSx0aGlzLl91cGRhdGVQcm9ncmVzcygpfSxiLl91cGRhdGVQcm9ncmVzcz1mdW5jdGlvbigpe3ZhciBhPXRoaXMuX251bUl0ZW1zTG9hZGVkL3RoaXMuX251bUl0ZW1zLGI9dGhpcy5fbnVtSXRlbXMtdGhpcy5fbnVtSXRlbXNMb2FkZWQ7aWYoYj4wKXtmb3IodmFyIGM9MCxkPTAsZT10aGlzLl9jdXJyZW50TG9hZHMubGVuZ3RoO2U+ZDtkKyspYys9dGhpcy5fY3VycmVudExvYWRzW2RdLnByb2dyZXNzO2ErPWMvYiooYi90aGlzLl9udW1JdGVtcyl9dGhpcy5fbGFzdFByb2dyZXNzIT1hJiYodGhpcy5fc2VuZFByb2dyZXNzKGEpLHRoaXMuX2xhc3RQcm9ncmVzcz1hKX0sYi5fZGlzcG9zZUl0ZW09ZnVuY3Rpb24oYSl7ZGVsZXRlIHRoaXMuX2xvYWRlZFJlc3VsdHNbYS5pZF0sZGVsZXRlIHRoaXMuX2xvYWRlZFJhd1Jlc3VsdHNbYS5pZF0sZGVsZXRlIHRoaXMuX2xvYWRJdGVtc0J5SWRbYS5pZF0sZGVsZXRlIHRoaXMuX2xvYWRJdGVtc0J5U3JjW2Euc3JjXX0sYi5fc2VuZEZpbGVQcm9ncmVzcz1mdW5jdGlvbihhLGIpe2lmKCF0aGlzLl9pc0NhbmNlbGVkKCkmJiF0aGlzLl9wYXVzZWQmJnRoaXMuaGFzRXZlbnRMaXN0ZW5lcihcImZpbGVwcm9ncmVzc1wiKSl7dmFyIGM9bmV3IGNyZWF0ZWpzLkV2ZW50KFwiZmlsZXByb2dyZXNzXCIpO2MucHJvZ3Jlc3M9YixjLmxvYWRlZD1iLGMudG90YWw9MSxjLml0ZW09YSx0aGlzLmRpc3BhdGNoRXZlbnQoYyl9fSxiLl9zZW5kRmlsZUNvbXBsZXRlPWZ1bmN0aW9uKGEsYil7XG5pZighdGhpcy5faXNDYW5jZWxlZCgpJiYhdGhpcy5fcGF1c2VkKXt2YXIgYz1uZXcgY3JlYXRlanMuRXZlbnQoXCJmaWxlbG9hZFwiKTtjLmxvYWRlcj1iLGMuaXRlbT1hLGMucmVzdWx0PXRoaXMuX2xvYWRlZFJlc3VsdHNbYS5pZF0sYy5yYXdSZXN1bHQ9dGhpcy5fbG9hZGVkUmF3UmVzdWx0c1thLmlkXSxhLmNvbXBsZXRlSGFuZGxlciYmYS5jb21wbGV0ZUhhbmRsZXIoYyksdGhpcy5oYXNFdmVudExpc3RlbmVyKFwiZmlsZWxvYWRcIikmJnRoaXMuZGlzcGF0Y2hFdmVudChjKX19LGIuX3NlbmRGaWxlU3RhcnQ9ZnVuY3Rpb24oYSl7dmFyIGI9bmV3IGNyZWF0ZWpzLkV2ZW50KFwiZmlsZXN0YXJ0XCIpO2IuaXRlbT1hLHRoaXMuaGFzRXZlbnRMaXN0ZW5lcihcImZpbGVzdGFydFwiKSYmdGhpcy5kaXNwYXRjaEV2ZW50KGIpfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbUHJlbG9hZEpTIExvYWRRdWV1ZV1cIn0sY3JlYXRlanMuTG9hZFF1ZXVlPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0TG9hZGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSwhMCxjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5URVhUKX12YXIgYj0oY3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLGEpO2IuY2FuTG9hZEl0ZW09ZnVuY3Rpb24oYSl7cmV0dXJuIGEudHlwZT09Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuVEVYVH0sY3JlYXRlanMuVGV4dExvYWRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdExvYWRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhKXt0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsITAsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuQklOQVJZKSx0aGlzLm9uKFwiaW5pdGlhbGl6ZVwiLHRoaXMuX3VwZGF0ZVhIUix0aGlzKX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5BYnN0cmFjdExvYWRlciksYz1hO2MuY2FuTG9hZEl0ZW09ZnVuY3Rpb24oYSl7cmV0dXJuIGEudHlwZT09Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuQklOQVJZfSxiLl91cGRhdGVYSFI9ZnVuY3Rpb24oYSl7YS5sb2FkZXIuc2V0UmVzcG9uc2VUeXBlKFwiYXJyYXlidWZmZXJcIil9LGNyZWF0ZWpzLkJpbmFyeUxvYWRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdExvYWRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIpe3RoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSxiLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkNTUyksdGhpcy5yZXN1bHRGb3JtYXR0ZXI9dGhpcy5fZm9ybWF0UmVzdWx0LHRoaXMuX3RhZ1NyY0F0dHJpYnV0ZT1cImhyZWZcIixiP3RoaXMuX3RhZz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik6dGhpcy5fdGFnPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaW5rXCIpLHRoaXMuX3RhZy5yZWw9XCJzdHlsZXNoZWV0XCIsdGhpcy5fdGFnLnR5cGU9XCJ0ZXh0L2Nzc1wifXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyKSxjPWE7Yy5jYW5Mb2FkSXRlbT1mdW5jdGlvbihhKXtyZXR1cm4gYS50eXBlPT1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5DU1N9LGIuX2Zvcm1hdFJlc3VsdD1mdW5jdGlvbihhKXtpZih0aGlzLl9wcmVmZXJYSFIpe3ZhciBiPWEuZ2V0VGFnKCk7aWYoYi5zdHlsZVNoZWV0KWIuc3R5bGVTaGVldC5jc3NUZXh0PWEuZ2V0UmVzdWx0KCEwKTtlbHNle3ZhciBjPWRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGEuZ2V0UmVzdWx0KCEwKSk7Yi5hcHBlbmRDaGlsZChjKX19ZWxzZSBiPXRoaXMuX3RhZztyZXR1cm4gY3JlYXRlanMuRG9tVXRpbHMuYXBwZW5kVG9IZWFkKGIpLGJ9LGNyZWF0ZWpzLkNTU0xvYWRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdExvYWRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIpe3RoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSxiLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLklNQUdFKSx0aGlzLnJlc3VsdEZvcm1hdHRlcj10aGlzLl9mb3JtYXRSZXN1bHQsdGhpcy5fdGFnU3JjQXR0cmlidXRlPVwic3JjXCIsY3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzSW1hZ2VUYWcoYSk/dGhpcy5fdGFnPWE6Y3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzSW1hZ2VUYWcoYS5zcmMpP3RoaXMuX3RhZz1hLnNyYzpjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNJbWFnZVRhZyhhLnRhZykmJih0aGlzLl90YWc9YS50YWcpLG51bGwhPXRoaXMuX3RhZz90aGlzLl9wcmVmZXJYSFI9ITE6dGhpcy5fdGFnPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIiksdGhpcy5vbihcImluaXRpYWxpemVcIix0aGlzLl91cGRhdGVYSFIsdGhpcyl9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLGM9YTtjLmNhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3JldHVybiBhLnR5cGU9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLklNQUdFfSxiLmxvYWQ9ZnVuY3Rpb24oKXtpZihcIlwiIT10aGlzLl90YWcuc3JjJiZ0aGlzLl90YWcuY29tcGxldGUpcmV0dXJuIHZvaWQgdGhpcy5fc2VuZENvbXBsZXRlKCk7dmFyIGE9dGhpcy5faXRlbS5jcm9zc09yaWdpbjsxPT1hJiYoYT1cIkFub255bW91c1wiKSxudWxsPT1hfHxjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNMb2NhbCh0aGlzLl9pdGVtLnNyYyl8fCh0aGlzLl90YWcuY3Jvc3NPcmlnaW49YSksdGhpcy5BYnN0cmFjdExvYWRlcl9sb2FkKCl9LGIuX3VwZGF0ZVhIUj1mdW5jdGlvbihhKXthLmxvYWRlci5taW1lVHlwZT1cInRleHQvcGxhaW47IGNoYXJzZXQ9eC11c2VyLWRlZmluZWQtYmluYXJ5XCIsYS5sb2FkZXIuc2V0UmVzcG9uc2VUeXBlJiZhLmxvYWRlci5zZXRSZXNwb25zZVR5cGUoXCJibG9iXCIpfSxiLl9mb3JtYXRSZXN1bHQ9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX2Zvcm1hdEltYWdlfSxiLl9mb3JtYXRJbWFnZT1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuX3RhZyxkPXdpbmRvdy5VUkx8fHdpbmRvdy53ZWJraXRVUkw7aWYodGhpcy5fcHJlZmVyWEhSKWlmKGQpe3ZhciBlPWQuY3JlYXRlT2JqZWN0VVJMKHRoaXMuZ2V0UmVzdWx0KCEwKSk7Yy5zcmM9ZSxjLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsdGhpcy5fY2xlYW5VcFVSTCwhMSksYy5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIix0aGlzLl9jbGVhblVwVVJMLCExKX1lbHNlIGMuc3JjPXRoaXMuX2l0ZW0uc3JjO2Vsc2U7Yy5jb21wbGV0ZT9hKGMpOihjLm9ubG9hZD1jcmVhdGVqcy5wcm94eShmdW5jdGlvbigpe2EodGhpcy5fdGFnKX0sdGhpcyksYy5vbmVycm9yPWNyZWF0ZWpzLnByb3h5KGZ1bmN0aW9uKCl7YihfdGhpcy5fdGFnKX0sdGhpcykpfSxiLl9jbGVhblVwVVJMPWZ1bmN0aW9uKGEpe3ZhciBiPXdpbmRvdy5VUkx8fHdpbmRvdy53ZWJraXRVUkw7Yi5yZXZva2VPYmplY3RVUkwoYS50YXJnZXQuc3JjKX0sY3JlYXRlanMuSW1hZ2VMb2FkZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RMb2FkZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiKXt0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsYixjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KQVZBU0NSSVBUKSx0aGlzLnJlc3VsdEZvcm1hdHRlcj10aGlzLl9mb3JtYXRSZXN1bHQsdGhpcy5fdGFnU3JjQXR0cmlidXRlPVwic3JjXCIsdGhpcy5zZXRUYWcoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKSl9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLGM9YTtjLmNhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3JldHVybiBhLnR5cGU9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpBVkFTQ1JJUFR9LGIuX2Zvcm1hdFJlc3VsdD1mdW5jdGlvbihhKXt2YXIgYj1hLmdldFRhZygpO3JldHVybiB0aGlzLl9wcmVmZXJYSFImJihiLnRleHQ9YS5nZXRSZXN1bHQoITApKSxifSxjcmVhdGVqcy5KYXZhU2NyaXB0TG9hZGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0TG9hZGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSwhMCxjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KU09OKSx0aGlzLnJlc3VsdEZvcm1hdHRlcj10aGlzLl9mb3JtYXRSZXN1bHR9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLGM9YTtjLmNhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3JldHVybiBhLnR5cGU9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpTT059LGIuX2Zvcm1hdFJlc3VsdD1mdW5jdGlvbihhKXt2YXIgYj1udWxsO3RyeXtiPWNyZWF0ZWpzLkRhdGFVdGlscy5wYXJzZUpTT04oYS5nZXRSZXN1bHQoITApKX1jYXRjaChjKXt2YXIgZD1uZXcgY3JlYXRlanMuRXJyb3JFdmVudChcIkpTT05fRk9STUFUXCIsbnVsbCxjKTtyZXR1cm4gdGhpcy5fc2VuZEVycm9yKGQpLGN9cmV0dXJuIGJ9LGNyZWF0ZWpzLkpTT05Mb2FkZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RMb2FkZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSl7dGhpcy5BYnN0cmFjdExvYWRlcl9jb25zdHJ1Y3RvcihhLCExLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpTT05QKSx0aGlzLnNldFRhZyhkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpKSx0aGlzLmdldFRhZygpLnR5cGU9XCJ0ZXh0L2phdmFzY3JpcHRcIn12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5BYnN0cmFjdExvYWRlciksYz1hO2MuY2FuTG9hZEl0ZW09ZnVuY3Rpb24oYSl7cmV0dXJuIGEudHlwZT09Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSlNPTlB9LGIuY2FuY2VsPWZ1bmN0aW9uKCl7dGhpcy5BYnN0cmFjdExvYWRlcl9jYW5jZWwoKSx0aGlzLl9kaXNwb3NlKCl9LGIubG9hZD1mdW5jdGlvbigpe2lmKG51bGw9PXRoaXMuX2l0ZW0uY2FsbGJhY2spdGhyb3cgbmV3IEVycm9yKFwiY2FsbGJhY2sgaXMgcmVxdWlyZWQgZm9yIGxvYWRpbmcgSlNPTlAgcmVxdWVzdHMuXCIpO2lmKG51bGwhPXdpbmRvd1t0aGlzLl9pdGVtLmNhbGxiYWNrXSl0aHJvdyBuZXcgRXJyb3IoXCJKU09OUCBjYWxsYmFjayAnXCIrdGhpcy5faXRlbS5jYWxsYmFjaytcIicgYWxyZWFkeSBleGlzdHMgb24gd2luZG93LiBZb3UgbmVlZCB0byBzcGVjaWZ5IGEgZGlmZmVyZW50IGNhbGxiYWNrIG9yIHJlLW5hbWUgdGhlIGN1cnJlbnQgb25lLlwiKTt3aW5kb3dbdGhpcy5faXRlbS5jYWxsYmFja109Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlTG9hZCx0aGlzKSx3aW5kb3cuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLl90YWcpLHRoaXMuX2xvYWRUaW1lb3V0PXNldFRpbWVvdXQoY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGltZW91dCx0aGlzKSx0aGlzLl9pdGVtLmxvYWRUaW1lb3V0KSx0aGlzLl90YWcuc3JjPXRoaXMuX2l0ZW0uc3JjfSxiLl9oYW5kbGVMb2FkPWZ1bmN0aW9uKGEpe3RoaXMuX3Jlc3VsdD10aGlzLl9yYXdSZXN1bHQ9YSx0aGlzLl9zZW5kQ29tcGxldGUoKSx0aGlzLl9kaXNwb3NlKCl9LGIuX2hhbmRsZVRpbWVvdXQ9ZnVuY3Rpb24oKXt0aGlzLl9kaXNwb3NlKCksdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwidGltZW91dFwiKSl9LGIuX2Rpc3Bvc2U9ZnVuY3Rpb24oKXt3aW5kb3cuZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLl90YWcpLGRlbGV0ZSB3aW5kb3dbdGhpcy5faXRlbS5jYWxsYmFja10sY2xlYXJUaW1lb3V0KHRoaXMuX2xvYWRUaW1lb3V0KX0sY3JlYXRlanMuSlNPTlBMb2FkZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RMb2FkZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSl7dGhpcy5BYnN0cmFjdExvYWRlcl9jb25zdHJ1Y3RvcihhLG51bGwsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuTUFOSUZFU1QpLHRoaXMucGx1Z2lucz1udWxsLHRoaXMuX21hbmlmZXN0UXVldWU9bnVsbH12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5BYnN0cmFjdExvYWRlciksYz1hO2MuTUFOSUZFU1RfUFJPR1JFU1M9LjI1LGMuY2FuTG9hZEl0ZW09ZnVuY3Rpb24oYSl7cmV0dXJuIGEudHlwZT09Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuTUFOSUZFU1R9LGIubG9hZD1mdW5jdGlvbigpe3RoaXMuQWJzdHJhY3RMb2FkZXJfbG9hZCgpfSxiLl9jcmVhdGVSZXF1ZXN0PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5faXRlbS5jYWxsYmFjaztudWxsIT1hP3RoaXMuX3JlcXVlc3Q9bmV3IGNyZWF0ZWpzLkpTT05QTG9hZGVyKHRoaXMuX2l0ZW0pOnRoaXMuX3JlcXVlc3Q9bmV3IGNyZWF0ZWpzLkpTT05Mb2FkZXIodGhpcy5faXRlbSl9LGIuaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oYSl7c3dpdGNoKGEudHlwZSl7Y2FzZVwiY29tcGxldGVcIjpyZXR1cm4gdGhpcy5fcmF3UmVzdWx0PWEudGFyZ2V0LmdldFJlc3VsdCghMCksdGhpcy5fcmVzdWx0PWEudGFyZ2V0LmdldFJlc3VsdCgpLHRoaXMuX3NlbmRQcm9ncmVzcyhjLk1BTklGRVNUX1BST0dSRVNTKSx2b2lkIHRoaXMuX2xvYWRNYW5pZmVzdCh0aGlzLl9yZXN1bHQpO2Nhc2VcInByb2dyZXNzXCI6cmV0dXJuIGEubG9hZGVkKj1jLk1BTklGRVNUX1BST0dSRVNTLHRoaXMucHJvZ3Jlc3M9YS5sb2FkZWQvYS50b3RhbCwoaXNOYU4odGhpcy5wcm9ncmVzcyl8fHRoaXMucHJvZ3Jlc3M9PTEvMCkmJih0aGlzLnByb2dyZXNzPTApLHZvaWQgdGhpcy5fc2VuZFByb2dyZXNzKGEpfXRoaXMuQWJzdHJhY3RMb2FkZXJfaGFuZGxlRXZlbnQoYSl9LGIuZGVzdHJveT1mdW5jdGlvbigpe3RoaXMuQWJzdHJhY3RMb2FkZXJfZGVzdHJveSgpLHRoaXMuX21hbmlmZXN0UXVldWUuY2xvc2UoKX0sYi5fbG9hZE1hbmlmZXN0PWZ1bmN0aW9uKGEpe2lmKGEmJmEubWFuaWZlc3Qpe3ZhciBiPXRoaXMuX21hbmlmZXN0UXVldWU9bmV3IGNyZWF0ZWpzLkxvYWRRdWV1ZTtiLm9uKFwiZmlsZWxvYWRcIix0aGlzLl9oYW5kbGVNYW5pZmVzdEZpbGVMb2FkLHRoaXMpLGIub24oXCJwcm9ncmVzc1wiLHRoaXMuX2hhbmRsZU1hbmlmZXN0UHJvZ3Jlc3MsdGhpcyksYi5vbihcImNvbXBsZXRlXCIsdGhpcy5faGFuZGxlTWFuaWZlc3RDb21wbGV0ZSx0aGlzLCEwKSxiLm9uKFwiZXJyb3JcIix0aGlzLl9oYW5kbGVNYW5pZmVzdEVycm9yLHRoaXMsITApO2Zvcih2YXIgYz0wLGQ9dGhpcy5wbHVnaW5zLmxlbmd0aDtkPmM7YysrKWIuaW5zdGFsbFBsdWdpbih0aGlzLnBsdWdpbnNbY10pO2IubG9hZE1hbmlmZXN0KGEpfWVsc2UgdGhpcy5fc2VuZENvbXBsZXRlKCl9LGIuX2hhbmRsZU1hbmlmZXN0RmlsZUxvYWQ9ZnVuY3Rpb24oYSl7YS50YXJnZXQ9bnVsbCx0aGlzLmRpc3BhdGNoRXZlbnQoYSl9LGIuX2hhbmRsZU1hbmlmZXN0Q29tcGxldGU9ZnVuY3Rpb24oYSl7dGhpcy5fbG9hZGVkSXRlbXM9dGhpcy5fbWFuaWZlc3RRdWV1ZS5nZXRJdGVtcyghMCksdGhpcy5fc2VuZENvbXBsZXRlKCl9LGIuX2hhbmRsZU1hbmlmZXN0UHJvZ3Jlc3M9ZnVuY3Rpb24oYSl7dGhpcy5wcm9ncmVzcz1hLnByb2dyZXNzKigxLWMuTUFOSUZFU1RfUFJPR1JFU1MpK2MuTUFOSUZFU1RfUFJPR1JFU1MsdGhpcy5fc2VuZFByb2dyZXNzKHRoaXMucHJvZ3Jlc3MpfSxiLl9oYW5kbGVNYW5pZmVzdEVycm9yPWZ1bmN0aW9uKGEpe3ZhciBiPW5ldyBjcmVhdGVqcy5FdmVudChcImZpbGVlcnJvclwiKTtiLml0ZW09YS5kYXRhLHRoaXMuZGlzcGF0Y2hFdmVudChiKX0sY3JlYXRlanMuTWFuaWZlc3RMb2FkZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RMb2FkZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiKXt0aGlzLkFic3RyYWN0TWVkaWFMb2FkZXJfY29uc3RydWN0b3IoYSxiLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNPVU5EKSxjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNBdWRpb1RhZyhhKT90aGlzLl90YWc9YTpjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNBdWRpb1RhZyhhLnNyYyk/dGhpcy5fdGFnPWE6Y3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzQXVkaW9UYWcoYS50YWcpJiYodGhpcy5fdGFnPWNyZWF0ZWpzLlJlcXVlc3RVdGlscy5pc0F1ZGlvVGFnKGEpP2E6YS5zcmMpLG51bGwhPXRoaXMuX3RhZyYmKHRoaXMuX3ByZWZlclhIUj0hMSl9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RNZWRpYUxvYWRlciksYz1hO2MuY2FuTG9hZEl0ZW09ZnVuY3Rpb24oYSl7cmV0dXJuIGEudHlwZT09Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU09VTkR9LGIuX2NyZWF0ZVRhZz1mdW5jdGlvbihhKXt2YXIgYj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXVkaW9cIik7cmV0dXJuIGIuYXV0b3BsYXk9ITEsYi5wcmVsb2FkPVwibm9uZVwiLGIuc3JjPWEsYn0sY3JlYXRlanMuU291bmRMb2FkZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RNZWRpYUxvYWRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIpe3RoaXMuQWJzdHJhY3RNZWRpYUxvYWRlcl9jb25zdHJ1Y3RvcihhLGIsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuVklERU8pLGNyZWF0ZWpzLlJlcXVlc3RVdGlscy5pc1ZpZGVvVGFnKGEpfHxjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNWaWRlb1RhZyhhLnNyYyk/KHRoaXMuc2V0VGFnKGNyZWF0ZWpzLlJlcXVlc3RVdGlscy5pc1ZpZGVvVGFnKGEpP2E6YS5zcmMpLHRoaXMuX3ByZWZlclhIUj0hMSk6dGhpcy5zZXRUYWcodGhpcy5fY3JlYXRlVGFnKCkpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0TWVkaWFMb2FkZXIpLGM9YTtiLl9jcmVhdGVUYWc9ZnVuY3Rpb24oKXtyZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInZpZGVvXCIpfSxjLmNhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3JldHVybiBhLnR5cGU9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlZJREVPfSxjcmVhdGVqcy5WaWRlb0xvYWRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdE1lZGlhTG9hZGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYil7dGhpcy5BYnN0cmFjdExvYWRlcl9jb25zdHJ1Y3RvcihhLGIsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU1BSSVRFU0hFRVQpLHRoaXMuX21hbmlmZXN0UXVldWU9bnVsbH12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5BYnN0cmFjdExvYWRlciksYz1hO2MuU1BSSVRFU0hFRVRfUFJPR1JFU1M9LjI1LGMuY2FuTG9hZEl0ZW09ZnVuY3Rpb24oYSl7cmV0dXJuIGEudHlwZT09Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU1BSSVRFU0hFRVR9LGIuZGVzdHJveT1mdW5jdGlvbigpe3RoaXMuQWJzdHJhY3RMb2FkZXJfZGVzdHJveSx0aGlzLl9tYW5pZmVzdFF1ZXVlLmNsb3NlKCl9LGIuX2NyZWF0ZVJlcXVlc3Q9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLl9pdGVtLmNhbGxiYWNrO251bGwhPWE/dGhpcy5fcmVxdWVzdD1uZXcgY3JlYXRlanMuSlNPTlBMb2FkZXIodGhpcy5faXRlbSk6dGhpcy5fcmVxdWVzdD1uZXcgY3JlYXRlanMuSlNPTkxvYWRlcih0aGlzLl9pdGVtKX0sYi5oYW5kbGVFdmVudD1mdW5jdGlvbihhKXtzd2l0Y2goYS50eXBlKXtjYXNlXCJjb21wbGV0ZVwiOnJldHVybiB0aGlzLl9yYXdSZXN1bHQ9YS50YXJnZXQuZ2V0UmVzdWx0KCEwKSx0aGlzLl9yZXN1bHQ9YS50YXJnZXQuZ2V0UmVzdWx0KCksdGhpcy5fc2VuZFByb2dyZXNzKGMuU1BSSVRFU0hFRVRfUFJPR1JFU1MpLHZvaWQgdGhpcy5fbG9hZE1hbmlmZXN0KHRoaXMuX3Jlc3VsdCk7Y2FzZVwicHJvZ3Jlc3NcIjpyZXR1cm4gYS5sb2FkZWQqPWMuU1BSSVRFU0hFRVRfUFJPR1JFU1MsdGhpcy5wcm9ncmVzcz1hLmxvYWRlZC9hLnRvdGFsLChpc05hTih0aGlzLnByb2dyZXNzKXx8dGhpcy5wcm9ncmVzcz09MS8wKSYmKHRoaXMucHJvZ3Jlc3M9MCksdm9pZCB0aGlzLl9zZW5kUHJvZ3Jlc3MoYSl9dGhpcy5BYnN0cmFjdExvYWRlcl9oYW5kbGVFdmVudChhKX0sYi5fbG9hZE1hbmlmZXN0PWZ1bmN0aW9uKGEpe2lmKGEmJmEuaW1hZ2VzKXt2YXIgYj10aGlzLl9tYW5pZmVzdFF1ZXVlPW5ldyBjcmVhdGVqcy5Mb2FkUXVldWUodGhpcy5fcHJlZmVyWEhSLHRoaXMuX2l0ZW0ucGF0aCx0aGlzLl9pdGVtLmNyb3NzT3JpZ2luKTtiLm9uKFwiY29tcGxldGVcIix0aGlzLl9oYW5kbGVNYW5pZmVzdENvbXBsZXRlLHRoaXMsITApLGIub24oXCJmaWxlbG9hZFwiLHRoaXMuX2hhbmRsZU1hbmlmZXN0RmlsZUxvYWQsdGhpcyksYi5vbihcInByb2dyZXNzXCIsdGhpcy5faGFuZGxlTWFuaWZlc3RQcm9ncmVzcyx0aGlzKSxiLm9uKFwiZXJyb3JcIix0aGlzLl9oYW5kbGVNYW5pZmVzdEVycm9yLHRoaXMsITApLGIubG9hZE1hbmlmZXN0KGEuaW1hZ2VzKX19LGIuX2hhbmRsZU1hbmlmZXN0RmlsZUxvYWQ9ZnVuY3Rpb24oYSl7dmFyIGI9YS5yZXN1bHQ7aWYobnVsbCE9Yil7dmFyIGM9dGhpcy5nZXRSZXN1bHQoKS5pbWFnZXMsZD1jLmluZGV4T2YoYS5pdGVtLnNyYyk7Y1tkXT1ifX0sYi5faGFuZGxlTWFuaWZlc3RDb21wbGV0ZT1mdW5jdGlvbihhKXt0aGlzLl9yZXN1bHQ9bmV3IGNyZWF0ZWpzLlNwcml0ZVNoZWV0KHRoaXMuX3Jlc3VsdCksdGhpcy5fbG9hZGVkSXRlbXM9dGhpcy5fbWFuaWZlc3RRdWV1ZS5nZXRJdGVtcyghMCksdGhpcy5fc2VuZENvbXBsZXRlKCl9LGIuX2hhbmRsZU1hbmlmZXN0UHJvZ3Jlc3M9ZnVuY3Rpb24oYSl7dGhpcy5wcm9ncmVzcz1hLnByb2dyZXNzKigxLWMuU1BSSVRFU0hFRVRfUFJPR1JFU1MpK2MuU1BSSVRFU0hFRVRfUFJPR1JFU1MsdGhpcy5fc2VuZFByb2dyZXNzKHRoaXMucHJvZ3Jlc3MpfSxiLl9oYW5kbGVNYW5pZmVzdEVycm9yPWZ1bmN0aW9uKGEpe3ZhciBiPW5ldyBjcmVhdGVqcy5FdmVudChcImZpbGVlcnJvclwiKTtiLml0ZW09YS5kYXRhLHRoaXMuZGlzcGF0Y2hFdmVudChiKX0sY3JlYXRlanMuU3ByaXRlU2hlZXRMb2FkZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RMb2FkZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiKXt0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsYixjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5TVkcpLHRoaXMucmVzdWx0Rm9ybWF0dGVyPXRoaXMuX2Zvcm1hdFJlc3VsdCx0aGlzLl90YWdTcmNBdHRyaWJ1dGU9XCJkYXRhXCIsYj90aGlzLnNldFRhZyhkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3ZnXCIpKToodGhpcy5zZXRUYWcoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9iamVjdFwiKSksdGhpcy5nZXRUYWcoKS50eXBlPVwiaW1hZ2Uvc3ZnK3htbFwiKX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5BYnN0cmFjdExvYWRlciksYz1hO2MuY2FuTG9hZEl0ZW09ZnVuY3Rpb24oYSl7cmV0dXJuIGEudHlwZT09Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU1ZHfSxiLl9mb3JtYXRSZXN1bHQ9ZnVuY3Rpb24oYSl7dmFyIGI9Y3JlYXRlanMuRGF0YVV0aWxzLnBhcnNlWE1MKGEuZ2V0UmVzdWx0KCEwKSxcInRleHQveG1sXCIpLGM9YS5nZXRUYWcoKTtyZXR1cm4hdGhpcy5fcHJlZmVyWEhSJiZkb2N1bWVudC5ib2R5LmNvbnRhaW5zKGMpJiZkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGMpLG51bGwhPWIuZG9jdW1lbnRFbGVtZW50PyhjLmFwcGVuZENoaWxkKGIuZG9jdW1lbnRFbGVtZW50KSxjLnN0eWxlLnZpc2liaWxpdHk9XCJ2aXNpYmxlXCIsYyk6Yn0sY3JlYXRlanMuU1ZHTG9hZGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0TG9hZGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSwhMCxjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5YTUwpLHRoaXMucmVzdWx0Rm9ybWF0dGVyPXRoaXMuX2Zvcm1hdFJlc3VsdH12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5BYnN0cmFjdExvYWRlciksYz1hO2MuY2FuTG9hZEl0ZW09ZnVuY3Rpb24oYSl7cmV0dXJuIGEudHlwZT09Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuWE1MfSxiLl9mb3JtYXRSZXN1bHQ9ZnVuY3Rpb24oYSl7cmV0dXJuIGNyZWF0ZWpzLkRhdGFVdGlscy5wYXJzZVhNTChhLmdldFJlc3VsdCghMCksXCJ0ZXh0L3htbFwiKX0sY3JlYXRlanMuWE1MTG9hZGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0TG9hZGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXt2YXIgYT1jcmVhdGVqcy5Tb3VuZEpTPWNyZWF0ZWpzLlNvdW5kSlN8fHt9O2EudmVyc2lvbj1cIjAuNi4yXCIsYS5idWlsZERhdGU9XCJUaHUsIDI2IE5vdiAyMDE1IDIwOjQ0OjMxIEdNVFwifSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sY3JlYXRlanMuaW5kZXhPZj1mdW5jdGlvbihhLGIpe1widXNlIHN0cmljdFwiO2Zvcih2YXIgYz0wLGQ9YS5sZW5ndGg7ZD5jO2MrKylpZihiPT09YVtjXSlyZXR1cm4gYztyZXR1cm4tMX0sdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2NyZWF0ZWpzLnByb3h5PWZ1bmN0aW9uKGEsYil7dmFyIGM9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDIpO3JldHVybiBmdW5jdGlvbigpe3JldHVybiBhLmFwcGx5KGIsQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApLmNvbmNhdChjKSl9fX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYSgpe3Rocm93XCJCcm93c2VyRGV0ZWN0IGNhbm5vdCBiZSBpbnN0YW50aWF0ZWRcIn12YXIgYj1hLmFnZW50PXdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50O2EuaXNXaW5kb3dQaG9uZT1iLmluZGV4T2YoXCJJRU1vYmlsZVwiKT4tMXx8Yi5pbmRleE9mKFwiV2luZG93cyBQaG9uZVwiKT4tMSxhLmlzRmlyZWZveD1iLmluZGV4T2YoXCJGaXJlZm94XCIpPi0xLGEuaXNPcGVyYT1udWxsIT13aW5kb3cub3BlcmEsYS5pc0Nocm9tZT1iLmluZGV4T2YoXCJDaHJvbWVcIik+LTEsYS5pc0lPUz0oYi5pbmRleE9mKFwiaVBvZFwiKT4tMXx8Yi5pbmRleE9mKFwiaVBob25lXCIpPi0xfHxiLmluZGV4T2YoXCJpUGFkXCIpPi0xKSYmIWEuaXNXaW5kb3dQaG9uZSxhLmlzQW5kcm9pZD1iLmluZGV4T2YoXCJBbmRyb2lkXCIpPi0xJiYhYS5pc1dpbmRvd1Bob25lLGEuaXNCbGFja2JlcnJ5PWIuaW5kZXhPZihcIkJsYWNrYmVycnlcIik+LTEsY3JlYXRlanMuQnJvd3NlckRldGVjdD1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjt2YXIgYT1mdW5jdGlvbigpe3RoaXMuaW50ZXJydXB0PW51bGwsdGhpcy5kZWxheT1udWxsLHRoaXMub2Zmc2V0PW51bGwsdGhpcy5sb29wPW51bGwsdGhpcy52b2x1bWU9bnVsbCx0aGlzLnBhbj1udWxsLHRoaXMuc3RhcnRUaW1lPW51bGwsdGhpcy5kdXJhdGlvbj1udWxsfSxiPWEucHJvdG90eXBlPXt9LGM9YTtjLmNyZWF0ZT1mdW5jdGlvbihhKXtpZihhIGluc3RhbmNlb2YgY3x8YSBpbnN0YW5jZW9mIE9iamVjdCl7dmFyIGI9bmV3IGNyZWF0ZWpzLlBsYXlQcm9wc0NvbmZpZztyZXR1cm4gYi5zZXQoYSksYn10aHJvdyBuZXcgRXJyb3IoXCJUeXBlIG5vdCByZWNvZ25pemVkLlwiKX0sYi5zZXQ9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiIGluIGEpdGhpc1tiXT1hW2JdO3JldHVybiB0aGlzfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbUGxheVByb3BzQ29uZmlnXVwifSxjcmVhdGVqcy5QbGF5UHJvcHNDb25maWc9Y30oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYSgpe3Rocm93XCJTb3VuZCBjYW5ub3QgYmUgaW5zdGFudGlhdGVkXCJ9ZnVuY3Rpb24gYihhLGIpe3RoaXMuaW5pdChhLGIpfXZhciBjPWE7Yy5JTlRFUlJVUFRfQU5ZPVwiYW55XCIsYy5JTlRFUlJVUFRfRUFSTFk9XCJlYXJseVwiLGMuSU5URVJSVVBUX0xBVEU9XCJsYXRlXCIsYy5JTlRFUlJVUFRfTk9ORT1cIm5vbmVcIixjLlBMQVlfSU5JVEVEPVwicGxheUluaXRlZFwiLGMuUExBWV9TVUNDRUVERUQ9XCJwbGF5U3VjY2VlZGVkXCIsYy5QTEFZX0lOVEVSUlVQVEVEPVwicGxheUludGVycnVwdGVkXCIsYy5QTEFZX0ZJTklTSEVEPVwicGxheUZpbmlzaGVkXCIsYy5QTEFZX0ZBSUxFRD1cInBsYXlGYWlsZWRcIixjLlNVUFBPUlRFRF9FWFRFTlNJT05TPVtcIm1wM1wiLFwib2dnXCIsXCJvcHVzXCIsXCJtcGVnXCIsXCJ3YXZcIixcIm00YVwiLFwibXA0XCIsXCJhaWZmXCIsXCJ3bWFcIixcIm1pZFwiXSxjLkVYVEVOU0lPTl9NQVA9e200YTpcIm1wNFwifSxjLkZJTEVfUEFUVEVSTj0vXig/OihcXHcrOilcXC97Mn0oXFx3Kyg/OlxcLlxcdyspKlxcLz8pKT8oW1xcLy5dKj8oPzpbXj9dKyk/XFwvKT8oKD86W15cXC8/XSspXFwuKFxcdyspKSg/OlxcPyhcXFMrKT8pPyQvLGMuZGVmYXVsdEludGVycnVwdEJlaGF2aW9yPWMuSU5URVJSVVBUX05PTkUsYy5hbHRlcm5hdGVFeHRlbnNpb25zPVtdLGMuYWN0aXZlUGx1Z2luPW51bGwsYy5fbWFzdGVyVm9sdW1lPTEsT2JqZWN0LmRlZmluZVByb3BlcnR5KGMsXCJ2b2x1bWVcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX21hc3RlclZvbHVtZX0sc2V0OmZ1bmN0aW9uKGEpe2lmKG51bGw9PU51bWJlcihhKSlyZXR1cm4hMTtpZihhPU1hdGgubWF4KDAsTWF0aC5taW4oMSxhKSksYy5fbWFzdGVyVm9sdW1lPWEsIXRoaXMuYWN0aXZlUGx1Z2lufHwhdGhpcy5hY3RpdmVQbHVnaW4uc2V0Vm9sdW1lfHwhdGhpcy5hY3RpdmVQbHVnaW4uc2V0Vm9sdW1lKGEpKWZvcih2YXIgYj10aGlzLl9pbnN0YW5jZXMsZD0wLGU9Yi5sZW5ndGg7ZT5kO2QrKyliW2RdLnNldE1hc3RlclZvbHVtZShhKX19KSxjLl9tYXN0ZXJNdXRlPSExLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjLFwibXV0ZWRcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX21hc3Rlck11dGV9LHNldDpmdW5jdGlvbihhKXtpZihudWxsPT1hKXJldHVybiExO2lmKHRoaXMuX21hc3Rlck11dGU9YSwhdGhpcy5hY3RpdmVQbHVnaW58fCF0aGlzLmFjdGl2ZVBsdWdpbi5zZXRNdXRlfHwhdGhpcy5hY3RpdmVQbHVnaW4uc2V0TXV0ZShhKSlmb3IodmFyIGI9dGhpcy5faW5zdGFuY2VzLGM9MCxkPWIubGVuZ3RoO2Q+YztjKyspYltjXS5zZXRNYXN0ZXJNdXRlKGEpO3JldHVybiEwfX0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjLFwiY2FwYWJpbGl0aWVzXCIse2dldDpmdW5jdGlvbigpe3JldHVybiBudWxsPT1jLmFjdGl2ZVBsdWdpbj9udWxsOmMuYWN0aXZlUGx1Z2luLl9jYXBhYmlsaXRpZXN9LHNldDpmdW5jdGlvbihhKXtyZXR1cm4hMX19KSxjLl9wbHVnaW5zUmVnaXN0ZXJlZD0hMSxjLl9sYXN0SUQ9MCxjLl9pbnN0YW5jZXM9W10sYy5faWRIYXNoPXt9LGMuX3ByZWxvYWRIYXNoPXt9LGMuX2RlZmF1bHRQbGF5UHJvcHNIYXNoPXt9LGMuYWRkRXZlbnRMaXN0ZW5lcj1udWxsLGMucmVtb3ZlRXZlbnRMaXN0ZW5lcj1udWxsLGMucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnM9bnVsbCxjLmRpc3BhdGNoRXZlbnQ9bnVsbCxjLmhhc0V2ZW50TGlzdGVuZXI9bnVsbCxjLl9saXN0ZW5lcnM9bnVsbCxjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIuaW5pdGlhbGl6ZShjKSxjLmdldFByZWxvYWRIYW5kbGVycz1mdW5jdGlvbigpe3JldHVybntjYWxsYmFjazpjcmVhdGVqcy5wcm94eShjLmluaXRMb2FkLGMpLHR5cGVzOltcInNvdW5kXCJdLGV4dGVuc2lvbnM6Yy5TVVBQT1JURURfRVhURU5TSU9OU319LGMuX2hhbmRsZUxvYWRDb21wbGV0ZT1mdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldC5nZXRJdGVtKCkuc3JjO2lmKGMuX3ByZWxvYWRIYXNoW2JdKWZvcih2YXIgZD0wLGU9Yy5fcHJlbG9hZEhhc2hbYl0ubGVuZ3RoO2U+ZDtkKyspe3ZhciBmPWMuX3ByZWxvYWRIYXNoW2JdW2RdO2lmKGMuX3ByZWxvYWRIYXNoW2JdW2RdPSEwLGMuaGFzRXZlbnRMaXN0ZW5lcihcImZpbGVsb2FkXCIpKXt2YXIgYT1uZXcgY3JlYXRlanMuRXZlbnQoXCJmaWxlbG9hZFwiKTthLnNyYz1mLnNyYyxhLmlkPWYuaWQsYS5kYXRhPWYuZGF0YSxhLnNwcml0ZT1mLnNwcml0ZSxjLmRpc3BhdGNoRXZlbnQoYSl9fX0sYy5faGFuZGxlTG9hZEVycm9yPWZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0LmdldEl0ZW0oKS5zcmM7aWYoYy5fcHJlbG9hZEhhc2hbYl0pZm9yKHZhciBkPTAsZT1jLl9wcmVsb2FkSGFzaFtiXS5sZW5ndGg7ZT5kO2QrKyl7dmFyIGY9Yy5fcHJlbG9hZEhhc2hbYl1bZF07aWYoYy5fcHJlbG9hZEhhc2hbYl1bZF09ITEsYy5oYXNFdmVudExpc3RlbmVyKFwiZmlsZWVycm9yXCIpKXt2YXIgYT1uZXcgY3JlYXRlanMuRXZlbnQoXCJmaWxlZXJyb3JcIik7YS5zcmM9Zi5zcmMsYS5pZD1mLmlkLGEuZGF0YT1mLmRhdGEsYS5zcHJpdGU9Zi5zcHJpdGUsYy5kaXNwYXRjaEV2ZW50KGEpfX19LGMuX3JlZ2lzdGVyUGx1Z2luPWZ1bmN0aW9uKGEpe3JldHVybiBhLmlzU3VwcG9ydGVkKCk/KGMuYWN0aXZlUGx1Z2luPW5ldyBhLCEwKTohMX0sYy5yZWdpc3RlclBsdWdpbnM9ZnVuY3Rpb24oYSl7Yy5fcGx1Z2luc1JlZ2lzdGVyZWQ9ITA7Zm9yKHZhciBiPTAsZD1hLmxlbmd0aDtkPmI7YisrKWlmKGMuX3JlZ2lzdGVyUGx1Z2luKGFbYl0pKXJldHVybiEwO3JldHVybiExfSxjLmluaXRpYWxpemVEZWZhdWx0UGx1Z2lucz1mdW5jdGlvbigpe3JldHVybiBudWxsIT1jLmFjdGl2ZVBsdWdpbj8hMDpjLl9wbHVnaW5zUmVnaXN0ZXJlZD8hMTpjLnJlZ2lzdGVyUGx1Z2lucyhbY3JlYXRlanMuV2ViQXVkaW9QbHVnaW4sY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luXSk/ITA6ITF9LGMuaXNSZWFkeT1mdW5jdGlvbigpe3JldHVybiBudWxsIT1jLmFjdGl2ZVBsdWdpbn0sYy5nZXRDYXBhYmlsaXRpZXM9ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbD09Yy5hY3RpdmVQbHVnaW4/bnVsbDpjLmFjdGl2ZVBsdWdpbi5fY2FwYWJpbGl0aWVzfSxjLmdldENhcGFiaWxpdHk9ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGw9PWMuYWN0aXZlUGx1Z2luP251bGw6Yy5hY3RpdmVQbHVnaW4uX2NhcGFiaWxpdGllc1thXX0sYy5pbml0TG9hZD1mdW5jdGlvbihhKXtyZXR1cm4gYy5fcmVnaXN0ZXJTb3VuZChhKX0sYy5fcmVnaXN0ZXJTb3VuZD1mdW5jdGlvbihhKXtpZighYy5pbml0aWFsaXplRGVmYXVsdFBsdWdpbnMoKSlyZXR1cm4hMTt2YXIgZDtpZihhLnNyYyBpbnN0YW5jZW9mIE9iamVjdD8oZD1jLl9wYXJzZVNyYyhhLnNyYyksZC5zcmM9YS5wYXRoK2Quc3JjKTpkPWMuX3BhcnNlUGF0aChhLnNyYyksbnVsbD09ZClyZXR1cm4hMTthLnNyYz1kLnNyYyxhLnR5cGU9XCJzb3VuZFwiO3ZhciBlPWEuZGF0YSxmPW51bGw7aWYobnVsbCE9ZSYmKGlzTmFOKGUuY2hhbm5lbHMpP2lzTmFOKGUpfHwoZj1wYXJzZUludChlKSk6Zj1wYXJzZUludChlLmNoYW5uZWxzKSxlLmF1ZGlvU3ByaXRlKSlmb3IodmFyIGcsaD1lLmF1ZGlvU3ByaXRlLmxlbmd0aDtoLS07KWc9ZS5hdWRpb1Nwcml0ZVtoXSxjLl9pZEhhc2hbZy5pZF09e3NyYzphLnNyYyxzdGFydFRpbWU6cGFyc2VJbnQoZy5zdGFydFRpbWUpLGR1cmF0aW9uOnBhcnNlSW50KGcuZHVyYXRpb24pfSxnLmRlZmF1bHRQbGF5UHJvcHMmJihjLl9kZWZhdWx0UGxheVByb3BzSGFzaFtnLmlkXT1jcmVhdGVqcy5QbGF5UHJvcHNDb25maWcuY3JlYXRlKGcuZGVmYXVsdFBsYXlQcm9wcykpO251bGwhPWEuaWQmJihjLl9pZEhhc2hbYS5pZF09e3NyYzphLnNyY30pO3ZhciBpPWMuYWN0aXZlUGx1Z2luLnJlZ2lzdGVyKGEpO3JldHVybiBiLmNyZWF0ZShhLnNyYyxmKSxudWxsIT1lJiZpc05hTihlKT9hLmRhdGEuY2hhbm5lbHM9Znx8Yi5tYXhQZXJDaGFubmVsKCk6YS5kYXRhPWZ8fGIubWF4UGVyQ2hhbm5lbCgpLGkudHlwZSYmKGEudHlwZT1pLnR5cGUpLGEuZGVmYXVsdFBsYXlQcm9wcyYmKGMuX2RlZmF1bHRQbGF5UHJvcHNIYXNoW2Euc3JjXT1jcmVhdGVqcy5QbGF5UHJvcHNDb25maWcuY3JlYXRlKGEuZGVmYXVsdFBsYXlQcm9wcykpLGl9LGMucmVnaXN0ZXJTb3VuZD1mdW5jdGlvbihhLGIsZCxlLGYpe3ZhciBnPXtzcmM6YSxpZDpiLGRhdGE6ZCxkZWZhdWx0UGxheVByb3BzOmZ9O2EgaW5zdGFuY2VvZiBPYmplY3QmJmEuc3JjJiYoZT1iLGc9YSksZz1jcmVhdGVqcy5Mb2FkSXRlbS5jcmVhdGUoZyksZy5wYXRoPWUsbnVsbD09ZXx8Zy5zcmMgaW5zdGFuY2VvZiBPYmplY3R8fChnLnNyYz1lK2EpO3ZhciBoPWMuX3JlZ2lzdGVyU291bmQoZyk7aWYoIWgpcmV0dXJuITE7aWYoYy5fcHJlbG9hZEhhc2hbZy5zcmNdfHwoYy5fcHJlbG9hZEhhc2hbZy5zcmNdPVtdKSxjLl9wcmVsb2FkSGFzaFtnLnNyY10ucHVzaChnKSwxPT1jLl9wcmVsb2FkSGFzaFtnLnNyY10ubGVuZ3RoKWgub24oXCJjb21wbGV0ZVwiLGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUxvYWRDb21wbGV0ZSx0aGlzKSksaC5vbihcImVycm9yXCIsY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlTG9hZEVycm9yLHRoaXMpKSxjLmFjdGl2ZVBsdWdpbi5wcmVsb2FkKGgpO2Vsc2UgaWYoMT09Yy5fcHJlbG9hZEhhc2hbZy5zcmNdWzBdKXJldHVybiEwO3JldHVybiBnfSxjLnJlZ2lzdGVyU291bmRzPWZ1bmN0aW9uKGEsYil7dmFyIGM9W107YS5wYXRoJiYoYj9iKz1hLnBhdGg6Yj1hLnBhdGgsYT1hLm1hbmlmZXN0KTtmb3IodmFyIGQ9MCxlPWEubGVuZ3RoO2U+ZDtkKyspY1tkXT1jcmVhdGVqcy5Tb3VuZC5yZWdpc3RlclNvdW5kKGFbZF0uc3JjLGFbZF0uaWQsYVtkXS5kYXRhLGIsYVtkXS5kZWZhdWx0UGxheVByb3BzKTtyZXR1cm4gY30sYy5yZW1vdmVTb3VuZD1mdW5jdGlvbihhLGQpe2lmKG51bGw9PWMuYWN0aXZlUGx1Z2luKXJldHVybiExO2EgaW5zdGFuY2VvZiBPYmplY3QmJmEuc3JjJiYoYT1hLnNyYyk7dmFyIGU7aWYoYSBpbnN0YW5jZW9mIE9iamVjdD9lPWMuX3BhcnNlU3JjKGEpOihhPWMuX2dldFNyY0J5SWQoYSkuc3JjLGU9Yy5fcGFyc2VQYXRoKGEpKSxudWxsPT1lKXJldHVybiExO2E9ZS5zcmMsbnVsbCE9ZCYmKGE9ZCthKTtmb3IodmFyIGYgaW4gYy5faWRIYXNoKWMuX2lkSGFzaFtmXS5zcmM9PWEmJmRlbGV0ZSBjLl9pZEhhc2hbZl07cmV0dXJuIGIucmVtb3ZlU3JjKGEpLGRlbGV0ZSBjLl9wcmVsb2FkSGFzaFthXSxjLmFjdGl2ZVBsdWdpbi5yZW1vdmVTb3VuZChhKSwhMH0sYy5yZW1vdmVTb3VuZHM9ZnVuY3Rpb24oYSxiKXt2YXIgYz1bXTthLnBhdGgmJihiP2IrPWEucGF0aDpiPWEucGF0aCxhPWEubWFuaWZlc3QpO2Zvcih2YXIgZD0wLGU9YS5sZW5ndGg7ZT5kO2QrKyljW2RdPWNyZWF0ZWpzLlNvdW5kLnJlbW92ZVNvdW5kKGFbZF0uc3JjLGIpO3JldHVybiBjfSxjLnJlbW92ZUFsbFNvdW5kcz1mdW5jdGlvbigpe2MuX2lkSGFzaD17fSxjLl9wcmVsb2FkSGFzaD17fSxiLnJlbW92ZUFsbCgpLGMuYWN0aXZlUGx1Z2luJiZjLmFjdGl2ZVBsdWdpbi5yZW1vdmVBbGxTb3VuZHMoKX0sYy5sb2FkQ29tcGxldGU9ZnVuY3Rpb24oYSl7aWYoIWMuaXNSZWFkeSgpKXJldHVybiExO3ZhciBiPWMuX3BhcnNlUGF0aChhKTtyZXR1cm4gYT1iP2MuX2dldFNyY0J5SWQoYi5zcmMpLnNyYzpjLl9nZXRTcmNCeUlkKGEpLnNyYyx2b2lkIDA9PWMuX3ByZWxvYWRIYXNoW2FdPyExOjE9PWMuX3ByZWxvYWRIYXNoW2FdWzBdfSxjLl9wYXJzZVBhdGg9ZnVuY3Rpb24oYSl7XCJzdHJpbmdcIiE9dHlwZW9mIGEmJihhPWEudG9TdHJpbmcoKSk7dmFyIGI9YS5tYXRjaChjLkZJTEVfUEFUVEVSTik7aWYobnVsbD09YilyZXR1cm4hMTtmb3IodmFyIGQ9Yls0XSxlPWJbNV0sZj1jLmNhcGFiaWxpdGllcyxnPTA7IWZbZV07KWlmKGU9Yy5hbHRlcm5hdGVFeHRlbnNpb25zW2crK10sZz5jLmFsdGVybmF0ZUV4dGVuc2lvbnMubGVuZ3RoKXJldHVybiBudWxsO2E9YS5yZXBsYWNlKFwiLlwiK2JbNV0sXCIuXCIrZSk7dmFyIGg9e25hbWU6ZCxzcmM6YSxleHRlbnNpb246ZX07cmV0dXJuIGh9LGMuX3BhcnNlU3JjPWZ1bmN0aW9uKGEpe3ZhciBiPXtuYW1lOnZvaWQgMCxzcmM6dm9pZCAwLGV4dGVuc2lvbjp2b2lkIDB9LGQ9Yy5jYXBhYmlsaXRpZXM7Zm9yKHZhciBlIGluIGEpaWYoYS5oYXNPd25Qcm9wZXJ0eShlKSYmZFtlXSl7Yi5zcmM9YVtlXSxiLmV4dGVuc2lvbj1lO2JyZWFrfWlmKCFiLnNyYylyZXR1cm4hMTt2YXIgZj1iLnNyYy5sYXN0SW5kZXhPZihcIi9cIik7cmV0dXJuLTEhPWY/Yi5uYW1lPWIuc3JjLnNsaWNlKGYrMSk6Yi5uYW1lPWIuc3JjLGJ9LGMucGxheT1mdW5jdGlvbihhLGIsZCxlLGYsZyxoLGksail7dmFyIGs7az1iIGluc3RhbmNlb2YgT2JqZWN0fHxiIGluc3RhbmNlb2YgY3JlYXRlanMuUGxheVByb3BzQ29uZmlnP2NyZWF0ZWpzLlBsYXlQcm9wc0NvbmZpZy5jcmVhdGUoYik6Y3JlYXRlanMuUGxheVByb3BzQ29uZmlnLmNyZWF0ZSh7aW50ZXJydXB0OmIsZGVsYXk6ZCxvZmZzZXQ6ZSxsb29wOmYsdm9sdW1lOmcscGFuOmgsc3RhcnRUaW1lOmksZHVyYXRpb246an0pO3ZhciBsPWMuY3JlYXRlSW5zdGFuY2UoYSxrLnN0YXJ0VGltZSxrLmR1cmF0aW9uKSxtPWMuX3BsYXlJbnN0YW5jZShsLGspO3JldHVybiBtfHxsLl9wbGF5RmFpbGVkKCksbH0sYy5jcmVhdGVJbnN0YW5jZT1mdW5jdGlvbihhLGQsZSl7aWYoIWMuaW5pdGlhbGl6ZURlZmF1bHRQbHVnaW5zKCkpcmV0dXJuIG5ldyBjcmVhdGVqcy5EZWZhdWx0U291bmRJbnN0YW5jZShhLGQsZSk7dmFyIGY9Yy5fZGVmYXVsdFBsYXlQcm9wc0hhc2hbYV07YT1jLl9nZXRTcmNCeUlkKGEpO3ZhciBnPWMuX3BhcnNlUGF0aChhLnNyYyksaD1udWxsO3JldHVybiBudWxsIT1nJiZudWxsIT1nLnNyYz8oYi5jcmVhdGUoZy5zcmMpLG51bGw9PWQmJihkPWEuc3RhcnRUaW1lKSxoPWMuYWN0aXZlUGx1Z2luLmNyZWF0ZShnLnNyYyxkLGV8fGEuZHVyYXRpb24pLGY9Znx8Yy5fZGVmYXVsdFBsYXlQcm9wc0hhc2hbZy5zcmNdLGYmJmguYXBwbHlQbGF5UHJvcHMoZikpOmg9bmV3IGNyZWF0ZWpzLkRlZmF1bHRTb3VuZEluc3RhbmNlKGEsZCxlKSxoLnVuaXF1ZUlkPWMuX2xhc3RJRCsrLGh9LGMuc3RvcD1mdW5jdGlvbigpe2Zvcih2YXIgYT10aGlzLl9pbnN0YW5jZXMsYj1hLmxlbmd0aDtiLS07KWFbYl0uc3RvcCgpfSxjLnNldFZvbHVtZT1mdW5jdGlvbihhKXtpZihudWxsPT1OdW1iZXIoYSkpcmV0dXJuITE7aWYoYT1NYXRoLm1heCgwLE1hdGgubWluKDEsYSkpLGMuX21hc3RlclZvbHVtZT1hLCF0aGlzLmFjdGl2ZVBsdWdpbnx8IXRoaXMuYWN0aXZlUGx1Z2luLnNldFZvbHVtZXx8IXRoaXMuYWN0aXZlUGx1Z2luLnNldFZvbHVtZShhKSlmb3IodmFyIGI9dGhpcy5faW5zdGFuY2VzLGQ9MCxlPWIubGVuZ3RoO2U+ZDtkKyspYltkXS5zZXRNYXN0ZXJWb2x1bWUoYSl9LGMuZ2V0Vm9sdW1lPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX21hc3RlclZvbHVtZX0sYy5zZXRNdXRlPWZ1bmN0aW9uKGEpe2lmKG51bGw9PWEpcmV0dXJuITE7aWYodGhpcy5fbWFzdGVyTXV0ZT1hLCF0aGlzLmFjdGl2ZVBsdWdpbnx8IXRoaXMuYWN0aXZlUGx1Z2luLnNldE11dGV8fCF0aGlzLmFjdGl2ZVBsdWdpbi5zZXRNdXRlKGEpKWZvcih2YXIgYj10aGlzLl9pbnN0YW5jZXMsYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyliW2NdLnNldE1hc3Rlck11dGUoYSk7cmV0dXJuITB9LGMuZ2V0TXV0ZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9tYXN0ZXJNdXRlfSxjLnNldERlZmF1bHRQbGF5UHJvcHM9ZnVuY3Rpb24oYSxiKXthPWMuX2dldFNyY0J5SWQoYSksYy5fZGVmYXVsdFBsYXlQcm9wc0hhc2hbYy5fcGFyc2VQYXRoKGEuc3JjKS5zcmNdPWNyZWF0ZWpzLlBsYXlQcm9wc0NvbmZpZy5jcmVhdGUoYil9LGMuZ2V0RGVmYXVsdFBsYXlQcm9wcz1mdW5jdGlvbihhKXtyZXR1cm4gYT1jLl9nZXRTcmNCeUlkKGEpLGMuX2RlZmF1bHRQbGF5UHJvcHNIYXNoW2MuX3BhcnNlUGF0aChhLnNyYykuc3JjXX0sYy5fcGxheUluc3RhbmNlPWZ1bmN0aW9uKGEsYil7dmFyIGQ9Yy5fZGVmYXVsdFBsYXlQcm9wc0hhc2hbYS5zcmNdfHx7fTtpZihudWxsPT1iLmludGVycnVwdCYmKGIuaW50ZXJydXB0PWQuaW50ZXJydXB0fHxjLmRlZmF1bHRJbnRlcnJ1cHRCZWhhdmlvciksbnVsbD09Yi5kZWxheSYmKGIuZGVsYXk9ZC5kZWxheXx8MCksbnVsbD09Yi5vZmZzZXQmJihiLm9mZnNldD1hLmdldFBvc2l0aW9uKCkpLG51bGw9PWIubG9vcCYmKGIubG9vcD1hLmxvb3ApLG51bGw9PWIudm9sdW1lJiYoYi52b2x1bWU9YS52b2x1bWUpLG51bGw9PWIucGFuJiYoYi5wYW49YS5wYW4pLDA9PWIuZGVsYXkpe3ZhciBlPWMuX2JlZ2luUGxheWluZyhhLGIpO2lmKCFlKXJldHVybiExfWVsc2V7dmFyIGY9c2V0VGltZW91dChmdW5jdGlvbigpe2MuX2JlZ2luUGxheWluZyhhLGIpfSxiLmRlbGF5KTthLmRlbGF5VGltZW91dElkPWZ9cmV0dXJuIHRoaXMuX2luc3RhbmNlcy5wdXNoKGEpLCEwfSxjLl9iZWdpblBsYXlpbmc9ZnVuY3Rpb24oYSxjKXtpZighYi5hZGQoYSxjLmludGVycnVwdCkpcmV0dXJuITE7dmFyIGQ9YS5fYmVnaW5QbGF5aW5nKGMpO2lmKCFkKXt2YXIgZT1jcmVhdGVqcy5pbmRleE9mKHRoaXMuX2luc3RhbmNlcyxhKTtyZXR1cm4gZT4tMSYmdGhpcy5faW5zdGFuY2VzLnNwbGljZShlLDEpLCExfXJldHVybiEwfSxjLl9nZXRTcmNCeUlkPWZ1bmN0aW9uKGEpe3JldHVybiBjLl9pZEhhc2hbYV18fHtzcmM6YX19LGMuX3BsYXlGaW5pc2hlZD1mdW5jdGlvbihhKXtiLnJlbW92ZShhKTt2YXIgYz1jcmVhdGVqcy5pbmRleE9mKHRoaXMuX2luc3RhbmNlcyxhKTtjPi0xJiZ0aGlzLl9pbnN0YW5jZXMuc3BsaWNlKGMsMSl9LGNyZWF0ZWpzLlNvdW5kPWEsYi5jaGFubmVscz17fSxiLmNyZWF0ZT1mdW5jdGlvbihhLGMpe3ZhciBkPWIuZ2V0KGEpO3JldHVybiBudWxsPT1kPyhiLmNoYW5uZWxzW2FdPW5ldyBiKGEsYyksITApOiExfSxiLnJlbW92ZVNyYz1mdW5jdGlvbihhKXt2YXIgYz1iLmdldChhKTtyZXR1cm4gbnVsbD09Yz8hMTooYy5fcmVtb3ZlQWxsKCksZGVsZXRlIGIuY2hhbm5lbHNbYV0sITApfSxiLnJlbW92ZUFsbD1mdW5jdGlvbigpe2Zvcih2YXIgYSBpbiBiLmNoYW5uZWxzKWIuY2hhbm5lbHNbYV0uX3JlbW92ZUFsbCgpO2IuY2hhbm5lbHM9e319LGIuYWRkPWZ1bmN0aW9uKGEsYyl7dmFyIGQ9Yi5nZXQoYS5zcmMpO3JldHVybiBudWxsPT1kPyExOmQuX2FkZChhLGMpfSxiLnJlbW92ZT1mdW5jdGlvbihhKXt2YXIgYz1iLmdldChhLnNyYyk7cmV0dXJuIG51bGw9PWM/ITE6KGMuX3JlbW92ZShhKSwhMCl9LGIubWF4UGVyQ2hhbm5lbD1mdW5jdGlvbigpe3JldHVybiBkLm1heERlZmF1bHR9LGIuZ2V0PWZ1bmN0aW9uKGEpe3JldHVybiBiLmNoYW5uZWxzW2FdfTt2YXIgZD1iLnByb3RvdHlwZTtkLmNvbnN0cnVjdG9yPWIsZC5zcmM9bnVsbCxkLm1heD1udWxsLGQubWF4RGVmYXVsdD0xMDAsZC5sZW5ndGg9MCxkLmluaXQ9ZnVuY3Rpb24oYSxiKXt0aGlzLnNyYz1hLHRoaXMubWF4PWJ8fHRoaXMubWF4RGVmYXVsdCwtMT09dGhpcy5tYXgmJih0aGlzLm1heD10aGlzLm1heERlZmF1bHQpLHRoaXMuX2luc3RhbmNlcz1bXX0sZC5fZ2V0PWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl9pbnN0YW5jZXNbYV19LGQuX2FkZD1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLl9nZXRTbG90KGIsYSk/KHRoaXMuX2luc3RhbmNlcy5wdXNoKGEpLHRoaXMubGVuZ3RoKyssITApOiExfSxkLl9yZW1vdmU9ZnVuY3Rpb24oYSl7dmFyIGI9Y3JlYXRlanMuaW5kZXhPZih0aGlzLl9pbnN0YW5jZXMsYSk7cmV0dXJuLTE9PWI/ITE6KHRoaXMuX2luc3RhbmNlcy5zcGxpY2UoYiwxKSx0aGlzLmxlbmd0aC0tLCEwKX0sZC5fcmVtb3ZlQWxsPWZ1bmN0aW9uKCl7Zm9yKHZhciBhPXRoaXMubGVuZ3RoLTE7YT49MDthLS0pdGhpcy5faW5zdGFuY2VzW2FdLnN0b3AoKX0sZC5fZ2V0U2xvdD1mdW5jdGlvbihiLGMpe3ZhciBkLGU7aWYoYiE9YS5JTlRFUlJVUFRfTk9ORSYmKGU9dGhpcy5fZ2V0KDApLG51bGw9PWUpKXJldHVybiEwO2Zvcih2YXIgZj0wLGc9dGhpcy5tYXg7Zz5mO2YrKyl7aWYoZD10aGlzLl9nZXQoZiksbnVsbD09ZClyZXR1cm4hMDtpZihkLnBsYXlTdGF0ZT09YS5QTEFZX0ZJTklTSEVEfHxkLnBsYXlTdGF0ZT09YS5QTEFZX0lOVEVSUlVQVEVEfHxkLnBsYXlTdGF0ZT09YS5QTEFZX0ZBSUxFRCl7ZT1kO2JyZWFrfWIhPWEuSU5URVJSVVBUX05PTkUmJihiPT1hLklOVEVSUlVQVF9FQVJMWSYmZC5nZXRQb3NpdGlvbigpPGUuZ2V0UG9zaXRpb24oKXx8Yj09YS5JTlRFUlJVUFRfTEFURSYmZC5nZXRQb3NpdGlvbigpPmUuZ2V0UG9zaXRpb24oKSkmJihlPWQpfXJldHVybiBudWxsIT1lPyhlLl9pbnRlcnJ1cHQoKSx0aGlzLl9yZW1vdmUoZSksITApOiExfSxkLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbU291bmQgU291bmRDaGFubmVsXVwifX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7dmFyIGE9ZnVuY3Rpb24oYSxiLGMsZCl7dGhpcy5FdmVudERpc3BhdGNoZXJfY29uc3RydWN0b3IoKSx0aGlzLnNyYz1hLHRoaXMudW5pcXVlSWQ9LTEsdGhpcy5wbGF5U3RhdGU9bnVsbCx0aGlzLmRlbGF5VGltZW91dElkPW51bGwsdGhpcy5fdm9sdW1lPTEsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsXCJ2b2x1bWVcIix7Z2V0OnRoaXMuZ2V0Vm9sdW1lLHNldDp0aGlzLnNldFZvbHVtZX0pLHRoaXMuX3Bhbj0wLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLFwicGFuXCIse2dldDp0aGlzLmdldFBhbixzZXQ6dGhpcy5zZXRQYW59KSx0aGlzLl9zdGFydFRpbWU9TWF0aC5tYXgoMCxifHwwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcyxcInN0YXJ0VGltZVwiLHtnZXQ6dGhpcy5nZXRTdGFydFRpbWUsc2V0OnRoaXMuc2V0U3RhcnRUaW1lfSksdGhpcy5fZHVyYXRpb249TWF0aC5tYXgoMCxjfHwwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcyxcImR1cmF0aW9uXCIse2dldDp0aGlzLmdldER1cmF0aW9uLHNldDp0aGlzLnNldER1cmF0aW9ufSksdGhpcy5fcGxheWJhY2tSZXNvdXJjZT1udWxsLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLFwicGxheWJhY2tSZXNvdXJjZVwiLHtnZXQ6dGhpcy5nZXRQbGF5YmFja1Jlc291cmNlLHNldDp0aGlzLnNldFBsYXliYWNrUmVzb3VyY2V9KSxkIT09ITEmJmQhPT0hMCYmdGhpcy5zZXRQbGF5YmFja1Jlc291cmNlKGQpLHRoaXMuX3Bvc2l0aW9uPTAsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsXCJwb3NpdGlvblwiLHtnZXQ6dGhpcy5nZXRQb3NpdGlvbixzZXQ6dGhpcy5zZXRQb3NpdGlvbn0pLHRoaXMuX2xvb3A9MCxPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcyxcImxvb3BcIix7Z2V0OnRoaXMuZ2V0TG9vcCxzZXQ6dGhpcy5zZXRMb29wfSksdGhpcy5fbXV0ZWQ9ITEsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsXCJtdXRlZFwiLHtnZXQ6dGhpcy5nZXRNdXRlZCxzZXQ6dGhpcy5zZXRNdXRlZH0pLHRoaXMuX3BhdXNlZD0hMSxPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcyxcInBhdXNlZFwiLHtnZXQ6dGhpcy5nZXRQYXVzZWQsc2V0OnRoaXMuc2V0UGF1c2VkfSl9LGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuRXZlbnREaXNwYXRjaGVyKTtiLnBsYXk9ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe3ZhciBnO3JldHVybiBnPWEgaW5zdGFuY2VvZiBPYmplY3R8fGEgaW5zdGFuY2VvZiBjcmVhdGVqcy5QbGF5UHJvcHNDb25maWc/Y3JlYXRlanMuUGxheVByb3BzQ29uZmlnLmNyZWF0ZShhKTpjcmVhdGVqcy5QbGF5UHJvcHNDb25maWcuY3JlYXRlKHtpbnRlcnJ1cHQ6YSxkZWxheTpiLG9mZnNldDpjLGxvb3A6ZCx2b2x1bWU6ZSxwYW46Zn0pLHRoaXMucGxheVN0YXRlPT1jcmVhdGVqcy5Tb3VuZC5QTEFZX1NVQ0NFRURFRD8odGhpcy5hcHBseVBsYXlQcm9wcyhnKSx2b2lkKHRoaXMuX3BhdXNlZCYmdGhpcy5zZXRQYXVzZWQoITEpKSk6KHRoaXMuX2NsZWFuVXAoKSxjcmVhdGVqcy5Tb3VuZC5fcGxheUluc3RhbmNlKHRoaXMsZyksdGhpcyl9LGIuc3RvcD1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9wb3NpdGlvbj0wLHRoaXMuX3BhdXNlZD0hMSx0aGlzLl9oYW5kbGVTdG9wKCksdGhpcy5fY2xlYW5VcCgpLHRoaXMucGxheVN0YXRlPWNyZWF0ZWpzLlNvdW5kLlBMQVlfRklOSVNIRUQsdGhpc30sYi5kZXN0cm95PWZ1bmN0aW9uKCl7dGhpcy5fY2xlYW5VcCgpLHRoaXMuc3JjPW51bGwsdGhpcy5wbGF5YmFja1Jlc291cmNlPW51bGwsdGhpcy5yZW1vdmVBbGxFdmVudExpc3RlbmVycygpfSxiLmFwcGx5UGxheVByb3BzPWZ1bmN0aW9uKGEpe3JldHVybiBudWxsIT1hLm9mZnNldCYmdGhpcy5zZXRQb3NpdGlvbihhLm9mZnNldCksbnVsbCE9YS5sb29wJiZ0aGlzLnNldExvb3AoYS5sb29wKSxudWxsIT1hLnZvbHVtZSYmdGhpcy5zZXRWb2x1bWUoYS52b2x1bWUpLG51bGwhPWEucGFuJiZ0aGlzLnNldFBhbihhLnBhbiksbnVsbCE9YS5zdGFydFRpbWUmJih0aGlzLnNldFN0YXJ0VGltZShhLnN0YXJ0VGltZSksdGhpcy5zZXREdXJhdGlvbihhLmR1cmF0aW9uKSksdGhpc30sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0Fic3RyYWN0U291bmRJbnN0YW5jZV1cIn0sYi5nZXRQYXVzZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcGF1c2VkfSxiLnNldFBhdXNlZD1mdW5jdGlvbihhKXtyZXR1cm4gYSE9PSEwJiZhIT09ITF8fHRoaXMuX3BhdXNlZD09YXx8MT09YSYmdGhpcy5wbGF5U3RhdGUhPWNyZWF0ZWpzLlNvdW5kLlBMQVlfU1VDQ0VFREVEP3ZvaWQgMDoodGhpcy5fcGF1c2VkPWEsYT90aGlzLl9wYXVzZSgpOnRoaXMuX3Jlc3VtZSgpLGNsZWFyVGltZW91dCh0aGlzLmRlbGF5VGltZW91dElkKSx0aGlzKX0sYi5zZXRWb2x1bWU9ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PXRoaXMuX3ZvbHVtZT90aGlzOih0aGlzLl92b2x1bWU9TWF0aC5tYXgoMCxNYXRoLm1pbigxLGEpKSx0aGlzLl9tdXRlZHx8dGhpcy5fdXBkYXRlVm9sdW1lKCksdGhpcyl9LGIuZ2V0Vm9sdW1lPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3ZvbHVtZX0sYi5zZXRNdXRlZD1mdW5jdGlvbihhKXtyZXR1cm4gYT09PSEwfHxhPT09ITE/KHRoaXMuX211dGVkPWEsdGhpcy5fdXBkYXRlVm9sdW1lKCksdGhpcyk6dm9pZCAwfSxiLmdldE11dGVkPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX211dGVkfSxiLnNldFBhbj1mdW5jdGlvbihhKXtyZXR1cm4gYT09dGhpcy5fcGFuP3RoaXM6KHRoaXMuX3Bhbj1NYXRoLm1heCgtMSxNYXRoLm1pbigxLGEpKSx0aGlzLl91cGRhdGVQYW4oKSx0aGlzKX0sYi5nZXRQYW49ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcGFufSxiLmdldFBvc2l0aW9uPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3BhdXNlZHx8dGhpcy5wbGF5U3RhdGUhPWNyZWF0ZWpzLlNvdW5kLlBMQVlfU1VDQ0VFREVEfHwodGhpcy5fcG9zaXRpb249dGhpcy5fY2FsY3VsYXRlQ3VycmVudFBvc2l0aW9uKCkpLHRoaXMuX3Bvc2l0aW9ufSxiLnNldFBvc2l0aW9uPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl9wb3NpdGlvbj1NYXRoLm1heCgwLGEpLHRoaXMucGxheVN0YXRlPT1jcmVhdGVqcy5Tb3VuZC5QTEFZX1NVQ0NFRURFRCYmdGhpcy5fdXBkYXRlUG9zaXRpb24oKSx0aGlzfSxiLmdldFN0YXJ0VGltZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9zdGFydFRpbWV9LGIuc2V0U3RhcnRUaW1lPWZ1bmN0aW9uKGEpe3JldHVybiBhPT10aGlzLl9zdGFydFRpbWU/dGhpczoodGhpcy5fc3RhcnRUaW1lPU1hdGgubWF4KDAsYXx8MCksdGhpcy5fdXBkYXRlU3RhcnRUaW1lKCksdGhpcyl9LGIuZ2V0RHVyYXRpb249ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZHVyYXRpb259LGIuc2V0RHVyYXRpb249ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PXRoaXMuX2R1cmF0aW9uP3RoaXM6KHRoaXMuX2R1cmF0aW9uPU1hdGgubWF4KDAsYXx8MCksdGhpcy5fdXBkYXRlRHVyYXRpb24oKSx0aGlzKX0sYi5zZXRQbGF5YmFja1Jlc291cmNlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl9wbGF5YmFja1Jlc291cmNlPWEsMD09dGhpcy5fZHVyYXRpb24mJnRoaXMuX3NldER1cmF0aW9uRnJvbVNvdXJjZSgpLHRoaXN9LGIuZ2V0UGxheWJhY2tSZXNvdXJjZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9wbGF5YmFja1Jlc291cmNlfSxiLmdldExvb3A9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbG9vcH0sYi5zZXRMb29wPWZ1bmN0aW9uKGEpe251bGwhPXRoaXMuX3BsYXliYWNrUmVzb3VyY2UmJigwIT10aGlzLl9sb29wJiYwPT1hP3RoaXMuX3JlbW92ZUxvb3BpbmcoYSk6MD09dGhpcy5fbG9vcCYmMCE9YSYmdGhpcy5fYWRkTG9vcGluZyhhKSksdGhpcy5fbG9vcD1hfSxiLl9zZW5kRXZlbnQ9ZnVuY3Rpb24oYSl7dmFyIGI9bmV3IGNyZWF0ZWpzLkV2ZW50KGEpO3RoaXMuZGlzcGF0Y2hFdmVudChiKX0sYi5fY2xlYW5VcD1mdW5jdGlvbigpe2NsZWFyVGltZW91dCh0aGlzLmRlbGF5VGltZW91dElkKSx0aGlzLl9oYW5kbGVDbGVhblVwKCksdGhpcy5fcGF1c2VkPSExLGNyZWF0ZWpzLlNvdW5kLl9wbGF5RmluaXNoZWQodGhpcyl9LGIuX2ludGVycnVwdD1mdW5jdGlvbigpe3RoaXMuX2NsZWFuVXAoKSx0aGlzLnBsYXlTdGF0ZT1jcmVhdGVqcy5Tb3VuZC5QTEFZX0lOVEVSUlVQVEVELHRoaXMuX3NlbmRFdmVudChcImludGVycnVwdGVkXCIpfSxiLl9iZWdpblBsYXlpbmc9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuc2V0UG9zaXRpb24oYS5vZmZzZXQpLHRoaXMuc2V0TG9vcChhLmxvb3ApLHRoaXMuc2V0Vm9sdW1lKGEudm9sdW1lKSx0aGlzLnNldFBhbihhLnBhbiksbnVsbCE9YS5zdGFydFRpbWUmJih0aGlzLnNldFN0YXJ0VGltZShhLnN0YXJ0VGltZSksdGhpcy5zZXREdXJhdGlvbihhLmR1cmF0aW9uKSksbnVsbCE9dGhpcy5fcGxheWJhY2tSZXNvdXJjZSYmdGhpcy5fcG9zaXRpb248dGhpcy5fZHVyYXRpb24/KHRoaXMuX3BhdXNlZD0hMSx0aGlzLl9oYW5kbGVTb3VuZFJlYWR5KCksdGhpcy5wbGF5U3RhdGU9Y3JlYXRlanMuU291bmQuUExBWV9TVUNDRUVERUQsdGhpcy5fc2VuZEV2ZW50KFwic3VjY2VlZGVkXCIpLCEwKToodGhpcy5fcGxheUZhaWxlZCgpLCExKX0sYi5fcGxheUZhaWxlZD1mdW5jdGlvbigpe3RoaXMuX2NsZWFuVXAoKSx0aGlzLnBsYXlTdGF0ZT1jcmVhdGVqcy5Tb3VuZC5QTEFZX0ZBSUxFRCx0aGlzLl9zZW5kRXZlbnQoXCJmYWlsZWRcIil9LGIuX2hhbmRsZVNvdW5kQ29tcGxldGU9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX3Bvc2l0aW9uPTAsMCE9dGhpcy5fbG9vcD8odGhpcy5fbG9vcC0tLHRoaXMuX2hhbmRsZUxvb3AoKSx2b2lkIHRoaXMuX3NlbmRFdmVudChcImxvb3BcIikpOih0aGlzLl9jbGVhblVwKCksdGhpcy5wbGF5U3RhdGU9Y3JlYXRlanMuU291bmQuUExBWV9GSU5JU0hFRCx2b2lkIHRoaXMuX3NlbmRFdmVudChcImNvbXBsZXRlXCIpKX0sYi5faGFuZGxlU291bmRSZWFkeT1mdW5jdGlvbigpe30sYi5fdXBkYXRlVm9sdW1lPWZ1bmN0aW9uKCl7fSxiLl91cGRhdGVQYW49ZnVuY3Rpb24oKXt9LGIuX3VwZGF0ZVN0YXJ0VGltZT1mdW5jdGlvbigpe30sYi5fdXBkYXRlRHVyYXRpb249ZnVuY3Rpb24oKXt9LGIuX3NldER1cmF0aW9uRnJvbVNvdXJjZT1mdW5jdGlvbigpe30sYi5fY2FsY3VsYXRlQ3VycmVudFBvc2l0aW9uPWZ1bmN0aW9uKCl7fSxiLl91cGRhdGVQb3NpdGlvbj1mdW5jdGlvbigpe30sYi5fcmVtb3ZlTG9vcGluZz1mdW5jdGlvbihhKXt9LGIuX2FkZExvb3Bpbmc9ZnVuY3Rpb24oYSl7fSxiLl9wYXVzZT1mdW5jdGlvbigpe30sYi5fcmVzdW1lPWZ1bmN0aW9uKCl7fSxiLl9oYW5kbGVTdG9wPWZ1bmN0aW9uKCl7fSxiLl9oYW5kbGVDbGVhblVwPWZ1bmN0aW9uKCl7fSxiLl9oYW5kbGVMb29wPWZ1bmN0aW9uKCl7fSxjcmVhdGVqcy5BYnN0cmFjdFNvdW5kSW5zdGFuY2U9Y3JlYXRlanMucHJvbW90ZShhLFwiRXZlbnREaXNwYXRjaGVyXCIpLGNyZWF0ZWpzLkRlZmF1bHRTb3VuZEluc3RhbmNlPWNyZWF0ZWpzLkFic3RyYWN0U291bmRJbnN0YW5jZX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7dmFyIGE9ZnVuY3Rpb24oKXt0aGlzLl9jYXBhYmlsaXRpZXM9bnVsbCx0aGlzLl9sb2FkZXJzPXt9LHRoaXMuX2F1ZGlvU291cmNlcz17fSx0aGlzLl9zb3VuZEluc3RhbmNlcz17fSx0aGlzLl92b2x1bWU9MSx0aGlzLl9sb2FkZXJDbGFzcyx0aGlzLl9zb3VuZEluc3RhbmNlQ2xhc3N9LGI9YS5wcm90b3R5cGU7YS5fY2FwYWJpbGl0aWVzPW51bGwsYS5pc1N1cHBvcnRlZD1mdW5jdGlvbigpe3JldHVybiEwfSxiLnJlZ2lzdGVyPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuX2xvYWRlcnNbYS5zcmNdO3JldHVybiBiJiYhYi5jYW5jZWxlZD90aGlzLl9sb2FkZXJzW2Euc3JjXToodGhpcy5fYXVkaW9Tb3VyY2VzW2Euc3JjXT0hMCx0aGlzLl9zb3VuZEluc3RhbmNlc1thLnNyY109W10sYj1uZXcgdGhpcy5fbG9hZGVyQ2xhc3MoYSksYi5vbihcImNvbXBsZXRlXCIsdGhpcy5faGFuZGxlUHJlbG9hZENvbXBsZXRlLHRoaXMpLHRoaXMuX2xvYWRlcnNbYS5zcmNdPWIsYil9LGIucHJlbG9hZD1mdW5jdGlvbihhKXthLm9uKFwiZXJyb3JcIix0aGlzLl9oYW5kbGVQcmVsb2FkRXJyb3IsdGhpcyksYS5sb2FkKCl9LGIuaXNQcmVsb2FkU3RhcnRlZD1mdW5jdGlvbihhKXtyZXR1cm4gbnVsbCE9dGhpcy5fYXVkaW9Tb3VyY2VzW2FdfSxiLmlzUHJlbG9hZENvbXBsZXRlPWZ1bmN0aW9uKGEpe3JldHVybiEobnVsbD09dGhpcy5fYXVkaW9Tb3VyY2VzW2FdfHwxPT10aGlzLl9hdWRpb1NvdXJjZXNbYV0pfSxiLnJlbW92ZVNvdW5kPWZ1bmN0aW9uKGEpe2lmKHRoaXMuX3NvdW5kSW5zdGFuY2VzW2FdKXtmb3IodmFyIGI9dGhpcy5fc291bmRJbnN0YW5jZXNbYV0ubGVuZ3RoO2ItLTspe3ZhciBjPXRoaXMuX3NvdW5kSW5zdGFuY2VzW2FdW2JdO2MuZGVzdHJveSgpfWRlbGV0ZSB0aGlzLl9zb3VuZEluc3RhbmNlc1thXSxkZWxldGUgdGhpcy5fYXVkaW9Tb3VyY2VzW2FdLHRoaXMuX2xvYWRlcnNbYV0mJnRoaXMuX2xvYWRlcnNbYV0uZGVzdHJveSgpLGRlbGV0ZSB0aGlzLl9sb2FkZXJzW2FdfX0sYi5yZW1vdmVBbGxTb3VuZHM9ZnVuY3Rpb24oKXtmb3IodmFyIGEgaW4gdGhpcy5fYXVkaW9Tb3VyY2VzKXRoaXMucmVtb3ZlU291bmQoYSl9LGIuY3JlYXRlPWZ1bmN0aW9uKGEsYixjKXt0aGlzLmlzUHJlbG9hZFN0YXJ0ZWQoYSl8fHRoaXMucHJlbG9hZCh0aGlzLnJlZ2lzdGVyKGEpKTt2YXIgZD1uZXcgdGhpcy5fc291bmRJbnN0YW5jZUNsYXNzKGEsYixjLHRoaXMuX2F1ZGlvU291cmNlc1thXSk7cmV0dXJuIHRoaXMuX3NvdW5kSW5zdGFuY2VzW2FdLnB1c2goZCksZH0sYi5zZXRWb2x1bWU9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX3ZvbHVtZT1hLHRoaXMuX3VwZGF0ZVZvbHVtZSgpLCEwfSxiLmdldFZvbHVtZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl92b2x1bWV9LGIuc2V0TXV0ZT1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5fdXBkYXRlVm9sdW1lKCksITB9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltBYnN0cmFjdFBsdWdpbl1cIn0sYi5faGFuZGxlUHJlbG9hZENvbXBsZXRlPWZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0LmdldEl0ZW0oKS5zcmM7dGhpcy5fYXVkaW9Tb3VyY2VzW2JdPWEucmVzdWx0O2Zvcih2YXIgYz0wLGQ9dGhpcy5fc291bmRJbnN0YW5jZXNbYl0ubGVuZ3RoO2Q+YztjKyspe3ZhciBlPXRoaXMuX3NvdW5kSW5zdGFuY2VzW2JdW2NdO2Uuc2V0UGxheWJhY2tSZXNvdXJjZSh0aGlzLl9hdWRpb1NvdXJjZXNbYl0pO1xufX0sYi5faGFuZGxlUHJlbG9hZEVycm9yPWZ1bmN0aW9uKGEpe30sYi5fdXBkYXRlVm9sdW1lPWZ1bmN0aW9uKCl7fSxjcmVhdGVqcy5BYnN0cmFjdFBsdWdpbj1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSwhMCxjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5TT1VORCl9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpO2EuY29udGV4dD1udWxsLGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltXZWJBdWRpb0xvYWRlcl1cIn0sYi5fY3JlYXRlUmVxdWVzdD1mdW5jdGlvbigpe3RoaXMuX3JlcXVlc3Q9bmV3IGNyZWF0ZWpzLlhIUlJlcXVlc3QodGhpcy5faXRlbSwhMSksdGhpcy5fcmVxdWVzdC5zZXRSZXNwb25zZVR5cGUoXCJhcnJheWJ1ZmZlclwiKX0sYi5fc2VuZENvbXBsZXRlPWZ1bmN0aW9uKGIpe2EuY29udGV4dC5kZWNvZGVBdWRpb0RhdGEodGhpcy5fcmF3UmVzdWx0LGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUF1ZGlvRGVjb2RlZCx0aGlzKSxjcmVhdGVqcy5wcm94eSh0aGlzLl9zZW5kRXJyb3IsdGhpcykpfSxiLl9oYW5kbGVBdWRpb0RlY29kZWQ9ZnVuY3Rpb24oYSl7dGhpcy5fcmVzdWx0PWEsdGhpcy5BYnN0cmFjdExvYWRlcl9fc2VuZENvbXBsZXRlKCl9LGNyZWF0ZWpzLldlYkF1ZGlvTG9hZGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0TG9hZGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixkLGUpe3RoaXMuQWJzdHJhY3RTb3VuZEluc3RhbmNlX2NvbnN0cnVjdG9yKGEsYixkLGUpLHRoaXMuZ2Fpbk5vZGU9Yy5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLnBhbk5vZGU9Yy5jb250ZXh0LmNyZWF0ZVBhbm5lcigpLHRoaXMucGFuTm9kZS5wYW5uaW5nTW9kZWw9Yy5fcGFubmluZ01vZGVsLHRoaXMucGFuTm9kZS5jb25uZWN0KHRoaXMuZ2Fpbk5vZGUpLHRoaXMuX3VwZGF0ZVBhbigpLHRoaXMuc291cmNlTm9kZT1udWxsLHRoaXMuX3NvdW5kQ29tcGxldGVUaW1lb3V0PW51bGwsdGhpcy5fc291cmNlTm9kZU5leHQ9bnVsbCx0aGlzLl9wbGF5YmFja1N0YXJ0VGltZT0wLHRoaXMuX2VuZGVkSGFuZGxlcj1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVTb3VuZENvbXBsZXRlLHRoaXMpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0U291bmRJbnN0YW5jZSksYz1hO2MuY29udGV4dD1udWxsLGMuX3NjcmF0Y2hCdWZmZXI9bnVsbCxjLmRlc3RpbmF0aW9uTm9kZT1udWxsLGMuX3Bhbm5pbmdNb2RlbD1cImVxdWFscG93ZXJcIixiLmRlc3Ryb3k9ZnVuY3Rpb24oKXt0aGlzLkFic3RyYWN0U291bmRJbnN0YW5jZV9kZXN0cm95KCksdGhpcy5wYW5Ob2RlLmRpc2Nvbm5lY3QoMCksdGhpcy5wYW5Ob2RlPW51bGwsdGhpcy5nYWluTm9kZS5kaXNjb25uZWN0KDApLHRoaXMuZ2Fpbk5vZGU9bnVsbH0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1dlYkF1ZGlvU291bmRJbnN0YW5jZV1cIn0sYi5fdXBkYXRlUGFuPWZ1bmN0aW9uKCl7dGhpcy5wYW5Ob2RlLnNldFBvc2l0aW9uKHRoaXMuX3BhbiwwLC0uNSl9LGIuX3JlbW92ZUxvb3Bpbmc9ZnVuY3Rpb24oYSl7dGhpcy5fc291cmNlTm9kZU5leHQ9dGhpcy5fY2xlYW5VcEF1ZGlvTm9kZSh0aGlzLl9zb3VyY2VOb2RlTmV4dCl9LGIuX2FkZExvb3Bpbmc9ZnVuY3Rpb24oYSl7dGhpcy5wbGF5U3RhdGU9PWNyZWF0ZWpzLlNvdW5kLlBMQVlfU1VDQ0VFREVEJiYodGhpcy5fc291cmNlTm9kZU5leHQ9dGhpcy5fY3JlYXRlQW5kUGxheUF1ZGlvTm9kZSh0aGlzLl9wbGF5YmFja1N0YXJ0VGltZSwwKSl9LGIuX3NldER1cmF0aW9uRnJvbVNvdXJjZT1mdW5jdGlvbigpe3RoaXMuX2R1cmF0aW9uPTFlMyp0aGlzLnBsYXliYWNrUmVzb3VyY2UuZHVyYXRpb259LGIuX2hhbmRsZUNsZWFuVXA9ZnVuY3Rpb24oKXt0aGlzLnNvdXJjZU5vZGUmJnRoaXMucGxheVN0YXRlPT1jcmVhdGVqcy5Tb3VuZC5QTEFZX1NVQ0NFRURFRCYmKHRoaXMuc291cmNlTm9kZT10aGlzLl9jbGVhblVwQXVkaW9Ob2RlKHRoaXMuc291cmNlTm9kZSksdGhpcy5fc291cmNlTm9kZU5leHQ9dGhpcy5fY2xlYW5VcEF1ZGlvTm9kZSh0aGlzLl9zb3VyY2VOb2RlTmV4dCkpLDAhPXRoaXMuZ2Fpbk5vZGUubnVtYmVyT2ZPdXRwdXRzJiZ0aGlzLmdhaW5Ob2RlLmRpc2Nvbm5lY3QoMCksY2xlYXJUaW1lb3V0KHRoaXMuX3NvdW5kQ29tcGxldGVUaW1lb3V0KSx0aGlzLl9wbGF5YmFja1N0YXJ0VGltZT0wfSxiLl9jbGVhblVwQXVkaW9Ob2RlPWZ1bmN0aW9uKGEpe2lmKGEpe2Euc3RvcCgwKSxhLmRpc2Nvbm5lY3QoMCk7dHJ5e2EuYnVmZmVyPWMuX3NjcmF0Y2hCdWZmZXJ9Y2F0Y2goYil7fWE9bnVsbH1yZXR1cm4gYX0sYi5faGFuZGxlU291bmRSZWFkeT1mdW5jdGlvbihhKXt0aGlzLmdhaW5Ob2RlLmNvbm5lY3QoYy5kZXN0aW5hdGlvbk5vZGUpO3ZhciBiPS4wMDEqdGhpcy5fZHVyYXRpb24sZD0uMDAxKnRoaXMuX3Bvc2l0aW9uO2Q+YiYmKGQ9YiksdGhpcy5zb3VyY2VOb2RlPXRoaXMuX2NyZWF0ZUFuZFBsYXlBdWRpb05vZGUoYy5jb250ZXh0LmN1cnJlbnRUaW1lLWIsZCksdGhpcy5fcGxheWJhY2tTdGFydFRpbWU9dGhpcy5zb3VyY2VOb2RlLnN0YXJ0VGltZS1kLHRoaXMuX3NvdW5kQ29tcGxldGVUaW1lb3V0PXNldFRpbWVvdXQodGhpcy5fZW5kZWRIYW5kbGVyLDFlMyooYi1kKSksMCE9dGhpcy5fbG9vcCYmKHRoaXMuX3NvdXJjZU5vZGVOZXh0PXRoaXMuX2NyZWF0ZUFuZFBsYXlBdWRpb05vZGUodGhpcy5fcGxheWJhY2tTdGFydFRpbWUsMCkpfSxiLl9jcmVhdGVBbmRQbGF5QXVkaW9Ob2RlPWZ1bmN0aW9uKGEsYil7dmFyIGQ9Yy5jb250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO2QuYnVmZmVyPXRoaXMucGxheWJhY2tSZXNvdXJjZSxkLmNvbm5lY3QodGhpcy5wYW5Ob2RlKTt2YXIgZT0uMDAxKnRoaXMuX2R1cmF0aW9uO3JldHVybiBkLnN0YXJ0VGltZT1hK2UsZC5zdGFydChkLnN0YXJ0VGltZSxiKy4wMDEqdGhpcy5fc3RhcnRUaW1lLGUtYiksZH0sYi5fcGF1c2U9ZnVuY3Rpb24oKXt0aGlzLl9wb3NpdGlvbj0xZTMqKGMuY29udGV4dC5jdXJyZW50VGltZS10aGlzLl9wbGF5YmFja1N0YXJ0VGltZSksdGhpcy5zb3VyY2VOb2RlPXRoaXMuX2NsZWFuVXBBdWRpb05vZGUodGhpcy5zb3VyY2VOb2RlKSx0aGlzLl9zb3VyY2VOb2RlTmV4dD10aGlzLl9jbGVhblVwQXVkaW9Ob2RlKHRoaXMuX3NvdXJjZU5vZGVOZXh0KSwwIT10aGlzLmdhaW5Ob2RlLm51bWJlck9mT3V0cHV0cyYmdGhpcy5nYWluTm9kZS5kaXNjb25uZWN0KDApLGNsZWFyVGltZW91dCh0aGlzLl9zb3VuZENvbXBsZXRlVGltZW91dCl9LGIuX3Jlc3VtZT1mdW5jdGlvbigpe3RoaXMuX2hhbmRsZVNvdW5kUmVhZHkoKX0sYi5fdXBkYXRlVm9sdW1lPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5fbXV0ZWQ/MDp0aGlzLl92b2x1bWU7YSE9dGhpcy5nYWluTm9kZS5nYWluLnZhbHVlJiYodGhpcy5nYWluTm9kZS5nYWluLnZhbHVlPWEpfSxiLl9jYWxjdWxhdGVDdXJyZW50UG9zaXRpb249ZnVuY3Rpb24oKXtyZXR1cm4gMWUzKihjLmNvbnRleHQuY3VycmVudFRpbWUtdGhpcy5fcGxheWJhY2tTdGFydFRpbWUpfSxiLl91cGRhdGVQb3NpdGlvbj1mdW5jdGlvbigpe3RoaXMuc291cmNlTm9kZT10aGlzLl9jbGVhblVwQXVkaW9Ob2RlKHRoaXMuc291cmNlTm9kZSksdGhpcy5fc291cmNlTm9kZU5leHQ9dGhpcy5fY2xlYW5VcEF1ZGlvTm9kZSh0aGlzLl9zb3VyY2VOb2RlTmV4dCksY2xlYXJUaW1lb3V0KHRoaXMuX3NvdW5kQ29tcGxldGVUaW1lb3V0KSx0aGlzLl9wYXVzZWR8fHRoaXMuX2hhbmRsZVNvdW5kUmVhZHkoKX0sYi5faGFuZGxlTG9vcD1mdW5jdGlvbigpe3RoaXMuX2NsZWFuVXBBdWRpb05vZGUodGhpcy5zb3VyY2VOb2RlKSx0aGlzLnNvdXJjZU5vZGU9dGhpcy5fc291cmNlTm9kZU5leHQsdGhpcy5fcGxheWJhY2tTdGFydFRpbWU9dGhpcy5zb3VyY2VOb2RlLnN0YXJ0VGltZSx0aGlzLl9zb3VyY2VOb2RlTmV4dD10aGlzLl9jcmVhdGVBbmRQbGF5QXVkaW9Ob2RlKHRoaXMuX3BsYXliYWNrU3RhcnRUaW1lLDApLHRoaXMuX3NvdW5kQ29tcGxldGVUaW1lb3V0PXNldFRpbWVvdXQodGhpcy5fZW5kZWRIYW5kbGVyLHRoaXMuX2R1cmF0aW9uKX0sYi5fdXBkYXRlRHVyYXRpb249ZnVuY3Rpb24oKXt0aGlzLnBsYXlTdGF0ZT09Y3JlYXRlanMuU291bmQuUExBWV9TVUNDRUVERUQmJih0aGlzLl9wYXVzZSgpLHRoaXMuX3Jlc3VtZSgpKX0sY3JlYXRlanMuV2ViQXVkaW9Tb3VuZEluc3RhbmNlPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0U291bmRJbnN0YW5jZVwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYSgpe3RoaXMuQWJzdHJhY3RQbHVnaW5fY29uc3RydWN0b3IoKSx0aGlzLl9wYW5uaW5nTW9kZWw9Yy5fcGFubmluZ01vZGVsLHRoaXMuY29udGV4dD1jLmNvbnRleHQsdGhpcy5keW5hbWljc0NvbXByZXNzb3JOb2RlPXRoaXMuY29udGV4dC5jcmVhdGVEeW5hbWljc0NvbXByZXNzb3IoKSx0aGlzLmR5bmFtaWNzQ29tcHJlc3Nvck5vZGUuY29ubmVjdCh0aGlzLmNvbnRleHQuZGVzdGluYXRpb24pLHRoaXMuZ2Fpbk5vZGU9dGhpcy5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmdhaW5Ob2RlLmNvbm5lY3QodGhpcy5keW5hbWljc0NvbXByZXNzb3JOb2RlKSxjcmVhdGVqcy5XZWJBdWRpb1NvdW5kSW5zdGFuY2UuZGVzdGluYXRpb25Ob2RlPXRoaXMuZ2Fpbk5vZGUsdGhpcy5fY2FwYWJpbGl0aWVzPWMuX2NhcGFiaWxpdGllcyx0aGlzLl9sb2FkZXJDbGFzcz1jcmVhdGVqcy5XZWJBdWRpb0xvYWRlcix0aGlzLl9zb3VuZEluc3RhbmNlQ2xhc3M9Y3JlYXRlanMuV2ViQXVkaW9Tb3VuZEluc3RhbmNlLHRoaXMuX2FkZFByb3BzVG9DbGFzc2VzKCl9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RQbHVnaW4pLGM9YTtjLl9jYXBhYmlsaXRpZXM9bnVsbCxjLl9wYW5uaW5nTW9kZWw9XCJlcXVhbHBvd2VyXCIsYy5jb250ZXh0PW51bGwsYy5fc2NyYXRjaEJ1ZmZlcj1udWxsLGMuX3VubG9ja2VkPSExLGMuaXNTdXBwb3J0ZWQ9ZnVuY3Rpb24oKXt2YXIgYT1jcmVhdGVqcy5Ccm93c2VyRGV0ZWN0LmlzSU9TfHxjcmVhdGVqcy5Ccm93c2VyRGV0ZWN0LmlzQW5kcm9pZHx8Y3JlYXRlanMuQnJvd3NlckRldGVjdC5pc0JsYWNrYmVycnk7cmV0dXJuXCJmaWxlOlwiIT1sb2NhdGlvbi5wcm90b2NvbHx8YXx8dGhpcy5faXNGaWxlWEhSU3VwcG9ydGVkKCk/KGMuX2dlbmVyYXRlQ2FwYWJpbGl0aWVzKCksbnVsbD09Yy5jb250ZXh0PyExOiEwKTohMX0sYy5wbGF5RW1wdHlTb3VuZD1mdW5jdGlvbigpe2lmKG51bGwhPWMuY29udGV4dCl7dmFyIGE9Yy5jb250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO2EuYnVmZmVyPWMuX3NjcmF0Y2hCdWZmZXIsYS5jb25uZWN0KGMuY29udGV4dC5kZXN0aW5hdGlvbiksYS5zdGFydCgwLDAsMCl9fSxjLl9pc0ZpbGVYSFJTdXBwb3J0ZWQ9ZnVuY3Rpb24oKXt2YXIgYT0hMCxiPW5ldyBYTUxIdHRwUmVxdWVzdDt0cnl7Yi5vcGVuKFwiR0VUXCIsXCJXZWJBdWRpb1BsdWdpblRlc3QuZmFpbFwiLCExKX1jYXRjaChjKXtyZXR1cm4gYT0hMX1iLm9uZXJyb3I9ZnVuY3Rpb24oKXthPSExfSxiLm9ubG9hZD1mdW5jdGlvbigpe2E9NDA0PT10aGlzLnN0YXR1c3x8MjAwPT10aGlzLnN0YXR1c3x8MD09dGhpcy5zdGF0dXMmJlwiXCIhPXRoaXMucmVzcG9uc2V9O3RyeXtiLnNlbmQoKX1jYXRjaChjKXthPSExfXJldHVybiBhfSxjLl9nZW5lcmF0ZUNhcGFiaWxpdGllcz1mdW5jdGlvbigpe2lmKG51bGw9PWMuX2NhcGFiaWxpdGllcyl7dmFyIGE9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImF1ZGlvXCIpO2lmKG51bGw9PWEuY2FuUGxheVR5cGUpcmV0dXJuIG51bGw7aWYobnVsbD09Yy5jb250ZXh0KWlmKHdpbmRvdy5BdWRpb0NvbnRleHQpYy5jb250ZXh0PW5ldyBBdWRpb0NvbnRleHQ7ZWxzZXtpZighd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dClyZXR1cm4gbnVsbDtjLmNvbnRleHQ9bmV3IHdlYmtpdEF1ZGlvQ29udGV4dH1udWxsPT1jLl9zY3JhdGNoQnVmZmVyJiYoYy5fc2NyYXRjaEJ1ZmZlcj1jLmNvbnRleHQuY3JlYXRlQnVmZmVyKDEsMSwyMjA1MCkpLGMuX2NvbXBhdGliaWxpdHlTZXRVcCgpLFwib250b3VjaHN0YXJ0XCJpbiB3aW5kb3cmJlwicnVubmluZ1wiIT1jLmNvbnRleHQuc3RhdGUmJihjLl91bmxvY2soKSxkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsYy5fdW5sb2NrLCEwKSxkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIixjLl91bmxvY2ssITApKSxjLl9jYXBhYmlsaXRpZXM9e3Bhbm5pbmc6ITAsdm9sdW1lOiEwLHRyYWNrczotMX07Zm9yKHZhciBiPWNyZWF0ZWpzLlNvdW5kLlNVUFBPUlRFRF9FWFRFTlNJT05TLGQ9Y3JlYXRlanMuU291bmQuRVhURU5TSU9OX01BUCxlPTAsZj1iLmxlbmd0aDtmPmU7ZSsrKXt2YXIgZz1iW2VdLGg9ZFtnXXx8ZztjLl9jYXBhYmlsaXRpZXNbZ109XCJub1wiIT1hLmNhblBsYXlUeXBlKFwiYXVkaW8vXCIrZykmJlwiXCIhPWEuY2FuUGxheVR5cGUoXCJhdWRpby9cIitnKXx8XCJub1wiIT1hLmNhblBsYXlUeXBlKFwiYXVkaW8vXCIraCkmJlwiXCIhPWEuY2FuUGxheVR5cGUoXCJhdWRpby9cIitoKX1jLmNvbnRleHQuZGVzdGluYXRpb24ubnVtYmVyT2ZDaGFubmVsczwyJiYoYy5fY2FwYWJpbGl0aWVzLnBhbm5pbmc9ITEpfX0sYy5fY29tcGF0aWJpbGl0eVNldFVwPWZ1bmN0aW9uKCl7aWYoYy5fcGFubmluZ01vZGVsPVwiZXF1YWxwb3dlclwiLCFjLmNvbnRleHQuY3JlYXRlR2Fpbil7Yy5jb250ZXh0LmNyZWF0ZUdhaW49Yy5jb250ZXh0LmNyZWF0ZUdhaW5Ob2RlO3ZhciBhPWMuY29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTthLl9fcHJvdG9fXy5zdGFydD1hLl9fcHJvdG9fXy5ub3RlR3JhaW5PbixhLl9fcHJvdG9fXy5zdG9wPWEuX19wcm90b19fLm5vdGVPZmYsYy5fcGFubmluZ01vZGVsPTB9fSxjLl91bmxvY2s9ZnVuY3Rpb24oKXtjLl91bmxvY2tlZHx8KGMucGxheUVtcHR5U291bmQoKSxcInJ1bm5pbmdcIj09Yy5jb250ZXh0LnN0YXRlJiYoZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLGMuX3VubG9jaywhMCksZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsYy5fdW5sb2NrLCEwKSxjLl91bmxvY2tlZD0hMCkpfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbV2ViQXVkaW9QbHVnaW5dXCJ9LGIuX2FkZFByb3BzVG9DbGFzc2VzPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5fc291bmRJbnN0YW5jZUNsYXNzO2EuY29udGV4dD10aGlzLmNvbnRleHQsYS5fc2NyYXRjaEJ1ZmZlcj1jLl9zY3JhdGNoQnVmZmVyLGEuZGVzdGluYXRpb25Ob2RlPXRoaXMuZ2Fpbk5vZGUsYS5fcGFubmluZ01vZGVsPXRoaXMuX3Bhbm5pbmdNb2RlbCx0aGlzLl9sb2FkZXJDbGFzcy5jb250ZXh0PXRoaXMuY29udGV4dH0sYi5fdXBkYXRlVm9sdW1lPWZ1bmN0aW9uKCl7dmFyIGE9Y3JlYXRlanMuU291bmQuX21hc3Rlck11dGU/MDp0aGlzLl92b2x1bWU7YSE9dGhpcy5nYWluTm9kZS5nYWluLnZhbHVlJiYodGhpcy5nYWluTm9kZS5nYWluLnZhbHVlPWEpfSxjcmVhdGVqcy5XZWJBdWRpb1BsdWdpbj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdFBsdWdpblwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYSgpe3Rocm93XCJIVE1MQXVkaW9UYWdQb29sIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWRcIn1mdW5jdGlvbiBiKGEpe3RoaXMuX3RhZ3M9W119dmFyIGM9YTtjLl90YWdzPXt9LGMuX3RhZ1Bvb2w9bmV3IGIsYy5fdGFnVXNlZD17fSxjLmdldD1mdW5jdGlvbihhKXt2YXIgYj1jLl90YWdzW2FdO3JldHVybiBudWxsPT1iPyhiPWMuX3RhZ3NbYV09Yy5fdGFnUG9vbC5nZXQoKSxiLnNyYz1hKTpjLl90YWdVc2VkW2FdPyhiPWMuX3RhZ1Bvb2wuZ2V0KCksYi5zcmM9YSk6Yy5fdGFnVXNlZFthXT0hMCxifSxjLnNldD1mdW5jdGlvbihhLGIpe2I9PWMuX3RhZ3NbYV0/Yy5fdGFnVXNlZFthXT0hMTpjLl90YWdQb29sLnNldChiKX0sYy5yZW1vdmU9ZnVuY3Rpb24oYSl7dmFyIGI9Yy5fdGFnc1thXTtyZXR1cm4gbnVsbD09Yj8hMTooYy5fdGFnUG9vbC5zZXQoYiksZGVsZXRlIGMuX3RhZ3NbYV0sZGVsZXRlIGMuX3RhZ1VzZWRbYV0sITApfSxjLmdldER1cmF0aW9uPWZ1bmN0aW9uKGEpe3ZhciBiPWMuX3RhZ3NbYV07cmV0dXJuIG51bGwhPWImJmIuZHVyYXRpb24/MWUzKmIuZHVyYXRpb246MH0sY3JlYXRlanMuSFRNTEF1ZGlvVGFnUG9vbD1hO3ZhciBkPWIucHJvdG90eXBlO2QuY29uc3RydWN0b3I9YixkLmdldD1mdW5jdGlvbigpe3ZhciBhO3JldHVybiBhPTA9PXRoaXMuX3RhZ3MubGVuZ3RoP3RoaXMuX2NyZWF0ZVRhZygpOnRoaXMuX3RhZ3MucG9wKCksbnVsbD09YS5wYXJlbnROb2RlJiZkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpLGF9LGQuc2V0PWZ1bmN0aW9uKGEpe3ZhciBiPWNyZWF0ZWpzLmluZGV4T2YodGhpcy5fdGFncyxhKTstMT09YiYmKHRoaXMuX3RhZ3Muc3JjPW51bGwsdGhpcy5fdGFncy5wdXNoKGEpKX0sZC50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1RhZ1Bvb2xdXCJ9LGQuX2NyZWF0ZVRhZz1mdW5jdGlvbigpe3ZhciBhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhdWRpb1wiKTtyZXR1cm4gYS5hdXRvcGxheT0hMSxhLnByZWxvYWQ9XCJub25lXCIsYX19KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiLGMsZCl7dGhpcy5BYnN0cmFjdFNvdW5kSW5zdGFuY2VfY29uc3RydWN0b3IoYSxiLGMsZCksdGhpcy5fYXVkaW9TcHJpdGVTdG9wVGltZT1udWxsLHRoaXMuX2RlbGF5VGltZW91dElkPW51bGwsdGhpcy5fZW5kZWRIYW5kbGVyPWNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVNvdW5kQ29tcGxldGUsdGhpcyksdGhpcy5fcmVhZHlIYW5kbGVyPWNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVRhZ1JlYWR5LHRoaXMpLHRoaXMuX3N0YWxsZWRIYW5kbGVyPWNyZWF0ZWpzLnByb3h5KHRoaXMuX3BsYXlGYWlsZWQsdGhpcyksdGhpcy5fYXVkaW9TcHJpdGVFbmRIYW5kbGVyPWNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUF1ZGlvU3ByaXRlTG9vcCx0aGlzKSx0aGlzLl9sb29wSGFuZGxlcj1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVTb3VuZENvbXBsZXRlLHRoaXMpLGM/dGhpcy5fYXVkaW9TcHJpdGVTdG9wVGltZT0uMDAxKihiK2MpOnRoaXMuX2R1cmF0aW9uPWNyZWF0ZWpzLkhUTUxBdWRpb1RhZ1Bvb2wuZ2V0RHVyYXRpb24odGhpcy5zcmMpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0U291bmRJbnN0YW5jZSk7Yi5zZXRNYXN0ZXJWb2x1bWU9ZnVuY3Rpb24oYSl7dGhpcy5fdXBkYXRlVm9sdW1lKCl9LGIuc2V0TWFzdGVyTXV0ZT1mdW5jdGlvbihhKXt0aGlzLl91cGRhdGVWb2x1bWUoKX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0hUTUxBdWRpb1NvdW5kSW5zdGFuY2VdXCJ9LGIuX3JlbW92ZUxvb3Bpbmc9ZnVuY3Rpb24oKXtudWxsIT10aGlzLl9wbGF5YmFja1Jlc291cmNlJiYodGhpcy5fcGxheWJhY2tSZXNvdXJjZS5sb29wPSExLHRoaXMuX3BsYXliYWNrUmVzb3VyY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1NFRUtFRCx0aGlzLl9sb29wSGFuZGxlciwhMSkpfSxiLl9hZGRMb29waW5nPWZ1bmN0aW9uKCl7bnVsbD09dGhpcy5fcGxheWJhY2tSZXNvdXJjZXx8dGhpcy5fYXVkaW9TcHJpdGVTdG9wVGltZXx8KHRoaXMuX3BsYXliYWNrUmVzb3VyY2UuYWRkRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1NFRUtFRCx0aGlzLl9sb29wSGFuZGxlciwhMSksdGhpcy5fcGxheWJhY2tSZXNvdXJjZS5sb29wPSEwKX0sYi5faGFuZGxlQ2xlYW5VcD1mdW5jdGlvbigpe3ZhciBhPXRoaXMuX3BsYXliYWNrUmVzb3VyY2U7aWYobnVsbCE9YSl7YS5wYXVzZSgpLGEubG9vcD0hMSxhLnJlbW92ZUV2ZW50TGlzdGVuZXIoY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luLl9BVURJT19FTkRFRCx0aGlzLl9lbmRlZEhhbmRsZXIsITEpLGEucmVtb3ZlRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1JFQURZLHRoaXMuX3JlYWR5SGFuZGxlciwhMSksYS5yZW1vdmVFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fU1RBTExFRCx0aGlzLl9zdGFsbGVkSGFuZGxlciwhMSksYS5yZW1vdmVFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fU0VFS0VELHRoaXMuX2xvb3BIYW5kbGVyLCExKSxhLnJlbW92ZUV2ZW50TGlzdGVuZXIoY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luLl9USU1FX1VQREFURSx0aGlzLl9hdWRpb1Nwcml0ZUVuZEhhbmRsZXIsITEpO3RyeXthLmN1cnJlbnRUaW1lPXRoaXMuX3N0YXJ0VGltZX1jYXRjaChiKXt9Y3JlYXRlanMuSFRNTEF1ZGlvVGFnUG9vbC5zZXQodGhpcy5zcmMsYSksdGhpcy5fcGxheWJhY2tSZXNvdXJjZT1udWxsfX0sYi5fYmVnaW5QbGF5aW5nPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl9wbGF5YmFja1Jlc291cmNlPWNyZWF0ZWpzLkhUTUxBdWRpb1RhZ1Bvb2wuZ2V0KHRoaXMuc3JjKSx0aGlzLkFic3RyYWN0U291bmRJbnN0YW5jZV9fYmVnaW5QbGF5aW5nKGEpfSxiLl9oYW5kbGVTb3VuZFJlYWR5PWZ1bmN0aW9uKGEpe2lmKDQhPT10aGlzLl9wbGF5YmFja1Jlc291cmNlLnJlYWR5U3RhdGUpe3ZhciBiPXRoaXMuX3BsYXliYWNrUmVzb3VyY2U7cmV0dXJuIGIuYWRkRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1JFQURZLHRoaXMuX3JlYWR5SGFuZGxlciwhMSksYi5hZGRFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fU1RBTExFRCx0aGlzLl9zdGFsbGVkSGFuZGxlciwhMSksYi5wcmVsb2FkPVwiYXV0b1wiLHZvaWQgYi5sb2FkKCl9dGhpcy5fdXBkYXRlVm9sdW1lKCksdGhpcy5fcGxheWJhY2tSZXNvdXJjZS5jdXJyZW50VGltZT0uMDAxKih0aGlzLl9zdGFydFRpbWUrdGhpcy5fcG9zaXRpb24pLHRoaXMuX2F1ZGlvU3ByaXRlU3RvcFRpbWU/dGhpcy5fcGxheWJhY2tSZXNvdXJjZS5hZGRFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fVElNRV9VUERBVEUsdGhpcy5fYXVkaW9TcHJpdGVFbmRIYW5kbGVyLCExKToodGhpcy5fcGxheWJhY2tSZXNvdXJjZS5hZGRFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fRU5ERUQsdGhpcy5fZW5kZWRIYW5kbGVyLCExKSwwIT10aGlzLl9sb29wJiYodGhpcy5fcGxheWJhY2tSZXNvdXJjZS5hZGRFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fU0VFS0VELHRoaXMuX2xvb3BIYW5kbGVyLCExKSx0aGlzLl9wbGF5YmFja1Jlc291cmNlLmxvb3A9ITApKSx0aGlzLl9wbGF5YmFja1Jlc291cmNlLnBsYXkoKX0sYi5faGFuZGxlVGFnUmVhZHk9ZnVuY3Rpb24oYSl7dGhpcy5fcGxheWJhY2tSZXNvdXJjZS5yZW1vdmVFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fUkVBRFksdGhpcy5fcmVhZHlIYW5kbGVyLCExKSx0aGlzLl9wbGF5YmFja1Jlc291cmNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luLl9BVURJT19TVEFMTEVELHRoaXMuX3N0YWxsZWRIYW5kbGVyLCExKSx0aGlzLl9oYW5kbGVTb3VuZFJlYWR5KCl9LGIuX3BhdXNlPWZ1bmN0aW9uKCl7dGhpcy5fcGxheWJhY2tSZXNvdXJjZS5wYXVzZSgpfSxiLl9yZXN1bWU9ZnVuY3Rpb24oKXt0aGlzLl9wbGF5YmFja1Jlc291cmNlLnBsYXkoKX0sYi5fdXBkYXRlVm9sdW1lPWZ1bmN0aW9uKCl7aWYobnVsbCE9dGhpcy5fcGxheWJhY2tSZXNvdXJjZSl7dmFyIGE9dGhpcy5fbXV0ZWR8fGNyZWF0ZWpzLlNvdW5kLl9tYXN0ZXJNdXRlPzA6dGhpcy5fdm9sdW1lKmNyZWF0ZWpzLlNvdW5kLl9tYXN0ZXJWb2x1bWU7YSE9dGhpcy5fcGxheWJhY2tSZXNvdXJjZS52b2x1bWUmJih0aGlzLl9wbGF5YmFja1Jlc291cmNlLnZvbHVtZT1hKX19LGIuX2NhbGN1bGF0ZUN1cnJlbnRQb3NpdGlvbj1mdW5jdGlvbigpe3JldHVybiAxZTMqdGhpcy5fcGxheWJhY2tSZXNvdXJjZS5jdXJyZW50VGltZS10aGlzLl9zdGFydFRpbWV9LGIuX3VwZGF0ZVBvc2l0aW9uPWZ1bmN0aW9uKCl7dGhpcy5fcGxheWJhY2tSZXNvdXJjZS5yZW1vdmVFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fU0VFS0VELHRoaXMuX2xvb3BIYW5kbGVyLCExKSx0aGlzLl9wbGF5YmFja1Jlc291cmNlLmFkZEV2ZW50TGlzdGVuZXIoY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luLl9BVURJT19TRUVLRUQsdGhpcy5faGFuZGxlU2V0UG9zaXRpb25TZWVrLCExKTt0cnl7dGhpcy5fcGxheWJhY2tSZXNvdXJjZS5jdXJyZW50VGltZT0uMDAxKih0aGlzLl9wb3NpdGlvbit0aGlzLl9zdGFydFRpbWUpfWNhdGNoKGEpe3RoaXMuX2hhbmRsZVNldFBvc2l0aW9uU2VlayhudWxsKX19LGIuX2hhbmRsZVNldFBvc2l0aW9uU2Vlaz1mdW5jdGlvbihhKXtudWxsIT10aGlzLl9wbGF5YmFja1Jlc291cmNlJiYodGhpcy5fcGxheWJhY2tSZXNvdXJjZS5yZW1vdmVFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fU0VFS0VELHRoaXMuX2hhbmRsZVNldFBvc2l0aW9uU2VlaywhMSksdGhpcy5fcGxheWJhY2tSZXNvdXJjZS5hZGRFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fU0VFS0VELHRoaXMuX2xvb3BIYW5kbGVyLCExKSl9LGIuX2hhbmRsZUF1ZGlvU3ByaXRlTG9vcD1mdW5jdGlvbihhKXt0aGlzLl9wbGF5YmFja1Jlc291cmNlLmN1cnJlbnRUaW1lPD10aGlzLl9hdWRpb1Nwcml0ZVN0b3BUaW1lfHwodGhpcy5fcGxheWJhY2tSZXNvdXJjZS5wYXVzZSgpLDA9PXRoaXMuX2xvb3A/dGhpcy5faGFuZGxlU291bmRDb21wbGV0ZShudWxsKToodGhpcy5fcG9zaXRpb249MCx0aGlzLl9sb29wLS0sdGhpcy5fcGxheWJhY2tSZXNvdXJjZS5jdXJyZW50VGltZT0uMDAxKnRoaXMuX3N0YXJ0VGltZSx0aGlzLl9wYXVzZWR8fHRoaXMuX3BsYXliYWNrUmVzb3VyY2UucGxheSgpLHRoaXMuX3NlbmRFdmVudChcImxvb3BcIikpKX0sYi5faGFuZGxlTG9vcD1mdW5jdGlvbihhKXswPT10aGlzLl9sb29wJiYodGhpcy5fcGxheWJhY2tSZXNvdXJjZS5sb29wPSExLHRoaXMuX3BsYXliYWNrUmVzb3VyY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1NFRUtFRCx0aGlzLl9sb29wSGFuZGxlciwhMSkpfSxiLl91cGRhdGVTdGFydFRpbWU9ZnVuY3Rpb24oKXt0aGlzLl9hdWRpb1Nwcml0ZVN0b3BUaW1lPS4wMDEqKHRoaXMuX3N0YXJ0VGltZSt0aGlzLl9kdXJhdGlvbiksdGhpcy5wbGF5U3RhdGU9PWNyZWF0ZWpzLlNvdW5kLlBMQVlfU1VDQ0VFREVEJiYodGhpcy5fcGxheWJhY2tSZXNvdXJjZS5yZW1vdmVFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fRU5ERUQsdGhpcy5fZW5kZWRIYW5kbGVyLCExKSx0aGlzLl9wbGF5YmFja1Jlc291cmNlLmFkZEV2ZW50TGlzdGVuZXIoY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luLl9USU1FX1VQREFURSx0aGlzLl9hdWRpb1Nwcml0ZUVuZEhhbmRsZXIsITEpKX0sYi5fdXBkYXRlRHVyYXRpb249ZnVuY3Rpb24oKXt0aGlzLl9hdWRpb1Nwcml0ZVN0b3BUaW1lPS4wMDEqKHRoaXMuX3N0YXJ0VGltZSt0aGlzLl9kdXJhdGlvbiksdGhpcy5wbGF5U3RhdGU9PWNyZWF0ZWpzLlNvdW5kLlBMQVlfU1VDQ0VFREVEJiYodGhpcy5fcGxheWJhY2tSZXNvdXJjZS5yZW1vdmVFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fRU5ERUQsdGhpcy5fZW5kZWRIYW5kbGVyLCExKSx0aGlzLl9wbGF5YmFja1Jlc291cmNlLmFkZEV2ZW50TGlzdGVuZXIoY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luLl9USU1FX1VQREFURSx0aGlzLl9hdWRpb1Nwcml0ZUVuZEhhbmRsZXIsITEpKX0sYi5fc2V0RHVyYXRpb25Gcm9tU291cmNlPWZ1bmN0aW9uKCl7dGhpcy5fZHVyYXRpb249Y3JlYXRlanMuSFRNTEF1ZGlvVGFnUG9vbC5nZXREdXJhdGlvbih0aGlzLnNyYyksdGhpcy5fcGxheWJhY2tSZXNvdXJjZT1udWxsfSxjcmVhdGVqcy5IVE1MQXVkaW9Tb3VuZEluc3RhbmNlPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0U291bmRJbnN0YW5jZVwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYSgpe3RoaXMuQWJzdHJhY3RQbHVnaW5fY29uc3RydWN0b3IoKSx0aGlzLmRlZmF1bHROdW1DaGFubmVscz0yLHRoaXMuX2NhcGFiaWxpdGllcz1jLl9jYXBhYmlsaXRpZXMsdGhpcy5fbG9hZGVyQ2xhc3M9Y3JlYXRlanMuU291bmRMb2FkZXIsdGhpcy5fc291bmRJbnN0YW5jZUNsYXNzPWNyZWF0ZWpzLkhUTUxBdWRpb1NvdW5kSW5zdGFuY2V9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RQbHVnaW4pLGM9YTtjLk1BWF9JTlNUQU5DRVM9MzAsYy5fQVVESU9fUkVBRFk9XCJjYW5wbGF5dGhyb3VnaFwiLGMuX0FVRElPX0VOREVEPVwiZW5kZWRcIixjLl9BVURJT19TRUVLRUQ9XCJzZWVrZWRcIixjLl9BVURJT19TVEFMTEVEPVwic3RhbGxlZFwiLGMuX1RJTUVfVVBEQVRFPVwidGltZXVwZGF0ZVwiLGMuX2NhcGFiaWxpdGllcz1udWxsLGMuaXNTdXBwb3J0ZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gYy5fZ2VuZXJhdGVDYXBhYmlsaXRpZXMoKSxudWxsIT1jLl9jYXBhYmlsaXRpZXN9LGMuX2dlbmVyYXRlQ2FwYWJpbGl0aWVzPWZ1bmN0aW9uKCl7aWYobnVsbD09Yy5fY2FwYWJpbGl0aWVzKXt2YXIgYT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXVkaW9cIik7aWYobnVsbD09YS5jYW5QbGF5VHlwZSlyZXR1cm4gbnVsbDtjLl9jYXBhYmlsaXRpZXM9e3Bhbm5pbmc6ITEsdm9sdW1lOiEwLHRyYWNrczotMX07Zm9yKHZhciBiPWNyZWF0ZWpzLlNvdW5kLlNVUFBPUlRFRF9FWFRFTlNJT05TLGQ9Y3JlYXRlanMuU291bmQuRVhURU5TSU9OX01BUCxlPTAsZj1iLmxlbmd0aDtmPmU7ZSsrKXt2YXIgZz1iW2VdLGg9ZFtnXXx8ZztjLl9jYXBhYmlsaXRpZXNbZ109XCJub1wiIT1hLmNhblBsYXlUeXBlKFwiYXVkaW8vXCIrZykmJlwiXCIhPWEuY2FuUGxheVR5cGUoXCJhdWRpby9cIitnKXx8XCJub1wiIT1hLmNhblBsYXlUeXBlKFwiYXVkaW8vXCIraCkmJlwiXCIhPWEuY2FuUGxheVR5cGUoXCJhdWRpby9cIitoKX19fSxiLnJlZ2lzdGVyPWZ1bmN0aW9uKGEpe3ZhciBiPWNyZWF0ZWpzLkhUTUxBdWRpb1RhZ1Bvb2wuZ2V0KGEuc3JjKSxjPXRoaXMuQWJzdHJhY3RQbHVnaW5fcmVnaXN0ZXIoYSk7cmV0dXJuIGMuc2V0VGFnKGIpLGN9LGIucmVtb3ZlU291bmQ9ZnVuY3Rpb24oYSl7dGhpcy5BYnN0cmFjdFBsdWdpbl9yZW1vdmVTb3VuZChhKSxjcmVhdGVqcy5IVE1MQXVkaW9UYWdQb29sLnJlbW92ZShhKX0sYi5jcmVhdGU9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXRoaXMuQWJzdHJhY3RQbHVnaW5fY3JlYXRlKGEsYixjKTtyZXR1cm4gZC5zZXRQbGF5YmFja1Jlc291cmNlKG51bGwpLGR9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltIVE1MQXVkaW9QbHVnaW5dXCJ9LGIuc2V0Vm9sdW1lPWIuZ2V0Vm9sdW1lPWIuc2V0TXV0ZT1udWxsLGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdFBsdWdpblwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShiLGMsZCl7dGhpcy5pZ25vcmVHbG9iYWxQYXVzZT0hMSx0aGlzLmxvb3A9ITEsdGhpcy5kdXJhdGlvbj0wLHRoaXMucGx1Z2luRGF0YT1kfHx7fSx0aGlzLnRhcmdldD1iLHRoaXMucG9zaXRpb249bnVsbCx0aGlzLnBhc3NpdmU9ITEsdGhpcy5fcGF1c2VkPSExLHRoaXMuX2N1clF1ZXVlUHJvcHM9e30sdGhpcy5faW5pdFF1ZXVlUHJvcHM9e30sdGhpcy5fc3RlcHM9W10sdGhpcy5fYWN0aW9ucz1bXSx0aGlzLl9wcmV2UG9zaXRpb249MCx0aGlzLl9zdGVwUG9zaXRpb249MCx0aGlzLl9wcmV2UG9zPS0xLHRoaXMuX3RhcmdldD1iLHRoaXMuX3VzZVRpY2tzPSExLHRoaXMuX2luaXRlZD0hMSx0aGlzLl9yZWdpc3RlcmVkPSExLGMmJih0aGlzLl91c2VUaWNrcz1jLnVzZVRpY2tzLHRoaXMuaWdub3JlR2xvYmFsUGF1c2U9Yy5pZ25vcmVHbG9iYWxQYXVzZSx0aGlzLmxvb3A9Yy5sb29wLGMub25DaGFuZ2UmJnRoaXMuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLGMub25DaGFuZ2UpLGMub3ZlcnJpZGUmJmEucmVtb3ZlVHdlZW5zKGIpKSxjJiZjLnBhdXNlZD90aGlzLl9wYXVzZWQ9ITA6Y3JlYXRlanMuVHdlZW4uX3JlZ2lzdGVyKHRoaXMsITApLGMmJm51bGwhPWMucG9zaXRpb24mJnRoaXMuc2V0UG9zaXRpb24oYy5wb3NpdGlvbixhLk5PTkUpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkV2ZW50RGlzcGF0Y2hlcik7YS5OT05FPTAsYS5MT09QPTEsYS5SRVZFUlNFPTIsYS5JR05PUkU9e30sYS5fdHdlZW5zPVtdLGEuX3BsdWdpbnM9e30sYS5nZXQ9ZnVuY3Rpb24oYixjLGQsZSl7cmV0dXJuIGUmJmEucmVtb3ZlVHdlZW5zKGIpLG5ldyBhKGIsYyxkKX0sYS50aWNrPWZ1bmN0aW9uKGIsYyl7Zm9yKHZhciBkPWEuX3R3ZWVucy5zbGljZSgpLGU9ZC5sZW5ndGgtMTtlPj0wO2UtLSl7dmFyIGY9ZFtlXTtjJiYhZi5pZ25vcmVHbG9iYWxQYXVzZXx8Zi5fcGF1c2VkfHxmLnRpY2soZi5fdXNlVGlja3M/MTpiKX19LGEuaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oYSl7XCJ0aWNrXCI9PWEudHlwZSYmdGhpcy50aWNrKGEuZGVsdGEsYS5wYXVzZWQpfSxhLnJlbW92ZVR3ZWVucz1mdW5jdGlvbihiKXtpZihiLnR3ZWVuanNfY291bnQpe2Zvcih2YXIgYz1hLl90d2VlbnMsZD1jLmxlbmd0aC0xO2Q+PTA7ZC0tKXt2YXIgZT1jW2RdO2UuX3RhcmdldD09YiYmKGUuX3BhdXNlZD0hMCxjLnNwbGljZShkLDEpKX1iLnR3ZWVuanNfY291bnQ9MH19LGEucmVtb3ZlQWxsVHdlZW5zPWZ1bmN0aW9uKCl7Zm9yKHZhciBiPWEuX3R3ZWVucyxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXt2YXIgZT1iW2NdO2UuX3BhdXNlZD0hMCxlLnRhcmdldCYmKGUudGFyZ2V0LnR3ZWVuanNfY291bnQ9MCl9Yi5sZW5ndGg9MH0sYS5oYXNBY3RpdmVUd2VlbnM9ZnVuY3Rpb24oYil7cmV0dXJuIGI/bnVsbCE9Yi50d2VlbmpzX2NvdW50JiYhIWIudHdlZW5qc19jb3VudDphLl90d2VlbnMmJiEhYS5fdHdlZW5zLmxlbmd0aH0sYS5pbnN0YWxsUGx1Z2luPWZ1bmN0aW9uKGIsYyl7dmFyIGQ9Yi5wcmlvcml0eTtudWxsPT1kJiYoYi5wcmlvcml0eT1kPTApO2Zvcih2YXIgZT0wLGY9Yy5sZW5ndGgsZz1hLl9wbHVnaW5zO2Y+ZTtlKyspe3ZhciBoPWNbZV07aWYoZ1toXSl7Zm9yKHZhciBpPWdbaF0saj0wLGs9aS5sZW5ndGg7az5qJiYhKGQ8aVtqXS5wcmlvcml0eSk7aisrKTtnW2hdLnNwbGljZShqLDAsYil9ZWxzZSBnW2hdPVtiXX19LGEuX3JlZ2lzdGVyPWZ1bmN0aW9uKGIsYyl7dmFyIGQ9Yi5fdGFyZ2V0LGU9YS5fdHdlZW5zO2lmKGMmJiFiLl9yZWdpc3RlcmVkKWQmJihkLnR3ZWVuanNfY291bnQ9ZC50d2VlbmpzX2NvdW50P2QudHdlZW5qc19jb3VudCsxOjEpLGUucHVzaChiKSwhYS5faW5pdGVkJiZjcmVhdGVqcy5UaWNrZXImJihjcmVhdGVqcy5UaWNrZXIuYWRkRXZlbnRMaXN0ZW5lcihcInRpY2tcIixhKSxhLl9pbml0ZWQ9ITApO2Vsc2UgaWYoIWMmJmIuX3JlZ2lzdGVyZWQpe2QmJmQudHdlZW5qc19jb3VudC0tO2Zvcih2YXIgZj1lLmxlbmd0aDtmLS07KWlmKGVbZl09PWIpe2Uuc3BsaWNlKGYsMSk7YnJlYWt9fWIuX3JlZ2lzdGVyZWQ9Y30sYi53YWl0PWZ1bmN0aW9uKGEsYil7aWYobnVsbD09YXx8MD49YSlyZXR1cm4gdGhpczt2YXIgYz10aGlzLl9jbG9uZVByb3BzKHRoaXMuX2N1clF1ZXVlUHJvcHMpO3JldHVybiB0aGlzLl9hZGRTdGVwKHtkOmEscDA6YyxlOnRoaXMuX2xpbmVhckVhc2UscDE6Yyx2OmJ9KX0sYi50bz1mdW5jdGlvbihhLGIsYyl7cmV0dXJuKGlzTmFOKGIpfHwwPmIpJiYoYj0wKSx0aGlzLl9hZGRTdGVwKHtkOmJ8fDAscDA6dGhpcy5fY2xvbmVQcm9wcyh0aGlzLl9jdXJRdWV1ZVByb3BzKSxlOmMscDE6dGhpcy5fY2xvbmVQcm9wcyh0aGlzLl9hcHBlbmRRdWV1ZVByb3BzKGEpKX0pfSxiLmNhbGw9ZnVuY3Rpb24oYSxiLGMpe3JldHVybiB0aGlzLl9hZGRBY3Rpb24oe2Y6YSxwOmI/YjpbdGhpc10sbzpjP2M6dGhpcy5fdGFyZ2V0fSl9LGIuc2V0PWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuX2FkZEFjdGlvbih7Zjp0aGlzLl9zZXQsbzp0aGlzLHA6W2EsYj9iOnRoaXMuX3RhcmdldF19KX0sYi5wbGF5PWZ1bmN0aW9uKGEpe3JldHVybiBhfHwoYT10aGlzKSx0aGlzLmNhbGwoYS5zZXRQYXVzZWQsWyExXSxhKX0sYi5wYXVzZT1mdW5jdGlvbihhKXtyZXR1cm4gYXx8KGE9dGhpcyksdGhpcy5jYWxsKGEuc2V0UGF1c2VkLFshMF0sYSl9LGIuc2V0UG9zaXRpb249ZnVuY3Rpb24oYSxiKXswPmEmJihhPTApLG51bGw9PWImJihiPTEpO3ZhciBjPWEsZD0hMTtpZihjPj10aGlzLmR1cmF0aW9uJiYodGhpcy5sb29wP2MlPXRoaXMuZHVyYXRpb246KGM9dGhpcy5kdXJhdGlvbixkPSEwKSksYz09dGhpcy5fcHJldlBvcylyZXR1cm4gZDt2YXIgZT10aGlzLl9wcmV2UG9zO2lmKHRoaXMucG9zaXRpb249dGhpcy5fcHJldlBvcz1jLHRoaXMuX3ByZXZQb3NpdGlvbj1hLHRoaXMuX3RhcmdldClpZihkKXRoaXMuX3VwZGF0ZVRhcmdldFByb3BzKG51bGwsMSk7ZWxzZSBpZih0aGlzLl9zdGVwcy5sZW5ndGg+MCl7Zm9yKHZhciBmPTAsZz10aGlzLl9zdGVwcy5sZW5ndGg7Zz5mJiYhKHRoaXMuX3N0ZXBzW2ZdLnQ+Yyk7ZisrKTt2YXIgaD10aGlzLl9zdGVwc1tmLTFdO3RoaXMuX3VwZGF0ZVRhcmdldFByb3BzKGgsKHRoaXMuX3N0ZXBQb3NpdGlvbj1jLWgudCkvaC5kKX1yZXR1cm4gMCE9YiYmdGhpcy5fYWN0aW9ucy5sZW5ndGg+MCYmKHRoaXMuX3VzZVRpY2tzP3RoaXMuX3J1bkFjdGlvbnMoYyxjKToxPT1iJiZlPmM/KGUhPXRoaXMuZHVyYXRpb24mJnRoaXMuX3J1bkFjdGlvbnMoZSx0aGlzLmR1cmF0aW9uKSx0aGlzLl9ydW5BY3Rpb25zKDAsYywhMCkpOnRoaXMuX3J1bkFjdGlvbnMoZSxjKSksZCYmdGhpcy5zZXRQYXVzZWQoITApLHRoaXMuZGlzcGF0Y2hFdmVudChcImNoYW5nZVwiKSxkfSxiLnRpY2s9ZnVuY3Rpb24oYSl7dGhpcy5fcGF1c2VkfHx0aGlzLnNldFBvc2l0aW9uKHRoaXMuX3ByZXZQb3NpdGlvbithKX0sYi5zZXRQYXVzZWQ9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMuX3BhdXNlZD09PSEhYj90aGlzOih0aGlzLl9wYXVzZWQ9ISFiLGEuX3JlZ2lzdGVyKHRoaXMsIWIpLHRoaXMpfSxiLnc9Yi53YWl0LGIudD1iLnRvLGIuYz1iLmNhbGwsYi5zPWIuc2V0LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltUd2Vlbl1cIn0sYi5jbG9uZT1mdW5jdGlvbigpe3Rocm93XCJUd2VlbiBjYW4gbm90IGJlIGNsb25lZC5cIn0sYi5fdXBkYXRlVGFyZ2V0UHJvcHM9ZnVuY3Rpb24oYixjKXt2YXIgZCxlLGYsZyxoLGk7aWYoYnx8MSE9Yyl7aWYodGhpcy5wYXNzaXZlPSEhYi52LHRoaXMucGFzc2l2ZSlyZXR1cm47Yi5lJiYoYz1iLmUoYywwLDEsMSkpLGQ9Yi5wMCxlPWIucDF9ZWxzZSB0aGlzLnBhc3NpdmU9ITEsZD1lPXRoaXMuX2N1clF1ZXVlUHJvcHM7Zm9yKHZhciBqIGluIHRoaXMuX2luaXRRdWV1ZVByb3BzKXtudWxsPT0oZz1kW2pdKSYmKGRbal09Zz10aGlzLl9pbml0UXVldWVQcm9wc1tqXSksbnVsbD09KGg9ZVtqXSkmJihlW2pdPWg9ZyksZj1nPT1ofHwwPT1jfHwxPT1jfHxcIm51bWJlclwiIT10eXBlb2YgZz8xPT1jP2g6ZzpnKyhoLWcpKmM7dmFyIGs9ITE7aWYoaT1hLl9wbHVnaW5zW2pdKWZvcih2YXIgbD0wLG09aS5sZW5ndGg7bT5sO2wrKyl7dmFyIG49aVtsXS50d2Vlbih0aGlzLGosZixkLGUsYywhIWImJmQ9PWUsIWIpO249PWEuSUdOT1JFP2s9ITA6Zj1ufWt8fCh0aGlzLl90YXJnZXRbal09Zil9fSxiLl9ydW5BY3Rpb25zPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1hLGU9YixmPS0xLGc9dGhpcy5fYWN0aW9ucy5sZW5ndGgsaD0xO2ZvcihhPmImJihkPWIsZT1hLGY9ZyxnPWg9LTEpOyhmKz1oKSE9Zzspe3ZhciBpPXRoaXMuX2FjdGlvbnNbZl0saj1pLnQ7KGo9PWV8fGo+ZCYmZT5qfHxjJiZqPT1hKSYmaS5mLmFwcGx5KGkubyxpLnApfX0sYi5fYXBwZW5kUXVldWVQcm9wcz1mdW5jdGlvbihiKXt2YXIgYyxkLGUsZixnO2Zvcih2YXIgaCBpbiBiKWlmKHZvaWQgMD09PXRoaXMuX2luaXRRdWV1ZVByb3BzW2hdKXtpZihkPXRoaXMuX3RhcmdldFtoXSxjPWEuX3BsdWdpbnNbaF0pZm9yKGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspZD1jW2VdLmluaXQodGhpcyxoLGQpO3RoaXMuX2luaXRRdWV1ZVByb3BzW2hdPXRoaXMuX2N1clF1ZXVlUHJvcHNbaF09dm9pZCAwPT09ZD9udWxsOmR9ZWxzZSBkPXRoaXMuX2N1clF1ZXVlUHJvcHNbaF07Zm9yKHZhciBoIGluIGIpe2lmKGQ9dGhpcy5fY3VyUXVldWVQcm9wc1toXSxjPWEuX3BsdWdpbnNbaF0pZm9yKGc9Z3x8e30sZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKyljW2VdLnN0ZXAmJmNbZV0uc3RlcCh0aGlzLGgsZCxiW2hdLGcpO3RoaXMuX2N1clF1ZXVlUHJvcHNbaF09YltoXX1yZXR1cm4gZyYmdGhpcy5fYXBwZW5kUXVldWVQcm9wcyhnKSx0aGlzLl9jdXJRdWV1ZVByb3BzfSxiLl9jbG9uZVByb3BzPWZ1bmN0aW9uKGEpe3ZhciBiPXt9O2Zvcih2YXIgYyBpbiBhKWJbY109YVtjXTtyZXR1cm4gYn0sYi5fYWRkU3RlcD1mdW5jdGlvbihhKXtyZXR1cm4gYS5kPjAmJih0aGlzLl9zdGVwcy5wdXNoKGEpLGEudD10aGlzLmR1cmF0aW9uLHRoaXMuZHVyYXRpb24rPWEuZCksdGhpc30sYi5fYWRkQWN0aW9uPWZ1bmN0aW9uKGEpe3JldHVybiBhLnQ9dGhpcy5kdXJhdGlvbix0aGlzLl9hY3Rpb25zLnB1c2goYSksdGhpc30sYi5fc2V0PWZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjIGluIGEpYltjXT1hW2NdfSxjcmVhdGVqcy5Ud2Vlbj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJFdmVudERpc3BhdGNoZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiLGMpe3RoaXMuRXZlbnREaXNwYXRjaGVyX2NvbnN0cnVjdG9yKCksdGhpcy5pZ25vcmVHbG9iYWxQYXVzZT0hMSx0aGlzLmR1cmF0aW9uPTAsdGhpcy5sb29wPSExLHRoaXMucG9zaXRpb249bnVsbCx0aGlzLl9wYXVzZWQ9ITEsdGhpcy5fdHdlZW5zPVtdLHRoaXMuX2xhYmVscz1udWxsLHRoaXMuX2xhYmVsTGlzdD1udWxsLHRoaXMuX3ByZXZQb3NpdGlvbj0wLHRoaXMuX3ByZXZQb3M9LTEsdGhpcy5fdXNlVGlja3M9ITEsdGhpcy5fcmVnaXN0ZXJlZD0hMSxjJiYodGhpcy5fdXNlVGlja3M9Yy51c2VUaWNrcyx0aGlzLmxvb3A9Yy5sb29wLHRoaXMuaWdub3JlR2xvYmFsUGF1c2U9Yy5pZ25vcmVHbG9iYWxQYXVzZSxjLm9uQ2hhbmdlJiZ0aGlzLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIixjLm9uQ2hhbmdlKSksYSYmdGhpcy5hZGRUd2Vlbi5hcHBseSh0aGlzLGEpLHRoaXMuc2V0TGFiZWxzKGIpLGMmJmMucGF1c2VkP3RoaXMuX3BhdXNlZD0hMDpjcmVhdGVqcy5Ud2Vlbi5fcmVnaXN0ZXIodGhpcywhMCksYyYmbnVsbCE9Yy5wb3NpdGlvbiYmdGhpcy5zZXRQb3NpdGlvbihjLnBvc2l0aW9uLGNyZWF0ZWpzLlR3ZWVuLk5PTkUpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkV2ZW50RGlzcGF0Y2hlcik7Yi5hZGRUd2Vlbj1mdW5jdGlvbihhKXt2YXIgYj1hcmd1bWVudHMubGVuZ3RoO2lmKGI+MSl7Zm9yKHZhciBjPTA7Yj5jO2MrKyl0aGlzLmFkZFR3ZWVuKGFyZ3VtZW50c1tjXSk7cmV0dXJuIGFyZ3VtZW50c1swXX1yZXR1cm4gMD09Yj9udWxsOih0aGlzLnJlbW92ZVR3ZWVuKGEpLHRoaXMuX3R3ZWVucy5wdXNoKGEpLGEuc2V0UGF1c2VkKCEwKSxhLl9wYXVzZWQ9ITEsYS5fdXNlVGlja3M9dGhpcy5fdXNlVGlja3MsYS5kdXJhdGlvbj50aGlzLmR1cmF0aW9uJiYodGhpcy5kdXJhdGlvbj1hLmR1cmF0aW9uKSx0aGlzLl9wcmV2UG9zPj0wJiZhLnNldFBvc2l0aW9uKHRoaXMuX3ByZXZQb3MsY3JlYXRlanMuVHdlZW4uTk9ORSksYSl9LGIucmVtb3ZlVHdlZW49ZnVuY3Rpb24oYSl7dmFyIGI9YXJndW1lbnRzLmxlbmd0aDtpZihiPjEpe2Zvcih2YXIgYz0hMCxkPTA7Yj5kO2QrKyljPWMmJnRoaXMucmVtb3ZlVHdlZW4oYXJndW1lbnRzW2RdKTtyZXR1cm4gY31pZigwPT1iKXJldHVybiExO2Zvcih2YXIgZT10aGlzLl90d2VlbnMsZD1lLmxlbmd0aDtkLS07KWlmKGVbZF09PWEpcmV0dXJuIGUuc3BsaWNlKGQsMSksYS5kdXJhdGlvbj49dGhpcy5kdXJhdGlvbiYmdGhpcy51cGRhdGVEdXJhdGlvbigpLCEwO3JldHVybiExfSxiLmFkZExhYmVsPWZ1bmN0aW9uKGEsYil7dGhpcy5fbGFiZWxzW2FdPWI7dmFyIGM9dGhpcy5fbGFiZWxMaXN0O2lmKGMpe2Zvcih2YXIgZD0wLGU9Yy5sZW5ndGg7ZT5kJiYhKGI8Y1tkXS5wb3NpdGlvbik7ZCsrKTtjLnNwbGljZShkLDAse2xhYmVsOmEscG9zaXRpb246Yn0pfX0sYi5zZXRMYWJlbHM9ZnVuY3Rpb24oYSl7dGhpcy5fbGFiZWxzPWE/YTp7fX0sYi5nZXRMYWJlbHM9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLl9sYWJlbExpc3Q7aWYoIWEpe2E9dGhpcy5fbGFiZWxMaXN0PVtdO3ZhciBiPXRoaXMuX2xhYmVscztmb3IodmFyIGMgaW4gYilhLnB1c2goe2xhYmVsOmMscG9zaXRpb246YltjXX0pO2Euc29ydChmdW5jdGlvbihhLGIpe3JldHVybiBhLnBvc2l0aW9uLWIucG9zaXRpb259KX1yZXR1cm4gYX0sYi5nZXRDdXJyZW50TGFiZWw9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmdldExhYmVscygpLGI9dGhpcy5wb3NpdGlvbixjPWEubGVuZ3RoO2lmKGMpe2Zvcih2YXIgZD0wO2M+ZCYmIShiPGFbZF0ucG9zaXRpb24pO2QrKyk7cmV0dXJuIDA9PWQ/bnVsbDphW2QtMV0ubGFiZWx9cmV0dXJuIG51bGx9LGIuZ290b0FuZFBsYXk9ZnVuY3Rpb24oYSl7dGhpcy5zZXRQYXVzZWQoITEpLHRoaXMuX2dvdG8oYSl9LGIuZ290b0FuZFN0b3A9ZnVuY3Rpb24oYSl7dGhpcy5zZXRQYXVzZWQoITApLHRoaXMuX2dvdG8oYSl9LGIuc2V0UG9zaXRpb249ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLl9jYWxjUG9zaXRpb24oYSksZD0hdGhpcy5sb29wJiZhPj10aGlzLmR1cmF0aW9uO2lmKGM9PXRoaXMuX3ByZXZQb3MpcmV0dXJuIGQ7dGhpcy5fcHJldlBvc2l0aW9uPWEsdGhpcy5wb3NpdGlvbj10aGlzLl9wcmV2UG9zPWM7Zm9yKHZhciBlPTAsZj10aGlzLl90d2VlbnMubGVuZ3RoO2Y+ZTtlKyspaWYodGhpcy5fdHdlZW5zW2VdLnNldFBvc2l0aW9uKGMsYiksYyE9dGhpcy5fcHJldlBvcylyZXR1cm4hMTtyZXR1cm4gZCYmdGhpcy5zZXRQYXVzZWQoITApLHRoaXMuZGlzcGF0Y2hFdmVudChcImNoYW5nZVwiKSxkfSxiLnNldFBhdXNlZD1mdW5jdGlvbihhKXt0aGlzLl9wYXVzZWQ9ISFhLGNyZWF0ZWpzLlR3ZWVuLl9yZWdpc3Rlcih0aGlzLCFhKX0sYi51cGRhdGVEdXJhdGlvbj1mdW5jdGlvbigpe3RoaXMuZHVyYXRpb249MDtmb3IodmFyIGE9MCxiPXRoaXMuX3R3ZWVucy5sZW5ndGg7Yj5hO2ErKyl7dmFyIGM9dGhpcy5fdHdlZW5zW2FdO2MuZHVyYXRpb24+dGhpcy5kdXJhdGlvbiYmKHRoaXMuZHVyYXRpb249Yy5kdXJhdGlvbil9fSxiLnRpY2s9ZnVuY3Rpb24oYSl7dGhpcy5zZXRQb3NpdGlvbih0aGlzLl9wcmV2UG9zaXRpb24rYSl9LGIucmVzb2x2ZT1mdW5jdGlvbihhKXt2YXIgYj1OdW1iZXIoYSk7cmV0dXJuIGlzTmFOKGIpJiYoYj10aGlzLl9sYWJlbHNbYV0pLGJ9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltUaW1lbGluZV1cIn0sYi5jbG9uZT1mdW5jdGlvbigpe3Rocm93XCJUaW1lbGluZSBjYW4gbm90IGJlIGNsb25lZC5cIn0sYi5fZ290bz1mdW5jdGlvbihhKXt2YXIgYj10aGlzLnJlc29sdmUoYSk7bnVsbCE9YiYmdGhpcy5zZXRQb3NpdGlvbihiKX0sYi5fY2FsY1Bvc2l0aW9uPWZ1bmN0aW9uKGEpe3JldHVybiAwPmE/MDphPHRoaXMuZHVyYXRpb24/YTp0aGlzLmxvb3A/YSV0aGlzLmR1cmF0aW9uOnRoaXMuZHVyYXRpb259LGNyZWF0ZWpzLlRpbWVsaW5lPWNyZWF0ZWpzLnByb21vdGUoYSxcIkV2ZW50RGlzcGF0Y2hlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYSgpe3Rocm93XCJFYXNlIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQuXCJ9YS5saW5lYXI9ZnVuY3Rpb24oYSl7cmV0dXJuIGF9LGEubm9uZT1hLmxpbmVhcixhLmdldD1mdW5jdGlvbihhKXtyZXR1cm4tMT5hJiYoYT0tMSksYT4xJiYoYT0xKSxmdW5jdGlvbihiKXtyZXR1cm4gMD09YT9iOjA+YT9iKihiKi1hKzErYSk6YiooKDItYikqYSsoMS1hKSl9fSxhLmdldFBvd0luPWZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbihiKXtyZXR1cm4gTWF0aC5wb3coYixhKX19LGEuZ2V0UG93T3V0PWZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbihiKXtyZXR1cm4gMS1NYXRoLnBvdygxLWIsYSl9fSxhLmdldFBvd0luT3V0PWZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbihiKXtyZXR1cm4oYio9Mik8MT8uNSpNYXRoLnBvdyhiLGEpOjEtLjUqTWF0aC5hYnMoTWF0aC5wb3coMi1iLGEpKX19LGEucXVhZEluPWEuZ2V0UG93SW4oMiksYS5xdWFkT3V0PWEuZ2V0UG93T3V0KDIpLGEucXVhZEluT3V0PWEuZ2V0UG93SW5PdXQoMiksYS5jdWJpY0luPWEuZ2V0UG93SW4oMyksYS5jdWJpY091dD1hLmdldFBvd091dCgzKSxhLmN1YmljSW5PdXQ9YS5nZXRQb3dJbk91dCgzKSxhLnF1YXJ0SW49YS5nZXRQb3dJbig0KSxhLnF1YXJ0T3V0PWEuZ2V0UG93T3V0KDQpLGEucXVhcnRJbk91dD1hLmdldFBvd0luT3V0KDQpLGEucXVpbnRJbj1hLmdldFBvd0luKDUpLGEucXVpbnRPdXQ9YS5nZXRQb3dPdXQoNSksYS5xdWludEluT3V0PWEuZ2V0UG93SW5PdXQoNSksYS5zaW5lSW49ZnVuY3Rpb24oYSl7cmV0dXJuIDEtTWF0aC5jb3MoYSpNYXRoLlBJLzIpfSxhLnNpbmVPdXQ9ZnVuY3Rpb24oYSl7cmV0dXJuIE1hdGguc2luKGEqTWF0aC5QSS8yKX0sYS5zaW5lSW5PdXQ9ZnVuY3Rpb24oYSl7cmV0dXJuLS41KihNYXRoLmNvcyhNYXRoLlBJKmEpLTEpfSxhLmdldEJhY2tJbj1mdW5jdGlvbihhKXtyZXR1cm4gZnVuY3Rpb24oYil7cmV0dXJuIGIqYiooKGErMSkqYi1hKX19LGEuYmFja0luPWEuZ2V0QmFja0luKDEuNyksYS5nZXRCYWNrT3V0PWZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbihiKXtyZXR1cm4tLWIqYiooKGErMSkqYithKSsxfX0sYS5iYWNrT3V0PWEuZ2V0QmFja091dCgxLjcpLGEuZ2V0QmFja0luT3V0PWZ1bmN0aW9uKGEpe3JldHVybiBhKj0xLjUyNSxmdW5jdGlvbihiKXtyZXR1cm4oYio9Mik8MT8uNSooYipiKigoYSsxKSpiLWEpKTouNSooKGItPTIpKmIqKChhKzEpKmIrYSkrMil9fSxhLmJhY2tJbk91dD1hLmdldEJhY2tJbk91dCgxLjcpLGEuY2lyY0luPWZ1bmN0aW9uKGEpe3JldHVybi0oTWF0aC5zcXJ0KDEtYSphKS0xKX0sYS5jaXJjT3V0PWZ1bmN0aW9uKGEpe3JldHVybiBNYXRoLnNxcnQoMS0gLS1hKmEpfSxhLmNpcmNJbk91dD1mdW5jdGlvbihhKXtyZXR1cm4oYSo9Mik8MT8tLjUqKE1hdGguc3FydCgxLWEqYSktMSk6LjUqKE1hdGguc3FydCgxLShhLT0yKSphKSsxKX0sYS5ib3VuY2VJbj1mdW5jdGlvbihiKXtyZXR1cm4gMS1hLmJvdW5jZU91dCgxLWIpfSxhLmJvdW5jZU91dD1mdW5jdGlvbihhKXtyZXR1cm4gMS8yLjc1PmE/Ny41NjI1KmEqYToyLzIuNzU+YT83LjU2MjUqKGEtPTEuNS8yLjc1KSphKy43NToyLjUvMi43NT5hPzcuNTYyNSooYS09Mi4yNS8yLjc1KSphKy45Mzc1OjcuNTYyNSooYS09Mi42MjUvMi43NSkqYSsuOTg0Mzc1fSxhLmJvdW5jZUluT3V0PWZ1bmN0aW9uKGIpe3JldHVybi41PmI/LjUqYS5ib3VuY2VJbigyKmIpOi41KmEuYm91bmNlT3V0KDIqYi0xKSsuNX0sYS5nZXRFbGFzdGljSW49ZnVuY3Rpb24oYSxiKXt2YXIgYz0yKk1hdGguUEk7cmV0dXJuIGZ1bmN0aW9uKGQpe2lmKDA9PWR8fDE9PWQpcmV0dXJuIGQ7dmFyIGU9Yi9jKk1hdGguYXNpbigxL2EpO3JldHVybi0oYSpNYXRoLnBvdygyLDEwKihkLT0xKSkqTWF0aC5zaW4oKGQtZSkqYy9iKSl9fSxhLmVsYXN0aWNJbj1hLmdldEVsYXN0aWNJbigxLC4zKSxhLmdldEVsYXN0aWNPdXQ9ZnVuY3Rpb24oYSxiKXt2YXIgYz0yKk1hdGguUEk7cmV0dXJuIGZ1bmN0aW9uKGQpe2lmKDA9PWR8fDE9PWQpcmV0dXJuIGQ7dmFyIGU9Yi9jKk1hdGguYXNpbigxL2EpO3JldHVybiBhKk1hdGgucG93KDIsLTEwKmQpKk1hdGguc2luKChkLWUpKmMvYikrMX19LGEuZWxhc3RpY091dD1hLmdldEVsYXN0aWNPdXQoMSwuMyksYS5nZXRFbGFzdGljSW5PdXQ9ZnVuY3Rpb24oYSxiKXt2YXIgYz0yKk1hdGguUEk7cmV0dXJuIGZ1bmN0aW9uKGQpe3ZhciBlPWIvYypNYXRoLmFzaW4oMS9hKTtyZXR1cm4oZCo9Mik8MT8tLjUqKGEqTWF0aC5wb3coMiwxMCooZC09MSkpKk1hdGguc2luKChkLWUpKmMvYikpOmEqTWF0aC5wb3coMiwtMTAqKGQtPTEpKSpNYXRoLnNpbigoZC1lKSpjL2IpKi41KzF9fSxhLmVsYXN0aWNJbk91dD1hLmdldEVsYXN0aWNJbk91dCgxLC4zKjEuNSksY3JlYXRlanMuRWFzZT1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKCl7dGhyb3dcIk1vdGlvbkd1aWRlUGx1Z2luIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQuXCJ9YS5wcmlvcml0eT0wLGEuX3JvdE9mZlMsYS5fcm90T2ZmRSxhLl9yb3ROb3JtUyxhLl9yb3ROb3JtRSxhLmluc3RhbGw9ZnVuY3Rpb24oKXtyZXR1cm4gY3JlYXRlanMuVHdlZW4uaW5zdGFsbFBsdWdpbihhLFtcImd1aWRlXCIsXCJ4XCIsXCJ5XCIsXCJyb3RhdGlvblwiXSksY3JlYXRlanMuVHdlZW4uSUdOT1JFfSxhLmluaXQ9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWEudGFyZ2V0O3JldHVybiBkLmhhc093blByb3BlcnR5KFwieFwiKXx8KGQueD0wKSxkLmhhc093blByb3BlcnR5KFwieVwiKXx8KGQueT0wKSxkLmhhc093blByb3BlcnR5KFwicm90YXRpb25cIil8fChkLnJvdGF0aW9uPTApLFwicm90YXRpb25cIj09YiYmKGEuX19uZWVkc1JvdD0hMCksXCJndWlkZVwiPT1iP251bGw6Y30sYS5zdGVwPWZ1bmN0aW9uKGIsYyxkLGUsZil7aWYoXCJyb3RhdGlvblwiPT1jJiYoYi5fX3JvdEdsb2JhbFM9ZCxiLl9fcm90R2xvYmFsRT1lLGEudGVzdFJvdERhdGEoYixmKSksXCJndWlkZVwiIT1jKXJldHVybiBlO3ZhciBnLGg9ZTtoLmhhc093blByb3BlcnR5KFwicGF0aFwiKXx8KGgucGF0aD1bXSk7dmFyIGk9aC5wYXRoO2lmKGguaGFzT3duUHJvcGVydHkoXCJlbmRcIil8fChoLmVuZD0xKSxoLmhhc093blByb3BlcnR5KFwic3RhcnRcIil8fChoLnN0YXJ0PWQmJmQuaGFzT3duUHJvcGVydHkoXCJlbmRcIikmJmQucGF0aD09PWk/ZC5lbmQ6MCksaC5oYXNPd25Qcm9wZXJ0eShcIl9zZWdtZW50c1wiKSYmaC5fbGVuZ3RoKXJldHVybiBlO3ZhciBqPWkubGVuZ3RoLGs9MTA7aWYoIShqPj02JiYoai0yKSU0PT0wKSl0aHJvd1wiaW52YWxpZCAncGF0aCcgZGF0YSwgcGxlYXNlIHNlZSBkb2N1bWVudGF0aW9uIGZvciB2YWxpZCBwYXRoc1wiO2guX3NlZ21lbnRzPVtdLGguX2xlbmd0aD0wO2Zvcih2YXIgbD0yO2o+bDtsKz00KXtmb3IodmFyIG0sbixvPWlbbC0yXSxwPWlbbC0xXSxxPWlbbCswXSxyPWlbbCsxXSxzPWlbbCsyXSx0PWlbbCszXSx1PW8sdj1wLHc9MCx4PVtdLHk9MTtrPj15O3krKyl7dmFyIHo9eS9rLEE9MS16O209QSpBKm8rMipBKnoqcSt6KnoqcyxuPUEqQSpwKzIqQSp6KnIreip6KnQsdys9eFt4LnB1c2goTWF0aC5zcXJ0KChnPW0tdSkqZysoZz1uLXYpKmcpKS0xXSx1PW0sdj1ufWguX3NlZ21lbnRzLnB1c2godyksaC5fc2VnbWVudHMucHVzaCh4KSxoLl9sZW5ndGgrPXd9Zz1oLm9yaWVudCxoLm9yaWVudD0hMDt2YXIgQj17fTtyZXR1cm4gYS5jYWxjKGgsaC5zdGFydCxCKSxiLl9fcm90UGF0aFM9TnVtYmVyKEIucm90YXRpb24udG9GaXhlZCg1KSksYS5jYWxjKGgsaC5lbmQsQiksYi5fX3JvdFBhdGhFPU51bWJlcihCLnJvdGF0aW9uLnRvRml4ZWQoNSkpLGgub3JpZW50PSExLGEuY2FsYyhoLGguZW5kLGYpLGgub3JpZW50PWcsaC5vcmllbnQ/KGIuX19ndWlkZURhdGE9aCxhLnRlc3RSb3REYXRhKGIsZiksZSk6ZX0sYS50ZXN0Um90RGF0YT1mdW5jdGlvbihhLGIpe2lmKHZvaWQgMD09PWEuX19yb3RHbG9iYWxTfHx2b2lkIDA9PT1hLl9fcm90R2xvYmFsRSl7aWYoYS5fX25lZWRzUm90KXJldHVybjt2b2lkIDAhPT1hLl9jdXJRdWV1ZVByb3BzLnJvdGF0aW9uP2EuX19yb3RHbG9iYWxTPWEuX19yb3RHbG9iYWxFPWEuX2N1clF1ZXVlUHJvcHMucm90YXRpb246YS5fX3JvdEdsb2JhbFM9YS5fX3JvdEdsb2JhbEU9Yi5yb3RhdGlvbj1hLnRhcmdldC5yb3RhdGlvbnx8MH1pZih2b2lkIDAhPT1hLl9fZ3VpZGVEYXRhKXt2YXIgYz1hLl9fZ3VpZGVEYXRhLGQ9YS5fX3JvdEdsb2JhbEUtYS5fX3JvdEdsb2JhbFMsZT1hLl9fcm90UGF0aEUtYS5fX3JvdFBhdGhTLGY9ZC1lO2lmKFwiYXV0b1wiPT1jLm9yaWVudClmPjE4MD9mLT0zNjA6LTE4MD5mJiYoZis9MzYwKTtlbHNlIGlmKFwiY3dcIj09Yy5vcmllbnQpe2Zvcig7MD5mOylmKz0zNjA7MD09ZiYmZD4wJiYxODAhPWQmJihmKz0zNjApfWVsc2UgaWYoXCJjY3dcIj09Yy5vcmllbnQpe2ZvcihmPWQtKGU+MTgwPzM2MC1lOmUpO2Y+MDspZi09MzYwOzA9PWYmJjA+ZCYmLTE4MCE9ZCYmKGYtPTM2MCl9Yy5yb3REZWx0YT1mLGMucm90T2ZmUz1hLl9fcm90R2xvYmFsUy1hLl9fcm90UGF0aFMsYS5fX3JvdEdsb2JhbFM9YS5fX3JvdEdsb2JhbEU9YS5fX2d1aWRlRGF0YT1hLl9fbmVlZHNSb3Q9dm9pZCAwfX0sYS50d2Vlbj1mdW5jdGlvbihiLGMsZCxlLGYsZyxoLGkpe3ZhciBqPWYuZ3VpZGU7aWYodm9pZCAwPT1qfHxqPT09ZS5ndWlkZSlyZXR1cm4gZDtpZihqLmxhc3RSYXRpbyE9Zyl7dmFyIGs9KGouZW5kLWouc3RhcnQpKihoP2ouZW5kOmcpK2ouc3RhcnQ7c3dpdGNoKGEuY2FsYyhqLGssYi50YXJnZXQpLGoub3JpZW50KXtjYXNlXCJjd1wiOmNhc2VcImNjd1wiOmNhc2VcImF1dG9cIjpiLnRhcmdldC5yb3RhdGlvbis9ai5yb3RPZmZTK2oucm90RGVsdGEqZzticmVhaztjYXNlXCJmaXhlZFwiOmRlZmF1bHQ6Yi50YXJnZXQucm90YXRpb24rPWoucm90T2ZmU31qLmxhc3RSYXRpbz1nfXJldHVyblwicm90YXRpb25cIiE9Y3x8ai5vcmllbnQmJlwiZmFsc2VcIiE9ai5vcmllbnQ/Yi50YXJnZXRbY106ZH0sYS5jYWxjPWZ1bmN0aW9uKGEsYixjKXtpZih2b2lkIDA9PWEuX3NlZ21lbnRzKXRocm93XCJNaXNzaW5nIGNyaXRpY2FsIHByZS1jYWxjdWxhdGVkIGluZm9ybWF0aW9uLCBwbGVhc2UgZmlsZSBhIGJ1Z1wiO3ZvaWQgMD09YyYmKGM9e3g6MCx5OjAscm90YXRpb246MH0pO2Zvcih2YXIgZD1hLl9zZWdtZW50cyxlPWEucGF0aCxmPWEuX2xlbmd0aCpiLGc9ZC5sZW5ndGgtMixoPTA7Zj5kW2hdJiZnPmg7KWYtPWRbaF0saCs9Mjt2YXIgaT1kW2grMV0saj0wO2ZvcihnPWkubGVuZ3RoLTE7Zj5pW2pdJiZnPmo7KWYtPWlbal0saisrO3ZhciBrPWovKytnK2YvKGcqaVtqXSk7aD0yKmgrMjt2YXIgbD0xLWs7cmV0dXJuIGMueD1sKmwqZVtoLTJdKzIqbCprKmVbaCswXStrKmsqZVtoKzJdLGMueT1sKmwqZVtoLTFdKzIqbCprKmVbaCsxXStrKmsqZVtoKzNdLGEub3JpZW50JiYoYy5yb3RhdGlvbj01Ny4yOTU3Nzk1Kk1hdGguYXRhbjIoKGVbaCsxXS1lW2gtMV0pKmwrKGVbaCszXS1lW2grMV0pKmssKGVbaCswXS1lW2gtMl0pKmwrKGVbaCsyXS1lW2grMF0pKmspKSxjfSxjcmVhdGVqcy5Nb3Rpb25HdWlkZVBsdWdpbj1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjt2YXIgYT1jcmVhdGVqcy5Ud2VlbkpTPWNyZWF0ZWpzLlR3ZWVuSlN8fHt9O2EudmVyc2lvbj1cIjAuNi4yXCIsYS5idWlsZERhdGU9XCJUaHUsIDI2IE5vdiAyMDE1IDIwOjQ0OjMxIEdNVFwifSgpOyIsIi8vIEZpbGJlcnQgaXMgYSBQeXRob24gcGFyc2VyIHdyaXR0ZW4gaW4gSmF2YVNjcmlwdC5cbi8vXG4vLyBGaWxiZXJ0IHdhcyB3cml0dGVuIGJ5IE1hdHQgTG90dCBhbmQgcmVsZWFzZWQgdW5kZXIgYW4gTUlUXG4vLyBsaWNlbnNlLiBJdCB3YXMgYWRhdHBlZCBmcm9tIFtBY29ybl0oaHR0cHM6Ly9naXRodWIuY29tL21hcmlqbmgvYWNvcm4uZ2l0KVxuLy8gYnkgTWFyaWpuIEhhdmVyYmVrZS5cbi8vXG4vLyBHaXQgcmVwb3NpdG9yeSBmb3IgRmlsYmVydCBhcmUgYXZhaWxhYmxlIGF0XG4vL1xuLy8gICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9kaWZmZXJlbnRtYXR0L2ZpbGJlcnQuZ2l0XG4vL1xuLy8gUGxlYXNlIHVzZSB0aGUgW2dpdGh1YiBidWcgdHJhY2tlcl1bZ2hidF0gdG8gcmVwb3J0IGlzc3Vlcy5cbi8vXG4vLyBbZ2hidF06IGh0dHBzOi8vZ2l0aHViLmNvbS9kaWZmZXJlbnRtYXR0L2ZpbGJlcnQvaXNzdWVzXG5cbihmdW5jdGlvbihyb290LCBtb2QpIHtcbiAgaWYgKHR5cGVvZiBleHBvcnRzID09IFwib2JqZWN0XCIgJiYgdHlwZW9mIG1vZHVsZSA9PSBcIm9iamVjdFwiKSByZXR1cm4gbW9kKGV4cG9ydHMpOyAvLyBDb21tb25KU1xuICBpZiAodHlwZW9mIGRlZmluZSA9PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkgcmV0dXJuIGRlZmluZShbXCJleHBvcnRzXCJdLCBtb2QpOyAvLyBBTURcbiAgbW9kKHJvb3QuZmlsYmVydCB8fCAocm9vdC5maWxiZXJ0ID0ge30pKTsgLy8gUGxhaW4gYnJvd3NlciBlbnZcbn0pKHRoaXMsIGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgZXhwb3J0cy52ZXJzaW9uID0gXCIwLjUuMVwiO1xuXG4gIC8vIFRoZSBtYWluIGV4cG9ydGVkIGludGVyZmFjZSAodW5kZXIgYHNlbGYuZmlsYmVydGAgd2hlbiBpbiB0aGVcbiAgLy8gYnJvd3NlcikgaXMgYSBgcGFyc2VgIGZ1bmN0aW9uIHRoYXQgdGFrZXMgYSBjb2RlIHN0cmluZyBhbmRcbiAgLy8gcmV0dXJucyBhbiBhYnN0cmFjdCBzeW50YXggdHJlZSBhcyBzcGVjaWZpZWQgYnkgW01vemlsbGEgcGFyc2VyXG4gIC8vIEFQSV1bYXBpXS5cbiAgLy9cbiAgLy8gW2FwaV06IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvU3BpZGVyTW9ua2V5L1BhcnNlcl9BUElcblxuICB2YXIgb3B0aW9ucywgaW5wdXQsIGlucHV0TGVuLCBzb3VyY2VGaWxlLCBuYztcblxuICBleHBvcnRzLnBhcnNlID0gZnVuY3Rpb24oaW5wdCwgb3B0cykge1xuICAgIGlucHV0ID0gU3RyaW5nKGlucHQpOyBpbnB1dExlbiA9IGlucHV0Lmxlbmd0aDtcbiAgICBzZXRPcHRpb25zKG9wdHMpO1xuICAgIGluaXRUb2tlblN0YXRlKCk7XG4gICAgbmMgPSBnZXROb2RlQ3JlYXRvcihzdGFydE5vZGUsIHN0YXJ0Tm9kZUZyb20sIGZpbmlzaE5vZGUsIHVucGFja1R1cGxlKTtcbiAgICByZXR1cm4gcGFyc2VUb3BMZXZlbChvcHRpb25zLnByb2dyYW0pO1xuICB9O1xuXG4gIC8vIEEgc2Vjb25kIG9wdGlvbmFsIGFyZ3VtZW50IGNhbiBiZSBnaXZlbiB0byBmdXJ0aGVyIGNvbmZpZ3VyZVxuICAvLyB0aGUgcGFyc2VyIHByb2Nlc3MuIFRoZXNlIG9wdGlvbnMgYXJlIHJlY29nbml6ZWQ6XG5cbiAgdmFyIGRlZmF1bHRPcHRpb25zID0gZXhwb3J0cy5kZWZhdWx0T3B0aW9ucyA9IHtcbiAgICAvLyBgbGFuZ3VhZ2VWZXJzaW9uYCBpbmRpY2F0ZXMgdGhlIFB5dGhvbiB2ZXJzaW9uIHRvIHBhcnNlLiBJdFxuICAgIC8vIGlzIG5vdCBjdXJyZW50bHkgaW4gdXNlLCBidXQgd2lsbCBzdXBwb3J0IDIgb3IgMyBldmVudHVhbGx5LlxuICAgIGxhbmd1YWdlVmVyc2lvbjogMyxcbiAgICAvLyBXaGVuIGBhbGxvd1RyYWlsaW5nQ29tbWFzYCBpcyBmYWxzZSwgdGhlIHBhcnNlciB3aWxsIG5vdCBhbGxvd1xuICAgIC8vIHRyYWlsaW5nIGNvbW1hcyBpbiBhcnJheSBhbmQgb2JqZWN0IGxpdGVyYWxzLlxuICAgIGFsbG93VHJhaWxpbmdDb21tYXM6IHRydWUsXG4gICAgLy8gV2hlbiBlbmFibGVkLCBhIHJldHVybiBhdCB0aGUgdG9wIGxldmVsIGlzIG5vdCBjb25zaWRlcmVkIGFuXG4gICAgLy8gZXJyb3IuXG4gICAgYWxsb3dSZXR1cm5PdXRzaWRlRnVuY3Rpb246IGZhbHNlLFxuICAgIC8vIFdoZW4gYGxvY2F0aW9uc2AgaXMgb24sIGBsb2NgIHByb3BlcnRpZXMgaG9sZGluZyBvYmplY3RzIHdpdGhcbiAgICAvLyBgc3RhcnRgIGFuZCBgZW5kYCBwcm9wZXJ0aWVzIGluIGB7bGluZSwgY29sdW1ufWAgZm9ybSAod2l0aFxuICAgIC8vIGxpbmUgYmVpbmcgMS1iYXNlZCBhbmQgY29sdW1uIDAtYmFzZWQpIHdpbGwgYmUgYXR0YWNoZWQgdG8gdGhlXG4gICAgLy8gbm9kZXMuXG4gICAgbG9jYXRpb25zOiBmYWxzZSxcbiAgICAvLyBBIGZ1bmN0aW9uIGNhbiBiZSBwYXNzZWQgYXMgYG9uQ29tbWVudGAgb3B0aW9uLCB3aGljaCB3aWxsXG4gICAgLy8gY2F1c2UgRmlsYmVydCB0byBjYWxsIHRoYXQgZnVuY3Rpb24gd2l0aCBgKHRleHQsIHN0YXJ0LFxuICAgIC8vIGVuZClgIHBhcmFtZXRlcnMgd2hlbmV2ZXIgYSBjb21tZW50IGlzIHNraXBwZWQuXG4gICAgLy8gYHRleHRgIGlzIHRoZSBjb250ZW50IG9mIHRoZSBjb21tZW50LCBhbmQgYHN0YXJ0YCBhbmQgYGVuZGAgYXJlXG4gICAgLy8gY2hhcmFjdGVyIG9mZnNldHMgdGhhdCBkZW5vdGUgdGhlIHN0YXJ0IGFuZCBlbmQgb2YgdGhlIGNvbW1lbnQuXG4gICAgLy8gV2hlbiB0aGUgYGxvY2F0aW9uc2Agb3B0aW9uIGlzIG9uLCB0d28gbW9yZSBwYXJhbWV0ZXJzIGFyZVxuICAgIC8vIHBhc3NlZCwgdGhlIGZ1bGwgYHtsaW5lLCBjb2x1bW59YCBsb2NhdGlvbnMgb2YgdGhlIHN0YXJ0IGFuZFxuICAgIC8vIGVuZCBvZiB0aGUgY29tbWVudHMuIE5vdGUgdGhhdCB5b3UgYXJlIG5vdCBhbGxvd2VkIHRvIGNhbGwgdGhlXG4gICAgLy8gcGFyc2VyIGZyb20gdGhlIGNhbGxiYWNrLXRoYXQgd2lsbCBjb3JydXB0IGl0cyBpbnRlcm5hbCBzdGF0ZS5cbiAgICBvbkNvbW1lbnQ6IG51bGwsXG4gICAgLy8gW3NlbWktc3RhbmRhcmRpemVkXVtyYW5nZV0gYHJhbmdlYCBwcm9wZXJ0eSBob2xkaW5nIGEgYFtzdGFydCxcbiAgICAvLyBlbmRdYCBhcnJheSB3aXRoIHRoZSBzYW1lIG51bWJlcnMsIHNldCB0aGUgYHJhbmdlc2Agb3B0aW9uIHRvXG4gICAgLy8gYHRydWVgLlxuICAgIC8vXG4gICAgLy8gW3JhbmdlXTogaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NzQ1Njc4XG4gICAgcmFuZ2VzOiBmYWxzZSxcbiAgICAvLyBJdCBpcyBwb3NzaWJsZSB0byBwYXJzZSBtdWx0aXBsZSBmaWxlcyBpbnRvIGEgc2luZ2xlIEFTVCBieVxuICAgIC8vIHBhc3NpbmcgdGhlIHRyZWUgcHJvZHVjZWQgYnkgcGFyc2luZyB0aGUgZmlyc3QgZmlsZSBhc1xuICAgIC8vIGBwcm9ncmFtYCBvcHRpb24gaW4gc3Vic2VxdWVudCBwYXJzZXMuIFRoaXMgd2lsbCBhZGQgdGhlXG4gICAgLy8gdG9wbGV2ZWwgZm9ybXMgb2YgdGhlIHBhcnNlZCBmaWxlIHRvIHRoZSBgUHJvZ3JhbWAgKHRvcCkgbm9kZVxuICAgIC8vIG9mIGFuIGV4aXN0aW5nIHBhcnNlIHRyZWUuXG4gICAgcHJvZ3JhbTogbnVsbCxcbiAgICAvLyBXaGVuIGBsb2NhdGlvbnNgIGlzIG9uLCB5b3UgY2FuIHBhc3MgdGhpcyB0byByZWNvcmQgdGhlIHNvdXJjZVxuICAgIC8vIGZpbGUgaW4gZXZlcnkgbm9kZSdzIGBsb2NgIG9iamVjdC5cbiAgICBzb3VyY2VGaWxlOiBudWxsLFxuICAgIC8vIFRoaXMgdmFsdWUsIGlmIGdpdmVuLCBpcyBzdG9yZWQgaW4gZXZlcnkgbm9kZSwgd2hldGhlclxuICAgIC8vIGBsb2NhdGlvbnNgIGlzIG9uIG9yIG9mZi5cbiAgICBkaXJlY3RTb3VyY2VGaWxlOiBudWxsLFxuICAgIC8vIFB5dGhvbiBydW50aW1lIGxpYnJhcnkgb2JqZWN0IG5hbWVcbiAgICBydW50aW1lUGFyYW1OYW1lOiBcIl9fcHl0aG9uUnVudGltZVwiXG4gIH07XG5cbiAgZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRzKSB7XG4gICAgb3B0aW9ucyA9IG9wdHMgfHwge307XG4gICAgZm9yICh2YXIgb3B0IGluIGRlZmF1bHRPcHRpb25zKSBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvcHRpb25zLCBvcHQpKVxuICAgICAgb3B0aW9uc1tvcHRdID0gZGVmYXVsdE9wdGlvbnNbb3B0XTtcbiAgICBzb3VyY2VGaWxlID0gb3B0aW9ucy5zb3VyY2VGaWxlIHx8IG51bGw7XG4gIH1cblxuICAvLyBUaGUgYGdldExpbmVJbmZvYCBmdW5jdGlvbiBpcyBtb3N0bHkgdXNlZnVsIHdoZW4gdGhlXG4gIC8vIGBsb2NhdGlvbnNgIG9wdGlvbiBpcyBvZmYgKGZvciBwZXJmb3JtYW5jZSByZWFzb25zKSBhbmQgeW91XG4gIC8vIHdhbnQgdG8gZmluZCB0aGUgbGluZS9jb2x1bW4gcG9zaXRpb24gZm9yIGEgZ2l2ZW4gY2hhcmFjdGVyXG4gIC8vIG9mZnNldC4gYGlucHV0YCBzaG91bGQgYmUgdGhlIGNvZGUgc3RyaW5nIHRoYXQgdGhlIG9mZnNldCByZWZlcnNcbiAgLy8gaW50by5cblxuICB2YXIgZ2V0TGluZUluZm8gPSBleHBvcnRzLmdldExpbmVJbmZvID0gZnVuY3Rpb24oaW5wdXQsIG9mZnNldCkge1xuICAgIGZvciAodmFyIGxpbmUgPSAxLCBjdXIgPSAwOzspIHtcbiAgICAgIGxpbmVCcmVhay5sYXN0SW5kZXggPSBjdXI7XG4gICAgICB2YXIgbWF0Y2ggPSBsaW5lQnJlYWsuZXhlYyhpbnB1dCk7XG4gICAgICBpZiAobWF0Y2ggJiYgbWF0Y2guaW5kZXggPCBvZmZzZXQpIHtcbiAgICAgICAgKytsaW5lO1xuICAgICAgICBjdXIgPSBtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aDtcbiAgICAgIH0gZWxzZSBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHtsaW5lOiBsaW5lLCBjb2x1bW46IG9mZnNldCAtIGN1cn07XG4gIH07XG5cbiAgLy8gRmlsYmVydCBpcyBvcmdhbml6ZWQgYXMgYSB0b2tlbml6ZXIgYW5kIGEgcmVjdXJzaXZlLWRlc2NlbnQgcGFyc2VyLlxuICAvLyBUaGUgYHRva2VuaXplYCBleHBvcnQgcHJvdmlkZXMgYW4gaW50ZXJmYWNlIHRvIHRoZSB0b2tlbml6ZXIuXG4gIC8vIEJlY2F1c2UgdGhlIHRva2VuaXplciBpcyBvcHRpbWl6ZWQgZm9yIGJlaW5nIGVmZmljaWVudGx5IHVzZWQgYnlcbiAgLy8gdGhlIEZpbGJlcnQgcGFyc2VyIGl0c2VsZiwgdGhpcyBpbnRlcmZhY2UgaXMgc29tZXdoYXQgY3J1ZGUgYW5kIG5vdFxuICAvLyB2ZXJ5IG1vZHVsYXIuIFBlcmZvcm1pbmcgYW5vdGhlciBwYXJzZSBvciBjYWxsIHRvIGB0b2tlbml6ZWAgd2lsbFxuICAvLyByZXNldCB0aGUgaW50ZXJuYWwgc3RhdGUsIGFuZCBpbnZhbGlkYXRlIGV4aXN0aW5nIHRva2VuaXplcnMuXG5cbiAgZXhwb3J0cy50b2tlbml6ZSA9IGZ1bmN0aW9uKGlucHQsIG9wdHMpIHtcbiAgICBpbnB1dCA9IFN0cmluZyhpbnB0KTsgaW5wdXRMZW4gPSBpbnB1dC5sZW5ndGg7XG4gICAgc2V0T3B0aW9ucyhvcHRzKTtcbiAgICBpbml0VG9rZW5TdGF0ZSgpO1xuXG4gICAgdmFyIHQgPSB7fTtcbiAgICBmdW5jdGlvbiBnZXRUb2tlbihmb3JjZVJlZ2V4cCkge1xuICAgICAgbGFzdEVuZCA9IHRva0VuZDtcbiAgICAgIHJlYWRUb2tlbihmb3JjZVJlZ2V4cCk7XG4gICAgICB0LnN0YXJ0ID0gdG9rU3RhcnQ7IHQuZW5kID0gdG9rRW5kO1xuICAgICAgdC5zdGFydExvYyA9IHRva1N0YXJ0TG9jOyB0LmVuZExvYyA9IHRva0VuZExvYztcbiAgICAgIHQudHlwZSA9IHRva1R5cGU7IHQudmFsdWUgPSB0b2tWYWw7XG4gICAgICByZXR1cm4gdDtcbiAgICB9XG4gICAgZ2V0VG9rZW4uanVtcFRvID0gZnVuY3Rpb24ocG9zLCByZUFsbG93ZWQpIHtcbiAgICAgIHRva1BvcyA9IHBvcztcbiAgICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucykge1xuICAgICAgICB0b2tDdXJMaW5lID0gMTtcbiAgICAgICAgdG9rTGluZVN0YXJ0ID0gbGluZUJyZWFrLmxhc3RJbmRleCA9IDA7XG4gICAgICAgIHZhciBtYXRjaDtcbiAgICAgICAgd2hpbGUgKChtYXRjaCA9IGxpbmVCcmVhay5leGVjKGlucHV0KSkgJiYgbWF0Y2guaW5kZXggPCBwb3MpIHtcbiAgICAgICAgICArK3Rva0N1ckxpbmU7XG4gICAgICAgICAgdG9rTGluZVN0YXJ0ID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRva1JlZ2V4cEFsbG93ZWQgPSByZUFsbG93ZWQ7XG4gICAgICBza2lwU3BhY2UoKTtcbiAgICB9O1xuICAgIHJldHVybiBnZXRUb2tlbjtcbiAgfTtcblxuICAvLyBTdGF0ZSBpcyBrZXB0IGluIChjbG9zdXJlLSlnbG9iYWwgdmFyaWFibGVzLiBXZSBhbHJlYWR5IHNhdyB0aGVcbiAgLy8gYG9wdGlvbnNgLCBgaW5wdXRgLCBhbmQgYGlucHV0TGVuYCB2YXJpYWJsZXMgYWJvdmUuXG5cbiAgLy8gVGhlIGN1cnJlbnQgcG9zaXRpb24gb2YgdGhlIHRva2VuaXplciBpbiB0aGUgaW5wdXQuXG5cbiAgdmFyIHRva1BvcztcblxuICAvLyBUaGUgc3RhcnQgYW5kIGVuZCBvZmZzZXRzIG9mIHRoZSBjdXJyZW50IHRva2VuLlxuXG4gIHZhciB0b2tTdGFydCwgdG9rRW5kO1xuXG4gIC8vIFdoZW4gYG9wdGlvbnMubG9jYXRpb25zYCBpcyB0cnVlLCB0aGVzZSBob2xkIG9iamVjdHNcbiAgLy8gY29udGFpbmluZyB0aGUgdG9rZW5zIHN0YXJ0IGFuZCBlbmQgbGluZS9jb2x1bW4gcGFpcnMuXG5cbiAgdmFyIHRva1N0YXJ0TG9jLCB0b2tFbmRMb2M7XG5cbiAgLy8gVGhlIHR5cGUgYW5kIHZhbHVlIG9mIHRoZSBjdXJyZW50IHRva2VuLiBUb2tlbiB0eXBlcyBhcmUgb2JqZWN0cyxcbiAgLy8gbmFtZWQgYnkgdmFyaWFibGVzIGFnYWluc3Qgd2hpY2ggdGhleSBjYW4gYmUgY29tcGFyZWQsIGFuZFxuICAvLyBob2xkaW5nIHByb3BlcnRpZXMgdGhhdCBkZXNjcmliZSB0aGVtIChpbmRpY2F0aW5nLCBmb3IgZXhhbXBsZSxcbiAgLy8gdGhlIHByZWNlZGVuY2Ugb2YgYW4gaW5maXggb3BlcmF0b3IsIGFuZCB0aGUgb3JpZ2luYWwgbmFtZSBvZiBhXG4gIC8vIGtleXdvcmQgdG9rZW4pLiBUaGUga2luZCBvZiB2YWx1ZSB0aGF0J3MgaGVsZCBpbiBgdG9rVmFsYCBkZXBlbmRzXG4gIC8vIG9uIHRoZSB0eXBlIG9mIHRoZSB0b2tlbi4gRm9yIGxpdGVyYWxzLCBpdCBpcyB0aGUgbGl0ZXJhbCB2YWx1ZSxcbiAgLy8gZm9yIG9wZXJhdG9ycywgdGhlIG9wZXJhdG9yIG5hbWUsIGFuZCBzbyBvbi5cblxuICB2YXIgdG9rVHlwZSwgdG9rVmFsO1xuXG4gIC8vIEludGVyYWwgc3RhdGUgZm9yIHRoZSB0b2tlbml6ZXIuIFRvIGRpc3Rpbmd1aXNoIGJldHdlZW4gZGl2aXNpb25cbiAgLy8gb3BlcmF0b3JzIGFuZCByZWd1bGFyIGV4cHJlc3Npb25zLCBpdCByZW1lbWJlcnMgd2hldGhlciB0aGUgbGFzdFxuICAvLyB0b2tlbiB3YXMgb25lIHRoYXQgaXMgYWxsb3dlZCB0byBiZSBmb2xsb3dlZCBieSBhbiBleHByZXNzaW9uLlxuICAvLyAoSWYgaXQgaXMsIGEgc2xhc2ggaXMgcHJvYmFibHkgYSByZWdleHAsIGlmIGl0IGlzbid0IGl0J3MgYVxuICAvLyBkaXZpc2lvbiBvcGVyYXRvci4gU2VlIHRoZSBgcGFyc2VTdGF0ZW1lbnRgIGZ1bmN0aW9uIGZvciBhXG4gIC8vIGNhdmVhdC4pXG5cbiAgdmFyIHRva1JlZ2V4cEFsbG93ZWQ7XG5cbiAgLy8gV2hlbiBgb3B0aW9ucy5sb2NhdGlvbnNgIGlzIHRydWUsIHRoZXNlIGFyZSB1c2VkIHRvIGtlZXBcbiAgLy8gdHJhY2sgb2YgdGhlIGN1cnJlbnQgbGluZSwgYW5kIGtub3cgd2hlbiBhIG5ldyBsaW5lIGhhcyBiZWVuXG4gIC8vIGVudGVyZWQuXG5cbiAgdmFyIHRva0N1ckxpbmUsIHRva0xpbmVTdGFydDtcblxuICAvLyBUaGVzZSBzdG9yZSB0aGUgcG9zaXRpb24gb2YgdGhlIHByZXZpb3VzIHRva2VuLCB3aGljaCBpcyB1c2VmdWxcbiAgLy8gd2hlbiBmaW5pc2hpbmcgYSBub2RlIGFuZCBhc3NpZ25pbmcgaXRzIGBlbmRgIHBvc2l0aW9uLlxuXG4gIHZhciBsYXN0U3RhcnQsIGxhc3RFbmQsIGxhc3RFbmRMb2M7XG5cbiAgLy8gVGhpcyBpcyB0aGUgcGFyc2VyJ3Mgc3RhdGUuIGBpbkZ1bmN0aW9uYCBpcyB1c2VkIHRvIHJlamVjdFxuICAvLyBgcmV0dXJuYCBzdGF0ZW1lbnRzIG91dHNpZGUgb2YgZnVuY3Rpb25zLCBgc3RyaWN0YCBpbmRpY2F0ZXNcbiAgLy8gd2hldGhlciBzdHJpY3QgbW9kZSBpcyBvbiwgYW5kIGBicmFja2V0TmVzdGluZ2AgdHJhY2tzIHRoZSBsZXZlbFxuICAvLyBvZiBuZXN0aW5nIHdpdGhpbiBicmFja2V0cyBmb3IgaW1wbGljaXQgbGludCBjb250aW51YXRpb24uXG5cbiAgdmFyIGluRnVuY3Rpb24sIHN0cmljdCwgYnJhY2tldE5lc3Rpbmc7XG5cbiAgLy8gVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIHJhaXNlIGV4Y2VwdGlvbnMgb24gcGFyc2UgZXJyb3JzLiBJdFxuICAvLyB0YWtlcyBhbiBvZmZzZXQgaW50ZWdlciAoaW50byB0aGUgY3VycmVudCBgaW5wdXRgKSB0byBpbmRpY2F0ZVxuICAvLyB0aGUgbG9jYXRpb24gb2YgdGhlIGVycm9yLCBhdHRhY2hlcyB0aGUgcG9zaXRpb24gdG8gdGhlIGVuZFxuICAvLyBvZiB0aGUgZXJyb3IgbWVzc2FnZSwgYW5kIHRoZW4gcmFpc2VzIGEgYFN5bnRheEVycm9yYCB3aXRoIHRoYXRcbiAgLy8gbWVzc2FnZS5cblxuICBmdW5jdGlvbiByYWlzZShwb3MsIG1lc3NhZ2UpIHtcbiAgICB2YXIgbG9jID0gZ2V0TGluZUluZm8oaW5wdXQsIHBvcyk7XG4gICAgdmFyIGVyciA9IG5ldyBTeW50YXhFcnJvcihtZXNzYWdlKTtcbiAgICBlcnIucG9zID0gcG9zOyBlcnIubG9jID0gbG9jOyBlcnIucmFpc2VkQXQgPSB0b2tQb3M7XG4gICAgdGhyb3cgZXJyO1xuICB9XG5cbiAgLy8gUmV1c2VkIGVtcHR5IGFycmF5IGFkZGVkIGZvciBub2RlIGZpZWxkcyB0aGF0IGFyZSBhbHdheXMgZW1wdHkuXG5cbiAgdmFyIGVtcHR5ID0gW107XG5cbiAgLy8gVXNlZCBmb3IgbmFtZSBjb2xsaXNpb24gYXZvaWRhbmNlIHdoZW5kIGFkZGluZyBleHRyYSBBU1QgaWRlbnRpZmllcnNcblxuICB2YXIgbmV3QXN0SWRDb3VudCA9IDA7XG5cbiAgdmFyIGluZGVudEhpc3QgPSBleHBvcnRzLmluZGVudEhpc3QgPSB7XG4gICAgLy8gQ3VycmVudCBpbmRlbnRhdGlvbiBzdGFja1xuICAgIGluZGVudDogW10sXG5cbiAgICAvLyBOdW1iZXIgb2YgZGVkZW50IHRva2VucyBsZWZ0IChpLmUuIGlmIHRva1R5cGUgPT0gX2RlZGVudCwgZGVkZW50Q291bnQgPiAwKVxuICAgIC8vIE11bHRpcGxlIGRlZGVudCB0b2tlbnMgYXJlIHJlYWQgaW4gYXQgb25jZSwgYnV0IHByb2Nlc3NlZCBpbmRpdmlkdWFsbHkgaW4gcmVhZFRva2VuKClcbiAgICBkZWRlbnRDb3VudDogMCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uICgpIHsgdGhpcy5pbmRlbnQgPSBbXTsgdGhpcy5kZWRlbnRDb3VudCA9IDA7IH0sXG4gICAgY291bnQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuaW5kZW50Lmxlbmd0aDsgfSxcbiAgICBsZW46IGZ1bmN0aW9uIChpKSB7IFxuICAgICAgaWYgKHR5cGVvZiBpID09PSAndW5kZWZpbmVkJyB8fCBpID49IHRoaXMuaW5kZW50Lmxlbmd0aCkgaSA9IHRoaXMuaW5kZW50Lmxlbmd0aCAtIDE7XG4gICAgICByZXR1cm4gdGhpcy5pbmRlbnRbaV0ubGVuZ3RoOyBcbiAgICB9LFxuICAgIGlzSW5kZW50OiBmdW5jdGlvbihzKSB7XG4gICAgICByZXR1cm4gdGhpcy5pbmRlbnQubGVuZ3RoID09PSAwIHx8IHMubGVuZ3RoID4gdGhpcy5sZW4oKTtcbiAgICB9LFxuICAgIGlzRGVkZW50OiBmdW5jdGlvbihzKSB7XG4gICAgICByZXR1cm4gdGhpcy5pbmRlbnQubGVuZ3RoID4gMCAmJiBzLmxlbmd0aCA8IHRoaXMubGVuKCk7XG4gICAgfSxcbiAgICBhZGRJbmRlbnQ6IGZ1bmN0aW9uIChzKSB7IHRoaXMuaW5kZW50LnB1c2gocyk7IH0sXG4gICAgYWRkRGVkZW50OiBmdW5jdGlvbiAocykge1xuICAgICAgdGhpcy5kZWRlbnRDb3VudCA9IDA7XG4gICAgICBmb3IgKHZhciBpID0gdGhpcy5pbmRlbnQubGVuZ3RoIC0gMTsgaSA+PSAwICYmIHMubGVuZ3RoIDwgdGhpcy5pbmRlbnRbaV0ubGVuZ3RoOyAtLWkpXG4gICAgICAgICsrdGhpcy5kZWRlbnRDb3VudDtcbiAgICB9LFxuICAgIHVwZGF0ZURlZGVudDogZnVuY3Rpb24gKCkgeyB0aGlzLmRlZGVudENvdW50ID0gdGhpcy5jb3VudCgpOyB9LFxuICAgIHBvcDogZnVuY3Rpb24gKCkge1xuICAgICAgLS10aGlzLmRlZGVudENvdW50O1xuICAgICAgdGhpcy5pbmRlbnQucG9wKCk7XG4gICAgfSxcbiAgICB1bmRvSW5kZW50OiBmdW5jdGlvbiAoKSB7IHRoaXMucG9wKCk7IH1cbiAgfTtcblxuICAvLyAjIyBTY29wZVxuXG4gIC8vIENvbGxlY3Rpb24gb2YgbmFtZXNwYWNlcyBzYXZlZCBhcyBhIHN0YWNrXG4gIC8vIEEgbmFtZXNwYWNlIGlzIGEgbWFwcGluZyBvZiBpZGVudGlmaWVycyB0byAzIHR5cGVzOiB2YXJpYWJsZXMsIGZ1bmN0aW9ucywgY2xhc3Nlc1xuICAvLyBBIG5hbWVzcGFjZSBhbHNvIGtub3dzIHdoZXRoZXIgaXQgaXMgZm9yIGdsb2JhbCwgY2xhc3MsIG9yIGZ1bmN0aW9uXG4gIC8vIEEgbmV3IG5hbWVzcGFjZSBpcyBwdXNoZWQgYXQgZnVuY3Rpb24gYW5kIGNsYXNzIHN0YXJ0LCBhbmQgcG9wcGVkIGF0IHRoZWlyIGVuZFxuICAvLyBTdGFydHMgd2l0aCBhIGdsb2JhbCBuYW1lc3BhY2Ugb24gdGhlIHN0YWNrXG4gIC8vIEUuZy4gc2NvcGUubmFtZXNwYWNlcyB+IFt7dHlwZTogJ2cnLCBtYXA6e3g6ICd2JywgTXlDbGFzczogJ2MnfSB9LCAuLi5dXG5cbiAgLy8gVE9ETzogTm90IHRyYWNraW5nIGJ1aWx0LWluIG5hbWVzcGFjZVxuICBcbiAgdmFyIHNjb3BlID0gZXhwb3J0cy5zY29wZSA9IHtcbiAgICBuYW1lc3BhY2VzOiBbXSxcbiAgICBpbml0OiBmdW5jdGlvbiAoKSB7IHRoaXMubmFtZXNwYWNlcyA9IFt7IHR5cGU6ICdnJywgbWFwOiB7fSB9XTsgfSxcbiAgICBjdXJyZW50OiBmdW5jdGlvbihvZmZzZXQpIHsgXG4gICAgICBvZmZzZXQgPSBvZmZzZXQgfHwgMDtcbiAgICAgIHJldHVybiB0aGlzLm5hbWVzcGFjZXNbdGhpcy5uYW1lc3BhY2VzLmxlbmd0aCAtIG9mZnNldCAtIDFdO1xuICAgIH0sXG4gICAgc3RhcnRDbGFzczogZnVuY3Rpb24gKGlkKSB7XG4gICAgICB0aGlzLmN1cnJlbnQoKS5tYXBbaWRdID0gJ2MnO1xuICAgICAgdGhpcy5uYW1lc3BhY2VzLnB1c2goeyB0eXBlOiAnYycsIG1hcDoge30sIGNsYXNzTmFtZTogaWQgfSk7XG4gICAgfSxcbiAgICBzdGFydEZuOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgIHRoaXMuY3VycmVudCgpLm1hcFtpZF0gPSAnZic7XG4gICAgICB0aGlzLm5hbWVzcGFjZXMucHVzaCh7IHR5cGU6ICdmJywgbWFwOiB7fSwgZm5OYW1lOiBpZCB9KTtcbiAgICB9LFxuICAgIGVuZDogZnVuY3Rpb24gKCkgeyB0aGlzLm5hbWVzcGFjZXMucG9wKCk7IH0sXG4gICAgYWRkVmFyOiBmdW5jdGlvbiAoaWQpIHsgdGhpcy5jdXJyZW50KCkubWFwW2lkXSA9ICd2JzsgfSxcbiAgICBleGlzdHM6IGZ1bmN0aW9uIChpZCkgeyByZXR1cm4gdGhpcy5jdXJyZW50KCkubWFwLmhhc093blByb3BlcnR5KGlkKTsgfSxcbiAgICBpc0NsYXNzOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmN1cnJlbnQoKS50eXBlID09PSAnYyc7IH0sXG4gICAgaXNVc2VyRnVuY3Rpb246IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIC8vIExvb3NlIG1hdGNoIChpLmUuIG9yZGVyIGlnbm9yZWQpXG4gICAgICAvLyBUT0RPOiBkb2VzIG5vdCBpZGVudGlmeSB1c2VyLWRlZmluZWQgY2xhc3MgbWV0aG9kc1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMubmFtZXNwYWNlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSlcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMubmFtZXNwYWNlc1tpXS5tYXApXG4gICAgICAgICAgaWYgKGtleSA9PT0gbmFtZSAmJiB0aGlzLm5hbWVzcGFjZXNbaV0ubWFwW2tleV0gPT09ICdmJylcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgaXNQYXJlbnRDbGFzczogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLmN1cnJlbnQoMSkudHlwZSA9PT0gJ2MnOyB9LFxuICAgIGlzTmV3T2JqOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLm5hbWVzcGFjZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pXG4gICAgICAgIGlmICh0aGlzLm5hbWVzcGFjZXNbaV0ubWFwW2lkXSA9PT0gJ2MnKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgZWxzZSBpZiAodGhpcy5uYW1lc3BhY2VzW2ldLm1hcFtpZF0gPT09ICdmJykgYnJlYWs7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcbiAgICBnZXRQYXJlbnRDbGFzc05hbWU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuY3VycmVudCgxKS5jbGFzc05hbWU7IH0sXG4gICAgZ2V0VGhpc1JlcGxhY2U6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuY3VycmVudCgpLnRoaXNSZXBsYWNlOyB9LFxuICAgIHNldFRoaXNSZXBsYWNlOiBmdW5jdGlvbiAocykgeyB0aGlzLmN1cnJlbnQoKS50aGlzUmVwbGFjZSA9IHM7IH1cbiAgfTtcbiAgXG5cbiAgLy8gIyMgVG9rZW4gdHlwZXNcblxuICAvLyBUaGUgYXNzaWdubWVudCBvZiBmaW5lLWdyYWluZWQsIGluZm9ybWF0aW9uLWNhcnJ5aW5nIHR5cGUgb2JqZWN0c1xuICAvLyBhbGxvd3MgdGhlIHRva2VuaXplciB0byBzdG9yZSB0aGUgaW5mb3JtYXRpb24gaXQgaGFzIGFib3V0IGFcbiAgLy8gdG9rZW4gaW4gYSB3YXkgdGhhdCBpcyB2ZXJ5IGNoZWFwIGZvciB0aGUgcGFyc2VyIHRvIGxvb2sgdXAuXG5cbiAgLy8gQWxsIHRva2VuIHR5cGUgdmFyaWFibGVzIHN0YXJ0IHdpdGggYW4gdW5kZXJzY29yZSwgdG8gbWFrZSB0aGVtXG4gIC8vIGVhc3kgdG8gcmVjb2duaXplLlxuXG4gIC8vIFRoZXNlIGFyZSB0aGUgZ2VuZXJhbCB0eXBlcy4gVGhlIGB0eXBlYCBwcm9wZXJ0eSBpcyBvbmx5IHVzZWQgdG9cbiAgLy8gbWFrZSB0aGVtIHJlY29nbml6ZWFibGUgd2hlbiBkZWJ1Z2dpbmcuXG5cbiAgdmFyIF9udW0gPSB7dHlwZTogXCJudW1cIn0sIF9yZWdleHAgPSB7dHlwZTogXCJyZWdleHBcIn0sIF9zdHJpbmcgPSB7dHlwZTogXCJzdHJpbmdcIn07XG4gIHZhciBfbmFtZSA9IHt0eXBlOiBcIm5hbWVcIn0sIF9lb2YgPSB7dHlwZTogXCJlb2ZcIn07XG4gIHZhciBfbmV3bGluZSA9IHt0eXBlOiBcIm5ld2xpbmVcIn0sIF9pbmRlbnQgPSB7dHlwZTogXCJpbmRlbnRcIn0sIF9kZWRlbnQgPSB7dHlwZTogXCJkZWRlbnRcIn07XG5cbiAgLy8gS2V5d29yZCB0b2tlbnMuIFRoZSBga2V5d29yZGAgcHJvcGVydHkgKGFsc28gdXNlZCBpbiBrZXl3b3JkLWxpa2VcbiAgLy8gb3BlcmF0b3JzKSBpbmRpY2F0ZXMgdGhhdCB0aGUgdG9rZW4gb3JpZ2luYXRlZCBmcm9tIGFuXG4gIC8vIGlkZW50aWZpZXItbGlrZSB3b3JkLCB3aGljaCBpcyB1c2VkIHdoZW4gcGFyc2luZyBwcm9wZXJ0eSBuYW1lcy5cbiAgLy9cbiAgLy8gVGhlIGBiZWZvcmVFeHByYCBwcm9wZXJ0eSBpcyB1c2VkIHRvIGRpc2FtYmlndWF0ZSBiZXR3ZWVuIHJlZ3VsYXJcbiAgLy8gZXhwcmVzc2lvbnMgYW5kIGRpdmlzaW9ucy4gSXQgaXMgc2V0IG9uIGFsbCB0b2tlbiB0eXBlcyB0aGF0IGNhblxuICAvLyBiZSBmb2xsb3dlZCBieSBhbiBleHByZXNzaW9uICh0aHVzLCBhIHNsYXNoIGFmdGVyIHRoZW0gd291bGQgYmUgYVxuICAvLyByZWd1bGFyIGV4cHJlc3Npb24pLlxuICBcbiAgdmFyIF9kaWN0ID0geyBrZXl3b3JkOiBcImRpY3RcIiB9OyAgLy8gVE9ETzogbm90IGEga2V5d29yZFxuICB2YXIgX2FzID0geyBrZXl3b3JkOiBcImFzXCIgfSwgX2Fzc2VydCA9IHsga2V5d29yZDogXCJhc3NlcnRcIiB9LCBfYnJlYWsgPSB7IGtleXdvcmQ6IFwiYnJlYWtcIiB9O1xuICB2YXIgX2NsYXNzID0geyBrZXl3b3JkOiBcImNsYXNzXCIgfSwgX2NvbnRpbnVlID0geyBrZXl3b3JkOiBcImNvbnRpbnVlXCIgfTtcbiAgdmFyIF9kZWYgPSB7IGtleXdvcmQ6IFwiZGVmXCIgfSwgX2RlbCA9IHsga2V5d29yZDogXCJkZWxcIiB9O1xuICB2YXIgX2VsaWYgPSB7IGtleXdvcmQ6IFwiZWxpZlwiLCBiZWZvcmVFeHByOiB0cnVlIH0sIF9lbHNlID0geyBrZXl3b3JkOiBcImVsc2VcIiwgYmVmb3JlRXhwcjogdHJ1ZSB9O1xuICB2YXIgX2V4Y2VwdCA9IHsga2V5d29yZDogXCJleGNlcHRcIiwgYmVmb3JlRXhwcjogdHJ1ZSB9LCBfZmluYWxseSA9IHtrZXl3b3JkOiBcImZpbmFsbHlcIn07XG4gIHZhciBfZm9yID0geyBrZXl3b3JkOiBcImZvclwiIH0sIF9mcm9tID0geyBrZXl3b3JkOiBcImZyb21cIiB9LCBfZ2xvYmFsID0geyBrZXl3b3JkOiBcImdsb2JhbFwiIH07XG4gIHZhciBfaWYgPSB7IGtleXdvcmQ6IFwiaWZcIiB9LCBfaW1wb3J0ID0geyBrZXl3b3JkOiBcImltcG9ydFwiIH07XG4gIHZhciBfbGFtYmRhID0ge2tleXdvcmQ6IFwibGFtYmRhXCJ9LCBfbm9ubG9jYWwgPSB7a2V5d29yZDogXCJub25sb2NhbFwifTtcbiAgdmFyIF9wYXNzID0geyBrZXl3b3JkOiBcInBhc3NcIiB9LCBfcmFpc2UgPSB7a2V5d29yZDogXCJyYWlzZVwifTtcbiAgdmFyIF9yZXR1cm4gPSB7IGtleXdvcmQ6IFwicmV0dXJuXCIsIGJlZm9yZUV4cHI6IHRydWUgfSwgX3RyeSA9IHsga2V5d29yZDogXCJ0cnlcIiB9O1xuICB2YXIgX3doaWxlID0ge2tleXdvcmQ6IFwid2hpbGVcIn0sIF93aXRoID0ge2tleXdvcmQ6IFwid2l0aFwifSwgX3lpZWxkID0ge2tleXdvcmQ6IFwieWllbGRcIn07XG5cbiAgLy8gVGhlIGtleXdvcmRzIHRoYXQgZGVub3RlIHZhbHVlcy5cblxuICB2YXIgX25vbmUgPSB7a2V5d29yZDogXCJOb25lXCIsIGF0b21WYWx1ZTogbnVsbH0sIF90cnVlID0ge2tleXdvcmQ6IFwiVHJ1ZVwiLCBhdG9tVmFsdWU6IHRydWV9O1xuICB2YXIgX2ZhbHNlID0ge2tleXdvcmQ6IFwiRmFsc2VcIiwgYXRvbVZhbHVlOiBmYWxzZX07XG5cbiAgLy8gU29tZSBrZXl3b3JkcyBhcmUgdHJlYXRlZCBhcyByZWd1bGFyIG9wZXJhdG9ycy4gYGluYCBzb21ldGltZXNcbiAgLy8gKHdoZW4gcGFyc2luZyBgZm9yYCkgbmVlZHMgdG8gYmUgdGVzdGVkIGFnYWluc3Qgc3BlY2lmaWNhbGx5LCBzb1xuICAvLyB3ZSBhc3NpZ24gYSB2YXJpYWJsZSBuYW1lIHRvIGl0IGZvciBxdWljayBjb21wYXJpbmcuXG4gIC8vICdwcmVjJyBpcyB0aGUgb3BlcmF0b3IgcHJlY2VkZW5jZSdcblxuICB2YXIgX29yID0geyBrZXl3b3JkOiBcIm9yXCIsIHByZWM6IDEsIGJlZm9yZUV4cHI6IHRydWUsIHJlcDogXCJ8fFwiIH07XG4gIHZhciBfYW5kID0geyBrZXl3b3JkOiBcImFuZFwiLCBwcmVjOiAyLCBiZWZvcmVFeHByOiB0cnVlLCByZXA6IFwiJiZcIiB9O1xuICB2YXIgX25vdCA9IHsga2V5d29yZDogXCJub3RcIiwgcHJlYzogMywgcHJlZml4OiB0cnVlLCBiZWZvcmVFeHByOiB0cnVlLCByZXA6IFwiIVwiIH07XG4gIHZhciBfaW4gPSB7IGtleXdvcmQ6IFwiaW5cIiwgcHJlYzogNCwgYmVmb3JlRXhwcjogdHJ1ZSB9O1xuICB2YXIgX2lzID0geyBrZXl3b3JkOiBcImlzXCIsIHByZWM6IDQsIGJlZm9yZUV4cHI6IHRydWUgfTtcblxuICAvLyBNYXAga2V5d29yZCBuYW1lcyB0byB0b2tlbiB0eXBlcy5cblxuICB2YXIga2V5d29yZFR5cGVzID0ge1xuICAgIFwiZGljdFwiOiBfZGljdCxcbiAgICBcIkZhbHNlXCI6IF9mYWxzZSwgXCJOb25lXCI6IF9ub25lLCBcIlRydWVcIjogX3RydWUsIFwiYW5kXCI6IF9hbmQsIFwiYXNcIjogX2FzLCBcbiAgICBcImJyZWFrXCI6IF9icmVhaywgXCJjbGFzc1wiOiBfY2xhc3MsIFwiY29udGludWVcIjogX2NvbnRpbnVlLCBcImRlZlwiOiBfZGVmLCBcImRlbFwiOiBfZGVsLFxuICAgIFwiZWxpZlwiOiBfZWxpZiwgXCJlbHNlXCI6IF9lbHNlLCBcImV4Y2VwdFwiOiBfZXhjZXB0LCBcImZpbmFsbHlcIjogX2ZpbmFsbHksIFwiZm9yXCI6IF9mb3IsXG4gICAgXCJmcm9tXCI6IF9mcm9tLCBcImdsb2JhbFwiOiBfZ2xvYmFsLCBcImlmXCI6IF9pZiwgXCJpbXBvcnRcIjogX2ltcG9ydCwgXCJpblwiOiBfaW4sIFwiaXNcIjogX2lzLCBcbiAgICBcImxhbWJkYVwiOiBfbGFtYmRhLCBcIm5vbmxvY2FsXCI6IF9ub25sb2NhbCwgXCJub3RcIjogX25vdCwgXCJvclwiOiBfb3IsIFxuICAgIFwicGFzc1wiOiBfcGFzcywgXCJyYWlzZVwiOiBfcmFpc2UsIFwicmV0dXJuXCI6IF9yZXR1cm4sIFwidHJ5XCI6IF90cnksIFwid2hpbGVcIjogX3doaWxlLCBcbiAgICBcIndpdGhcIjogX3dpdGgsIFwieWllbGRcIjogX3lpZWxkXG4gIH07XG5cbiAgLy8gUHVuY3R1YXRpb24gdG9rZW4gdHlwZXMuIEFnYWluLCB0aGUgYHR5cGVgIHByb3BlcnR5IGlzIHB1cmVseSBmb3IgZGVidWdnaW5nLlxuXG4gIHZhciBfYnJhY2tldEwgPSB7dHlwZTogXCJbXCIsIGJlZm9yZUV4cHI6IHRydWV9LCBfYnJhY2tldFIgPSB7dHlwZTogXCJdXCJ9LCBfYnJhY2VMID0ge3R5cGU6IFwie1wiLCBiZWZvcmVFeHByOiB0cnVlfTtcbiAgdmFyIF9icmFjZVIgPSB7dHlwZTogXCJ9XCJ9LCBfcGFyZW5MID0ge3R5cGU6IFwiKFwiLCBiZWZvcmVFeHByOiB0cnVlfSwgX3BhcmVuUiA9IHt0eXBlOiBcIilcIn07XG4gIHZhciBfY29tbWEgPSB7dHlwZTogXCIsXCIsIGJlZm9yZUV4cHI6IHRydWV9LCBfc2VtaSA9IHt0eXBlOiBcIjtcIiwgYmVmb3JlRXhwcjogdHJ1ZX07XG4gIHZhciBfY29sb24gPSB7IHR5cGU6IFwiOlwiLCBiZWZvcmVFeHByOiB0cnVlIH0sIF9kb3QgPSB7IHR5cGU6IFwiLlwiIH0sIF9xdWVzdGlvbiA9IHsgdHlwZTogXCI/XCIsIGJlZm9yZUV4cHI6IHRydWUgfTtcbiAgXG4gIC8vIE9wZXJhdG9ycy4gVGhlc2UgY2Fycnkgc2V2ZXJhbCBraW5kcyBvZiBwcm9wZXJ0aWVzIHRvIGhlbHAgdGhlXG4gIC8vIHBhcnNlciB1c2UgdGhlbSBwcm9wZXJseSAodGhlIHByZXNlbmNlIG9mIHRoZXNlIHByb3BlcnRpZXMgaXNcbiAgLy8gd2hhdCBjYXRlZ29yaXplcyB0aGVtIGFzIG9wZXJhdG9ycykuXG4gIC8vXG4gIC8vIGBwcmVjYCBzcGVjaWZpZXMgdGhlIHByZWNlZGVuY2Ugb2YgdGhpcyBvcGVyYXRvci5cbiAgLy9cbiAgLy8gYHByZWZpeGAgbWFya3MgdGhlIG9wZXJhdG9yIGFzIGEgcHJlZml4IHVuYXJ5IG9wZXJhdG9yLiBcbiAgLy9cbiAgLy8gYGlzQXNzaWduYCBtYXJrcyBhbGwgb2YgYD1gLCBgKz1gLCBgLT1gIGV0Y2V0ZXJhLCB3aGljaCBhY3QgYXNcbiAgLy8gYmluYXJ5IG9wZXJhdG9ycyB3aXRoIGEgdmVyeSBsb3cgcHJlY2VkZW5jZSwgdGhhdCBzaG91bGQgcmVzdWx0XG4gIC8vIGluIEFzc2lnbm1lbnRFeHByZXNzaW9uIG5vZGVzLlxuXG4gIHZhciBfc2xhc2ggPSB7IHByZWM6IDEwLCBiZWZvcmVFeHByOiB0cnVlIH0sIF9lcSA9IHsgaXNBc3NpZ246IHRydWUsIGJlZm9yZUV4cHI6IHRydWUgfTtcbiAgdmFyIF9hc3NpZ24gPSB7aXNBc3NpZ246IHRydWUsIGJlZm9yZUV4cHI6IHRydWV9O1xuICB2YXIgX2VxdWFsaXR5ID0geyBwcmVjOiA0LCBiZWZvcmVFeHByOiB0cnVlIH07XG4gIHZhciBfcmVsYXRpb25hbCA9IHtwcmVjOiA0LCBiZWZvcmVFeHByOiB0cnVlIH07XG4gIHZhciBfYml0d2lzZU9SID0geyBwcmVjOiA1LCBiZWZvcmVFeHByOiB0cnVlIH07XG4gIHZhciBfYml0d2lzZVhPUiA9IHsgcHJlYzogNiwgYmVmb3JlRXhwcjogdHJ1ZSB9O1xuICB2YXIgX2JpdHdpc2VBTkQgPSB7IHByZWM6IDcsIGJlZm9yZUV4cHI6IHRydWUgfTtcbiAgdmFyIF9iaXRTaGlmdCA9IHsgcHJlYzogOCwgYmVmb3JlRXhwcjogdHJ1ZSB9O1xuICB2YXIgX3BsdXNNaW4gPSB7IHByZWM6IDksIGJlZm9yZUV4cHI6IHRydWUgfTtcbiAgdmFyIF9tdWx0aXBseU1vZHVsbyA9IHsgcHJlYzogMTAsIGJlZm9yZUV4cHI6IHRydWUgfTtcbiAgdmFyIF9mbG9vckRpdiA9IHsgcHJlYzogMTAsIGJlZm9yZUV4cHI6IHRydWUgfTtcbiAgdmFyIF9wb3NOZWdOb3QgPSB7IHByZWM6IDExLCBwcmVmaXg6IHRydWUsIGJlZm9yZUV4cHI6IHRydWUgfTtcbiAgdmFyIF9iaXR3aXNlTk9UID0geyBwcmVjOiAxMSwgcHJlZml4OiB0cnVlLCBiZWZvcmVFeHByOiB0cnVlIH07XG4gIHZhciBfZXhwb25lbnRpYXRpb24gPSB7IHByZWM6IDEyLCBiZWZvcmVFeHByOiB0cnVlIH07XG5cbiAgLy8gUHJvdmlkZSBhY2Nlc3MgdG8gdGhlIHRva2VuIHR5cGVzIGZvciBleHRlcm5hbCB1c2VycyBvZiB0aGVcbiAgLy8gdG9rZW5pemVyLlxuXG4gIGV4cG9ydHMudG9rVHlwZXMgPSB7YnJhY2tldEw6IF9icmFja2V0TCwgYnJhY2tldFI6IF9icmFja2V0UiwgYnJhY2VMOiBfYnJhY2VMLCBicmFjZVI6IF9icmFjZVIsXG4gICAgICAgICAgICAgICAgICAgICAgcGFyZW5MOiBfcGFyZW5MLCBwYXJlblI6IF9wYXJlblIsIGNvbW1hOiBfY29tbWEsIHNlbWk6IF9zZW1pLCBjb2xvbjogX2NvbG9uLFxuICAgICAgICAgICAgICAgICAgICAgIGRvdDogX2RvdCwgcXVlc3Rpb246IF9xdWVzdGlvbiwgc2xhc2g6IF9zbGFzaCwgZXE6IF9lcSwgbmFtZTogX25hbWUsIGVvZjogX2VvZixcbiAgICAgICAgICAgICAgICAgICAgICBudW06IF9udW0sIHJlZ2V4cDogX3JlZ2V4cCwgc3RyaW5nOiBfc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgIG5ld2xpbmU6IF9uZXdsaW5lLCBpbmRlbnQ6IF9pbmRlbnQsIGRlZGVudDogX2RlZGVudCxcbiAgICAgICAgICAgICAgICAgICAgICBleHBvbmVudGlhdGlvbjogX2V4cG9uZW50aWF0aW9uLCBmbG9vckRpdjogX2Zsb29yRGl2LCBwbHVzTWluOiBfcGx1c01pbixcbiAgICAgICAgICAgICAgICAgICAgICBwb3NOZWdOb3Q6IF9wb3NOZWdOb3QsIG11bHRpcGx5TW9kdWxvOiBfbXVsdGlwbHlNb2R1bG9cbiAgfTtcbiAgZm9yICh2YXIga3cgaW4ga2V5d29yZFR5cGVzKSBleHBvcnRzLnRva1R5cGVzW1wiX1wiICsga3ddID0ga2V5d29yZFR5cGVzW2t3XTtcblxuICAvLyBUaGlzIGlzIGEgdHJpY2sgdGFrZW4gZnJvbSBFc3ByaW1hLiBJdCB0dXJucyBvdXQgdGhhdCwgb25cbiAgLy8gbm9uLUNocm9tZSBicm93c2VycywgdG8gY2hlY2sgd2hldGhlciBhIHN0cmluZyBpcyBpbiBhIHNldCwgYVxuICAvLyBwcmVkaWNhdGUgY29udGFpbmluZyBhIGJpZyB1Z2x5IGBzd2l0Y2hgIHN0YXRlbWVudCBpcyBmYXN0ZXIgdGhhblxuICAvLyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiwgYW5kIG9uIENocm9tZSB0aGUgdHdvIGFyZSBhYm91dCBvbiBwYXIuXG4gIC8vIFRoaXMgZnVuY3Rpb24gdXNlcyBgZXZhbGAgKG5vbi1sZXhpY2FsKSB0byBwcm9kdWNlIHN1Y2ggYVxuICAvLyBwcmVkaWNhdGUgZnJvbSBhIHNwYWNlLXNlcGFyYXRlZCBzdHJpbmcgb2Ygd29yZHMuXG4gIC8vXG4gIC8vIEl0IHN0YXJ0cyBieSBzb3J0aW5nIHRoZSB3b3JkcyBieSBsZW5ndGguXG5cbiAgZnVuY3Rpb24gbWFrZVByZWRpY2F0ZSh3b3Jkcykge1xuICAgIHdvcmRzID0gd29yZHMuc3BsaXQoXCIgXCIpO1xuICAgIHZhciBmID0gXCJcIiwgY2F0cyA9IFtdO1xuICAgIG91dDogZm9yICh2YXIgaSA9IDA7IGkgPCB3b3Jkcy5sZW5ndGg7ICsraSkge1xuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBjYXRzLmxlbmd0aDsgKytqKVxuICAgICAgICBpZiAoY2F0c1tqXVswXS5sZW5ndGggPT0gd29yZHNbaV0ubGVuZ3RoKSB7XG4gICAgICAgICAgY2F0c1tqXS5wdXNoKHdvcmRzW2ldKTtcbiAgICAgICAgICBjb250aW51ZSBvdXQ7XG4gICAgICAgIH1cbiAgICAgIGNhdHMucHVzaChbd29yZHNbaV1dKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gY29tcGFyZVRvKGFycikge1xuICAgICAgaWYgKGFyci5sZW5ndGggPT0gMSkgcmV0dXJuIGYgKz0gXCJyZXR1cm4gc3RyID09PSBcIiArIEpTT04uc3RyaW5naWZ5KGFyclswXSkgKyBcIjtcIjtcbiAgICAgIGYgKz0gXCJzd2l0Y2goc3RyKXtcIjtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgKytpKSBmICs9IFwiY2FzZSBcIiArIEpTT04uc3RyaW5naWZ5KGFycltpXSkgKyBcIjpcIjtcbiAgICAgIGYgKz0gXCJyZXR1cm4gdHJ1ZX1yZXR1cm4gZmFsc2U7XCI7XG4gICAgfVxuXG4gICAgLy8gV2hlbiB0aGVyZSBhcmUgbW9yZSB0aGFuIHRocmVlIGxlbmd0aCBjYXRlZ29yaWVzLCBhbiBvdXRlclxuICAgIC8vIHN3aXRjaCBmaXJzdCBkaXNwYXRjaGVzIG9uIHRoZSBsZW5ndGhzLCB0byBzYXZlIG9uIGNvbXBhcmlzb25zLlxuXG4gICAgaWYgKGNhdHMubGVuZ3RoID4gMykge1xuICAgICAgY2F0cy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtyZXR1cm4gYi5sZW5ndGggLSBhLmxlbmd0aDt9KTtcbiAgICAgIGYgKz0gXCJzd2l0Y2goc3RyLmxlbmd0aCl7XCI7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhdHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIGNhdCA9IGNhdHNbaV07XG4gICAgICAgIGYgKz0gXCJjYXNlIFwiICsgY2F0WzBdLmxlbmd0aCArIFwiOlwiO1xuICAgICAgICBjb21wYXJlVG8oY2F0KTtcbiAgICAgIH1cbiAgICAgIGYgKz0gXCJ9XCI7XG5cbiAgICAgIC8vIE90aGVyd2lzZSwgc2ltcGx5IGdlbmVyYXRlIGEgZmxhdCBgc3dpdGNoYCBzdGF0ZW1lbnQuXG5cbiAgICB9IGVsc2Uge1xuICAgICAgY29tcGFyZVRvKHdvcmRzKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBGdW5jdGlvbihcInN0clwiLCBmKTtcbiAgfVxuXG4gIC8vIFRoZSBmb3JiaWRkZW4gdmFyaWFibGUgbmFtZXNcblxuICB2YXIgaXNTdHJpY3RCYWRJZFdvcmQgPSBtYWtlUHJlZGljYXRlKFwiZXZhbCBhcmd1bWVudHNcIik7XG5cbiAgLy8gS2V5d29yZHNcbiAgLy8gVE9ETzogZGljdCBpc24ndCBhIGtleXdvcmQsIGl0J3MgYSBidWlsdGluXG5cbiAgdmFyIGlzS2V5d29yZCA9IG1ha2VQcmVkaWNhdGUoXCJkaWN0IEZhbHNlIE5vbmUgVHJ1ZSBhbmQgYXMgYXNzZXJ0IGJyZWFrIGNsYXNzIGNvbnRpbnVlIGRlZiBkZWwgZWxpZiBlbHNlIGV4Y2VwdCBmaW5hbGx5IGZvciBmcm9tIGdsb2JhbCBpZiBpbXBvcnQgaW4gaXMgbGFtYmRhIG5vbmxvY2FsIG5vdCBvciBwYXNzIHJhaXNlIHJldHVybiB0cnkgd2hpbGUgd2l0aCB5aWVsZFwiKTtcblxuICAvLyAjIyBDaGFyYWN0ZXIgY2F0ZWdvcmllc1xuXG4gIC8vIEJpZyB1Z2x5IHJlZ3VsYXIgZXhwcmVzc2lvbnMgdGhhdCBtYXRjaCBjaGFyYWN0ZXJzIGluIHRoZVxuICAvLyB3aGl0ZXNwYWNlLCBpZGVudGlmaWVyLCBhbmQgaWRlbnRpZmllci1zdGFydCBjYXRlZ29yaWVzLiBUaGVzZVxuICAvLyBhcmUgb25seSBhcHBsaWVkIHdoZW4gYSBjaGFyYWN0ZXIgaXMgZm91bmQgdG8gYWN0dWFsbHkgaGF2ZSBhXG4gIC8vIGNvZGUgcG9pbnQgYWJvdmUgMTI4LlxuXG4gIHZhciBub25BU0NJSXdoaXRlc3BhY2UgPSAvW1xcdTE2ODBcXHUxODBlXFx1MjAwMC1cXHUyMDBhXFx1MjAyZlxcdTIwNWZcXHUzMDAwXFx1ZmVmZl0vO1xuICB2YXIgbm9uQVNDSUlpZGVudGlmaWVyU3RhcnRDaGFycyA9IFwiXFx4YWFcXHhiNVxceGJhXFx4YzAtXFx4ZDZcXHhkOC1cXHhmNlxceGY4LVxcdTAyYzFcXHUwMmM2LVxcdTAyZDFcXHUwMmUwLVxcdTAyZTRcXHUwMmVjXFx1MDJlZVxcdTAzNzAtXFx1MDM3NFxcdTAzNzZcXHUwMzc3XFx1MDM3YS1cXHUwMzdkXFx1MDM4NlxcdTAzODgtXFx1MDM4YVxcdTAzOGNcXHUwMzhlLVxcdTAzYTFcXHUwM2EzLVxcdTAzZjVcXHUwM2Y3LVxcdTA0ODFcXHUwNDhhLVxcdTA1MjdcXHUwNTMxLVxcdTA1NTZcXHUwNTU5XFx1MDU2MS1cXHUwNTg3XFx1MDVkMC1cXHUwNWVhXFx1MDVmMC1cXHUwNWYyXFx1MDYyMC1cXHUwNjRhXFx1MDY2ZVxcdTA2NmZcXHUwNjcxLVxcdTA2ZDNcXHUwNmQ1XFx1MDZlNVxcdTA2ZTZcXHUwNmVlXFx1MDZlZlxcdTA2ZmEtXFx1MDZmY1xcdTA2ZmZcXHUwNzEwXFx1MDcxMi1cXHUwNzJmXFx1MDc0ZC1cXHUwN2E1XFx1MDdiMVxcdTA3Y2EtXFx1MDdlYVxcdTA3ZjRcXHUwN2Y1XFx1MDdmYVxcdTA4MDAtXFx1MDgxNVxcdTA4MWFcXHUwODI0XFx1MDgyOFxcdTA4NDAtXFx1MDg1OFxcdTA4YTBcXHUwOGEyLVxcdTA4YWNcXHUwOTA0LVxcdTA5MzlcXHUwOTNkXFx1MDk1MFxcdTA5NTgtXFx1MDk2MVxcdTA5NzEtXFx1MDk3N1xcdTA5NzktXFx1MDk3ZlxcdTA5ODUtXFx1MDk4Y1xcdTA5OGZcXHUwOTkwXFx1MDk5My1cXHUwOWE4XFx1MDlhYS1cXHUwOWIwXFx1MDliMlxcdTA5YjYtXFx1MDliOVxcdTA5YmRcXHUwOWNlXFx1MDlkY1xcdTA5ZGRcXHUwOWRmLVxcdTA5ZTFcXHUwOWYwXFx1MDlmMVxcdTBhMDUtXFx1MGEwYVxcdTBhMGZcXHUwYTEwXFx1MGExMy1cXHUwYTI4XFx1MGEyYS1cXHUwYTMwXFx1MGEzMlxcdTBhMzNcXHUwYTM1XFx1MGEzNlxcdTBhMzhcXHUwYTM5XFx1MGE1OS1cXHUwYTVjXFx1MGE1ZVxcdTBhNzItXFx1MGE3NFxcdTBhODUtXFx1MGE4ZFxcdTBhOGYtXFx1MGE5MVxcdTBhOTMtXFx1MGFhOFxcdTBhYWEtXFx1MGFiMFxcdTBhYjJcXHUwYWIzXFx1MGFiNS1cXHUwYWI5XFx1MGFiZFxcdTBhZDBcXHUwYWUwXFx1MGFlMVxcdTBiMDUtXFx1MGIwY1xcdTBiMGZcXHUwYjEwXFx1MGIxMy1cXHUwYjI4XFx1MGIyYS1cXHUwYjMwXFx1MGIzMlxcdTBiMzNcXHUwYjM1LVxcdTBiMzlcXHUwYjNkXFx1MGI1Y1xcdTBiNWRcXHUwYjVmLVxcdTBiNjFcXHUwYjcxXFx1MGI4M1xcdTBiODUtXFx1MGI4YVxcdTBiOGUtXFx1MGI5MFxcdTBiOTItXFx1MGI5NVxcdTBiOTlcXHUwYjlhXFx1MGI5Y1xcdTBiOWVcXHUwYjlmXFx1MGJhM1xcdTBiYTRcXHUwYmE4LVxcdTBiYWFcXHUwYmFlLVxcdTBiYjlcXHUwYmQwXFx1MGMwNS1cXHUwYzBjXFx1MGMwZS1cXHUwYzEwXFx1MGMxMi1cXHUwYzI4XFx1MGMyYS1cXHUwYzMzXFx1MGMzNS1cXHUwYzM5XFx1MGMzZFxcdTBjNThcXHUwYzU5XFx1MGM2MFxcdTBjNjFcXHUwYzg1LVxcdTBjOGNcXHUwYzhlLVxcdTBjOTBcXHUwYzkyLVxcdTBjYThcXHUwY2FhLVxcdTBjYjNcXHUwY2I1LVxcdTBjYjlcXHUwY2JkXFx1MGNkZVxcdTBjZTBcXHUwY2UxXFx1MGNmMVxcdTBjZjJcXHUwZDA1LVxcdTBkMGNcXHUwZDBlLVxcdTBkMTBcXHUwZDEyLVxcdTBkM2FcXHUwZDNkXFx1MGQ0ZVxcdTBkNjBcXHUwZDYxXFx1MGQ3YS1cXHUwZDdmXFx1MGQ4NS1cXHUwZDk2XFx1MGQ5YS1cXHUwZGIxXFx1MGRiMy1cXHUwZGJiXFx1MGRiZFxcdTBkYzAtXFx1MGRjNlxcdTBlMDEtXFx1MGUzMFxcdTBlMzJcXHUwZTMzXFx1MGU0MC1cXHUwZTQ2XFx1MGU4MVxcdTBlODJcXHUwZTg0XFx1MGU4N1xcdTBlODhcXHUwZThhXFx1MGU4ZFxcdTBlOTQtXFx1MGU5N1xcdTBlOTktXFx1MGU5ZlxcdTBlYTEtXFx1MGVhM1xcdTBlYTVcXHUwZWE3XFx1MGVhYVxcdTBlYWJcXHUwZWFkLVxcdTBlYjBcXHUwZWIyXFx1MGViM1xcdTBlYmRcXHUwZWMwLVxcdTBlYzRcXHUwZWM2XFx1MGVkYy1cXHUwZWRmXFx1MGYwMFxcdTBmNDAtXFx1MGY0N1xcdTBmNDktXFx1MGY2Y1xcdTBmODgtXFx1MGY4Y1xcdTEwMDAtXFx1MTAyYVxcdTEwM2ZcXHUxMDUwLVxcdTEwNTVcXHUxMDVhLVxcdTEwNWRcXHUxMDYxXFx1MTA2NVxcdTEwNjZcXHUxMDZlLVxcdTEwNzBcXHUxMDc1LVxcdTEwODFcXHUxMDhlXFx1MTBhMC1cXHUxMGM1XFx1MTBjN1xcdTEwY2RcXHUxMGQwLVxcdTEwZmFcXHUxMGZjLVxcdTEyNDhcXHUxMjRhLVxcdTEyNGRcXHUxMjUwLVxcdTEyNTZcXHUxMjU4XFx1MTI1YS1cXHUxMjVkXFx1MTI2MC1cXHUxMjg4XFx1MTI4YS1cXHUxMjhkXFx1MTI5MC1cXHUxMmIwXFx1MTJiMi1cXHUxMmI1XFx1MTJiOC1cXHUxMmJlXFx1MTJjMFxcdTEyYzItXFx1MTJjNVxcdTEyYzgtXFx1MTJkNlxcdTEyZDgtXFx1MTMxMFxcdTEzMTItXFx1MTMxNVxcdTEzMTgtXFx1MTM1YVxcdTEzODAtXFx1MTM4ZlxcdTEzYTAtXFx1MTNmNFxcdTE0MDEtXFx1MTY2Y1xcdTE2NmYtXFx1MTY3ZlxcdTE2ODEtXFx1MTY5YVxcdTE2YTAtXFx1MTZlYVxcdTE2ZWUtXFx1MTZmMFxcdTE3MDAtXFx1MTcwY1xcdTE3MGUtXFx1MTcxMVxcdTE3MjAtXFx1MTczMVxcdTE3NDAtXFx1MTc1MVxcdTE3NjAtXFx1MTc2Y1xcdTE3NmUtXFx1MTc3MFxcdTE3ODAtXFx1MTdiM1xcdTE3ZDdcXHUxN2RjXFx1MTgyMC1cXHUxODc3XFx1MTg4MC1cXHUxOGE4XFx1MThhYVxcdTE4YjAtXFx1MThmNVxcdTE5MDAtXFx1MTkxY1xcdTE5NTAtXFx1MTk2ZFxcdTE5NzAtXFx1MTk3NFxcdTE5ODAtXFx1MTlhYlxcdTE5YzEtXFx1MTljN1xcdTFhMDAtXFx1MWExNlxcdTFhMjAtXFx1MWE1NFxcdTFhYTdcXHUxYjA1LVxcdTFiMzNcXHUxYjQ1LVxcdTFiNGJcXHUxYjgzLVxcdTFiYTBcXHUxYmFlXFx1MWJhZlxcdTFiYmEtXFx1MWJlNVxcdTFjMDAtXFx1MWMyM1xcdTFjNGQtXFx1MWM0ZlxcdTFjNWEtXFx1MWM3ZFxcdTFjZTktXFx1MWNlY1xcdTFjZWUtXFx1MWNmMVxcdTFjZjVcXHUxY2Y2XFx1MWQwMC1cXHUxZGJmXFx1MWUwMC1cXHUxZjE1XFx1MWYxOC1cXHUxZjFkXFx1MWYyMC1cXHUxZjQ1XFx1MWY0OC1cXHUxZjRkXFx1MWY1MC1cXHUxZjU3XFx1MWY1OVxcdTFmNWJcXHUxZjVkXFx1MWY1Zi1cXHUxZjdkXFx1MWY4MC1cXHUxZmI0XFx1MWZiNi1cXHUxZmJjXFx1MWZiZVxcdTFmYzItXFx1MWZjNFxcdTFmYzYtXFx1MWZjY1xcdTFmZDAtXFx1MWZkM1xcdTFmZDYtXFx1MWZkYlxcdTFmZTAtXFx1MWZlY1xcdTFmZjItXFx1MWZmNFxcdTFmZjYtXFx1MWZmY1xcdTIwNzFcXHUyMDdmXFx1MjA5MC1cXHUyMDljXFx1MjEwMlxcdTIxMDdcXHUyMTBhLVxcdTIxMTNcXHUyMTE1XFx1MjExOS1cXHUyMTFkXFx1MjEyNFxcdTIxMjZcXHUyMTI4XFx1MjEyYS1cXHUyMTJkXFx1MjEyZi1cXHUyMTM5XFx1MjEzYy1cXHUyMTNmXFx1MjE0NS1cXHUyMTQ5XFx1MjE0ZVxcdTIxNjAtXFx1MjE4OFxcdTJjMDAtXFx1MmMyZVxcdTJjMzAtXFx1MmM1ZVxcdTJjNjAtXFx1MmNlNFxcdTJjZWItXFx1MmNlZVxcdTJjZjJcXHUyY2YzXFx1MmQwMC1cXHUyZDI1XFx1MmQyN1xcdTJkMmRcXHUyZDMwLVxcdTJkNjdcXHUyZDZmXFx1MmQ4MC1cXHUyZDk2XFx1MmRhMC1cXHUyZGE2XFx1MmRhOC1cXHUyZGFlXFx1MmRiMC1cXHUyZGI2XFx1MmRiOC1cXHUyZGJlXFx1MmRjMC1cXHUyZGM2XFx1MmRjOC1cXHUyZGNlXFx1MmRkMC1cXHUyZGQ2XFx1MmRkOC1cXHUyZGRlXFx1MmUyZlxcdTMwMDUtXFx1MzAwN1xcdTMwMjEtXFx1MzAyOVxcdTMwMzEtXFx1MzAzNVxcdTMwMzgtXFx1MzAzY1xcdTMwNDEtXFx1MzA5NlxcdTMwOWQtXFx1MzA5ZlxcdTMwYTEtXFx1MzBmYVxcdTMwZmMtXFx1MzBmZlxcdTMxMDUtXFx1MzEyZFxcdTMxMzEtXFx1MzE4ZVxcdTMxYTAtXFx1MzFiYVxcdTMxZjAtXFx1MzFmZlxcdTM0MDAtXFx1NGRiNVxcdTRlMDAtXFx1OWZjY1xcdWEwMDAtXFx1YTQ4Y1xcdWE0ZDAtXFx1YTRmZFxcdWE1MDAtXFx1YTYwY1xcdWE2MTAtXFx1YTYxZlxcdWE2MmFcXHVhNjJiXFx1YTY0MC1cXHVhNjZlXFx1YTY3Zi1cXHVhNjk3XFx1YTZhMC1cXHVhNmVmXFx1YTcxNy1cXHVhNzFmXFx1YTcyMi1cXHVhNzg4XFx1YTc4Yi1cXHVhNzhlXFx1YTc5MC1cXHVhNzkzXFx1YTdhMC1cXHVhN2FhXFx1YTdmOC1cXHVhODAxXFx1YTgwMy1cXHVhODA1XFx1YTgwNy1cXHVhODBhXFx1YTgwYy1cXHVhODIyXFx1YTg0MC1cXHVhODczXFx1YTg4Mi1cXHVhOGIzXFx1YThmMi1cXHVhOGY3XFx1YThmYlxcdWE5MGEtXFx1YTkyNVxcdWE5MzAtXFx1YTk0NlxcdWE5NjAtXFx1YTk3Y1xcdWE5ODQtXFx1YTliMlxcdWE5Y2ZcXHVhYTAwLVxcdWFhMjhcXHVhYTQwLVxcdWFhNDJcXHVhYTQ0LVxcdWFhNGJcXHVhYTYwLVxcdWFhNzZcXHVhYTdhXFx1YWE4MC1cXHVhYWFmXFx1YWFiMVxcdWFhYjVcXHVhYWI2XFx1YWFiOS1cXHVhYWJkXFx1YWFjMFxcdWFhYzJcXHVhYWRiLVxcdWFhZGRcXHVhYWUwLVxcdWFhZWFcXHVhYWYyLVxcdWFhZjRcXHVhYjAxLVxcdWFiMDZcXHVhYjA5LVxcdWFiMGVcXHVhYjExLVxcdWFiMTZcXHVhYjIwLVxcdWFiMjZcXHVhYjI4LVxcdWFiMmVcXHVhYmMwLVxcdWFiZTJcXHVhYzAwLVxcdWQ3YTNcXHVkN2IwLVxcdWQ3YzZcXHVkN2NiLVxcdWQ3ZmJcXHVmOTAwLVxcdWZhNmRcXHVmYTcwLVxcdWZhZDlcXHVmYjAwLVxcdWZiMDZcXHVmYjEzLVxcdWZiMTdcXHVmYjFkXFx1ZmIxZi1cXHVmYjI4XFx1ZmIyYS1cXHVmYjM2XFx1ZmIzOC1cXHVmYjNjXFx1ZmIzZVxcdWZiNDBcXHVmYjQxXFx1ZmI0M1xcdWZiNDRcXHVmYjQ2LVxcdWZiYjFcXHVmYmQzLVxcdWZkM2RcXHVmZDUwLVxcdWZkOGZcXHVmZDkyLVxcdWZkYzdcXHVmZGYwLVxcdWZkZmJcXHVmZTcwLVxcdWZlNzRcXHVmZTc2LVxcdWZlZmNcXHVmZjIxLVxcdWZmM2FcXHVmZjQxLVxcdWZmNWFcXHVmZjY2LVxcdWZmYmVcXHVmZmMyLVxcdWZmYzdcXHVmZmNhLVxcdWZmY2ZcXHVmZmQyLVxcdWZmZDdcXHVmZmRhLVxcdWZmZGNcIjtcbiAgdmFyIG5vbkFTQ0lJaWRlbnRpZmllckNoYXJzID0gXCJcXHUwMzAwLVxcdTAzNmZcXHUwNDgzLVxcdTA0ODdcXHUwNTkxLVxcdTA1YmRcXHUwNWJmXFx1MDVjMVxcdTA1YzJcXHUwNWM0XFx1MDVjNVxcdTA1YzdcXHUwNjEwLVxcdTA2MWFcXHUwNjIwLVxcdTA2NDlcXHUwNjcyLVxcdTA2ZDNcXHUwNmU3LVxcdTA2ZThcXHUwNmZiLVxcdTA2ZmNcXHUwNzMwLVxcdTA3NGFcXHUwODAwLVxcdTA4MTRcXHUwODFiLVxcdTA4MjNcXHUwODI1LVxcdTA4MjdcXHUwODI5LVxcdTA4MmRcXHUwODQwLVxcdTA4NTdcXHUwOGU0LVxcdTA4ZmVcXHUwOTAwLVxcdTA5MDNcXHUwOTNhLVxcdTA5M2NcXHUwOTNlLVxcdTA5NGZcXHUwOTUxLVxcdTA5NTdcXHUwOTYyLVxcdTA5NjNcXHUwOTY2LVxcdTA5NmZcXHUwOTgxLVxcdTA5ODNcXHUwOWJjXFx1MDliZS1cXHUwOWM0XFx1MDljN1xcdTA5YzhcXHUwOWQ3XFx1MDlkZi1cXHUwOWUwXFx1MGEwMS1cXHUwYTAzXFx1MGEzY1xcdTBhM2UtXFx1MGE0MlxcdTBhNDdcXHUwYTQ4XFx1MGE0Yi1cXHUwYTRkXFx1MGE1MVxcdTBhNjYtXFx1MGE3MVxcdTBhNzVcXHUwYTgxLVxcdTBhODNcXHUwYWJjXFx1MGFiZS1cXHUwYWM1XFx1MGFjNy1cXHUwYWM5XFx1MGFjYi1cXHUwYWNkXFx1MGFlMi1cXHUwYWUzXFx1MGFlNi1cXHUwYWVmXFx1MGIwMS1cXHUwYjAzXFx1MGIzY1xcdTBiM2UtXFx1MGI0NFxcdTBiNDdcXHUwYjQ4XFx1MGI0Yi1cXHUwYjRkXFx1MGI1NlxcdTBiNTdcXHUwYjVmLVxcdTBiNjBcXHUwYjY2LVxcdTBiNmZcXHUwYjgyXFx1MGJiZS1cXHUwYmMyXFx1MGJjNi1cXHUwYmM4XFx1MGJjYS1cXHUwYmNkXFx1MGJkN1xcdTBiZTYtXFx1MGJlZlxcdTBjMDEtXFx1MGMwM1xcdTBjNDYtXFx1MGM0OFxcdTBjNGEtXFx1MGM0ZFxcdTBjNTVcXHUwYzU2XFx1MGM2Mi1cXHUwYzYzXFx1MGM2Ni1cXHUwYzZmXFx1MGM4MlxcdTBjODNcXHUwY2JjXFx1MGNiZS1cXHUwY2M0XFx1MGNjNi1cXHUwY2M4XFx1MGNjYS1cXHUwY2NkXFx1MGNkNVxcdTBjZDZcXHUwY2UyLVxcdTBjZTNcXHUwY2U2LVxcdTBjZWZcXHUwZDAyXFx1MGQwM1xcdTBkNDYtXFx1MGQ0OFxcdTBkNTdcXHUwZDYyLVxcdTBkNjNcXHUwZDY2LVxcdTBkNmZcXHUwZDgyXFx1MGQ4M1xcdTBkY2FcXHUwZGNmLVxcdTBkZDRcXHUwZGQ2XFx1MGRkOC1cXHUwZGRmXFx1MGRmMlxcdTBkZjNcXHUwZTM0LVxcdTBlM2FcXHUwZTQwLVxcdTBlNDVcXHUwZTUwLVxcdTBlNTlcXHUwZWI0LVxcdTBlYjlcXHUwZWM4LVxcdTBlY2RcXHUwZWQwLVxcdTBlZDlcXHUwZjE4XFx1MGYxOVxcdTBmMjAtXFx1MGYyOVxcdTBmMzVcXHUwZjM3XFx1MGYzOVxcdTBmNDEtXFx1MGY0N1xcdTBmNzEtXFx1MGY4NFxcdTBmODYtXFx1MGY4N1xcdTBmOGQtXFx1MGY5N1xcdTBmOTktXFx1MGZiY1xcdTBmYzZcXHUxMDAwLVxcdTEwMjlcXHUxMDQwLVxcdTEwNDlcXHUxMDY3LVxcdTEwNmRcXHUxMDcxLVxcdTEwNzRcXHUxMDgyLVxcdTEwOGRcXHUxMDhmLVxcdTEwOWRcXHUxMzVkLVxcdTEzNWZcXHUxNzBlLVxcdTE3MTBcXHUxNzIwLVxcdTE3MzBcXHUxNzQwLVxcdTE3NTBcXHUxNzcyXFx1MTc3M1xcdTE3ODAtXFx1MTdiMlxcdTE3ZGRcXHUxN2UwLVxcdTE3ZTlcXHUxODBiLVxcdTE4MGRcXHUxODEwLVxcdTE4MTlcXHUxOTIwLVxcdTE5MmJcXHUxOTMwLVxcdTE5M2JcXHUxOTUxLVxcdTE5NmRcXHUxOWIwLVxcdTE5YzBcXHUxOWM4LVxcdTE5YzlcXHUxOWQwLVxcdTE5ZDlcXHUxYTAwLVxcdTFhMTVcXHUxYTIwLVxcdTFhNTNcXHUxYTYwLVxcdTFhN2NcXHUxYTdmLVxcdTFhODlcXHUxYTkwLVxcdTFhOTlcXHUxYjQ2LVxcdTFiNGJcXHUxYjUwLVxcdTFiNTlcXHUxYjZiLVxcdTFiNzNcXHUxYmIwLVxcdTFiYjlcXHUxYmU2LVxcdTFiZjNcXHUxYzAwLVxcdTFjMjJcXHUxYzQwLVxcdTFjNDlcXHUxYzViLVxcdTFjN2RcXHUxY2QwLVxcdTFjZDJcXHUxZDAwLVxcdTFkYmVcXHUxZTAxLVxcdTFmMTVcXHUyMDBjXFx1MjAwZFxcdTIwM2ZcXHUyMDQwXFx1MjA1NFxcdTIwZDAtXFx1MjBkY1xcdTIwZTFcXHUyMGU1LVxcdTIwZjBcXHUyZDgxLVxcdTJkOTZcXHUyZGUwLVxcdTJkZmZcXHUzMDIxLVxcdTMwMjhcXHUzMDk5XFx1MzA5YVxcdWE2NDAtXFx1YTY2ZFxcdWE2NzQtXFx1YTY3ZFxcdWE2OWZcXHVhNmYwLVxcdWE2ZjFcXHVhN2Y4LVxcdWE4MDBcXHVhODA2XFx1YTgwYlxcdWE4MjMtXFx1YTgyN1xcdWE4ODAtXFx1YTg4MVxcdWE4YjQtXFx1YThjNFxcdWE4ZDAtXFx1YThkOVxcdWE4ZjMtXFx1YThmN1xcdWE5MDAtXFx1YTkwOVxcdWE5MjYtXFx1YTkyZFxcdWE5MzAtXFx1YTk0NVxcdWE5ODAtXFx1YTk4M1xcdWE5YjMtXFx1YTljMFxcdWFhMDAtXFx1YWEyN1xcdWFhNDAtXFx1YWE0MVxcdWFhNGMtXFx1YWE0ZFxcdWFhNTAtXFx1YWE1OVxcdWFhN2JcXHVhYWUwLVxcdWFhZTlcXHVhYWYyLVxcdWFhZjNcXHVhYmMwLVxcdWFiZTFcXHVhYmVjXFx1YWJlZFxcdWFiZjAtXFx1YWJmOVxcdWZiMjAtXFx1ZmIyOFxcdWZlMDAtXFx1ZmUwZlxcdWZlMjAtXFx1ZmUyNlxcdWZlMzNcXHVmZTM0XFx1ZmU0ZC1cXHVmZTRmXFx1ZmYxMC1cXHVmZjE5XFx1ZmYzZlwiO1xuICB2YXIgbm9uQVNDSUlpZGVudGlmaWVyU3RhcnQgPSBuZXcgUmVnRXhwKFwiW1wiICsgbm9uQVNDSUlpZGVudGlmaWVyU3RhcnRDaGFycyArIFwiXVwiKTtcbiAgdmFyIG5vbkFTQ0lJaWRlbnRpZmllciA9IG5ldyBSZWdFeHAoXCJbXCIgKyBub25BU0NJSWlkZW50aWZpZXJTdGFydENoYXJzICsgbm9uQVNDSUlpZGVudGlmaWVyQ2hhcnMgKyBcIl1cIik7XG5cbiAgLy8gV2hldGhlciBhIHNpbmdsZSBjaGFyYWN0ZXIgZGVub3RlcyBhIG5ld2xpbmUuXG5cbiAgdmFyIG5ld2xpbmUgPSAvW1xcblxcclxcdTIwMjhcXHUyMDI5XS87XG5cbiAgLy8gTWF0Y2hlcyBhIHdob2xlIGxpbmUgYnJlYWsgKHdoZXJlIENSTEYgaXMgY29uc2lkZXJlZCBhIHNpbmdsZVxuICAvLyBsaW5lIGJyZWFrKS4gVXNlZCB0byBjb3VudCBsaW5lcy5cblxuICB2YXIgbGluZUJyZWFrID0gL1xcclxcbnxbXFxuXFxyXFx1MjAyOFxcdTIwMjldL2c7XG5cbiAgLy8gVGVzdCB3aGV0aGVyIGEgZ2l2ZW4gY2hhcmFjdGVyIGNvZGUgc3RhcnRzIGFuIGlkZW50aWZpZXIuXG5cbiAgdmFyIGlzSWRlbnRpZmllclN0YXJ0ID0gZXhwb3J0cy5pc0lkZW50aWZpZXJTdGFydCA9IGZ1bmN0aW9uKGNvZGUpIHtcbiAgICBpZiAoY29kZSA8IDY1KSByZXR1cm4gY29kZSA9PT0gMzY7XG4gICAgaWYgKGNvZGUgPCA5MSkgcmV0dXJuIHRydWU7XG4gICAgaWYgKGNvZGUgPCA5NykgcmV0dXJuIGNvZGUgPT09IDk1O1xuICAgIGlmIChjb2RlIDwgMTIzKXJldHVybiB0cnVlO1xuICAgIHJldHVybiBjb2RlID49IDB4YWEgJiYgbm9uQVNDSUlpZGVudGlmaWVyU3RhcnQudGVzdChTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpKTtcbiAgfTtcblxuICAvLyBUZXN0IHdoZXRoZXIgYSBnaXZlbiBjaGFyYWN0ZXIgaXMgcGFydCBvZiBhbiBpZGVudGlmaWVyLlxuXG4gIHZhciBpc0lkZW50aWZpZXJDaGFyID0gZXhwb3J0cy5pc0lkZW50aWZpZXJDaGFyID0gZnVuY3Rpb24oY29kZSkge1xuICAgIGlmIChjb2RlIDwgNDgpIHJldHVybiBjb2RlID09PSAzNjtcbiAgICBpZiAoY29kZSA8IDU4KSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAoY29kZSA8IDY1KSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGNvZGUgPCA5MSkgcmV0dXJuIHRydWU7XG4gICAgaWYgKGNvZGUgPCA5NykgcmV0dXJuIGNvZGUgPT09IDk1O1xuICAgIGlmIChjb2RlIDwgMTIzKXJldHVybiB0cnVlO1xuICAgIHJldHVybiBjb2RlID49IDB4YWEgJiYgbm9uQVNDSUlpZGVudGlmaWVyLnRlc3QoU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKSk7XG4gIH07XG5cbiAgLy8gIyMgVG9rZW5pemVyXG5cbiAgLy8gVGhlc2UgYXJlIHVzZWQgd2hlbiBgb3B0aW9ucy5sb2NhdGlvbnNgIGlzIG9uLCBmb3IgdGhlXG4gIC8vIGB0b2tTdGFydExvY2AgYW5kIGB0b2tFbmRMb2NgIHByb3BlcnRpZXMuXG5cbiAgZnVuY3Rpb24gUG9zaXRpb24oKSB7XG4gICAgdGhpcy5saW5lID0gdG9rQ3VyTGluZTtcbiAgICB0aGlzLmNvbHVtbiA9IHRva1BvcyAtIHRva0xpbmVTdGFydDtcbiAgfVxuXG4gIC8vIFJlc2V0IHRoZSB0b2tlbiBzdGF0ZS4gVXNlZCBhdCB0aGUgc3RhcnQgb2YgYSBwYXJzZS5cblxuICBmdW5jdGlvbiBpbml0VG9rZW5TdGF0ZSgpIHtcbiAgICB0b2tDdXJMaW5lID0gMTtcbiAgICB0b2tQb3MgPSB0b2tMaW5lU3RhcnQgPSAwO1xuICAgIHRva1JlZ2V4cEFsbG93ZWQgPSB0cnVlO1xuICAgIGluZGVudEhpc3QuaW5pdCgpO1xuICAgIG5ld0FzdElkQ291bnQgPSAwO1xuICAgIHNjb3BlLmluaXQoKTtcbiAgfVxuXG4gIC8vIENhbGxlZCBhdCB0aGUgZW5kIG9mIGV2ZXJ5IHRva2VuLiBTZXRzIGB0b2tFbmRgLCBgdG9rVmFsYCwgYW5kXG4gIC8vIGB0b2tSZWdleHBBbGxvd2VkYCwgYW5kIHNraXBzIHRoZSBzcGFjZSBhZnRlciB0aGUgdG9rZW4sIHNvIHRoYXRcbiAgLy8gdGhlIG5leHQgb25lJ3MgYHRva1N0YXJ0YCB3aWxsIHBvaW50IGF0IHRoZSByaWdodCBwb3NpdGlvbi5cblxuICBmdW5jdGlvbiBmaW5pc2hUb2tlbih0eXBlLCB2YWwpIHtcbiAgICB0b2tFbmQgPSB0b2tQb3M7XG4gICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKSB0b2tFbmRMb2MgPSBuZXcgUG9zaXRpb247XG4gICAgdG9rVHlwZSA9IHR5cGU7XG4gICAgaWYgKHR5cGUgPT09IF9wYXJlbkwgfHwgdHlwZSA9PT0gX2JyYWNlTCB8fCB0eXBlID09PSBfYnJhY2tldEwpICsrYnJhY2tldE5lc3Rpbmc7XG4gICAgaWYgKHR5cGUgPT09IF9wYXJlblIgfHwgdHlwZSA9PT0gX2JyYWNlUiB8fCB0eXBlID09PSBfYnJhY2tldFIpIC0tYnJhY2tldE5lc3Rpbmc7XG4gICAgaWYgKHR5cGUgIT09IF9uZXdsaW5lKSBza2lwU3BhY2UoKTtcbiAgICB0b2tWYWwgPSB2YWw7XG4gICAgdG9rUmVnZXhwQWxsb3dlZCA9IHR5cGUuYmVmb3JlRXhwcjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNraXBMaW5lKCkge1xuICAgIHZhciBjaCA9IGlucHV0LmNoYXJDb2RlQXQoKyt0b2tQb3MpO1xuICAgIHdoaWxlICh0b2tQb3MgPCBpbnB1dExlbiAmJiAhaXNOZXdsaW5lKGNoKSkge1xuICAgICAgKyt0b2tQb3M7XG4gICAgICBjaCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBza2lwTGluZUNvbW1lbnQoKSB7XG4gICAgdmFyIHN0YXJ0ID0gdG9rUG9zO1xuICAgIHZhciBzdGFydExvYyA9IG9wdGlvbnMub25Db21tZW50ICYmIG9wdGlvbnMubG9jYXRpb25zICYmIG5ldyBQb3NpdGlvbjtcbiAgICBza2lwTGluZSgpO1xuICAgIGlmIChvcHRpb25zLm9uQ29tbWVudClcbiAgICAgIG9wdGlvbnMub25Db21tZW50KGlucHV0LnNsaWNlKHN0YXJ0ICsgMSwgdG9rUG9zKSwgc3RhcnQsIHRva1BvcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0TG9jLCBvcHRpb25zLmxvY2F0aW9ucyAmJiBuZXcgUG9zaXRpb24pO1xuICB9XG5cbiAgLy8gQ2FsbGVkIGF0IHRoZSBzdGFydCBvZiB0aGUgcGFyc2UgYW5kIGFmdGVyIGV2ZXJ5IHRva2VuLiBTa2lwc1xuICAvLyB3aGl0ZXNwYWNlIGFuZCBjb21tZW50cywgYW5kLlxuXG4gIGZ1bmN0aW9uIHNraXBTcGFjZSgpIHtcbiAgICB3aGlsZSAodG9rUG9zIDwgaW5wdXRMZW4pIHtcbiAgICAgIHZhciBjaCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKTtcbiAgICAgIGlmIChjaCA9PT0gMzUpIHNraXBMaW5lQ29tbWVudCgpO1xuICAgICAgZWxzZSBpZiAoY2ggPT09IDkyKSB7XG4gICAgICAgICsrdG9rUG9zO1xuICAgICAgICBpZiAoaXNOZXdsaW5lKGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKSkpIHtcbiAgICAgICAgICBpZiAoaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MpID09PSAxMyAmJiBpbnB1dC5jaGFyQ29kZUF0KHRva1BvcysxKSA9PT0gMTApICsrdG9rUG9zO1xuICAgICAgICAgICsrdG9rUG9zO1xuICAgICAgICAgIGlmIChvcHRpb25zLmxvY2F0aW9uKSB7IHRva0xpbmVTdGFydCA9IHRva1BvczsgKyt0b2tDdXJMaW5lOyB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmFpc2UodG9rUG9zLCBcIlVuZXhwZWN0ZWQgY2hhcmFjdGVyIGFmdGVyIGxpbmUgY29udGludWF0aW9uIGNoYXJhY3RlclwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSBpZiAoaXNTcGFjZShjaCkpICsrdG9rUG9zO1xuICAgICAgZWxzZSBpZiAoYnJhY2tldE5lc3RpbmcgPiAwICYmIGlzTmV3bGluZShjaCkpIHtcbiAgICAgICAgaWYgKGNoID09PSAxMyAmJiBpbnB1dC5jaGFyQ29kZUF0KHRva1BvcysxKSA9PT0gMTApICsrdG9rUG9zO1xuICAgICAgICArK3Rva1BvcztcbiAgICAgICAgaWYgKG9wdGlvbnMubG9jYXRpb24pIHsgdG9rTGluZVN0YXJ0ID0gdG9rUG9zOyArK3Rva0N1ckxpbmU7IH1cbiAgICAgIH1cbiAgICAgIGVsc2UgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaXNTcGFjZShjaCkge1xuICAgIGlmIChjaCA9PT0gMzIgfHwgLy8gJyAnXG4gICAgICBjaCA9PT0gOSB8fCBjaCA9PT0gMTEgfHwgY2ggPT09IDEyIHx8XG4gICAgICBjaCA9PT0gMTYwIHx8IC8vICdcXHhhMCdcbiAgICAgIGNoID49IDU3NjAgJiYgbm9uQVNDSUl3aGl0ZXNwYWNlLnRlc3QoU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNOZXdsaW5lKGNoKSB7XG4gICAgaWYgKGNoID09PSAxMCB8fCBjaCA9PT0gMTMgfHxcbiAgICAgIGNoID09PSA4MjMyIHx8IGNoID09PSA4MjMzKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gIyMjIFRva2VuIHJlYWRpbmdcblxuICAvLyBUaGlzIGlzIHRoZSBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB0byBmZXRjaCB0aGUgbmV4dCB0b2tlbi4gSXRcbiAgLy8gaXMgc29tZXdoYXQgb2JzY3VyZSwgYmVjYXVzZSBpdCB3b3JrcyBpbiBjaGFyYWN0ZXIgY29kZXMgcmF0aGVyXG4gIC8vIHRoYW4gY2hhcmFjdGVycywgYW5kIGJlY2F1c2Ugb3BlcmF0b3IgcGFyc2luZyBoYXMgYmVlbiBpbmxpbmVkXG4gIC8vIGludG8gaXQuXG4gIC8vXG4gIC8vIEFsbCBpbiB0aGUgbmFtZSBvZiBzcGVlZC5cbiAgLy9cbiAgLy8gVGhlIGBmb3JjZVJlZ2V4cGAgcGFyYW1ldGVyIGlzIHVzZWQgaW4gdGhlIG9uZSBjYXNlIHdoZXJlIHRoZVxuICAvLyBgdG9rUmVnZXhwQWxsb3dlZGAgdHJpY2sgZG9lcyBub3Qgd29yay4gU2VlIGBwYXJzZVN0YXRlbWVudGAuXG5cbiAgZnVuY3Rpb24gcmVhZFRva2VuX2RvdCgpIHtcbiAgICB2YXIgbmV4dCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zICsgMSk7XG4gICAgaWYgKG5leHQgPj0gNDggJiYgbmV4dCA8PSA1NykgcmV0dXJuIHJlYWROdW1iZXIodHJ1ZSk7XG4gICAgKyt0b2tQb3M7XG4gICAgcmV0dXJuIGZpbmlzaFRva2VuKF9kb3QpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVhZFRva2VuX3NsYXNoKCkgeyAvLyAnLydcbiAgICBpZiAodG9rUmVnZXhwQWxsb3dlZCkgeyArK3Rva1BvczsgcmV0dXJuIHJlYWRSZWdleHAoKTsgfVxuICAgIHZhciBuZXh0ID0gaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MgKyAxKTtcbiAgICBpZiAobmV4dCA9PT0gNDcpIHJldHVybiBmaW5pc2hPcChfZmxvb3JEaXYsIDIpO1xuICAgIGlmIChuZXh0ID09PSA2MSkgcmV0dXJuIGZpbmlzaE9wKF9hc3NpZ24sIDIpO1xuICAgIHJldHVybiBmaW5pc2hPcChfc2xhc2gsIDEpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVhZFRva2VuX211bHRfbW9kdWxvKGNvZGUpIHsgLy8gJyolJ1xuICAgIHZhciBuZXh0ID0gaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MgKyAxKTtcbiAgICBpZiAobmV4dCA9PT0gNDIgJiYgbmV4dCA9PT0gY29kZSkgcmV0dXJuIGZpbmlzaE9wKF9leHBvbmVudGlhdGlvbiwgMik7XG4gICAgaWYgKG5leHQgPT09IDYxKSByZXR1cm4gZmluaXNoT3AoX2Fzc2lnbiwgMik7XG4gICAgcmV0dXJuIGZpbmlzaE9wKF9tdWx0aXBseU1vZHVsbywgMSk7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIHJlYWRUb2tlbl9waXBlX2FtcChjb2RlKSB7IC8vICd8JidcbiAgICB2YXIgbmV4dCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zICsgMSk7XG4gICAgaWYgKG5leHQgPT09IDYxKSByZXR1cm4gZmluaXNoT3AoX2Fzc2lnbiwgMik7XG4gICAgcmV0dXJuIGZpbmlzaE9wKGNvZGUgPT09IDEyNCA/IF9iaXR3aXNlT1IgOiBfYml0d2lzZUFORCwgMSk7XG4gIH1cblxuICBmdW5jdGlvbiByZWFkVG9rZW5fY2FyZXQoKSB7IC8vICdeJ1xuICAgIHZhciBuZXh0ID0gaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MgKyAxKTtcbiAgICBpZiAobmV4dCA9PT0gNjEpIHJldHVybiBmaW5pc2hPcChfYXNzaWduLCAyKTtcbiAgICByZXR1cm4gZmluaXNoT3AoX2JpdHdpc2VYT1IsIDEpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVhZFRva2VuX3BsdXNfbWluKGNvZGUpIHsgLy8gJystJ1xuICAgIHZhciBuZXh0ID0gaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MgKyAxKTtcbiAgICBpZiAobmV4dCA9PT0gNjEpIHJldHVybiBmaW5pc2hPcChfYXNzaWduLCAyKTtcbiAgICByZXR1cm4gZmluaXNoT3AoX3BsdXNNaW4sIDEpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVhZFRva2VuX2x0X2d0KGNvZGUpIHsgLy8gJzw+J1xuICAgIHZhciBuZXh0ID0gaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MgKyAxKTtcbiAgICB2YXIgc2l6ZSA9IDE7XG4gICAgaWYgKG5leHQgPT09IGNvZGUpIHtcbiAgICAgIHNpemUgPSAyO1xuICAgICAgaWYgKGlucHV0LmNoYXJDb2RlQXQodG9rUG9zICsgc2l6ZSkgPT09IDYxKSByZXR1cm4gZmluaXNoT3AoX2Fzc2lnbiwgc2l6ZSArIDEpO1xuICAgICAgcmV0dXJuIGZpbmlzaE9wKF9iaXRTaGlmdCwgc2l6ZSk7XG4gICAgfVxuICAgIGlmIChuZXh0ID09PSA2MSkgc2l6ZSA9IDI7XG4gICAgcmV0dXJuIGZpbmlzaE9wKF9yZWxhdGlvbmFsLCBzaXplKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRUb2tlbl9lcV9leGNsKGNvZGUpIHsgLy8gJz0hJ1xuICAgIHZhciBuZXh0ID0gaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MgKyAxKTtcbiAgICBpZiAobmV4dCA9PT0gNjEpIHJldHVybiBmaW5pc2hPcChfZXF1YWxpdHksIDIpO1xuICAgIHJldHVybiBmaW5pc2hPcChfZXEsIDEpO1xuICB9XG5cbiAgLy8gUGFyc2UgaW5kZW50YXRpb25cbiAgLy8gUG9zc2libGUgb3V0cHV0OiBfaW5kZW50LCBfZGVkZW50LCBfZW9mLCByZWFkVG9rZW4oKVxuICAvLyBUT0RPOiBkaXNhbGxvdyB1bmVxdWFsIGluZGVudHMgb2Ygc2FtZSBsZW5ndGggKGUuZy4gbmVzdGVkIGlmL2Vsc2UgYmxvY2spXG5cbiAgZnVuY3Rpb24gcmVhZFRva2VuX2luZGVudCgpIHtcbiAgICAvLyBSZWFkIGluZGVudCwgc2tpcCBlbXB0eSBsaW5lcyBhbmQgY29tbWVudHNcbiAgICB2YXIgaW5kZW50ID0gXCJcIjtcbiAgICB2YXIgaW5kZW50UG9zID0gdG9rUG9zO1xuICAgIHZhciBjaCwgbmV4dDtcbiAgICB3aGlsZSAoaW5kZW50UG9zIDwgaW5wdXRMZW4pIHtcbiAgICAgIGNoID0gaW5wdXQuY2hhckNvZGVBdChpbmRlbnRQb3MpO1xuICAgICAgaWYgKGlzU3BhY2UoY2gpKSB7XG4gICAgICAgIGluZGVudCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTtcbiAgICAgICAgKytpbmRlbnRQb3M7XG4gICAgICB9IGVsc2UgaWYgKGlzTmV3bGluZShjaCkpIHsgLy8gbmV3bGluZVxuICAgICAgICBpbmRlbnQgPSBcIlwiO1xuICAgICAgICBpZiAoY2ggPT09IDEzICYmIGlucHV0LmNoYXJDb2RlQXQoaW5kZW50UG9zICsgMSkgPT09IDEwKSArK2luZGVudFBvcztcbiAgICAgICAgKytpbmRlbnRQb3M7XG4gICAgICAgIHRva1BvcyA9IGluZGVudFBvcztcbiAgICAgICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKSB7XG4gICAgICAgICAgdG9rTGluZVN0YXJ0ID0gaW5kZW50UG9zO1xuICAgICAgICAgICsrdG9rQ3VyTGluZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMzUpIHsgLy8gJyMnXG4gICAgICAgIGRvIHtcbiAgICAgICAgICBuZXh0ID0gaW5wdXQuY2hhckNvZGVBdCgrK2luZGVudFBvcyk7XG4gICAgICAgIH0gd2hpbGUgKGluZGVudFBvcyA8IGlucHV0TGVuICYmIG5leHQgIT09IDEwKTtcbiAgICAgICAgLy8gVE9ETzogY2FsbCBvbkNvbW1lbnRcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIERldGVybWluZSB0b2tlbiB0eXBlIGJhc2VkIG9uIGluZGVudCBmb3VuZCB2ZXJzdXMgaW5kZW50YXRpb24gaGlzdG9yeVxuICAgIHZhciB0eXBlO1xuICAgIGlmIChpbmRlbnQubGVuZ3RoID4gMCkge1xuICAgICAgaWYgKGluZGVudEhpc3QuaXNJbmRlbnQoaW5kZW50KSkge1xuICAgICAgICB0eXBlID0gX2luZGVudDtcbiAgICAgICAgaWYgKGluZGVudEhpc3QuY291bnQoKSA+PSAxKSB0b2tTdGFydCArPSBpbmRlbnRIaXN0LmxlbihpbmRlbnRIaXN0LmNvdW50KCkgLSAxKTtcbiAgICAgICAgaW5kZW50SGlzdC5hZGRJbmRlbnQoaW5kZW50KTtcbiAgICAgIH0gZWxzZSBpZiAoaW5kZW50SGlzdC5pc0RlZGVudChpbmRlbnQpKSB7XG4gICAgICAgIHR5cGUgPSBfZGVkZW50O1xuICAgICAgICBpbmRlbnRIaXN0LmFkZERlZGVudChpbmRlbnQpO1xuICAgICAgICB2YXIgbmV4dERlZGVudCA9IGluZGVudEhpc3QuY291bnQoKSAtIGluZGVudEhpc3QuZGVkZW50Q291bnQ7XG4gICAgICAgIGlmIChuZXh0RGVkZW50ID49IDIpIHtcbiAgICAgICAgICB0b2tTdGFydCArPSBpbmRlbnRIaXN0LmxlbihuZXh0RGVkZW50KSAtIGluZGVudEhpc3QubGVuKG5leHREZWRlbnQgLSAxKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdG9rUG9zICs9IGluZGVudC5sZW5ndGg7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChpbmRlbnRQb3MgPj0gaW5wdXRMZW4pIHtcbiAgICAgIHR5cGUgPSBfZW9mO1xuICAgIH0gZWxzZSBpZiAoaW5kZW50SGlzdC5jb3VudCgpID4gMCkge1xuICAgICAgdHlwZSA9IF9kZWRlbnQ7XG4gICAgICBpbmRlbnRIaXN0LnVwZGF0ZURlZGVudCgpO1xuICAgIH1cblxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBfaW5kZW50OiBjYXNlIF9kZWRlbnQ6IHJldHVybiBmaW5pc2hPcCh0eXBlLCBpbmRlbnRQb3MgLSArK3Rva1Bvcyk7XG4gICAgICBjYXNlIF9lb2Y6XG4gICAgICAgIHRva1BvcyA9IGlucHV0TGVuO1xuICAgICAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIHRva1N0YXJ0TG9jID0gbmV3IFBvc2l0aW9uO1xuICAgICAgICByZXR1cm4gZmluaXNoT3AodHlwZSwgMCk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0b2tUeXBlID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIHJlYWRUb2tlbigpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFRva2VuRnJvbUNvZGUoY29kZSkge1xuICAgIHN3aXRjaChjb2RlKSB7XG5cbiAgICBjYXNlIDEzOiBjYXNlIDEwOiBjYXNlIDgyMzI6IGNhc2UgODIzMzpcbiAgICAgICsrdG9rUG9zO1xuICAgICAgaWYgKGNvZGUgPT09IDEzICYmIGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKSA9PT0gMTApICsrdG9rUG9zO1xuICAgICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKSB7XG4gICAgICAgICsrdG9rQ3VyTGluZTtcbiAgICAgICAgdG9rTGluZVN0YXJ0ID0gdG9rUG9zO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZpbmlzaFRva2VuKF9uZXdsaW5lKTtcblxuICAgIGNhc2UgMzU6IC8vICcjJ1xuICAgICAgc2tpcExpbmVDb21tZW50KCk7XG4gICAgICByZXR1cm4gcmVhZFRva2VuKCk7XG5cbiAgICAgIC8vIFRoZSBpbnRlcnByZXRhdGlvbiBvZiBhIGRvdCBkZXBlbmRzIG9uIHdoZXRoZXIgaXQgaXMgZm9sbG93ZWRcbiAgICAgIC8vIGJ5IGEgZGlnaXQuXG4gICAgY2FzZSA0NjogLy8gJy4nXG4gICAgICByZXR1cm4gcmVhZFRva2VuX2RvdCgpO1xuXG4gICAgICAvLyBQdW5jdHVhdGlvbiB0b2tlbnMuXG4gICAgY2FzZSA0MDogKyt0b2tQb3M7IHJldHVybiBmaW5pc2hUb2tlbihfcGFyZW5MKTtcbiAgICBjYXNlIDQxOiArK3Rva1BvczsgcmV0dXJuIGZpbmlzaFRva2VuKF9wYXJlblIpO1xuICAgIGNhc2UgNTk6ICsrdG9rUG9zOyByZXR1cm4gZmluaXNoVG9rZW4oX3NlbWkpO1xuICAgIGNhc2UgNDQ6ICsrdG9rUG9zOyByZXR1cm4gZmluaXNoVG9rZW4oX2NvbW1hKTtcbiAgICBjYXNlIDkxOiArK3Rva1BvczsgcmV0dXJuIGZpbmlzaFRva2VuKF9icmFja2V0TCk7XG4gICAgY2FzZSA5MzogKyt0b2tQb3M7IHJldHVybiBmaW5pc2hUb2tlbihfYnJhY2tldFIpO1xuICAgIGNhc2UgMTIzOiArK3Rva1BvczsgcmV0dXJuIGZpbmlzaFRva2VuKF9icmFjZUwpO1xuICAgIGNhc2UgMTI1OiArK3Rva1BvczsgcmV0dXJuIGZpbmlzaFRva2VuKF9icmFjZVIpO1xuICAgIGNhc2UgNTg6ICsrdG9rUG9zOyByZXR1cm4gZmluaXNoVG9rZW4oX2NvbG9uKTtcbiAgICBjYXNlIDYzOiArK3Rva1BvczsgcmV0dXJuIGZpbmlzaFRva2VuKF9xdWVzdGlvbik7XG5cbiAgICAgIC8vICcweCcgaXMgYSBoZXhhZGVjaW1hbCBudW1iZXIuXG4gICAgY2FzZSA0ODogLy8gJzAnXG4gICAgICB2YXIgbmV4dCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zICsgMSk7XG4gICAgICBpZiAobmV4dCA9PT0gMTIwIHx8IG5leHQgPT09IDg4KSByZXR1cm4gcmVhZEhleE51bWJlcigpO1xuICAgICAgLy8gQW55dGhpbmcgZWxzZSBiZWdpbm5pbmcgd2l0aCBhIGRpZ2l0IGlzIGFuIGludGVnZXIsIG9jdGFsXG4gICAgICAvLyBudW1iZXIsIG9yIGZsb2F0LlxuICAgIGNhc2UgNDk6IGNhc2UgNTA6IGNhc2UgNTE6IGNhc2UgNTI6IGNhc2UgNTM6IGNhc2UgNTQ6IGNhc2UgNTU6IGNhc2UgNTY6IGNhc2UgNTc6IC8vIDEtOVxuICAgICAgcmV0dXJuIHJlYWROdW1iZXIoZmFsc2UpO1xuXG4gICAgICAvLyBRdW90ZXMgcHJvZHVjZSBzdHJpbmdzLlxuICAgIGNhc2UgMzQ6IGNhc2UgMzk6IC8vICdcIicsIFwiJ1wiXG4gICAgICByZXR1cm4gcmVhZFN0cmluZyhjb2RlKTtcblxuICAgIC8vIE9wZXJhdG9ycyBhcmUgcGFyc2VkIGlubGluZSBpbiB0aW55IHN0YXRlIG1hY2hpbmVzLiAnPScgKDYxKSBpc1xuICAgIC8vIG9mdGVuIHJlZmVycmVkIHRvLiBgZmluaXNoT3BgIHNpbXBseSBza2lwcyB0aGUgYW1vdW50IG9mXG4gICAgLy8gY2hhcmFjdGVycyBpdCBpcyBnaXZlbiBhcyBzZWNvbmQgYXJndW1lbnQsIGFuZCByZXR1cm5zIGEgdG9rZW5cbiAgICAvLyBvZiB0aGUgdHlwZSBnaXZlbiBieSBpdHMgZmlyc3QgYXJndW1lbnQuXG5cbiAgICBjYXNlIDQ3OiAvLyAnLydcbiAgICAgIHJldHVybiByZWFkVG9rZW5fc2xhc2goY29kZSk7XG5cbiAgICBjYXNlIDQyOiBjYXNlIDM3OiAvLyAnKiUnXG4gICAgICByZXR1cm4gcmVhZFRva2VuX211bHRfbW9kdWxvKGNvZGUpO1xuXG4gICAgY2FzZSAxMjQ6IGNhc2UgMzg6IC8vICd8JidcbiAgICAgIHJldHVybiByZWFkVG9rZW5fcGlwZV9hbXAoY29kZSk7XG5cbiAgICBjYXNlIDk0OiAvLyAnXidcbiAgICAgIHJldHVybiByZWFkVG9rZW5fY2FyZXQoKTtcblxuICAgIGNhc2UgNDM6IGNhc2UgNDU6IC8vICcrLSdcbiAgICAgIHJldHVybiByZWFkVG9rZW5fcGx1c19taW4oY29kZSk7XG5cbiAgICBjYXNlIDYwOiBjYXNlIDYyOiAvLyAnPD4nXG4gICAgICByZXR1cm4gcmVhZFRva2VuX2x0X2d0KGNvZGUpO1xuXG4gICAgY2FzZSA2MTogY2FzZSAzMzogLy8gJz0hJ1xuICAgICAgcmV0dXJuIHJlYWRUb2tlbl9lcV9leGNsKGNvZGUpO1xuXG4gICAgY2FzZSAxMjY6IC8vICd+J1xuICAgICAgcmV0dXJuIGZpbmlzaE9wKF9iaXR3aXNlTk9ULCAxKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiByZWFkVG9rZW4oZm9yY2VSZWdleHApIHtcbiAgICBpZiAodG9rVHlwZSA9PT0gX2RlZGVudCkge1xuICAgICAgaW5kZW50SGlzdC5wb3AoKTtcbiAgICAgIGlmIChpbmRlbnRIaXN0LmRlZGVudENvdW50ID4gMCkgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghZm9yY2VSZWdleHApIHRva1N0YXJ0ID0gdG9rUG9zO1xuICAgIGVsc2UgdG9rUG9zID0gdG9rU3RhcnQgKyAxO1xuICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucykgdG9rU3RhcnRMb2MgPSBuZXcgUG9zaXRpb247XG4gICAgaWYgKGZvcmNlUmVnZXhwKSByZXR1cm4gcmVhZFJlZ2V4cCgpO1xuICAgIGlmICh0b2tQb3MgPj0gaW5wdXRMZW4pIHJldHVybiBmaW5pc2hUb2tlbihfZW9mKTtcbiAgICBpZiAodG9rVHlwZSA9PT0gX25ld2xpbmUpIHJldHVybiByZWFkVG9rZW5faW5kZW50KCk7XG5cbiAgICB2YXIgY29kZSA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKTtcbiAgICAvLyBJZGVudGlmaWVyIG9yIGtleXdvcmQuICdcXHVYWFhYJyBzZXF1ZW5jZXMgYXJlIGFsbG93ZWQgaW5cbiAgICAvLyBpZGVudGlmaWVycywgc28gJ1xcJyBhbHNvIGRpc3BhdGNoZXMgdG8gdGhhdC5cbiAgICBpZiAoaXNJZGVudGlmaWVyU3RhcnQoY29kZSkgfHwgY29kZSA9PT0gOTIgLyogJ1xcJyAqLykgcmV0dXJuIHJlYWRXb3JkKCk7XG5cbiAgICB2YXIgdG9rID0gZ2V0VG9rZW5Gcm9tQ29kZShjb2RlKTtcblxuICAgIGlmICh0b2sgPT09IGZhbHNlKSB7XG4gICAgICAvLyBJZiB3ZSBhcmUgaGVyZSwgd2UgZWl0aGVyIGZvdW5kIGEgbm9uLUFTQ0lJIGlkZW50aWZpZXJcbiAgICAgIC8vIGNoYXJhY3Rlciwgb3Igc29tZXRoaW5nIHRoYXQncyBlbnRpcmVseSBkaXNhbGxvd2VkLlxuICAgICAgdmFyIGNoID0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKTtcbiAgICAgIGlmIChjaCA9PT0gXCJcXFxcXCIgfHwgbm9uQVNDSUlpZGVudGlmaWVyU3RhcnQudGVzdChjaCkpIHJldHVybiByZWFkV29yZCgpO1xuICAgICAgcmFpc2UodG9rUG9zLCBcIlVuZXhwZWN0ZWQgY2hhcmFjdGVyICdcIiArIGNoICsgXCInXCIpO1xuICAgIH1cbiAgICByZXR1cm4gdG9rO1xuICB9XG5cbiAgZnVuY3Rpb24gZmluaXNoT3AodHlwZSwgc2l6ZSkge1xuICAgIHZhciBzdHIgPSBpbnB1dC5zbGljZSh0b2tQb3MsIHRva1BvcyArIHNpemUpO1xuICAgIHRva1BvcyArPSBzaXplO1xuICAgIGZpbmlzaFRva2VuKHR5cGUsIHN0cik7XG4gIH1cblxuICAvLyBQYXJzZSBhIHJlZ3VsYXIgZXhwcmVzc2lvbi4gU29tZSBjb250ZXh0LWF3YXJlbmVzcyBpcyBuZWNlc3NhcnksXG4gIC8vIHNpbmNlIGEgJy8nIGluc2lkZSBhICdbXScgc2V0IGRvZXMgbm90IGVuZCB0aGUgZXhwcmVzc2lvbi5cblxuICBmdW5jdGlvbiByZWFkUmVnZXhwKCkge1xuICAgIHZhciBjb250ZW50ID0gXCJcIiwgZXNjYXBlZCwgaW5DbGFzcywgc3RhcnQgPSB0b2tQb3MsIHZhbHVlO1xuICAgIGZvciAoOzspIHtcbiAgICAgIGlmICh0b2tQb3MgPj0gaW5wdXRMZW4pIHJhaXNlKHN0YXJ0LCBcIlVudGVybWluYXRlZCByZWd1bGFyIGV4cHJlc3Npb25cIik7XG4gICAgICB2YXIgY2ggPSBpbnB1dC5jaGFyQXQodG9rUG9zKTtcbiAgICAgIGlmIChuZXdsaW5lLnRlc3QoY2gpKSByYWlzZShzdGFydCwgXCJVbnRlcm1pbmF0ZWQgcmVndWxhciBleHByZXNzaW9uXCIpO1xuICAgICAgaWYgKCFlc2NhcGVkKSB7XG4gICAgICAgIGlmIChjaCA9PT0gXCJbXCIpIGluQ2xhc3MgPSB0cnVlO1xuICAgICAgICBlbHNlIGlmIChjaCA9PT0gXCJdXCIgJiYgaW5DbGFzcykgaW5DbGFzcyA9IGZhbHNlO1xuICAgICAgICBlbHNlIGlmIChjaCA9PT0gXCIvXCIgJiYgIWluQ2xhc3MpIGJyZWFrO1xuICAgICAgICBlc2NhcGVkID0gY2ggPT09IFwiXFxcXFwiO1xuICAgICAgfSBlbHNlIGVzY2FwZWQgPSBmYWxzZTtcbiAgICAgICsrdG9rUG9zO1xuICAgIH1cbiAgICBjb250ZW50ID0gaW5wdXQuc2xpY2Uoc3RhcnQsIHRva1Bvcyk7XG4gICAgKyt0b2tQb3M7XG4gICAgLy8gTmVlZCB0byB1c2UgYHJlYWRXb3JkMWAgYmVjYXVzZSAnXFx1WFhYWCcgc2VxdWVuY2VzIGFyZSBhbGxvd2VkXG4gICAgLy8gaGVyZSAoZG9uJ3QgYXNrKS5cbiAgICB2YXIgbW9kcyA9IHJlYWRXb3JkMSgpO1xuICAgIGlmIChtb2RzICYmICEvXltnbXNpeV0qJC8udGVzdChtb2RzKSkgcmFpc2Uoc3RhcnQsIFwiSW52YWxpZCByZWd1bGFyIGV4cHJlc3Npb24gZmxhZ1wiKTtcbiAgICB0cnkge1xuICAgICAgdmFsdWUgPSBuZXcgUmVnRXhwKGNvbnRlbnQsIG1vZHMpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGlmIChlIGluc3RhbmNlb2YgU3ludGF4RXJyb3IpIHJhaXNlKHN0YXJ0LCBcIkVycm9yIHBhcnNpbmcgcmVndWxhciBleHByZXNzaW9uOiBcIiArIGUubWVzc2FnZSk7XG4gICAgICByYWlzZShlKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpbmlzaFRva2VuKF9yZWdleHAsIHZhbHVlKTtcbiAgfVxuXG4gIC8vIFJlYWQgYW4gaW50ZWdlciBpbiB0aGUgZ2l2ZW4gcmFkaXguIFJldHVybiBudWxsIGlmIHplcm8gZGlnaXRzXG4gIC8vIHdlcmUgcmVhZCwgdGhlIGludGVnZXIgdmFsdWUgb3RoZXJ3aXNlLiBXaGVuIGBsZW5gIGlzIGdpdmVuLCB0aGlzXG4gIC8vIHdpbGwgcmV0dXJuIGBudWxsYCB1bmxlc3MgdGhlIGludGVnZXIgaGFzIGV4YWN0bHkgYGxlbmAgZGlnaXRzLlxuXG4gIGZ1bmN0aW9uIHJlYWRJbnQocmFkaXgsIGxlbikge1xuICAgIHZhciBzdGFydCA9IHRva1BvcywgdG90YWwgPSAwO1xuICAgIGZvciAodmFyIGkgPSAwLCBlID0gbGVuID09IG51bGwgPyBJbmZpbml0eSA6IGxlbjsgaSA8IGU7ICsraSkge1xuICAgICAgdmFyIGNvZGUgPSBpbnB1dC5jaGFyQ29kZUF0KHRva1BvcyksIHZhbDtcbiAgICAgIGlmIChjb2RlID49IDk3KSB2YWwgPSBjb2RlIC0gOTcgKyAxMDsgLy8gYVxuICAgICAgZWxzZSBpZiAoY29kZSA+PSA2NSkgdmFsID0gY29kZSAtIDY1ICsgMTA7IC8vIEFcbiAgICAgIGVsc2UgaWYgKGNvZGUgPj0gNDggJiYgY29kZSA8PSA1NykgdmFsID0gY29kZSAtIDQ4OyAvLyAwLTlcbiAgICAgIGVsc2UgdmFsID0gSW5maW5pdHk7XG4gICAgICBpZiAodmFsID49IHJhZGl4KSBicmVhaztcbiAgICAgICsrdG9rUG9zO1xuICAgICAgdG90YWwgPSB0b3RhbCAqIHJhZGl4ICsgdmFsO1xuICAgIH1cbiAgICBpZiAodG9rUG9zID09PSBzdGFydCB8fCBsZW4gIT0gbnVsbCAmJiB0b2tQb3MgLSBzdGFydCAhPT0gbGVuKSByZXR1cm4gbnVsbDtcblxuICAgIHJldHVybiB0b3RhbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRIZXhOdW1iZXIoKSB7XG4gICAgdG9rUG9zICs9IDI7IC8vIDB4XG4gICAgdmFyIHZhbCA9IHJlYWRJbnQoMTYpO1xuICAgIGlmICh2YWwgPT0gbnVsbCkgcmFpc2UodG9rU3RhcnQgKyAyLCBcIkV4cGVjdGVkIGhleGFkZWNpbWFsIG51bWJlclwiKTtcbiAgICBpZiAoaXNJZGVudGlmaWVyU3RhcnQoaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MpKSkgcmFpc2UodG9rUG9zLCBcIklkZW50aWZpZXIgZGlyZWN0bHkgYWZ0ZXIgbnVtYmVyXCIpO1xuICAgIHJldHVybiBmaW5pc2hUb2tlbihfbnVtLCB2YWwpO1xuICB9XG5cbiAgLy8gUmVhZCBhbiBpbnRlZ2VyLCBvY3RhbCBpbnRlZ2VyLCBvciBmbG9hdGluZy1wb2ludCBudW1iZXIuXG5cbiAgZnVuY3Rpb24gcmVhZE51bWJlcihzdGFydHNXaXRoRG90KSB7XG4gICAgdmFyIHN0YXJ0ID0gdG9rUG9zLCBpc0Zsb2F0ID0gZmFsc2UsIG9jdGFsID0gaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MpID09PSA0ODtcbiAgICBpZiAoIXN0YXJ0c1dpdGhEb3QgJiYgcmVhZEludCgxMCkgPT09IG51bGwpIHJhaXNlKHN0YXJ0LCBcIkludmFsaWQgbnVtYmVyXCIpO1xuICAgIGlmIChpbnB1dC5jaGFyQ29kZUF0KHRva1BvcykgPT09IDQ2KSB7XG4gICAgICArK3Rva1BvcztcbiAgICAgIHJlYWRJbnQoMTApO1xuICAgICAgaXNGbG9hdCA9IHRydWU7XG4gICAgfVxuICAgIHZhciBuZXh0ID0gaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MpO1xuICAgIGlmIChuZXh0ID09PSA2OSB8fCBuZXh0ID09PSAxMDEpIHsgLy8gJ2VFJ1xuICAgICAgbmV4dCA9IGlucHV0LmNoYXJDb2RlQXQoKyt0b2tQb3MpO1xuICAgICAgaWYgKG5leHQgPT09IDQzIHx8IG5leHQgPT09IDQ1KSArK3Rva1BvczsgLy8gJystJ1xuICAgICAgaWYgKHJlYWRJbnQoMTApID09PSBudWxsKSByYWlzZShzdGFydCwgXCJJbnZhbGlkIG51bWJlclwiKTtcbiAgICAgIGlzRmxvYXQgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoaXNJZGVudGlmaWVyU3RhcnQoaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MpKSkgcmFpc2UodG9rUG9zLCBcIklkZW50aWZpZXIgZGlyZWN0bHkgYWZ0ZXIgbnVtYmVyXCIpO1xuXG4gICAgdmFyIHN0ciA9IGlucHV0LnNsaWNlKHN0YXJ0LCB0b2tQb3MpLCB2YWw7XG4gICAgaWYgKGlzRmxvYXQpIHZhbCA9IHBhcnNlRmxvYXQoc3RyKTtcbiAgICBlbHNlIGlmICghb2N0YWwgfHwgc3RyLmxlbmd0aCA9PT0gMSkgdmFsID0gcGFyc2VJbnQoc3RyLCAxMCk7XG4gICAgZWxzZSBpZiAoL1s4OV0vLnRlc3Qoc3RyKSB8fCBzdHJpY3QpIHJhaXNlKHN0YXJ0LCBcIkludmFsaWQgbnVtYmVyXCIpO1xuICAgIGVsc2UgdmFsID0gcGFyc2VJbnQoc3RyLCA4KTtcbiAgICByZXR1cm4gZmluaXNoVG9rZW4oX251bSwgdmFsKTtcbiAgfVxuXG4gIC8vIFJlYWQgYSBzdHJpbmcgdmFsdWUsIGludGVycHJldGluZyBiYWNrc2xhc2gtZXNjYXBlcy5cblxuICBmdW5jdGlvbiByZWFkU3RyaW5nKHF1b3RlKSB7XG4gICAgdG9rUG9zKys7XG4gICAgdmFyIGNoID0gaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MpO1xuICAgIHZhciB0cmlwbGVRdW90ZWQgPSBmYWxzZTtcbiAgICBpZiAoY2ggPT09IHF1b3RlICYmIGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKzEpID09PSBxdW90ZSkge1xuICAgICAgdHJpcGxlUXVvdGVkID0gdHJ1ZTtcbiAgICAgIHRva1BvcyArPSAyO1xuICAgIH1cbiAgICB2YXIgb3V0ID0gXCJcIjtcbiAgICBmb3IgKDs7KSB7XG4gICAgICBpZiAodG9rUG9zID49IGlucHV0TGVuKSByYWlzZSh0b2tTdGFydCwgXCJVbnRlcm1pbmF0ZWQgc3RyaW5nIGNvbnN0YW50XCIpO1xuICAgICAgdmFyIGNoID0gaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MpO1xuICAgICAgaWYgKGNoID09PSBxdW90ZSkge1xuICAgICAgICBpZiAodHJpcGxlUXVvdGVkKSB7XG4gICAgICAgICAgaWYgKGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKzEpID09PSBxdW90ZSAmJlxuICAgICAgICAgICAgICBpbnB1dC5jaGFyQ29kZUF0KHRva1BvcysyKSA9PT0gcXVvdGUpIHtcbiAgICAgICAgICAgIHRva1BvcyArPSAzO1xuICAgICAgICAgICAgcmV0dXJuIGZpbmlzaFRva2VuKF9zdHJpbmcsIG91dCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICsrdG9rUG9zO1xuICAgICAgICAgIHJldHVybiBmaW5pc2hUb2tlbihfc3RyaW5nLCBvdXQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoY2ggPT09IDkyKSB7IC8vICdcXCdcbiAgICAgICAgY2ggPSBpbnB1dC5jaGFyQ29kZUF0KCsrdG9rUG9zKTtcbiAgICAgICAgdmFyIG9jdGFsID0gL15bMC03XSsvLmV4ZWMoaW5wdXQuc2xpY2UodG9rUG9zLCB0b2tQb3MgKyAzKSk7XG4gICAgICAgIGlmIChvY3RhbCkgb2N0YWwgPSBvY3RhbFswXTtcbiAgICAgICAgd2hpbGUgKG9jdGFsICYmIHBhcnNlSW50KG9jdGFsLCA4KSA+IDI1NSkgb2N0YWwgPSBvY3RhbC5zbGljZSgwLCAtMSk7XG4gICAgICAgIGlmIChvY3RhbCA9PT0gXCIwXCIpIG9jdGFsID0gbnVsbDtcbiAgICAgICAgKyt0b2tQb3M7XG4gICAgICAgIGlmIChvY3RhbCkge1xuICAgICAgICAgIGlmIChzdHJpY3QpIHJhaXNlKHRva1BvcyAtIDIsIFwiT2N0YWwgbGl0ZXJhbCBpbiBzdHJpY3QgbW9kZVwiKTtcbiAgICAgICAgICBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShwYXJzZUludChvY3RhbCwgOCkpO1xuICAgICAgICAgIHRva1BvcyArPSBvY3RhbC5sZW5ndGggLSAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN3aXRjaCAoY2gpIHtcbiAgICAgICAgICBjYXNlIDExMDogb3V0ICs9IFwiXFxuXCI7IGJyZWFrOyAvLyAnbicgLT4gJ1xcbidcbiAgICAgICAgICBjYXNlIDExNDogb3V0ICs9IFwiXFxyXCI7IGJyZWFrOyAvLyAncicgLT4gJ1xccidcbiAgICAgICAgICBjYXNlIDEyMDogb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUocmVhZEhleENoYXIoMikpOyBicmVhazsgLy8gJ3gnXG4gICAgICAgICAgY2FzZSAxMTc6IG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHJlYWRIZXhDaGFyKDQpKTsgYnJlYWs7IC8vICd1J1xuICAgICAgICAgIGNhc2UgODU6IC8vICdVJ1xuICAgICAgICAgICAgY2ggPSByZWFkSGV4Q2hhcig4KTtcbiAgICAgICAgICAgIGlmIChjaCA8IDB4RkZGRiAmJiAoY2ggPCAweEQ4MDAgfHwgMHhEQkZGIDwgY2gpKSBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7IC8vIElmIGl0J3MgVVRGLTE2XG4gICAgICAgICAgICBlbHNlIHsgLy8gSWYgd2UgbmVlZCBVQ1MtMlxuICAgICAgICAgICAgICBjaCAtPSAweDEwMDAwO1xuICAgICAgICAgICAgICBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoY2g+PjEwKSsweGQ4MDApK1N0cmluZy5mcm9tQ2hhckNvZGUoKGNoJTB4NDAwKSsweGRjMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAxMTY6IG91dCArPSBcIlxcdFwiOyBicmVhazsgLy8gJ3QnIC0+ICdcXHQnXG4gICAgICAgICAgY2FzZSA5ODogb3V0ICs9IFwiXFxiXCI7IGJyZWFrOyAvLyAnYicgLT4gJ1xcYidcbiAgICAgICAgICBjYXNlIDExODogb3V0ICs9IFwiXFx1MDAwYlwiOyBicmVhazsgLy8gJ3YnIC0+ICdcXHUwMDBiJ1xuICAgICAgICAgIGNhc2UgMTAyOiBvdXQgKz0gXCJcXGZcIjsgYnJlYWs7IC8vICdmJyAtPiAnXFxmJ1xuICAgICAgICAgIGNhc2UgNDg6IG91dCArPSBcIlxcMFwiOyBicmVhazsgLy8gMCAtPiAnXFwwJ1xuICAgICAgICAgIGNhc2UgMTM6IGlmIChpbnB1dC5jaGFyQ29kZUF0KHRva1BvcykgPT09IDEwKSArK3Rva1BvczsgLy8gJ1xcclxcbidcbiAgICAgICAgICBjYXNlIDEwOiAvLyAnIFxcbidcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucykgeyB0b2tMaW5lU3RhcnQgPSB0b2tQb3M7ICsrdG9rQ3VyTGluZTsgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDogb3V0ICs9ICdcXFxcJyArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOyBicmVhazsgLy8gUHl0aG9uIGRvZXNuJ3QgcmVtb3ZlIHNsYXNoZXMgb24gZmFpbGVkIGVzY2FwZXNcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChpc05ld2xpbmUoY2gpKSB7XG4gICAgICAgICAgaWYgKHRyaXBsZVF1b3RlZCkge1xuICAgICAgICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpO1xuICAgICAgICAgICAgKyt0b2tQb3M7XG4gICAgICAgICAgICBpZiAoY2ggPT09IDEzICYmIGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKSA9PT0gMTApIHtcbiAgICAgICAgICAgICAgKyt0b2tQb3M7XG4gICAgICAgICAgICAgIG91dCArPSBcIlxcblwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9wdGlvbnMubG9jYXRpb24pIHsgdG9rTGluZVN0YXJ0ID0gdG9rUG9zOyArK3Rva0N1ckxpbmU7IH1cbiAgICAgICAgICB9IGVsc2UgcmFpc2UodG9rU3RhcnQsIFwiVW50ZXJtaW5hdGVkIHN0cmluZyBjb25zdGFudFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7IC8vICdcXCdcbiAgICAgICAgICArK3Rva1BvcztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIFVzZWQgdG8gcmVhZCBjaGFyYWN0ZXIgZXNjYXBlIHNlcXVlbmNlcyAoJ1xceCcsICdcXHUnLCAnXFxVJykuXG5cbiAgZnVuY3Rpb24gcmVhZEhleENoYXIobGVuKSB7XG4gICAgdmFyIG4gPSByZWFkSW50KDE2LCBsZW4pO1xuICAgIGlmIChuID09PSBudWxsKSByYWlzZSh0b2tTdGFydCwgXCJCYWQgY2hhcmFjdGVyIGVzY2FwZSBzZXF1ZW5jZVwiKTtcbiAgICByZXR1cm4gbjtcbiAgfVxuXG4gIC8vIFVzZWQgdG8gc2lnbmFsIHRvIGNhbGxlcnMgb2YgYHJlYWRXb3JkMWAgd2hldGhlciB0aGUgd29yZFxuICAvLyBjb250YWluZWQgYW55IGVzY2FwZSBzZXF1ZW5jZXMuIFRoaXMgaXMgbmVlZGVkIGJlY2F1c2Ugd29yZHMgd2l0aFxuICAvLyBlc2NhcGUgc2VxdWVuY2VzIG11c3Qgbm90IGJlIGludGVycHJldGVkIGFzIGtleXdvcmRzLlxuXG4gIHZhciBjb250YWluc0VzYztcblxuICAvLyBSZWFkIGFuIGlkZW50aWZpZXIsIGFuZCByZXR1cm4gaXQgYXMgYSBzdHJpbmcuIFNldHMgYGNvbnRhaW5zRXNjYFxuICAvLyB0byB3aGV0aGVyIHRoZSB3b3JkIGNvbnRhaW5lZCBhICdcXHUnIGVzY2FwZS5cbiAgLy9cbiAgLy8gT25seSBidWlsZHMgdXAgdGhlIHdvcmQgY2hhcmFjdGVyLWJ5LWNoYXJhY3RlciB3aGVuIGl0IGFjdHVhbGx5XG4gIC8vIGNvbnRhaW5lZHMgYW4gZXNjYXBlLCBhcyBhIG1pY3JvLW9wdGltaXphdGlvbi5cblxuICBmdW5jdGlvbiByZWFkV29yZDEoKSB7XG4gICAgY29udGFpbnNFc2MgPSBmYWxzZTtcbiAgICB2YXIgd29yZCwgZmlyc3QgPSB0cnVlLCBzdGFydCA9IHRva1BvcztcbiAgICBmb3IgKDs7KSB7XG4gICAgICB2YXIgY2ggPSBpbnB1dC5jaGFyQ29kZUF0KHRva1Bvcyk7XG4gICAgICBpZiAoaXNJZGVudGlmaWVyQ2hhcihjaCkpIHtcbiAgICAgICAgaWYgKGNvbnRhaW5zRXNjKSB3b3JkICs9IGlucHV0LmNoYXJBdCh0b2tQb3MpO1xuICAgICAgICArK3Rva1BvcztcbiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDkyKSB7IC8vIFwiXFxcIlxuICAgICAgICBpZiAoIWNvbnRhaW5zRXNjKSB3b3JkID0gaW5wdXQuc2xpY2Uoc3RhcnQsIHRva1Bvcyk7XG4gICAgICAgIGNvbnRhaW5zRXNjID0gdHJ1ZTtcbiAgICAgICAgaWYgKGlucHV0LmNoYXJDb2RlQXQoKyt0b2tQb3MpICE9IDExNykgLy8gXCJ1XCJcbiAgICAgICAgICByYWlzZSh0b2tQb3MsIFwiRXhwZWN0aW5nIFVuaWNvZGUgZXNjYXBlIHNlcXVlbmNlIFxcXFx1WFhYWFwiKTtcbiAgICAgICAgKyt0b2tQb3M7XG4gICAgICAgIHZhciBlc2MgPSByZWFkSGV4Q2hhcig0KTtcbiAgICAgICAgdmFyIGVzY1N0ciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZXNjKTtcbiAgICAgICAgaWYgKCFlc2NTdHIpIHJhaXNlKHRva1BvcyAtIDEsIFwiSW52YWxpZCBVbmljb2RlIGVzY2FwZVwiKTtcbiAgICAgICAgaWYgKCEoZmlyc3QgPyBpc0lkZW50aWZpZXJTdGFydChlc2MpIDogaXNJZGVudGlmaWVyQ2hhcihlc2MpKSlcbiAgICAgICAgICByYWlzZSh0b2tQb3MgLSA0LCBcIkludmFsaWQgVW5pY29kZSBlc2NhcGVcIik7XG4gICAgICAgIHdvcmQgKz0gZXNjU3RyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBmaXJzdCA9IGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gY29udGFpbnNFc2MgPyB3b3JkIDogaW5wdXQuc2xpY2Uoc3RhcnQsIHRva1Bvcyk7XG4gIH1cblxuICAvLyBSZWFkIGFuIGlkZW50aWZpZXIgb3Iga2V5d29yZCB0b2tlbi4gV2lsbCBjaGVjayBmb3IgcmVzZXJ2ZWRcbiAgLy8gd29yZHMgd2hlbiBuZWNlc3NhcnkuXG5cbiAgZnVuY3Rpb24gcmVhZFdvcmQoKSB7XG4gICAgdmFyIHdvcmQgPSByZWFkV29yZDEoKTtcbiAgICB2YXIgdHlwZSA9IF9uYW1lO1xuICAgIGlmICghY29udGFpbnNFc2MgJiYgaXNLZXl3b3JkKHdvcmQpKVxuICAgICAgdHlwZSA9IGtleXdvcmRUeXBlc1t3b3JkXTtcbiAgICByZXR1cm4gZmluaXNoVG9rZW4odHlwZSwgd29yZCk7XG4gIH1cblxuICAvLyAjIyBQYXJzZXJcblxuICAvLyBBIHJlY3Vyc2l2ZSBkZXNjZW50IHBhcnNlciBvcGVyYXRlcyBieSBkZWZpbmluZyBmdW5jdGlvbnMgZm9yIGFsbFxuICAvLyBzeW50YWN0aWMgZWxlbWVudHMsIGFuZCByZWN1cnNpdmVseSBjYWxsaW5nIHRob3NlLCBlYWNoIGZ1bmN0aW9uXG4gIC8vIGFkdmFuY2luZyB0aGUgaW5wdXQgc3RyZWFtIGFuZCByZXR1cm5pbmcgYW4gQVNUIG5vZGUuIFByZWNlZGVuY2VcbiAgLy8gb2YgY29uc3RydWN0cyAoZm9yIGV4YW1wbGUsIHRoZSBmYWN0IHRoYXQgYCF4WzFdYCBtZWFucyBgISh4WzFdKWBcbiAgLy8gaW5zdGVhZCBvZiBgKCF4KVsxXWAgaXMgaGFuZGxlZCBieSB0aGUgZmFjdCB0aGF0IHRoZSBwYXJzZXJcbiAgLy8gZnVuY3Rpb24gdGhhdCBwYXJzZXMgdW5hcnkgcHJlZml4IG9wZXJhdG9ycyBpcyBjYWxsZWQgZmlyc3QsIGFuZFxuICAvLyBpbiB0dXJuIGNhbGxzIHRoZSBmdW5jdGlvbiB0aGF0IHBhcnNlcyBgW11gIHN1YnNjcmlwdHMgLSB0aGF0XG4gIC8vIHdheSwgaXQnbGwgcmVjZWl2ZSB0aGUgbm9kZSBmb3IgYHhbMV1gIGFscmVhZHkgcGFyc2VkLCBhbmQgd3JhcHNcbiAgLy8gKnRoYXQqIGluIHRoZSB1bmFyeSBvcGVyYXRvciBub2RlLlxuICAvL1xuICAvLyBBY29ybiB1c2VzIGFuIFtvcGVyYXRvciBwcmVjZWRlbmNlIHBhcnNlcl1bb3BwXSB0byBoYW5kbGUgYmluYXJ5XG4gIC8vIG9wZXJhdG9yIHByZWNlZGVuY2UsIGJlY2F1c2UgaXQgaXMgbXVjaCBtb3JlIGNvbXBhY3QgdGhhbiB1c2luZ1xuICAvLyB0aGUgdGVjaG5pcXVlIG91dGxpbmVkIGFib3ZlLCB3aGljaCB1c2VzIGRpZmZlcmVudCwgbmVzdGluZ1xuICAvLyBmdW5jdGlvbnMgdG8gc3BlY2lmeSBwcmVjZWRlbmNlLCBmb3IgYWxsIG9mIHRoZSB0ZW4gYmluYXJ5XG4gIC8vIHByZWNlZGVuY2UgbGV2ZWxzIHRoYXQgSmF2YVNjcmlwdCBkZWZpbmVzLlxuICAvL1xuICAvLyBbb3BwXTogaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9PcGVyYXRvci1wcmVjZWRlbmNlX3BhcnNlclxuXG4gIC8vICMjIyBQYXJzZXIgdXRpbGl0aWVzXG5cbiAgLy8gQ29udGludWUgdG8gdGhlIG5leHQgdG9rZW4uXG5cbiAgZnVuY3Rpb24gbmV4dCgpIHtcbiAgICBsYXN0U3RhcnQgPSB0b2tTdGFydDtcbiAgICBsYXN0RW5kID0gdG9rRW5kO1xuICAgIGxhc3RFbmRMb2MgPSB0b2tFbmRMb2M7XG4gICAgcmVhZFRva2VuKCk7XG4gIH1cblxuICAvLyBFbnRlciBzdHJpY3QgbW9kZS4gUmUtcmVhZHMgdGhlIG5leHQgdG9rZW4gdG8gcGxlYXNlIHBlZGFudGljXG4gIC8vIHRlc3RzIChcInVzZSBzdHJpY3RcIjsgMDEwOyAtLSBzaG91bGQgZmFpbCkuXG5cbiAgZnVuY3Rpb24gc2V0U3RyaWN0KHN0cmN0KSB7XG4gICAgc3RyaWN0ID0gc3RyY3Q7XG4gICAgdG9rUG9zID0gdG9rU3RhcnQ7XG4gICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKSB7XG4gICAgICB3aGlsZSAodG9rUG9zIDwgdG9rTGluZVN0YXJ0KSB7XG4gICAgICAgIHRva0xpbmVTdGFydCA9IGlucHV0Lmxhc3RJbmRleE9mKFwiXFxuXCIsIHRva0xpbmVTdGFydCAtIDIpICsgMTtcbiAgICAgICAgLS10b2tDdXJMaW5lO1xuICAgICAgfVxuICAgIH1cbiAgICBza2lwU3BhY2UoKTtcbiAgICByZWFkVG9rZW4oKTtcbiAgfVxuXG4gIC8vIFN0YXJ0IGFuIEFTVCBub2RlLCBhdHRhY2hpbmcgYSBzdGFydCBvZmZzZXQuXG5cbiAgZnVuY3Rpb24gTm9kZSgpIHtcbiAgICB0aGlzLnR5cGUgPSBudWxsO1xuICB9XG5cbiAgZXhwb3J0cy5Ob2RlID0gTm9kZTtcblxuICBmdW5jdGlvbiBTb3VyY2VMb2NhdGlvbigpIHtcbiAgICB0aGlzLnN0YXJ0ID0gdG9rU3RhcnRMb2M7XG4gICAgdGhpcy5lbmQgPSBudWxsO1xuICAgIGlmIChzb3VyY2VGaWxlICE9PSBudWxsKSB0aGlzLnNvdXJjZSA9IHNvdXJjZUZpbGU7XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydE5vZGUoKSB7XG4gICAgdmFyIG5vZGUgPSBuZXcgTm9kZSgpO1xuICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucylcbiAgICAgIG5vZGUubG9jID0gbmV3IFNvdXJjZUxvY2F0aW9uKCk7XG4gICAgaWYgKG9wdGlvbnMuZGlyZWN0U291cmNlRmlsZSlcbiAgICAgIG5vZGUuc291cmNlRmlsZSA9IG9wdGlvbnMuZGlyZWN0U291cmNlRmlsZTtcbiAgICBpZiAob3B0aW9ucy5yYW5nZXMpXG4gICAgICBub2RlLnJhbmdlID0gW3Rva1N0YXJ0LCAwXTtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIC8vIEZpbmlzaCBhbiBBU1Qgbm9kZSwgYWRkaW5nIGB0eXBlYCBhbmQgYGVuZGAgcHJvcGVydGllcy5cblxuICBmdW5jdGlvbiBmaW5pc2hOb2RlKG5vZGUsIHR5cGUpIHtcbiAgICBub2RlLnR5cGUgPSB0eXBlO1xuICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucylcbiAgICAgIG5vZGUubG9jLmVuZCA9IGxhc3RFbmRMb2M7XG4gICAgaWYgKG9wdGlvbnMucmFuZ2VzKVxuICAgICAgbm9kZS5yYW5nZVsxXSA9IGxhc3RFbmQ7XG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICAvLyBTdGFydCBhIG5vZGUgd2hvc2Ugc3RhcnQgb2Zmc2V0IGluZm9ybWF0aW9uIHNob3VsZCBiZSBiYXNlZCBvblxuICAvLyB0aGUgc3RhcnQgb2YgYW5vdGhlciBub2RlLiBGb3IgZXhhbXBsZSwgYSBiaW5hcnkgb3BlcmF0b3Igbm9kZSBpc1xuICAvLyBvbmx5IHN0YXJ0ZWQgYWZ0ZXIgaXRzIGxlZnQtaGFuZCBzaWRlIGhhcyBhbHJlYWR5IGJlZW4gcGFyc2VkLlxuXG4gIGZ1bmN0aW9uIHN0YXJ0Tm9kZUZyb20ob3RoZXIpIHtcbiAgICB2YXIgbm9kZSA9IG5ldyBOb2RlKCk7XG4gICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKSB7XG4gICAgICBub2RlLmxvYyA9IG5ldyBTb3VyY2VMb2NhdGlvbigpO1xuICAgICAgbm9kZS5sb2Muc3RhcnQgPSBvdGhlci5sb2Muc3RhcnQ7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnJhbmdlcylcbiAgICAgIG5vZGUucmFuZ2UgPSBbb3RoZXIucmFuZ2VbMF0sIDBdO1xuXG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICAvLyAjIyBOb2RlIGNyZWF0aW9uIHV0aWxpdGllc1xuXG4gIHZhciBnZXROb2RlQ3JlYXRvciA9IGV4cG9ydHMuZ2V0Tm9kZUNyZWF0b3IgPSBmdW5jdGlvbihzdGFydE5vZGUsIHN0YXJ0Tm9kZUZyb20sIGZpbmlzaE5vZGUsIHVucGFja1R1cGxlKSB7XG5cbiAgICByZXR1cm4ge1xuXG4gICAgICAvLyBGaW5pc2ggYSBub2RlIHdob3NlIGVuZCBvZmZzZXQgaW5mb3JtYXRpb24gc2hvdWxkIGJlIGJhc2VkIG9uXG4gICAgICAvLyB0aGUgZW5kIG9mIGFub3RoZXIgbm9kZS4gIEZvciBleGFtcGxlLCBjcmVhdGVOb2RlKiBmdW5jdGlvbnNcbiAgICAgIC8vIGFyZSB1c2VkIHRvIGNyZWF0ZSBleHRyYSBBU1Qgbm9kZXMgd2hpY2ggbWF5IGJlIGJhc2VkIG9uIGEgc2luZ2xlXG4gICAgICAvLyBwYXJzZWQgdXNlciBjb2RlIG5vZGUuXG5cbiAgICAgIGZpbmlzaE5vZGVGcm9tOiBmdW5jdGlvbiAoZW5kTm9kZSwgbm9kZSwgdHlwZSkge1xuICAgICAgICBub2RlLnR5cGUgPSB0eXBlO1xuICAgICAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIG5vZGUubG9jLmVuZCA9IGVuZE5vZGUubG9jLmVuZDtcbiAgICAgICAgaWYgKG9wdGlvbnMucmFuZ2VzKSBub2RlLnJhbmdlWzFdID0gZW5kTm9kZS5yYW5nZVsxXTtcbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICB9LFxuXG4gICAgICAvLyBDcmVhdGUgYW4gQVNUIG5vZGUgdXNpbmcgc3RhcnQgb2Zmc2V0c1xuXG4gICAgICBjcmVhdGVOb2RlRnJvbTogZnVuY3Rpb24gKHN0YXJ0Tm9kZSwgdHlwZSwgcHJvcHMpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBzdGFydE5vZGVGcm9tKHN0YXJ0Tm9kZSk7XG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gcHJvcHMpIG5vZGVbcHJvcF0gPSBwcm9wc1twcm9wXTtcbiAgICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgdHlwZSk7XG4gICAgICB9LFxuXG4gICAgICAvLyBDcmVhdGUgYW4gQVNUIG5vZGUgdXNpbmcgc3RhcnQgYW5kIGVuZCBvZmZzZXRzXG5cbiAgICAgIGNyZWF0ZU5vZGVTcGFuOiBmdW5jdGlvbiAoc3RhcnROb2RlLCBlbmROb2RlLCB0eXBlLCBwcm9wcykge1xuICAgICAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZUZyb20oc3RhcnROb2RlKTtcbiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBwcm9wcykgbm9kZVtwcm9wXSA9IHByb3BzW3Byb3BdO1xuICAgICAgICByZXR1cm4gdGhpcy5maW5pc2hOb2RlRnJvbShlbmROb2RlLCBub2RlLCB0eXBlKTtcbiAgICAgIH0sXG5cbiAgICAgIGNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuOiBmdW5jdGlvbiAoc3RhcnROb2RlLCBlbmROb2RlLCB0eXBlLCBwcm9wcykge1xuICAgICAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZUZyb20oc3RhcnROb2RlKTtcbiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBwcm9wcykgbm9kZVtwcm9wXSA9IHByb3BzW3Byb3BdO1xuICAgICAgICBub2RlLnVzZXJDb2RlID0gZmFsc2U7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmlzaE5vZGVGcm9tKGVuZE5vZGUsIG5vZGUsIHR5cGUpO1xuICAgICAgfSxcblxuICAgICAgLy8gd2hpbGUgKF9fZm9ybWFsc0luZGV4IDwgX19wYXJhbXMuZm9ybWFscy5sZW5ndGgpIHtcbiAgICAgIC8vICAgPGFyZ3NJZD4ucHVzaChfX3BhcmFtcy5mb3JtYWxzW19fZm9ybWFsc0luZGV4KytdKTsgfVxuICAgICAgY3JlYXRlTm9kZUFyZ3NXaGlsZUNvbnNlcXVlbnQ6IGZ1bmN0aW9uIChhcmdzSWQsIHMpIHtcbiAgICAgICAgdmFyIF9fcGFyYW1zRm9ybWFscyA9IHRoaXMuY3JlYXRlTm9kZU1lbWJJZHMoYXJnc0lkLCAnX19wYXJhbXMnICsgcywgJ2Zvcm1hbHMnKTtcbiAgICAgICAgdmFyIF9fZm9ybWFsc0luZGV4SWQgPSB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnX19mb3JtYWxzSW5kZXgnICsgcyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiV2hpbGVTdGF0ZW1lbnRcIiwge1xuICAgICAgICAgIHRlc3Q6IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiQmluYXJ5RXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICBvcGVyYXRvcjogJzwnLCBsZWZ0OiBfX2Zvcm1hbHNJbmRleElkLFxuICAgICAgICAgICAgcmlnaHQ6IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgIGNvbXB1dGVkOiBmYWxzZSwgb2JqZWN0OiBfX3BhcmFtc0Zvcm1hbHMsXG4gICAgICAgICAgICAgIHByb3BlcnR5OiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnbGVuZ3RoJyB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBib2R5OiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIkJsb2NrU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgIGJvZHk6IFt0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIiwge1xuICAgICAgICAgICAgICBleHByZXNzaW9uOiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIkNhbGxFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICBjYWxsZWU6IHRoaXMuY3JlYXRlTm9kZU1lbWJJZHMoYXJnc0lkLCBhcmdzSWQubmFtZSwgJ3B1c2gnKSxcbiAgICAgICAgICAgICAgICBhcmd1bWVudHM6IFt0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIk1lbWJlckV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICAgICAgY29tcHV0ZWQ6IHRydWUsIG9iamVjdDogX19wYXJhbXNGb3JtYWxzLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydHk6IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiVXBkYXRlRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiAnKysnLCBwcmVmaXg6IGZhbHNlLCBhcmd1bWVudDogX19mb3JtYWxzSW5kZXhJZFxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KV1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXVxuICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgICAgfSxcblxuICAgICAgLy8geyB3aGlsZSAoX19mb3JtYWxzSW5kZXggPCBfX2FyZ3MubGVuZ3RoKSB7XG4gICAgICAvLyAgIDxhcmdzSWQ+LnB1c2goX19hcmdzW19fZm9ybWFsc0luZGV4KytdKTsgfX1cbiAgICAgIGNyZWF0ZU5vZGVBcmdzQWx0ZXJuYXRlOiBmdW5jdGlvbiAoYXJnc0lkLCBzKSB7XG4gICAgICAgIHZhciBfX2FyZ3MgPSAnX19hcmdzJyArIHM7XG4gICAgICAgIHZhciBfX2Zvcm1hbHNJbmRleElkID0gdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ19fZm9ybWFsc0luZGV4JyArIHMgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIkJsb2NrU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICBib2R5OiBbdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJXaGlsZVN0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICB0ZXN0OiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIkJpbmFyeUV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICBvcGVyYXRvcjogJzwnLCBsZWZ0OiBfX2Zvcm1hbHNJbmRleElkLFxuICAgICAgICAgICAgICByaWdodDogdGhpcy5jcmVhdGVOb2RlTWVtYklkcyhhcmdzSWQsIF9fYXJncywgJ2xlbmd0aCcpXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGJvZHk6IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiQmxvY2tTdGF0ZW1lbnRcIiwge1xuICAgICAgICAgICAgICBib2R5OiBbdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJFeHByZXNzaW9uU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgICAgICBleHByZXNzaW9uOiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIkNhbGxFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgIGNhbGxlZTogdGhpcy5jcmVhdGVOb2RlTWVtYklkcyhhcmdzSWQsIGFyZ3NJZC5uYW1lLCAncHVzaCcpLFxuICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiBbdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcHV0ZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdDogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogX19hcmdzIH0pLFxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eTogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJVcGRhdGVFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogJysrJywgcHJlZml4OiBmYWxzZSwgYXJndW1lbnQ6IF9fZm9ybWFsc0luZGV4SWRcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIH0pXVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIH0pXVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9KV1cbiAgICAgICAgfSk7XG4gICAgICB9LFxuXG4gICAgICAvLyByZXR1cm4gKGZ1bmN0aW9uKCkgezxib2R5Pn0pLmNhbGwodGhpcyk7XG4gICAgICBjcmVhdGVOb2RlRm5Cb2R5SWlmZTogZnVuY3Rpb24gKGJvZHkpIHtcbiAgICAgICAgdmFyIGlpZmVCb2R5ID0gdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3Bhbihib2R5LCBib2R5LCBcIkZ1bmN0aW9uRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgcGFyYW1zOiBbXSwgZGVmYXVsdHM6IFtdLCBib2R5OiBib2R5LCBnZW5lcmF0b3I6IGZhbHNlLCBleHByZXNzaW9uOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGlpZmVDYWxsID0gdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3Bhbihib2R5LCBib2R5LCBcIkNhbGxFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICBjYWxsZWU6IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYm9keSwgYm9keSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgIGNvbXB1dGVkOiBmYWxzZSwgb2JqZWN0OiBpaWZlQm9keSxcbiAgICAgICAgICAgIHByb3BlcnR5OiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGJvZHksIGJvZHksIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdjYWxsJyB9KVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIGFyZ3VtZW50czogW3RoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYm9keSwgYm9keSwgXCJUaGlzRXhwcmVzc2lvblwiKV1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGJvZHksIGJvZHksIFwiUmV0dXJuU3RhdGVtZW50XCIsIHsgYXJndW1lbnQ6IGlpZmVDYWxsIH0pO1xuICAgICAgfSxcblxuICAgICAgLy8gRS5nLiBNYXRoLnBvdygyLCAzKVxuXG4gICAgICBjcmVhdGVOb2RlTWVtYmVyQ2FsbDogZnVuY3Rpb24gKG5vZGUsIG9iamVjdCwgcHJvcGVydHksIGFyZ3MpIHtcbiAgICAgICAgdmFyIG9iaklkID0gdGhpcy5jcmVhdGVOb2RlRnJvbShub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBvYmplY3QgfSk7XG4gICAgICAgIHZhciBwcm9wSWQgPSB0aGlzLmNyZWF0ZU5vZGVGcm9tKG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IHByb3BlcnR5IH0pO1xuICAgICAgICB2YXIgbWVtYmVyID0gdGhpcy5jcmVhdGVOb2RlRnJvbShub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IG9iaklkLCBwcm9wZXJ0eTogcHJvcElkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgICAgIG5vZGUuY2FsbGVlID0gbWVtYmVyO1xuICAgICAgICBub2RlLmFyZ3VtZW50cyA9IGFyZ3M7XG4gICAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiQ2FsbEV4cHJlc3Npb25cIik7XG4gICAgICB9LFxuXG4gICAgICAvLyBvLnBcbiAgICAgIGNyZWF0ZU5vZGVNZW1iSWRzOiBmdW5jdGlvbihyLCBvLCBwKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgY29tcHV0ZWQ6IGZhbHNlLFxuICAgICAgICAgIG9iamVjdDogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBvIH0pLFxuICAgICAgICAgIHByb3BlcnR5OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IHAgfSlcbiAgICAgICAgfSlcbiAgICAgIH0sXG5cbiAgICAgIC8vIG9bcF1cbiAgICAgIGNyZWF0ZU5vZGVNZW1iSWRMaXQ6IGZ1bmN0aW9uKHIsIG8sIHApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICBjb21wdXRlZDogdHJ1ZSxcbiAgICAgICAgICBvYmplY3Q6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogbyB9KSxcbiAgICAgICAgICBwcm9wZXJ0eTogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogcCB9KVxuICAgICAgICB9KVxuICAgICAgfSxcblxuICAgICAgLy8gRS5nLiBweVJ1bnRpbWUub3BzLmFkZFxuXG4gICAgICBjcmVhdGVOb2RlT3BzQ2FsbGVlOiBmdW5jdGlvbiAobm9kZSwgZm5OYW1lKSB7XG4gICAgICAgIHZhciBydW50aW1lSWQgPSB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSB9KTtcbiAgICAgICAgdmFyIG9wc0lkID0gdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIm9wc1wiIH0pO1xuICAgICAgICB2YXIgYWRkSWQgPSB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IGZuTmFtZSB9KTtcbiAgICAgICAgdmFyIG9wc01lbWJlciA9IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lSWQsIHByb3BlcnR5OiBvcHNJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IG9wc01lbWJlciwgcHJvcGVydHk6IGFkZElkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgICB9LFxuXG4gICAgICAvLyB2YXIgX19wYXJhbXMgPSBhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIGFyZ3VtZW50c1swXS5mb3JtYWxzICYmIGFyZ3VtZW50c1swXS5rZXl3b3JkcyA/IGFyZ3VtZW50c1swXSA6IG51bGw7XG4gICAgICBjcmVhdGVOb2RlUGFyYW1zQ2hlY2s6IGZ1bmN0aW9uIChyLCBzKSB7XG4gICAgICAgIHZhciBfX3BhcmFtc0lkID0gdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnX19wYXJhbXMnICsgcyB9KTtcbiAgICAgICAgdmFyIGFyZ3VtZW50czAgPSB0aGlzLmNyZWF0ZU5vZGVNZW1iSWRMaXQociwgJ2FyZ3VtZW50cycsIDApO1xuICAgICAgICB2YXIgY2hlY2tzID0gdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIkNvbmRpdGlvbmFsRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgdGVzdDogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIkxvZ2ljYWxFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgIG9wZXJhdG9yOiAnJiYnLFxuICAgICAgICAgICAgbGVmdDogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIkxvZ2ljYWxFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgb3BlcmF0b3I6ICcmJicsXG4gICAgICAgICAgICAgIGxlZnQ6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJCaW5hcnlFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICBvcGVyYXRvcjogJz09PScsXG4gICAgICAgICAgICAgICAgbGVmdDogdGhpcy5jcmVhdGVOb2RlTWVtYklkcyhyLCAnYXJndW1lbnRzJywgJ2xlbmd0aCcpLFxuICAgICAgICAgICAgICAgIHJpZ2h0OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiAxIH0pXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICByaWdodDogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIk1lbWJlckV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICAgIGNvbXB1dGVkOiBmYWxzZSwgb2JqZWN0OiBhcmd1bWVudHMwLFxuICAgICAgICAgICAgICAgIHByb3BlcnR5OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdmb3JtYWxzJyB9KSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgcmlnaHQ6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgY29tcHV0ZWQ6IGZhbHNlLCBvYmplY3Q6IGFyZ3VtZW50czAsXG4gICAgICAgICAgICAgIHByb3BlcnR5OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdrZXl3b3JkcycgfSksXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNvbnNlcXVlbnQ6IGFyZ3VtZW50czAsXG4gICAgICAgICAgYWx0ZXJuYXRlOiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiBudWxsIH0pXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVHZW5lcmF0ZWRWYXJEZWNsRnJvbUlkKHIsIF9fcGFyYW1zSWQsIGNoZWNrcyk7XG4gICAgICB9LFxuXG4gICAgICAvLyBmdW5jdGlvbiBfX2dldFBhcmFtKHYsIGQpIHtcbiAgICAgIC8vICAgdmFyIHIgPSBkO1xuICAgICAgLy8gICBpZiAoX19wYXJhbXMpIHtcbiAgICAgIC8vICAgICBpZiAoX19mb3JtYWxzSW5kZXggPCBfX3BhcmFtcy5mb3JtYWxzLmxlbmd0aCkge1xuICAgICAgLy8gICAgICAgciA9IF9fcGFyYW1zLmZvcm1hbHNbX19mb3JtYWxzSW5kZXgrK107XG4gICAgICAvLyAgICAgfSBlbHNlIGlmICh2IGluIF9fcGFyYW1zLmtleXdvcmRzKSB7XG4gICAgICAvLyAgICAgICByID0gX19wYXJhbXMua2V5d29yZHNbdl07XG4gICAgICAvLyAgICAgICBkZWxldGUgX19wYXJhbXMua2V5d29yZHNbdl07XG4gICAgICAvLyAgICAgfVxuICAgICAgLy8gICB9IGVsc2UgaWYgKF9fZm9ybWFsc0luZGV4IDwgX19hcmdzLmxlbmd0aCkge1xuICAgICAgLy8gICAgIHIgPSBfX2FyZ3NbX19mb3JtYWxzSW5kZXgrK107XG4gICAgICAvLyAgIH1cbiAgICAgIC8vICAgcmV0dXJuIHI7XG4gICAgICAvLyB9XG4gICAgICBjcmVhdGVOb2RlR2V0UGFyYW1GbjogZnVuY3Rpb24gKHIsIHMpIHtcbiAgICAgICAgdmFyIGRJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ2QnIH0pO1xuICAgICAgICB2YXIgdklkID0gdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAndicgfSk7XG4gICAgICAgIHZhciBySWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdyJyB9KTtcbiAgICAgICAgdmFyIF9fZm9ybWFsc0luZGV4SWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdfX2Zvcm1hbHNJbmRleCcgKyBzIH0pO1xuICAgICAgICB2YXIgX19wYXJhbXMgPSAnX19wYXJhbXMnICsgcztcbiAgICAgICAgdmFyIF9fZ2V0UGFyYW0gPSAnX19nZXRQYXJhbScgKyBzO1xuICAgICAgICB2YXIgX19hcmdzID0gJ19fYXJncycgKyBzO1xuICAgICAgICB2YXIgX19wYXJhbXNGb3JtYWxzID0gdGhpcy5jcmVhdGVOb2RlTWVtYklkcyhyLCBfX3BhcmFtcywgJ2Zvcm1hbHMnKTtcbiAgICAgICAgdmFyIF9fcGFyYW1zS2V5d29yZHMgPSB0aGlzLmNyZWF0ZU5vZGVNZW1iSWRzKHIsIF9fcGFyYW1zLCAna2V5d29yZHMnKVxuICAgICAgICB2YXIgX19wYXJhbXNLZXl3b3Jkc1YgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IGNvbXB1dGVkOiB0cnVlLCBwcm9wZXJ0eTogdklkLCBvYmplY3Q6IF9fcGFyYW1zS2V5d29yZHMgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKHIsIHIsIFwiRnVuY3Rpb25EZWNsYXJhdGlvblwiLCB7XG4gICAgICAgICAgaWQ6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogX19nZXRQYXJhbSB9KSxcbiAgICAgICAgICBwYXJhbXM6IFt2SWQsIGRJZF0sXG4gICAgICAgICAgZGVmYXVsdHM6IFtdLFxuICAgICAgICAgIGJvZHk6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJCbG9ja1N0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICBib2R5OiBbdGhpcy5jcmVhdGVHZW5lcmF0ZWRWYXJEZWNsRnJvbUlkKHIsIHJJZCwgZElkKSxcbiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIklmU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgICAgICB0ZXN0OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IF9fcGFyYW1zIH0pLFxuICAgICAgICAgICAgICAgIGNvbnNlcXVlbnQ6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJCbG9ja1N0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICAgICAgICBib2R5OiBbdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIklmU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdGVzdDogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIkJpbmFyeUV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiAnPCcsIGxlZnQ6IF9fZm9ybWFsc0luZGV4SWQsXG4gICAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXB1dGVkOiBmYWxzZSwgb2JqZWN0OiBfX3BhcmFtc0Zvcm1hbHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eTogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnbGVuZ3RoJyB9KVxuICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICBjb25zZXF1ZW50OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiQmxvY2tTdGF0ZW1lbnRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IFt0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKHIsIHIsIFwiRXhwcmVzc2lvblN0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uOiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKHIsIHIsIFwiQXNzaWdubWVudEV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogJz0nLCBsZWZ0OiBySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcHV0ZWQ6IHRydWUsIG9iamVjdDogX19wYXJhbXNGb3JtYWxzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiVXBkYXRlRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogJysrJywgYXJndW1lbnQ6IF9fZm9ybWFsc0luZGV4SWQsIHByZWZpeDogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICB9KV1cbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgIGFsdGVybmF0ZTogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIklmU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICB0ZXN0OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiQmluYXJ5RXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogJ2luJywgbGVmdDogdklkLCByaWdodDogX19wYXJhbXNLZXl3b3JkcyxcbiAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICBjb25zZXF1ZW50OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiQmxvY2tTdGF0ZW1lbnRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogW3RoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4ociwgciwgXCJFeHByZXNzaW9uU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbjogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIkFzc2lnbm1lbnRFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogJz0nLCBsZWZ0OiBySWQsIHJpZ2h0OiBfX3BhcmFtc0tleXdvcmRzVlxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKHIsIHIsIFwiRXhwcmVzc2lvblN0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb246IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJVbmFyeUV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiAnZGVsZXRlJywgcHJlZml4OiB0cnVlLCBhcmd1bWVudDogX19wYXJhbXNLZXl3b3Jkc1ZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXVxuICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgIGFsdGVybmF0ZTogbnVsbFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgfSldXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgYWx0ZXJuYXRlOiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKHIsIHIsIFwiSWZTdGF0ZW1lbnRcIiwge1xuICAgICAgICAgICAgICAgICAgdGVzdDogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIkJpbmFyeUV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogJzwnLCBsZWZ0OiBfX2Zvcm1hbHNJbmRleElkLFxuICAgICAgICAgICAgICAgICAgICByaWdodDogdGhpcy5jcmVhdGVOb2RlTWVtYklkcyhyLCBfX2FyZ3MsICdsZW5ndGgnKSxcbiAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgY29uc2VxdWVudDogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIkJsb2NrU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgYm9keTogW3RoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4ociwgciwgXCJFeHByZXNzaW9uU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uOiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKHIsIHIsIFwiQXNzaWdubWVudEV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6ICc9JywgbGVmdDogcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4ociwgciwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcHV0ZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdDogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBfX2FyZ3MgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKHIsIHIsIFwiVXBkYXRlRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6ICcrKycsIGFyZ3VtZW50OiBfX2Zvcm1hbHNJbmRleElkLCBwcmVmaXg6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0pXVxuICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICBhbHRlcm5hdGU6IG51bGxcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIlJldHVyblN0YXRlbWVudFwiLCB7IGFyZ3VtZW50OiBySWQgfSldXG4gICAgICAgICAgfSksXG4gICAgICAgICAgcmVzdDogbnVsbCwgZ2VuZXJhdG9yOiBmYWxzZSwgZXhwcmVzc2lvbjogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9LFxuXG4gICAgICAvLyBFLmcuIHB5UnVudGltZS51dGlscy5hZGRcblxuICAgICAgY3JlYXRlTm9kZVJ1bnRpbWVDYWxsOiBmdW5jdGlvbiAociwgbW9kLCBmbiwgYXJncykge1xuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIkNhbGxFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICBjYWxsZWU6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgIGNvbXB1dGVkOiBmYWxzZSxcbiAgICAgICAgICAgIG9iamVjdDogdGhpcy5jcmVhdGVOb2RlTWVtYklkcyhyLCBvcHRpb25zLnJ1bnRpbWVQYXJhbU5hbWUsICBtb2QpLFxuICAgICAgICAgICAgcHJvcGVydHk6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogZm4gfSlcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBhcmd1bWVudHM6IGFyZ3NcbiAgICAgICAgfSk7XG4gICAgICB9LFxuXG4gICAgICAvLyBVc2VkIHRvIGNvbnZlcnQgJ2lkID0gaW5pdCcgdG8gJ3ZhciBpZCA9IGluaXQnXG5cbiAgICAgIGNyZWF0ZVZhckRlY2xGcm9tSWQ6IGZ1bmN0aW9uIChyZWZOb2RlLCBpZCwgaW5pdCkge1xuICAgICAgICB2YXIgZGVjbCA9IHN0YXJ0Tm9kZUZyb20ocmVmTm9kZSk7XG4gICAgICAgIGRlY2wuaWQgPSBpZDtcbiAgICAgICAgZGVjbC5pbml0ID0gaW5pdDtcbiAgICAgICAgdGhpcy5maW5pc2hOb2RlRnJvbShyZWZOb2RlLCBkZWNsLCBcIlZhcmlhYmxlRGVjbGFyYXRvclwiKTtcbiAgICAgICAgdmFyIGRlY2xEZWNsID0gc3RhcnROb2RlRnJvbShyZWZOb2RlKTtcbiAgICAgICAgZGVjbERlY2wua2luZCA9IFwidmFyXCI7XG4gICAgICAgIGRlY2xEZWNsLmRlY2xhcmF0aW9ucyA9IFtkZWNsXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZUZyb20ocmVmTm9kZSwgZGVjbERlY2wsIFwiVmFyaWFibGVEZWNsYXJhdGlvblwiKTtcbiAgICAgIH0sXG5cbiAgICAgIGNyZWF0ZUdlbmVyYXRlZFZhckRlY2xGcm9tSWQ6IGZ1bmN0aW9uIChyZWZOb2RlLCBpZCwgaW5pdCkge1xuICAgICAgICB2YXIgZGVjbCA9IHN0YXJ0Tm9kZUZyb20ocmVmTm9kZSk7XG4gICAgICAgIGRlY2wuaWQgPSBpZDtcbiAgICAgICAgZGVjbC5pbml0ID0gaW5pdDtcbiAgICAgICAgdGhpcy5maW5pc2hOb2RlRnJvbShyZWZOb2RlLCBkZWNsLCBcIlZhcmlhYmxlRGVjbGFyYXRvclwiKTtcbiAgICAgICAgdmFyIGRlY2xEZWNsID0gc3RhcnROb2RlRnJvbShyZWZOb2RlKTtcbiAgICAgICAgZGVjbERlY2wua2luZCA9IFwidmFyXCI7XG4gICAgICAgIGRlY2xEZWNsLmRlY2xhcmF0aW9ucyA9IFtkZWNsXTtcbiAgICAgICAgZGVjbERlY2wudXNlckNvZGUgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZUZyb20ocmVmTm9kZSwgZGVjbERlY2wsIFwiVmFyaWFibGVEZWNsYXJhdGlvblwiKTtcbiAgICAgIH0sXG5cbiAgICAgIGNyZWF0ZUNsYXNzOiBmdW5jdGlvbihjb250YWluZXIsIGN0b3JOb2RlLCBjbGFzc1BhcmFtcywgY2xhc3NCb2R5UmVmTm9kZSwgY2xhc3NCbG9jaykge1xuICAgICAgICAvLyBIZWxwZXIgdG8gaWRlbnRpZnkgY2xhc3MgbWV0aG9kcyB3aGljaCB3ZXJlIHBhcnNlZCBvbnRvIHRoZSBjbGFzcyBwcm90b3R5cGVcblxuICAgICAgICBmdW5jdGlvbiBnZXRQcm90b3R5cGUoc3RtdCkge1xuICAgICAgICAgIGlmIChzdG10LmV4cHJlc3Npb24gJiYgc3RtdC5leHByZXNzaW9uLmxlZnQgJiYgc3RtdC5leHByZXNzaW9uLmxlZnQub2JqZWN0ICYmXG4gICAgICAgICAgICBzdG10LmV4cHJlc3Npb24ubGVmdC5vYmplY3QucHJvcGVydHkgJiYgc3RtdC5leHByZXNzaW9uLmxlZnQub2JqZWN0LnByb3BlcnR5Lm5hbWUgPT09IFwicHJvdG90eXBlXCIpXG4gICAgICAgICAgICByZXR1cm4gc3RtdC5leHByZXNzaW9uLmxlZnQucHJvcGVydHkubmFtZTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFN0YXJ0IGJ1aWxkaW5nIGNsYXNzIGNvbnN0cnVjdG9yXG5cbiAgICAgICAgdmFyIGN0b3JCbG9jayA9IHN0YXJ0Tm9kZUZyb20oY2xhc3NCbG9jayk7XG4gICAgICAgIGN0b3JCbG9jay5ib2R5ID0gW107XG5cbiAgICAgICAgLy8gQWRkIHBhcmVudCBjbGFzcyBjb25zdHJ1Y3RvciBjYWxsXG5cbiAgICAgICAgaWYgKGNsYXNzUGFyYW1zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIHZhciBvYmpJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY2xhc3NCb2R5UmVmTm9kZSwgY2xhc3NCb2R5UmVmTm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogY2xhc3NQYXJhbXNbMF0ubmFtZSB9KTtcbiAgICAgICAgICB2YXIgcHJvcGVydHlJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY2xhc3NCb2R5UmVmTm9kZSwgY2xhc3NCb2R5UmVmTm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJjYWxsXCIgfSk7XG4gICAgICAgICAgdmFyIGNhbGxlZU1lbWJlciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY2xhc3NCb2R5UmVmTm9kZSwgY2xhc3NCb2R5UmVmTm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBvYmpJZCwgcHJvcGVydHk6IHByb3BlcnR5SWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgICAgICB2YXIgdGhpc0V4cHIgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGNsYXNzQm9keVJlZk5vZGUsIGNsYXNzQm9keVJlZk5vZGUsIFwiVGhpc0V4cHJlc3Npb25cIik7XG4gICAgICAgICAgdmFyIGNhbGxFeHByID0gdGhpcy5jcmVhdGVOb2RlU3BhbihjbGFzc0JvZHlSZWZOb2RlLCBjbGFzc0JvZHlSZWZOb2RlLCBcIkNhbGxFeHByZXNzaW9uXCIsIHsgY2FsbGVlOiBjYWxsZWVNZW1iZXIsIGFyZ3VtZW50czogW3RoaXNFeHByXSB9KTtcbiAgICAgICAgICB2YXIgc3VwZXJFeHByID0gdGhpcy5jcmVhdGVOb2RlU3BhbihjbGFzc0JvZHlSZWZOb2RlLCBjbGFzc0JvZHlSZWZOb2RlLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIiwgeyBleHByZXNzaW9uOiBjYWxsRXhwciB9KTtcbiAgICAgICAgICBjdG9yQmxvY2suYm9keS5wdXNoKHN1cGVyRXhwcik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgbm9uLWZ1bmN0aW9uIHN0YXRlbWVudHMgYW5kIGNvbnRlbnRzIG9mIHNwZWNpYWwgJ19faW5pdF9fJyBtZXRob2RcblxuICAgICAgICBmb3IgKHZhciBpIGluIGNsYXNzQmxvY2suYm9keSkge1xuICAgICAgICAgIHZhciBzdG10ID0gY2xhc3NCbG9jay5ib2R5W2ldO1xuICAgICAgICAgIHZhciBwcm90b3R5cGUgPSBnZXRQcm90b3R5cGUoc3RtdCk7XG4gICAgICAgICAgaWYgKCFwcm90b3R5cGUpIHtcbiAgICAgICAgICAgIGN0b3JCbG9jay5ib2R5LnB1c2goc3RtdCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYgKHByb3RvdHlwZSA9PT0gXCJfX2luaXRfX1wiKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBqIGluIHN0bXQuZXhwcmVzc2lvbi5yaWdodC5ib2R5LmJvZHkpXG4gICAgICAgICAgICAgIGN0b3JCbG9jay5ib2R5LnB1c2goc3RtdC5leHByZXNzaW9uLnJpZ2h0LmJvZHkuYm9keVtqXSk7XG4gICAgICAgICAgICBjdG9yTm9kZS5wYXJhbXMgPSBzdG10LmV4cHJlc3Npb24ucmlnaHQucGFyYW1zO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpbmlzaCBjbGFzcyBjb25zdHJ1Y3RvclxuXG4gICAgICAgIGN0b3JOb2RlLmJvZHkgPSBmaW5pc2hOb2RlKGN0b3JCbG9jaywgXCJCbG9ja1N0YXRlbWVudFwiKTtcbiAgICAgICAgZmluaXNoTm9kZShjdG9yTm9kZSwgXCJGdW5jdGlvbkRlY2xhcmF0aW9uXCIpO1xuICAgICAgICBjb250YWluZXIuYm9keS5wdXNoKGN0b3JOb2RlKTtcblxuICAgICAgICAvLyBBZGQgaW5oZXJpdGFuY2UgdmlhICdNeUNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUGFyZW50Q2xhc3MucHJvdG90eXBlKSdcblxuICAgICAgICBpZiAoY2xhc3NQYXJhbXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgdmFyIGNoaWxkQ2xhc3NJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY3Rvck5vZGUsIGN0b3JOb2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBjdG9yTm9kZS5pZC5uYW1lIH0pO1xuICAgICAgICAgIHZhciBjaGlsZFByb3RvdHlwZUlkID0gdGhpcy5jcmVhdGVOb2RlU3BhbihjdG9yTm9kZSwgY3Rvck5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwicHJvdG90eXBlXCIgfSk7XG4gICAgICAgICAgdmFyIGNoaWxkUHJvdG90eXBlTWVtYmVyID0gdGhpcy5jcmVhdGVOb2RlU3BhbihjdG9yTm9kZSwgY3Rvck5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogY2hpbGRDbGFzc0lkLCBwcm9wZXJ0eTogY2hpbGRQcm90b3R5cGVJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgICAgIHZhciBwYXJlbnRDbGFzc0lkID0gdGhpcy5jcmVhdGVOb2RlU3BhbihjdG9yTm9kZSwgY3Rvck5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IGNsYXNzUGFyYW1zWzBdLm5hbWUgfSk7XG4gICAgICAgICAgdmFyIHBhcmVudFByb3RvdHlwZUlkID0gdGhpcy5jcmVhdGVOb2RlU3BhbihjdG9yTm9kZSwgY3Rvck5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwicHJvdG90eXBlXCIgfSk7XG4gICAgICAgICAgdmFyIHBhcmVudFByb3RvdHlwZU1lbWJlciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY3Rvck5vZGUsIGN0b3JOb2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHBhcmVudENsYXNzSWQsIHByb3BlcnR5OiBwYXJlbnRQcm90b3R5cGVJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgICAgIHZhciBvYmpDbGFzc0lkID0gdGhpcy5jcmVhdGVOb2RlU3BhbihjdG9yTm9kZSwgY3Rvck5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiT2JqZWN0XCIgfSk7XG4gICAgICAgICAgdmFyIG9iakNyZWF0ZUlkID0gdGhpcy5jcmVhdGVOb2RlU3BhbihjdG9yTm9kZSwgY3Rvck5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiY3JlYXRlXCIgfSk7XG4gICAgICAgICAgdmFyIG9ialByb3BlcnR5TWVtYmVyID0gdGhpcy5jcmVhdGVOb2RlU3BhbihjdG9yTm9kZSwgY3Rvck5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogb2JqQ2xhc3NJZCwgcHJvcGVydHk6IG9iakNyZWF0ZUlkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgICAgICAgdmFyIGNhbGxFeHByID0gdGhpcy5jcmVhdGVOb2RlU3BhbihjdG9yTm9kZSwgY3Rvck5vZGUsIFwiQ2FsbEV4cHJlc3Npb25cIiwgeyBjYWxsZWU6IG9ialByb3BlcnR5TWVtYmVyLCBhcmd1bWVudHM6IFtwYXJlbnRQcm90b3R5cGVNZW1iZXJdIH0pO1xuICAgICAgICAgIHZhciBhc3NpZ25FeHByID0gdGhpcy5jcmVhdGVOb2RlU3BhbihjdG9yTm9kZSwgY3Rvck5vZGUsIFwiQXNzaWdubWVudEV4cHJlc3Npb25cIiwgeyBsZWZ0OiBjaGlsZFByb3RvdHlwZU1lbWJlciwgb3BlcmF0b3I6IFwiPVwiLCByaWdodDogY2FsbEV4cHIgfSk7XG4gICAgICAgICAgdmFyIGluaGVyaXRhbmNlRXhwciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY3Rvck5vZGUsIGN0b3JOb2RlLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIiwgeyBleHByZXNzaW9uOiBhc3NpZ25FeHByIH0pO1xuICAgICAgICAgIGNvbnRhaW5lci5ib2R5LnB1c2goaW5oZXJpdGFuY2VFeHByKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkZCBjbGFzcyBtZXRob2RzLCB3aGljaCBhcmUgYWxyZWFkeSBwcm90b3R5cGUgYXNzaWdubWVudHNcblxuICAgICAgICBmb3IgKHZhciBpIGluIGNsYXNzQmxvY2suYm9keSkge1xuICAgICAgICAgIHZhciBzdG10ID0gY2xhc3NCbG9jay5ib2R5W2ldO1xuICAgICAgICAgIHZhciBwcm90b3R5cGUgPSBnZXRQcm90b3R5cGUoc3RtdCk7XG4gICAgICAgICAgaWYgKHByb3RvdHlwZSAmJiBwcm90b3R5cGUgIT09IFwiX19pbml0X19cIilcbiAgICAgICAgICAgIGNvbnRhaW5lci5ib2R5LnB1c2goc3RtdCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmluaXNoTm9kZShjb250YWluZXIsIFwiQmxvY2tTdGF0ZW1lbnRcIik7XG4gICAgICB9LFxuXG4gICAgICAvLyBDcmVhdGUgZm9yIGxvb3BcbiAgICAgIC8vIFxuICAgICAgLy8gUHJvYmxlbTpcbiAgICAgIC8vIDEuIEphdmFTY3JpcHQgZm9yL2luIGxvb3AgaXRlcmF0ZXMgb24gcHJvcGVydGllcywgd2hpY2ggYXJlIHRoZSBpbmRleGVzIGZvciBhbiBBcnJheVxuICAgICAgLy8gICAgUHl0aG9uIGl0ZXJhdGVzIG9uIHRoZSBsaXN0IGl0ZW1zIHRoZW1zZWx2ZXMsIG5vdCBpbmRleGVzXG4gICAgICAvLyAyLiBKYXZhU2NyaXB0IGZvci9pbiBkb2VzIG5vdCBuZWNlc3NhcmlseSBpdGVyYXRlIGluIG9yZGVyXG4gICAgICAvLyBTb2x1dGlvbjpcbiAgICAgIC8vIEdlbmVyYXRlIGV4dHJhIEFTVCB0byBkbyB0aGUgcmlnaHQgdGhpbmcgYXQgcnVudGltZVxuICAgICAgLy8gSmF2YVNjcmlwdCBmb3IvaW4gaXMgdXNlZCBmb3IgZGljdGlvbmFyaWVzXG4gICAgICAvLyBJZiBpdGVyYXRpbmcgdGhyb3VnaCBhbiBvcmRlcmVkIHNlcXVlbmNlLCByZXR1cm4gc29tZXRoaW5nIGxpa2U6IFxuICAgICAgLy8geyB2YXIgX19yaWdodCA9IHJpZ2h0OyBcbiAgICAgIC8vICAgIGlmIChfX3JpZ2h0IGluc3RhbmNlb2YgQXJyYXkpIHsgXG4gICAgICAvLyAgICAgIGZvcih2YXIgX19pbmRleD0wOyBfX2luZGV4IDwgX19yaWdodC5sZW5ndGg7IF9faW5kZXgrKykge1xuICAgICAgLy8gICAgICAgIGkgPSBfX3JpZ2h0W19faW5kZXhdOyBcbiAgICAgIC8vICAgICAgICAuLi5cbiAgICAgIC8vICAgICAgfSBcbiAgICAgIC8vICAgIH0gZWxzZSB7IFxuICAgICAgLy8gICAgICBmb3IoaSBpbiBfX3JpZ2h0KXsuLi59IFxuICAgICAgLy8gICAgfVxuICAgICAgLy8gfVxuICAgICAgLy8gV2hlbiB0aGUgbG9vcCB0YXJnZXQgaXMgYSBUdXBsZSwgaXQgaXMgdW5wYWNrZWQgaW50byBlYWNoIGZvciBib2R5IGluIHRoZSBleGFtcGxlIGFib3ZlLlxuICAgICAgLy8gRS5nLiAnZm9yIGssIHYgaW4gX19yaWdodDogdG90YWwgKz0gdicgYmVjb21lczpcbiAgICAgIC8vIGZvciAodmFyIF9fdG1wIGluIF9fcmlnaHQpIHtcbiAgICAgIC8vICAgIGsgPSBfX3RtcFswXTtcbiAgICAgIC8vICAgIHYgPSBfX3RtcFsxXTtcbiAgICAgIC8vICAgIHRvdGFsICs9IHY7XG4gICAgICAvLyB9XG5cbiAgICAgIC8vIFRPRE86IGZvci9pbiBvbiBhIHN0cmluZyBzaG91bGQgZ28gdGhyb3VnaCBpdGVtcywgbm90IGluZGV4ZXMuIFN0cmluZyBvYmogYW5kIHN0cmluZyBsaXRlcmFsLlxuXG4gICAgICBjcmVhdGVGb3I6IGZ1bmN0aW9uIChub2RlLCBpbml0LCB0dXBsZUFyZ3MsIHJpZ2h0LCBib2R5KSB7XG4gICAgICAgIHZhciBmb3JPcmRlcmVkQm9keSA9IGJvZHk7XG4gICAgICAgIHZhciBmb3JJbkJvZHkgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGZvck9yZGVyZWRCb2R5KSk7XG5cbiAgICAgICAgdmFyIHRtcFZhclN1ZmZpeCA9IG5ld0FzdElkQ291bnQrKztcblxuICAgICAgICB2YXIgYXJyYXlJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJBcnJheVwiIH0pO1xuICAgICAgICB2YXIgbGVuZ3RoSWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGluaXQsIGluaXQsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwibGVuZ3RoXCIgfSk7XG4gICAgICAgIHZhciB6ZXJvTGl0ID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihpbml0LCBpbml0LCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogMCB9KTtcblxuICAgICAgICAvLyB2YXIgX19yaWdodE4gPSByaWdodFxuXG4gICAgICAgIHZhciByaWdodElkID0gdGhpcy5jcmVhdGVOb2RlU3BhbihyaWdodCwgcmlnaHQsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiX19maWxiZXJ0UmlnaHRcIiArIHRtcFZhclN1ZmZpeCB9KTtcbiAgICAgICAgdmFyIHJpZ2h0QXNzaWduID0gdGhpcy5jcmVhdGVWYXJEZWNsRnJvbUlkKHJpZ2h0LCByaWdodElkLCByaWdodCk7XG5cbiAgICAgICAgLy8gZm9yKDs7KSBhbmQgZm9yKGluKSBsb29wc1xuXG4gICAgICAgIHZhciBmb3JSaWdodElkID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihpbml0LCBpbml0LCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIl9fZmlsYmVydFJpZ2h0XCIgKyB0bXBWYXJTdWZmaXggfSk7XG5cbiAgICAgICAgLy8gZm9yICh2YXIgX19pbmRleE47IF9faW5kZXhOIDwgX19yaWdodE4ubGVuZ3RoOyArK19faW5kZXhOKVxuXG4gICAgICAgIHZhciBmb3JPcmRlcmVkSW5kZXhJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oaW5pdCwgaW5pdCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJfX2ZpbGJlcnRJbmRleFwiICsgdG1wVmFyU3VmZml4IH0pO1xuICAgICAgICB2YXIgZm9yT3JkZXJlZEluZGV4RGVjbHIgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGluaXQsIGluaXQsIFwiVmFyaWFibGVEZWNsYXJhdG9yXCIsIHsgaWQ6IGZvck9yZGVyZWRJbmRleElkLCBpbml0OiB6ZXJvTGl0IH0pO1xuICAgICAgICB2YXIgZm9yT3JkZXJlZEluZGV4RGVjbG4gPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGluaXQsIGluaXQsIFwiVmFyaWFibGVEZWNsYXJhdGlvblwiLCB7IGRlY2xhcmF0aW9uczogW2Zvck9yZGVyZWRJbmRleERlY2xyXSwga2luZDogXCJ2YXJcIiB9KTtcbiAgICAgICAgdmFyIGZvck9yZGVyZWRUZXN0TWVtYmVyID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihpbml0LCBpbml0LCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IGZvclJpZ2h0SWQsIHByb3BlcnR5OiBsZW5ndGhJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgICB2YXIgZm9yT3JkZXJlZFRlc3RCaW5vcCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oaW5pdCwgaW5pdCwgXCJCaW5hcnlFeHByZXNzaW9uXCIsIHsgbGVmdDogZm9yT3JkZXJlZEluZGV4SWQsIG9wZXJhdG9yOiBcIjxcIiwgcmlnaHQ6IGZvck9yZGVyZWRUZXN0TWVtYmVyIH0pO1xuICAgICAgICB2YXIgZm9yT3JkZXJlZFVwZGF0ZSA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oaW5pdCwgaW5pdCwgXCJVcGRhdGVFeHByZXNzaW9uXCIsIHsgb3BlcmF0b3I6IFwiKytcIiwgcHJlZml4OiB0cnVlLCBhcmd1bWVudDogZm9yT3JkZXJlZEluZGV4SWQgfSk7XG4gICAgICAgIHZhciBmb3JPcmRlcmVkTWVtYmVyID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihpbml0LCBpbml0LCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IGZvclJpZ2h0SWQsIHByb3BlcnR5OiBmb3JPcmRlcmVkSW5kZXhJZCwgY29tcHV0ZWQ6IHRydWUgfSk7XG5cbiAgICAgICAgaWYgKHR1cGxlQXJncykge1xuICAgICAgICAgIHZhciB2YXJTdG10cyA9IHVucGFja1R1cGxlKHR1cGxlQXJncywgZm9yT3JkZXJlZE1lbWJlcik7XG4gICAgICAgICAgZm9yICh2YXIgaSA9IHZhclN0bXRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBmb3JPcmRlcmVkQm9keS5ib2R5LnVuc2hpZnQodmFyU3RtdHNbaV0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGlmIChpbml0LnR5cGUgPT09IFwiSWRlbnRpZmllclwiICYmICFzY29wZS5leGlzdHMoaW5pdC5uYW1lKSkge1xuICAgICAgICAgICAgc2NvcGUuYWRkVmFyKGluaXQubmFtZSk7XG4gICAgICAgICAgICBmb3JPcmRlcmVkQm9keS5ib2R5LnVuc2hpZnQodGhpcy5jcmVhdGVWYXJEZWNsRnJvbUlkKGluaXQsIGluaXQsIGZvck9yZGVyZWRNZW1iZXIpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGZvck9yZGVyZWRJbml0ID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihpbml0LCBpbml0LCBcIkFzc2lnbm1lbnRFeHByZXNzaW9uXCIsIHsgb3BlcmF0b3I6IFwiPVwiLCBsZWZ0OiBpbml0LCByaWdodDogZm9yT3JkZXJlZE1lbWJlciB9KTtcbiAgICAgICAgICAgIHZhciBmb3JPcmRlcmVkSW5pdFN0bXQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGluaXQsIGluaXQsIFwiRXhwcmVzc2lvblN0YXRlbWVudFwiLCB7IGV4cHJlc3Npb246IGZvck9yZGVyZWRJbml0IH0pO1xuICAgICAgICAgICAgZm9yT3JkZXJlZEJvZHkuYm9keS51bnNoaWZ0KGZvck9yZGVyZWRJbml0U3RtdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGZvck9yZGVyZWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiRm9yU3RhdGVtZW50XCIsIHsgaW5pdDogZm9yT3JkZXJlZEluZGV4RGVjbG4sIHRlc3Q6IGZvck9yZGVyZWRUZXN0Qmlub3AsIHVwZGF0ZTogZm9yT3JkZXJlZFVwZGF0ZSwgYm9keTogZm9yT3JkZXJlZEJvZHkgfSk7XG4gICAgICAgIHZhciBmb3JPcmRlcmVkQmxvY2sgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiQmxvY2tTdGF0ZW1lbnRcIiwgeyBib2R5OiBbZm9yT3JkZXJlZF0gfSk7XG5cbiAgICAgICAgLy8gZm9yIChpbml0IGluIF9fcmlnaHROKVxuXG4gICAgICAgIHZhciBmb3JJbkxlZnQgPSBpbml0O1xuICAgICAgICBpZiAodHVwbGVBcmdzKSB7XG4gICAgICAgICAgdmFyIHZhclN0bXRzID0gdW5wYWNrVHVwbGUodHVwbGVBcmdzLCByaWdodCk7XG4gICAgICAgICAgZm9ySW5MZWZ0ID0gdmFyU3RtdHNbMF07XG4gICAgICAgICAgZm9yICh2YXIgaSA9IHZhclN0bXRzLmxlbmd0aCAtIDE7IGkgPiAwOyBpLS0pIGZvckluQm9keS5ib2R5LnVuc2hpZnQodmFyU3RtdHNbaV0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGluaXQudHlwZSA9PT0gXCJJZGVudGlmaWVyXCIgJiYgIXNjb3BlLmV4aXN0cyhpbml0Lm5hbWUpKSB7XG4gICAgICAgICAgc2NvcGUuYWRkVmFyKGluaXQubmFtZSk7XG4gICAgICAgICAgZm9ySW5MZWZ0ID0gdGhpcy5jcmVhdGVWYXJEZWNsRnJvbUlkKGluaXQsIGluaXQsIG51bGwpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBmb3JJbiA9IHRoaXMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJGb3JJblN0YXRlbWVudFwiLCB7IGxlZnQ6IGZvckluTGVmdCwgcmlnaHQ6IGZvclJpZ2h0SWQsIGJvZHk6IGZvckluQm9keSB9KTtcbiAgICAgICAgdmFyIGZvckluQmxvY2sgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiQmxvY2tTdGF0ZW1lbnRcIiwgeyBib2R5OiBbZm9ySW5dIH0pO1xuXG4gICAgICAgIC8vIGlmIG9yZGVyZWQgc2VxdWVuY2UgdGhlbiBmb3JPcmRlcmVkIGVsc2UgZm9ySW5cblxuICAgICAgICB2YXIgaWZSaWdodElkID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIl9fZmlsYmVydFJpZ2h0XCIgKyB0bXBWYXJTdWZmaXggfSk7XG4gICAgICAgIHZhciBpZlRlc3QgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiQmluYXJ5RXhwcmVzc2lvblwiLCB7IGxlZnQ6IGlmUmlnaHRJZCwgb3BlcmF0b3I6IFwiaW5zdGFuY2VvZlwiLCByaWdodDogYXJyYXlJZCB9KTtcbiAgICAgICAgdmFyIGlmU3RtdCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZlN0YXRlbWVudFwiLCB7IHRlc3Q6IGlmVGVzdCwgY29uc2VxdWVudDogZm9yT3JkZXJlZEJsb2NrLCBhbHRlcm5hdGU6IGZvckluQmxvY2sgfSk7XG5cbiAgICAgICAgbm9kZS5ib2R5ID0gW3JpZ2h0QXNzaWduLCBpZlN0bXRdO1xuXG4gICAgICAgIHJldHVybiBub2RlO1xuICAgICAgfSxcblxuICAgICAgLy8gZXhwciA9PiBfX3RtcExpc3QucHVzaChleHByKTtcblxuICAgICAgY3JlYXRlTGlzdENvbXBQdXNoOiBmdW5jdGlvbiAoZXhwciwgdG1wVmFyU3VmZml4KSB7XG4gICAgICAgIHZhciBleHByUHVzaFRtcExpc3RJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oZXhwciwgZXhwciwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJfX3RtcExpc3RcIiArIHRtcFZhclN1ZmZpeCB9KTtcbiAgICAgICAgdmFyIGV4cHJQdXNoSWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGV4cHIsIGV4cHIsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwicHVzaFwiIH0pO1xuICAgICAgICB2YXIgZXhwck1lbWJlciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oZXhwciwgZXhwciwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBleHByUHVzaFRtcExpc3RJZCwgcHJvcGVydHk6IGV4cHJQdXNoSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgICAgdmFyIGV4cHJDYWxsID0gdGhpcy5jcmVhdGVOb2RlU3BhbihleHByLCBleHByLCBcIkNhbGxFeHByZXNzaW9uXCIsIHsgY2FsbGVlOiBleHByTWVtYmVyLCBhcmd1bWVudHM6IFtleHByXSB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlTm9kZVNwYW4oZXhwciwgZXhwciwgXCJFeHByZXNzaW9uU3RhdGVtZW50XCIsIHsgZXhwcmVzc2lvbjogZXhwckNhbGwgfSk7XG4gICAgICB9LFxuXG4gICAgICAvLyAgKGZ1bmN0aW9uKCkge1xuICAgICAgLy8gICAgdmFyIF9saXN0ID0gW107XG4gICAgICAvLyAgICAuLi5cbiAgICAgIC8vICAgIGJvZHlcbiAgICAgIC8vICAgIHJldHVybiBfbGlzdDtcbiAgICAgIC8vICB9KCkpO1xuXG4gICAgICBjcmVhdGVMaXN0Q29tcElpZmU6IGZ1bmN0aW9uIChub2RlLCBib2R5LCB0bXBWYXJTdWZmaXgpIHtcbiAgICAgICAgdmFyIGlpZmVSdW50aW1lSWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSB9KTtcbiAgICAgICAgdmFyIGlpZmVPYmplY3RzSWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwib2JqZWN0c1wiIH0pO1xuICAgICAgICB2YXIgaWlmZU9iak1lbWJlciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBpaWZlUnVudGltZUlkLCBwcm9wZXJ0eTogaWlmZU9iamVjdHNJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgICB2YXIgaWlmZUxpc3RJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJsaXN0XCIgfSk7XG4gICAgICAgIHZhciBpaWZlTGlzdE1lbWJlciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBpaWZlT2JqTWVtYmVyLCBwcm9wZXJ0eTogaWlmZUxpc3RJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgICB2YXIgaWlmZU5ld0V4cHIgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTmV3RXhwcmVzc2lvblwiLCB7IGNhbGxlZTogaWlmZUxpc3RNZW1iZXIsIGFyZ3VtZW50czogW10gfSk7XG4gICAgICAgIHZhciBpaWZlTGlzdElkID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIl9fdG1wTGlzdFwiICsgdG1wVmFyU3VmZml4IH0pO1xuICAgICAgICB2YXIgaWlmZUxpc3REZWNsID0gdGhpcy5jcmVhdGVWYXJEZWNsRnJvbUlkKG5vZGUsIGlpZmVMaXN0SWQsIGlpZmVOZXdFeHByKTtcblxuICAgICAgICB2YXIgaWlmZVJldHVybkxpc3RJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJfX3RtcExpc3RcIiArIHRtcFZhclN1ZmZpeCB9KTtcbiAgICAgICAgdmFyIGlpZmVSZXR1cm4gPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiUmV0dXJuU3RhdGVtZW50XCIsIHsgYXJndW1lbnQ6IGlpZmVSZXR1cm5MaXN0SWQgfSk7XG5cbiAgICAgICAgdmFyIGlpZmVCbG9jayA9IHRoaXMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJCbG9ja1N0YXRlbWVudFwiLCB7IGJvZHk6IFtpaWZlTGlzdERlY2wsIGJvZHksIGlpZmVSZXR1cm5dIH0pO1xuICAgICAgICB2YXIgZm5FeHByID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkZ1bmN0aW9uRXhwcmVzc2lvblwiLCB7IHBhcmFtczogW10sIGRlZmF1bHRzOiBbXSwgYm9keTogaWlmZUJsb2NrLCBnZW5lcmF0b3I6IGZhbHNlLCBleHByZXNzaW9uOiBmYWxzZSB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkNhbGxFeHByZXNzaW9uXCIsIHsgY2FsbGVlOiBmbkV4cHIsIGFyZ3VtZW50czogW10gfSk7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICAvLyBQcmVkaWNhdGUgdGhhdCB0ZXN0cyB3aGV0aGVyIHRoZSBuZXh0IHRva2VuIGlzIG9mIHRoZSBnaXZlblxuICAvLyB0eXBlLCBhbmQgaWYgeWVzLCBjb25zdW1lcyBpdCBhcyBhIHNpZGUgZWZmZWN0LlxuXG4gIGZ1bmN0aW9uIGVhdCh0eXBlKSB7XG4gICAgaWYgKHRva1R5cGUgPT09IHR5cGUpIHtcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8vIEV4cGVjdCBhIHRva2VuIG9mIGEgZ2l2ZW4gdHlwZS4gSWYgZm91bmQsIGNvbnN1bWUgaXQsIG90aGVyd2lzZSxcbiAgLy8gcmFpc2UgYW4gdW5leHBlY3RlZCB0b2tlbiBlcnJvci5cblxuICBmdW5jdGlvbiBleHBlY3QodHlwZSkge1xuICAgIGlmICh0b2tUeXBlID09PSB0eXBlKSBuZXh0KCk7XG4gICAgZWxzZSB1bmV4cGVjdGVkKCk7XG4gIH1cblxuICAvLyBSYWlzZSBhbiB1bmV4cGVjdGVkIHRva2VuIGVycm9yLlxuXG4gIGZ1bmN0aW9uIHVuZXhwZWN0ZWQoKSB7XG4gICAgcmFpc2UodG9rU3RhcnQsIFwiVW5leHBlY3RlZCB0b2tlblwiKTtcbiAgfVxuXG4gIC8vIFZlcmlmeSB0aGF0IGEgbm9kZSBpcyBhbiBsdmFsIC0gc29tZXRoaW5nIHRoYXQgY2FuIGJlIGFzc2lnbmVkXG4gIC8vIHRvLlxuXG4gIGZ1bmN0aW9uIGNoZWNrTFZhbChleHByKSB7XG4gICAgaWYgKGV4cHIudHlwZSAhPT0gXCJJZGVudGlmaWVyXCIgJiYgZXhwci50eXBlICE9PSBcIk1lbWJlckV4cHJlc3Npb25cIilcbiAgICAgIHJhaXNlKGV4cHIuc3RhcnQsIFwiQXNzaWduaW5nIHRvIHJ2YWx1ZVwiKTtcbiAgICBpZiAoc3RyaWN0ICYmIGV4cHIudHlwZSA9PT0gXCJJZGVudGlmaWVyXCIgJiYgaXNTdHJpY3RCYWRJZFdvcmQoZXhwci5uYW1lKSlcbiAgICAgIHJhaXNlKGV4cHIuc3RhcnQsIFwiQXNzaWduaW5nIHRvIFwiICsgZXhwci5uYW1lICsgXCIgaW4gc3RyaWN0IG1vZGVcIik7XG4gIH1cblxuICAvLyBHZXQgYXJncyBmb3IgYSBuZXcgdHVwbGUgZXhwcmVzc2lvblxuXG4gIGZ1bmN0aW9uIGdldFR1cGxlQXJncyhleHByKSB7XG4gICAgaWYgKGV4cHIuY2FsbGVlICYmIGV4cHIuY2FsbGVlLm9iamVjdCAmJiBleHByLmNhbGxlZS5vYmplY3Qub2JqZWN0ICYmXG4gICAgICBleHByLmNhbGxlZS5vYmplY3Qub2JqZWN0Lm5hbWUgPT09IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSAmJlxuICAgICAgZXhwci5jYWxsZWUucHJvcGVydHkgJiYgZXhwci5jYWxsZWUucHJvcGVydHkubmFtZSA9PT0gXCJ0dXBsZVwiKVxuICAgICAgcmV0dXJuIGV4cHIuYXJndW1lbnRzO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLy8gVW5wYWNrIGFuIGx2YWx1ZSB0dXBsZSBpbnRvIGluZGl2dWFsIHZhcmlhYmxlIGFzc2lnbm1lbnRzXG4gIC8vICdhcmcwLCBhcmcxID0gcmlnaHQnIGJlY29tZXM6XG4gIC8vIHZhciB0bXAgPSByaWdodFxuICAvLyBhcmcwID0gdG1wWzBdXG4gIC8vIGFyZzEgPSB0bXBbMV1cbiAgLy8gLi4uXG5cbiAgZnVuY3Rpb24gdW5wYWNrVHVwbGUodHVwbGVBcmdzLCByaWdodCkge1xuICAgIGlmICghdHVwbGVBcmdzIHx8IHR1cGxlQXJncy5sZW5ndGggPCAxKSB1bmV4cGVjdGVkKCk7XG5cbiAgICB2YXIgdmFyU3RtdHMgPSBbXTtcblxuICAgIC8vIHZhciB0bXAgPSByaWdodFxuXG4gICAgdmFyIHRtcElkID0gbmMuY3JlYXRlTm9kZVNwYW4ocmlnaHQsIHJpZ2h0LCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIl9fZmlsYmVydFRtcFwiICsgbmV3QXN0SWRDb3VudCsrIH0pO1xuICAgIHZhciB0bXBEZWNsID0gbmMuY3JlYXRlVmFyRGVjbEZyb21JZChyaWdodCwgdG1wSWQsIHJpZ2h0KTtcbiAgICB2YXJTdG10cy5wdXNoKHRtcERlY2wpO1xuXG4gICAgLy8gYXJnTiA9IHRtcFtOXVxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0dXBsZUFyZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBsdmFsID0gdHVwbGVBcmdzW2ldO1xuICAgICAgdmFyIHN1YlR1cGxlQXJncyA9IGdldFR1cGxlQXJncyhsdmFsKTtcbiAgICAgIGlmIChzdWJUdXBsZUFyZ3MpIHtcbiAgICAgICAgdmFyIHN1YkxpdCA9IG5jLmNyZWF0ZU5vZGVTcGFuKHJpZ2h0LCByaWdodCwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IGkgfSk7XG4gICAgICAgIHZhciBzdWJSaWdodCA9IG5jLmNyZWF0ZU5vZGVTcGFuKHJpZ2h0LCByaWdodCwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiB0bXBJZCwgcHJvcGVydHk6IHN1YkxpdCwgY29tcHV0ZWQ6IHRydWUgfSk7XG4gICAgICAgIHZhciBzdWJTdG10cyA9IHVucGFja1R1cGxlKHN1YlR1cGxlQXJncywgc3ViUmlnaHQpO1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHN1YlN0bXRzLmxlbmd0aDsgaisrKSB2YXJTdG10cy5wdXNoKHN1YlN0bXRzW2pdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNoZWNrTFZhbChsdmFsKTtcbiAgICAgICAgdmFyIGluZGV4SWQgPSBuYy5jcmVhdGVOb2RlU3BhbihyaWdodCwgcmlnaHQsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiBpIH0pO1xuICAgICAgICB2YXIgaW5pdCA9IG5jLmNyZWF0ZU5vZGVTcGFuKHJpZ2h0LCByaWdodCwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiB0bXBJZCwgcHJvcGVydHk6IGluZGV4SWQsIGNvbXB1dGVkOiB0cnVlIH0pO1xuICAgICAgICBpZiAobHZhbC50eXBlID09PSBcIklkZW50aWZpZXJcIiAmJiAhc2NvcGUuZXhpc3RzKGx2YWwubmFtZSkpIHtcbiAgICAgICAgICBzY29wZS5hZGRWYXIobHZhbC5uYW1lKTtcbiAgICAgICAgICB2YXIgdmFyRGVjbCA9IG5jLmNyZWF0ZVZhckRlY2xGcm9tSWQobHZhbCwgbHZhbCwgaW5pdCk7XG4gICAgICAgICAgdmFyU3RtdHMucHVzaCh2YXJEZWNsKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZUZyb20obHZhbCk7XG4gICAgICAgICAgbm9kZS5sZWZ0ID0gbHZhbDtcbiAgICAgICAgICBub2RlLm9wZXJhdG9yID0gXCI9XCI7XG4gICAgICAgICAgbm9kZS5yaWdodCA9IGluaXQ7XG4gICAgICAgICAgZmluaXNoTm9kZShub2RlLCBcIkFzc2lnbm1lbnRFeHByZXNzaW9uXCIpO1xuICAgICAgICAgIHZhclN0bXRzLnB1c2gobmMuY3JlYXRlTm9kZUZyb20obm9kZSwgXCJFeHByZXNzaW9uU3RhdGVtZW50XCIsIHsgZXhwcmVzc2lvbjogbm9kZSB9KSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdmFyU3RtdHM7XG4gIH1cblxuICAvLyAjIyMgU3RhdGVtZW50IHBhcnNpbmdcblxuICAvLyBQYXJzZSBhIHByb2dyYW0uIEluaXRpYWxpemVzIHRoZSBwYXJzZXIsIHJlYWRzIGFueSBudW1iZXIgb2ZcbiAgLy8gc3RhdGVtZW50cywgYW5kIHdyYXBzIHRoZW0gaW4gYSBQcm9ncmFtIG5vZGUuICBPcHRpb25hbGx5IHRha2VzIGFcbiAgLy8gYHByb2dyYW1gIGFyZ3VtZW50LiAgSWYgcHJlc2VudCwgdGhlIHN0YXRlbWVudHMgd2lsbCBiZSBhcHBlbmRlZFxuICAvLyB0byBpdHMgYm9keSBpbnN0ZWFkIG9mIGNyZWF0aW5nIGEgbmV3IG5vZGUuXG5cbiAgZnVuY3Rpb24gcGFyc2VUb3BMZXZlbChwcm9ncmFtKSB7XG4gICAgbGFzdFN0YXJ0ID0gbGFzdEVuZCA9IHRva1BvcztcbiAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIGxhc3RFbmRMb2MgPSBuZXcgUG9zaXRpb247XG4gICAgaW5GdW5jdGlvbiA9IHN0cmljdCA9IG51bGw7XG4gICAgYnJhY2tldE5lc3RpbmcgPSAwO1xuICAgIHJlYWRUb2tlbigpO1xuICAgIHZhciBub2RlID0gcHJvZ3JhbSB8fCBzdGFydE5vZGUoKTtcbiAgICBpZiAoIXByb2dyYW0pIG5vZGUuYm9keSA9IFtdO1xuICAgIHdoaWxlICh0b2tUeXBlICE9PSBfZW9mKSB7XG4gICAgICB2YXIgc3RtdCA9IHBhcnNlU3RhdGVtZW50KCk7XG4gICAgICBpZiAoc3RtdCkgbm9kZS5ib2R5LnB1c2goc3RtdCk7XG4gICAgfVxuICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiUHJvZ3JhbVwiKTtcbiAgfVxuXG4gIC8vIFBhcnNlIGEgc2luZ2xlIHN0YXRlbWVudC5cbiAgLy9cbiAgLy8gSWYgZXhwZWN0aW5nIGEgc3RhdGVtZW50IGFuZCBmaW5kaW5nIGEgc2xhc2ggb3BlcmF0b3IsIHBhcnNlIGFcbiAgLy8gcmVndWxhciBleHByZXNzaW9uIGxpdGVyYWwuIFRoaXMgaXMgdG8gaGFuZGxlIGNhc2VzIGxpa2VcbiAgLy8gYGlmIChmb28pIC9ibGFoLy5leGVjKGZvbyk7YCwgd2hlcmUgbG9va2luZyBhdCB0aGUgcHJldmlvdXMgdG9rZW5cbiAgLy8gZG9lcyBub3QgaGVscC5cblxuICBmdW5jdGlvbiBwYXJzZVN0YXRlbWVudCgpIHtcbiAgICBpZiAodG9rVHlwZSA9PT0gX3NsYXNoIHx8IHRva1R5cGUgPT09IF9hc3NpZ24gJiYgdG9rVmFsID09IFwiLz1cIilcbiAgICAgIHJlYWRUb2tlbih0cnVlKTtcblxuICAgIHZhciBzdGFydHR5cGUgPSB0b2tUeXBlLCBub2RlID0gc3RhcnROb2RlKCk7XG5cbiAgICAvLyBNb3N0IHR5cGVzIG9mIHN0YXRlbWVudHMgYXJlIHJlY29nbml6ZWQgYnkgdGhlIGtleXdvcmQgdGhleVxuICAgIC8vIHN0YXJ0IHdpdGguIE1hbnkgYXJlIHRyaXZpYWwgdG8gcGFyc2UsIHNvbWUgcmVxdWlyZSBhIGJpdCBvZlxuICAgIC8vIGNvbXBsZXhpdHkuXG5cbiAgICBzd2l0Y2ggKHN0YXJ0dHlwZSkge1xuXG4gICAgY2FzZSBfYnJlYWs6XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkJyZWFrU3RhdGVtZW50XCIpO1xuXG4gICAgY2FzZSBfY29udGludWU6XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkNvbnRpbnVlU3RhdGVtZW50XCIpO1xuXG4gICAgY2FzZSBfY2xhc3M6XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gcGFyc2VDbGFzcyhub2RlKTtcblxuICAgIGNhc2UgX2RlZjpcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBwYXJzZUZ1bmN0aW9uKG5vZGUpO1xuXG4gICAgY2FzZSBfZm9yOlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIHBhcnNlRm9yKG5vZGUpO1xuXG4gICAgY2FzZSBfZnJvbTogLy8gU2tpcHBpbmcgZnJvbSBhbmQgaW1wb3J0IHN0YXRlbWVudHMgZm9yIG5vd1xuICAgICAgc2tpcExpbmUoKTtcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBwYXJzZVN0YXRlbWVudCgpO1xuXG4gICAgY2FzZSBfaWY6IGNhc2UgX2VsaWY6XG4gICAgICBuZXh0KCk7XG4gICAgICBpZiAodG9rVHlwZSA9PT0gX3BhcmVuTCkgbm9kZS50ZXN0ID0gcGFyc2VQYXJlbkV4cHJlc3Npb24oKTtcbiAgICAgIGVsc2Ugbm9kZS50ZXN0ID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICBleHBlY3QoX2NvbG9uKTtcbiAgICAgIG5vZGUuY29uc2VxdWVudCA9IHBhcnNlU3VpdGUoKTtcbiAgICAgIGlmICh0b2tUeXBlID09PSBfZWxpZilcbiAgICAgICAgbm9kZS5hbHRlcm5hdGUgPSBwYXJzZVN0YXRlbWVudCgpO1xuICAgICAgZWxzZVxuICAgICAgICBub2RlLmFsdGVybmF0ZSA9IGVhdChfZWxzZSkgJiYgZWF0KF9jb2xvbikgPyBwYXJzZVN1aXRlKCkgOiBudWxsO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJJZlN0YXRlbWVudFwiKTtcblxuICAgIGNhc2UgX2ltcG9ydDogLy8gU2tpcHBpbmcgZnJvbSBhbmQgaW1wb3J0IHN0YXRlbWVudHMgZm9yIG5vd1xuICAgICAgc2tpcExpbmUoKTtcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBwYXJzZVN0YXRlbWVudCgpO1xuXG4gICAgY2FzZSBfbmV3bGluZTpcbiAgICAgIC8vIFRPRE86IHBhcnNlU3RhdGVtZW50KCkgc2hvdWxkIHByb2JhYmx5IGVhdCBpdCdzIG93biBuZXdsaW5lXG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gbnVsbDtcblxuICAgIGNhc2UgX3Bhc3M6XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkVtcHR5U3RhdGVtZW50XCIpO1xuXG4gICAgY2FzZSBfcmV0dXJuOlxuICAgICAgaWYgKCFpbkZ1bmN0aW9uICYmICFvcHRpb25zLmFsbG93UmV0dXJuT3V0c2lkZUZ1bmN0aW9uKVxuICAgICAgICByYWlzZSh0b2tTdGFydCwgXCIncmV0dXJuJyBvdXRzaWRlIG9mIGZ1bmN0aW9uXCIpO1xuICAgICAgbmV4dCgpO1xuICAgICAgaWYgKHRva1R5cGUgPT09X25ld2xpbmUgfHwgdG9rVHlwZSA9PT0gX2VvZikgbm9kZS5hcmd1bWVudCA9IG51bGw7XG4gICAgICBlbHNlIHsgbm9kZS5hcmd1bWVudCA9IHBhcnNlRXhwcmVzc2lvbigpO31cbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiUmV0dXJuU3RhdGVtZW50XCIpO1xuXG4gICAgY2FzZSBfdHJ5OiAvLyBUT0RPLCBhbmQgcmVtb3ZlIHBhcnNlQmxvY2tcbiAgICAgIG5leHQoKTtcbiAgICAgIG5vZGUuYmxvY2sgPSBwYXJzZUJsb2NrKCk7XG4gICAgICBub2RlLmhhbmRsZXIgPSBudWxsO1xuICAgICAgaWYgKHRva1R5cGUgPT09IF9jYXRjaCkge1xuICAgICAgICB2YXIgY2xhdXNlID0gc3RhcnROb2RlKCk7XG4gICAgICAgIG5leHQoKTtcbiAgICAgICAgZXhwZWN0KF9wYXJlbkwpO1xuICAgICAgICBjbGF1c2UucGFyYW0gPSBwYXJzZUlkZW50KCk7XG4gICAgICAgIGlmIChzdHJpY3QgJiYgaXNTdHJpY3RCYWRJZFdvcmQoY2xhdXNlLnBhcmFtLm5hbWUpKVxuICAgICAgICAgIHJhaXNlKGNsYXVzZS5wYXJhbS5zdGFydCwgXCJCaW5kaW5nIFwiICsgY2xhdXNlLnBhcmFtLm5hbWUgKyBcIiBpbiBzdHJpY3QgbW9kZVwiKTtcbiAgICAgICAgZXhwZWN0KF9wYXJlblIpO1xuICAgICAgICBjbGF1c2UuZ3VhcmQgPSBudWxsO1xuICAgICAgICBjbGF1c2UuYm9keSA9IHBhcnNlQmxvY2soKTtcbiAgICAgICAgbm9kZS5oYW5kbGVyID0gZmluaXNoTm9kZShjbGF1c2UsIFwiQ2F0Y2hDbGF1c2VcIik7XG4gICAgICB9XG4gICAgICBub2RlLmd1YXJkZWRIYW5kbGVycyA9IGVtcHR5O1xuICAgICAgbm9kZS5maW5hbGl6ZXIgPSBlYXQoX2ZpbmFsbHkpID8gcGFyc2VCbG9jaygpIDogbnVsbDtcbiAgICAgIGlmICghbm9kZS5oYW5kbGVyICYmICFub2RlLmZpbmFsaXplcilcbiAgICAgICAgcmFpc2Uobm9kZS5zdGFydCwgXCJNaXNzaW5nIGNhdGNoIG9yIGZpbmFsbHkgY2xhdXNlXCIpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJUcnlTdGF0ZW1lbnRcIik7XG5cbiAgICBjYXNlIF93aGlsZTpcbiAgICAgIG5leHQoKTtcbiAgICAgIGlmICh0b2tUeXBlID09PSBfcGFyZW5MKSBub2RlLnRlc3QgPSBwYXJzZVBhcmVuRXhwcmVzc2lvbigpO1xuICAgICAgZWxzZSBub2RlLnRlc3QgPSBwYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgIGV4cGVjdChfY29sb24pO1xuICAgICAgbm9kZS5ib2R5ID0gcGFyc2VTdWl0ZSgpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJXaGlsZVN0YXRlbWVudFwiKTtcblxuICAgIGNhc2UgX3dpdGg6IC8vIFRPRE9cbiAgICAgIGlmIChzdHJpY3QpIHJhaXNlKHRva1N0YXJ0LCBcIid3aXRoJyBpbiBzdHJpY3QgbW9kZVwiKTtcbiAgICAgIG5leHQoKTtcbiAgICAgIG5vZGUub2JqZWN0ID0gcGFyc2VQYXJlbkV4cHJlc3Npb24oKTtcbiAgICAgIG5vZGUuYm9keSA9IHBhcnNlU3RhdGVtZW50KCk7XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIldpdGhTdGF0ZW1lbnRcIik7XG5cbiAgICBjYXNlIF9zZW1pOlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJFbXB0eVN0YXRlbWVudFwiKTtcblxuICAgICAgLy8gQXNzdW1lIGl0J3MgYW4gRXhwcmVzc2lvblN0YXRlbWVudC4gSWYgYW4gYXNzaWduIGhhcyBiZWVuIFxuICAgICAgLy8gY29udmVydGVkIHRvIGEgdmFyaWFibGUgZGVjbGFyYXRpb24sIHBhc3MgaXQgdXAgYXMgaXMuXG5cbiAgICBkZWZhdWx0OlxuICAgICAgdmFyIGV4cHIgPSBwYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgIGlmICh0b2tUeXBlICE9PSBfc2VtaSAmJiB0b2tUeXBlICE9PSBfbmV3bGluZSAmJiB0b2tUeXBlICE9PSBfZW9mKSB1bmV4cGVjdGVkKCk7XG4gICAgICBpZiAoZXhwci50eXBlID09PSBcIlZhcmlhYmxlRGVjbGFyYXRpb25cIiB8fCBleHByLnR5cGUgPT09IFwiQmxvY2tTdGF0ZW1lbnRcIikge1xuICAgICAgICByZXR1cm4gZXhwcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5vZGUuZXhwcmVzc2lvbiA9IGV4cHI7XG4gICAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiRXhwcmVzc2lvblN0YXRlbWVudFwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBQYXJzZSBpbmRlbnQtZW5jbG9zZWQgYmxvY2sgb2Ygc3RhdGVtZW50c1xuXG4gIGZ1bmN0aW9uIHBhcnNlQmxvY2soKSB7XG4gICAgdmFyIG5vZGUgPSBzdGFydE5vZGUoKTtcbiAgICBub2RlLmJvZHkgPSBbXTtcbiAgICB3aGlsZSAodG9rVHlwZSAhPT0gX2RlZGVudCAmJiB0b2tUeXBlICE9PSBfZW9mKSB7XG4gICAgICB2YXIgc3RtdCA9IHBhcnNlU3RhdGVtZW50KCk7XG4gICAgICBpZiAoc3RtdCkgbm9kZS5ib2R5LnB1c2goc3RtdCk7XG4gICAgfVxuICAgIGlmICh0b2tUeXBlID09PSBfZGVkZW50KSBuZXh0KCk7XG4gICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJCbG9ja1N0YXRlbWVudFwiKTtcbiAgfVxuXG4gIC8vIFBhcnNlICdzdWl0ZScgZnJvbSBQeXRob24gZ3JhbW1hciBzcGVjXG4gIC8vIFdpbGwgcmVwbGFjZSBwYXJzZUJsb2NrIGV2ZW50dWFsbHlcblxuICBmdW5jdGlvbiBwYXJzZVN1aXRlKCkge1xuICAgIC8vIE5PVEU6IFRoaXMgaXMgbm90IHN0cmljdGx5IHZhbGlkIFB5dGhvbiBmb3IgdGhpcyB0byBiZSBhbiBlbXB0eSBibG9ja1xuICAgIHZhciBub2RlID0gc3RhcnROb2RlKCk7XG4gICAgbm9kZS5ib2R5ID0gW107XG4gICAgaWYgKGVhdChfbmV3bGluZSkpIHtcbiAgICAgIGlmICh0b2tUeXBlID09PSBfaW5kZW50KSB7XG4gICAgICAgIGV4cGVjdChfaW5kZW50KTtcbiAgICAgICAgd2hpbGUgKCFlYXQoX2RlZGVudCkgJiYgIWVhdChfZW9mKSkge1xuICAgICAgICAgIHZhciBzdG10ID0gcGFyc2VTdGF0ZW1lbnQoKTtcbiAgICAgICAgICBpZiAoc3RtdCkgbm9kZS5ib2R5LnB1c2goc3RtdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRva1R5cGUgIT09IF9lb2YpIHtcbiAgICAgIG5vZGUuYm9keS5wdXNoKHBhcnNlU3RhdGVtZW50KCkpO1xuICAgICAgbmV4dCgpO1xuICAgIH1cbiAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkJsb2NrU3RhdGVtZW50XCIpO1xuICB9XG5cbiAgLy8gUGFyc2UgZm9yL2luIGxvb3BcblxuICBmdW5jdGlvbiBwYXJzZUZvcihub2RlKSB7XG4gICAgdmFyIGluaXQgPSBwYXJzZUV4cHJlc3Npb24oZmFsc2UsIHRydWUpO1xuICAgIHZhciB0dXBsZUFyZ3MgPSBnZXRUdXBsZUFyZ3MoaW5pdCk7XG4gICAgaWYgKCF0dXBsZUFyZ3MpIGNoZWNrTFZhbChpbml0KTtcbiAgICBleHBlY3QoX2luKTtcbiAgICB2YXIgcmlnaHQgPSBwYXJzZUV4cHJlc3Npb24oKTtcbiAgICBleHBlY3QoX2NvbG9uKTtcbiAgICB2YXIgYm9keSA9IHBhcnNlU3VpdGUoKTtcbiAgICBmaW5pc2hOb2RlKG5vZGUsIFwiQmxvY2tTdGF0ZW1lbnRcIik7XG4gICAgcmV0dXJuIG5jLmNyZWF0ZUZvcihub2RlLCBpbml0LCB0dXBsZUFyZ3MsIHJpZ2h0LCBib2R5KTtcbiAgfVxuXG4gIC8vICMjIyBFeHByZXNzaW9uIHBhcnNpbmdcblxuICAvLyBUaGVzZSBuZXN0LCBmcm9tIHRoZSBtb3N0IGdlbmVyYWwgZXhwcmVzc2lvbiB0eXBlIGF0IHRoZSB0b3AgdG9cbiAgLy8gJ2F0b21pYycsIG5vbmRpdmlzaWJsZSBleHByZXNzaW9uIHR5cGVzIGF0IHRoZSBib3R0b20uIE1vc3Qgb2ZcbiAgLy8gdGhlIGZ1bmN0aW9ucyB3aWxsIHNpbXBseSBsZXQgdGhlIGZ1bmN0aW9uKHMpIGJlbG93IHRoZW0gcGFyc2UsXG4gIC8vIGFuZCwgKmlmKiB0aGUgc3ludGFjdGljIGNvbnN0cnVjdCB0aGV5IGhhbmRsZSBpcyBwcmVzZW50LCB3cmFwXG4gIC8vIHRoZSBBU1Qgbm9kZSB0aGF0IHRoZSBpbm5lciBwYXJzZXIgZ2F2ZSB0aGVtIGluIGFub3RoZXIgbm9kZS5cblxuICAvLyBQYXJzZSBhIGZ1bGwgZXhwcmVzc2lvbi4gVGhlIGFyZ3VtZW50cyBhcmUgdXNlZCB0byBmb3JiaWQgY29tbWFcbiAgLy8gc2VxdWVuY2VzIChpbiBhcmd1bWVudCBsaXN0cywgYXJyYXkgbGl0ZXJhbHMsIG9yIG9iamVjdCBsaXRlcmFscylcbiAgLy8gb3IgdGhlIGBpbmAgb3BlcmF0b3IgKGluIGZvciBsb29wcyBpbml0YWxpemF0aW9uIGV4cHJlc3Npb25zKS5cblxuICBmdW5jdGlvbiBwYXJzZUV4cHJlc3Npb24obm9Db21tYSwgbm9Jbikge1xuICAgIHJldHVybiBwYXJzZU1heWJlQXNzaWduKG5vSW4pO1xuICB9XG5cbiAgLy8gVXNlZCBmb3IgY29uc3RydWN0cyBsaWtlIGBzd2l0Y2hgIGFuZCBgaWZgIHRoYXQgaW5zaXN0IG9uXG4gIC8vIHBhcmVudGhlc2VzIGFyb3VuZCB0aGVpciBleHByZXNzaW9uLlxuXG4gIGZ1bmN0aW9uIHBhcnNlUGFyZW5FeHByZXNzaW9uKCkge1xuICAgIGV4cGVjdChfcGFyZW5MKTtcbiAgICB2YXIgdmFsID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgZXhwZWN0KF9wYXJlblIpO1xuICAgIHJldHVybiB2YWw7XG4gIH1cblxuICAvLyBQYXJzZSBhbiBhc3NpZ25tZW50IGV4cHJlc3Npb24uIFRoaXMgaW5jbHVkZXMgYXBwbGljYXRpb25zIG9mXG4gIC8vIG9wZXJhdG9ycyBsaWtlIGArPWAuXG4gIC8vIEFkZCAndGhpcy4nIHRvIGFzc2lnbm1lbnRzIGluIGEgY2xhc3MgY29uc3RydWN0b3IuXG4gIC8vIENvbnZlcnQgaWRlbnRpZmllciBhc3NpZ25tZW50IHRvIHZhcmlhYmxlIGRlY2xhcmF0aW9uIGlmIHRoZVxuICAvLyBpZGVudGlmaWVyIGRvZXNuJ3QgZXhpc3QgaW4gdGhpcyBuYW1lc3BhY2UgeWV0LlxuXG4gIGZ1bmN0aW9uIHBhcnNlTWF5YmVBc3NpZ24obm9Jbikge1xuICAgIHZhciBsZWZ0ID0gcGFyc2VNYXliZVR1cGxlKG5vSW4pO1xuICAgIGlmICh0b2tUeXBlLmlzQXNzaWduKSB7XG4gICAgICB2YXIgdHVwbGVBcmdzID0gZ2V0VHVwbGVBcmdzKGxlZnQpO1xuICAgICAgaWYgKHR1cGxlQXJncykge1xuICAgICAgICBuZXh0KCk7XG4gICAgICAgIHZhciByaWdodCA9IHBhcnNlTWF5YmVUdXBsZShub0luKTtcbiAgICAgICAgdmFyIGJsb2NrTm9kZSA9IHN0YXJ0Tm9kZUZyb20obGVmdCk7XG4gICAgICAgIGJsb2NrTm9kZS5ib2R5ID0gdW5wYWNrVHVwbGUodHVwbGVBcmdzLCByaWdodCk7XG4gICAgICAgIHJldHVybiBmaW5pc2hOb2RlKGJsb2NrTm9kZSwgXCJCbG9ja1N0YXRlbWVudFwiKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNjb3BlLmlzQ2xhc3MoKSkge1xuICAgICAgICB2YXIgdGhpc0V4cHIgPSBuYy5jcmVhdGVOb2RlRnJvbShsZWZ0LCBcIlRoaXNFeHByZXNzaW9uXCIpO1xuICAgICAgICBsZWZ0ID0gbmMuY3JlYXRlTm9kZUZyb20obGVmdCwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiB0aGlzRXhwciwgcHJvcGVydHk6IGxlZnQgfSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBub2RlID0gc3RhcnROb2RlRnJvbShsZWZ0KTtcbiAgICAgIG5vZGUub3BlcmF0b3IgPSB0b2tWYWw7XG4gICAgICBub2RlLmxlZnQgPSBsZWZ0O1xuICAgICAgbmV4dCgpO1xuICAgICAgbm9kZS5yaWdodCA9IHBhcnNlTWF5YmVUdXBsZShub0luKTtcbiAgICAgIGNoZWNrTFZhbChsZWZ0KTtcblxuICAgICAgaWYgKG5vZGUub3BlcmF0b3IgPT09ICcrPScgfHwgbm9kZS5vcGVyYXRvciA9PT0gJyo9Jykge1xuICAgICAgICB2YXIgcmlnaHQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLnJpZ2h0LCBub2RlLnJpZ2h0LCBcIkNhbGxFeHByZXNzaW9uXCIpO1xuICAgICAgICByaWdodC5jYWxsZWUgPSBuYy5jcmVhdGVOb2RlT3BzQ2FsbGVlKHJpZ2h0LCBub2RlLm9wZXJhdG9yID09PSAnKz0nID8gXCJhZGRcIiA6IFwibXVsdGlwbHlcIik7XG4gICAgICAgIHJpZ2h0LmFyZ3VtZW50cyA9IFtsZWZ0LCBub2RlLnJpZ2h0XTtcbiAgICAgICAgbm9kZS5yaWdodCA9IHJpZ2h0O1xuICAgICAgICBub2RlLm9wZXJhdG9yID0gJz0nO1xuICAgICAgfVxuXG4gICAgICBpZiAobGVmdC50eXBlID09PSBcIklkZW50aWZpZXJcIiAmJiAhc2NvcGUuZXhpc3RzKGxlZnQubmFtZSkpIHtcbiAgICAgICAgaWYgKCFub2RlLm9wZXJhdG9yIHx8IG5vZGUub3BlcmF0b3IubGVuZ3RoID4gMSkgdW5leHBlY3RlZCgpO1xuICAgICAgICBzY29wZS5hZGRWYXIobGVmdC5uYW1lKTtcbiAgICAgICAgcmV0dXJuIG5jLmNyZWF0ZVZhckRlY2xGcm9tSWQobm9kZS5sZWZ0LCBub2RlLmxlZnQsIG5vZGUucmlnaHQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJBc3NpZ25tZW50RXhwcmVzc2lvblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGxlZnQ7XG4gIH1cblxuICAvLyBQYXJzZSBhIHR1cGxlXG5cbiAgZnVuY3Rpb24gcGFyc2VNYXliZVR1cGxlKG5vSW4pIHtcbiAgICB2YXIgZXhwciA9IHBhcnNlRXhwck9wcyhub0luKTtcbiAgICBpZiAodG9rVHlwZSA9PT0gX2NvbW1hKSB7XG4gICAgICByZXR1cm4gcGFyc2VUdXBsZShub0luLCBleHByKTtcbiAgICB9XG4gICAgcmV0dXJuIGV4cHI7XG4gIH1cblxuICAvLyBTdGFydCB0aGUgcHJlY2VkZW5jZSBwYXJzZXIuXG5cbiAgZnVuY3Rpb24gcGFyc2VFeHByT3BzKG5vSW4pIHtcbiAgICByZXR1cm4gcGFyc2VFeHByT3AocGFyc2VNYXliZVVuYXJ5KG5vSW4pLCAtMSwgbm9Jbik7XG4gIH1cblxuICAvLyBQYXJzZSBiaW5hcnkgb3BlcmF0b3JzIHdpdGggdGhlIG9wZXJhdG9yIHByZWNlZGVuY2UgcGFyc2luZ1xuICAvLyBhbGdvcml0aG0uIGBsZWZ0YCBpcyB0aGUgbGVmdC1oYW5kIHNpZGUgb2YgdGhlIG9wZXJhdG9yLlxuICAvLyBgbWluUHJlY2AgcHJvdmlkZXMgY29udGV4dCB0aGF0IGFsbG93cyB0aGUgZnVuY3Rpb24gdG8gc3RvcCBhbmRcbiAgLy8gZGVmZXIgZnVydGhlciBwYXJzZXIgdG8gb25lIG9mIGl0cyBjYWxsZXJzIHdoZW4gaXQgZW5jb3VudGVycyBhblxuICAvLyBvcGVyYXRvciB0aGF0IGhhcyBhIGxvd2VyIHByZWNlZGVuY2UgdGhhbiB0aGUgc2V0IGl0IGlzIHBhcnNpbmcuXG4gIC8vIEV4cG9uZW50aWF0aW9uIGlzIGV2YWx1YXRlZCByaWdodC10by1sZWZ0LCBzbyAncHJlYyA+PSBtaW5QcmVjJ1xuICAvLyBFeHBvbmVudGlhdGlvbiBvcGVyYXRvciAneCoqeScgaXMgcmVwbGFjZWQgd2l0aCAnTWF0aC5wb3coeCwgeSknXG4gIC8vIEZsb29yIGRpdmlzaW9uIG9wZXJhdG9yICd4Ly95JyBpcyByZXBsYWNlZCB3aXRoICdNYXRoLmZsb29yKHgveSknXG4gIC8vICdpbicgYW5kICdub3QgaW4nIGltcGxlbWVudGVkIHZpYSBpbmRleE9mKClcblxuICBmdW5jdGlvbiBwYXJzZUV4cHJPcChsZWZ0LCBtaW5QcmVjLCBub0luKSB7XG4gICAgdmFyIG5vZGUsIGV4cHJOb2RlLCByaWdodCwgb3AgPSB0b2tUeXBlLCB2YWwgPSB0b2tWYWw7XG4gICAgdmFyIHByZWMgPSBvcCA9PT0gX25vdCA/IF9pbi5wcmVjIDogb3AucHJlYztcbiAgICBpZiAob3AgPT09IF9leHBvbmVudGlhdGlvbiAmJiBwcmVjID49IG1pblByZWMpIHtcbiAgICAgIG5vZGUgPSBzdGFydE5vZGVGcm9tKGxlZnQpO1xuICAgICAgbmV4dCgpO1xuICAgICAgcmlnaHQgPSBwYXJzZUV4cHJPcChwYXJzZU1heWJlVW5hcnkobm9JbiksIHByZWMsIG5vSW4pO1xuICAgICAgZXhwck5vZGUgPSBuYy5jcmVhdGVOb2RlTWVtYmVyQ2FsbChub2RlLCBcIk1hdGhcIiwgXCJwb3dcIiwgW2xlZnQsIHJpZ2h0XSk7XG4gICAgICByZXR1cm4gcGFyc2VFeHByT3AoZXhwck5vZGUsIG1pblByZWMsIG5vSW4pO1xuICAgIH0gZWxzZSBpZiAocHJlYyAhPSBudWxsICYmICghbm9JbiB8fCBvcCAhPT0gX2luKSkge1xuICAgICAgaWYgKHByZWMgPiBtaW5QcmVjKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgICAgbm9kZSA9IHN0YXJ0Tm9kZUZyb20obGVmdCk7XG4gICAgICAgIGlmIChvcCA9PT0gX2Zsb29yRGl2KSB7XG4gICAgICAgICAgcmlnaHQgPSBwYXJzZUV4cHJPcChwYXJzZU1heWJlVW5hcnkobm9JbiksIHByZWMsIG5vSW4pO1xuICAgICAgICAgIGZpbmlzaE5vZGUobm9kZSk7XG4gICAgICAgICAgdmFyIGJpbkV4cHIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkJpbmFyeUV4cHJlc3Npb25cIiwgeyBsZWZ0OiBsZWZ0LCBvcGVyYXRvcjogJy8nLCByaWdodDogcmlnaHQgfSk7XG4gICAgICAgICAgZXhwck5vZGUgPSBuYy5jcmVhdGVOb2RlTWVtYmVyQ2FsbChub2RlLCBcIk1hdGhcIiwgXCJmbG9vclwiLCBbYmluRXhwcl0pO1xuICAgICAgICB9IGVsc2UgaWYgKG9wID09PSBfaW4gfHwgb3AgPT09IF9ub3QpIHtcbiAgICAgICAgICBpZiAob3AgPT09IF9pbiB8fCBlYXQoX2luKSkge1xuICAgICAgICAgICAgcmlnaHQgPSBwYXJzZUV4cHJPcChwYXJzZU1heWJlVW5hcnkobm9JbiksIHByZWMsIG5vSW4pO1xuICAgICAgICAgICAgZmluaXNoTm9kZShub2RlKTtcbiAgICAgICAgICAgIHZhciBub3RMaXQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogb3AgPT09IF9ub3QgfSk7XG4gICAgICAgICAgICBleHByTm9kZSA9IG5jLmNyZWF0ZU5vZGVSdW50aW1lQ2FsbChub2RlLCAnb3BzJywgJ2luJywgW2xlZnQsIHJpZ2h0LCBub3RMaXRdKTtcbiAgICAgICAgICB9IGVsc2UgcmFpc2UodG9rUG9zLCBcIkV4cGVjdGVkICdub3QgaW4nIGNvbXBhcmlzb24gb3BlcmF0b3JcIik7XG4gICAgICAgIH0gZWxzZSBpZiAob3AgPT09IF9wbHVzTWluICYmIHZhbCA9PT0gJysnIHx8IG9wID09PSBfbXVsdGlwbHlNb2R1bG8gJiYgdmFsID09PSAnKicpIHtcbiAgICAgICAgICBub2RlLmFyZ3VtZW50cyA9IFtsZWZ0XTtcbiAgICAgICAgICBub2RlLmFyZ3VtZW50cy5wdXNoKHBhcnNlRXhwck9wKHBhcnNlTWF5YmVVbmFyeShub0luKSwgcHJlYywgbm9JbikpO1xuICAgICAgICAgIGZpbmlzaE5vZGUobm9kZSwgXCJDYWxsRXhwcmVzc2lvblwiKTtcbiAgICAgICAgICBub2RlLmNhbGxlZSA9IG5jLmNyZWF0ZU5vZGVPcHNDYWxsZWUobm9kZSwgb3AgPT09IF9wbHVzTWluID8gXCJhZGRcIiA6IFwibXVsdGlwbHlcIik7XG4gICAgICAgICAgZXhwck5vZGUgPSBub2RlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChvcCA9PT0gX2lzKSB7XG4gICAgICAgICAgICBpZiAoZWF0KF9ub3QpKSBub2RlLm9wZXJhdG9yID0gXCIhPT1cIjtcbiAgICAgICAgICAgIGVsc2Ugbm9kZS5vcGVyYXRvciA9IFwiPT09XCI7XG4gICAgICAgICAgfSBlbHNlIG5vZGUub3BlcmF0b3IgPSBvcC5yZXAgIT0gbnVsbCA/IG9wLnJlcCA6IHZhbDtcbiAgICAgICAgICBub2RlLmxlZnQgPSBsZWZ0O1xuICAgICAgICAgIG5vZGUucmlnaHQgPSBwYXJzZUV4cHJPcChwYXJzZU1heWJlVW5hcnkobm9JbiksIHByZWMsIG5vSW4pO1xuICAgICAgICAgIGV4cHJOb2RlID0gZmluaXNoTm9kZShub2RlLCAob3AgPT09IF9vciB8fCBvcCA9PT0gX2FuZCkgPyBcIkxvZ2ljYWxFeHByZXNzaW9uXCIgOiBcIkJpbmFyeUV4cHJlc3Npb25cIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhcnNlRXhwck9wKGV4cHJOb2RlLCBtaW5QcmVjLCBub0luKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGxlZnQ7XG4gIH1cblxuICAvLyBQYXJzZSB1bmFyeSBvcGVyYXRvcnMuXG4gIC8vICctKycgYXJlIHByZWZpeGVzIGhlcmUsIHdpdGggZGlmZmVyZW50IHByZWNlZGVuY2UuXG5cbiAgZnVuY3Rpb24gcGFyc2VNYXliZVVuYXJ5KG5vSW4pIHtcbiAgICBpZiAodG9rVHlwZS5wcmVmaXggfHwgdG9rVHlwZSA9PT0gX3BsdXNNaW4pIHtcbiAgICAgIHZhciBwcmVjID0gdG9rVHlwZSA9PT0gX3BsdXNNaW4gPyBfcG9zTmVnTm90LnByZWMgOiB0b2tUeXBlLnByZWM7XG4gICAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZSgpO1xuICAgICAgbm9kZS5vcGVyYXRvciA9IHRva1R5cGUucmVwICE9IG51bGwgPyB0b2tUeXBlLnJlcCA6IHRva1ZhbDtcbiAgICAgIG5vZGUucHJlZml4ID0gdHJ1ZTtcbiAgICAgIHRva1JlZ2V4cEFsbG93ZWQgPSB0cnVlO1xuICAgICAgbmV4dCgpO1xuICAgICAgbm9kZS5hcmd1bWVudCA9IHBhcnNlRXhwck9wKHBhcnNlTWF5YmVVbmFyeShub0luKSwgcHJlYywgbm9Jbik7XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIlVuYXJ5RXhwcmVzc2lvblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHBhcnNlU3Vic2NyaXB0cyhwYXJzZUV4cHJBdG9tKCkpO1xuICB9XG5cbiAgLy8gUGFyc2UgY2FsbCwgZG90LCBhbmQgYFtdYC1zdWJzY3JpcHQgZXhwcmVzc2lvbnMuXG5cbiAgZnVuY3Rpb24gcGFyc2VTdWJzY3JpcHRzKGJhc2UsIG5vQ2FsbHMpIHtcbiAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZUZyb20oYmFzZSk7XG4gICAgaWYgKGVhdChfZG90KSkge1xuICAgICAgdmFyIGlkID0gcGFyc2VJZGVudCh0cnVlKTtcbiAgICAgIGlmIChweXRob25SdW50aW1lLmltcG9ydHNbYmFzZS5uYW1lXSAmJiBweXRob25SdW50aW1lLmltcG9ydHNbYmFzZS5uYW1lXVtpZC5uYW1lXSkge1xuICAgICAgICAvLyBDYWxsaW5nIGEgUHl0aG9uIGltcG9ydCBmdW5jdGlvblxuICAgICAgICAvLyBUT0RPOiBVbnBhY2sgcGFyYW1ldGVycyBpbnRvIEphdmFTY3JpcHQtZnJpZW5kbHkgcGFyYW1ldGVyc1xuICAgICAgICB2YXIgcnVudGltZUlkID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogb3B0aW9ucy5ydW50aW1lUGFyYW1OYW1lIH0pO1xuICAgICAgICB2YXIgaW1wb3J0c0lkID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJpbXBvcnRzXCIgfSk7XG4gICAgICAgIHZhciBydW50aW1lTWVtYmVyID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lSWQsIHByb3BlcnR5OiBpbXBvcnRzSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgICAgbm9kZS5vYmplY3QgPSBuYy5jcmVhdGVOb2RlU3BhbihiYXNlLCBiYXNlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVNZW1iZXIsIHByb3BlcnR5OiBiYXNlLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgICB9IGVsc2UgaWYgKGJhc2UubmFtZSAmJiBiYXNlLm5hbWUgPT09IHNjb3BlLmdldFRoaXNSZXBsYWNlKCkpIHtcbiAgICAgICAgbm9kZS5vYmplY3QgPSBuYy5jcmVhdGVOb2RlU3BhbihiYXNlLCBiYXNlLCBcIlRoaXNFeHByZXNzaW9uXCIpO1xuICAgICAgfSBlbHNlIG5vZGUub2JqZWN0ID0gYmFzZTtcbiAgICAgIG5vZGUucHJvcGVydHkgPSBpZDtcbiAgICAgIG5vZGUuY29tcHV0ZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybiBwYXJzZVN1YnNjcmlwdHMoZmluaXNoTm9kZShub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiksIG5vQ2FsbHMpO1xuICAgIH0gZWxzZSBpZiAoZWF0KF9icmFja2V0TCkpIHtcbiAgICAgIHZhciBleHByLCBpc1NsaWNlID0gZmFsc2U7XG4gICAgICBpZiAoZWF0KF9jb2xvbikpIGlzU2xpY2UgPSB0cnVlO1xuICAgICAgZWxzZSBleHByID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICBpZiAoIWlzU2xpY2UgJiYgZWF0KF9jb2xvbikpIGlzU2xpY2UgPSB0cnVlO1xuICAgICAgaWYgKGlzU2xpY2UpIHJldHVybiBwYXJzZVNsaWNlKG5vZGUsIGJhc2UsIGV4cHIsIG5vQ2FsbHMpO1xuICAgICAgdmFyIHN1YnNjcmlwdENhbGwgPSBuYy5jcmVhdGVOb2RlU3BhbihleHByLCBleHByLCBcIkNhbGxFeHByZXNzaW9uXCIpO1xuICAgICAgc3Vic2NyaXB0Q2FsbC5jYWxsZWUgPSBuYy5jcmVhdGVOb2RlT3BzQ2FsbGVlKGV4cHIsIFwic3Vic2NyaXB0SW5kZXhcIik7XG4gICAgICBzdWJzY3JpcHRDYWxsLmFyZ3VtZW50cyA9IFtiYXNlLCBleHByXTtcbiAgICAgIG5vZGUub2JqZWN0ID0gYmFzZTtcbiAgICAgIG5vZGUucHJvcGVydHkgPSBzdWJzY3JpcHRDYWxsO1xuICAgICAgbm9kZS5jb21wdXRlZCA9IHRydWU7XG4gICAgICBleHBlY3QoX2JyYWNrZXRSKTtcbiAgICAgIHJldHVybiBwYXJzZVN1YnNjcmlwdHMoZmluaXNoTm9kZShub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiksIG5vQ2FsbHMpO1xuICAgIH0gZWxzZSBpZiAoIW5vQ2FsbHMgJiYgZWF0KF9wYXJlbkwpKSB7XG4gICAgICBpZiAoc2NvcGUuaXNVc2VyRnVuY3Rpb24oYmFzZS5uYW1lKSkge1xuICAgICAgICAvLyBVbnBhY2sgcGFyYW1ldGVycyBpbnRvIEphdmFTY3JpcHQtZnJpZW5kbHkgcGFyYW1ldGVycywgZnVydGhlciBwcm9jZXNzZWQgYXQgcnVudGltZVxuICAgICAgICB2YXIgY3JlYXRlUGFyYW1zQ2FsbCA9IG5jLmNyZWF0ZU5vZGVSdW50aW1lQ2FsbChub2RlLCAndXRpbHMnLCAnY3JlYXRlUGFyYW1zT2JqJywgcGFyc2VQYXJhbXNMaXN0KCkpO1xuICAgICAgICBub2RlLmFyZ3VtZW50cyA9IFtjcmVhdGVQYXJhbXNDYWxsXTtcbiAgICAgIH0gZWxzZSBub2RlLmFyZ3VtZW50cyA9IHBhcnNlRXhwckxpc3QoX3BhcmVuUiwgZmFsc2UpO1xuICAgICAgaWYgKHNjb3BlLmlzTmV3T2JqKGJhc2UubmFtZSkpIGZpbmlzaE5vZGUobm9kZSwgXCJOZXdFeHByZXNzaW9uXCIpO1xuICAgICAgZWxzZSBmaW5pc2hOb2RlKG5vZGUsIFwiQ2FsbEV4cHJlc3Npb25cIik7XG4gICAgICBpZiAocHl0aG9uUnVudGltZS5mdW5jdGlvbnNbYmFzZS5uYW1lXSkge1xuICAgICAgICAvLyBDYWxsaW5nIGEgUHl0aG9uIGJ1aWx0LWluIGZ1bmN0aW9uXG4gICAgICAgIC8vIFRPRE86IFVucGFjayBwYXJhbWV0ZXJzIGludG8gSmF2YVNjcmlwdC1mcmllbmRseSBwYXJhbWV0ZXJzXG4gICAgICAgIGlmIChiYXNlLnR5cGUgIT09IFwiSWRlbnRpZmllclwiKSB1bmV4cGVjdGVkKCk7XG4gICAgICAgIHZhciBydW50aW1lSWQgPSBuYy5jcmVhdGVOb2RlU3BhbihiYXNlLCBiYXNlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBvcHRpb25zLnJ1bnRpbWVQYXJhbU5hbWUgfSk7XG4gICAgICAgIHZhciBmdW5jdGlvbnNJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiZnVuY3Rpb25zXCIgfSk7XG4gICAgICAgIHZhciBydW50aW1lTWVtYmVyID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lSWQsIHByb3BlcnR5OiBmdW5jdGlvbnNJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgICBub2RlLmNhbGxlZSA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZU1lbWJlciwgcHJvcGVydHk6IGJhc2UsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgIH0gZWxzZSBub2RlLmNhbGxlZSA9IGJhc2U7XG4gICAgICByZXR1cm4gcGFyc2VTdWJzY3JpcHRzKG5vZGUsIG5vQ2FsbHMpO1xuICAgIH1cbiAgICByZXR1cm4gYmFzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlU2xpY2Uobm9kZSwgYmFzZSwgc3RhcnQsIG5vQ2FsbHMpIHtcbiAgICB2YXIgZW5kLCBzdGVwO1xuICAgIGlmICghc3RhcnQpIHN0YXJ0ID0gbmMuY3JlYXRlTm9kZUZyb20obm9kZSwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IG51bGwgfSk7XG4gICAgaWYgKHRva1R5cGUgPT09IF9icmFja2V0UiB8fCBlYXQoX2NvbG9uKSkge1xuICAgICAgZW5kID0gbmMuY3JlYXRlTm9kZUZyb20obm9kZSwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IG51bGwgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVuZCA9IHBhcnNlRXhwcmVzc2lvbigpO1xuICAgICAgaWYgKHRva1R5cGUgIT09IF9icmFja2V0UikgZXhwZWN0KF9jb2xvbik7XG4gICAgfVxuICAgIGlmICh0b2tUeXBlID09PSBfYnJhY2tldFIpIHN0ZXAgPSBuYy5jcmVhdGVOb2RlRnJvbShub2RlLCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogbnVsbCB9KTtcbiAgICBlbHNlIHN0ZXAgPSBwYXJzZUV4cHJlc3Npb24oKTtcbiAgICBleHBlY3QoX2JyYWNrZXRSKTtcblxuICAgIG5vZGUuYXJndW1lbnRzID0gW3N0YXJ0LCBlbmQsIHN0ZXBdO1xuICAgIHZhciBzbGljZUlkID0gbmMuY3JlYXRlTm9kZUZyb20oYmFzZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJfcHlTbGljZVwiIH0pO1xuICAgIHZhciBtZW1iZXJFeHByID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBiYXNlLCBwcm9wZXJ0eTogc2xpY2VJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgIG5vZGUuY2FsbGVlID0gbWVtYmVyRXhwcjtcbiAgICByZXR1cm4gcGFyc2VTdWJzY3JpcHRzKGZpbmlzaE5vZGUobm9kZSwgXCJDYWxsRXhwcmVzc2lvblwiKSwgbm9DYWxscyk7XG4gIH1cblxuICAvLyBQYXJzZSBhbiBhdG9taWMgZXhwcmVzc2lvbiAtIGVpdGhlciBhIHNpbmdsZSB0b2tlbiB0aGF0IGlzIGFuXG4gIC8vIGV4cHJlc3Npb24sIGFuIGV4cHJlc3Npb24gc3RhcnRlZCBieSBhIGtleXdvcmQgbGlrZSBgZnVuY3Rpb25gIG9yXG4gIC8vIGBuZXdgLCBvciBhbiBleHByZXNzaW9uIHdyYXBwZWQgaW4gcHVuY3R1YXRpb24gbGlrZSBgKClgLCBgW11gLFxuICAvLyBvciBge31gLlxuXG4gIGZ1bmN0aW9uIHBhcnNlRXhwckF0b20oKSB7XG4gICAgc3dpdGNoICh0b2tUeXBlKSB7XG5cbiAgICBjYXNlIF9kaWN0OlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIHBhcnNlRGljdChfcGFyZW5SKTtcblxuICAgIGNhc2UgX25hbWU6XG4gICAgICByZXR1cm4gcGFyc2VJZGVudCgpO1xuXG4gICAgY2FzZSBfbnVtOiBjYXNlIF9zdHJpbmc6IGNhc2UgX3JlZ2V4cDpcbiAgICAgIHZhciBub2RlID0gc3RhcnROb2RlKCk7XG4gICAgICBub2RlLnZhbHVlID0gdG9rVmFsO1xuICAgICAgbm9kZS5yYXcgPSBpbnB1dC5zbGljZSh0b2tTdGFydCwgdG9rRW5kKTtcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiTGl0ZXJhbFwiKTtcblxuICAgIGNhc2UgX25vbmU6IGNhc2UgX3RydWU6IGNhc2UgX2ZhbHNlOlxuICAgICAgdmFyIG5vZGUgPSBzdGFydE5vZGUoKTtcbiAgICAgIG5vZGUudmFsdWUgPSB0b2tUeXBlLmF0b21WYWx1ZTtcbiAgICAgIG5vZGUucmF3ID0gdG9rVHlwZS5rZXl3b3JkO1xuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJMaXRlcmFsXCIpO1xuXG4gICAgY2FzZSBfcGFyZW5MOlxuICAgICAgdmFyIHRva1N0YXJ0TG9jMSA9IHRva1N0YXJ0TG9jLCB0b2tTdGFydDEgPSB0b2tTdGFydDtcbiAgICAgIG5leHQoKTtcbiAgICAgIGlmICh0b2tUeXBlID09PSBfcGFyZW5SKSB7XG4gICAgICAgIC8vIEVtcHR5IHR1cGxlXG4gICAgICAgIHZhciBub2RlID0gcGFyc2VUdXBsZShmYWxzZSk7XG4gICAgICAgIGVhdChfcGFyZW5SKTtcbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICB9XG4gICAgICB2YXIgdmFsID0gcGFyc2VNYXliZVR1cGxlKGZhbHNlKTtcbiAgICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucykge1xuICAgICAgICB2YWwubG9jLnN0YXJ0ID0gdG9rU3RhcnRMb2MxO1xuICAgICAgICB2YWwubG9jLmVuZCA9IHRva0VuZExvYztcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLnJhbmdlcylcbiAgICAgICAgdmFsLnJhbmdlID0gW3Rva1N0YXJ0MSwgdG9rRW5kXTtcbiAgICAgIGV4cGVjdChfcGFyZW5SKTtcbiAgICAgIHJldHVybiB2YWw7XG5cbiAgICBjYXNlIF9icmFja2V0TDpcbiAgICAgIHJldHVybiBwYXJzZUxpc3QoKTtcblxuICAgIGNhc2UgX2JyYWNlTDpcbiAgICAgIHJldHVybiBwYXJzZURpY3QoX2JyYWNlUik7XG5cbiAgICBjYXNlIF9pbmRlbnQ6XG4gICAgICByYWlzZSh0b2tTdGFydCwgXCJVbmV4cGVjdGVkIGluZGVudFwiKTtcblxuICAgIGRlZmF1bHQ6XG4gICAgICB1bmV4cGVjdGVkKCk7XG4gICAgfVxuICB9XG5cbiAgLy8gUGFyc2UgbGlzdFxuXG4gIC8vIEN1c3RvbSBsaXN0IG9iamVjdCBpcyB1c2VkIHRvIHNpbXVsYXRlIG5hdGl2ZSBQeXRob24gbGlzdFxuICAvLyBFLmcuIFB5dGhvbiAnW10nIGJlY29tZXMgSmF2YVNjcmlwdCAnbmV3IF9fcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKTsnXG4gIC8vIElmIGxpc3QgY29tcHJlaGVuc2lvbiwgYnVpbGQgc29tZXRoaW5nIGxpa2UgdGhpczpcbiAgLy8oZnVuY3Rpb24oKSB7XG4gIC8vICB2YXIgX2xpc3QgPSBbXTtcbiAgLy8gIC4uLlxuICAvLyAgX2xpc3QucHVzaChleHByKTtcbiAgLy8gIHJldHVybiBfbGlzdDtcbiAgLy99KCkpO1xuXG4gIGZ1bmN0aW9uIHBhcnNlTGlzdCgpIHtcbiAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZSgpO1xuICAgIG5vZGUuYXJndW1lbnRzID0gW107XG4gICAgbmV4dCgpO1xuXG4gICAgaWYgKCFlYXQoX2JyYWNrZXRSKSkge1xuICAgICAgdmFyIGV4cHIgPSBwYXJzZUV4cHJPcHMoZmFsc2UpO1xuICAgICAgaWYgKHRva1R5cGUgPT09IF9mb3IgfHwgdG9rVHlwZSA9PT0gX2lmKSB7XG5cbiAgICAgICAgLy8gTGlzdCBjb21wcmVoZW5zaW9uXG4gICAgICAgIHZhciB0bXBWYXJTdWZmaXggPSBuZXdBc3RJZENvdW50Kys7XG4gICAgICAgIGV4cHIgPSBuYy5jcmVhdGVMaXN0Q29tcFB1c2goZXhwciwgdG1wVmFyU3VmZml4KTtcbiAgICAgICAgdmFyIGJvZHkgPSBwYXJzZUNvbXBJdGVyKGV4cHIsIHRydWUpO1xuICAgICAgICBmaW5pc2hOb2RlKG5vZGUpO1xuICAgICAgICByZXR1cm4gbmMuY3JlYXRlTGlzdENvbXBJaWZlKG5vZGUsIGJvZHksIHRtcFZhclN1ZmZpeCk7XG5cbiAgICAgIH0gZWxzZSBpZiAoZWF0KF9jb21tYSkpIHtcbiAgICAgICAgbm9kZS5hcmd1bWVudHMgPSBbZXhwcl0uY29uY2F0KHBhcnNlRXhwckxpc3QoX2JyYWNrZXRSLCB0cnVlLCBmYWxzZSkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGV4cGVjdChfYnJhY2tldFIpO1xuICAgICAgICBub2RlLmFyZ3VtZW50cyA9IFtleHByXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmaW5pc2hOb2RlKG5vZGUsIFwiTmV3RXhwcmVzc2lvblwiKTtcbiAgICB2YXIgcnVudGltZUlkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogb3B0aW9ucy5ydW50aW1lUGFyYW1OYW1lIH0pO1xuICAgIHZhciBvYmplY3RzSWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIm9iamVjdHNcIiB9KTtcbiAgICB2YXIgcnVudGltZU1lbWJlciA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZUlkLCBwcm9wZXJ0eTogb2JqZWN0c0lkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgdmFyIGxpc3RJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwibGlzdFwiIH0pO1xuICAgIG5vZGUuY2FsbGVlID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lTWVtYmVyLCBwcm9wZXJ0eTogbGlzdElkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICAvLyBQYXJzZSBhIGNvbXBfaXRlciBmcm9tIFB5dGhvbiBsYW5ndWFnZSBncmFtbWFyXG4gIC8vIFVzZWQgdG8gYnVpbGQgbGlzdCBjb21wcmVoZW5zaW9uc1xuICAvLyAnZXhwcicgaXMgdGhlIGJvZHkgdG8gYmUgdXNlZCBhZnRlciB1bnJvbGxpbmcgdGhlIGlmcyBhbmQgZm9yc1xuXG4gIGZ1bmN0aW9uIHBhcnNlQ29tcEl0ZXIoZXhwciwgZmlyc3QpIHtcbiAgICBpZiAoZmlyc3QgJiYgdG9rVHlwZSAhPT0gX2ZvcikgdW5leHBlY3RlZCgpO1xuICAgIGlmIChlYXQoX2JyYWNrZXRSKSkgcmV0dXJuIGV4cHI7XG4gICAgdmFyIG5vZGUgPSBzdGFydE5vZGUoKTtcbiAgICBpZiAoZWF0KF9mb3IpKSB7XG4gICAgICB2YXIgaW5pdCA9IHBhcnNlRXhwcmVzc2lvbihmYWxzZSwgdHJ1ZSk7XG4gICAgICB2YXIgdHVwbGVBcmdzID0gZ2V0VHVwbGVBcmdzKGluaXQpO1xuICAgICAgaWYgKCF0dXBsZUFyZ3MpIGNoZWNrTFZhbChpbml0KTtcbiAgICAgIGV4cGVjdChfaW4pO1xuICAgICAgdmFyIHJpZ2h0ID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICB2YXIgYm9keSA9IHBhcnNlQ29tcEl0ZXIoZXhwciwgZmFsc2UpO1xuICAgICAgdmFyIGJsb2NrID0gbmMuY3JlYXRlTm9kZVNwYW4oYm9keSwgYm9keSwgXCJCbG9ja1N0YXRlbWVudFwiLCB7IGJvZHk6IFtib2R5XSB9KTtcbiAgICAgIGZpbmlzaE5vZGUobm9kZSwgXCJCbG9ja1N0YXRlbWVudFwiKTtcbiAgICAgIHJldHVybiBuYy5jcmVhdGVGb3Iobm9kZSwgaW5pdCwgdHVwbGVBcmdzLCByaWdodCwgYmxvY2spO1xuICAgIH0gZWxzZSBpZiAoZWF0KF9pZikpIHtcbiAgICAgIGlmICh0b2tUeXBlID09PSBfcGFyZW5MKSBub2RlLnRlc3QgPSBwYXJzZVBhcmVuRXhwcmVzc2lvbigpO1xuICAgICAgZWxzZSBub2RlLnRlc3QgPSBwYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgIG5vZGUuY29uc2VxdWVudCA9IHBhcnNlQ29tcEl0ZXIoZXhwciwgZmFsc2UpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJJZlN0YXRlbWVudFwiKTtcbiAgICB9IGVsc2UgdW5leHBlY3RlZCgpO1xuICB9XG5cbiAgLy8gUGFyc2UgY2xhc3NcblxuICBmdW5jdGlvbiBwYXJzZUNsYXNzKGN0b3JOb2RlKSB7XG4gICAgLy8gQ29udGFpbmVyIGZvciBjbGFzcyBjb25zdHJ1Y3RvciBhbmQgcHJvdG90eXBlIGZ1bmN0aW9uc1xuICAgIHZhciBjb250YWluZXIgPSBzdGFydE5vZGVGcm9tKGN0b3JOb2RlKTtcbiAgICBjb250YWluZXIuYm9keSA9IFtdO1xuXG4gICAgLy8gUGFyc2UgY2xhc3Mgc2lnbmF0dXJlXG4gICAgY3Rvck5vZGUuaWQgPSBwYXJzZUlkZW50KCk7XG4gICAgY3Rvck5vZGUucGFyYW1zID0gW107XG4gICAgdmFyIGNsYXNzUGFyYW1zID0gW107XG4gICAgaWYgKGVhdChfcGFyZW5MKSkge1xuICAgICAgdmFyIGZpcnN0ID0gdHJ1ZTtcbiAgICAgIHdoaWxlICghZWF0KF9wYXJlblIpKSB7XG4gICAgICAgIGlmICghZmlyc3QpIGV4cGVjdChfY29tbWEpOyBlbHNlIGZpcnN0ID0gZmFsc2U7XG4gICAgICAgIGNsYXNzUGFyYW1zLnB1c2gocGFyc2VJZGVudCgpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNsYXNzUGFyYW1zLmxlbmd0aCA+IDEpIHJhaXNlKHRva1BvcywgXCJNdWx0aXBsZSBpbmhlcml0YW5jZSBub3Qgc3VwcG9ydGVkXCIpO1xuICAgIGV4cGVjdChfY29sb24pO1xuXG4gICAgLy8gU3RhcnQgbmV3IG5hbWVzcGFjZSBmb3IgY2xhc3MgYm9keVxuICAgIHNjb3BlLnN0YXJ0Q2xhc3MoY3Rvck5vZGUuaWQubmFtZSk7XG5cbiAgICAvLyBTYXZlIGEgcmVmZXJlbmNlIGZvciBzb3VyY2UgcmFuZ2VzXG4gICAgdmFyIGNsYXNzQm9keVJlZk5vZGUgPSBmaW5pc2hOb2RlKHN0YXJ0Tm9kZSgpKTtcblxuICAgIC8vIFBhcnNlIGNsYXNzIGJvZHlcbiAgICB2YXIgY2xhc3NCbG9jayA9IHBhcnNlU3VpdGUoKTtcblxuICAgIC8vIEdlbmVyYXRlIGFkZGl0aW9uYWwgQVNUIHRvIGltcGxlbWVudCBjbGFzc1xuICAgIHZhciBjbGFzc1N0bXQgPSBuYy5jcmVhdGVDbGFzcyhjb250YWluZXIsIGN0b3JOb2RlLCBjbGFzc1BhcmFtcywgY2xhc3NCb2R5UmVmTm9kZSwgY2xhc3NCbG9jayk7XG5cbiAgICBzY29wZS5lbmQoKTtcblxuICAgIHJldHVybiBjbGFzc1N0bXQ7XG4gIH1cblxuICAvLyBQYXJzZSBkaWN0aW9uYXJ5XG4gIC8vIEN1c3RvbSBkaWN0IG9iamVjdCB1c2VkIHRvIHNpbXVsYXRlIG5hdGl2ZSBQeXRob24gZGljdFxuICAvLyBFLmcuIFwieydrMSc6J3YxJywgJ2syJzondjInfVwiIGJlY29tZXMgXCJuZXcgX19weXRob25SdW50aW1lLm9iamVjdHMuZGljdChbJ2sxJywgJ3YxJ10sIFsnazInLCAndjInXSk7XCJcblxuICBmdW5jdGlvbiBwYXJzZURpY3QodG9rQ2xvc2UpIHtcbiAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZSgpLCBmaXJzdCA9IHRydWUsIGtleSwgdmFsdWU7XG4gICAgbm9kZS5hcmd1bWVudHMgPSBbXTtcbiAgICBuZXh0KCk7XG4gICAgd2hpbGUgKCFlYXQodG9rQ2xvc2UpKSB7XG4gICAgICBpZiAoIWZpcnN0KSB7XG4gICAgICAgIGV4cGVjdChfY29tbWEpO1xuICAgICAgfSBlbHNlIGZpcnN0ID0gZmFsc2U7XG5cbiAgICAgIGlmICh0b2tDbG9zZSA9PT0gX2JyYWNlUikge1xuICAgICAgICBrZXkgPSBwYXJzZVByb3BlcnR5TmFtZSgpO1xuICAgICAgICBleHBlY3QoX2NvbG9uKTtcbiAgICAgICAgdmFsdWUgPSBwYXJzZUV4cHJPcHMoZmFsc2UpO1xuICAgICAgfSBlbHNlIGlmICh0b2tDbG9zZSA9PT0gX3BhcmVuUikge1xuICAgICAgICB2YXIga2V5SWQgPSBwYXJzZUlkZW50KHRydWUpO1xuICAgICAgICBrZXkgPSBzdGFydE5vZGVGcm9tKGtleUlkKTtcbiAgICAgICAga2V5LnZhbHVlID0ga2V5SWQubmFtZTtcbiAgICAgICAgZmluaXNoTm9kZShrZXksIFwiTGl0ZXJhbFwiKTtcbiAgICAgICAgZXhwZWN0KF9lcSk7XG4gICAgICAgIHZhbHVlID0gcGFyc2VFeHByT3BzKGZhbHNlKTtcbiAgICAgIH0gZWxzZSB1bmV4cGVjdGVkKCk7XG4gICAgICBub2RlLmFyZ3VtZW50cy5wdXNoKG5jLmNyZWF0ZU5vZGVTcGFuKGtleSwgdmFsdWUsIFwiQXJyYXlFeHByZXNzaW9uXCIsIHsgZWxlbWVudHM6IFtrZXksIHZhbHVlXSB9KSk7XG4gICAgfVxuICAgIGZpbmlzaE5vZGUobm9kZSwgXCJOZXdFeHByZXNzaW9uXCIpO1xuXG4gICAgdmFyIHJ1bnRpbWVJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSB9KTtcbiAgICB2YXIgb2JqZWN0c0lkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJvYmplY3RzXCIgfSk7XG4gICAgdmFyIHJ1bnRpbWVNZW1iZXIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVJZCwgcHJvcGVydHk6IG9iamVjdHNJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgIHZhciBsaXN0SWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcImRpY3RcIiB9KTtcbiAgICBub2RlLmNhbGxlZSA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZU1lbWJlciwgcHJvcGVydHk6IGxpc3RJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuXG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZVByb3BlcnR5TmFtZSgpIHtcbiAgICBpZiAodG9rVHlwZSA9PT0gX251bSB8fCB0b2tUeXBlID09PSBfc3RyaW5nKSByZXR1cm4gcGFyc2VFeHByQXRvbSgpO1xuICAgIHJldHVybiBwYXJzZUlkZW50KHRydWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VGdW5jdGlvbihub2RlKSB7XG4gICAgLy8gVE9ETzogVGhlIG5vZGUgY3JlYXRpb24gdXRpbGl0aWVzIHVzZWQgaGVyZSBhcmUgdGlnaHRseSBjb3VwbGVkIChlLmcuIHZhcmlhYmxlIG5hbWVzKVxuXG4gICAgdmFyIHN1ZmZpeCA9IG5ld0FzdElkQ291bnQrKztcbiAgICBub2RlLmlkID0gcGFyc2VJZGVudCgpO1xuICAgIG5vZGUucGFyYW1zID0gW107XG5cbiAgICAvLyBQYXJzZSBwYXJhbWV0ZXJzXG5cbiAgICB2YXIgZm9ybWFscyA9IFtdOyAgICAgLy8gSW4gb3JkZXIsIG1heWJlIHdpdGggZGVmYXVsdCB2YWx1ZVxuICAgIHZhciBhcmdzSWQgPSBudWxsOyAgICAvLyAqYXJnc1xuICAgIHZhciBrd2FyZ3NJZCA9IG51bGw7ICAvLyAqKmt3YXJnc1xuICAgIHZhciBkZWZhdWx0c0ZvdW5kID0gZmFsc2U7XG4gICAgdmFyIGZpcnN0ID0gdHJ1ZTtcbiAgICBleHBlY3QoX3BhcmVuTCk7XG4gICAgd2hpbGUgKCFlYXQoX3BhcmVuUikpIHtcbiAgICAgIGlmICghZmlyc3QpIGV4cGVjdChfY29tbWEpOyBlbHNlIGZpcnN0ID0gZmFsc2U7XG4gICAgICBpZiAodG9rVmFsID09PSAnKicpIHtcbiAgICAgICAgaWYgKGt3YXJnc0lkKSByYWlzZSh0b2tQb3MsIFwiaW52YWxpZCBzeW50YXhcIik7XG4gICAgICAgIG5leHQoKTsgYXJnc0lkID0gcGFyc2VJZGVudCgpO1xuICAgICAgfSBlbHNlIGlmICh0b2tWYWwgPT09ICcqKicpIHtcbiAgICAgICAgbmV4dCgpOyBrd2FyZ3NJZCA9IHBhcnNlSWRlbnQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChrd2FyZ3NJZCkgcmFpc2UodG9rUG9zLCBcImludmFsaWQgc3ludGF4XCIpO1xuICAgICAgICB2YXIgcGFyYW1JZCA9IHBhcnNlSWRlbnQoKTtcbiAgICAgICAgaWYgKGVhdChfZXEpKSB7XG4gICAgICAgICAgZm9ybWFscy5wdXNoKHsgaWQ6IHBhcmFtSWQsIGV4cHI6IHBhcnNlRXhwck9wcyhmYWxzZSkgfSk7XG4gICAgICAgICAgZGVmYXVsdHNGb3VuZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGRlZmF1bHRzRm91bmQpIHJhaXNlKHRva1BvcywgXCJub24tZGVmYXVsdCBhcmd1bWVudCBmb2xsb3dzIGRlZmF1bHQgYXJndW1lbnRcIik7XG4gICAgICAgICAgaWYgKGFyZ3NJZCkgcmFpc2UodG9rUG9zLCBcIm1pc3NpbmcgcmVxdWlyZWQga2V5d29yZC1vbmx5IGFyZ3VtZW50XCIpO1xuICAgICAgICAgIGZvcm1hbHMucHVzaCh7IGlkOiBwYXJhbUlkLCBleHByOiBudWxsIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGV4cGVjdChfY29sb24pO1xuXG4gICAgLy8gU3RhcnQgYSBuZXcgc2NvcGUgd2l0aCByZWdhcmQgdG8gdGhlIGBpbkZ1bmN0aW9uYFxuICAgIC8vIGZsYWcgKHJlc3RvcmUgdGhlbSB0byB0aGVpciBvbGQgdmFsdWUgYWZ0ZXJ3YXJkcykuXG4gICAgLy8gYGluRnVuY3Rpb25gIHVzZWQgdG8gdGhyb3cgc3ludGF4IGVycm9yIGZvciBzdHJheSBgcmV0dXJuYFxuICAgIHZhciBvbGRJbkZ1bmMgPSBpbkZ1bmN0aW9uID0gdHJ1ZTtcblxuICAgIHNjb3BlLnN0YXJ0Rm4obm9kZS5pZC5uYW1lKTtcblxuICAgIC8vIElmIGNsYXNzIG1ldGhvZCwgcmVtb3ZlIGNsYXNzIGluc3RhbmNlIHZhciBmcm9tIHBhcmFtcyBhbmQgc2F2ZSBmb3IgJ3RoaXMnIHJlcGxhY2VtZW50XG4gICAgaWYgKHNjb3BlLmlzUGFyZW50Q2xhc3MoKSkge1xuICAgICAgdmFyIHNlbGZJZCA9IGZvcm1hbHMuc2hpZnQoKTtcbiAgICAgIHNjb3BlLnNldFRoaXNSZXBsYWNlKHNlbGZJZC5pZC5uYW1lKTtcbiAgICB9XG5cbiAgICB2YXIgYm9keSA9IHBhcnNlU3VpdGUoKTtcbiAgICBub2RlLmJvZHkgPSBuYy5jcmVhdGVOb2RlU3Bhbihib2R5LCBib2R5LCBcIkJsb2NrU3RhdGVtZW50XCIsIHsgYm9keTogW10gfSk7XG5cbiAgICAvLyBBZGQgcnVudGltZSBwYXJhbWV0ZXIgcHJvY2Vzc2luZ1xuICAgIC8vIFRoZSBjYWxsZXIgbWF5IHBhc3MgYSBjb21wbGV4IHBhcmFtZXRlciBvYmplY3QgYXMgYSBzaW5nbGUgcGFyYW1ldGVyIGxpa2UgdGhpczpcbiAgICAvLyB7Zm9ybWFsczpbPGV4cHI+LCA8ZXhwcj4sIC4uLl0sIGtleXdvcmRzOns8aWQ+OjxleHByPiwgPGlkPjo8ZXhwcj4sIC4uLn19XG5cbiAgICBpZiAoZm9ybWFscy5sZW5ndGggPiAwIHx8IGFyZ3NJZCB8fCBrd2FyZ3NJZCkge1xuICAgICAgLy8gdmFyIF9fcGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiBhcmd1bWVudHNbMF0uZm9ybWFscyAmJiBhcmd1bWVudHNbMF0ua2V5d29yZHMgPyBhcmd1bWVudHNbMF0gOiBudWxsO1xuICAgICAgbm9kZS5ib2R5LmJvZHkucHVzaChuYy5jcmVhdGVOb2RlUGFyYW1zQ2hlY2sobm9kZS5pZCwgc3VmZml4KSk7XG5cbiAgICAgIC8vIHZhciBfX2Zvcm1hbHNJbmRleCA9IDA7XG4gICAgICBub2RlLmJvZHkuYm9keS5wdXNoKG5jLmNyZWF0ZUdlbmVyYXRlZFZhckRlY2xGcm9tSWQobm9kZS5pZCxcbiAgICAgICAgbmMuY3JlYXRlTm9kZVNwYW4obm9kZS5pZCwgbm9kZS5pZCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ19fZm9ybWFsc0luZGV4JyArIHN1ZmZpeCB9KSxcbiAgICAgICAgbmMuY3JlYXRlTm9kZVNwYW4obm9kZS5pZCwgbm9kZS5pZCwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IDAgfSkpKTtcblxuICAgICAgLy8gdmFyIF9fYXJncyA9IGFyZ3VtZW50cztcbiAgICAgIG5vZGUuYm9keS5ib2R5LnB1c2gobmMuY3JlYXRlR2VuZXJhdGVkVmFyRGVjbEZyb21JZChub2RlLmlkLFxuICAgICAgICBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLmlkLCBub2RlLmlkLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnX19hcmdzJyArIHN1ZmZpeCB9KSxcbiAgICAgICAgbmMuY3JlYXRlTm9kZVNwYW4obm9kZS5pZCwgbm9kZS5pZCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ2FyZ3VtZW50cycgfSkpKTtcbiAgICB9XG5cbiAgICBpZiAoZm9ybWFscy5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBmdW5jdGlvbiBfX2dldFBhcmFtKHYsIGQpIHtcbiAgICAgIC8vICAgdmFyIHIgPSBkO1xuICAgICAgLy8gICBpZiAoX19wYXJhbXMpIHtcbiAgICAgIC8vICAgICBpZiAoX19mb3JtYWxzSW5kZXggPCBfX3BhcmFtcy5mb3JtYWxzLmxlbmd0aCkge1xuICAgICAgLy8gICAgICAgciA9IF9fcGFyYW1zLmZvcm1hbHNbX19mb3JtYWxzSW5kZXgrK107XG4gICAgICAvLyAgICAgfSBlbHNlIGlmICh2IGluIF9fcGFyYW1zLmtleXdvcmRzKSB7XG4gICAgICAvLyAgICAgICByID0gX19wYXJhbXMua2V5d29yZHNbdl07XG4gICAgICAvLyAgICAgICBkZWxldGUgX19wYXJhbXMua2V5d29yZHNbdl07XG4gICAgICAvLyAgICAgfVxuICAgICAgLy8gICB9IGVsc2UgaWYgKF9fZm9ybWFsc0luZGV4IDwgX19hcmdzLmxlbmd0aCkge1xuICAgICAgLy8gICAgIHIgPSBfX2FyZ3NbX19mb3JtYWxzSW5kZXgrK107XG4gICAgICAvLyAgIH1cbiAgICAgIC8vICAgcmV0dXJuIHI7XG4gICAgICAvLyB9XG4gICAgICBub2RlLmJvZHkuYm9keS5wdXNoKG5jLmNyZWF0ZU5vZGVHZXRQYXJhbUZuKG5vZGUuaWQsIHN1ZmZpeCkpO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZvcm1hbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgLy8gdmFyIDxwYXJhbT4gPSBfX2dldFBhcmFtKCc8cGFyYW0+JywgPG9wdGlvbmFsIGRlZmF1bHQ+KTtcbiAgICAgICAgdmFyIF9fZ2V0UGFyYW1DYWxsID0gbmMuY3JlYXRlTm9kZVNwYW4oZm9ybWFsc1tpXS5pZCwgZm9ybWFsc1tpXS5pZCwgXCJDYWxsRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgY2FsbGVlOiBuYy5jcmVhdGVOb2RlU3Bhbihmb3JtYWxzW2ldLmlkLCBmb3JtYWxzW2ldLmlkLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnX19nZXRQYXJhbScgKyBzdWZmaXggfSksXG4gICAgICAgICAgYXJndW1lbnRzOiBbbmMuY3JlYXRlTm9kZVNwYW4oZm9ybWFsc1tpXS5pZCwgZm9ybWFsc1tpXS5pZCwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IGZvcm1hbHNbaV0uaWQubmFtZSB9KV1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChmb3JtYWxzW2ldLmV4cHIpIF9fZ2V0UGFyYW1DYWxsLmFyZ3VtZW50cy5wdXNoKGZvcm1hbHNbaV0uZXhwcik7XG4gICAgICAgIG5vZGUuYm9keS5ib2R5LnB1c2gobmMuY3JlYXRlR2VuZXJhdGVkVmFyRGVjbEZyb21JZChmb3JtYWxzW2ldLmlkLCBmb3JtYWxzW2ldLmlkLCBfX2dldFBhcmFtQ2FsbCkpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICB2YXIgcmVmTm9kZSA9IGFyZ3NJZCB8fCBrd2FyZ3NJZDtcbiAgICBpZiAocmVmTm9kZSkge1xuICAgICAgaWYgKGFyZ3NJZCkge1xuICAgICAgICAvLyB2YXIgPGFyZ3M+ID0gW107XG4gICAgICAgIHZhciBhcmdzQXNzaWduID0gbmMuY3JlYXRlR2VuZXJhdGVkVmFyRGVjbEZyb21JZChhcmdzSWQsIGFyZ3NJZCwgbmMuY3JlYXRlTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiQXJyYXlFeHByZXNzaW9uXCIsIHsgZWxlbWVudHM6IFtdIH0pKTtcbiAgICAgICAgbm9kZS5ib2R5LmJvZHkucHVzaChhcmdzQXNzaWduKTtcbiAgICAgIH1cbiAgICAgIGlmIChrd2FyZ3NJZCkge1xuICAgICAgICAvLyB2YXIgPGt3YXJncz4gPSB7fTtcbiAgICAgICAgdmFyIGt3YXJnc0Fzc2lnbiA9IG5jLmNyZWF0ZUdlbmVyYXRlZFZhckRlY2xGcm9tSWQoa3dhcmdzSWQsIGt3YXJnc0lkLCBuYy5jcmVhdGVOb2RlU3Bhbihrd2FyZ3NJZCwga3dhcmdzSWQsIFwiT2JqZWN0RXhwcmVzc2lvblwiLCB7IHByb3BlcnRpZXM6IFtdIH0pKTtcbiAgICAgICAgbm9kZS5ib2R5LmJvZHkucHVzaChrd2FyZ3NBc3NpZ24pO1xuICAgICAgfVxuICAgICAgLy8gaWYgKF9fcGFyYW1zKSB7fVxuICAgICAgdmFyIGFyZ3NJZiA9IG5jLmNyZWF0ZU5vZGVTcGFuKHJlZk5vZGUsIHJlZk5vZGUsIFwiSWZTdGF0ZW1lbnRcIiwge1xuICAgICAgICB0ZXN0OiBuYy5jcmVhdGVOb2RlU3BhbihyZWZOb2RlLCByZWZOb2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnX19wYXJhbXMnICsgc3VmZml4IH0pLFxuICAgICAgICBjb25zZXF1ZW50OiBuYy5jcmVhdGVOb2RlU3BhbihyZWZOb2RlLCByZWZOb2RlLCBcIkJsb2NrU3RhdGVtZW50XCIsIHsgYm9keTogW10gfSl9KVxuICAgICAgaWYgKGFyZ3NJZCkge1xuICAgICAgICAvLyB3aGlsZSAoX19mb3JtYWxzSW5kZXggPCBfX3BhcmFtcy5mb3JtYWxzLmxlbmd0aCkge1xuICAgICAgICAvLyAgIDxhcmdzSWQ+LnB1c2goX19wYXJhbXMuZm9ybWFsc1tfX2Zvcm1hbHNJbmRleCsrXSk7IH1cbiAgICAgICAgYXJnc0lmLmNvbnNlcXVlbnQuYm9keS5wdXNoKG5jLmNyZWF0ZU5vZGVBcmdzV2hpbGVDb25zZXF1ZW50KGFyZ3NJZCwgc3VmZml4KSk7XG4gICAgICAgIC8vIHsgd2hpbGUgKF9fZm9ybWFsc0luZGV4IDwgX19hcmdzLmxlbmd0aCkge1xuICAgICAgICAvLyAgIDxhcmdzSWQ+LnB1c2goX19hcmdzW19fZm9ybWFsc0luZGV4KytdKTsgfX1cbiAgICAgICAgYXJnc0lmLmFsdGVybmF0ZSA9IG5jLmNyZWF0ZU5vZGVBcmdzQWx0ZXJuYXRlKGFyZ3NJZCwgc3VmZml4KTtcbiAgICAgIH1cbiAgICAgIGlmIChrd2FyZ3NJZCkge1xuICAgICAgICAvLyA8a3dhcmdzPiA9IF9fcGFyYW1zLmtleXdvcmRzXG4gICAgICAgIGFyZ3NJZi5jb25zZXF1ZW50LmJvZHkucHVzaChuYy5jcmVhdGVOb2RlU3Bhbihrd2FyZ3NJZCwga3dhcmdzSWQsIFwiRXhwcmVzc2lvblN0YXRlbWVudFwiLCB7XG4gICAgICAgICAgZXhwcmVzc2lvbjogbmMuY3JlYXRlTm9kZVNwYW4oa3dhcmdzSWQsIGt3YXJnc0lkLCBcIkFzc2lnbm1lbnRFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgIG9wZXJhdG9yOiAnPScsIGxlZnQ6IGt3YXJnc0lkLCByaWdodDogbmMuY3JlYXRlTm9kZU1lbWJJZHMoa3dhcmdzSWQsICdfX3BhcmFtcycgKyBzdWZmaXgsICdrZXl3b3JkcycpLFxuICAgICAgICAgIH0pXG4gICAgICAgIH0pKTtcbiAgICAgIH1cbiAgICAgIG5vZGUuYm9keS5ib2R5LnB1c2goYXJnc0lmKTtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0IG9yaWdpbmFsIGJvZHkgdG8gJ3JldHVybiAoZnVuY3Rpb24oKSB7PGJvZHk+fSkuY2FsbCh0aGlzKTsnXG4gICAgbm9kZS5ib2R5LmJvZHkucHVzaChuYy5jcmVhdGVOb2RlRm5Cb2R5SWlmZShib2R5KSk7XG5cbiAgICBpbkZ1bmN0aW9uID0gb2xkSW5GdW5jO1xuXG4gICAgLy8gVmVyaWZ5IHRoYXQgYXJndW1lbnQgbmFtZXMgYXJlIG5vdCByZXBlYXRlZFxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZm9ybWFscy5sZW5ndGg7ICsraSkge1xuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBpOyArK2opIGlmIChmb3JtYWxzW2ldLmlkLm5hbWUgPT09IGZvcm1hbHNbal0uaWQubmFtZSlcbiAgICAgICAgcmFpc2UoZm9ybWFsc1tpXS5pZC5zdGFydCwgXCJBcmd1bWVudCBuYW1lIGNsYXNoXCIpO1xuICAgIH1cblxuICAgIC8vIElmIGNsYXNzIG1ldGhvZCwgcmVwbGFjZSB3aXRoIHByb3RvdHlwZSBmdW5jdGlvbiBsaXRlcmFsc1xuICAgIHZhciByZXROb2RlO1xuICAgIGlmIChzY29wZS5pc1BhcmVudENsYXNzKCkpIHtcbiAgICAgIGZpbmlzaE5vZGUobm9kZSk7XG4gICAgICB2YXIgY2xhc3NJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IHNjb3BlLmdldFBhcmVudENsYXNzTmFtZSgpIH0pO1xuICAgICAgdmFyIHByb3RvdHlwZUlkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJwcm90b3R5cGVcIiB9KTtcbiAgICAgIHZhciBmdW5jdGlvbklkID0gbm9kZS5pZDtcbiAgICAgIHZhciBwcm90b3R5cGVNZW1iZXIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IGNsYXNzSWQsIHByb3BlcnR5OiBwcm90b3R5cGVJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgdmFyIGZ1bmN0aW9uTWVtYmVyID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBwcm90b3R5cGVNZW1iZXIsIHByb3BlcnR5OiBmdW5jdGlvbklkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgICB2YXIgZnVuY3Rpb25FeHByID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJGdW5jdGlvbkV4cHJlc3Npb25cIiwgeyBib2R5OiBub2RlLmJvZHksIHBhcmFtczogbm9kZS5wYXJhbXMgfSk7XG4gICAgICB2YXIgYXNzaWduRXhwciA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiQXNzaWdubWVudEV4cHJlc3Npb25cIiwgeyBsZWZ0OiBmdW5jdGlvbk1lbWJlciwgb3BlcmF0b3I6IFwiPVwiLCByaWdodDogZnVuY3Rpb25FeHByIH0pO1xuICAgICAgcmV0Tm9kZSA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiRXhwcmVzc2lvblN0YXRlbWVudFwiLCB7IGV4cHJlc3Npb246IGFzc2lnbkV4cHIgfSk7XG4gICAgfSBlbHNlIHJldE5vZGUgPSBmaW5pc2hOb2RlKG5vZGUsIFwiRnVuY3Rpb25EZWNsYXJhdGlvblwiKTtcblxuICAgIHNjb3BlLmVuZCgpO1xuXG4gICAgcmV0dXJuIHJldE5vZGU7XG4gIH1cblxuICAvLyBQYXJzZXMgYSBjb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBleHByZXNzaW9ucywgYW5kIHJldHVybnMgdGhlbSBhc1xuICAvLyBhbiBhcnJheS4gYGNsb3NlYCBpcyB0aGUgdG9rZW4gdHlwZSB0aGF0IGVuZHMgdGhlIGxpc3QsIGFuZFxuICAvLyBgYWxsb3dFbXB0eWAgY2FuIGJlIHR1cm5lZCBvbiB0byBhbGxvdyBzdWJzZXF1ZW50IGNvbW1hcyB3aXRoXG4gIC8vIG5vdGhpbmcgaW4gYmV0d2VlbiB0aGVtIHRvIGJlIHBhcnNlZCBhcyBgbnVsbGAgKHdoaWNoIGlzIG5lZWRlZFxuICAvLyBmb3IgYXJyYXkgbGl0ZXJhbHMpLlxuXG4gIGZ1bmN0aW9uIHBhcnNlRXhwckxpc3QoY2xvc2UsIGFsbG93VHJhaWxpbmdDb21tYSwgYWxsb3dFbXB0eSkge1xuICAgIHZhciBlbHRzID0gW10sIGZpcnN0ID0gdHJ1ZTtcbiAgICB3aGlsZSAoIWVhdChjbG9zZSkpIHtcbiAgICAgIGlmICghZmlyc3QpIHtcbiAgICAgICAgZXhwZWN0KF9jb21tYSk7XG4gICAgICAgIGlmIChhbGxvd1RyYWlsaW5nQ29tbWEgJiYgb3B0aW9ucy5hbGxvd1RyYWlsaW5nQ29tbWFzICYmIGVhdChjbG9zZSkpIGJyZWFrO1xuICAgICAgfSBlbHNlIGZpcnN0ID0gZmFsc2U7XG5cbiAgICAgIGlmIChhbGxvd0VtcHR5ICYmIHRva1R5cGUgPT09IF9jb21tYSkgZWx0cy5wdXNoKG51bGwpO1xuICAgICAgZWxzZSBlbHRzLnB1c2gocGFyc2VFeHByT3BzKGZhbHNlKSk7XG4gICAgfVxuICAgIHJldHVybiBlbHRzO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VQYXJhbXNMaXN0KCkge1xuICAgIC8vIEluOiBleHByLCBleHByLCAuLi4sIGlkPWV4cHIsIGlkPWV4cHIsIC4uLlxuICAgIC8vIE91dDogZXhwciwgZXhwciwgLi4uLCB7aWQ6ZXhwciwgX19rd3A6dHJ1ZX0sIHtpZDpleHByLCBfX2t3cDp0cnVlfSwgLi4uXG4gICAgdmFyIGVsdHMgPSBbXSwgZmlyc3QgPSB0cnVlO1xuICAgIHdoaWxlICghZWF0KF9wYXJlblIpKSB7XG4gICAgICBpZiAoIWZpcnN0KSBleHBlY3QoX2NvbW1hKTtcbiAgICAgIGVsc2UgZmlyc3QgPSBmYWxzZTtcbiAgICAgIHZhciBleHByID0gcGFyc2VFeHByT3BzKGZhbHNlKTtcbiAgICAgIGlmIChlYXQoX2VxKSkge1xuICAgICAgICB2YXIgcmlnaHQgPSBwYXJzZUV4cHJPcHMoZmFsc2UpO1xuICAgICAgICB2YXIga3dJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGV4cHIsIHJpZ2h0LCBcIklkZW50aWZpZXJcIiwge25hbWU6XCJfX2t3cFwifSk7XG4gICAgICAgIHZhciBrd0xpdCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGV4cHIsIHJpZ2h0LCBcIkxpdGVyYWxcIiwge3ZhbHVlOnRydWV9KTtcbiAgICAgICAgdmFyIGxlZnQgPSBuYy5jcmVhdGVOb2RlU3BhbihleHByLCByaWdodCwgXCJPYmplY3RFeHByZXNzaW9uXCIsIHsgcHJvcGVydGllczogW10gfSk7XG4gICAgICAgIGxlZnQucHJvcGVydGllcy5wdXNoKHsgdHlwZTogXCJQcm9wZXJ0eVwiLCBrZXk6IGV4cHIsIHZhbHVlOiByaWdodCwga2luZDogXCJpbml0XCIgfSk7XG4gICAgICAgIGxlZnQucHJvcGVydGllcy5wdXNoKHsgdHlwZTogXCJQcm9wZXJ0eVwiLCBrZXk6IGt3SWQsIHZhbHVlOiBrd0xpdCwga2luZDogXCJpbml0XCIgfSk7XG4gICAgICAgIGV4cHIgPSBsZWZ0O1xuICAgICAgfVxuICAgICAgZWx0cy5wdXNoKGV4cHIpO1xuICAgIH1cbiAgICByZXR1cm4gZWx0cztcbiAgfVxuXG4gIC8vIFBhcnNlIHRoZSBuZXh0IHRva2VuIGFzIGFuIGlkZW50aWZpZXIuIElmIGBsaWJlcmFsYCBpcyB0cnVlICh1c2VkXG4gIC8vIHdoZW4gcGFyc2luZyBwcm9wZXJ0aWVzKSwgaXQgd2lsbCBhbHNvIGNvbnZlcnQga2V5d29yZHMgaW50b1xuICAvLyBpZGVudGlmaWVycy5cblxuICAvLyBUT0RPOiBsaWJlcmFsP1xuXG4gIGZ1bmN0aW9uIHBhcnNlSWRlbnQobGliZXJhbCkge1xuICAgIHZhciBub2RlID0gc3RhcnROb2RlKCk7XG4gICAgaWYgKGxpYmVyYWwpIGxpYmVyYWwgPSBmYWxzZTtcbiAgICBpZiAodG9rVHlwZSA9PT0gX25hbWUpIHtcbiAgICAgIGlmICghbGliZXJhbCAmJiBzdHJpY3QgJiYgaW5wdXQuc2xpY2UodG9rU3RhcnQsIHRva0VuZCkuaW5kZXhPZihcIlxcXFxcIikgPT0gLTEpXG4gICAgICAgIHJhaXNlKHRva1N0YXJ0LCBcIlRoZSBrZXl3b3JkICdcIiArIHRva1ZhbCArIFwiJyBpcyByZXNlcnZlZFwiKTtcbiAgICAgIG5vZGUubmFtZSA9IHRva1ZhbDtcbiAgICB9IGVsc2UgaWYgKGxpYmVyYWwgJiYgdG9rVHlwZS5rZXl3b3JkKSB7XG4gICAgICBub2RlLm5hbWUgPSB0b2tUeXBlLmtleXdvcmQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHVuZXhwZWN0ZWQoKTtcbiAgICB9XG4gICAgdG9rUmVnZXhwQWxsb3dlZCA9IGZhbHNlO1xuICAgIG5leHQoKTtcbiAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIklkZW50aWZpZXJcIik7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZVR1cGxlKG5vSW4sIGV4cHIpIHtcbiAgICB2YXIgbm9kZSA9IGV4cHIgPyBzdGFydE5vZGVGcm9tKGV4cHIpIDogc3RhcnROb2RlKCk7XG4gICAgbm9kZS5hcmd1bWVudHMgPSBleHByID8gW2V4cHJdIDogW107XG5cbiAgICAvLyBUdXBsZSB3aXRoIHNpbmdsZSBlbGVtZW50IGhhcyBzcGVjaWFsIHRyYWlsaW5nIGNvbW1hOiB0ID0gJ2hpJyxcbiAgICAvLyBMb29rIGFoZWFkIGFuZCBlYXQgY29tbWEgaW4gdGhpcyBzY2VuYXJpb1xuICAgIGlmICh0b2tUeXBlID09PSBfY29tbWEpIHtcbiAgICAgIHZhciBvbGRQb3MgPSB0b2tQb3M7IHNraXBTcGFjZSgpO1xuICAgICAgdmFyIG5ld1BvcyA9IHRva1BvczsgdG9rUG9zID0gb2xkUG9zO1xuICAgICAgaWYgKG5ld1BvcyA+PSBpbnB1dExlbiB8fCBpbnB1dFtuZXdQb3NdID09PSAnOycgfHwgaW5wdXRbbmV3UG9zXSA9PT0gJyknIHx8IG5ld2xpbmUudGVzdChpbnB1dFtuZXdQb3NdKSlcbiAgICAgICAgZWF0KF9jb21tYSk7XG4gICAgfVxuXG4gICAgd2hpbGUgKGVhdChfY29tbWEpKSB7XG4gICAgICBub2RlLmFyZ3VtZW50cy5wdXNoKHBhcnNlRXhwck9wcyhub0luKSk7XG4gICAgfVxuICAgIGZpbmlzaE5vZGUobm9kZSwgXCJOZXdFeHByZXNzaW9uXCIpO1xuXG4gICAgdmFyIHJ1bnRpbWVJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSB9KTtcbiAgICB2YXIgb2JqZWN0c0lkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJvYmplY3RzXCIgfSk7XG4gICAgdmFyIHJ1bnRpbWVNZW1iZXIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVJZCwgcHJvcGVydHk6IG9iamVjdHNJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgIHZhciBsaXN0SWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcInR1cGxlXCIgfSk7XG4gICAgbm9kZS5jYWxsZWUgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVNZW1iZXIsIHByb3BlcnR5OiBsaXN0SWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcblxuICAgIHJldHVybiBub2RlO1xuICB9XG5cblxuICAvLyAjIyBQeXRob24gcnVudGltZSBsaWJyYXJ5XG5cbiAgdmFyIHB5dGhvblJ1bnRpbWUgPSBleHBvcnRzLnB5dGhvblJ1bnRpbWUgPSB7XG5cbiAgICAvLyBTaGltIEphdmFTY3JpcHQgb2JqZWN0cyB0aGF0IGltcGVyc29uYXRlIFB5dGhvbiBlcXVpdmFsZW50c1xuXG4gICAgLy8gVE9ETzogdXNlICd0eXBlJyBvciBpc1NlcXVlbmNlIGluc3RlYWQgb2YgJ2luc3RhbmNlb2YgQXJyYXknIHRvIGlkIHRoZXNlXG5cbiAgICBpbnRlcm5hbDoge1xuICAgICAgLy8gT25seSB1c2VkIHdpdGhpbiBydW50aW1lXG4gICAgICBpc1NlcTogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIGEgJiYgKGEuX3R5cGUgPT09IFwibGlzdFwiIHx8IGEuX3R5cGUgPT09IFwidHVwbGVcIik7IH0sXG4gICAgICBzbGljZTogZnVuY3Rpb24gKG9iaiwgc3RhcnQsIGVuZCwgc3RlcCkge1xuICAgICAgICBpZiAoc3RlcCA9PSBudWxsIHx8IHN0ZXAgPT09IDApIHN0ZXAgPSAxOyAvLyBUT0RPOiBzdGVwID09PSAwIGlzIGEgcnVudGltZSBlcnJvclxuICAgICAgICBpZiAoc3RhcnQgPT0gbnVsbCkge1xuICAgICAgICAgIGlmIChzdGVwIDwgMCkgc3RhcnQgPSBvYmoubGVuZ3RoIC0gMTtcbiAgICAgICAgICBlbHNlIHN0YXJ0ID0gMDtcbiAgICAgICAgfSBlbHNlIGlmIChzdGFydCA8IDApIHN0YXJ0ICs9IG9iai5sZW5ndGg7XG4gICAgICAgIGlmIChlbmQgPT0gbnVsbCkge1xuICAgICAgICAgIGlmIChzdGVwIDwgMCkgZW5kID0gLTE7XG4gICAgICAgICAgZWxzZSBlbmQgPSBvYmoubGVuZ3RoO1xuICAgICAgICB9IGVsc2UgaWYgKGVuZCA8IDApIGVuZCArPSBvYmoubGVuZ3RoO1xuXG4gICAgICAgIHZhciByZXQgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKSwgdG1wLCBpO1xuICAgICAgICBpZiAoc3RlcCA8IDApIHtcbiAgICAgICAgICB0bXAgPSBvYmouc2xpY2UoZW5kICsgMSwgc3RhcnQgKyAxKTtcbiAgICAgICAgICBmb3IgKGkgPSB0bXAubGVuZ3RoIC0gMTsgaSA+PSAwOyBpICs9IHN0ZXApIHJldC5hcHBlbmQodG1wW2ldKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0bXAgPSBvYmouc2xpY2Uoc3RhcnQsIGVuZCk7XG4gICAgICAgICAgaWYgKHN0ZXAgPT09IDEpIHJldCA9IHB5dGhvblJ1bnRpbWUudXRpbHMuY3JlYXRlTGlzdCh0bXApO1xuICAgICAgICAgIGVsc2UgZm9yIChpID0gMDsgaSA8IHRtcC5sZW5ndGg7IGkgKz0gc3RlcCkgcmV0LmFwcGVuZCh0bXBbaV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgICB9LFxuICAgICAgaXNKU0FycmF5OiBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBBcnJheV0nO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICB1dGlsczoge1xuICAgICAgY29udmVydFRvRGljdDogZnVuY3Rpb24gKGRpY3QpIHtcbiAgICAgICAgaWYgKCFkaWN0Lmhhc093blByb3BlcnR5KFwiX3R5cGVcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGljdCwgXCJfdHlwZVwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gJ2RpY3QnO30sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGljdC5oYXNPd25Qcm9wZXJ0eShcIl9pc1B5dGhvblwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaWN0LCBcIl9pc1B5dGhvblwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdHJ1ZTsgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkaWN0Lmhhc093blByb3BlcnR5KFwiaXRlbXNcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGljdCwgXCJpdGVtc1wiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHZhciBpdGVtcyA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMubGlzdCgpO1xuICAgICAgICAgICAgICBmb3IgKHZhciBrIGluIHRoaXMpIGl0ZW1zLmFwcGVuZChuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLnR1cGxlKGssIHRoaXNba10pKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkaWN0Lmhhc093blByb3BlcnR5KFwibGVuZ3RoXCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpY3QsIFwibGVuZ3RoXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzKS5sZW5ndGg7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRpY3QuaGFzT3duUHJvcGVydHkoXCJjbGVhclwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaWN0LCBcImNsZWFyXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzKSBkZWxldGUgdGhpc1tpXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGljdC5oYXNPd25Qcm9wZXJ0eShcImdldFwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaWN0LCBcImdldFwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoa2V5LCBkZWYpIHtcbiAgICAgICAgICAgICAgaWYgKGtleSBpbiB0aGlzKSByZXR1cm4gdGhpc1trZXldO1xuICAgICAgICAgICAgICBlbHNlIGlmIChkZWYgIT09IHVuZGVmaW5lZCkgcmV0dXJuIGRlZjtcbiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRpY3QuaGFzT3duUHJvcGVydHkoXCJrZXlzXCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpY3QsIFwia2V5c1wiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGljdC5oYXNPd25Qcm9wZXJ0eShcInBvcFwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaWN0LCBcInBvcFwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoa2V5LCBkZWYpIHtcbiAgICAgICAgICAgICAgdmFyIHZhbHVlO1xuICAgICAgICAgICAgICBpZiAoa2V5IGluIHRoaXMpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXNba2V5XTtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpc1trZXldO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlZiAhPT0gdW5kZWZpbmVkKSB2YWx1ZSA9IGRlZjtcbiAgICAgICAgICAgICAgZWxzZSByZXR1cm4gbmV3IEVycm9yKFwiS2V5RXJyb3JcIik7XG4gICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGljdC5oYXNPd25Qcm9wZXJ0eShcInZhbHVlc1wiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaWN0LCBcInZhbHVlc1wiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHZhciB2YWx1ZXMgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKTtcbiAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMpIHZhbHVlcy5hcHBlbmQodGhpc1trZXldKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgY3JlYXRlRGljdDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcmV0ID0gbmV3IHB5dGhvblJ1bnRpbWUub2JqZWN0cy5kaWN0KCk7XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIGFyZ3VtZW50c1swXSBpbnN0YW5jZW9mIE9iamVjdClcbiAgICAgICAgICBmb3IgKHZhciBrIGluIGFyZ3VtZW50c1swXSkgcmV0W2tdID0gYXJndW1lbnRzWzBdW2tdO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwiY3JlYXRlRGljdCBleHBlY3RzIGEgc2luZ2xlIEphdmFTY3JpcHQgb2JqZWN0XCIpXG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgICB9LFxuICAgICAgY3JlYXRlUGFyYW1zT2JqOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIEluOiBleHByLCBleHByLCAuLi4sIHtpZDpleHByLCBfX2t3cDp0cnVlfSwge2lkOmV4cHIsIF9fa3dwOnRydWV9LCAuLi5cbiAgICAgICAgLy8gT3V0OiB7Zm9ybWFsczpbZXhwciwgZXhwciwgLi4uXSwga2V5d29yZHM6e2lkOmV4cHIsIGlkOmV4cHIsIC4uLn19XG4gICAgICAgIHZhciBwYXJhbXMgPSB7IGZvcm1hbHM6IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMubGlzdCgpLCBrZXl3b3JkczogbmV3IHB5dGhvblJ1bnRpbWUub2JqZWN0cy5kaWN0KCkgfTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoYXJndW1lbnRzW2ldICYmIGFyZ3VtZW50c1tpXS5fX2t3cCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgZm9yICh2YXIgayBpbiBhcmd1bWVudHNbaV0pXG4gICAgICAgICAgICAgIGlmIChrICE9PSAnX19rd3AnKSBwYXJhbXMua2V5d29yZHNba10gPSBhcmd1bWVudHNbaV1ba107XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgcGFyYW1zLmZvcm1hbHMucHVzaChhcmd1bWVudHNbaV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXJhbXM7XG4gICAgICB9LFxuICAgICAgY29udmVydFRvTGlzdDogZnVuY3Rpb24gKGxpc3QpIHtcbiAgICAgICAgaWYgKCFsaXN0Lmhhc093blByb3BlcnR5KFwiX3R5cGVcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJfdHlwZVwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gJ2xpc3QnOyB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxpc3QuaGFzT3duUHJvcGVydHkoXCJfaXNQeXRob25cIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJfaXNQeXRob25cIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRydWU7IH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbGlzdC5oYXNPd25Qcm9wZXJ0eShcImFwcGVuZFwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShsaXN0LCBcImFwcGVuZFwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICB0aGlzLnB1c2goeCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxpc3QuaGFzT3duUHJvcGVydHkoXCJjbGVhclwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShsaXN0LCBcImNsZWFyXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgdGhpcy5zcGxpY2UoMCwgdGhpcy5sZW5ndGgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFsaXN0Lmhhc093blByb3BlcnR5KFwiY29weVwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShsaXN0LCBcImNvcHlcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zbGljZSgwKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbGlzdC5oYXNPd25Qcm9wZXJ0eShcImNvdW50XCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGxpc3QsIFwiY291bnRcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgdmFyIGMgPSAwO1xuICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspXG4gICAgICAgICAgICAgICAgaWYgKHRoaXNbaV0gPT09IHgpIGMrKztcbiAgICAgICAgICAgICAgcmV0dXJuIGM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxpc3QuaGFzT3duUHJvcGVydHkoXCJlcXVhbHNcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJlcXVhbHNcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sZW5ndGggIT09IHgubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICBpZiAodGhpc1tpXS5oYXNPd25Qcm9wZXJ0eShcImVxdWFsc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXNbaV0uZXF1YWxzKHhbaV0pKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXNbaV0gIT09IHhbaV0pIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxpc3QuaGFzT3duUHJvcGVydHkoXCJleHRlbmRcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJleHRlbmRcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKEwpIHtcbiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBMLmxlbmd0aDsgaSsrKSB0aGlzLnB1c2goTFtpXSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxpc3QuaGFzT3duUHJvcGVydHkoXCJpbmRleFwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShsaXN0LCBcImluZGV4XCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4T2YoeCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxpc3QuaGFzT3duUHJvcGVydHkoXCJpbmRleE9mXCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGxpc3QsIFwiaW5kZXhPZlwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoeCwgZnJvbUluZGV4KSB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IGZyb21JbmRleCA/IGZyb21JbmRleCA6IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICBpZiAodGhpc1tpXS5oYXNPd25Qcm9wZXJ0eShcImVxdWFsc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpc1tpXS5lcXVhbHMoeCkpIHJldHVybiBpO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzW2ldID09PSB4KSByZXR1cm4gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxpc3QuaGFzT3duUHJvcGVydHkoXCJpbnNlcnRcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJpbnNlcnRcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKGksIHgpIHtcbiAgICAgICAgICAgICAgdGhpcy5zcGxpY2UoaSwgMCwgeCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxpc3QuaGFzT3duUHJvcGVydHkoXCJwb3BcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJwb3BcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgICAgaWYgKCFpKVxuICAgICAgICAgICAgICAgIGkgPSB0aGlzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgIHZhciBpdGVtID0gdGhpc1tpXTtcbiAgICAgICAgICAgICAgdGhpcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFsaXN0Lmhhc093blByb3BlcnR5KFwiX3B5U2xpY2VcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJfcHlTbGljZVwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoc3RhcnQsIGVuZCwgc3RlcCkge1xuICAgICAgICAgICAgICByZXR1cm4gcHl0aG9uUnVudGltZS5pbnRlcm5hbC5zbGljZSh0aGlzLCBzdGFydCwgZW5kLCBzdGVwKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbGlzdC5oYXNPd25Qcm9wZXJ0eShcInJlbW92ZVwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShsaXN0LCBcInJlbW92ZVwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICB0aGlzLnNwbGljZSh0aGlzLmluZGV4T2YoeCksIDEpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFsaXN0Lmhhc093blByb3BlcnR5KFwic29ydFwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShsaXN0LCBcInNvcnRcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oeCwgcmV2ZXJzZSkge1xuICAgICAgICAgICAgICB2YXIgbGlzdDIgPSB0aGlzLnNsaWNlKDApO1xuICAgICAgICAgICAgICB2YXIgYXBwbHlfa2V5ID0gZnVuY3Rpb24oYSwgbnVtZXJpY2FsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxpc3QzID0gbGlzdDIubWFwKHgpO1xuICAgICAgICAgICAgICAgIC8vIGNvbnN0cnVjdCBhIGRpY3QgdGhhdCBtYXBzIHRoZSBsaXN0YXkgYmVmb3JlIGFuZCBhZnRlciB0aGUgbWFwXG4gICAgICAgICAgICAgICAgdmFyIG1hcHBpbmcgPSB7fVxuICAgICAgICAgICAgICAgIGZvcih2YXIgaSBpbiBsaXN0MykgbWFwcGluZ1tsaXN0M1tpXV0gPSBsaXN0MltpXTtcbiAgICAgICAgICAgICAgICBpZihudW1lcmljYWwpXG4gICAgICAgICAgICAgICAgICBsaXN0My5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIGEgLSBiOyB9KTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICBsaXN0My5zb3J0KClcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgaW4gYSkgYVtpXSA9IG1hcHBpbmdbbGlzdDNbaV1dO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGZvcih2YXIgaSBpbiB0aGlzKSB7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIHRoaXNbaV0gIT09ICdudW1iZXInIHx8ICFpc0Zpbml0ZSh0aGlzW2ldKSkge1xuICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIHggIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwbHlfa2V5KHRoaXMsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsaXN0Mi5zb3J0KCk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogaW4gdGhpcykgdGhpc1tqXSA9IGxpc3QyW2pdO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgaWYocmV2ZXJzZSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXZlcnNlKCk7XG4gICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmKHR5cGVvZiB4ICE9ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgYXBwbHlfa2V5KHRoaXMsIHRydWUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpc3QyLnNvcnQoZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gYSAtIGI7IH0pO1xuICAgICAgICAgICAgICAgIGZvcih2YXIgaSBpbiB0aGlzKSB0aGlzW2ldID0gbGlzdDJbaV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYocmV2ZXJzZSlcbiAgICAgICAgICAgICAgICB0aGlzLnJldmVyc2UoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbGlzdC5oYXNPd25Qcm9wZXJ0eShcInRvU3RyaW5nXCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGxpc3QsIFwidG9TdHJpbmdcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gJ1snICsgdGhpcy5qb2luKCcsICcpICsgJ10nO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjcmVhdGVMaXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByZXQgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKTtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgYXJndW1lbnRzWzBdIGluc3RhbmNlb2YgQXJyYXkpXG4gICAgICAgICAgZm9yICh2YXIgaSBpbiBhcmd1bWVudHNbMF0pIHJldC5wdXNoKGFyZ3VtZW50c1swXVtpXSk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBmb3IgKHZhciBpIGluIGFyZ3VtZW50cykgcmV0LnB1c2goYXJndW1lbnRzW2ldKTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgb3BzOiB7XG4gICAgICBhZGQ6IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgIGlmIChweXRob25SdW50aW1lLmludGVybmFsLmlzU2VxKGEpICYmIHB5dGhvblJ1bnRpbWUuaW50ZXJuYWwuaXNTZXEoYikpIHtcbiAgICAgICAgICBpZiAoYS5fdHlwZSAhPT0gYi5fdHlwZSlcbiAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcImNhbiBvbmx5IGNvbmNhdGVuYXRlIFwiICsgYS5fdHlwZSArIFwiIChub3QgJ1wiICsgYi5fdHlwZSArIFwiJykgdG8gXCIgKyBhLl90eXBlKTtcbiAgICAgICAgICB2YXIgcmV0O1xuICAgICAgICAgIGlmIChhLl90eXBlID09PSAnbGlzdCcpIHJldCA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMubGlzdCgpO1xuICAgICAgICAgIGVsc2UgaWYgKGEuX3R5cGUgPT09ICd0dXBsZScpIHJldCA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMudHVwbGUoKTtcbiAgICAgICAgICBpZiAocmV0KSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGEubGVuZ3RoOyBpKyspIHJldC5wdXNoKGFbaV0pO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiLmxlbmd0aDsgaSsrKSByZXQucHVzaChiW2ldKTtcbiAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhICsgYjtcbiAgICAgIH0sXG4gICAgICBpbjogZnVuY3Rpb24gKGEsIGIsIG4pIHtcbiAgICAgICAgdmFyIHIgPSBiLmhhc093blByb3BlcnR5KCdpbmRleE9mJykgPyBiLmluZGV4T2YoYSkgPj0gMCA6IGEgaW4gYjtcbiAgICAgICAgcmV0dXJuIG4gPyAhciA6IHI7XG4gICAgICB9LFxuICAgICAgbXVsdGlwbHk6IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgIC8vIFRPRE86IG5vbi1zZXF1ZW5jZSBvcGVyYW5kIG11c3QgYmUgYW4gaW50ZWdlclxuICAgICAgICBpZiAocHl0aG9uUnVudGltZS5pbnRlcm5hbC5pc1NlcShhKSAmJiAhaXNOYU4ocGFyc2VJbnQoYikpKSB7XG4gICAgICAgICAgdmFyIHJldDtcbiAgICAgICAgICBpZiAoYS5fdHlwZSA9PT0gJ2xpc3QnKSByZXQgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKTtcbiAgICAgICAgICBlbHNlIGlmIChhLl90eXBlID09PSAndHVwbGUnKSByZXQgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLnR1cGxlKCk7XG4gICAgICAgICAgaWYgKHJldCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiOyBpKyspXG4gICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgYS5sZW5ndGg7IGorKykgcmV0LnB1c2goYVtqXSk7XG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChweXRob25SdW50aW1lLmludGVybmFsLmlzU2VxKGIpICYmICFpc05hTihwYXJzZUludChhKSkpIHtcbiAgICAgICAgICB2YXIgcmV0O1xuICAgICAgICAgIGlmIChiLl90eXBlID09PSAnbGlzdCcpIHJldCA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMubGlzdCgpO1xuICAgICAgICAgIGVsc2UgaWYgKGIuX3R5cGUgPT09ICd0dXBsZScpIHJldCA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMudHVwbGUoKTtcbiAgICAgICAgICBpZiAocmV0KSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGE7IGkrKylcbiAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBiLmxlbmd0aDsgaisrKSByZXQucHVzaChiW2pdKTtcbiAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhICogYjtcbiAgICAgIH0sXG4gICAgICBzdWJzY3JpcHRJbmRleDogZnVuY3Rpb24gKG8sIGkpIHtcbiAgICAgICAgaWYgKHB5dGhvblJ1bnRpbWUuaW50ZXJuYWwuaXNTZXEobykgJiYgaSA8IDApIHJldHVybiBvLmxlbmd0aCArIGk7XG4gICAgICAgIGlmIChweXRob25SdW50aW1lLmludGVybmFsLmlzSlNBcnJheShvKSAmJiBpIDwgMCApIHJldHVybiBvLmxlbmd0aCArIGk7XG4gICAgICAgIGlmICggdHlwZW9mIG8gPT09IFwic3RyaW5nXCIgJiYgaSA8IDAgKSByZXR1cm4gby5sZW5ndGggKyBpO1xuICAgICAgICByZXR1cm4gaTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgb2JqZWN0czoge1xuICAgICAgZGljdDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb2JqID0ge307XG4gICAgICAgIGZvciAodmFyIGkgaW4gYXJndW1lbnRzKSBvYmpbYXJndW1lbnRzW2ldWzBdXSA9IGFyZ3VtZW50c1tpXVsxXTtcbiAgICAgICAgcHl0aG9uUnVudGltZS51dGlscy5jb252ZXJ0VG9EaWN0KG9iaik7XG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgICB9LFxuICAgICAgbGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJyID0gW107XG4gICAgICAgIGFyci5wdXNoLmFwcGx5KGFyciwgYXJndW1lbnRzKTtcbiAgICAgICAgcHl0aG9uUnVudGltZS51dGlscy5jb252ZXJ0VG9MaXN0KGFycik7XG4gICAgICAgIHJldHVybiBhcnI7XG4gICAgICB9LFxuICAgICAgdHVwbGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFyciA9IFtdO1xuICAgICAgICBhcnIucHVzaC5hcHBseShhcnIsIGFyZ3VtZW50cyk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhcnIsIFwiX3R5cGVcIixcbiAgICAgICAge1xuICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gJ3R1cGxlJzsgfSxcbiAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGFyciwgXCJfaXNQeXRob25cIixcbiAgICAgICAge1xuICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdHJ1ZTsgfSxcbiAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGFyciwgXCJjb3VudFwiLFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICB2YXIgYyA9IDA7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspXG4gICAgICAgICAgICAgIGlmICh0aGlzW2ldID09PSB4KSBjKys7XG4gICAgICAgICAgICByZXR1cm4gYztcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYXJyLCBcImVxdWFsc1wiLFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBpZiAodGhpcy5sZW5ndGggIT09IHgubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzW2ldLmhhc093blByb3BlcnR5KFwiZXF1YWxzXCIpKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoIXRoaXNbaV0uZXF1YWxzKHhbaV0pKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzW2ldICE9PSB4W2ldKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkgeyB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGFyciwgXCJpbmRleFwiLFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbmRleE9mKHgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhcnIsIFwiaW5kZXhPZlwiLFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICh4LCBmcm9tSW5kZXgpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIGkgPSBmcm9tSW5kZXggPyBmcm9tSW5kZXggOiAwOyBpIDwgdGhpcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzW2ldLmhhc093blByb3BlcnR5KFwiZXF1YWxzXCIpKSB7XG4gICAgICAgICAgICAgICAgICBpZiAodGhpc1tpXS5lcXVhbHMoeCkpIHJldHVybiBpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpc1tpXSA9PT0geCkgcmV0dXJuIGk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYXJyLCBcIl9weVNsaWNlXCIsXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKHN0YXJ0LCBlbmQsIHN0ZXApIHsgXG4gICAgICAgICAgICByZXR1cm4gcHl0aG9uUnVudGltZS5pbnRlcm5hbC5zbGljZSh0aGlzLCBzdGFydCwgZW5kLCBzdGVwKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhcnIsIFwidG9TdHJpbmdcIixcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcyA9ICcoJyArIHRoaXMuam9pbignLCAnKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMSkgcyArPSAnLCc7XG4gICAgICAgICAgICBzICs9ICcpJztcbiAgICAgICAgICAgIHJldHVybiBzO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBhcnI7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIFB5dGhvbiBidWlsdC1pbiBmdW5jdGlvbnNcblxuICAgIGZ1bmN0aW9uczoge1xuICAgICAgYWJzOiBmdW5jdGlvbih4KSB7XG4gICAgICAgIHJldHVybiBNYXRoLmFicyh4KTtcbiAgICAgIH0sXG4gICAgICBhbGw6IGZ1bmN0aW9uKGl0ZXJhYmxlKSB7XG4gICAgICAgIGZvciAodmFyIGkgaW4gaXRlcmFibGUpIGlmIChweXRob25SdW50aW1lLmZ1bmN0aW9ucy5ib29sKGl0ZXJhYmxlW2ldKSAhPT0gdHJ1ZSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0sXG4gICAgICBhbnk6IGZ1bmN0aW9uKGl0ZXJhYmxlKSB7XG4gICAgICAgIGZvciAodmFyIGkgaW4gaXRlcmFibGUpIGlmIChweXRob25SdW50aW1lLmZ1bmN0aW9ucy5ib29sKGl0ZXJhYmxlW2ldKSA9PT0gdHJ1ZSkgcmV0dXJuIHRydWU7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0sXG4gICAgICBhc2NpaTogZnVuY3Rpb24ob2JqKSB7XG4gICAgICAgIHZhciBzID0gcHl0aG9uUnVudGltZS5mdW5jdGlvbnMucmVwcihvYmopLFxuICAgICAgICAgICAgYXNjID0gXCJcIixcbiAgICAgICAgICAgIGNvZGU7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGNvZGUgPSBzLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgICAgaWYgKGNvZGUgPD0gMTI3KSBhc2MgKz0gc1tpXTtcbiAgICAgICAgICBlbHNlIGlmIChjb2RlIDw9IDB4RkYpIGFzYyArPSBcIlxcXFx4XCIgKyBjb2RlLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICBlbHNlIGlmICgweEQ4MDAgPD0gY29kZSAmJiBjb2RlIDw9IDB4REJGRikgeyAvLyBVQ1MtMiBmb3IgdGhlIGFzdHJhbCBjaGFyc1xuICAgICAgICAgICAgLy8gaWYgKGkrMSA+PSBzLmxlbmd0aCkgdGhyb3cgXCJIaWdoIHN1cnJvZ2F0ZSBub3QgZm9sbG93ZWQgYnkgbG93IHN1cnJvZ2F0ZVwiOyAvLyBJcyB0aGlzIG5lZWRlZD9cbiAgICAgICAgICAgIGNvZGUgPSAoKGNvZGUtMHhEODAwKSoweDQwMCkrKHMuY2hhckNvZGVBdCgrK2kpLTB4REMwMCkrMHgxMDAwMDtcbiAgICAgICAgICAgIGFzYyArPSBcIlxcXFxVXCIgKyAoXCIwMDBcIitjb2RlLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTgpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoY29kZSA8PSAweEZGRkYpIGFzYyArPSBcIlxcXFx1XCIgKyAoXCIwXCIrY29kZS50b1N0cmluZygxNikpLnNsaWNlKC00KTtcbiAgICAgICAgICBlbHNlIGlmIChjb2RlIDw9IDB4MTBGRkZGKSBhc2MgKz0gXCJcXFxcVVwiICsgKFwiMDAwXCIrY29kZS50b1N0cmluZygxNikpLnNsaWNlKC04KTtcbiAgICAgICAgICBlbHNlOyAvLyBJbnZhbGlkIHZhbHVlLCBzaG91bGQgcHJvYmFibHkgdGhyb3cgc29tZXRoaW5nLiBJdCBzaG91bGQgbmV2ZXIgZ2V0IGhlcmUgdGhvdWdoIGFzIHN0cmluZ3Mgc2hvdWxkbid0IGNvbnRhaW4gdGhlbSBpbiB0aGUgZmlyc3QgcGxhY2VcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXNjO1xuICAgICAgfSxcbiAgICAgIGJvb2w6IGZ1bmN0aW9uKHgpIHtcbiAgICAgICAgcmV0dXJuICEoeCA9PT0gdW5kZWZpbmVkIHx8IC8vIE5vIGFyZ3VtZW50XG4gICAgICAgICAgICAgICAgIHggPT09IG51bGwgfHwgLy8gTm9uZVxuICAgICAgICAgICAgICAgICB4ID09PSBmYWxzZSB8fCAvLyBGYWxzZVxuICAgICAgICAgICAgICAgICB4ID09PSAwIHx8IC8vIFplcm9cbiAgICAgICAgICAgICAgICAgeC5sZW5ndGggPT09IDAgfHwgLy8gRW1wdHkgU2VxdWVuY2VcbiAgICAgICAgICAgICAgICAgLy8gVE9ETzogRW1wdHkgTWFwcGluZywgbmVlZHMgbW9yZSBzdXBwb3J0IGZvciBweXRob24gbWFwcGluZ3MgZmlyc3RcbiAgICAgICAgICAgICAgICAgKHguX19ib29sX18gIT09IHVuZGVmaW5lZCAmJiB4Ll9fYm9vbF9fKCkgPT09IGZhbHNlKSB8fCAvLyBJZiBpdCBoYXMgYm9vbCBjb252ZXJzaW9uIGRlZmluZWRcbiAgICAgICAgICAgICAgICAgKHguX19sZW5fXyAhPT0gdW5kZWZpbmVkICYmICh4Ll9fbGVuX18oKSA9PT0gZmFsc2UgfHwgeC5fX2xlbl9fKCkgPT09IDApKSk7IC8vIElmIGl0IGhhcyBsZW5ndGggY29udmVyc2lvbiBkZWZpbmVkXG4gICAgICB9LFxuICAgICAgY2hyOiBmdW5jdGlvbihpKSB7XG4gICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGkpOyAvLyBUT0RPOiBFcnJvciBjb2RlIGZvciBub3QgMCA8PSBpIDw9IDExMTQxMTFcbiAgICAgIH0sXG4gICAgICBkaXZtb2Q6IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIHB5dGhvblJ1bnRpbWUub2JqZWN0cy50dXBsZShNYXRoLmZsb29yKGEvYiksIGElYik7XG4gICAgICB9LFxuICAgICAgZW51bWVyYXRlOiBmdW5jdGlvbihpdGVyYWJsZSwgc3RhcnQpIHtcbiAgICAgICAgc3RhcnQgPSBzdGFydCB8fCAwO1xuICAgICAgICB2YXIgcmV0ID0gbmV3IHB5dGhvblJ1bnRpbWUub2JqZWN0cy5saXN0KCk7XG4gICAgICAgIGZvciAodmFyIGkgaW4gaXRlcmFibGUpIHJldC5wdXNoKG5ldyBweXRob25SdW50aW1lLm9iamVjdHMudHVwbGUoc3RhcnQrKywgaXRlcmFibGVbaV0pKTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH0sXG4gICAgICBmaWx0ZXI6IGZ1bmN0aW9uKGZuLCBpdGVyYWJsZSkge1xuICAgICAgICBmbiA9IGZuIHx8IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRydWU7IH07XG4gICAgICAgIHZhciByZXQgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKTtcbiAgICAgICAgZm9yICh2YXIgaSBpbiBpdGVyYWJsZSkgaWYgKGZuKGl0ZXJhYmxlW2ldKSkgcmV0LnB1c2goaXRlcmFibGVbaV0pO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfSxcbiAgICAgIGZsb2F0OiBmdW5jdGlvbih4KSB7XG4gICAgICAgIGlmICh4ID09PSB1bmRlZmluZWQpIHJldHVybiAwLjA7XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiB4ID09IFwic3RyaW5nXCIpIHsgLy8gVE9ETzogRml4IHR5cGUgY2hlY2tcbiAgICAgICAgICB4ID0geC50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICBpZiAoKC9eWystXT9pbmYoaW5pdHkpPyQvaSkuZXhlYyh4KSAhPT0gbnVsbCkgcmV0dXJuIEluZmluaXR5Kih4WzBdPT09XCItXCI/LTE6MSk7XG4gICAgICAgICAgZWxzZSBpZiAoKC9ebmFuJC9pKS5leGVjKHgpICE9PSBudWxsKSByZXR1cm4gTmFOO1xuICAgICAgICAgIGVsc2UgcmV0dXJuIHBhcnNlRmxvYXQoeCk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHggPT0gXCJudW1iZXJcIikgeyAvLyBUT0RPOiBGaXggdHlwZSBjaGVja1xuICAgICAgICAgIHJldHVybiB4OyAvLyBUT0RPOiBHZXQgcHl0aG9uIHR5cGVzIHdvcmtpbmcgcmlnaHQgc28gd2UgY2FuIHJldHVybiBhbiBhY3R1YWwgZmxvYXRcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoeC5fX2Zsb2F0X18gIT09IHVuZGVmaW5lZCkgcmV0dXJuIHguX19mbG9hdF9fKCk7XG4gICAgICAgICAgZWxzZSByZXR1cm4gbnVsbDsgLy8gVE9ETzogVGhyb3cgVHlwZUVycm9yOiBmbG9hdCgpIGFyZ3VtZW50IG11c3QgYmUgYSBzdHJpbmcgb3IgYSBudW1iZXIsIG5vdCAnPHR5cGUgb2YgeD4nXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBoZXg6IGZ1bmN0aW9uKHgpIHtcbiAgICAgICAgcmV0dXJuIHgudG9TdHJpbmcoMTYpO1xuICAgICAgfSxcbiAgICAgIGludDogZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHMpO1xuICAgICAgfSxcbiAgICAgIGxlbjogZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgcmV0dXJuIG8ubGVuZ3RoO1xuICAgICAgfSxcbiAgICAgIGxpc3Q6IGZ1bmN0aW9uIChpdGVyYWJsZSkge1xuICAgICAgICB2YXIgcmV0ID0gbmV3IHB5dGhvblJ1bnRpbWUub2JqZWN0cy5saXN0KCk7XG4gICAgICAgIGlmIChpdGVyYWJsZSBpbnN0YW5jZW9mIEFycmF5KSBmb3IgKHZhciBpIGluIGl0ZXJhYmxlKSByZXQucHVzaChpdGVyYWJsZVtpXSk7XG4gICAgICAgIGVsc2UgZm9yICh2YXIgaSBpbiBpdGVyYWJsZSkgcmV0LnB1c2goaSk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgICB9LFxuICAgICAgbWFwOiBmdW5jdGlvbihmbiwgaXRlcmFibGUpIHtcbiAgICAgICAgLy8gVE9ETzogc3VwcG9ydCBhZGRpdGlvbmFsIGl0ZXJhYmxlcyBwYXNzZWRcbiAgICAgICAgdmFyIHJldCA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMubGlzdCgpO1xuICAgICAgICBmb3IgKHZhciBpIGluIGl0ZXJhYmxlKSByZXQucHVzaChmbihpdGVyYWJsZVtpXSkpO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfSxcbiAgICAgIG1heDogZnVuY3Rpb24oYXJnMSwgYXJnMikge1xuICAgICAgICAvLyBUT0RPOiBzdXBwb3J0IG9wdGlvbmFsIGtleXdvcmQtb25seSBhcmd1bWVudHNcbiAgICAgICAgLy8gVE9ETzogZW1wdHkgaXRlcmFibGUgcmFpc2VzIFB5dGhvbiBWYWx1ZUVycm9yXG4gICAgICAgIGlmICghYXJnMikgeyAvLyBpdGVyYWJsZVxuICAgICAgICAgIHZhciBtYXggPSBudWxsO1xuICAgICAgICAgIGZvciAodmFyIGkgaW4gYXJnMSkgaWYgKG1heCA9PT0gbnVsbCB8fCBhcmcxW2ldID4gbWF4KSBtYXggPSBhcmcxW2ldO1xuICAgICAgICAgIHJldHVybiBtYXg7XG4gICAgICAgIH0gZWxzZSByZXR1cm4gYXJnMSA+PSBhcmcyID8gYXJnMSA6IGFyZzI7XG4gICAgICB9LFxuICAgICAgbWluOiBmdW5jdGlvbihhcmcxLCBhcmcyKSB7XG4gICAgICAgIC8vIFRPRE86IHN1cHBvcnQgb3B0aW9uYWwga2V5d29yZC1vbmx5IGFyZ3VtZW50c1xuICAgICAgICAvLyBUT0RPOiBlbXB0eSBpdGVyYWJsZSByYWlzZXMgUHl0aG9uIFZhbHVlRXJyb3JcbiAgICAgICAgaWYgKCFhcmcyKSB7IC8vIGl0ZXJhYmxlXG4gICAgICAgICAgdmFyIG1heCA9IG51bGw7XG4gICAgICAgICAgZm9yICh2YXIgaSBpbiBhcmcxKSBpZiAobWF4ID09PSBudWxsIHx8IGFyZzFbaV0gPCBtYXgpIG1heCA9IGFyZzFbaV07XG4gICAgICAgICAgcmV0dXJuIG1heDtcbiAgICAgICAgfSBlbHNlIHJldHVybiBhcmcxIDw9IGFyZzIgPyBhcmcxIDogYXJnMjtcbiAgICAgIH0sXG4gICAgICBvY3Q6IGZ1bmN0aW9uKHgpIHtcbiAgICAgICAgcmV0dXJuIHgudG9TdHJpbmcoOCk7XG4gICAgICB9LFxuICAgICAgb3JkOiBmdW5jdGlvbihjKSB7XG4gICAgICAgIHJldHVybiBjLmNoYXJDb2RlQXQoMCk7XG4gICAgICB9LFxuICAgICAgcG93OiBmdW5jdGlvbih4LCB5LCB6KSB7XG4gICAgICAgIHJldHVybiB6ID8gTWF0aC5wb3coeCwgeSkgJSB6IDogTWF0aC5wb3coeCwgeSk7XG4gICAgICB9LFxuICAgICAgcHJpbnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHMgPSBcIlwiO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKylcbiAgICAgICAgICBzICs9IGkgPT09IDAgPyBhcmd1bWVudHNbaV0gOiBcIiBcIiArIGFyZ3VtZW50c1tpXTtcbiAgICAgICAgY29uc29sZS5sb2cocyk7XG4gICAgICB9LFxuICAgICAgcmFuZ2U6IGZ1bmN0aW9uIChzdGFydCwgc3RvcCwgc3RlcCkge1xuICAgICAgICBpZiAoc3RvcCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgc3RvcCA9IHN0YXJ0O1xuICAgICAgICAgIHN0YXJ0ID0gMDtcbiAgICAgICAgICBzdGVwID0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChzdGVwID09PSB1bmRlZmluZWQpIHN0ZXAgPSAxO1xuICAgICAgICB2YXIgciA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMubGlzdCgpO1xuICAgICAgICBpZiAoc3RhcnQgPCBzdG9wICYmIHN0ZXAgPiAwIHx8IHN0YXJ0ID4gc3RvcCAmJiBzdGVwIDwgMCkge1xuICAgICAgICAgIHZhciBpID0gc3RhcnQ7XG4gICAgICAgICAgd2hpbGUgKGkgPCBzdG9wICYmIHN0ZXAgPiAwIHx8IGkgPiBzdG9wICYmIHN0ZXAgPCAwKSB7XG4gICAgICAgICAgICByLmFwcGVuZChpKTtcbiAgICAgICAgICAgIGkgKz0gc3RlcDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHI7XG4gICAgICB9LFxuICAgICAgcmVwcjogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICBpZiAodHlwZW9mIG9iaiA9PT0gJ3N0cmluZycpIHJldHVybiBcIidcIiArIG9iaiArIFwiJ1wiOyAvLyBUT0RPOiBQYXRjaCB1bnRpbCB0eXBlc3lzdGVtIGNvbWVzIHVwLlxuICAgICAgICBpZiAob2JqLl9fcmVwcl9fICE9PSB1bmRlZmluZWQpIHJldHVybiBvYmouX19yZXByX18oKTtcbiAgICAgICAgZWxzZSBpZiAob2JqLl9fY2xhc3NfXyAhPT0gdW5kZWZpbmVkICYmIG9iai5fX2NsYXNzX18ubW9kdWxlICE9PSB1bmRlZmluZWQgJiYgb2JqLl9fY2xhc3NfXy5fX25hbWVfXykge1xuICAgICAgICAgIHJldHVybiAnPCcrb2JqLl9fY2xhc3NfXy5fX21vZHVsZV9fKycuJytvYmouX19jbGFzc19fLl9fbmFtZV9fKycgb2JqZWN0Pic7XG4gICAgICAgIH0gZWxzZSByZXR1cm4gb2JqLnRvU3RyaW5nKCk7IC8vIFJhaXNlIGEgcGxlYXNlIHJlcG9ydCB3YXJuaW5nIGhlcmUsIHdlIHNob3VsZCBuZXZlciByZWFjaCB0aGlzIHBpZWNlIG9mIGNvZGVcbiAgICAgIH0sXG4gICAgICByZXZlcnNlZDogZnVuY3Rpb24gKHNlcSkge1xuICAgICAgICB2YXIgcmV0ID0gbmV3IHB5dGhvblJ1bnRpbWUub2JqZWN0cy5saXN0KCk7XG4gICAgICAgIGZvciAodmFyIGkgaW4gc2VxKSByZXQucHVzaChzZXFbaV0pO1xuICAgICAgICByZXR1cm4gcmV0LnJldmVyc2UoKTtcbiAgICAgIH0sXG4gICAgICByb3VuZDogZnVuY3Rpb24gKG51bSwgbmRpZ2l0cykge1xuICAgICAgICBpZiAobmRpZ2l0cykge1xuICAgICAgICAgIHZhciBzY2FsZSA9IE1hdGgucG93KDEwLCBuZGlnaXRzKTtcbiAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChudW0gKiBzY2FsZSkgLyBzY2FsZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChudW0pO1xuICAgICAgfSxcbiAgICAgIHNvcnRlZDogZnVuY3Rpb24gKGl0ZXJhYmxlLCBrZXksIHJldmVyc2UpIHtcbiAgICAgICAgdmFyIHJldCA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMubGlzdCgpO1xuICAgICAgICBmb3IgKHZhciBpIGluIGl0ZXJhYmxlKSByZXQucHVzaChpdGVyYWJsZVtpXSk7XG4gICAgICAgIGlmKGtleSkgcmV0LnNvcnQoa2V5KTsgZWxzZSByZXQuc29ydCgpO1xuICAgICAgICBpZiAocmV2ZXJzZSkgcmV0LnJldmVyc2UoKTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH0sXG4gICAgICBzdHI6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgcmV0dXJuIG9iai50b1N0cmluZygpO1xuICAgICAgfSxcbiAgICAgIHN1bTogZnVuY3Rpb24gKGl0ZXJhYmxlLCBzdGFydCkge1xuICAgICAgICAvLyBUT0RPOiBzdGFydCBjYW4ndCBiZSBhIHN0cmluZ1xuICAgICAgICB2YXIgcmV0ID0gc3RhcnQgfHwgMDtcbiAgICAgICAgZm9yICh2YXIgaSBpbiBpdGVyYWJsZSkgcmV0ICs9IGl0ZXJhYmxlW2ldO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfSxcbiAgICAgIHR1cGxlOiBmdW5jdGlvbiAoaXRlcmFibGUpIHtcbiAgICAgICAgdmFyIHJldCA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMudHVwbGUoKTtcbiAgICAgICAgZm9yICh2YXIgaSBpbiBpdGVyYWJsZSkgcmV0LnB1c2goaXRlcmFibGVbaV0pO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBQeXRob24gaW1wb3J0c1xuICAgIC8vIFRPRE86IGZyb20geCBpbXBvcnQgeSwgelxuXG4gICAgaW1wb3J0czoge1xuICAgICAgcmFuZG9tOiB7XG4gICAgICAgIHJhbmRvbTogZnVuY3Rpb24gKCkgeyByZXR1cm4gTWF0aC5yYW5kb20oKTsgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbn0pO1xuIiwiLy8gRmlsYmVydDogTG9vc2UgcGFyc2VyXG4vL1xuLy8gVGhpcyBtb2R1bGUgcHJvdmlkZXMgYW4gYWx0ZXJuYXRpdmUgcGFyc2VyIChgcGFyc2VfZGFtbWl0YCkgdGhhdFxuLy8gZXhwb3NlcyB0aGF0IHNhbWUgaW50ZXJmYWNlIGFzIGBwYXJzZWAsIGJ1dCB3aWxsIHRyeSB0byBwYXJzZVxuLy8gYW55dGhpbmcgYXMgUHl0aG9uLCByZXBhaXJpbmcgc3ludGF4IGVycm9ycyB0aGUgYmVzdCBpdCBjYW4uXG4vLyBUaGVyZSBhcmUgY2lyY3Vtc3RhbmNlcyBpbiB3aGljaCBpdCB3aWxsIHJhaXNlIGFuIGVycm9yIGFuZCBnaXZlXG4vLyB1cCwgYnV0IHRoZXkgYXJlIHZlcnkgcmFyZS4gVGhlIHJlc3VsdGluZyBBU1Qgd2lsbCBiZSBhIG1vc3RseVxuLy8gdmFsaWQgSmF2YVNjcmlwdCBBU1QgKGFzIHBlciB0aGUgW01vemlsbGEgcGFyc2VyIEFQSV1bYXBpXSwgZXhjZXB0XG4vLyB0aGF0OlxuLy9cbi8vIC0gUmV0dXJuIG91dHNpZGUgZnVuY3Rpb25zIGlzIGFsbG93ZWRcbi8vXG4vLyAtIEJvZ3VzIElkZW50aWZpZXIgbm9kZXMgd2l0aCBhIG5hbWUgb2YgYFwi4pyWXCJgIGFyZSBpbnNlcnRlZCB3aGVuZXZlclxuLy8gICB0aGUgcGFyc2VyIGdvdCB0b28gY29uZnVzZWQgdG8gcmV0dXJuIGFueXRoaW5nIG1lYW5pbmdmdWwuXG4vL1xuLy8gW2FwaV06IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvU3BpZGVyTW9ua2V5L1BhcnNlcl9BUElcbi8vXG4vLyBUaGUgZXhwZWN0ZWQgdXNlIGZvciB0aGlzIGlzIHRvICpmaXJzdCogdHJ5IGBmaWxiZXJ0LnBhcnNlYCwgYW5kIG9ubHlcbi8vIGlmIHRoYXQgZmFpbHMgc3dpdGNoIHRvIGBwYXJzZV9kYW1taXRgLiBUaGUgbG9vc2UgcGFyc2VyIG1pZ2h0XG4vLyBwYXJzZSBiYWRseSBpbmRlbnRlZCBjb2RlIGluY29ycmVjdGx5LCBzbyAqKmRvbid0KiogdXNlIGl0IGFzXG4vLyB5b3VyIGRlZmF1bHQgcGFyc2VyLlxuLy9cbi8vIFF1aXRlIGEgbG90IG9mIGZpbGJlcnQuanMgaXMgZHVwbGljYXRlZCBoZXJlLiBUaGUgYWx0ZXJuYXRpdmUgd2FzIHRvXG4vLyBhZGQgYSAqbG90KiBvZiBleHRyYSBjcnVmdCB0byB0aGF0IGZpbGUsIG1ha2luZyBpdCBsZXNzIHJlYWRhYmxlXG4vLyBhbmQgc2xvd2VyLiBDb3B5aW5nIGFuZCBlZGl0aW5nIHRoZSBjb2RlIGFsbG93ZWQgaW52YXNpdmUgY2hhbmdlcyBhbmQgXG4vLyBzaW1wbGlmaWNhdGlvbnMgd2l0aG91dCBjcmVhdGluZyBhIGNvbXBsaWNhdGVkIHRhbmdsZS5cblxuKGZ1bmN0aW9uKHJvb3QsIG1vZCkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgbW9kdWxlID09IFwib2JqZWN0XCIpIHJldHVybiBtb2QoZXhwb3J0cywgcmVxdWlyZShcIi4vZmlsYmVydFwiKSk7IC8vIENvbW1vbkpTXG4gIGlmICh0eXBlb2YgZGVmaW5lID09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSByZXR1cm4gZGVmaW5lKFtcImV4cG9ydHNcIiwgXCIuL2ZpbGJlcnRfbG9vc2VcIl0sIG1vZCk7IC8vIEFNRFxuICBtb2Qocm9vdC5maWxiZXJ0X2xvb3NlIHx8IChyb290LmZpbGJlcnRfbG9vc2UgPSB7fSksIHJvb3QuZmlsYmVydCk7IC8vIFBsYWluIGJyb3dzZXIgZW52XG59KSh0aGlzLCBmdW5jdGlvbihleHBvcnRzLCBmaWxiZXJ0KSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciB0dCA9IGZpbGJlcnQudG9rVHlwZXM7XG4gIHZhciBzY29wZSA9IGZpbGJlcnQuc2NvcGU7XG4gIHZhciBpbmRlbnRIaXN0ID0gZmlsYmVydC5pbmRlbnRIaXN0O1xuXG4gIHZhciBvcHRpb25zLCBpbnB1dCwgaW5wdXRMZW4sIGZldGNoVG9rZW4sIG5jO1xuXG4gIGV4cG9ydHMucGFyc2VfZGFtbWl0ID0gZnVuY3Rpb24oaW5wdCwgb3B0cykge1xuICAgIGlucHV0ID0gU3RyaW5nKGlucHQpOyBpbnB1dExlbiA9IGlucHV0Lmxlbmd0aDtcbiAgICBzZXRPcHRpb25zKG9wdHMpO1xuICAgIGlmICghb3B0aW9ucy50YWJTaXplKSBvcHRpb25zLnRhYlNpemUgPSA0O1xuICAgIGZldGNoVG9rZW4gPSBmaWxiZXJ0LnRva2VuaXplKGlucHQsIG9wdGlvbnMpO1xuICAgIGFoZWFkLmxlbmd0aCA9IDA7XG4gICAgbmV3QXN0SWRDb3VudCA9IDA7XG4gICAgc2NvcGUuaW5pdCgpO1xuICAgIG5jID0gZmlsYmVydC5nZXROb2RlQ3JlYXRvcihzdGFydE5vZGUsIHN0YXJ0Tm9kZUZyb20sIGZpbmlzaE5vZGUsIHVucGFja1R1cGxlKTtcbiAgICBuZXh0KCk7XG4gICAgcmV0dXJuIHBhcnNlVG9wTGV2ZWwoKTtcbiAgfTtcblxuICBmdW5jdGlvbiBzZXRPcHRpb25zKG9wdHMpIHtcbiAgICBvcHRpb25zID0gb3B0cyB8fCB7fTtcbiAgICBmb3IgKHZhciBvcHQgaW4gZmlsYmVydC5kZWZhdWx0T3B0aW9ucykgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob3B0aW9ucywgb3B0KSlcbiAgICAgIG9wdGlvbnNbb3B0XSA9IGZpbGJlcnQuZGVmYXVsdE9wdGlvbnNbb3B0XTtcbiAgICBzb3VyY2VGaWxlID0gb3B0aW9ucy5zb3VyY2VGaWxlIHx8IG51bGw7XG4gIH1cblxuICB2YXIgbGFzdEVuZCwgdG9rZW4gPSB7c3RhcnQ6IDAsIGVuZDogMH0sIGFoZWFkID0gW107XG4gIHZhciBsYXN0RW5kTG9jLCBzb3VyY2VGaWxlO1xuXG4gIHZhciBuZXdBc3RJZENvdW50ID0gMDtcblxuICBmdW5jdGlvbiBuZXh0KCkge1xuICAgIGxhc3RFbmQgPSB0b2tlbi5lbmQ7XG4gICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKSBsYXN0RW5kTG9jID0gdG9rZW4uZW5kTG9jO1xuXG4gICAgaWYgKGFoZWFkLmxlbmd0aCkgdG9rZW4gPSBhaGVhZC5zaGlmdCgpO1xuICAgIGVsc2UgdG9rZW4gPSByZWFkVG9rZW4oKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRUb2tlbigpIHtcbiAgICBmb3IgKDs7KSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gZmV0Y2hUb2tlbigpO1xuICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiBTeW50YXhFcnJvcikpIHRocm93IGU7XG5cbiAgICAgICAgLy8gVHJ5IHRvIHNraXAgc29tZSB0ZXh0LCBiYXNlZCBvbiB0aGUgZXJyb3IgbWVzc2FnZSwgYW5kIHRoZW4gY29udGludWVcbiAgICAgICAgdmFyIG1zZyA9IGUubWVzc2FnZSwgcG9zID0gZS5yYWlzZWRBdCwgcmVwbGFjZSA9IHRydWU7XG4gICAgICAgIGlmICgvdW50ZXJtaW5hdGVkL2kudGVzdChtc2cpKSB7XG4gICAgICAgICAgcG9zID0gbGluZUVuZChlLnBvcyk7XG4gICAgICAgICAgaWYgKC9zdHJpbmcvLnRlc3QobXNnKSkge1xuICAgICAgICAgICAgcmVwbGFjZSA9IHtzdGFydDogZS5wb3MsIGVuZDogcG9zLCB0eXBlOiB0dC5zdHJpbmcsIHZhbHVlOiBpbnB1dC5zbGljZShlLnBvcyArIDEsIHBvcyl9O1xuICAgICAgICAgIH0gZWxzZSBpZiAoL3JlZ3VsYXIgZXhwci9pLnRlc3QobXNnKSkge1xuICAgICAgICAgICAgdmFyIHJlID0gaW5wdXQuc2xpY2UoZS5wb3MsIHBvcyk7XG4gICAgICAgICAgICB0cnkgeyByZSA9IG5ldyBSZWdFeHAocmUpOyB9IGNhdGNoKGUpIHt9XG4gICAgICAgICAgICByZXBsYWNlID0ge3N0YXJ0OiBlLnBvcywgZW5kOiBwb3MsIHR5cGU6IHR0LnJlZ2V4cCwgdmFsdWU6IHJlfTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVwbGFjZSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICgvaW52YWxpZCAodW5pY29kZXxyZWdleHB8bnVtYmVyKXxleHBlY3RpbmcgdW5pY29kZXxvY3RhbCBsaXRlcmFsfGlzIHJlc2VydmVkfGRpcmVjdGx5IGFmdGVyIG51bWJlci9pLnRlc3QobXNnKSkge1xuICAgICAgICAgIHdoaWxlIChwb3MgPCBpbnB1dC5sZW5ndGggJiYgIWlzU3BhY2UoaW5wdXQuY2hhckNvZGVBdChwb3MpKSAmJiAhaXNOZXdsaW5lKGlucHV0LmNoYXJDb2RlQXQocG9zKSkpICsrcG9zO1xuICAgICAgICB9IGVsc2UgaWYgKC9jaGFyYWN0ZXIgZXNjYXBlfGV4cGVjdGVkIGhleGFkZWNpbWFsL2kudGVzdChtc2cpKSB7XG4gICAgICAgICAgd2hpbGUgKHBvcyA8IGlucHV0Lmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIGNoID0gaW5wdXQuY2hhckNvZGVBdChwb3MrKyk7XG4gICAgICAgICAgICBpZiAoY2ggPT09IDM0IHx8IGNoID09PSAzOSB8fCBpc05ld2xpbmUoY2gpKSBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoL3VuZXhwZWN0ZWQgY2hhcmFjdGVyL2kudGVzdChtc2cpKSB7XG4gICAgICAgICAgcG9zKys7XG4gICAgICAgICAgcmVwbGFjZSA9IGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKC9yZWd1bGFyIGV4cHJlc3Npb24vaS50ZXN0KG1zZykpIHtcbiAgICAgICAgICByZXBsYWNlID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICB9XG4gICAgICAgIHJlc2V0VG8ocG9zKTtcbiAgICAgICAgaWYgKHJlcGxhY2UgPT09IHRydWUpIHJlcGxhY2UgPSB7c3RhcnQ6IHBvcywgZW5kOiBwb3MsIHR5cGU6IHR0Lm5hbWUsIHZhbHVlOiBcIuKcllwifTtcbiAgICAgICAgaWYgKHJlcGxhY2UpIHtcbiAgICAgICAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIHtcbiAgICAgICAgICAgIHJlcGxhY2Uuc3RhcnRMb2MgPSBmaWxiZXJ0LmdldExpbmVJbmZvKGlucHV0LCByZXBsYWNlLnN0YXJ0KTtcbiAgICAgICAgICAgIHJlcGxhY2UuZW5kTG9jID0gZmlsYmVydC5nZXRMaW5lSW5mbyhpbnB1dCwgcmVwbGFjZS5lbmQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcmVwbGFjZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2V0VG8ocG9zKSB7XG4gICAgdmFyIGNoID0gaW5wdXQuY2hhckF0KHBvcyAtIDEpO1xuICAgIHZhciByZUFsbG93ZWQgPSAhY2ggfHwgL1tcXFtcXHtcXCgsOzo/XFwvKj0rXFwtfiF8JiVePD5dLy50ZXN0KGNoKSB8fFxuICAgICAgL1tlbndmZF0vLnRlc3QoY2gpICYmIC9cXGIoa2V5d29yZHN8Y2FzZXxlbHNlfHJldHVybnx0aHJvd3xuZXd8aW58KGluc3RhbmNlfHR5cGUpb2Z8ZGVsZXRlfHZvaWQpJC8udGVzdChpbnB1dC5zbGljZShwb3MgLSAxMCwgcG9zKSk7XG4gICAgZmV0Y2hUb2tlbi5qdW1wVG8ocG9zLCByZUFsbG93ZWQpO1xuICB9XG5cbiAgZnVuY3Rpb24gY29weVRva2VuKHRva2VuKSB7XG4gICAgdmFyIGNvcHkgPSB7c3RhcnQ6IHRva2VuLnN0YXJ0LCBlbmQ6IHRva2VuLmVuZCwgdHlwZTogdG9rZW4udHlwZSwgdmFsdWU6IHRva2VuLnZhbHVlfTtcbiAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIHtcbiAgICAgIGNvcHkuc3RhcnRMb2MgPSB0b2tlbi5zdGFydExvYztcbiAgICAgIGNvcHkuZW5kTG9jID0gdG9rZW4uZW5kTG9jO1xuICAgIH1cbiAgICByZXR1cm4gY29weTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxvb2tBaGVhZChuKSB7XG4gICAgLy8gQ29weSB0b2tlbiBvYmplY3RzLCBiZWNhdXNlIGZldGNoVG9rZW4gd2lsbCBvdmVyd3JpdGUgdGhlIG9uZVxuICAgIC8vIGl0IHJldHVybnMsIGFuZCBpbiB0aGlzIGNhc2Ugd2Ugc3RpbGwgbmVlZCBpdFxuICAgIGlmICghYWhlYWQubGVuZ3RoKVxuICAgICAgdG9rZW4gPSBjb3B5VG9rZW4odG9rZW4pO1xuICAgIHdoaWxlIChuID4gYWhlYWQubGVuZ3RoKVxuICAgICAgYWhlYWQucHVzaChjb3B5VG9rZW4ocmVhZFRva2VuKCkpKTtcbiAgICByZXR1cm4gYWhlYWRbbi0xXTtcbiAgfVxuXG4gIHZhciBuZXdsaW5lID0gL1tcXG5cXHJcXHUyMDI4XFx1MjAyOV0vO1xuICB2YXIgbm9uQVNDSUl3aGl0ZXNwYWNlID0gL1tcXHUxNjgwXFx1MTgwZVxcdTIwMDAtXFx1MjAwYVxcdTIwMmZcXHUyMDVmXFx1MzAwMFxcdWZlZmZdLztcblxuICBmdW5jdGlvbiBpc05ld2xpbmUoY2gpIHtcbiAgICByZXR1cm4gY2ggPT09IDEwIHx8IGNoID09PSAxMyB8fCBjaCA9PT0gODIzMiB8fCBjaCA9PT0gODMyOTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gaXNTcGFjZShjaCkge1xuICAgIHJldHVybiBjaCA9PT0gOSB8fCBjaCA9PT0gMTEgfHwgY2ggPT09IDEyIHx8XG4gICAgICBjaCA9PT0gMzIgfHwgLy8gJyAnXG4gICAgICBjaCA9PT0gMzUgfHwgLy8gJyMnXG4gICAgICBjaCA9PT0gMTYwIHx8IC8vICdcXHhhMCdcbiAgICAgIGNoID49IDU3NjAgJiYgbm9uQVNDSUl3aGl0ZXNwYWNlLnRlc3QoU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpO1xuICB9XG4gIFxuICBmdW5jdGlvbiBsaW5lRW5kKHBvcykge1xuICAgIHdoaWxlIChwb3MgPCBpbnB1dC5sZW5ndGggJiYgIWlzTmV3bGluZShpbnB1dC5jaGFyQ29kZUF0KHBvcykpKSArK3BvcztcbiAgICByZXR1cm4gcG9zO1xuICB9XG5cbiAgZnVuY3Rpb24gc2tpcExpbmUoKSB7XG4gICAgZmV0Y2hUb2tlbi5qdW1wVG8obGluZUVuZCh0b2tlbi5zdGFydCksIGZhbHNlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIE5vZGUoc3RhcnQpIHtcbiAgICB0aGlzLnR5cGUgPSBudWxsO1xuICB9XG4gIE5vZGUucHJvdG90eXBlID0gZmlsYmVydC5Ob2RlLnByb3RvdHlwZTtcblxuICBmdW5jdGlvbiBTb3VyY2VMb2NhdGlvbihzdGFydCkge1xuICAgIHRoaXMuc3RhcnQgPSBzdGFydCB8fCB0b2tlbi5zdGFydExvYyB8fCB7bGluZTogMSwgY29sdW1uOiAwfTtcbiAgICB0aGlzLmVuZCA9IG51bGw7XG4gICAgaWYgKHNvdXJjZUZpbGUgIT09IG51bGwpIHRoaXMuc291cmNlID0gc291cmNlRmlsZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0YXJ0Tm9kZSgpIHtcbiAgICB2YXIgbm9kZSA9IG5ldyBOb2RlKHRva2VuLnN0YXJ0KTtcbiAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpXG4gICAgICBub2RlLmxvYyA9IG5ldyBTb3VyY2VMb2NhdGlvbigpO1xuICAgIGlmIChvcHRpb25zLmRpcmVjdFNvdXJjZUZpbGUpXG4gICAgICBub2RlLnNvdXJjZUZpbGUgPSBvcHRpb25zLmRpcmVjdFNvdXJjZUZpbGU7XG4gICAgaWYgKG9wdGlvbnMucmFuZ2VzKVxuICAgICAgbm9kZS5yYW5nZSA9IFt0b2tlbi5zdGFydCwgMF07XG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydE5vZGVGcm9tKG90aGVyKSB7XG4gICAgdmFyIG5vZGUgPSBuZXcgTm9kZShvdGhlci5zdGFydCk7XG4gICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKVxuICAgICAgbm9kZS5sb2MgPSBuZXcgU291cmNlTG9jYXRpb24ob3RoZXIubG9jLnN0YXJ0KTtcbiAgICBpZiAob3B0aW9ucy5yYW5nZXMpXG4gICAgICBub2RlLnJhbmdlID0gW290aGVyLnJhbmdlWzBdLCAwXTtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmlzaE5vZGUobm9kZSwgdHlwZSkge1xuICAgIG5vZGUudHlwZSA9IHR5cGU7XG4gICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKVxuICAgICAgbm9kZS5sb2MuZW5kID0gbGFzdEVuZExvYztcbiAgICBpZiAob3B0aW9ucy5yYW5nZXMpXG4gICAgICBub2RlLnJhbmdlWzFdID0gbGFzdEVuZDtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldER1bW15TG9jKCkge1xuICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucykge1xuICAgICAgdmFyIGxvYyA9IG5ldyBTb3VyY2VMb2NhdGlvbigpO1xuICAgICAgbG9jLmVuZCA9IGxvYy5zdGFydDtcbiAgICAgIHJldHVybiBsb2M7XG4gICAgfVxuICB9XG5cbiAgdmFyIGR1bW15Q291bnQgPSAwXG4gIGZ1bmN0aW9uIGR1bW15SWRlbnQoKSB7XG4gICAgdmFyIGR1bW15ID0gbmV3IE5vZGUodG9rZW4uc3RhcnQpO1xuICAgIGR1bW15LnR5cGUgPSBcIklkZW50aWZpZXJcIjtcbiAgICBkdW1teS5lbmQgPSB0b2tlbi5zdGFydDtcbiAgICBkdW1teS5uYW1lID0gXCJkdW1teVwiICsgZHVtbXlDb3VudCsrO1xuICAgIGR1bW15LmxvYyA9IGdldER1bW15TG9jKCk7XG4gICAgcmV0dXJuIGR1bW15O1xuICB9XG4gIGZ1bmN0aW9uIGlzRHVtbXkobm9kZSkgeyByZXR1cm4gbm9kZS5uYW1lICYmIG5vZGUubmFtZS5pbmRleE9mKFwiZHVtbXlcIikgPT09IDA7IH1cblxuICBmdW5jdGlvbiBlYXQodHlwZSkge1xuICAgIGlmICh0b2tlbi50eXBlID09PSB0eXBlKSB7XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBleHBlY3QodHlwZSkge1xuICAgIGlmIChlYXQodHlwZSkpIHJldHVybiB0cnVlO1xuICAgIGlmIChsb29rQWhlYWQoMSkudHlwZSA9PSB0eXBlKSB7XG4gICAgICBuZXh0KCk7IG5leHQoKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAobG9va0FoZWFkKDIpLnR5cGUgPT0gdHlwZSkge1xuICAgICAgbmV4dCgpOyBuZXh0KCk7IG5leHQoKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGNoZWNrTFZhbChleHByKSB7XG4gICAgaWYgKGV4cHIudHlwZSA9PT0gXCJJZGVudGlmaWVyXCIgfHwgZXhwci50eXBlID09PSBcIk1lbWJlckV4cHJlc3Npb25cIikgcmV0dXJuIGV4cHI7XG4gICAgcmV0dXJuIGR1bW15SWRlbnQoKTtcbiAgfVxuXG4gIC8vIEdldCBhcmdzIGZvciBhIG5ldyB0dXBsZSBleHByZXNzaW9uXG5cbiAgZnVuY3Rpb24gZ2V0VHVwbGVBcmdzKGV4cHIpIHtcbiAgICBpZiAoZXhwci5jYWxsZWUgJiYgZXhwci5jYWxsZWUub2JqZWN0ICYmIGV4cHIuY2FsbGVlLm9iamVjdC5vYmplY3QgJiZcbiAgICAgIGV4cHIuY2FsbGVlLm9iamVjdC5vYmplY3QubmFtZSA9PT0gb3B0aW9ucy5ydW50aW1lUGFyYW1OYW1lICYmXG4gICAgICBleHByLmNhbGxlZS5wcm9wZXJ0eSAmJiBleHByLmNhbGxlZS5wcm9wZXJ0eS5uYW1lID09PSBcInR1cGxlXCIpXG4gICAgICByZXR1cm4gZXhwci5hcmd1bWVudHM7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvLyBVbnBhY2sgYW4gbHZhbHVlIHR1cGxlIGludG8gaW5kaXZ1YWwgdmFyaWFibGUgYXNzaWdubWVudHNcbiAgLy8gJ2FyZzAsIGFyZzEgPSByaWdodCcgYmVjb21lczpcbiAgLy8gdmFyIHRtcCA9IHJpZ2h0XG4gIC8vIGFyZzAgPSB0bXBbMF1cbiAgLy8gYXJnMSA9IHRtcFsxXVxuICAvLyAuLi5cblxuICBmdW5jdGlvbiB1bnBhY2tUdXBsZSh0dXBsZUFyZ3MsIHJpZ2h0KSB7XG4gICAgdmFyIHZhclN0bXRzID0gW107XG5cbiAgICAvLyB2YXIgdG1wID0gcmlnaHRcblxuICAgIHZhciB0bXBJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKHJpZ2h0LCByaWdodCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJfX2ZpbGJlcnRUbXBcIiArIG5ld0FzdElkQ291bnQrKyB9KTtcbiAgICB2YXIgdG1wRGVjbCA9IG5jLmNyZWF0ZVZhckRlY2xGcm9tSWQocmlnaHQsIHRtcElkLCByaWdodCk7XG4gICAgdmFyU3RtdHMucHVzaCh0bXBEZWNsKTtcblxuICAgIC8vIGFyZ04gPSB0bXBbTl1cblxuICAgIGlmICh0dXBsZUFyZ3MgJiYgdHVwbGVBcmdzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHVwbGVBcmdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBsdmFsID0gdHVwbGVBcmdzW2ldO1xuICAgICAgICB2YXIgc3ViVHVwbGVBcmdzID0gZ2V0VHVwbGVBcmdzKGx2YWwpO1xuICAgICAgICBpZiAoc3ViVHVwbGVBcmdzKSB7XG4gICAgICAgICAgdmFyIHN1YkxpdCA9IG5jLmNyZWF0ZU5vZGVTcGFuKHJpZ2h0LCByaWdodCwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IGkgfSk7XG4gICAgICAgICAgdmFyIHN1YlJpZ2h0ID0gbmMuY3JlYXRlTm9kZVNwYW4ocmlnaHQsIHJpZ2h0LCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHRtcElkLCBwcm9wZXJ0eTogc3ViTGl0LCBjb21wdXRlZDogdHJ1ZSB9KTtcbiAgICAgICAgICB2YXIgc3ViU3RtdHMgPSB1bnBhY2tUdXBsZShzdWJUdXBsZUFyZ3MsIHN1YlJpZ2h0KTtcbiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHN1YlN0bXRzLmxlbmd0aDsgaisrKSB2YXJTdG10cy5wdXNoKHN1YlN0bXRzW2pdKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjaGVja0xWYWwobHZhbCk7XG4gICAgICAgICAgdmFyIGluZGV4SWQgPSBuYy5jcmVhdGVOb2RlU3BhbihyaWdodCwgcmlnaHQsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiBpIH0pO1xuICAgICAgICAgIHZhciBpbml0ID0gbmMuY3JlYXRlTm9kZVNwYW4ocmlnaHQsIHJpZ2h0LCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHRtcElkLCBwcm9wZXJ0eTogaW5kZXhJZCwgY29tcHV0ZWQ6IHRydWUgfSk7XG4gICAgICAgICAgaWYgKGx2YWwudHlwZSA9PT0gXCJJZGVudGlmaWVyXCIgJiYgIXNjb3BlLmV4aXN0cyhsdmFsLm5hbWUpKSB7XG4gICAgICAgICAgICBzY29wZS5hZGRWYXIobHZhbC5uYW1lKTtcbiAgICAgICAgICAgIHZhciB2YXJEZWNsID0gbmMuY3JlYXRlVmFyRGVjbEZyb21JZChsdmFsLCBsdmFsLCBpbml0KTtcbiAgICAgICAgICAgIHZhclN0bXRzLnB1c2godmFyRGVjbCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIG5vZGUgPSBzdGFydE5vZGVGcm9tKGx2YWwpO1xuICAgICAgICAgICAgbm9kZS5sZWZ0ID0gbHZhbDtcbiAgICAgICAgICAgIG5vZGUub3BlcmF0b3IgPSBcIj1cIjtcbiAgICAgICAgICAgIG5vZGUucmlnaHQgPSBpbml0O1xuICAgICAgICAgICAgZmluaXNoTm9kZShub2RlLCBcIkFzc2lnbm1lbnRFeHByZXNzaW9uXCIpO1xuICAgICAgICAgICAgdmFyU3RtdHMucHVzaChuYy5jcmVhdGVOb2RlRnJvbShub2RlLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIiwgeyBleHByZXNzaW9uOiBub2RlIH0pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdmFyU3RtdHM7XG4gIH1cblxuICAvLyAjIyMgU3RhdGVtZW50IHBhcnNpbmdcblxuICBmdW5jdGlvbiBwYXJzZVRvcExldmVsKCkge1xuICAgIHZhciBub2RlID0gc3RhcnROb2RlKCk7XG4gICAgbm9kZS5ib2R5ID0gW107XG4gICAgd2hpbGUgKHRva2VuLnR5cGUgIT09IHR0LmVvZikge1xuICAgICAgdmFyIHN0bXQgPSBwYXJzZVN0YXRlbWVudCgpO1xuICAgICAgaWYgKHN0bXQpIG5vZGUuYm9keS5wdXNoKHN0bXQpO1xuICAgIH1cbiAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIlByb2dyYW1cIik7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZVN0YXRlbWVudCgpIHtcbiAgICB2YXIgc3RhcnR0eXBlID0gdG9rZW4udHlwZSwgbm9kZSA9IHN0YXJ0Tm9kZSgpO1xuXG4gICAgc3dpdGNoIChzdGFydHR5cGUpIHtcblxuICAgIGNhc2UgdHQuX2JyZWFrOlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJCcmVha1N0YXRlbWVudFwiKTtcblxuICAgIGNhc2UgdHQuX2NvbnRpbnVlOlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJDb250aW51ZVN0YXRlbWVudFwiKTtcblxuICAgIGNhc2UgdHQuX2NsYXNzOlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIHBhcnNlQ2xhc3Mobm9kZSk7XG5cbiAgICBjYXNlIHR0Ll9kZWY6XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gcGFyc2VGdW5jdGlvbihub2RlKTtcblxuICAgIGNhc2UgdHQuX2ZvcjpcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBwYXJzZUZvcihub2RlKTtcblxuICAgIGNhc2UgdHQuX2Zyb206IC8vIFNraXBwaW5nIGZyb20gYW5kIGltcG9ydCBzdGF0ZW1lbnRzIGZvciBub3dcbiAgICAgIHNraXBMaW5lKCk7XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gcGFyc2VTdGF0ZW1lbnQoKTtcblxuICAgIGNhc2UgdHQuX2lmOiBjYXNlIHR0Ll9lbGlmOlxuICAgICAgbmV4dCgpO1xuICAgICAgaWYgKHRva2VuLnR5cGUgPT09IHR0LnBhcmVuTCkgbm9kZS50ZXN0ID0gcGFyc2VQYXJlbkV4cHJlc3Npb24oKTtcbiAgICAgIGVsc2Ugbm9kZS50ZXN0ID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICBleHBlY3QodHQuY29sb24pO1xuICAgICAgbm9kZS5jb25zZXF1ZW50ID0gcGFyc2VTdWl0ZSgpO1xuICAgICAgaWYgKHRva2VuLnR5cGUgPT09IHR0Ll9lbGlmKVxuICAgICAgICBub2RlLmFsdGVybmF0ZSA9IHBhcnNlU3RhdGVtZW50KCk7XG4gICAgICBlbHNlXG4gICAgICAgIG5vZGUuYWx0ZXJuYXRlID0gZWF0KHR0Ll9lbHNlKSAmJiBlYXQodHQuY29sb24pID8gcGFyc2VTdWl0ZSgpIDogbnVsbDtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiSWZTdGF0ZW1lbnRcIik7XG5cbiAgICBjYXNlIHR0Ll9pbXBvcnQ6IC8vIFNraXBwaW5nIGZyb20gYW5kIGltcG9ydCBzdGF0ZW1lbnRzIGZvciBub3dcbiAgICAgIHNraXBMaW5lKCk7XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gcGFyc2VTdGF0ZW1lbnQoKTtcblxuICAgIGNhc2UgdHQubmV3bGluZTpcbiAgICAgIC8vIFRPRE86IHBhcnNlU3RhdGVtZW50KCkgc2hvdWxkIHByb2JhYmx5IGVhdCBpdCdzIG93biBuZXdsaW5lXG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gbnVsbDtcblxuICAgIGNhc2UgdHQuX3Bhc3M6XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkVtcHR5U3RhdGVtZW50XCIpO1xuXG4gICAgY2FzZSB0dC5fcmV0dXJuOlxuICAgICAgbmV4dCgpO1xuICAgICAgaWYgKHRva2VuLnR5cGUgPT09IHR0Lm5ld2xpbmUgfHwgdG9rZW4udHlwZSA9PT0gdHQuZW9mKSBub2RlLmFyZ3VtZW50ID0gbnVsbDtcbiAgICAgIGVsc2UgeyBub2RlLmFyZ3VtZW50ID0gcGFyc2VFeHByZXNzaW9uKCk7IH1cbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiUmV0dXJuU3RhdGVtZW50XCIpOyBcblxuICAgIGNhc2UgdHQuX3doaWxlOlxuICAgICAgbmV4dCgpO1xuICAgICAgaWYgKHRva2VuLnR5cGUgPT09IHR0LnBhcmVuTCkgbm9kZS50ZXN0ID0gcGFyc2VQYXJlbkV4cHJlc3Npb24oKTtcbiAgICAgIGVsc2Ugbm9kZS50ZXN0ID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICBleHBlY3QodHQuY29sb24pO1xuICAgICAgbm9kZS5ib2R5ID0gcGFyc2VTdWl0ZSgpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJXaGlsZVN0YXRlbWVudFwiKTtcblxuICAgIGNhc2UgdHQuc2VtaTpcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiRW1wdHlTdGF0ZW1lbnRcIik7XG5cbiAgICBjYXNlIHR0LmluZGVudDpcbiAgICAgIC8vIFVuZXhwZWN0ZWQgaW5kZW50LCBsZXQncyBpZ25vcmUgaXRcbiAgICAgIGluZGVudEhpc3QudW5kb0luZGVudCgpO1xuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIHBhcnNlU3RhdGVtZW50KCk7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgdmFyIGV4cHIgPSBwYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgIGlmIChpc0R1bW15KGV4cHIpKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgICAgaWYgKHRva2VuLnR5cGUgPT09IHR0LmVvZikgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJFbXB0eVN0YXRlbWVudFwiKTtcbiAgICAgICAgcmV0dXJuIHBhcnNlU3RhdGVtZW50KCk7XG4gICAgICB9IGVsc2UgaWYgKGV4cHIudHlwZSA9PT0gXCJWYXJpYWJsZURlY2xhcmF0aW9uXCIgfHwgZXhwci50eXBlID09PSBcIkJsb2NrU3RhdGVtZW50XCIpIHtcbiAgICAgICAgcmV0dXJuIGV4cHI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBub2RlLmV4cHJlc3Npb24gPSBleHByO1xuICAgICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VTdWl0ZSgpIHtcbiAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZSgpO1xuICAgIG5vZGUuYm9keSA9IFtdO1xuICAgIGlmIChlYXQodHQubmV3bGluZSkpIHtcbiAgICAgIGVhdCh0dC5pbmRlbnQpO1xuICAgICAgd2hpbGUgKCFlYXQodHQuZGVkZW50KSAmJiB0b2tlbi50eXBlICE9PSB0dC5lb2YpIHtcbiAgICAgICAgdmFyIHN0bXQgPSBwYXJzZVN0YXRlbWVudCgpO1xuICAgICAgICBpZiAoc3RtdCkgbm9kZS5ib2R5LnB1c2goc3RtdCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIG5vZGUuYm9keS5wdXNoKHBhcnNlU3RhdGVtZW50KCkpO1xuICAgICAgbmV4dCgpO1xuICAgIH1cbiAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkJsb2NrU3RhdGVtZW50XCIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VGb3Iobm9kZSkge1xuICAgIHZhciBpbml0ID0gcGFyc2VFeHByZXNzaW9uKGZhbHNlLCB0cnVlKTtcbiAgICB2YXIgdHVwbGVBcmdzID0gZ2V0VHVwbGVBcmdzKGluaXQpO1xuICAgIGlmICghdHVwbGVBcmdzKSBjaGVja0xWYWwoaW5pdCk7XG4gICAgZXhwZWN0KHR0Ll9pbik7XG4gICAgdmFyIHJpZ2h0ID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgZXhwZWN0KHR0LmNvbG9uKTtcbiAgICB2YXIgYm9keSA9IHBhcnNlU3VpdGUoKTtcbiAgICBmaW5pc2hOb2RlKG5vZGUsIFwiQmxvY2tTdGF0ZW1lbnRcIik7XG4gICAgcmV0dXJuIG5jLmNyZWF0ZUZvcihub2RlLCBpbml0LCB0dXBsZUFyZ3MsIHJpZ2h0LCBib2R5KTtcbiAgfVxuXG4gIC8vICMjIyBFeHByZXNzaW9uIHBhcnNpbmdcblxuICBmdW5jdGlvbiBwYXJzZUV4cHJlc3Npb24obm9Db21tYSwgbm9Jbikge1xuICAgIHJldHVybiBwYXJzZU1heWJlQXNzaWduKG5vSW4pO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VQYXJlbkV4cHJlc3Npb24oKSB7XG4gICAgZXhwZWN0KHR0LnBhcmVuTCk7XG4gICAgdmFyIHZhbCA9IHBhcnNlRXhwcmVzc2lvbigpO1xuICAgIGV4cGVjdCh0dC5wYXJlblIpO1xuICAgIHJldHVybiB2YWw7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZU1heWJlQXNzaWduKG5vSW4pIHtcbiAgICB2YXIgbGVmdCA9IHBhcnNlTWF5YmVUdXBsZShub0luKTtcbiAgICBpZiAodG9rZW4udHlwZS5pc0Fzc2lnbikge1xuICAgICAgdmFyIHR1cGxlQXJncyA9IGdldFR1cGxlQXJncyhsZWZ0KTtcbiAgICAgIGlmICh0dXBsZUFyZ3MpIHtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgICB2YXIgcmlnaHQgPSBwYXJzZU1heWJlVHVwbGUobm9Jbik7XG4gICAgICAgIHZhciBibG9ja05vZGUgPSBzdGFydE5vZGVGcm9tKGxlZnQpO1xuICAgICAgICBibG9ja05vZGUuYm9keSA9IHVucGFja1R1cGxlKHR1cGxlQXJncywgcmlnaHQpO1xuICAgICAgICByZXR1cm4gZmluaXNoTm9kZShibG9ja05vZGUsIFwiQmxvY2tTdGF0ZW1lbnRcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChzY29wZS5pc0NsYXNzKCkpIHtcbiAgICAgICAgdmFyIHRoaXNFeHByID0gbmMuY3JlYXRlTm9kZUZyb20obGVmdCwgXCJUaGlzRXhwcmVzc2lvblwiKTtcbiAgICAgICAgbGVmdCA9IG5jLmNyZWF0ZU5vZGVGcm9tKGxlZnQsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogdGhpc0V4cHIsIHByb3BlcnR5OiBsZWZ0IH0pO1xuICAgICAgfVxuXG4gICAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZUZyb20obGVmdCk7XG4gICAgICBub2RlLm9wZXJhdG9yID0gdG9rZW4udmFsdWU7XG4gICAgICBub2RlLmxlZnQgPSBjaGVja0xWYWwobGVmdCk7XG4gICAgICBuZXh0KCk7XG4gICAgICBub2RlLnJpZ2h0ID0gcGFyc2VNYXliZVR1cGxlKG5vSW4pO1xuXG4gICAgICBpZiAobm9kZS5vcGVyYXRvciA9PT0gJys9JyB8fCBub2RlLm9wZXJhdG9yID09PSAnKj0nKSB7XG4gICAgICAgIHZhciByaWdodCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUucmlnaHQsIG5vZGUucmlnaHQsIFwiQ2FsbEV4cHJlc3Npb25cIik7XG4gICAgICAgIHJpZ2h0LmNhbGxlZSA9IG5jLmNyZWF0ZU5vZGVPcHNDYWxsZWUocmlnaHQsIG5vZGUub3BlcmF0b3IgPT09ICcrPScgPyBcImFkZFwiIDogXCJtdWx0aXBseVwiKTtcbiAgICAgICAgcmlnaHQuYXJndW1lbnRzID0gW2xlZnQsIG5vZGUucmlnaHRdO1xuICAgICAgICBub2RlLnJpZ2h0ID0gcmlnaHQ7XG4gICAgICAgIG5vZGUub3BlcmF0b3IgPSAnPSc7XG4gICAgICB9XG5cbiAgICAgIGlmIChsZWZ0LnR5cGUgPT09IFwiSWRlbnRpZmllclwiICYmICFzY29wZS5leGlzdHMobGVmdC5uYW1lKSkge1xuICAgICAgICBzY29wZS5hZGRWYXIobGVmdC5uYW1lKTtcbiAgICAgICAgcmV0dXJuIG5jLmNyZWF0ZVZhckRlY2xGcm9tSWQobm9kZS5sZWZ0LCBub2RlLmxlZnQsIG5vZGUucmlnaHQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkFzc2lnbm1lbnRFeHByZXNzaW9uXCIpO1xuICAgIH1cbiAgICByZXR1cm4gbGVmdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlTWF5YmVUdXBsZShub0luKSB7XG4gICAgdmFyIGV4cHIgPSBwYXJzZUV4cHJPcHMobm9Jbik7XG4gICAgaWYgKHRva2VuLnR5cGUgPT09IHR0LmNvbW1hKSB7XG4gICAgICByZXR1cm4gcGFyc2VUdXBsZShub0luLCBleHByKTtcbiAgICB9XG4gICAgcmV0dXJuIGV4cHI7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZUV4cHJPcHMobm9Jbikge1xuICAgIHJldHVybiBwYXJzZUV4cHJPcChwYXJzZU1heWJlVW5hcnkobm9JbiksIC0xLCBub0luKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlRXhwck9wKGxlZnQsIG1pblByZWMsIG5vSW4pIHtcbiAgICB2YXIgbm9kZSwgZXhwck5vZGUsIHJpZ2h0LCBvcCA9IHRva2VuLnR5cGUsIHZhbCA9IHRva2VuLnZhbHVlO1xuICAgIHZhciBwcmVjID0gb3AgPT09IHR0Ll9ub3QgPyB0dC5faW4ucHJlYyA6IG9wLnByZWM7XG4gICAgaWYgKG9wID09PSB0dC5leHBvbmVudGlhdGlvbiAmJiBwcmVjID49IG1pblByZWMpIHtcbiAgICAgIG5vZGUgPSBzdGFydE5vZGVGcm9tKGxlZnQpO1xuICAgICAgbmV4dCgpO1xuICAgICAgcmlnaHQgPSBwYXJzZUV4cHJPcChwYXJzZU1heWJlVW5hcnkobm9JbiksIHByZWMsIG5vSW4pO1xuICAgICAgZXhwck5vZGUgPSBuYy5jcmVhdGVOb2RlTWVtYmVyQ2FsbChub2RlLCBcIk1hdGhcIiwgXCJwb3dcIiwgW2xlZnQsIHJpZ2h0XSk7XG4gICAgICByZXR1cm4gcGFyc2VFeHByT3AoZXhwck5vZGUsIG1pblByZWMsIG5vSW4pO1xuICAgIH0gZWxzZSBpZiAocHJlYyAhPSBudWxsICYmICghbm9JbiB8fCBvcCAhPT0gdHQuX2luKSkge1xuICAgICAgaWYgKHByZWMgPiBtaW5QcmVjKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgICAgbm9kZSA9IHN0YXJ0Tm9kZUZyb20obGVmdCk7XG4gICAgICAgIGlmIChvcCA9PT0gdHQuZmxvb3JEaXYpIHtcbiAgICAgICAgICByaWdodCA9IHBhcnNlRXhwck9wKHBhcnNlTWF5YmVVbmFyeShub0luKSwgcHJlYywgbm9Jbik7XG4gICAgICAgICAgZmluaXNoTm9kZShub2RlKTtcbiAgICAgICAgICB2YXIgYmluRXhwciA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiQmluYXJ5RXhwcmVzc2lvblwiLCB7IGxlZnQ6IGxlZnQsIG9wZXJhdG9yOiAnLycsIHJpZ2h0OiByaWdodCB9KTtcbiAgICAgICAgICBleHByTm9kZSA9IG5jLmNyZWF0ZU5vZGVNZW1iZXJDYWxsKG5vZGUsIFwiTWF0aFwiLCBcImZsb29yXCIsIFtiaW5FeHByXSk7XG4gICAgICAgIH0gZWxzZSBpZiAob3AgPT09IHR0Ll9pbiB8fCBvcCA9PT0gdHQuX25vdCkge1xuICAgICAgICAgIGlmIChvcCA9PT0gdHQuX2luIHx8IGVhdCh0dC5faW4pKSB7XG4gICAgICAgICAgICByaWdodCA9IHBhcnNlRXhwck9wKHBhcnNlTWF5YmVVbmFyeShub0luKSwgcHJlYywgbm9Jbik7XG4gICAgICAgICAgICBmaW5pc2hOb2RlKG5vZGUpO1xuICAgICAgICAgICAgdmFyIG5vdExpdCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiBvcCA9PT0gdHQuX25vdCB9KTtcbiAgICAgICAgICAgIGV4cHJOb2RlID0gbmMuY3JlYXRlTm9kZVJ1bnRpbWVDYWxsKG5vZGUsICdvcHMnLCAnaW4nLCBbbGVmdCwgcmlnaHQsIG5vdExpdF0pO1xuICAgICAgICAgIH0gZWxzZSBleHByTm9kZSA9IGR1bW15SWRlbnQoKTtcbiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gdHQucGx1c01pbiAmJiB2YWwgPT09ICcrJyB8fCBvcCA9PT0gdHQubXVsdGlwbHlNb2R1bG8gJiYgdmFsID09PSAnKicpIHtcbiAgICAgICAgICBub2RlLmFyZ3VtZW50cyA9IFtsZWZ0XTtcbiAgICAgICAgICBub2RlLmFyZ3VtZW50cy5wdXNoKHBhcnNlRXhwck9wKHBhcnNlTWF5YmVVbmFyeShub0luKSwgcHJlYywgbm9JbikpO1xuICAgICAgICAgIGZpbmlzaE5vZGUobm9kZSwgXCJDYWxsRXhwcmVzc2lvblwiKTtcbiAgICAgICAgICBub2RlLmNhbGxlZSA9IG5jLmNyZWF0ZU5vZGVPcHNDYWxsZWUobm9kZSwgb3AgPT09IHR0LnBsdXNNaW4gPyBcImFkZFwiIDogXCJtdWx0aXBseVwiKTtcbiAgICAgICAgICBleHByTm9kZSA9IG5vZGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKG9wID09PSB0dC5faXMpIHtcbiAgICAgICAgICAgIGlmIChlYXQodHQuX25vdCkpIG5vZGUub3BlcmF0b3IgPSBcIiE9PVwiO1xuICAgICAgICAgICAgZWxzZSBub2RlLm9wZXJhdG9yID0gXCI9PT1cIjtcbiAgICAgICAgICB9IGVsc2Ugbm9kZS5vcGVyYXRvciA9IG9wLnJlcCAhPSBudWxsID8gb3AucmVwIDogdmFsO1xuXG4gICAgICAgICAgLy8gQWNjZXB0ICc9PT0nIGFzICc9PSdcbiAgICAgICAgICBpZiAoaW5wdXRbdG9rZW4uc3RhcnQgLSAxXSA9PT0gJz0nICYmIGlucHV0W3Rva2VuLnN0YXJ0IC0gMl0gPT09ICc9JykgbmV4dCgpO1xuXG4gICAgICAgICAgbm9kZS5sZWZ0ID0gbGVmdDtcbiAgICAgICAgICBub2RlLnJpZ2h0ID0gcGFyc2VFeHByT3AocGFyc2VNYXliZVVuYXJ5KG5vSW4pLCBwcmVjLCBub0luKTtcbiAgICAgICAgICBleHByTm9kZSA9IGZpbmlzaE5vZGUobm9kZSwgKG9wID09PSB0dC5fb3IgfHwgb3AgPT09IHR0Ll9hbmQpID8gXCJMb2dpY2FsRXhwcmVzc2lvblwiIDogXCJCaW5hcnlFeHByZXNzaW9uXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXJzZUV4cHJPcChleHByTm9kZSwgbWluUHJlYywgbm9Jbik7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBsZWZ0O1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VNYXliZVVuYXJ5KG5vSW4pIHtcbiAgICBpZiAodG9rZW4udHlwZS5wcmVmaXggfHwgdG9rZW4udHlwZSA9PT0gdHQucGx1c01pbikge1xuICAgICAgdmFyIHByZWMgPSB0b2tlbi50eXBlID09PSB0dC5wbHVzTWluID8gdHQucG9zTmVnTm90LnByZWMgOiB0b2tlbi50eXBlLnByZWM7XG4gICAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZSgpO1xuICAgICAgbm9kZS5vcGVyYXRvciA9IHRva2VuLnR5cGUucmVwICE9IG51bGwgPyB0b2tlbi50eXBlLnJlcCA6IHRva2VuLnZhbHVlO1xuICAgICAgbm9kZS5wcmVmaXggPSB0cnVlO1xuICAgICAgbmV4dCgpO1xuICAgICAgbm9kZS5hcmd1bWVudCA9IHBhcnNlRXhwck9wKHBhcnNlTWF5YmVVbmFyeShub0luKSwgcHJlYywgbm9Jbik7XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIlVuYXJ5RXhwcmVzc2lvblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHBhcnNlU3Vic2NyaXB0cyhwYXJzZUV4cHJBdG9tKCksIGZhbHNlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlU3Vic2NyaXB0cyhiYXNlLCBub0NhbGxzKSB7XG4gICAgdmFyIG5vZGUgPSBzdGFydE5vZGVGcm9tKGJhc2UpO1xuICAgIGlmIChlYXQodHQuZG90KSkge1xuICAgICAgdmFyIGlkID0gcGFyc2VJZGVudCh0cnVlKTtcbiAgICAgIGlmIChmaWxiZXJ0LnB5dGhvblJ1bnRpbWUuaW1wb3J0c1tiYXNlLm5hbWVdICYmIGZpbGJlcnQucHl0aG9uUnVudGltZS5pbXBvcnRzW2Jhc2UubmFtZV1baWQubmFtZV0pIHtcbiAgICAgICAgLy8gQ2FsbGluZyBhIFB5dGhvbiBpbXBvcnQgZnVuY3Rpb25cbiAgICAgICAgdmFyIHJ1bnRpbWVJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSB9KTtcbiAgICAgICAgdmFyIGltcG9ydHNJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiaW1wb3J0c1wiIH0pO1xuICAgICAgICB2YXIgcnVudGltZU1lbWJlciA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZUlkLCBwcm9wZXJ0eTogaW1wb3J0c0lkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgICAgIG5vZGUub2JqZWN0ID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lTWVtYmVyLCBwcm9wZXJ0eTogYmFzZSwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgfSBlbHNlIGlmIChiYXNlLm5hbWUgJiYgYmFzZS5uYW1lID09PSBzY29wZS5nZXRUaGlzUmVwbGFjZSgpKSB7XG4gICAgICAgIG5vZGUub2JqZWN0ID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJUaGlzRXhwcmVzc2lvblwiKTtcbiAgICAgIH0gZWxzZSBub2RlLm9iamVjdCA9IGJhc2U7XG4gICAgICBub2RlLnByb3BlcnR5ID0gaWQ7XG4gICAgICBub2RlLmNvbXB1dGVkID0gZmFsc2U7XG4gICAgICByZXR1cm4gcGFyc2VTdWJzY3JpcHRzKGZpbmlzaE5vZGUobm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIpLCBub0NhbGxzKTtcbiAgICB9IGVsc2UgaWYgKGVhdCh0dC5icmFja2V0TCkpIHtcbiAgICAgIHZhciBleHByLCBpc1NsaWNlID0gZmFsc2U7XG4gICAgICBpZiAoZWF0KHR0LmNvbG9uKSkgaXNTbGljZSA9IHRydWU7XG4gICAgICBlbHNlIGV4cHIgPSBwYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgIGlmICghaXNTbGljZSAmJiBlYXQodHQuY29sb24pKSBpc1NsaWNlID0gdHJ1ZTtcbiAgICAgIGlmIChpc1NsaWNlKSByZXR1cm4gcGFyc2VTbGljZShub2RlLCBiYXNlLCBleHByLCBub0NhbGxzKTtcbiAgICAgIHZhciBzdWJzY3JpcHRDYWxsID0gbmMuY3JlYXRlTm9kZVNwYW4oZXhwciwgZXhwciwgXCJDYWxsRXhwcmVzc2lvblwiKTtcbiAgICAgIHN1YnNjcmlwdENhbGwuY2FsbGVlID0gbmMuY3JlYXRlTm9kZU9wc0NhbGxlZShleHByLCBcInN1YnNjcmlwdEluZGV4XCIpO1xuICAgICAgc3Vic2NyaXB0Q2FsbC5hcmd1bWVudHMgPSBbYmFzZSwgZXhwcl07XG4gICAgICBub2RlLm9iamVjdCA9IGJhc2U7XG4gICAgICBub2RlLnByb3BlcnR5ID0gc3Vic2NyaXB0Q2FsbDtcbiAgICAgIG5vZGUuY29tcHV0ZWQgPSB0cnVlO1xuICAgICAgZXhwZWN0KHR0LmJyYWNrZXRSKTtcbiAgICAgIHJldHVybiBwYXJzZVN1YnNjcmlwdHMoZmluaXNoTm9kZShub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiksIG5vQ2FsbHMpO1xuICAgIH0gZWxzZSBpZiAoIW5vQ2FsbHMgJiYgZWF0KHR0LnBhcmVuTCkpIHtcbiAgICAgIGlmIChzY29wZS5pc1VzZXJGdW5jdGlvbihiYXNlLm5hbWUpKSB7XG4gICAgICAgIC8vIFVucGFjayBwYXJhbWV0ZXJzIGludG8gSmF2YVNjcmlwdC1mcmllbmRseSBwYXJhbWV0ZXJzLCBmdXJ0aGVyIHByb2Nlc3NlZCBhdCBydW50aW1lXG4gICAgICAgIHZhciBjcmVhdGVQYXJhbXNDYWxsID0gbmMuY3JlYXRlTm9kZVJ1bnRpbWVDYWxsKG5vZGUsICd1dGlscycsICdjcmVhdGVQYXJhbXNPYmonLCBwYXJzZVBhcmFtc0xpc3QoKSk7XG4gICAgICAgIG5vZGUuYXJndW1lbnRzID0gW2NyZWF0ZVBhcmFtc0NhbGxdO1xuICAgICAgfSBlbHNlIG5vZGUuYXJndW1lbnRzID0gcGFyc2VFeHByTGlzdCh0dC5wYXJlblIsIGZhbHNlKTtcbiAgICAgIFxuICAgICAgaWYgKHNjb3BlLmlzTmV3T2JqKGJhc2UubmFtZSkpIGZpbmlzaE5vZGUobm9kZSwgXCJOZXdFeHByZXNzaW9uXCIpO1xuICAgICAgZWxzZSBmaW5pc2hOb2RlKG5vZGUsIFwiQ2FsbEV4cHJlc3Npb25cIik7XG4gICAgICBpZiAoZmlsYmVydC5weXRob25SdW50aW1lLmZ1bmN0aW9uc1tiYXNlLm5hbWVdKSB7XG4gICAgICAgIC8vIENhbGxpbmcgYSBQeXRob24gYnVpbHQtaW4gZnVuY3Rpb25cbiAgICAgICAgdmFyIHJ1bnRpbWVJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSB9KTtcbiAgICAgICAgdmFyIGZ1bmN0aW9uc0lkID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJmdW5jdGlvbnNcIiB9KTtcbiAgICAgICAgdmFyIHJ1bnRpbWVNZW1iZXIgPSBuYy5jcmVhdGVOb2RlU3BhbihiYXNlLCBiYXNlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVJZCwgcHJvcGVydHk6IGZ1bmN0aW9uc0lkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgICAgIG5vZGUuY2FsbGVlID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lTWVtYmVyLCBwcm9wZXJ0eTogYmFzZSwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgfSBlbHNlIG5vZGUuY2FsbGVlID0gYmFzZTtcbiAgICAgIHJldHVybiBwYXJzZVN1YnNjcmlwdHMobm9kZSwgbm9DYWxscyk7XG4gICAgfVxuICAgIHJldHVybiBiYXNlO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VTbGljZShub2RlLCBiYXNlLCBzdGFydCwgbm9DYWxscykge1xuICAgIHZhciBlbmQsIHN0ZXA7XG4gICAgaWYgKCFzdGFydCkgc3RhcnQgPSBuYy5jcmVhdGVOb2RlRnJvbShub2RlLCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogbnVsbCB9KTtcbiAgICBpZiAodG9rZW4udHlwZSA9PT0gdHQuYnJhY2tldFIgfHwgZWF0KHR0LmNvbG9uKSkge1xuICAgICAgZW5kID0gbmMuY3JlYXRlTm9kZUZyb20obm9kZSwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IG51bGwgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVuZCA9IHBhcnNlRXhwcmVzc2lvbigpO1xuICAgICAgaWYgKHRva2VuLnR5cGUgIT09IHR0LmJyYWNrZXRSKSBleHBlY3QodHQuY29sb24pO1xuICAgIH1cbiAgICBpZiAodG9rZW4udHlwZSA9PT0gdHQuYnJhY2tldFIpIHN0ZXAgPSBuYy5jcmVhdGVOb2RlRnJvbShub2RlLCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogbnVsbCB9KTtcbiAgICBlbHNlIHN0ZXAgPSBwYXJzZUV4cHJlc3Npb24oKTtcbiAgICBleHBlY3QodHQuYnJhY2tldFIpO1xuXG4gICAgbm9kZS5hcmd1bWVudHMgPSBbc3RhcnQsIGVuZCwgc3RlcF07XG4gICAgdmFyIHNsaWNlSWQgPSBuYy5jcmVhdGVOb2RlRnJvbShiYXNlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIl9weVNsaWNlXCIgfSk7XG4gICAgdmFyIG1lbWJlckV4cHIgPSBuYy5jcmVhdGVOb2RlU3BhbihiYXNlLCBiYXNlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IGJhc2UsIHByb3BlcnR5OiBzbGljZUlkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgbm9kZS5jYWxsZWUgPSBtZW1iZXJFeHByO1xuICAgIHJldHVybiBwYXJzZVN1YnNjcmlwdHMoZmluaXNoTm9kZShub2RlLCBcIkNhbGxFeHByZXNzaW9uXCIpLCBub0NhbGxzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlRXhwckF0b20oKSB7XG4gICAgc3dpdGNoICh0b2tlbi50eXBlKSB7XG5cbiAgICBjYXNlIHR0Ll9kaWN0OlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIHBhcnNlRGljdCh0dC5wYXJlblIpO1xuXG4gICAgY2FzZSB0dC5uYW1lOlxuICAgICAgcmV0dXJuIHBhcnNlSWRlbnQoKTtcblxuICAgIGNhc2UgdHQubnVtOiBjYXNlIHR0LnN0cmluZzogY2FzZSB0dC5yZWdleHA6XG4gICAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZSgpO1xuICAgICAgbm9kZS52YWx1ZSA9IHRva2VuLnZhbHVlO1xuICAgICAgbm9kZS5yYXcgPSBpbnB1dC5zbGljZSh0b2tlbi5zdGFydCwgdG9rZW4uZW5kKTtcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiTGl0ZXJhbFwiKTtcblxuICAgIGNhc2UgdHQuX05vbmU6IGNhc2UgdHQuX1RydWU6IGNhc2UgdHQuX0ZhbHNlOlxuICAgICAgdmFyIG5vZGUgPSBzdGFydE5vZGUoKTtcbiAgICAgIG5vZGUudmFsdWUgPSB0b2tlbi50eXBlLmF0b21WYWx1ZTtcbiAgICAgIG5vZGUucmF3ID0gdG9rZW4udHlwZS5rZXl3b3JkO1xuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJMaXRlcmFsXCIpO1xuXG4gICAgY2FzZSB0dC5wYXJlbkw6XG4gICAgICB2YXIgdG9rU3RhcnRMb2MxID0gdG9rZW4uc3RhcnRMb2MsIHRva1N0YXJ0MSA9IHRva2VuLnN0YXJ0O1xuICAgICAgbmV4dCgpO1xuICAgICAgaWYgKHRva2VuLnR5cGUgPT09IHR0LnBhcmVuUikge1xuICAgICAgICB2YXIgbm9kZSA9IHBhcnNlVHVwbGUodHJ1ZSk7XG4gICAgICAgIGVhdCh0dC5wYXJlblIpO1xuICAgICAgICByZXR1cm4gbm9kZTtcbiAgICAgIH1cbiAgICAgIHZhciB2YWwgPSBwYXJzZU1heWJlVHVwbGUodHJ1ZSk7XG4gICAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIHtcbiAgICAgICAgdmFsLmxvYy5zdGFydCA9IHRva1N0YXJ0TG9jMTtcbiAgICAgICAgdmFsLmxvYy5lbmQgPSB0b2tlbi5lbmRMb2M7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5yYW5nZXMpXG4gICAgICAgIHZhbC5yYW5nZSA9IFt0b2tTdGFydDEsIHRva2VuLmVuZF07XG4gICAgICBleHBlY3QodHQucGFyZW5SKTtcbiAgICAgIHJldHVybiB2YWw7XG5cbiAgICBjYXNlIHR0LmJyYWNrZXRMOlxuICAgICAgcmV0dXJuIHBhcnNlTGlzdCgpO1xuXG4gICAgY2FzZSB0dC5icmFjZUw6XG4gICAgICByZXR1cm4gcGFyc2VEaWN0KHR0LmJyYWNlUik7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIGR1bW15SWRlbnQoKTtcbiAgICB9XG4gIH1cblxuICAvLyBQYXJzZSBsaXN0XG5cbiAgLy8gQ3VzdG9tIGxpc3Qgb2JqZWN0IGlzIHVzZWQgdG8gc2ltdWxhdGUgbmF0aXZlIFB5dGhvbiBsaXN0XG4gIC8vIEUuZy4gUHl0aG9uICdbXScgYmVjb21lcyBKYXZhU2NyaXB0ICduZXcgX19weXRob25SdW50aW1lLm9iamVjdHMubGlzdCgpOydcbiAgLy8gSWYgbGlzdCBjb21wcmVoZW5zaW9uLCBidWlsZCBzb21ldGhpbmcgbGlrZSB0aGlzOlxuICAvLyhmdW5jdGlvbigpIHtcbiAgLy8gIHZhciBfbGlzdCA9IFtdO1xuICAvLyAgLi4uXG4gIC8vICBfbGlzdC5wdXNoKGV4cHIpO1xuICAvLyAgcmV0dXJuIF9saXN0O1xuICAvL30oKSk7XG5cbiAgZnVuY3Rpb24gcGFyc2VMaXN0KCkge1xuICAgIHZhciBub2RlID0gc3RhcnROb2RlKCk7XG4gICAgbm9kZS5hcmd1bWVudHMgPSBbXTtcbiAgICBuZXh0KCk7XG5cbiAgICBpZiAoIWVhdCh0dC5icmFja2V0UikpIHtcbiAgICAgIHZhciBleHByID0gcGFyc2VFeHByT3BzKGZhbHNlKTtcbiAgICAgIGlmICh0b2tlbi50eXBlID09PSB0dC5fZm9yIHx8IHRva2VuLnR5cGUgPT09IHR0Ll9pZikge1xuXG4gICAgICAgIC8vIExpc3QgY29tcHJlaGVuc2lvblxuICAgICAgICB2YXIgdG1wVmFyU3VmZml4ID0gbmV3QXN0SWRDb3VudCsrO1xuICAgICAgICBleHByID0gbmMuY3JlYXRlTGlzdENvbXBQdXNoKGV4cHIsIHRtcFZhclN1ZmZpeCk7XG4gICAgICAgIHZhciBib2R5ID0gcGFyc2VDb21wSXRlcihleHByLCB0cnVlKTtcbiAgICAgICAgZmluaXNoTm9kZShub2RlKTtcbiAgICAgICAgcmV0dXJuIG5jLmNyZWF0ZUxpc3RDb21wSWlmZShub2RlLCBib2R5LCB0bXBWYXJTdWZmaXgpO1xuXG4gICAgICB9IGVsc2UgaWYgKGVhdCh0dC5jb21tYSkpIHtcbiAgICAgICAgbm9kZS5hcmd1bWVudHMgPSBbZXhwcl0uY29uY2F0KHBhcnNlRXhwckxpc3QodHQuYnJhY2tldFIsIHRydWUsIGZhbHNlKSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgZXhwZWN0KHR0LmJyYWNrZXRSKTtcbiAgICAgICAgbm9kZS5hcmd1bWVudHMgPSBbZXhwcl07XG4gICAgICB9XG4gICAgfVxuXG4gICAgZmluaXNoTm9kZShub2RlLCBcIk5ld0V4cHJlc3Npb25cIik7XG4gICAgdmFyIHJ1bnRpbWVJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSB9KTtcbiAgICB2YXIgb2JqZWN0c0lkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJvYmplY3RzXCIgfSk7XG4gICAgdmFyIHJ1bnRpbWVNZW1iZXIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVJZCwgcHJvcGVydHk6IG9iamVjdHNJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgIHZhciBsaXN0SWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcImxpc3RcIiB9KTtcbiAgICBub2RlLmNhbGxlZSA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZU1lbWJlciwgcHJvcGVydHk6IGxpc3RJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgLy8gUGFyc2UgYSBjb21wX2l0ZXIgZnJvbSBQeXRob24gbGFuZ3VhZ2UgZ3JhbW1hclxuICAvLyAnZXhwcicgaXMgdGhlIGJvZHkgdG8gYmUgdXNlZCBhZnRlciB1bnJvbGxpbmcgdGhlIGlmcyBhbmQgZm9yc1xuXG4gIGZ1bmN0aW9uIHBhcnNlQ29tcEl0ZXIoZXhwciwgZmlyc3QpIHtcbiAgICBpZiAoZmlyc3QgJiYgdG9rZW4udHlwZSAhPT0gdHQuX2ZvcikgcmV0dXJuIGR1bW15SWRlbnQoKTtcbiAgICBpZiAoZWF0KHR0LmJyYWNrZXRSKSkgcmV0dXJuIGV4cHI7XG4gICAgdmFyIG5vZGUgPSBzdGFydE5vZGUoKTtcbiAgICBpZiAoZWF0KHR0Ll9mb3IpKSB7XG4gICAgICB2YXIgaW5pdCA9IHBhcnNlRXhwcmVzc2lvbihmYWxzZSwgdHJ1ZSk7XG4gICAgICB2YXIgdHVwbGVBcmdzID0gZ2V0VHVwbGVBcmdzKGluaXQpO1xuICAgICAgaWYgKCF0dXBsZUFyZ3MpIGNoZWNrTFZhbChpbml0KTtcbiAgICAgIGV4cGVjdCh0dC5faW4pO1xuICAgICAgdmFyIHJpZ2h0ID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICB2YXIgYm9keSA9IHBhcnNlQ29tcEl0ZXIoZXhwciwgZmFsc2UpO1xuICAgICAgdmFyIGJsb2NrID0gbmMuY3JlYXRlTm9kZVNwYW4oYm9keSwgYm9keSwgXCJCbG9ja1N0YXRlbWVudFwiLCB7IGJvZHk6IFtib2R5XSB9KTtcbiAgICAgIGZpbmlzaE5vZGUobm9kZSwgXCJCbG9ja1N0YXRlbWVudFwiKTtcbiAgICAgIHJldHVybiBuYy5jcmVhdGVGb3Iobm9kZSwgaW5pdCwgdHVwbGVBcmdzLCByaWdodCwgYmxvY2spO1xuICAgIH0gZWxzZSBpZiAoZWF0KHR0Ll9pZikpIHtcbiAgICAgIGlmICh0b2tlbi50eXBlID09PSB0dC5wYXJlbkwpIG5vZGUudGVzdCA9IHBhcnNlUGFyZW5FeHByZXNzaW9uKCk7XG4gICAgICBlbHNlIG5vZGUudGVzdCA9IHBhcnNlRXhwcmVzc2lvbigpO1xuICAgICAgbm9kZS5jb25zZXF1ZW50ID0gcGFyc2VDb21wSXRlcihleHByLCBmYWxzZSk7XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIklmU3RhdGVtZW50XCIpO1xuICAgIH0gZWxzZSByZXR1cm4gZHVtbXlJZGVudCgpO1xuICB9XG5cbiAgLy8gUGFyc2UgY2xhc3NcblxuICBmdW5jdGlvbiBwYXJzZUNsYXNzKGN0b3JOb2RlKSB7XG4gICAgLy8gQ29udGFpbmVyIGZvciBjbGFzcyBjb25zdHJ1Y3RvciBhbmQgcHJvdG90eXBlIGZ1bmN0aW9uc1xuICAgIHZhciBjb250YWluZXIgPSBzdGFydE5vZGVGcm9tKGN0b3JOb2RlKTtcbiAgICBjb250YWluZXIuYm9keSA9IFtdO1xuXG4gICAgLy8gUGFyc2UgY2xhc3Mgc2lnbmF0dXJlXG4gICAgY3Rvck5vZGUuaWQgPSBwYXJzZUlkZW50KCk7XG4gICAgY3Rvck5vZGUucGFyYW1zID0gW107XG4gICAgdmFyIGNsYXNzUGFyYW1zID0gW107XG4gICAgaWYgKGVhdCh0dC5wYXJlbkwpKSB7XG4gICAgICB2YXIgZmlyc3QgPSB0cnVlO1xuICAgICAgd2hpbGUgKCFlYXQodHQucGFyZW5SKSAmJiB0b2tlbi50eXBlICE9PSB0dC5lb2YpIHtcbiAgICAgICAgaWYgKCFmaXJzdCkgZXhwZWN0KHR0LmNvbW1hKTsgZWxzZSBmaXJzdCA9IGZhbHNlO1xuICAgICAgICBjbGFzc1BhcmFtcy5wdXNoKHBhcnNlSWRlbnQoKSk7XG4gICAgICB9XG4gICAgfVxuICAgIGV4cGVjdCh0dC5jb2xvbik7XG5cbiAgICAvLyBTdGFydCBuZXcgbmFtZXNwYWNlIGZvciBjbGFzcyBib2R5XG4gICAgc2NvcGUuc3RhcnRDbGFzcyhjdG9yTm9kZS5pZC5uYW1lKTtcblxuICAgIC8vIFNhdmUgYSByZWZlcmVuY2UgZm9yIHNvdXJjZSByYW5nZXNcbiAgICB2YXIgY2xhc3NCb2R5UmVmTm9kZSA9IGZpbmlzaE5vZGUoc3RhcnROb2RlKCkpO1xuXG4gICAgLy8gUGFyc2UgY2xhc3MgYm9keVxuICAgIHZhciBjbGFzc0Jsb2NrID0gcGFyc2VTdWl0ZSgpO1xuXG4gICAgLy8gR2VuZXJhdGUgYWRkaXRpb25hbCBBU1QgdG8gaW1wbGVtZW50IGNsYXNzXG4gICAgdmFyIGNsYXNzU3RtdCA9IG5jLmNyZWF0ZUNsYXNzKGNvbnRhaW5lciwgY3Rvck5vZGUsIGNsYXNzUGFyYW1zLCBjbGFzc0JvZHlSZWZOb2RlLCBjbGFzc0Jsb2NrKTtcblxuICAgIHNjb3BlLmVuZCgpO1xuXG4gICAgcmV0dXJuIGNsYXNzU3RtdDtcbiAgfVxuXG4gIC8vIFBhcnNlIGRpY3Rpb25hcnlcbiAgLy8gQ3VzdG9tIGRpY3Qgb2JqZWN0IHVzZWQgdG8gc2ltdWxhdGUgbmF0aXZlIFB5dGhvbiBkaWN0XG4gIC8vIEUuZy4gXCJ7J2sxJzondjEnLCAnazInOid2Mid9XCIgYmVjb21lcyBcIm5ldyBfX3B5dGhvblJ1bnRpbWUub2JqZWN0cy5kaWN0KFsnazEnLCAndjEnXSwgWydrMicsICd2MiddKTtcIlxuXG4gIGZ1bmN0aW9uIHBhcnNlRGljdCh0b2tDbG9zZSkge1xuICAgIHZhciBub2RlID0gc3RhcnROb2RlKCksIGZpcnN0ID0gdHJ1ZSwga2V5LCB2YWx1ZTtcbiAgICBub2RlLmFyZ3VtZW50cyA9IFtdO1xuICAgIG5leHQoKTtcbiAgICB3aGlsZSAoIWVhdCh0b2tDbG9zZSkgJiYgIWVhdCh0dC5uZXdsaW5lKSAmJiB0b2tlbi50eXBlICE9PSB0dC5lb2YpIHtcbiAgICAgIGlmICghZmlyc3QpIHtcbiAgICAgICAgZXhwZWN0KHR0LmNvbW1hKTtcbiAgICAgIH0gZWxzZSBmaXJzdCA9IGZhbHNlO1xuXG4gICAgICBpZiAodG9rQ2xvc2UgPT09IHR0LmJyYWNlUikge1xuICAgICAgICBrZXkgPSBwYXJzZVByb3BlcnR5TmFtZSgpO1xuICAgICAgICBleHBlY3QodHQuY29sb24pO1xuICAgICAgICB2YWx1ZSA9IHBhcnNlRXhwck9wcyhmYWxzZSk7XG4gICAgICB9IGVsc2UgaWYgKHRva0Nsb3NlID09PSB0dC5wYXJlblIpIHtcbiAgICAgICAgdmFyIGtleUlkID0gcGFyc2VJZGVudCh0cnVlKTtcbiAgICAgICAga2V5ID0gc3RhcnROb2RlRnJvbShrZXlJZCk7XG4gICAgICAgIGtleS52YWx1ZSA9IGtleUlkLm5hbWU7XG4gICAgICAgIGZpbmlzaE5vZGUoa2V5LCBcIkxpdGVyYWxcIik7XG4gICAgICAgIGV4cGVjdCh0dC5lcSk7XG4gICAgICAgIHZhbHVlID0gcGFyc2VFeHByT3BzKGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIG5vZGUuYXJndW1lbnRzLnB1c2gobmMuY3JlYXRlTm9kZVNwYW4oa2V5LCB2YWx1ZSwgXCJBcnJheUV4cHJlc3Npb25cIiwgeyBlbGVtZW50czogW2tleSwgdmFsdWVdIH0pKTtcbiAgICB9XG4gICAgZmluaXNoTm9kZShub2RlLCBcIk5ld0V4cHJlc3Npb25cIik7XG5cbiAgICB2YXIgcnVudGltZUlkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogb3B0aW9ucy5ydW50aW1lUGFyYW1OYW1lIH0pO1xuICAgIHZhciBvYmplY3RzSWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIm9iamVjdHNcIiB9KTtcbiAgICB2YXIgcnVudGltZU1lbWJlciA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZUlkLCBwcm9wZXJ0eTogb2JqZWN0c0lkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgdmFyIGxpc3RJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiZGljdFwiIH0pO1xuICAgIG5vZGUuY2FsbGVlID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lTWVtYmVyLCBwcm9wZXJ0eTogbGlzdElkLCBjb21wdXRlZDogZmFsc2UgfSk7XG5cbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlUHJvcGVydHlOYW1lKCkge1xuICAgIGlmICh0b2tlbi50eXBlID09PSB0dC5udW0gfHwgdG9rZW4udHlwZSA9PT0gdHQuc3RyaW5nKSByZXR1cm4gcGFyc2VFeHByQXRvbSgpO1xuICAgIGlmICh0b2tlbi50eXBlID09PSB0dC5uYW1lIHx8IHRva2VuLnR5cGUua2V5d29yZCkgcmV0dXJuIHBhcnNlSWRlbnQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlSWRlbnQoKSB7XG4gICAgdmFyIG5vZGUgPSBzdGFydE5vZGUoKTtcbiAgICBub2RlLm5hbWUgPSB0b2tlbi50eXBlID09PSB0dC5uYW1lID8gdG9rZW4udmFsdWUgOiB0b2tlbi50eXBlLmtleXdvcmQ7XG4gICAgaWYgKCFub2RlLm5hbWUpIG5vZGUgPSBkdW1teUlkZW50KCk7XG4gICAgbmV4dCgpO1xuICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiSWRlbnRpZmllclwiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlRnVuY3Rpb24obm9kZSkge1xuICAgIHZhciBzdWZmaXggPSBuZXdBc3RJZENvdW50Kys7XG4gICAgbm9kZS5pZCA9IHBhcnNlSWRlbnQoKTtcbiAgICBub2RlLnBhcmFtcyA9IFtdO1xuXG4gICAgLy8gUGFyc2UgcGFyYW1ldGVyc1xuXG4gICAgdmFyIGZvcm1hbHMgPSBbXTsgICAgIC8vIEluIG9yZGVyLCBtYXliZSB3aXRoIGRlZmF1bHQgdmFsdWVcbiAgICB2YXIgYXJnc0lkID0gbnVsbDsgICAgLy8gKmFyZ3NcbiAgICB2YXIga3dhcmdzSWQgPSBudWxsOyAgLy8gKiprd2FyZ3NcbiAgICB2YXIgZmlyc3QgPSB0cnVlO1xuICAgIGV4cGVjdCh0dC5wYXJlbkwpO1xuICAgIHdoaWxlICghZWF0KHR0LnBhcmVuUikgJiYgdG9rZW4udHlwZSAhPT0gdHQuZW9mKSB7XG4gICAgICBpZiAoIWZpcnN0KSBleHBlY3QodHQuY29tbWEpOyBlbHNlIGZpcnN0ID0gZmFsc2U7XG4gICAgICBpZiAodG9rZW4udmFsdWUgPT09ICcqJykge1xuICAgICAgICBuZXh0KCk7IGFyZ3NJZCA9IHBhcnNlSWRlbnQoKTtcbiAgICAgIH0gZWxzZSBpZiAodG9rZW4udmFsdWUgPT09ICcqKicpIHtcbiAgICAgICAgbmV4dCgpOyBrd2FyZ3NJZCA9IHBhcnNlSWRlbnQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBwYXJhbUlkID0gcGFyc2VJZGVudCgpO1xuICAgICAgICBpZiAoZWF0KHR0LmVxKSlcbiAgICAgICAgICBmb3JtYWxzLnB1c2goeyBpZDogcGFyYW1JZCwgZXhwcjogcGFyc2VFeHByT3BzKGZhbHNlKSB9KTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIGZvcm1hbHMucHVzaCh7IGlkOiBwYXJhbUlkLCBleHByOiBudWxsIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBleHBlY3QodHQuY29sb24pO1xuXG4gICAgc2NvcGUuc3RhcnRGbihub2RlLmlkLm5hbWUpO1xuXG4gICAgLy8gSWYgY2xhc3MgbWV0aG9kLCByZW1vdmUgY2xhc3MgaW5zdGFuY2UgdmFyIGZyb20gcGFyYW1zIGFuZCBzYXZlIGZvciAndGhpcycgcmVwbGFjZW1lbnRcbiAgICBpZiAoc2NvcGUuaXNQYXJlbnRDbGFzcygpKSB7XG4gICAgICB2YXIgc2VsZklkID0gZm9ybWFscy5zaGlmdCgpO1xuICAgICAgc2NvcGUuc2V0VGhpc1JlcGxhY2Uoc2VsZklkLmlkLm5hbWUpO1xuICAgIH1cblxuICAgIHZhciBib2R5ID0gcGFyc2VTdWl0ZSgpO1xuICAgIG5vZGUuYm9keSA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJvZHksIGJvZHksIFwiQmxvY2tTdGF0ZW1lbnRcIiwgeyBib2R5OiBbXSB9KTtcblxuICAgIC8vIEFkZCBydW50aW1lIHBhcmFtZXRlciBwcm9jZXNzaW5nXG5cbiAgICBpZiAoZm9ybWFscy5sZW5ndGggPiAwIHx8IGFyZ3NJZCB8fCBrd2FyZ3NJZCkge1xuICAgICAgbm9kZS5ib2R5LmJvZHkucHVzaChuYy5jcmVhdGVOb2RlUGFyYW1zQ2hlY2sobm9kZS5pZCwgc3VmZml4KSk7XG4gICAgICBub2RlLmJvZHkuYm9keS5wdXNoKG5jLmNyZWF0ZVZhckRlY2xGcm9tSWQobm9kZS5pZCxcbiAgICAgICAgbmMuY3JlYXRlTm9kZVNwYW4obm9kZS5pZCwgbm9kZS5pZCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ19fZm9ybWFsc0luZGV4JyArIHN1ZmZpeCB9KSxcbiAgICAgICAgbmMuY3JlYXRlTm9kZVNwYW4obm9kZS5pZCwgbm9kZS5pZCwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IDAgfSkpKTtcbiAgICAgIG5vZGUuYm9keS5ib2R5LnB1c2gobmMuY3JlYXRlVmFyRGVjbEZyb21JZChub2RlLmlkLFxuICAgICAgICBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLmlkLCBub2RlLmlkLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnX19hcmdzJyArIHN1ZmZpeCB9KSxcbiAgICAgICAgbmMuY3JlYXRlTm9kZVNwYW4obm9kZS5pZCwgbm9kZS5pZCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ2FyZ3VtZW50cycgfSkpKTtcbiAgICB9XG4gICAgaWYgKGZvcm1hbHMubGVuZ3RoID4gMCkge1xuICAgICAgbm9kZS5ib2R5LmJvZHkucHVzaChuYy5jcmVhdGVOb2RlR2V0UGFyYW1Gbihub2RlLmlkLCBzdWZmaXgpKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZm9ybWFscy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgX19nZXRQYXJhbUNhbGwgPSBuYy5jcmVhdGVOb2RlU3Bhbihmb3JtYWxzW2ldLmlkLCBmb3JtYWxzW2ldLmlkLCBcIkNhbGxFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICBjYWxsZWU6IG5jLmNyZWF0ZU5vZGVTcGFuKGZvcm1hbHNbaV0uaWQsIGZvcm1hbHNbaV0uaWQsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdfX2dldFBhcmFtJyArIHN1ZmZpeCB9KSxcbiAgICAgICAgICBhcmd1bWVudHM6IFtuYy5jcmVhdGVOb2RlU3Bhbihmb3JtYWxzW2ldLmlkLCBmb3JtYWxzW2ldLmlkLCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogZm9ybWFsc1tpXS5pZC5uYW1lIH0pXVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGZvcm1hbHNbaV0uZXhwcikgX19nZXRQYXJhbUNhbGwuYXJndW1lbnRzLnB1c2goZm9ybWFsc1tpXS5leHByKTtcbiAgICAgICAgbm9kZS5ib2R5LmJvZHkucHVzaChuYy5jcmVhdGVWYXJEZWNsRnJvbUlkKGZvcm1hbHNbaV0uaWQsIGZvcm1hbHNbaV0uaWQsIF9fZ2V0UGFyYW1DYWxsKSk7XG4gICAgICB9XG4gICAgfVxuICAgIHZhciByZWZOb2RlID0gYXJnc0lkIHx8IGt3YXJnc0lkO1xuICAgIGlmIChyZWZOb2RlKSB7XG4gICAgICBpZiAoYXJnc0lkKSB7XG4gICAgICAgIHZhciBhcmdzQXNzaWduID0gbmMuY3JlYXRlVmFyRGVjbEZyb21JZChhcmdzSWQsIGFyZ3NJZCwgbmMuY3JlYXRlTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiQXJyYXlFeHByZXNzaW9uXCIsIHsgZWxlbWVudHM6IFtdIH0pKTtcbiAgICAgICAgbm9kZS5ib2R5LmJvZHkucHVzaChhcmdzQXNzaWduKTtcbiAgICAgIH1cbiAgICAgIGlmIChrd2FyZ3NJZCkge1xuICAgICAgICB2YXIga3dhcmdzQXNzaWduID0gbmMuY3JlYXRlVmFyRGVjbEZyb21JZChrd2FyZ3NJZCwga3dhcmdzSWQsIG5jLmNyZWF0ZU5vZGVTcGFuKGt3YXJnc0lkLCBrd2FyZ3NJZCwgXCJPYmplY3RFeHByZXNzaW9uXCIsIHsgcHJvcGVydGllczogW10gfSkpO1xuICAgICAgICBub2RlLmJvZHkuYm9keS5wdXNoKGt3YXJnc0Fzc2lnbik7XG4gICAgICB9XG4gICAgICB2YXIgYXJnc0lmID0gbmMuY3JlYXRlTm9kZVNwYW4ocmVmTm9kZSwgcmVmTm9kZSwgXCJJZlN0YXRlbWVudFwiLCB7XG4gICAgICAgIHRlc3Q6IG5jLmNyZWF0ZU5vZGVTcGFuKHJlZk5vZGUsIHJlZk5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdfX3BhcmFtcycgKyBzdWZmaXggfSksXG4gICAgICAgIGNvbnNlcXVlbnQ6IG5jLmNyZWF0ZU5vZGVTcGFuKHJlZk5vZGUsIHJlZk5vZGUsIFwiQmxvY2tTdGF0ZW1lbnRcIiwgeyBib2R5OiBbXSB9KVxuICAgICAgfSlcbiAgICAgIGlmIChhcmdzSWQpIHtcbiAgICAgICAgYXJnc0lmLmNvbnNlcXVlbnQuYm9keS5wdXNoKG5jLmNyZWF0ZU5vZGVBcmdzV2hpbGVDb25zZXF1ZW50KGFyZ3NJZCwgc3VmZml4KSk7XG4gICAgICAgIGFyZ3NJZi5hbHRlcm5hdGUgPSBuYy5jcmVhdGVOb2RlQXJnc0FsdGVybmF0ZShhcmdzSWQpO1xuICAgICAgfVxuICAgICAgaWYgKGt3YXJnc0lkKSB7XG4gICAgICAgIGFyZ3NJZi5jb25zZXF1ZW50LmJvZHkucHVzaChuYy5jcmVhdGVOb2RlU3Bhbihrd2FyZ3NJZCwga3dhcmdzSWQsIFwiRXhwcmVzc2lvblN0YXRlbWVudFwiLCB7XG4gICAgICAgICAgZXhwcmVzc2lvbjogbmMuY3JlYXRlTm9kZVNwYW4oa3dhcmdzSWQsIGt3YXJnc0lkLCBcIkFzc2lnbm1lbnRFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgIG9wZXJhdG9yOiAnPScsIGxlZnQ6IGt3YXJnc0lkLCByaWdodDogbmMuY3JlYXRlTm9kZU1lbWJJZHMoa3dhcmdzSWQsICdfX3BhcmFtcycgKyBzdWZmaXgsICdrZXl3b3JkcycpLFxuICAgICAgICAgIH0pXG4gICAgICAgIH0pKTtcbiAgICAgIH1cbiAgICAgIG5vZGUuYm9keS5ib2R5LnB1c2goYXJnc0lmKTtcbiAgICB9XG4gICAgbm9kZS5ib2R5LmJvZHkucHVzaChuYy5jcmVhdGVOb2RlRm5Cb2R5SWlmZShib2R5KSk7XG5cbiAgICAvLyBJZiBjbGFzcyBtZXRob2QsIHJlcGxhY2Ugd2l0aCBwcm90b3R5cGUgZnVuY3Rpb24gbGl0ZXJhbHNcbiAgICB2YXIgcmV0Tm9kZTtcbiAgICBpZiAoc2NvcGUuaXNQYXJlbnRDbGFzcygpKSB7XG4gICAgICBmaW5pc2hOb2RlKG5vZGUpO1xuICAgICAgdmFyIGNsYXNzSWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBzY29wZS5nZXRQYXJlbnRDbGFzc05hbWUoKSB9KTtcbiAgICAgIHZhciBwcm90b3R5cGVJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwicHJvdG90eXBlXCIgfSk7XG4gICAgICB2YXIgZnVuY3Rpb25JZCA9IG5vZGUuaWQ7XG4gICAgICB2YXIgcHJvdG90eXBlTWVtYmVyID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBjbGFzc0lkLCBwcm9wZXJ0eTogcHJvdG90eXBlSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgIHZhciBmdW5jdGlvbk1lbWJlciA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcHJvdG90eXBlTWVtYmVyLCBwcm9wZXJ0eTogZnVuY3Rpb25JZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgdmFyIGZ1bmN0aW9uRXhwciA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiRnVuY3Rpb25FeHByZXNzaW9uXCIsIHsgYm9keTogbm9kZS5ib2R5LCBwYXJhbXM6IG5vZGUucGFyYW1zIH0pO1xuICAgICAgdmFyIGFzc2lnbkV4cHIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkFzc2lnbm1lbnRFeHByZXNzaW9uXCIsIHsgbGVmdDogZnVuY3Rpb25NZW1iZXIsIG9wZXJhdG9yOiBcIj1cIiwgcmlnaHQ6IGZ1bmN0aW9uRXhwciB9KTtcbiAgICAgIHJldE5vZGUgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIiwgeyBleHByZXNzaW9uOiBhc3NpZ25FeHByIH0pO1xuICAgIH0gZWxzZSByZXROb2RlID0gZmluaXNoTm9kZShub2RlLCBcIkZ1bmN0aW9uRGVjbGFyYXRpb25cIik7XG5cbiAgICBzY29wZS5lbmQoKTtcblxuICAgIHJldHVybiByZXROb2RlO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VFeHByTGlzdChjbG9zZSkge1xuICAgIHZhciBlbHRzID0gW107XG4gICAgd2hpbGUgKCFlYXQoY2xvc2UpICYmICFlYXQodHQubmV3bGluZSkgJiYgdG9rZW4udHlwZSAhPT0gdHQuZW9mKSB7XG4gICAgICB2YXIgZWx0ID0gcGFyc2VFeHByT3BzKGZhbHNlKTtcbiAgICAgIGlmIChpc0R1bW15KGVsdCkpIHtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWx0cy5wdXNoKGVsdCk7XG4gICAgICB9XG4gICAgICB3aGlsZSAoZWF0KHR0LmNvbW1hKSkge31cbiAgICB9XG4gICAgcmV0dXJuIGVsdHM7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZVBhcmFtc0xpc3QoKSB7XG4gICAgdmFyIGVsdHMgPSBbXSwgZmlyc3QgPSB0cnVlO1xuICAgIHdoaWxlICghZWF0KHR0LnBhcmVuUikgJiYgIWVhdCh0dC5uZXdsaW5lKSAmJiB0b2tlbi50eXBlICE9PSB0dC5lb2YpIHtcbiAgICAgIGlmICghZmlyc3QpIGV4cGVjdCh0dC5jb21tYSk7XG4gICAgICBlbHNlIGZpcnN0ID0gZmFsc2U7XG4gICAgICB2YXIgZXhwciA9IHBhcnNlRXhwck9wcyhmYWxzZSk7XG4gICAgICBpZiAoZWF0KHR0LmVxKSkge1xuICAgICAgICB2YXIgcmlnaHQgPSBwYXJzZUV4cHJPcHMoZmFsc2UpO1xuICAgICAgICB2YXIga3dJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGV4cHIsIHJpZ2h0LCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIl9fa3dwXCIgfSk7XG4gICAgICAgIHZhciBrd0xpdCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGV4cHIsIHJpZ2h0LCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICAgICAgdmFyIGxlZnQgPSBuYy5jcmVhdGVOb2RlU3BhbihleHByLCByaWdodCwgXCJPYmplY3RFeHByZXNzaW9uXCIsIHsgcHJvcGVydGllczogW10gfSk7XG4gICAgICAgIGxlZnQucHJvcGVydGllcy5wdXNoKHsgdHlwZTogXCJQcm9wZXJ0eVwiLCBrZXk6IGV4cHIsIHZhbHVlOiByaWdodCwga2luZDogXCJpbml0XCIgfSk7XG4gICAgICAgIGxlZnQucHJvcGVydGllcy5wdXNoKHsgdHlwZTogXCJQcm9wZXJ0eVwiLCBrZXk6IGt3SWQsIHZhbHVlOiBrd0xpdCwga2luZDogXCJpbml0XCIgfSk7XG4gICAgICAgIGV4cHIgPSBsZWZ0O1xuICAgICAgfVxuICAgICAgZWx0cy5wdXNoKGV4cHIpO1xuICAgIH1cbiAgICByZXR1cm4gZWx0cztcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlVHVwbGUobm9JbiwgZXhwcikge1xuICAgIHZhciBub2RlID0gZXhwciA/IHN0YXJ0Tm9kZUZyb20oZXhwcikgOiBzdGFydE5vZGUoKTtcbiAgICBub2RlLmFyZ3VtZW50cyA9IGV4cHIgPyBbZXhwcl0gOiBbXTtcblxuICAgIC8vIFR1cGxlIHdpdGggc2luZ2xlIGVsZW1lbnQgaGFzIHNwZWNpYWwgdHJhaWxpbmcgY29tbWE6IHQgPSAnaGknLFxuICAgIC8vIExvb2sgYWhlYWQgYW5kIGVhdCBjb21tYSBpbiB0aGlzIHNjZW5hcmlvXG4gICAgaWYgKHRva2VuLnR5cGUgPT09IHR0LmNvbW1hKSB7XG4gICAgICB2YXIgcG9zID0gdG9rZW4uc3RhcnQgKyAxO1xuICAgICAgd2hpbGUgKGlzU3BhY2UoaW5wdXQuY2hhckNvZGVBdChwb3MpKSkgKytwb3M7XG4gICAgICBpZiAocG9zID49IGlucHV0TGVuIHx8IGlucHV0W3Bvc10gPT09ICc7JyB8fCBpbnB1dFtwb3NdID09PSAnKScgfHwgaXNOZXdsaW5lKGlucHV0LmNoYXJDb2RlQXQocG9zKSkpXG4gICAgICAgIGVhdCh0dC5jb21tYSk7XG4gICAgfVxuXG4gICAgd2hpbGUgKGVhdCh0dC5jb21tYSkpIHtcbiAgICAgIG5vZGUuYXJndW1lbnRzLnB1c2gocGFyc2VFeHByT3BzKG5vSW4pKTtcbiAgICB9XG4gICAgZmluaXNoTm9kZShub2RlLCBcIk5ld0V4cHJlc3Npb25cIik7XG5cbiAgICB2YXIgcnVudGltZUlkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogb3B0aW9ucy5ydW50aW1lUGFyYW1OYW1lIH0pO1xuICAgIHZhciBvYmplY3RzSWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIm9iamVjdHNcIiB9KTtcbiAgICB2YXIgcnVudGltZU1lbWJlciA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZUlkLCBwcm9wZXJ0eTogb2JqZWN0c0lkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgdmFyIGxpc3RJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwidHVwbGVcIiB9KTtcbiAgICBub2RlLmNhbGxlZSA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZU1lbWJlciwgcHJvcGVydHk6IGxpc3RJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuXG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cbn0pO1xuIiwiVGFyR1ogPSBmdW5jdGlvbigpe307XHJcblxyXG4vLyBMb2FkIGFuZCBwYXJzZSBhcmNoaXZlLCBjYWxscyBvbmxvYWQgYWZ0ZXIgbG9hZGluZyBhbGwgZmlsZXMuXHJcblRhckdaLmxvYWQgPSBmdW5jdGlvbih1cmwsIG9ubG9hZCwgb25zdHJlYW0sIG9uZXJyb3IpIFxyXG57XHJcbiAgdmFyIG8gPSBuZXcgVGFyR1ooKTtcclxuICBvLm9ubG9hZCA9IG9ubG9hZDtcclxuICBvLm9uZXJyb3IgPSBvbmVycm9yO1xyXG4gIG8ub25zdHJlYW0gPSBvbnN0cmVhbTtcclxuICBvLmxvYWQodXJsKTtcclxuICByZXR1cm4gbztcclxufTtcclxuXHJcbi8vIFN0cmVhbXMgYW4gYXJjaGl2ZSBmcm9tIHRoZSBnaXZlbiB1cmwsIGNhbGxpbmcgb25zdHJlYW0gYWZ0ZXIgbG9hZGluZyBlYWNoIGZpbGUgaW4gYXJjaGl2ZS5cclxuLy8gQ2FsbHMgb25sb2FkIGFmdGVyIGxvYWRpbmcgYWxsIGZpbGVzLlxyXG5UYXJHWi5zdHJlYW0gPSBmdW5jdGlvbih1cmwsIG9uc3RyZWFtLCBvbmxvYWQsIG9uZXJyb3IpIFxyXG57XHJcbiAgdmFyIG8gPSBuZXcgVGFyR1ooKTtcclxuICBvLm9ubG9hZCA9IG9ubG9hZDtcclxuICBvLm9uZXJyb3IgPSBvbmVycm9yO1xyXG4gIG8ub25zdHJlYW0gPSBvbnN0cmVhbTtcclxuICBvLmxvYWQodXJsKTtcclxuICByZXR1cm4gbztcclxufTtcclxuXHJcblRhckdaLnByb3RvdHlwZSA9IHtcclxuICBvbmVycm9yIDogbnVsbCxcclxuICBvbmxvYWQgOiBudWxsLFxyXG4gIG9uc3RyZWFtIDogbnVsbCxcclxuICBvbmRhdGEgOiBudWxsLFxyXG4gIFxyXG4gIGxvYWQgOiBmdW5jdGlvbih1cmwpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciBvZmZzZXQgPSB7Y2h1bmtCeXRlczogMCwgY2h1bmtzOiAwfTtcclxuICAgIHZhciBieXRlT2Zmc2V0ID0gMDtcclxuICAgIHRoaXMuZmlsZXMgPSBbXTtcclxuICAgIEdaaXAubG9hZCh1cmwsXHJcbiAgICAgIGZ1bmN0aW9uKGgpIHtcclxuICAgICAgICBieXRlT2Zmc2V0ID0gc2VsZi5wcm9jZXNzVGFyQ2h1bmtzKGguZGF0YSwgYnl0ZU9mZnNldCwgaC5vdXRwdXRTaXplKTtcclxuICAgICAgICBpZiAoc2VsZi5vbmxvYWQpXHJcbiAgICAgICAgICBzZWxmLm9ubG9hZChzZWxmLmZpbGVzLCBoKTtcclxuICAgICAgfSxcclxuICAgICAgZnVuY3Rpb24oaCkge1xyXG4gICAgICAgIHNlbGYuZ3ppcCA9IGg7XHJcbiAgICAgICAgaWYgKHNlbGYub25kYXRhKSBzZWxmLm9uZGF0YShoKTtcclxuICAgICAgICBieXRlT2Zmc2V0ID0gc2VsZi5wcm9jZXNzVGFyQ2h1bmtzKGguZGF0YSwgYnl0ZU9mZnNldCwgaC5vdXRwdXRTaXplKTtcclxuICAgICAgfSxcclxuICAgICAgZnVuY3Rpb24oeGhyLCBlLCBoKSB7XHJcbiAgICAgICAgaWYgKHNlbGYub25lcnJvcilcclxuICAgICAgICAgIHNlbGYub25lcnJvcih4aHIsIGUsIGgpO1xyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH0sXHJcbiBcclxuICBjbGVhbkhpZ2hCeXRlIDogZnVuY3Rpb24ocykge1xyXG4gICAgcmV0dXJuIHMucmVwbGFjZSgvLi9nLCBmdW5jdGlvbihtKSB7IFxyXG4gICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShtLmNoYXJDb2RlQXQoMCkgJiAweGZmKTtcclxuICAgIH0pO1xyXG4gIH0sXHJcbiAgXHJcbiAgcGFyc2VUYXIgOiBmdW5jdGlvbih0ZXh0KSB7XHJcbiAgICB0aGlzLmZpbGVzID0gW107XHJcbiAgICB0aGlzLnByb2Nlc3NUYXJDaHVua3MoW3RleHRdLCAwLCB0ZXh0Lmxlbmd0aCk7XHJcbiAgfSxcclxuICBwcm9jZXNzVGFyQ2h1bmtzIDogZnVuY3Rpb24gKGNodW5rcywgb2Zmc2V0LCB0b3RhbFNpemUpIHtcclxuICAgIHdoaWxlICh0b3RhbFNpemUgPj0gb2Zmc2V0ICsgNTEyKSB7XHJcbiAgICAgIHZhciBoZWFkZXIgPSB0aGlzLmZpbGVzLmxlbmd0aCA9PSAwID8gbnVsbCA6IHRoaXMuZmlsZXNbdGhpcy5maWxlcy5sZW5ndGgtMV07XHJcbiAgICAgIGlmIChoZWFkZXIgJiYgaGVhZGVyLmRhdGEgPT0gbnVsbCkge1xyXG4gICAgICAgIGlmIChvZmZzZXQgKyBoZWFkZXIubGVuZ3RoIDw9IHRvdGFsU2l6ZSkge1xyXG4gICAgICAgICAgaGVhZGVyLmRhdGEgPSB0aGlzLmNodW5rU3Vic3RyaW5nKGNodW5rcywgb2Zmc2V0LCBvZmZzZXQraGVhZGVyLmxlbmd0aCk7XHJcbiAgICAgICAgICBoZWFkZXIudG9EYXRhVVJMID0gdGhpcy5fX3RvRGF0YVVSTDtcclxuICAgICAgICAgIG9mZnNldCArPSA1MTIgKiBNYXRoLmNlaWwoaGVhZGVyLmxlbmd0aCAvIDUxMik7XHJcbiAgICAgICAgICBpZiAodGhpcy5vbnN0cmVhbSkgXHJcbiAgICAgICAgICAgIHRoaXMub25zdHJlYW0oaGVhZGVyLCB0aGlzLmd6aXApO1xyXG4gICAgICAgIH0gZWxzZSB7IC8vIG5vdCBsb2FkZWQgeWV0XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdmFyIHMgPSB0aGlzLmNodW5rU3Vic3RyaW5nKGNodW5rcywgb2Zmc2V0LCBvZmZzZXQrNTEyKTtcclxuICAgICAgICB2YXIgaGVhZGVyID0gdGhpcy5wYXJzZVRhckhlYWRlcihzLCAwKTtcclxuICAgICAgICBpZiAoaGVhZGVyLmxlbmd0aCA+IDAgfHwgaGVhZGVyLmZpbGVuYW1lICE9ICcnKSB7XHJcbiAgICAgICAgICB0aGlzLmZpbGVzLnB1c2goaGVhZGVyKTtcclxuICAgICAgICAgIG9mZnNldCArPSA1MTI7XHJcbiAgICAgICAgICBoZWFkZXIub2Zmc2V0ID0gb2Zmc2V0O1xyXG4gICAgICAgIH0gZWxzZSB7IC8vIGVtcHR5IGhlYWRlciwgc3RvcCBwcm9jZXNzaW5nXHJcbiAgICAgICAgICBvZmZzZXQgPSB0b3RhbFNpemU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb2Zmc2V0O1xyXG4gIH0sXHJcbiAgcGFyc2VUYXJIZWFkZXIgOiBmdW5jdGlvbih0ZXh0LCBvZmZzZXQpIHtcclxuICAgIHZhciBpID0gb2Zmc2V0IHx8IDA7XHJcbiAgICB2YXIgaCA9IHt9O1xyXG4gICAgaC5maWxlbmFtZSA9IHRleHQuc3Vic3RyaW5nKGksIGkrPTEwMCkuc3BsaXQoXCJcXDBcIiwgMSlbMF07XHJcbiAgICBoLm1vZGUgPSB0ZXh0LnN1YnN0cmluZyhpLCBpKz04KS5zcGxpdChcIlxcMFwiLCAxKVswXTtcclxuICAgIGgudWlkID0gdGV4dC5zdWJzdHJpbmcoaSwgaSs9OCkuc3BsaXQoXCJcXDBcIiwgMSlbMF07XHJcbiAgICBoLmdpZCA9IHRleHQuc3Vic3RyaW5nKGksIGkrPTgpLnNwbGl0KFwiXFwwXCIsIDEpWzBdO1xyXG4gICAgaC5sZW5ndGggPSB0aGlzLnBhcnNlVGFyTnVtYmVyKHRleHQuc3Vic3RyaW5nKGksIGkrPTEyKSk7XHJcbiAgICBoLmxhc3RNb2RpZmllZCA9IHRleHQuc3Vic3RyaW5nKGksIGkrPTEyKS5zcGxpdChcIlxcMFwiLCAxKVswXTtcclxuICAgIGguY2hlY2tTdW0gPSB0ZXh0LnN1YnN0cmluZyhpLCBpKz04KS5zcGxpdChcIlxcMFwiLCAxKVswXTtcclxuICAgIGguZmlsZVR5cGUgPSB0ZXh0LnN1YnN0cmluZyhpLCBpKz0xKS5zcGxpdChcIlxcMFwiLCAxKVswXTtcclxuICAgIGgubGlua05hbWUgPSB0ZXh0LnN1YnN0cmluZyhpLCBpKz0xMDApLnNwbGl0KFwiXFwwXCIsIDEpWzBdO1xyXG4gICAgcmV0dXJuIGg7XHJcbiAgfSxcclxuICBwYXJzZVRhck51bWJlciA6IGZ1bmN0aW9uKHRleHQpIHtcclxuICAgIC8vIGlmICh0ZXh0LmNoYXJDb2RlQXQoMCkgJiAweDgwID09IDEpIHtcclxuICAgIC8vIEdOVSB0YXIgOC1ieXRlIGJpbmFyeSBiaWctZW5kaWFuIG51bWJlclxyXG4gICAgLy8gfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHBhcnNlSW50KHRleHQucmVwbGFjZSgvW15cXGRdL2csICcnKSwgOCk7XHJcbiAgICAvLyB9XHJcbiAgfSxcclxuXHJcbiAgLy8gZXh0cmFjdCBzdWJzdHJpbmcgZnJvbSBhbiBhcnJheSBvZiBzdHJpbmdzXHJcbiAgY2h1bmtTdWJzdHJpbmcgOiBmdW5jdGlvbiAoY2h1bmtzLCBzdGFydCwgZW5kKSB7XHJcbiAgICB2YXIgc29mZj0wLCBlb2ZmPTAsIGk9MCwgaj0wO1xyXG4gICAgZm9yIChpPTA7IGk8Y2h1bmtzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGlmIChzb2ZmICsgY2h1bmtzW2ldLmxlbmd0aCA+IHN0YXJ0KVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBzb2ZmICs9IGNodW5rc1tpXS5sZW5ndGg7XHJcbiAgICB9XHJcbiAgICB2YXIgc3RycyA9IFtdO1xyXG4gICAgZW9mZiA9IHNvZmY7XHJcbiAgICBmb3IgKGo9aTsgajxjaHVua3MubGVuZ3RoOyBqKyspIHtcclxuICAgICAgc3Rycy5wdXNoKGNodW5rc1tqXSk7XHJcbiAgICAgIGlmIChlb2ZmICsgY2h1bmtzW2pdLmxlbmd0aCA+IGVuZClcclxuICAgICAgICBicmVhaztcclxuICAgICAgZW9mZiArPSBjaHVua3Nbal0ubGVuZ3RoO1xyXG4gICAgfVxyXG4gICAgdmFyIHMgPSBzdHJzLmpvaW4oJycpO1xyXG4gICAgcmV0dXJuIHMuc3Vic3RyaW5nKHN0YXJ0LXNvZmYsIHN0YXJ0LXNvZmYrKGVuZC1zdGFydCkpO1xyXG4gIH0sXHJcblxyXG4gIF9fdG9EYXRhVVJMIDogZnVuY3Rpb24oKSB7XHJcbiAgICBpZiAodGhpcy5kYXRhLnN1YnN0cmluZygwLDQwKS5tYXRjaCgvXmRhdGE6W15cXC9dK1xcL1teLF0rLC8pKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmRhdGE7XHJcbiAgICB9IGVsc2UgaWYgKFRhckdaLnByb3RvdHlwZS5jbGVhbkhpZ2hCeXRlKHRoaXMuZGF0YS5zdWJzdHJpbmcoMCwxMCkpLm1hdGNoKC9cXDM3N1xcMzMwXFwzNzdcXDM0MC4uSkZJRi8pKSB7XHJcbiAgICAgIHJldHVybiAnZGF0YTppbWFnZS9qcGVnO2Jhc2U2NCwnK2J0b2EoVGFyR1oucHJvdG90eXBlLmNsZWFuSGlnaEJ5dGUodGhpcy5kYXRhKSk7XHJcbiAgICB9IGVsc2UgaWYgKFRhckdaLnByb3RvdHlwZS5jbGVhbkhpZ2hCeXRlKHRoaXMuZGF0YS5zdWJzdHJpbmcoMCw2KSkgPT0gXCJcXDIxMVBOR1xcclxcblwiKSB7XHJcbiAgICAgIHJldHVybiAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LCcrYnRvYShUYXJHWi5wcm90b3R5cGUuY2xlYW5IaWdoQnl0ZSh0aGlzLmRhdGEpKTtcclxuICAgIH0gZWxzZSBpZiAoVGFyR1oucHJvdG90eXBlLmNsZWFuSGlnaEJ5dGUodGhpcy5kYXRhLnN1YnN0cmluZygwLDYpKS5tYXRjaCgvR0lGOFs3OV1hLykpIHtcclxuICAgICAgcmV0dXJuICdkYXRhOmltYWdlL2dpZjtiYXNlNjQsJytidG9hKFRhckdaLnByb3RvdHlwZS5jbGVhbkhpZ2hCeXRlKHRoaXMuZGF0YSkpO1xyXG4gICAgfSBlbHNlIFxyXG4gICAge1xyXG4gICAgICAvL2NvbnNvbGUubG9nKFwidG9EYXRhVVJMOiBJIGRvbid0IGtub3cgaG93IHRvIGhhbmRsZSBcIiArIHRoaXMuZmlsZW5hbWUpO1xyXG4gICAgICByZXR1cm4gJ2RhdGE6YXVkaW8vd2F2O2Jhc2U2NCwnK2J0b2EoVGFyR1oucHJvdG90eXBlLmNsZWFuSGlnaEJ5dGUodGhpcy5kYXRhKSk7XHJcbiAgICB9XHJcbiAgfVxyXG59O1xyXG5cclxuXHJcblxyXG5CaW4gPSB7XHJcbiAgYnl0ZSA6IGZ1bmN0aW9uKHMsIG9mZnNldCkge1xyXG4gICAgcmV0dXJuIHMuY2hhckNvZGVBdChvZmZzZXQpICYgMHhmZjtcclxuICB9LFxyXG5cclxuICBVSW50MTZCRSA6IGZ1bmN0aW9uKHMsIG9mZnNldCkge1xyXG4gICAgcmV0dXJuICgoQmluLmJ5dGUocywgb2Zmc2V0KSA8PCA4KSB8IEJpbi5ieXRlKHMsIG9mZnNldCsxKSk7XHJcbiAgfSxcclxuXHJcbiAgVUludDMyQkUgOiBmdW5jdGlvbihzLCBvZmZzZXQpIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIChCaW4uYnl0ZShzLCBvZmZzZXQpIDw8IDI0KSB8XHJcbiAgICAgIChCaW4uYnl0ZShzLCBvZmZzZXQrMSkgPDwgMTYpIHxcclxuICAgICAgKEJpbi5ieXRlKHMsIG9mZnNldCsyKSA8PCA4KSB8XHJcbiAgICAgICBCaW4uYnl0ZShzLCBvZmZzZXQrMykpO1xyXG4gIH0sXHJcblxyXG4gIFVJbnQxNkxFIDogZnVuY3Rpb24ocywgb2Zmc2V0KSB7XHJcbiAgICByZXR1cm4gKChCaW4uYnl0ZShzLCBvZmZzZXQrMSkgPDwgOCkgfCBCaW4uYnl0ZShzLCBvZmZzZXQpKTtcclxuICB9LFxyXG5cclxuICBVSW50MzJMRSA6IGZ1bmN0aW9uKHMsIG9mZnNldCkge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgKEJpbi5ieXRlKHMsIG9mZnNldCszKSA8PCAyNCkgfFxyXG4gICAgICAoQmluLmJ5dGUocywgb2Zmc2V0KzIpIDw8IDE2KSB8XHJcbiAgICAgIChCaW4uYnl0ZShzLCBvZmZzZXQrMSkgPDwgOCkgfFxyXG4gICAgICAgQmluLmJ5dGUocywgb2Zmc2V0KSk7XHJcbiAgfSxcclxuXHJcbiAgQ1N0cmluZyA6IGZ1bmN0aW9uKHMsIG9mZnNldCkge1xyXG4gICAgdmFyIHplcm9JZHggPSBvZmZzZXQ7XHJcbiAgICBmb3IgKDsgemVyb0lkeDxzLmxlbmd0aDsgemVyb0lkeCsrKSB7XHJcbiAgICAgIGlmIChCaW4uYnl0ZShzLCB6ZXJvSWR4KSA9PSAwKVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgaWYgKHplcm9JZHggPT0gcy5sZW5ndGgpXHJcbiAgICAgIHRocm93KFwiTm8gbnVsbCBieXRlIGVuY291bnRlcmVkXCIpO1xyXG4gICAgcmV0dXJuIHMuc3Vic3RyaW5nKG9mZnNldCwgemVyb0lkeCk7XHJcbiAgfSxcclxuXHJcbiAgQ1JDMTYgOiBmdW5jdGlvbihzLCBzdGFydCwgbGVuZ3RoLCBjcmMpIHtcclxuICAgIHJldHVybiBjcmMzMihzLCBzdGFydCwgbGVuZ3RoLCBjcmMpICYgMHhmZmZmO1xyXG4gIH0sXHJcblxyXG4gIENSQzMyIDogZnVuY3Rpb24ocywgc3RhcnQsIGxlbmd0aCwgY3JjKSB7XHJcbiAgICByZXR1cm4gY3JjMzIocywgc3RhcnQsIGxlbmd0aCwgY3JjKTtcclxuICB9XHJcbn07XHJcblxyXG5HWmlwID0ge1xyXG4gIERFRkxBVEU6ICA4LFxyXG4gIEZURVhUOiAgICAxIDw8IDAsXHJcbiAgRkhDUkM6ICAgIDEgPDwgMSxcclxuICBGRVhUUkE6ICAgMSA8PCAyLFxyXG4gIEZOQU1FOiAgICAxIDw8IDMsXHJcbiAgRkNPTU1FTlQ6IDEgPDwgNCxcclxuXHJcbiAgbG9hZGxvY2FsIDogZnVuY3Rpb24oZGF0YSwgb25sb2FkLCBvbnN0cmVhbSwgb25lcnJvcikgXHJcbiAge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgdmFyIGggPSBudWxsO1xyXG4gICAgdmFyIHMgPSBkYXRhO1xyXG5cclxuICAgIHRyeSBcclxuICAgIHtcclxuICAgIFx0dmFyIHQgPSBuZXcgRGF0ZTtcclxuICAgIFx0aWYgKCFoKSBoID0gc2VsZi5wYXJzZUhlYWRlcihzKTtcclxuICAgIFx0c2VsZi5wYXJzZUFsbEJvZHkocywgaCwgb25zdHJlYW0pO1xyXG4gICAgXHRzZWxmLnBhcnNlRm9vdGVyKHMsIGgpO1xyXG4gICAgXHR2YXIgZWxhcHNlZCA9IG5ldyBEYXRlKCkgLSB0O1xyXG4gICAgXHRoLmRlY29tcHJlc3Npb25UaW1lICs9IGVsYXBzZWQ7XHJcbiAgICB9IFxyXG4gICAgY2F0Y2goZSkgXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yJyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKG9ubG9hZClcclxuXHR7XHJcbiAgICBcdG9ubG9hZChoLCBudWxsKTtcclxuXHR9XHJcbiAgfSxcdFxyXG5cclxuICBsb2FkIDogZnVuY3Rpb24oZGF0YSwgdXJsLCBvbmxvYWQsIG9uc3RyZWFtLCBvbmVycm9yKSBcclxuICB7XHJcbiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB2YXIgaCA9IG51bGw7XHJcbiAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PSA0KSB7XHJcbiAgICAgICAgaWYgKHhoci5zdGF0dXMgPT0gMjAwIHx8IHhoci5zdGF0dXMgPT0gMCkge1xyXG4gICAgICAgICAgdmFyIHMgPSB4aHIucmVzcG9uc2VUZXh0O1xyXG5cclxuXHQgICAgICBjb25zb2xlLmxvZygnZGF0YScpO1x0XHRcclxuXHRcdCAgY29uc29sZS5sb2cocyk7XHJcblxyXG5cclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gbmV3IERhdGU7XHJcbiAgICAgICAgICAgIGlmICghaCkgaCA9IHNlbGYucGFyc2VIZWFkZXIocyk7XHJcbiAgICAgICAgICAgIHNlbGYucGFyc2VBbGxCb2R5KHMsIGgsIG9uc3RyZWFtKTtcclxuICAgICAgICAgICAgc2VsZi5wYXJzZUZvb3RlcihzLCBoKTtcclxuICAgICAgICAgICAgdmFyIGVsYXBzZWQgPSBuZXcgRGF0ZSgpIC0gdDtcclxuICAgICAgICAgICAgaC5kZWNvbXByZXNzaW9uVGltZSArPSBlbGFwc2VkO1xyXG4gICAgICAgICAgfSBjYXRjaChlKSB7XHJcbiAgICAgICAgICAgIG9uZXJyb3IoeGhyLCBlLCBoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKG9ubG9hZClcclxuICAgICAgICAgICAgb25sb2FkKGgsIHhocik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGlmIChvbmVycm9yKVxyXG4gICAgICAgICAgICBvbmVycm9yKHhocik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKHhoci5yZWFkeVN0YXRlID09IDMpIHtcclxuICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PSAyMDAgfHwgeGhyLnN0YXR1cyA9PSAwKSB7XHJcbiAgICAgICAgICB2YXIgcyA9IHhoci5yZXNwb25zZVRleHQ7XHJcbiAgICAgICAgICBpZiAocy5sZW5ndGggPCAxMDI0KSByZXR1cm47IC8vIHJlYWQgaW4gaGVhZGVyXHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB2YXIgdCA9IG5ldyBEYXRlO1xyXG4gICAgICAgICAgICBpZiAoIWgpIGggPSBzZWxmLnBhcnNlSGVhZGVyKHMpO1xyXG4gICAgICAgICAgICBzZWxmLnBhcnNlQm9keShzLCBoLCBvbnN0cmVhbSk7XHJcbiAgICAgICAgICAgIHZhciBlbGFwc2VkID0gbmV3IERhdGUoKSAtIHQ7XHJcbiAgICAgICAgICAgIGguZGVjb21wcmVzc2lvblRpbWUgKz0gZWxhcHNlZDtcclxuICAgICAgICAgIH0gY2F0Y2goZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgeGhyLm9wZW4oXCJHRVRcIiwgdXJsLCB0cnVlKTtcclxuICAgIHhoci5vdmVycmlkZU1pbWVUeXBlKFwidGV4dC9wbGFpbjsgY2hhcnNldD14LXVzZXItZGVmaW5lZFwiKTtcclxuICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwidGV4dC9wbGFpblwiKTtcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coJ3NlbmQnKTtcclxuICAgIHhoci5zZW5kKG51bGwpO1xyXG4gIH0sXHJcblxyXG4gIHBhcnNlSGVhZGVyIDogZnVuY3Rpb24ocykge1xyXG4gICAgdmFyIGggPSB7fTtcclxuICAgIGguZGVjb21wcmVzc2lvblRpbWUgPSAwO1xyXG4gICAgaC5pZDEgPSBCaW4uYnl0ZShzLDApO1xyXG4gICAgaC5pZDIgPSBCaW4uYnl0ZShzLDEpO1xyXG4gICAgaC5jb21wcmVzc2lvbk1ldGhvZCA9IEJpbi5ieXRlKHMsMik7XHJcbiAgICBpZiAoaC5pZDEgIT0gMHgxZiB8fCBoLmlkMiAhPSAweDhiIHx8IGguY29tcHJlc3Npb25NZXRob2QgIT0gR1ppcC5ERUZMQVRFKSB7XHJcbiAgICAgIHRocm93KFwiTm90IGEgR1ppcCBmaWxlOiBcIiArIGguaWQxICsgJywnICsgaC5pZDIgKyAnLCcgKyBoLmNvbXByZXNzaW9uTWV0aG9kKTtcclxuICAgIH1cclxuICAgIGguZmxhZ3MgPSBCaW4uYnl0ZShzLDMpO1xyXG4gICAgaC5tdGltZSA9IEJpbi5VSW50MzJMRShzLCA0KTtcclxuICAgIGguZXh0cmFGbGFncyA9IEJpbi5ieXRlKHMsIDgpO1xyXG4gICAgaC5vcGVyYXRpbmdTeXN0ZW0gPSBCaW4uYnl0ZShzLCA5KTtcclxuICAgIHZhciBvZmZzZXQgPSAxMDtcclxuICAgIGlmIChoLmZsYWdzICYgR1ppcC5GRVhUUkEpIHtcclxuICAgICAgdmFyIHhsZW4gPSBCaW4uVUludDE2TEUocywgb2Zmc2V0KTtcclxuICAgICAgb2Zmc2V0ICs9IDI7XHJcbiAgICAgIGguZXh0cmFGaWVsZCA9IHMuc3Vic3RyaW5nKG9mZnNldCwgb2Zmc2V0K3hsZW4pO1xyXG4gICAgICBvZmZzZXQgKz0geGxlbjtcclxuICAgIH1cclxuICAgIGlmIChoLmZsYWdzICYgR1ppcC5GTkFNRSkge1xyXG4gICAgICBoLmZpbGVuYW1lID0gQmluLkNTdHJpbmcocywgb2Zmc2V0KTtcclxuICAgICAgb2Zmc2V0ICs9IGguZmlsZW5hbWUubGVuZ3RoICsgMTtcclxuICAgIH1cclxuICAgIGlmIChoLmZsYWdzICYgR1ppcC5GQ09NTUVOVCkge1xyXG4gICAgICBoLmNvbW1lbnQgPSBCaW4uQ1N0cmluZyhzLCBvZmZzZXQpO1xyXG4gICAgICBvZmZzZXQgKz0gaC5jb21tZW50Lmxlbmd0aCArIDE7XHJcbiAgICB9XHJcbiAgICBoLmNvbXB1dGVkSGVhZGVyQ1JDMTYgPSBCaW4uQ1JDMTYocywgMCwgb2Zmc2V0LCAwKTtcclxuICAgIGlmIChoLmZsYWdzICYgR1ppcC5GSENSQykge1xyXG4gICAgICBoLmhlYWRlckNSQzE2ID0gQmluLlVJbnQxNkxFKHMsIG9mZnNldCk7XHJcbiAgICAgIGlmIChoLmNvbXB1dGVkSGVhZGVyQ1JDMTYgIT0gbnVsbCAmJiBoLmhlYWRlckNSQzE2ICE9IGguY29tcHV0ZWRIZWFkZXJDUkMxNilcclxuICAgICAgICB0aHJvdyhcIkhlYWRlciBDUkMxNiBjaGVjayBmYWlsZWRcIik7XHJcbiAgICAgIG9mZnNldCArPSAyO1xyXG4gICAgfVxyXG4gICAgaC5vZmZzZXQgPSBvZmZzZXQ7XHJcbiAgICBoLmRhdGEgPSBbXTtcclxuICAgIGgub3V0cHV0U2l6ZSA9IDA7XHJcbiAgICBoLmluZmxhdGVyID0gbmV3IEluZmxhdGVyKCk7XHJcbiAgICBoLmluZmxhdGVyLnN0YXJ0X2luZmxhdGUoaCk7XHJcbiAgICByZXR1cm4gaDtcclxuICB9LFxyXG4gIFxyXG4gIHBhcnNlQm9keSA6IGZ1bmN0aW9uKHMsIGgsIG9uc3RyZWFtKSB7XHJcbiAgICBoLmluZmxhdGVyLmNvbnRpbnVlX2luZmxhdGUocywgaCwgb25zdHJlYW0pO1xyXG4gICAgcmV0dXJuIGg7XHJcbiAgfSxcclxuICBcclxuICBwYXJzZUFsbEJvZHkgOiBmdW5jdGlvbihzLCBoLCBvbnN0cmVhbSkge1xyXG4gICAgaC5pbmZsYXRlci5maW5hbF9pbmZsYXRlKHMsIGgsIG9uc3RyZWFtKTtcclxuICAgIHJldHVybiBoO1xyXG4gIH0sXHJcbiAgXHJcbiAgcGFyc2VGb290ZXIgOiBmdW5jdGlvbihzLCBoKSB7XHJcbiAgICBoLkNSQzMyID0gQmluLlVJbnQzMkxFKHMsIHMubGVuZ3RoLTgpO1xyXG4gICAgaWYgKGguY29tcHV0ZWRDUkMzMiAmJiBoLmNvbXB1dGVkQ1JDMzIgIT0gaC5DUkMzMilcclxuICAgICAgdGhyb3coXCJEYXRhIENSQzMyIGNoZWNrIGZhaWxlZFwiKTtcclxuICAgIGguaW5wdXRTaXplID0gQmluLlVJbnQzMkxFKHMsIHMubGVuZ3RoLTQpO1xyXG4gICAgaWYgKGguZGF0YSAhPSBudWxsICYmIGguaW5wdXRTaXplICE9IChoLm91dHB1dFNpemUgJSAweGZmZmZmZmZmKSlcclxuICAgICAgdGhyb3coXCJEYXRhIGxlbmd0aCBjaGVjayBmYWlsZWRcIik7XHJcbiAgICByZXR1cm4gaDtcclxuICB9XHJcbn07XHJcblxyXG4vKiAgIFxyXG49PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IFxyXG5DcmMzMiBpcyBhIEphdmFTY3JpcHQgZnVuY3Rpb24gZm9yIGNvbXB1dGluZyB0aGUgQ1JDMzIgb2YgYSBzdHJpbmcgXHJcbi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4gXHJcbiBcclxuVmVyc2lvbjogMS4yIC0gMjAwNi8xMSAtIGh0dHA6Ly9ub3Rlc2xvZy5jb20vY2F0ZWdvcnkvamF2YXNjcmlwdC8gXHJcbiBcclxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBcclxuQ29weXJpZ2h0IChjKSAyMDA2IEFuZHJlYSBFcmNvbGlubyBcclxuaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHAgXHJcbj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gXHJcbiovIFxyXG4gXHJcbihmdW5jdGlvbigpIHsgXHJcbiAgICB2YXIgdGFibGUgPSBcIjAwMDAwMDAwIDc3MDczMDk2IEVFMEU2MTJDIDk5MDk1MUJBIDA3NkRDNDE5IDcwNkFGNDhGIEU5NjNBNTM1IDlFNjQ5NUEzIDBFREI4ODMyIDc5RENCOEE0IEUwRDVFOTFFIDk3RDJEOTg4IDA5QjY0QzJCIDdFQjE3Q0JEIEU3QjgyRDA3IDkwQkYxRDkxIDFEQjcxMDY0IDZBQjAyMEYyIEYzQjk3MTQ4IDg0QkU0MURFIDFBREFENDdEIDZERERFNEVCIEY0RDRCNTUxIDgzRDM4NUM3IDEzNkM5ODU2IDY0NkJBOEMwIEZENjJGOTdBIDhBNjVDOUVDIDE0MDE1QzRGIDYzMDY2Q0Q5IEZBMEYzRDYzIDhEMDgwREY1IDNCNkUyMEM4IDRDNjkxMDVFIEQ1NjA0MUU0IEEyNjc3MTcyIDNDMDNFNEQxIDRCMDRENDQ3IEQyMEQ4NUZEIEE1MEFCNTZCIDM1QjVBOEZBIDQyQjI5ODZDIERCQkJDOUQ2IEFDQkNGOTQwIDMyRDg2Q0UzIDQ1REY1Qzc1IERDRDYwRENGIEFCRDEzRDU5IDI2RDkzMEFDIDUxREUwMDNBIEM4RDc1MTgwIEJGRDA2MTE2IDIxQjRGNEI1IDU2QjNDNDIzIENGQkE5NTk5IEI4QkRBNTBGIDI4MDJCODlFIDVGMDU4ODA4IEM2MENEOUIyIEIxMEJFOTI0IDJGNkY3Qzg3IDU4Njg0QzExIEMxNjExREFCIEI2NjYyRDNEIDc2REM0MTkwIDAxREI3MTA2IDk4RDIyMEJDIEVGRDUxMDJBIDcxQjE4NTg5IDA2QjZCNTFGIDlGQkZFNEE1IEU4QjhENDMzIDc4MDdDOUEyIDBGMDBGOTM0IDk2MDlBODhFIEUxMEU5ODE4IDdGNkEwREJCIDA4NkQzRDJEIDkxNjQ2Qzk3IEU2NjM1QzAxIDZCNkI1MUY0IDFDNkM2MTYyIDg1NjUzMEQ4IEYyNjIwMDRFIDZDMDY5NUVEIDFCMDFBNTdCIDgyMDhGNEMxIEY1MEZDNDU3IDY1QjBEOUM2IDEyQjdFOTUwIDhCQkVCOEVBIEZDQjk4ODdDIDYyREQxRERGIDE1REEyRDQ5IDhDRDM3Q0YzIEZCRDQ0QzY1IDREQjI2MTU4IDNBQjU1MUNFIEEzQkMwMDc0IEQ0QkIzMEUyIDRBREZBNTQxIDNERDg5NUQ3IEE0RDFDNDZEIEQzRDZGNEZCIDQzNjlFOTZBIDM0NkVEOUZDIEFENjc4ODQ2IERBNjBCOEQwIDQ0MDQyRDczIDMzMDMxREU1IEFBMEE0QzVGIEREMEQ3Q0M5IDUwMDU3MTNDIDI3MDI0MUFBIEJFMEIxMDEwIEM5MEMyMDg2IDU3NjhCNTI1IDIwNkY4NUIzIEI5NjZENDA5IENFNjFFNDlGIDVFREVGOTBFIDI5RDlDOTk4IEIwRDA5ODIyIEM3RDdBOEI0IDU5QjMzRDE3IDJFQjQwRDgxIEI3QkQ1QzNCIEMwQkE2Q0FEIEVEQjg4MzIwIDlBQkZCM0I2IDAzQjZFMjBDIDc0QjFEMjlBIEVBRDU0NzM5IDlERDI3N0FGIDA0REIyNjE1IDczREMxNjgzIEUzNjMwQjEyIDk0NjQzQjg0IDBENkQ2QTNFIDdBNkE1QUE4IEU0MEVDRjBCIDkzMDlGRjlEIDBBMDBBRTI3IDdEMDc5RUIxIEYwMEY5MzQ0IDg3MDhBM0QyIDFFMDFGMjY4IDY5MDZDMkZFIEY3NjI1NzVEIDgwNjU2N0NCIDE5NkMzNjcxIDZFNkIwNkU3IEZFRDQxQjc2IDg5RDMyQkUwIDEwREE3QTVBIDY3REQ0QUNDIEY5QjlERjZGIDhFQkVFRkY5IDE3QjdCRTQzIDYwQjA4RUQ1IEQ2RDZBM0U4IEExRDE5MzdFIDM4RDhDMkM0IDRGREZGMjUyIEQxQkI2N0YxIEE2QkM1NzY3IDNGQjUwNkREIDQ4QjIzNjRCIEQ4MEQyQkRBIEFGMEExQjRDIDM2MDM0QUY2IDQxMDQ3QTYwIERGNjBFRkMzIEE4NjdERjU1IDMxNkU4RUVGIDQ2NjlCRTc5IENCNjFCMzhDIEJDNjY4MzFBIDI1NkZEMkEwIDUyNjhFMjM2IENDMEM3Nzk1IEJCMEI0NzAzIDIyMDIxNkI5IDU1MDUyNjJGIEM1QkEzQkJFIEIyQkQwQjI4IDJCQjQ1QTkyIDVDQjM2QTA0IEMyRDdGRkE3IEI1RDBDRjMxIDJDRDk5RThCIDVCREVBRTFEIDlCNjRDMkIwIEVDNjNGMjI2IDc1NkFBMzlDIDAyNkQ5MzBBIDlDMDkwNkE5IEVCMEUzNjNGIDcyMDc2Nzg1IDA1MDA1NzEzIDk1QkY0QTgyIEUyQjg3QTE0IDdCQjEyQkFFIDBDQjYxQjM4IDkyRDI4RTlCIEU1RDVCRTBEIDdDRENFRkI3IDBCREJERjIxIDg2RDNEMkQ0IEYxRDRFMjQyIDY4RERCM0Y4IDFGREE4MzZFIDgxQkUxNkNEIEY2QjkyNjVCIDZGQjA3N0UxIDE4Qjc0Nzc3IDg4MDg1QUU2IEZGMEY2QTcwIDY2MDYzQkNBIDExMDEwQjVDIDhGNjU5RUZGIEY4NjJBRTY5IDYxNkJGRkQzIDE2NkNDRjQ1IEEwMEFFMjc4IEQ3MEREMkVFIDRFMDQ4MzU0IDM5MDNCM0MyIEE3NjcyNjYxIEQwNjAxNkY3IDQ5Njk0NzREIDNFNkU3N0RCIEFFRDE2QTRBIEQ5RDY1QURDIDQwREYwQjY2IDM3RDgzQkYwIEE5QkNBRTUzIERFQkI5RUM1IDQ3QjJDRjdGIDMwQjVGRkU5IEJEQkRGMjFDIENBQkFDMjhBIDUzQjM5MzMwIDI0QjRBM0E2IEJBRDAzNjA1IENERDcwNjkzIDU0REU1NzI5IDIzRDk2N0JGIEIzNjY3QTJFIEM0NjE0QUI4IDVENjgxQjAyIDJBNkYyQjk0IEI0MEJCRTM3IEMzMEM4RUExIDVBMDVERjFCIDJEMDJFRjhEXCI7XHJcbiAgICB2YXIgaW50VGFibGUgPSBbXTtcclxuICAgIGZvciAodmFyIGk9MDsgaSA8IHRhYmxlLmxlbmd0aCAvIDk7IGkrKykge1xyXG4gICAgICBpbnRUYWJsZS5wdXNoKHBhcnNlSW50KHRhYmxlLnN1YnN0ciggaSo5LCA4KSwgMTYpKTtcclxuICAgIH1cclxuICAgIC8qIE51bWJlciAqLyBcclxuICAgIGNyYzMyID0gZnVuY3Rpb24oIC8qIFN0cmluZyAqLyBzdHIsIHN0YXJ0LCBsZW5ndGgsIC8qIE51bWJlciAqLyBjcmMgKSB7IFxyXG4gICAgICAgIGNyYyA9IGNyYyBeICgtMSk7XHJcbiAgICAgICAgdmFyIGVuZCA9IE1hdGgubWluKHN0ci5sZW5ndGgsIHN0YXJ0ICsgbGVuZ3RoKTtcclxuICAgICAgICBmb3IoIHZhciBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKyApIHtcclxuICAgICAgICAgICAgdmFyIG4gPSAoIGNyYyBeIHN0ci5jaGFyQ29kZUF0KCBpICkgKSAmIDB4RkY7IFxyXG4gICAgICAgICAgICBjcmMgPSAoIGNyYyA+Pj4gOCApIF4gaW50VGFibGVbbl07XHJcbiAgICAgICAgfSBcclxuICAgICAgICByZXR1cm4gY3JjIF4gKC0xKTsgXHJcbiAgICB9OyBcclxufSkoKTtcclxuXHJcbi8qXHJcbiAqICRJZDogcmF3aW5mbGF0ZS5qcyx2IDAuMiAyMDA5LzAzLzAxIDE4OjMyOjI0IGRhbmtvZ2FpIEV4cCAkXHJcbiAqXHJcbiAqIG9yaWdpbmFsOlxyXG4gKiBodHRwOi8vd3d3Lm9uaWNvcy5jb20vc3RhZmYvaXovYW11c2UvamF2YXNjcmlwdC9leHBlcnQvaW5mbGF0ZS50eHRcclxuICovXHJcblxyXG5JbmZsYXRlciA9IChmdW5jdGlvbigpe1xyXG5cclxuLyogQ29weXJpZ2h0IChDKSAxOTk5IE1hc2FuYW8gSXp1bW8gPGl6QG9uaWNvcy5jby5qcD5cclxuICogVmVyc2lvbjogMS4wLjAuMVxyXG4gKiBMYXN0TW9kaWZpZWQ6IERlYyAyNSAxOTk5XHJcbiAqL1xyXG5cclxuLyogSW50ZXJmYWNlOlxyXG4gKiBkYXRhID0gemlwX2luZmxhdGUoc3JjKTtcclxuICovXHJcblxyXG4vKiBjb25zdGFudCBwYXJhbWV0ZXJzICovXHJcbnZhciB6aXBfV1NJWkUgPSAzMjc2ODsgICAgICAgIC8vIFNsaWRpbmcgV2luZG93IHNpemVcclxudmFyIHppcF9TVE9SRURfQkxPQ0sgPSAwO1xyXG52YXIgemlwX1NUQVRJQ19UUkVFUyA9IDE7XHJcbnZhciB6aXBfRFlOX1RSRUVTICA9IDI7XHJcblxyXG4vKiBmb3IgaW5mbGF0ZSAqL1xyXG52YXIgemlwX2xiaXRzID0gOTsgICAgICAgICAvLyBiaXRzIGluIGJhc2UgbGl0ZXJhbC9sZW5ndGggbG9va3VwIHRhYmxlXHJcbnZhciB6aXBfZGJpdHMgPSA2OyAgICAgICAgIC8vIGJpdHMgaW4gYmFzZSBkaXN0YW5jZSBsb29rdXAgdGFibGVcclxudmFyIHppcF9JTkJVRlNJWiA9IDMyNzY4OyAgICAvLyBJbnB1dCBidWZmZXIgc2l6ZVxyXG52YXIgemlwX0lOQlVGX0VYVFJBID0gNjQ7ICAgIC8vIEV4dHJhIGJ1ZmZlclxyXG5cclxuLyogdmFyaWFibGVzIChpbmZsYXRlKSAqL1xyXG52YXIgemlwX3NsaWRlO1xyXG52YXIgemlwX3dwOyAgICAgICAgICAgIC8vIGN1cnJlbnQgcG9zaXRpb24gaW4gc2xpZGVcclxudmFyIHppcF9maXhlZF90bCA9IG51bGw7ICAgIC8vIGluZmxhdGUgc3RhdGljXHJcbnZhciB6aXBfZml4ZWRfdGQ7ICAgICAgICAvLyBpbmZsYXRlIHN0YXRpY1xyXG52YXIgemlwX2ZpeGVkX2JsLCBmaXhlZF9iZDsgICAgLy8gaW5mbGF0ZSBzdGF0aWNcclxudmFyIHppcF9iaXRfYnVmOyAgICAgICAgLy8gYml0IGJ1ZmZlclxyXG52YXIgemlwX2JpdF9sZW47ICAgICAgICAvLyBiaXRzIGluIGJpdCBidWZmZXJcclxudmFyIHppcF9tZXRob2Q7XHJcbnZhciB6aXBfZW9mO1xyXG52YXIgemlwX2NvcHlfbGVuZztcclxudmFyIHppcF9jb3B5X2Rpc3Q7XHJcbnZhciB6aXBfdGwsIHppcF90ZDsgICAgLy8gbGl0ZXJhbC9sZW5ndGggYW5kIGRpc3RhbmNlIGRlY29kZXIgdGFibGVzXHJcbnZhciB6aXBfYmwsIHppcF9iZDsgICAgLy8gbnVtYmVyIG9mIGJpdHMgZGVjb2RlZCBieSB0bCBhbmQgdGRcclxuXHJcbnZhciB6aXBfaW5mbGF0ZV9kYXRhO1xyXG52YXIgemlwX2luZmxhdGVfcG9zO1xyXG5cclxuXHJcbi8qIGNvbnN0YW50IHRhYmxlcyAoaW5mbGF0ZSkgKi9cclxudmFyIHppcF9NQVNLX0JJVFMgPSBuZXcgQXJyYXkoXHJcbiAgMHgwMDAwLFxyXG4gIDB4MDAwMSwgMHgwMDAzLCAweDAwMDcsIDB4MDAwZiwgMHgwMDFmLCAweDAwM2YsIDB4MDA3ZiwgMHgwMGZmLFxyXG4gIDB4MDFmZiwgMHgwM2ZmLCAweDA3ZmYsIDB4MGZmZiwgMHgxZmZmLCAweDNmZmYsIDB4N2ZmZiwgMHhmZmZmKTtcclxuLy8gVGFibGVzIGZvciBkZWZsYXRlIGZyb20gUEtaSVAncyBhcHBub3RlLnR4dC5cclxudmFyIHppcF9jcGxlbnMgPSBuZXcgQXJyYXkoIC8vIENvcHkgbGVuZ3RocyBmb3IgbGl0ZXJhbCBjb2RlcyAyNTcuLjI4NVxyXG4gIDMsIDQsIDUsIDYsIDcsIDgsIDksIDEwLCAxMSwgMTMsIDE1LCAxNywgMTksIDIzLCAyNywgMzEsXHJcbiAgMzUsIDQzLCA1MSwgNTksIDY3LCA4MywgOTksIDExNSwgMTMxLCAxNjMsIDE5NSwgMjI3LCAyNTgsIDAsIDApO1xyXG4vKiBub3RlOiBzZWUgbm90ZSAjMTMgYWJvdmUgYWJvdXQgdGhlIDI1OCBpbiB0aGlzIGxpc3QuICovXHJcbnZhciB6aXBfY3BsZXh0ID0gbmV3IEFycmF5KCAvLyBFeHRyYSBiaXRzIGZvciBsaXRlcmFsIGNvZGVzIDI1Ny4uMjg1XHJcbiAgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMSwgMSwgMSwgMSwgMiwgMiwgMiwgMixcclxuICAzLCAzLCAzLCAzLCA0LCA0LCA0LCA0LCA1LCA1LCA1LCA1LCAwLCA5OSwgOTkpOyAvLyA5OT09aW52YWxpZFxyXG52YXIgemlwX2NwZGlzdCA9IG5ldyBBcnJheSggLy8gQ29weSBvZmZzZXRzIGZvciBkaXN0YW5jZSBjb2RlcyAwLi4yOVxyXG4gIDEsIDIsIDMsIDQsIDUsIDcsIDksIDEzLCAxNywgMjUsIDMzLCA0OSwgNjUsIDk3LCAxMjksIDE5MyxcclxuICAyNTcsIDM4NSwgNTEzLCA3NjksIDEwMjUsIDE1MzcsIDIwNDksIDMwNzMsIDQwOTcsIDYxNDUsXHJcbiAgODE5MywgMTIyODksIDE2Mzg1LCAyNDU3Nyk7XHJcbnZhciB6aXBfY3BkZXh0ID0gbmV3IEFycmF5KCAvLyBFeHRyYSBiaXRzIGZvciBkaXN0YW5jZSBjb2Rlc1xyXG4gIDAsIDAsIDAsIDAsIDEsIDEsIDIsIDIsIDMsIDMsIDQsIDQsIDUsIDUsIDYsIDYsXHJcbiAgNywgNywgOCwgOCwgOSwgOSwgMTAsIDEwLCAxMSwgMTEsXHJcbiAgMTIsIDEyLCAxMywgMTMpO1xyXG52YXIgemlwX2JvcmRlciA9IG5ldyBBcnJheSggIC8vIE9yZGVyIG9mIHRoZSBiaXQgbGVuZ3RoIGNvZGUgbGVuZ3Roc1xyXG4gIDE2LCAxNywgMTgsIDAsIDgsIDcsIDksIDYsIDEwLCA1LCAxMSwgNCwgMTIsIDMsIDEzLCAyLCAxNCwgMSwgMTUpO1xyXG4vKiBvYmplY3RzIChpbmZsYXRlKSAqL1xyXG5cclxudmFyIHppcF9IdWZ0TGlzdCA9IGZ1bmN0aW9uKCkge1xyXG4gIHRoaXMubmV4dCA9IG51bGw7XHJcbiAgdGhpcy5saXN0ID0gbnVsbDtcclxufTtcclxuXHJcbnZhciB6aXBfSHVmdE5vZGUgPSBmdW5jdGlvbigpIHtcclxuICB0aGlzLmUgPSAwOyAvLyBudW1iZXIgb2YgZXh0cmEgYml0cyBvciBvcGVyYXRpb25cclxuICB0aGlzLmIgPSAwOyAvLyBudW1iZXIgb2YgYml0cyBpbiB0aGlzIGNvZGUgb3Igc3ViY29kZVxyXG5cclxuICAvLyB1bmlvblxyXG4gIHRoaXMubiA9IDA7IC8vIGxpdGVyYWwsIGxlbmd0aCBiYXNlLCBvciBkaXN0YW5jZSBiYXNlXHJcbiAgdGhpcy50ID0gbnVsbDsgLy8gKHppcF9IdWZ0Tm9kZSkgcG9pbnRlciB0byBuZXh0IGxldmVsIG9mIHRhYmxlXHJcbn07XHJcblxyXG52YXIgemlwX0h1ZnRCdWlsZCA9IGZ1bmN0aW9uKGIsICAgIC8vIGNvZGUgbGVuZ3RocyBpbiBiaXRzIChhbGwgYXNzdW1lZCA8PSBCTUFYKVxyXG4gICAgICAgICAgICAgbiwgICAgLy8gbnVtYmVyIG9mIGNvZGVzIChhc3N1bWVkIDw9IE5fTUFYKVxyXG4gICAgICAgICAgICAgcywgICAgLy8gbnVtYmVyIG9mIHNpbXBsZS12YWx1ZWQgY29kZXMgKDAuLnMtMSlcclxuICAgICAgICAgICAgIGQsICAgIC8vIGxpc3Qgb2YgYmFzZSB2YWx1ZXMgZm9yIG5vbi1zaW1wbGUgY29kZXNcclxuICAgICAgICAgICAgIGUsICAgIC8vIGxpc3Qgb2YgZXh0cmEgYml0cyBmb3Igbm9uLXNpbXBsZSBjb2Rlc1xyXG4gICAgICAgICAgICAgbW0gICAgLy8gbWF4aW11bSBsb29rdXAgYml0c1xyXG4gICAgICAgICAgICkge1xyXG4gIHRoaXMuQk1BWCA9IDE2OyAgIC8vIG1heGltdW0gYml0IGxlbmd0aCBvZiBhbnkgY29kZVxyXG4gIHRoaXMuTl9NQVggPSAyODg7IC8vIG1heGltdW0gbnVtYmVyIG9mIGNvZGVzIGluIGFueSBzZXRcclxuICB0aGlzLnN0YXR1cyA9IDA7ICAgIC8vIDA6IHN1Y2Nlc3MsIDE6IGluY29tcGxldGUgdGFibGUsIDI6IGJhZCBpbnB1dFxyXG4gIHRoaXMucm9vdCA9IG51bGw7ICAgIC8vICh6aXBfSHVmdExpc3QpIHN0YXJ0aW5nIHRhYmxlXHJcbiAgdGhpcy5tID0gMDsgICAgICAgIC8vIG1heGltdW0gbG9va3VwIGJpdHMsIHJldHVybnMgYWN0dWFsXHJcblxyXG4vKiBHaXZlbiBhIGxpc3Qgb2YgY29kZSBsZW5ndGhzIGFuZCBhIG1heGltdW0gdGFibGUgc2l6ZSwgbWFrZSBhIHNldCBvZlxyXG4gICB0YWJsZXMgdG8gZGVjb2RlIHRoYXQgc2V0IG9mIGNvZGVzLiAgICBSZXR1cm4gemVybyBvbiBzdWNjZXNzLCBvbmUgaWZcclxuICAgdGhlIGdpdmVuIGNvZGUgc2V0IGlzIGluY29tcGxldGUgKHRoZSB0YWJsZXMgYXJlIHN0aWxsIGJ1aWx0IGluIHRoaXNcclxuICAgY2FzZSksIHR3byBpZiB0aGUgaW5wdXQgaXMgaW52YWxpZCAoYWxsIHplcm8gbGVuZ3RoIGNvZGVzIG9yIGFuXHJcbiAgIG92ZXJzdWJzY3JpYmVkIHNldCBvZiBsZW5ndGhzKSwgYW5kIHRocmVlIGlmIG5vdCBlbm91Z2ggbWVtb3J5LlxyXG4gICBUaGUgY29kZSB3aXRoIHZhbHVlIDI1NiBpcyBzcGVjaWFsLCBhbmQgdGhlIHRhYmxlcyBhcmUgY29uc3RydWN0ZWRcclxuICAgc28gdGhhdCBubyBiaXRzIGJleW9uZCB0aGF0IGNvZGUgYXJlIGZldGNoZWQgd2hlbiB0aGF0IGNvZGUgaXNcclxuICAgZGVjb2RlZC4gKi9cclxuICB7XHJcbiAgICB2YXIgYTsgICAgICAgICAgICAvLyBjb3VudGVyIGZvciBjb2RlcyBvZiBsZW5ndGgga1xyXG4gICAgdmFyIGMgPSBuZXcgQXJyYXkodGhpcy5CTUFYKzEpOyAgICAvLyBiaXQgbGVuZ3RoIGNvdW50IHRhYmxlXHJcbiAgICB2YXIgZWw7ICAgICAgICAgICAgLy8gbGVuZ3RoIG9mIEVPQiBjb2RlICh2YWx1ZSAyNTYpXHJcbiAgICB2YXIgZjsgICAgICAgICAgICAvLyBpIHJlcGVhdHMgaW4gdGFibGUgZXZlcnkgZiBlbnRyaWVzXHJcbiAgICB2YXIgZzsgICAgICAgICAgICAvLyBtYXhpbXVtIGNvZGUgbGVuZ3RoXHJcbiAgICB2YXIgaDsgICAgICAgICAgICAvLyB0YWJsZSBsZXZlbFxyXG4gICAgdmFyIGk7ICAgICAgICAgICAgLy8gY291bnRlciwgY3VycmVudCBjb2RlXHJcbiAgICB2YXIgajsgICAgICAgICAgICAvLyBjb3VudGVyXHJcbiAgICB2YXIgazsgICAgICAgICAgICAvLyBudW1iZXIgb2YgYml0cyBpbiBjdXJyZW50IGNvZGVcclxuICAgIHZhciBseCA9IG5ldyBBcnJheSh0aGlzLkJNQVgrMSk7ICAgIC8vIHN0YWNrIG9mIGJpdHMgcGVyIHRhYmxlXHJcbiAgICB2YXIgcDsgICAgICAgICAgICAvLyBwb2ludGVyIGludG8gY1tdLCBiW10sIG9yIHZbXVxyXG4gICAgdmFyIHBpZHg7ICAgICAgICAvLyBpbmRleCBvZiBwXHJcbiAgICB2YXIgcTsgICAgICAgICAgICAvLyAoemlwX0h1ZnROb2RlKSBwb2ludHMgdG8gY3VycmVudCB0YWJsZVxyXG4gICAgdmFyIHIgPSBuZXcgemlwX0h1ZnROb2RlKCk7IC8vIHRhYmxlIGVudHJ5IGZvciBzdHJ1Y3R1cmUgYXNzaWdubWVudFxyXG4gICAgdmFyIHUgPSBuZXcgQXJyYXkodGhpcy5CTUFYKTsgLy8gemlwX0h1ZnROb2RlW0JNQVhdW10gIHRhYmxlIHN0YWNrXHJcbiAgICB2YXIgdiA9IG5ldyBBcnJheSh0aGlzLk5fTUFYKTsgLy8gdmFsdWVzIGluIG9yZGVyIG9mIGJpdCBsZW5ndGhcclxuICAgIHZhciB3O1xyXG4gICAgdmFyIHggPSBuZXcgQXJyYXkodGhpcy5CTUFYKzEpOy8vIGJpdCBvZmZzZXRzLCB0aGVuIGNvZGUgc3RhY2tcclxuICAgIHZhciB4cDsgICAgICAgICAgICAvLyBwb2ludGVyIGludG8geCBvciBjXHJcbiAgICB2YXIgeTsgICAgICAgICAgICAvLyBudW1iZXIgb2YgZHVtbXkgY29kZXMgYWRkZWRcclxuICAgIHZhciB6OyAgICAgICAgICAgIC8vIG51bWJlciBvZiBlbnRyaWVzIGluIGN1cnJlbnQgdGFibGVcclxuICAgIHZhciBvO1xyXG4gICAgdmFyIHRhaWw7ICAgICAgICAvLyAoemlwX0h1ZnRMaXN0KVxyXG5cclxuICAgIHRhaWwgPSB0aGlzLnJvb3QgPSBudWxsO1xyXG4gICAgZm9yKGkgPSAwOyBpIDwgYy5sZW5ndGg7IGkrKylcclxuICAgICAgY1tpXSA9IDA7XHJcbiAgICBmb3IoaSA9IDA7IGkgPCBseC5sZW5ndGg7IGkrKylcclxuICAgICAgbHhbaV0gPSAwO1xyXG4gICAgZm9yKGkgPSAwOyBpIDwgdS5sZW5ndGg7IGkrKylcclxuICAgICAgdVtpXSA9IG51bGw7XHJcbiAgICBmb3IoaSA9IDA7IGkgPCB2Lmxlbmd0aDsgaSsrKVxyXG4gICAgICB2W2ldID0gMDtcclxuICAgIGZvcihpID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspXHJcbiAgICAgIHhbaV0gPSAwO1xyXG5cclxuICAgIC8vIEdlbmVyYXRlIGNvdW50cyBmb3IgZWFjaCBiaXQgbGVuZ3RoXHJcbiAgICBlbCA9IG4gPiAyNTYgPyBiWzI1Nl0gOiB0aGlzLkJNQVg7IC8vIHNldCBsZW5ndGggb2YgRU9CIGNvZGUsIGlmIGFueVxyXG4gICAgcCA9IGI7IHBpZHggPSAwO1xyXG4gICAgaSA9IG47XHJcbiAgICBkbyB7XHJcbiAgICAgIGNbcFtwaWR4XV0rKzsgICAgLy8gYXNzdW1lIGFsbCBlbnRyaWVzIDw9IEJNQVhcclxuICAgICAgcGlkeCsrO1xyXG4gICAgfSB3aGlsZSgtLWkgPiAwKTtcclxuICAgIGlmKGNbMF0gPT0gbikgeyAgICAvLyBudWxsIGlucHV0LS1hbGwgemVybyBsZW5ndGggY29kZXNcclxuICAgICAgdGhpcy5yb290ID0gbnVsbDtcclxuICAgICAgdGhpcy5tID0gMDtcclxuICAgICAgdGhpcy5zdGF0dXMgPSAwO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRmluZCBtaW5pbXVtIGFuZCBtYXhpbXVtIGxlbmd0aCwgYm91bmQgKm0gYnkgdGhvc2VcclxuICAgIGZvcihqID0gMTsgaiA8PSB0aGlzLkJNQVg7IGorKylcclxuICAgICAgaWYoY1tqXSAhPSAwKVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgayA9IGo7ICAgICAgICAgICAgLy8gbWluaW11bSBjb2RlIGxlbmd0aFxyXG4gICAgaWYobW0gPCBqKVxyXG4gICAgICBtbSA9IGo7XHJcbiAgICBmb3IoaSA9IHRoaXMuQk1BWDsgaSAhPSAwOyBpLS0pXHJcbiAgICAgIGlmKGNbaV0gIT0gMClcclxuICAgICAgICBicmVhaztcclxuICAgIGcgPSBpOyAgICAgICAgICAgIC8vIG1heGltdW0gY29kZSBsZW5ndGhcclxuICAgIGlmKG1tID4gaSlcclxuICAgICAgbW0gPSBpO1xyXG5cclxuICAgIC8vIEFkanVzdCBsYXN0IGxlbmd0aCBjb3VudCB0byBmaWxsIG91dCBjb2RlcywgaWYgbmVlZGVkXHJcbiAgICBmb3IoeSA9IDEgPDwgajsgaiA8IGk7IGorKywgeSA8PD0gMSlcclxuICAgICAgaWYoKHkgLT0gY1tqXSkgPCAwKSB7XHJcbiAgICAgICAgdGhpcy5zdGF0dXMgPSAyOyAgICAvLyBiYWQgaW5wdXQ6IG1vcmUgY29kZXMgdGhhbiBiaXRzXHJcbiAgICAgICAgdGhpcy5tID0gbW07XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICBpZigoeSAtPSBjW2ldKSA8IDApIHtcclxuICAgICAgdGhpcy5zdGF0dXMgPSAyO1xyXG4gICAgICB0aGlzLm0gPSBtbTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY1tpXSArPSB5O1xyXG5cclxuICAgIC8vIEdlbmVyYXRlIHN0YXJ0aW5nIG9mZnNldHMgaW50byB0aGUgdmFsdWUgdGFibGUgZm9yIGVhY2ggbGVuZ3RoXHJcbiAgICB4WzFdID0gaiA9IDA7XHJcbiAgICBwID0gYztcclxuICAgIHBpZHggPSAxO1xyXG4gICAgeHAgPSAyO1xyXG4gICAgd2hpbGUoLS1pID4gMCkgICAgICAgIC8vIG5vdGUgdGhhdCBpID09IGcgZnJvbSBhYm92ZVxyXG4gICAgICB4W3hwKytdID0gKGogKz0gcFtwaWR4KytdKTtcclxuXHJcbiAgICAvLyBNYWtlIGEgdGFibGUgb2YgdmFsdWVzIGluIG9yZGVyIG9mIGJpdCBsZW5ndGhzXHJcbiAgICBwID0gYjsgcGlkeCA9IDA7XHJcbiAgICBpID0gMDtcclxuICAgIGRvIHtcclxuICAgICAgaWYoKGogPSBwW3BpZHgrK10pICE9IDApXHJcbiAgICAgICAgdlt4W2pdKytdID0gaTtcclxuICAgIH0gd2hpbGUoKytpIDwgbik7XHJcbiAgICBuID0geFtnXTsgICAgICAgICAgICAvLyBzZXQgbiB0byBsZW5ndGggb2YgdlxyXG5cclxuICAgIC8vIEdlbmVyYXRlIHRoZSBIdWZmbWFuIGNvZGVzIGFuZCBmb3IgZWFjaCwgbWFrZSB0aGUgdGFibGUgZW50cmllc1xyXG4gICAgeFswXSA9IGkgPSAwOyAgICAgICAgLy8gZmlyc3QgSHVmZm1hbiBjb2RlIGlzIHplcm9cclxuICAgIHAgPSB2OyBwaWR4ID0gMDsgICAgICAgIC8vIGdyYWIgdmFsdWVzIGluIGJpdCBvcmRlclxyXG4gICAgaCA9IC0xOyAgICAgICAgICAgIC8vIG5vIHRhYmxlcyB5ZXQtLWxldmVsIC0xXHJcbiAgICB3ID0gbHhbMF0gPSAwOyAgICAgICAgLy8gbm8gYml0cyBkZWNvZGVkIHlldFxyXG4gICAgcSA9IG51bGw7ICAgICAgICAgICAgLy8gZGl0dG9cclxuICAgIHogPSAwOyAgICAgICAgICAgIC8vIGRpdHRvXHJcblxyXG4gICAgLy8gZ28gdGhyb3VnaCB0aGUgYml0IGxlbmd0aHMgKGsgYWxyZWFkeSBpcyBiaXRzIGluIHNob3J0ZXN0IGNvZGUpXHJcbiAgICBmb3IoOyBrIDw9IGc7IGsrKykge1xyXG4gICAgICBhID0gY1trXTtcclxuICAgICAgd2hpbGUoYS0tID4gMCkge1xyXG4gICAgICAgIC8vIGhlcmUgaSBpcyB0aGUgSHVmZm1hbiBjb2RlIG9mIGxlbmd0aCBrIGJpdHMgZm9yIHZhbHVlIHBbcGlkeF1cclxuICAgICAgICAvLyBtYWtlIHRhYmxlcyB1cCB0byByZXF1aXJlZCBsZXZlbFxyXG4gICAgICAgIHdoaWxlKGsgPiB3ICsgbHhbMSArIGhdKSB7XHJcbiAgICAgICAgICB3ICs9IGx4WzEgKyBoXTsgLy8gYWRkIGJpdHMgYWxyZWFkeSBkZWNvZGVkXHJcbiAgICAgICAgICBoKys7XHJcblxyXG4gICAgICAgICAgLy8gY29tcHV0ZSBtaW5pbXVtIHNpemUgdGFibGUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvICptIGJpdHNcclxuICAgICAgICAgIHogPSAoeiA9IGcgLSB3KSA+IG1tID8gbW0gOiB6OyAvLyB1cHBlciBsaW1pdFxyXG4gICAgICAgICAgaWYoKGYgPSAxIDw8IChqID0gayAtIHcpKSA+IGEgKyAxKSB7IC8vIHRyeSBhIGstdyBiaXQgdGFibGVcclxuICAgICAgICAgICAgLy8gdG9vIGZldyBjb2RlcyBmb3Igay13IGJpdCB0YWJsZVxyXG4gICAgICAgICAgICBmIC09IGEgKyAxOyAgICAvLyBkZWR1Y3QgY29kZXMgZnJvbSBwYXR0ZXJucyBsZWZ0XHJcbiAgICAgICAgICAgIHhwID0gaztcclxuICAgICAgICAgICAgd2hpbGUoKytqIDwgeikgeyAvLyB0cnkgc21hbGxlciB0YWJsZXMgdXAgdG8geiBiaXRzXHJcbiAgICAgICAgICAgICAgaWYoKGYgPDw9IDEpIDw9IGNbKyt4cF0pXHJcbiAgICAgICAgICAgICAgICBicmVhazsgICAgLy8gZW5vdWdoIGNvZGVzIHRvIHVzZSB1cCBqIGJpdHNcclxuICAgICAgICAgICAgICBmIC09IGNbeHBdOyAgICAvLyBlbHNlIGRlZHVjdCBjb2RlcyBmcm9tIHBhdHRlcm5zXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmKHcgKyBqID4gZWwgJiYgdyA8IGVsKVxyXG4gICAgICAgICAgICBqID0gZWwgLSB3OyAgICAvLyBtYWtlIEVPQiBjb2RlIGVuZCBhdCB0YWJsZVxyXG4gICAgICAgICAgeiA9IDEgPDwgajsgICAgLy8gdGFibGUgZW50cmllcyBmb3Igai1iaXQgdGFibGVcclxuICAgICAgICAgIGx4WzEgKyBoXSA9IGo7IC8vIHNldCB0YWJsZSBzaXplIGluIHN0YWNrXHJcblxyXG4gICAgICAgICAgLy8gYWxsb2NhdGUgYW5kIGxpbmsgaW4gbmV3IHRhYmxlXHJcbiAgICAgICAgICBxID0gbmV3IEFycmF5KHopO1xyXG4gICAgICAgICAgZm9yKG8gPSAwOyBvIDwgejsgbysrKSB7XHJcbiAgICAgICAgICAgIHFbb10gPSBuZXcgemlwX0h1ZnROb2RlKCk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaWYodGFpbCA9PSBudWxsKVxyXG4gICAgICAgICAgICB0YWlsID0gdGhpcy5yb290ID0gbmV3IHppcF9IdWZ0TGlzdCgpO1xyXG4gICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB0YWlsID0gdGFpbC5uZXh0ID0gbmV3IHppcF9IdWZ0TGlzdCgpO1xyXG4gICAgICAgICAgdGFpbC5uZXh0ID0gbnVsbDtcclxuICAgICAgICAgIHRhaWwubGlzdCA9IHE7XHJcbiAgICAgICAgICB1W2hdID0gcTsgICAgLy8gdGFibGUgc3RhcnRzIGFmdGVyIGxpbmtcclxuXHJcbiAgICAgICAgICAvKiBjb25uZWN0IHRvIGxhc3QgdGFibGUsIGlmIHRoZXJlIGlzIG9uZSAqL1xyXG4gICAgICAgICAgaWYoaCA+IDApIHtcclxuICAgICAgICAgICAgeFtoXSA9IGk7ICAgICAgICAvLyBzYXZlIHBhdHRlcm4gZm9yIGJhY2tpbmcgdXBcclxuICAgICAgICAgICAgci5iID0gbHhbaF07ICAgIC8vIGJpdHMgdG8gZHVtcCBiZWZvcmUgdGhpcyB0YWJsZVxyXG4gICAgICAgICAgICByLmUgPSAxNiArIGo7ICAgIC8vIGJpdHMgaW4gdGhpcyB0YWJsZVxyXG4gICAgICAgICAgICByLnQgPSBxOyAgICAgICAgLy8gcG9pbnRlciB0byB0aGlzIHRhYmxlXHJcbiAgICAgICAgICAgIGogPSAoaSAmICgoMSA8PCB3KSAtIDEpKSA+PiAodyAtIGx4W2hdKTtcclxuICAgICAgICAgICAgdVtoLTFdW2pdLmUgPSByLmU7XHJcbiAgICAgICAgICAgIHVbaC0xXVtqXS5iID0gci5iO1xyXG4gICAgICAgICAgICB1W2gtMV1bal0ubiA9IHIubjtcclxuICAgICAgICAgICAgdVtoLTFdW2pdLnQgPSByLnQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBzZXQgdXAgdGFibGUgZW50cnkgaW4gclxyXG4gICAgICAgIHIuYiA9IGsgLSB3O1xyXG4gICAgICAgIGlmKHBpZHggPj0gbilcclxuICAgICAgICAgIHIuZSA9IDk5OyAgICAgICAgLy8gb3V0IG9mIHZhbHVlcy0taW52YWxpZCBjb2RlXHJcbiAgICAgICAgZWxzZSBpZihwW3BpZHhdIDwgcykge1xyXG4gICAgICAgICAgci5lID0gKHBbcGlkeF0gPCAyNTYgPyAxNiA6IDE1KTsgLy8gMjU2IGlzIGVuZC1vZi1ibG9jayBjb2RlXHJcbiAgICAgICAgICByLm4gPSBwW3BpZHgrK107ICAgIC8vIHNpbXBsZSBjb2RlIGlzIGp1c3QgdGhlIHZhbHVlXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHIuZSA9IGVbcFtwaWR4XSAtIHNdOyAgICAvLyBub24tc2ltcGxlLS1sb29rIHVwIGluIGxpc3RzXHJcbiAgICAgICAgICByLm4gPSBkW3BbcGlkeCsrXSAtIHNdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZmlsbCBjb2RlLWxpa2UgZW50cmllcyB3aXRoIHIgLy9cclxuICAgICAgICBmID0gMSA8PCAoayAtIHcpO1xyXG4gICAgICAgIGZvcihqID0gaSA+PiB3OyBqIDwgejsgaiArPSBmKSB7XHJcbiAgICAgICAgICBxW2pdLmUgPSByLmU7XHJcbiAgICAgICAgICBxW2pdLmIgPSByLmI7XHJcbiAgICAgICAgICBxW2pdLm4gPSByLm47XHJcbiAgICAgICAgICBxW2pdLnQgPSByLnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBiYWNrd2FyZHMgaW5jcmVtZW50IHRoZSBrLWJpdCBjb2RlIGlcclxuICAgICAgICBmb3IoaiA9IDEgPDwgKGsgLSAxKTsgKGkgJiBqKSAhPSAwOyBqID4+PSAxKVxyXG4gICAgICAgICAgaSBePSBqO1xyXG4gICAgICAgIGkgXj0gajtcclxuXHJcbiAgICAgICAgLy8gYmFja3VwIG92ZXIgZmluaXNoZWQgdGFibGVzXHJcbiAgICAgICAgd2hpbGUoKGkgJiAoKDEgPDwgdykgLSAxKSkgIT0geFtoXSkge1xyXG4gICAgICAgICAgdyAtPSBseFtoXTsgICAgICAgIC8vIGRvbid0IG5lZWQgdG8gdXBkYXRlIHFcclxuICAgICAgICAgIGgtLTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKiByZXR1cm4gYWN0dWFsIHNpemUgb2YgYmFzZSB0YWJsZSAqL1xyXG4gICAgdGhpcy5tID0gbHhbMV07XHJcblxyXG4gICAgLyogUmV0dXJuIHRydWUgKDEpIGlmIHdlIHdlcmUgZ2l2ZW4gYW4gaW5jb21wbGV0ZSB0YWJsZSAqL1xyXG4gICAgdGhpcy5zdGF0dXMgPSAoKHkgIT0gMCAmJiBnICE9IDEpID8gMSA6IDApO1xyXG4gIH0gLyogZW5kIG9mIGNvbnN0cnVjdG9yICovXHJcbn07XHJcblxyXG5cclxuLyogcm91dGluZXMgKGluZmxhdGUpICovXHJcblxyXG52YXIgemlwX0dFVF9CWVRFID0gZnVuY3Rpb24oKSB7XHJcbiAgaWYoemlwX2luZmxhdGVfZGF0YS5sZW5ndGggPD0gemlwX2luZmxhdGVfcG9zKVxyXG4gICAgcmV0dXJuIC0xO1xyXG4gIHJldHVybiB6aXBfaW5mbGF0ZV9kYXRhLmNoYXJDb2RlQXQoemlwX2luZmxhdGVfcG9zKyspICYgMHhmZjtcclxufTtcclxuXHJcbnZhciB6aXBfTkVFREJJVFMgPSBmdW5jdGlvbihuKSB7XHJcbiAgd2hpbGUoemlwX2JpdF9sZW4gPCBuKSB7XHJcbiAgICB6aXBfYml0X2J1ZiB8PSB6aXBfR0VUX0JZVEUoKSA8PCB6aXBfYml0X2xlbjtcclxuICAgIHppcF9iaXRfbGVuICs9IDg7XHJcbiAgfVxyXG59O1xyXG5cclxudmFyIHppcF9HRVRCSVRTID0gZnVuY3Rpb24obikge1xyXG4gIHJldHVybiB6aXBfYml0X2J1ZiAmIHppcF9NQVNLX0JJVFNbbl07XHJcbn07XHJcblxyXG52YXIgemlwX0RVTVBCSVRTID0gZnVuY3Rpb24obikge1xyXG4gIHppcF9iaXRfYnVmID4+PSBuO1xyXG4gIHppcF9iaXRfbGVuIC09IG47XHJcbn07XHJcblxyXG52YXIgemlwX2luZmxhdGVfY29kZXMgPSBmdW5jdGlvbihidWZmLCBvZmYsIHNpemUpIHtcclxuICAvKiBpbmZsYXRlIChkZWNvbXByZXNzKSB0aGUgY29kZXMgaW4gYSBkZWZsYXRlZCAoY29tcHJlc3NlZCkgYmxvY2suXHJcbiAgICAgUmV0dXJuIGFuIGVycm9yIGNvZGUgb3IgemVybyBpZiBpdCBhbGwgZ29lcyBvay4gKi9cclxuICB2YXIgZTsgICAgICAgIC8vIHRhYmxlIGVudHJ5IGZsYWcvbnVtYmVyIG9mIGV4dHJhIGJpdHNcclxuICB2YXIgdDsgICAgICAgIC8vICh6aXBfSHVmdE5vZGUpIHBvaW50ZXIgdG8gdGFibGUgZW50cnlcclxuICB2YXIgbjtcclxuXHJcbiAgaWYoc2l6ZSA9PSAwKVxyXG4gICAgcmV0dXJuIDA7XHJcblxyXG4gIC8vIGluZmxhdGUgdGhlIGNvZGVkIGRhdGFcclxuICBuID0gMDtcclxuICBmb3IoOzspIHsgICAgICAgICAgICAvLyBkbyB1bnRpbCBlbmQgb2YgYmxvY2tcclxuICAgIHppcF9ORUVEQklUUyh6aXBfYmwpO1xyXG4gICAgdCA9IHppcF90bC5saXN0W3ppcF9HRVRCSVRTKHppcF9ibCldO1xyXG4gICAgZSA9IHQuZTtcclxuICAgIHdoaWxlKGUgPiAxNikge1xyXG4gICAgICBpZihlID09IDk5KVxyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgICAgemlwX0RVTVBCSVRTKHQuYik7XHJcbiAgICAgIGUgLT0gMTY7XHJcbiAgICAgIHppcF9ORUVEQklUUyhlKTtcclxuICAgICAgdCA9IHQudFt6aXBfR0VUQklUUyhlKV07XHJcbiAgICAgIGUgPSB0LmU7XHJcbiAgICB9XHJcbiAgICB6aXBfRFVNUEJJVFModC5iKTtcclxuXHJcbiAgICBpZihlID09IDE2KSB7ICAgICAgICAvLyB0aGVuIGl0J3MgYSBsaXRlcmFsXHJcbiAgICAgIHppcF93cCAmPSB6aXBfV1NJWkUgLSAxO1xyXG4gICAgICBidWZmW29mZiArIG4rK10gPSB6aXBfc2xpZGVbemlwX3dwKytdID0gdC5uO1xyXG4gICAgICBpZihuID09IHNpemUpXHJcbiAgICAgICAgcmV0dXJuIHNpemU7XHJcbiAgICAgIGNvbnRpbnVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGV4aXQgaWYgZW5kIG9mIGJsb2NrXHJcbiAgICBpZihlID09IDE1KVxyXG4gICAgICBicmVhaztcclxuXHJcbiAgICAvLyBpdCdzIGFuIEVPQiBvciBhIGxlbmd0aFxyXG5cclxuICAgIC8vIGdldCBsZW5ndGggb2YgYmxvY2sgdG8gY29weVxyXG4gICAgemlwX05FRURCSVRTKGUpO1xyXG4gICAgemlwX2NvcHlfbGVuZyA9IHQubiArIHppcF9HRVRCSVRTKGUpO1xyXG4gICAgemlwX0RVTVBCSVRTKGUpO1xyXG5cclxuICAgIC8vIGRlY29kZSBkaXN0YW5jZSBvZiBibG9jayB0byBjb3B5XHJcbiAgICB6aXBfTkVFREJJVFMoemlwX2JkKTtcclxuICAgIHQgPSB6aXBfdGQubGlzdFt6aXBfR0VUQklUUyh6aXBfYmQpXTtcclxuICAgIGUgPSB0LmU7XHJcblxyXG4gICAgd2hpbGUoZSA+IDE2KSB7XHJcbiAgICAgIGlmKGUgPT0gOTkpXHJcbiAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICB6aXBfRFVNUEJJVFModC5iKTtcclxuICAgICAgZSAtPSAxNjtcclxuICAgICAgemlwX05FRURCSVRTKGUpO1xyXG4gICAgICB0ID0gdC50W3ppcF9HRVRCSVRTKGUpXTtcclxuICAgICAgZSA9IHQuZTtcclxuICAgIH1cclxuICAgIHppcF9EVU1QQklUUyh0LmIpO1xyXG4gICAgemlwX05FRURCSVRTKGUpO1xyXG4gICAgemlwX2NvcHlfZGlzdCA9IHppcF93cCAtIHQubiAtIHppcF9HRVRCSVRTKGUpO1xyXG4gICAgemlwX0RVTVBCSVRTKGUpO1xyXG5cclxuICAgIC8vIGRvIHRoZSBjb3B5XHJcbiAgICB3aGlsZSh6aXBfY29weV9sZW5nID4gMCAmJiBuIDwgc2l6ZSkge1xyXG4gICAgICB6aXBfY29weV9sZW5nLS07XHJcbiAgICAgIHppcF9jb3B5X2Rpc3QgJj0gemlwX1dTSVpFIC0gMTtcclxuICAgICAgemlwX3dwICY9IHppcF9XU0laRSAtIDE7XHJcbiAgICAgIGJ1ZmZbb2ZmICsgbisrXSA9IHppcF9zbGlkZVt6aXBfd3ArK11cclxuICAgICAgICA9IHppcF9zbGlkZVt6aXBfY29weV9kaXN0KytdO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKG4gPT0gc2l6ZSlcclxuICAgICAgcmV0dXJuIHNpemU7XHJcbiAgfVxyXG5cclxuICB6aXBfbWV0aG9kID0gLTE7IC8vIGRvbmVcclxuICByZXR1cm4gbjtcclxufTtcclxuXHJcbnZhciB6aXBfaW5mbGF0ZV9zdG9yZWQgPSBmdW5jdGlvbihidWZmLCBvZmYsIHNpemUpIHtcclxuICAvKiBcImRlY29tcHJlc3NcIiBhbiBpbmZsYXRlZCB0eXBlIDAgKHN0b3JlZCkgYmxvY2suICovXHJcbiAgdmFyIG47XHJcblxyXG4gIC8vIGdvIHRvIGJ5dGUgYm91bmRhcnlcclxuICBuID0gemlwX2JpdF9sZW4gJiA3O1xyXG4gIHppcF9EVU1QQklUUyhuKTtcclxuXHJcbiAgLy8gZ2V0IHRoZSBsZW5ndGggYW5kIGl0cyBjb21wbGVtZW50XHJcbiAgemlwX05FRURCSVRTKDE2KTtcclxuICBuID0gemlwX0dFVEJJVFMoMTYpO1xyXG4gIHppcF9EVU1QQklUUygxNik7XHJcbiAgemlwX05FRURCSVRTKDE2KTtcclxuICBpZihuICE9ICgofnppcF9iaXRfYnVmKSAmIDB4ZmZmZikpXHJcbiAgICByZXR1cm4gLTE7ICAgICAgICAgICAgLy8gZXJyb3IgaW4gY29tcHJlc3NlZCBkYXRhXHJcbiAgemlwX0RVTVBCSVRTKDE2KTtcclxuXHJcbiAgLy8gcmVhZCBhbmQgb3V0cHV0IHRoZSBjb21wcmVzc2VkIGRhdGFcclxuICB6aXBfY29weV9sZW5nID0gbjtcclxuXHJcbiAgbiA9IDA7XHJcbiAgd2hpbGUoemlwX2NvcHlfbGVuZyA+IDAgJiYgbiA8IHNpemUpIHtcclxuICAgIHppcF9jb3B5X2xlbmctLTtcclxuICAgIHppcF93cCAmPSB6aXBfV1NJWkUgLSAxO1xyXG4gICAgemlwX05FRURCSVRTKDgpO1xyXG4gICAgYnVmZltvZmYgKyBuKytdID0gemlwX3NsaWRlW3ppcF93cCsrXSA9XHJcbiAgICAgIHppcF9HRVRCSVRTKDgpO1xyXG4gICAgemlwX0RVTVBCSVRTKDgpO1xyXG4gIH1cclxuXHJcbiAgaWYoemlwX2NvcHlfbGVuZyA9PSAwKVxyXG4gICAgemlwX21ldGhvZCA9IC0xOyAvLyBkb25lXHJcbiAgcmV0dXJuIG47XHJcbn07XHJcblxyXG52YXIgemlwX2luZmxhdGVfZml4ZWQgPSBmdW5jdGlvbihidWZmLCBvZmYsIHNpemUpIHtcclxuICAvKiBkZWNvbXByZXNzIGFuIGluZmxhdGVkIHR5cGUgMSAoZml4ZWQgSHVmZm1hbiBjb2RlcykgYmxvY2suICBXZSBzaG91bGRcclxuICAgICBlaXRoZXIgcmVwbGFjZSB0aGlzIHdpdGggYSBjdXN0b20gZGVjb2Rlciwgb3IgYXQgbGVhc3QgcHJlY29tcHV0ZSB0aGVcclxuICAgICBIdWZmbWFuIHRhYmxlcy4gKi9cclxuXHJcbiAgLy8gaWYgZmlyc3QgdGltZSwgc2V0IHVwIHRhYmxlcyBmb3IgZml4ZWQgYmxvY2tzXHJcbiAgaWYoemlwX2ZpeGVkX3RsID09IG51bGwpIHtcclxuICAgIHZhciBpOyAgICAgICAgICAgIC8vIHRlbXBvcmFyeSB2YXJpYWJsZVxyXG4gICAgdmFyIGwgPSBuZXcgQXJyYXkoMjg4KTsgICAgLy8gbGVuZ3RoIGxpc3QgZm9yIGh1ZnRfYnVpbGRcclxuICAgIHZhciBoOyAgICAvLyB6aXBfSHVmdEJ1aWxkXHJcblxyXG4gICAgLy8gbGl0ZXJhbCB0YWJsZVxyXG4gICAgZm9yKGkgPSAwOyBpIDwgMTQ0OyBpKyspXHJcbiAgICAgIGxbaV0gPSA4O1xyXG4gICAgZm9yKDsgaSA8IDI1NjsgaSsrKVxyXG4gICAgICBsW2ldID0gOTtcclxuICAgIGZvcig7IGkgPCAyODA7IGkrKylcclxuICAgICAgbFtpXSA9IDc7XHJcbiAgICBmb3IoOyBpIDwgMjg4OyBpKyspICAgIC8vIG1ha2UgYSBjb21wbGV0ZSwgYnV0IHdyb25nIGNvZGUgc2V0XHJcbiAgICAgIGxbaV0gPSA4O1xyXG4gICAgemlwX2ZpeGVkX2JsID0gNztcclxuXHJcbiAgICBoID0gbmV3IHppcF9IdWZ0QnVpbGQobCwgMjg4LCAyNTcsIHppcF9jcGxlbnMsIHppcF9jcGxleHQsXHJcbiAgICAgICAgICAgICAgICB6aXBfZml4ZWRfYmwpO1xyXG4gICAgaWYoaC5zdGF0dXMgIT0gMCkge1xyXG4gICAgICBhbGVydChcIkh1ZkJ1aWxkIGVycm9yOiBcIitoLnN0YXR1cyk7XHJcbiAgICAgIHJldHVybiAtMTtcclxuICAgIH1cclxuICAgIHppcF9maXhlZF90bCA9IGgucm9vdDtcclxuICAgIHppcF9maXhlZF9ibCA9IGgubTtcclxuXHJcbiAgICAvLyBkaXN0YW5jZSB0YWJsZVxyXG4gICAgZm9yKGkgPSAwOyBpIDwgMzA7IGkrKykgICAgLy8gbWFrZSBhbiBpbmNvbXBsZXRlIGNvZGUgc2V0XHJcbiAgICAgIGxbaV0gPSA1O1xyXG4gICAgemlwX2ZpeGVkX2JkID0gNTtcclxuXHJcbiAgICBoID0gbmV3IHppcF9IdWZ0QnVpbGQobCwgMzAsIDAsIHppcF9jcGRpc3QsIHppcF9jcGRleHQsIHppcF9maXhlZF9iZCk7XHJcbiAgICBpZihoLnN0YXR1cyA+IDEpIHtcclxuICAgICAgemlwX2ZpeGVkX3RsID0gbnVsbDtcclxuICAgICAgdGhyb3coXCJIdWZCdWlsZCBlcnJvcjogXCIraC5zdGF0dXMpO1xyXG4gICAgICByZXR1cm4gLTE7XHJcbiAgICB9XHJcbiAgICB6aXBfZml4ZWRfdGQgPSBoLnJvb3Q7XHJcbiAgICB6aXBfZml4ZWRfYmQgPSBoLm07XHJcbiAgfVxyXG5cclxuICB6aXBfdGwgPSB6aXBfZml4ZWRfdGw7XHJcbiAgemlwX3RkID0gemlwX2ZpeGVkX3RkO1xyXG4gIHppcF9ibCA9IHppcF9maXhlZF9ibDtcclxuICB6aXBfYmQgPSB6aXBfZml4ZWRfYmQ7XHJcbiAgcmV0dXJuIHppcF9pbmZsYXRlX2NvZGVzKGJ1ZmYsIG9mZiwgc2l6ZSk7XHJcbn07XHJcblxyXG52YXIgemlwX2luZmxhdGVfZHluYW1pYyA9IGZ1bmN0aW9uKGJ1ZmYsIG9mZiwgc2l6ZSkge1xyXG4gIC8vIGRlY29tcHJlc3MgYW4gaW5mbGF0ZWQgdHlwZSAyIChkeW5hbWljIEh1ZmZtYW4gY29kZXMpIGJsb2NrLlxyXG4gIHZhciBpOyAgICAgICAgLy8gdGVtcG9yYXJ5IHZhcmlhYmxlc1xyXG4gIHZhciBqO1xyXG4gIHZhciBsOyAgICAgICAgLy8gbGFzdCBsZW5ndGhcclxuICB2YXIgbjsgICAgICAgIC8vIG51bWJlciBvZiBsZW5ndGhzIHRvIGdldFxyXG4gIHZhciB0OyAgICAgICAgLy8gKHppcF9IdWZ0Tm9kZSkgbGl0ZXJhbC9sZW5ndGggY29kZSB0YWJsZVxyXG4gIHZhciBuYjsgICAgICAgIC8vIG51bWJlciBvZiBiaXQgbGVuZ3RoIGNvZGVzXHJcbiAgdmFyIG5sOyAgICAgICAgLy8gbnVtYmVyIG9mIGxpdGVyYWwvbGVuZ3RoIGNvZGVzXHJcbiAgdmFyIG5kOyAgICAgICAgLy8gbnVtYmVyIG9mIGRpc3RhbmNlIGNvZGVzXHJcbiAgdmFyIGxsID0gbmV3IEFycmF5KDI4NiszMCk7IC8vIGxpdGVyYWwvbGVuZ3RoIGFuZCBkaXN0YW5jZSBjb2RlIGxlbmd0aHNcclxuICB2YXIgaDsgICAgICAgIC8vICh6aXBfSHVmdEJ1aWxkKVxyXG5cclxuICBmb3IoaSA9IDA7IGkgPCBsbC5sZW5ndGg7IGkrKylcclxuICAgIGxsW2ldID0gMDtcclxuXHJcbiAgLy8gcmVhZCBpbiB0YWJsZSBsZW5ndGhzXHJcbiAgemlwX05FRURCSVRTKDUpO1xyXG4gIG5sID0gMjU3ICsgemlwX0dFVEJJVFMoNSk7ICAgIC8vIG51bWJlciBvZiBsaXRlcmFsL2xlbmd0aCBjb2Rlc1xyXG4gIHppcF9EVU1QQklUUyg1KTtcclxuICB6aXBfTkVFREJJVFMoNSk7XHJcbiAgbmQgPSAxICsgemlwX0dFVEJJVFMoNSk7ICAgIC8vIG51bWJlciBvZiBkaXN0YW5jZSBjb2Rlc1xyXG4gIHppcF9EVU1QQklUUyg1KTtcclxuICB6aXBfTkVFREJJVFMoNCk7XHJcbiAgbmIgPSA0ICsgemlwX0dFVEJJVFMoNCk7ICAgIC8vIG51bWJlciBvZiBiaXQgbGVuZ3RoIGNvZGVzXHJcbiAgemlwX0RVTVBCSVRTKDQpO1xyXG4gIGlmKG5sID4gMjg2IHx8IG5kID4gMzApXHJcbiAgICByZXR1cm4gLTE7ICAgICAgICAvLyBiYWQgbGVuZ3Roc1xyXG5cclxuICAvLyByZWFkIGluIGJpdC1sZW5ndGgtY29kZSBsZW5ndGhzXHJcbiAgZm9yKGogPSAwOyBqIDwgbmI7IGorKylcclxuICB7XHJcbiAgICB6aXBfTkVFREJJVFMoMyk7XHJcbiAgICBsbFt6aXBfYm9yZGVyW2pdXSA9IHppcF9HRVRCSVRTKDMpO1xyXG4gICAgemlwX0RVTVBCSVRTKDMpO1xyXG4gIH1cclxuICBmb3IoOyBqIDwgMTk7IGorKylcclxuICAgIGxsW3ppcF9ib3JkZXJbal1dID0gMDtcclxuXHJcbiAgLy8gYnVpbGQgZGVjb2RpbmcgdGFibGUgZm9yIHRyZWVzLS1zaW5nbGUgbGV2ZWwsIDcgYml0IGxvb2t1cFxyXG4gIHppcF9ibCA9IDc7XHJcbiAgaCA9IG5ldyB6aXBfSHVmdEJ1aWxkKGxsLCAxOSwgMTksIG51bGwsIG51bGwsIHppcF9ibCk7XHJcbiAgaWYoaC5zdGF0dXMgIT0gMClcclxuICAgIHJldHVybiAtMTsgICAgLy8gaW5jb21wbGV0ZSBjb2RlIHNldFxyXG5cclxuICB6aXBfdGwgPSBoLnJvb3Q7XHJcbiAgemlwX2JsID0gaC5tO1xyXG5cclxuICAvLyByZWFkIGluIGxpdGVyYWwgYW5kIGRpc3RhbmNlIGNvZGUgbGVuZ3Roc1xyXG4gIG4gPSBubCArIG5kO1xyXG4gIGkgPSBsID0gMDtcclxuICB3aGlsZShpIDwgbikge1xyXG4gICAgemlwX05FRURCSVRTKHppcF9ibCk7XHJcbiAgICB0ID0gemlwX3RsLmxpc3RbemlwX0dFVEJJVFMoemlwX2JsKV07XHJcbiAgICBqID0gdC5iO1xyXG4gICAgemlwX0RVTVBCSVRTKGopO1xyXG4gICAgaiA9IHQubjtcclxuICAgIGlmKGogPCAxNikgICAgICAgIC8vIGxlbmd0aCBvZiBjb2RlIGluIGJpdHMgKDAuLjE1KVxyXG4gICAgICBsbFtpKytdID0gbCA9IGo7ICAgIC8vIHNhdmUgbGFzdCBsZW5ndGggaW4gbFxyXG4gICAgZWxzZSBpZihqID09IDE2KSB7ICAgIC8vIHJlcGVhdCBsYXN0IGxlbmd0aCAzIHRvIDYgdGltZXNcclxuICAgICAgemlwX05FRURCSVRTKDIpO1xyXG4gICAgICBqID0gMyArIHppcF9HRVRCSVRTKDIpO1xyXG4gICAgICB6aXBfRFVNUEJJVFMoMik7XHJcbiAgICAgIGlmKGkgKyBqID4gbilcclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgIHdoaWxlKGotLSA+IDApXHJcbiAgICAgICAgbGxbaSsrXSA9IGw7XHJcbiAgICB9IGVsc2UgaWYoaiA9PSAxNykgeyAgICAvLyAzIHRvIDEwIHplcm8gbGVuZ3RoIGNvZGVzXHJcbiAgICAgIHppcF9ORUVEQklUUygzKTtcclxuICAgICAgaiA9IDMgKyB6aXBfR0VUQklUUygzKTtcclxuICAgICAgemlwX0RVTVBCSVRTKDMpO1xyXG4gICAgICBpZihpICsgaiA+IG4pXHJcbiAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICB3aGlsZShqLS0gPiAwKVxyXG4gICAgICAgIGxsW2krK10gPSAwO1xyXG4gICAgICBsID0gMDtcclxuICAgIH0gZWxzZSB7ICAgICAgICAvLyBqID09IDE4OiAxMSB0byAxMzggemVybyBsZW5ndGggY29kZXNcclxuICAgICAgemlwX05FRURCSVRTKDcpO1xyXG4gICAgICBqID0gMTEgKyB6aXBfR0VUQklUUyg3KTtcclxuICAgICAgemlwX0RVTVBCSVRTKDcpO1xyXG4gICAgICBpZihpICsgaiA+IG4pXHJcbiAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICB3aGlsZShqLS0gPiAwKVxyXG4gICAgICAgIGxsW2krK10gPSAwO1xyXG4gICAgICBsID0gMDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIGJ1aWxkIHRoZSBkZWNvZGluZyB0YWJsZXMgZm9yIGxpdGVyYWwvbGVuZ3RoIGFuZCBkaXN0YW5jZSBjb2Rlc1xyXG4gIHppcF9ibCA9IHppcF9sYml0cztcclxuICBoID0gbmV3IHppcF9IdWZ0QnVpbGQobGwsIG5sLCAyNTcsIHppcF9jcGxlbnMsIHppcF9jcGxleHQsIHppcF9ibCk7XHJcbiAgaWYoemlwX2JsID09IDApICAgIC8vIG5vIGxpdGVyYWxzIG9yIGxlbmd0aHNcclxuICAgIGguc3RhdHVzID0gMTtcclxuICBpZihoLnN0YXR1cyAhPSAwKSB7XHJcbiAgICBpZihoLnN0YXR1cyA9PSAxKVxyXG4gICAgICA7Ly8gKippbmNvbXBsZXRlIGxpdGVyYWwgdHJlZSoqXHJcbiAgICByZXR1cm4gLTE7ICAgICAgICAvLyBpbmNvbXBsZXRlIGNvZGUgc2V0XHJcbiAgfVxyXG4gIHppcF90bCA9IGgucm9vdDtcclxuICB6aXBfYmwgPSBoLm07XHJcblxyXG4gIGZvcihpID0gMDsgaSA8IG5kOyBpKyspXHJcbiAgICBsbFtpXSA9IGxsW2kgKyBubF07XHJcbiAgemlwX2JkID0gemlwX2RiaXRzO1xyXG4gIGggPSBuZXcgemlwX0h1ZnRCdWlsZChsbCwgbmQsIDAsIHppcF9jcGRpc3QsIHppcF9jcGRleHQsIHppcF9iZCk7XHJcbiAgemlwX3RkID0gaC5yb290O1xyXG4gIHppcF9iZCA9IGgubTtcclxuXHJcbiAgaWYoemlwX2JkID09IDAgJiYgbmwgPiAyNTcpIHsgICAvLyBsZW5ndGhzIGJ1dCBubyBkaXN0YW5jZXNcclxuICAgIC8vICoqaW5jb21wbGV0ZSBkaXN0YW5jZSB0cmVlKipcclxuICAgIHJldHVybiAtMTtcclxuICB9XHJcblxyXG4gIGlmKGguc3RhdHVzID09IDEpIHtcclxuICAgIDsvLyAqKmluY29tcGxldGUgZGlzdGFuY2UgdHJlZSoqXHJcbiAgfVxyXG4gIGlmKGguc3RhdHVzICE9IDApXHJcbiAgICByZXR1cm4gLTE7XHJcblxyXG4gIC8vIGRlY29tcHJlc3MgdW50aWwgYW4gZW5kLW9mLWJsb2NrIGNvZGVcclxuICByZXR1cm4gemlwX2luZmxhdGVfY29kZXMoYnVmZiwgb2ZmLCBzaXplKTtcclxufTtcclxuXHJcbnZhciB6aXBfaW5mbGF0ZV9zdGFydCA9IGZ1bmN0aW9uKCkge1xyXG4gIHZhciBpO1xyXG5cclxuICBpZih6aXBfc2xpZGUgPT0gbnVsbClcclxuICAgIHppcF9zbGlkZSA9IG5ldyBBcnJheSgyICogemlwX1dTSVpFKTtcclxuICB6aXBfd3AgPSAwO1xyXG4gIHppcF9iaXRfYnVmID0gMDtcclxuICB6aXBfYml0X2xlbiA9IDA7XHJcbiAgemlwX21ldGhvZCA9IC0xO1xyXG4gIHppcF9lb2YgPSBmYWxzZTtcclxuICB6aXBfY29weV9sZW5nID0gemlwX2NvcHlfZGlzdCA9IDA7XHJcbiAgemlwX3RsID0gbnVsbDtcclxufTtcclxuXHJcbnZhciB6aXBfaW5mbGF0ZV9pbnRlcm5hbCA9IGZ1bmN0aW9uKGJ1ZmYsIG9mZiwgc2l6ZSkge1xyXG4gIC8vIGRlY29tcHJlc3MgYW4gaW5mbGF0ZWQgZW50cnlcclxuICB2YXIgbiwgaTtcclxuXHJcbiAgbiA9IDA7XHJcbiAgd2hpbGUobiA8IHNpemUpIHtcclxuICAgIGlmKHppcF9lb2YgJiYgemlwX21ldGhvZCA9PSAtMSlcclxuICAgICAgcmV0dXJuIG47XHJcblxyXG4gICAgaWYoemlwX2NvcHlfbGVuZyA+IDApIHtcclxuICAgICAgaWYoemlwX21ldGhvZCAhPSB6aXBfU1RPUkVEX0JMT0NLKSB7XHJcbiAgICAgICAgLy8gU1RBVElDX1RSRUVTIG9yIERZTl9UUkVFU1xyXG4gICAgICAgIHdoaWxlKHppcF9jb3B5X2xlbmcgPiAwICYmIG4gPCBzaXplKSB7XHJcbiAgICAgICAgICB6aXBfY29weV9sZW5nLS07XHJcbiAgICAgICAgICB6aXBfY29weV9kaXN0ICY9IHppcF9XU0laRSAtIDE7XHJcbiAgICAgICAgICB6aXBfd3AgJj0gemlwX1dTSVpFIC0gMTtcclxuICAgICAgICAgIGJ1ZmZbb2ZmICsgbisrXSA9IHppcF9zbGlkZVt6aXBfd3ArK10gPVxyXG4gICAgICAgICAgICB6aXBfc2xpZGVbemlwX2NvcHlfZGlzdCsrXTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgd2hpbGUoemlwX2NvcHlfbGVuZyA+IDAgJiYgbiA8IHNpemUpIHtcclxuICAgICAgICAgIHppcF9jb3B5X2xlbmctLTtcclxuICAgICAgICAgIHppcF93cCAmPSB6aXBfV1NJWkUgLSAxO1xyXG4gICAgICAgICAgemlwX05FRURCSVRTKDgpO1xyXG4gICAgICAgICAgYnVmZltvZmYgKyBuKytdID0gemlwX3NsaWRlW3ppcF93cCsrXSA9IHppcF9HRVRCSVRTKDgpO1xyXG4gICAgICAgICAgemlwX0RVTVBCSVRTKDgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih6aXBfY29weV9sZW5nID09IDApXHJcbiAgICAgICAgICB6aXBfbWV0aG9kID0gLTE7IC8vIGRvbmVcclxuICAgICAgfVxyXG4gICAgICBpZihuID09IHNpemUpXHJcbiAgICAgICAgcmV0dXJuIG47XHJcbiAgICB9XHJcblxyXG4gICAgaWYoemlwX21ldGhvZCA9PSAtMSkge1xyXG4gICAgICBpZih6aXBfZW9mKVxyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgLy8gcmVhZCBpbiBsYXN0IGJsb2NrIGJpdFxyXG4gICAgICB6aXBfTkVFREJJVFMoMSk7XHJcbiAgICAgIGlmKHppcF9HRVRCSVRTKDEpICE9IDApXHJcbiAgICAgICAgemlwX2VvZiA9IHRydWU7XHJcbiAgICAgIHppcF9EVU1QQklUUygxKTtcclxuXHJcbiAgICAgIC8vIHJlYWQgaW4gYmxvY2sgdHlwZVxyXG4gICAgICB6aXBfTkVFREJJVFMoMik7XHJcbiAgICAgIHppcF9tZXRob2QgPSB6aXBfR0VUQklUUygyKTtcclxuICAgICAgemlwX0RVTVBCSVRTKDIpO1xyXG4gICAgICB6aXBfdGwgPSBudWxsO1xyXG4gICAgICB6aXBfY29weV9sZW5nID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBzd2l0Y2goemlwX21ldGhvZCkge1xyXG4gICAgICBjYXNlIDA6IC8vIHppcF9TVE9SRURfQkxPQ0tcclxuICAgICAgaSA9IHppcF9pbmZsYXRlX3N0b3JlZChidWZmLCBvZmYgKyBuLCBzaXplIC0gbik7XHJcbiAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAxOiAvLyB6aXBfU1RBVElDX1RSRUVTXHJcbiAgICAgIGlmKHppcF90bCAhPSBudWxsKVxyXG4gICAgICAgIGkgPSB6aXBfaW5mbGF0ZV9jb2RlcyhidWZmLCBvZmYgKyBuLCBzaXplIC0gbik7XHJcbiAgICAgIGVsc2VcclxuICAgICAgICBpID0gemlwX2luZmxhdGVfZml4ZWQoYnVmZiwgb2ZmICsgbiwgc2l6ZSAtIG4pO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgMjogLy8gemlwX0RZTl9UUkVFU1xyXG4gICAgICBpZih6aXBfdGwgIT0gbnVsbClcclxuICAgICAgICBpID0gemlwX2luZmxhdGVfY29kZXMoYnVmZiwgb2ZmICsgbiwgc2l6ZSAtIG4pO1xyXG4gICAgICBlbHNlXHJcbiAgICAgICAgaSA9IHppcF9pbmZsYXRlX2R5bmFtaWMoYnVmZiwgb2ZmICsgbiwgc2l6ZSAtIG4pO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICAgIGRlZmF1bHQ6IC8vIGVycm9yXHJcbiAgICAgIGkgPSAtMTtcclxuICAgICAgYnJlYWs7XHJcbiAgICB9XHJcblxyXG4gICAgaWYoaSA9PSAtMSkge1xyXG4gICAgICBpZih6aXBfZW9mKVxyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgICByZXR1cm4gLTE7XHJcbiAgICB9XHJcbiAgICBuICs9IGk7XHJcbiAgfVxyXG4gIHJldHVybiBuO1xyXG59O1xyXG5cclxudmFyIGZpbmFsX2RhdGEgPSBmYWxzZTtcclxudmFyIHN0YXJ0X2luZmxhdGUgPSBmdW5jdGlvbihoKSB7XHJcbiAgZmluYWxfZGF0YSA9IGZhbHNlO1xyXG4gIHppcF9pbmZsYXRlX3N0YXJ0KCk7XHJcbiAgemlwX2luZmxhdGVfcG9zID0gaC5vZmZzZXQ7XHJcbiAgaC5jb21wdXRlZENSQzMyID0gMDtcclxufTtcclxudmFyIGNvbnRpbnVlX2luZmxhdGUgPSBmdW5jdGlvbihzdHIsIGgsIG9uc3RyZWFtKSB7XHJcbiAgdmFyIGksIGo7XHJcbiAgdmFyIEJVRlNaID0gNDA5NjtcclxuICB6aXBfaW5mbGF0ZV9kYXRhID0gc3RyO1xyXG4gIGlmICghZmluYWxfZGF0YSAmJiBzdHIubGVuZ3RoIDw9IHppcF9pbmZsYXRlX3BvcytCVUZTWis2NClcclxuICAgIHJldHVybiBoO1xyXG5cclxuICB2YXIgYnVmZiA9IG5ldyBBcnJheShCVUZTWik7XHJcbiAgd2hpbGUoKGkgPSB6aXBfaW5mbGF0ZV9pbnRlcm5hbChidWZmLCAwLCBidWZmLmxlbmd0aCkpID4gMCkge1xyXG4gICAgdmFyIGNidWYgPSBuZXcgQXJyYXkoaSk7XHJcbiAgICBmb3IoaiA9IDA7IGogPCBpOyBqKyspe1xyXG4gICAgICBjYnVmW2pdID0gU3RyaW5nLmZyb21DaGFyQ29kZShidWZmW2pdKTtcclxuICAgIH1cclxuICAgIHZhciBzID0gY2J1Zi5qb2luKFwiXCIpO1xyXG4gICAgaC5kYXRhLnB1c2gocyk7XHJcbiAgICBoLm91dHB1dFNpemUgKz0gcy5sZW5ndGg7XHJcbiAgICBoLm9mZnNldCA9IHppcF9pbmZsYXRlX3BvcztcclxuICAgIGguY29tcHV0ZWRDUkMzMiA9IEJpbi5DUkMzMihzLCAwLCBzLmxlbmd0aCwgaC5jb21wdXRlZENSQzMyKTtcclxuICAgIGlmICghZmluYWxfZGF0YSAmJiBzdHIubGVuZ3RoIDw9IHppcF9pbmZsYXRlX3BvcytCVUZTWis2NClcclxuICAgICAgYnJlYWs7XHJcbiAgfVxyXG4gIHppcF9pbmZsYXRlX2RhdGEgPSBudWxsOyAvLyBHLkMuXHJcbiAgaWYgKG9uc3RyZWFtKSBvbnN0cmVhbShoKTtcclxuICByZXR1cm4gaDtcclxufTtcclxudmFyIGZpbmFsX2luZmxhdGUgPSBmdW5jdGlvbihzdHIsIGgsIG9uc3RyZWFtKSB7XHJcbiAgZmluYWxfZGF0YSA9IHRydWU7XHJcbiAgY29udGludWVfaW5mbGF0ZShzdHIsIGgsIG9uc3RyZWFtKTtcclxufTtcclxuXHJcbnRoaXMuaW5mbGF0ZSA9IGZ1bmN0aW9uKHN0cixoLG9uc3RyZWFtKSB7XHJcbiAgc3RhcnRfaW5mbGF0ZShoKTtcclxuICByZXR1cm4gZmluYWxfaW5mbGF0ZShzdHIsaCxvbnN0cmVhbSk7XHJcbn07XHJcbnRoaXMuc3RhcnRfaW5mbGF0ZSA9IHN0YXJ0X2luZmxhdGU7XHJcbnRoaXMuY29udGludWVfaW5mbGF0ZSA9IGNvbnRpbnVlX2luZmxhdGU7XHJcbnRoaXMuZmluYWxfaW5mbGF0ZSA9IGZpbmFsX2luZmxhdGU7XHJcbn0pOyIsIi8qICBQcm90b3R5cGUgSmF2YVNjcmlwdCBmcmFtZXdvcmssIHZlcnNpb24gMS43LjJcbiAqICAoYykgMjAwNS0yMDEwIFNhbSBTdGVwaGVuc29uXG4gKlxuICogIFByb3RvdHlwZSBpcyBmcmVlbHkgZGlzdHJpYnV0YWJsZSB1bmRlciB0aGUgdGVybXMgb2YgYW4gTUlULXN0eWxlIGxpY2Vuc2UuXG4gKiAgRm9yIGRldGFpbHMsIHNlZSB0aGUgUHJvdG90eXBlIHdlYiBzaXRlOiBodHRwOi8vd3d3LnByb3RvdHlwZWpzLm9yZy9cbiAqXG4gKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxudmFyIFByb3RvdHlwZSA9IHtcblxuICBWZXJzaW9uOiAnMS43LjInLFxuXG4gIEJyb3dzZXI6IChmdW5jdGlvbigpe1xuICAgIHZhciB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XG4gICAgdmFyIGlzT3BlcmEgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwod2luZG93Lm9wZXJhKSA9PSAnW29iamVjdCBPcGVyYV0nO1xuICAgIHJldHVybiB7XG4gICAgICBJRTogICAgICAgICAgICAgISF3aW5kb3cuYXR0YWNoRXZlbnQgJiYgIWlzT3BlcmEsXG4gICAgICBPcGVyYTogICAgICAgICAgaXNPcGVyYSxcbiAgICAgIFdlYktpdDogICAgICAgICB1YS5pbmRleE9mKCdBcHBsZVdlYktpdC8nKSA+IC0xLFxuICAgICAgR2Vja286ICAgICAgICAgIHVhLmluZGV4T2YoJ0dlY2tvJykgPiAtMSAmJiB1YS5pbmRleE9mKCdLSFRNTCcpID09PSAtMSxcbiAgICAgIE1vYmlsZVNhZmFyaTogICAvQXBwbGUuKk1vYmlsZS8udGVzdCh1YSlcbiAgICB9XG4gIH0pKCksXG5cbiAgQnJvd3NlckZlYXR1cmVzOiB7XG4gICAgWFBhdGg6ICEhZG9jdW1lbnQuZXZhbHVhdGUsXG5cbiAgICBTZWxlY3RvcnNBUEk6ICEhZG9jdW1lbnQucXVlcnlTZWxlY3RvcixcblxuICAgIEVsZW1lbnRFeHRlbnNpb25zOiAoZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY29uc3RydWN0b3IgPSB3aW5kb3cuRWxlbWVudCB8fCB3aW5kb3cuSFRNTEVsZW1lbnQ7XG4gICAgICByZXR1cm4gISEoY29uc3RydWN0b3IgJiYgY29uc3RydWN0b3IucHJvdG90eXBlKTtcbiAgICB9KSgpLFxuICAgIFNwZWNpZmljRWxlbWVudEV4dGVuc2lvbnM6IChmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0eXBlb2Ygd2luZG93LkhUTUxEaXZFbGVtZW50ICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcbiAgICAgICAgICBmb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZm9ybScpLFxuICAgICAgICAgIGlzU3VwcG9ydGVkID0gZmFsc2U7XG5cbiAgICAgIGlmIChkaXZbJ19fcHJvdG9fXyddICYmIChkaXZbJ19fcHJvdG9fXyddICE9PSBmb3JtWydfX3Byb3RvX18nXSkpIHtcbiAgICAgICAgaXNTdXBwb3J0ZWQgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBkaXYgPSBmb3JtID0gbnVsbDtcblxuICAgICAgcmV0dXJuIGlzU3VwcG9ydGVkO1xuICAgIH0pKClcbiAgfSxcblxuICBTY3JpcHRGcmFnbWVudDogJzxzY3JpcHRbXj5dKj4oW1xcXFxTXFxcXHNdKj8pPFxcL3NjcmlwdFxcXFxzKj4nLFxuICBKU09ORmlsdGVyOiAvXlxcL1xcKi1zZWN1cmUtKFtcXHNcXFNdKilcXCpcXC9cXHMqJC8sXG5cbiAgZW1wdHlGdW5jdGlvbjogZnVuY3Rpb24oKSB7IH0sXG5cbiAgSzogZnVuY3Rpb24oeCkgeyByZXR1cm4geCB9XG59O1xuXG5pZiAoUHJvdG90eXBlLkJyb3dzZXIuTW9iaWxlU2FmYXJpKVxuICBQcm90b3R5cGUuQnJvd3NlckZlYXR1cmVzLlNwZWNpZmljRWxlbWVudEV4dGVuc2lvbnMgPSBmYWxzZTtcbi8qIEJhc2VkIG9uIEFsZXggQXJuZWxsJ3MgaW5oZXJpdGFuY2UgaW1wbGVtZW50YXRpb24uICovXG5cbnZhciBDbGFzcyA9IChmdW5jdGlvbigpIHtcblxuICB2YXIgSVNfRE9OVEVOVU1fQlVHR1kgPSAoZnVuY3Rpb24oKXtcbiAgICBmb3IgKHZhciBwIGluIHsgdG9TdHJpbmc6IDEgfSkge1xuICAgICAgaWYgKHAgPT09ICd0b1N0cmluZycpIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH0pKCk7XG5cbiAgZnVuY3Rpb24gc3ViY2xhc3MoKSB7fTtcbiAgZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBwYXJlbnQgPSBudWxsLCBwcm9wZXJ0aWVzID0gJEEoYXJndW1lbnRzKTtcbiAgICBpZiAoT2JqZWN0LmlzRnVuY3Rpb24ocHJvcGVydGllc1swXSkpXG4gICAgICBwYXJlbnQgPSBwcm9wZXJ0aWVzLnNoaWZ0KCk7XG5cbiAgICBmdW5jdGlvbiBrbGFzcygpIHtcbiAgICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIE9iamVjdC5leHRlbmQoa2xhc3MsIENsYXNzLk1ldGhvZHMpO1xuICAgIGtsYXNzLnN1cGVyY2xhc3MgPSBwYXJlbnQ7XG4gICAga2xhc3Muc3ViY2xhc3NlcyA9IFtdO1xuXG4gICAgaWYgKHBhcmVudCkge1xuICAgICAgc3ViY2xhc3MucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTtcbiAgICAgIGtsYXNzLnByb3RvdHlwZSA9IG5ldyBzdWJjbGFzcztcbiAgICAgIHBhcmVudC5zdWJjbGFzc2VzLnB1c2goa2xhc3MpO1xuICAgIH1cblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBwcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKVxuICAgICAga2xhc3MuYWRkTWV0aG9kcyhwcm9wZXJ0aWVzW2ldKTtcblxuICAgIGlmICgha2xhc3MucHJvdG90eXBlLmluaXRpYWxpemUpXG4gICAgICBrbGFzcy5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IFByb3RvdHlwZS5lbXB0eUZ1bmN0aW9uO1xuXG4gICAga2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yID0ga2xhc3M7XG4gICAgcmV0dXJuIGtsYXNzO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkTWV0aG9kcyhzb3VyY2UpIHtcbiAgICB2YXIgYW5jZXN0b3IgICA9IHRoaXMuc3VwZXJjbGFzcyAmJiB0aGlzLnN1cGVyY2xhc3MucHJvdG90eXBlLFxuICAgICAgICBwcm9wZXJ0aWVzID0gT2JqZWN0LmtleXMoc291cmNlKTtcblxuICAgIGlmIChJU19ET05URU5VTV9CVUdHWSkge1xuICAgICAgaWYgKHNvdXJjZS50b1N0cmluZyAhPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nKVxuICAgICAgICBwcm9wZXJ0aWVzLnB1c2goXCJ0b1N0cmluZ1wiKTtcbiAgICAgIGlmIChzb3VyY2UudmFsdWVPZiAhPSBPYmplY3QucHJvdG90eXBlLnZhbHVlT2YpXG4gICAgICAgIHByb3BlcnRpZXMucHVzaChcInZhbHVlT2ZcIik7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IHByb3BlcnRpZXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBwcm9wZXJ0eSA9IHByb3BlcnRpZXNbaV0sIHZhbHVlID0gc291cmNlW3Byb3BlcnR5XTtcbiAgICAgIGlmIChhbmNlc3RvciAmJiBPYmplY3QuaXNGdW5jdGlvbih2YWx1ZSkgJiZcbiAgICAgICAgICB2YWx1ZS5hcmd1bWVudE5hbWVzKClbMF0gPT0gXCIkc3VwZXJcIikge1xuICAgICAgICB2YXIgbWV0aG9kID0gdmFsdWU7XG4gICAgICAgIHZhbHVlID0gKGZ1bmN0aW9uKG0pIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7IHJldHVybiBhbmNlc3RvclttXS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9O1xuICAgICAgICB9KShwcm9wZXJ0eSkud3JhcChtZXRob2QpO1xuXG4gICAgICAgIHZhbHVlLnZhbHVlT2YgPSAoZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgeyByZXR1cm4gbWV0aG9kLnZhbHVlT2YuY2FsbChtZXRob2QpOyB9O1xuICAgICAgICB9KShtZXRob2QpO1xuXG4gICAgICAgIHZhbHVlLnRvU3RyaW5nID0gKGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ldGhvZC50b1N0cmluZy5jYWxsKG1ldGhvZCk7IH07XG4gICAgICAgIH0pKG1ldGhvZCk7XG4gICAgICB9XG4gICAgICB0aGlzLnByb3RvdHlwZVtwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgY3JlYXRlOiBjcmVhdGUsXG4gICAgTWV0aG9kczoge1xuICAgICAgYWRkTWV0aG9kczogYWRkTWV0aG9kc1xuICAgIH1cbiAgfTtcbn0pKCk7XG4oZnVuY3Rpb24oKSB7XG5cbiAgdmFyIF90b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsXG4gICAgICBfaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LFxuICAgICAgTlVMTF9UWVBFID0gJ051bGwnLFxuICAgICAgVU5ERUZJTkVEX1RZUEUgPSAnVW5kZWZpbmVkJyxcbiAgICAgIEJPT0xFQU5fVFlQRSA9ICdCb29sZWFuJyxcbiAgICAgIE5VTUJFUl9UWVBFID0gJ051bWJlcicsXG4gICAgICBTVFJJTkdfVFlQRSA9ICdTdHJpbmcnLFxuICAgICAgT0JKRUNUX1RZUEUgPSAnT2JqZWN0JyxcbiAgICAgIEZVTkNUSU9OX0NMQVNTID0gJ1tvYmplY3QgRnVuY3Rpb25dJyxcbiAgICAgIEJPT0xFQU5fQ0xBU1MgPSAnW29iamVjdCBCb29sZWFuXScsXG4gICAgICBOVU1CRVJfQ0xBU1MgPSAnW29iamVjdCBOdW1iZXJdJyxcbiAgICAgIFNUUklOR19DTEFTUyA9ICdbb2JqZWN0IFN0cmluZ10nLFxuICAgICAgQVJSQVlfQ0xBU1MgPSAnW29iamVjdCBBcnJheV0nLFxuICAgICAgREFURV9DTEFTUyA9ICdbb2JqZWN0IERhdGVdJyxcbiAgICAgIE5BVElWRV9KU09OX1NUUklOR0lGWV9TVVBQT1JUID0gd2luZG93LkpTT04gJiZcbiAgICAgICAgdHlwZW9mIEpTT04uc3RyaW5naWZ5ID09PSAnZnVuY3Rpb24nICYmXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KDApID09PSAnMCcgJiZcbiAgICAgICAgdHlwZW9mIEpTT04uc3RyaW5naWZ5KFByb3RvdHlwZS5LKSA9PT0gJ3VuZGVmaW5lZCc7XG5cblxuXG4gIHZhciBET05UX0VOVU1TID0gWyd0b1N0cmluZycsICd0b0xvY2FsZVN0cmluZycsICd2YWx1ZU9mJyxcbiAgICdoYXNPd25Qcm9wZXJ0eScsICdpc1Byb3RvdHlwZU9mJywgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJywgJ2NvbnN0cnVjdG9yJ107XG5cbiAgdmFyIElTX0RPTlRFTlVNX0JVR0dZID0gKGZ1bmN0aW9uKCl7XG4gICAgZm9yICh2YXIgcCBpbiB7IHRvU3RyaW5nOiAxIH0pIHtcbiAgICAgIGlmIChwID09PSAndG9TdHJpbmcnKSByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9KSgpO1xuXG4gIGZ1bmN0aW9uIFR5cGUobykge1xuICAgIHN3aXRjaChvKSB7XG4gICAgICBjYXNlIG51bGw6IHJldHVybiBOVUxMX1RZUEU7XG4gICAgICBjYXNlICh2b2lkIDApOiByZXR1cm4gVU5ERUZJTkVEX1RZUEU7XG4gICAgfVxuICAgIHZhciB0eXBlID0gdHlwZW9mIG87XG4gICAgc3dpdGNoKHR5cGUpIHtcbiAgICAgIGNhc2UgJ2Jvb2xlYW4nOiByZXR1cm4gQk9PTEVBTl9UWVBFO1xuICAgICAgY2FzZSAnbnVtYmVyJzogIHJldHVybiBOVU1CRVJfVFlQRTtcbiAgICAgIGNhc2UgJ3N0cmluZyc6ICByZXR1cm4gU1RSSU5HX1RZUEU7XG4gICAgfVxuICAgIHJldHVybiBPQkpFQ1RfVFlQRTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGV4dGVuZChkZXN0aW5hdGlvbiwgc291cmNlKSB7XG4gICAgZm9yICh2YXIgcHJvcGVydHkgaW4gc291cmNlKVxuICAgICAgZGVzdGluYXRpb25bcHJvcGVydHldID0gc291cmNlW3Byb3BlcnR5XTtcbiAgICByZXR1cm4gZGVzdGluYXRpb247XG4gIH1cblxuICBmdW5jdGlvbiBpbnNwZWN0KG9iamVjdCkge1xuICAgIHRyeSB7XG4gICAgICBpZiAoaXNVbmRlZmluZWQob2JqZWN0KSkgcmV0dXJuICd1bmRlZmluZWQnO1xuICAgICAgaWYgKG9iamVjdCA9PT0gbnVsbCkgcmV0dXJuICdudWxsJztcbiAgICAgIHJldHVybiBvYmplY3QuaW5zcGVjdCA/IG9iamVjdC5pbnNwZWN0KCkgOiBTdHJpbmcob2JqZWN0KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoZSBpbnN0YW5jZW9mIFJhbmdlRXJyb3IpIHJldHVybiAnLi4uJztcbiAgICAgIHRocm93IGU7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gdG9KU09OKHZhbHVlKSB7XG4gICAgcmV0dXJuIFN0cignJywgeyAnJzogdmFsdWUgfSwgW10pO1xuICB9XG5cbiAgZnVuY3Rpb24gU3RyKGtleSwgaG9sZGVyLCBzdGFjaykge1xuICAgIHZhciB2YWx1ZSA9IGhvbGRlcltrZXldO1xuICAgIGlmIChUeXBlKHZhbHVlKSA9PT0gT0JKRUNUX1RZUEUgJiYgdHlwZW9mIHZhbHVlLnRvSlNPTiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdmFsdWUgPSB2YWx1ZS50b0pTT04oa2V5KTtcbiAgICB9XG5cbiAgICB2YXIgX2NsYXNzID0gX3RvU3RyaW5nLmNhbGwodmFsdWUpO1xuXG4gICAgc3dpdGNoIChfY2xhc3MpIHtcbiAgICAgIGNhc2UgTlVNQkVSX0NMQVNTOlxuICAgICAgY2FzZSBCT09MRUFOX0NMQVNTOlxuICAgICAgY2FzZSBTVFJJTkdfQ0xBU1M6XG4gICAgICAgIHZhbHVlID0gdmFsdWUudmFsdWVPZigpO1xuICAgIH1cblxuICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgIGNhc2UgbnVsbDogcmV0dXJuICdudWxsJztcbiAgICAgIGNhc2UgdHJ1ZTogcmV0dXJuICd0cnVlJztcbiAgICAgIGNhc2UgZmFsc2U6IHJldHVybiAnZmFsc2UnO1xuICAgIH1cblxuICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlO1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgcmV0dXJuIHZhbHVlLmluc3BlY3QodHJ1ZSk7XG4gICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICByZXR1cm4gaXNGaW5pdGUodmFsdWUpID8gU3RyaW5nKHZhbHVlKSA6ICdudWxsJztcbiAgICAgIGNhc2UgJ29iamVjdCc6XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IHN0YWNrLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYgKHN0YWNrW2ldID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkN5Y2xpYyByZWZlcmVuY2UgdG8gJ1wiICsgdmFsdWUgKyBcIicgaW4gb2JqZWN0XCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzdGFjay5wdXNoKHZhbHVlKTtcblxuICAgICAgICB2YXIgcGFydGlhbCA9IFtdO1xuICAgICAgICBpZiAoX2NsYXNzID09PSBBUlJBWV9DTEFTUykge1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSB2YWx1ZS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHN0ciA9IFN0cihpLCB2YWx1ZSwgc3RhY2spO1xuICAgICAgICAgICAgcGFydGlhbC5wdXNoKHR5cGVvZiBzdHIgPT09ICd1bmRlZmluZWQnID8gJ251bGwnIDogc3RyKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcGFydGlhbCA9ICdbJyArIHBhcnRpYWwuam9pbignLCcpICsgJ10nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXModmFsdWUpO1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIga2V5ID0ga2V5c1tpXSwgc3RyID0gU3RyKGtleSwgdmFsdWUsIHN0YWNrKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc3RyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICBwYXJ0aWFsLnB1c2goa2V5Lmluc3BlY3QodHJ1ZSkrICc6JyArIHN0cik7XG4gICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBwYXJ0aWFsID0gJ3snICsgcGFydGlhbC5qb2luKCcsJykgKyAnfSc7XG4gICAgICAgIH1cbiAgICAgICAgc3RhY2sucG9wKCk7XG4gICAgICAgIHJldHVybiBwYXJ0aWFsO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHN0cmluZ2lmeShvYmplY3QpIHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqZWN0KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRvUXVlcnlTdHJpbmcob2JqZWN0KSB7XG4gICAgcmV0dXJuICRIKG9iamVjdCkudG9RdWVyeVN0cmluZygpO1xuICB9XG5cbiAgZnVuY3Rpb24gdG9IVE1MKG9iamVjdCkge1xuICAgIHJldHVybiBvYmplY3QgJiYgb2JqZWN0LnRvSFRNTCA/IG9iamVjdC50b0hUTUwoKSA6IFN0cmluZy5pbnRlcnByZXQob2JqZWN0KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGtleXMob2JqZWN0KSB7XG4gICAgaWYgKFR5cGUob2JqZWN0KSAhPT0gT0JKRUNUX1RZUEUpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigpOyB9XG4gICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBvYmplY3QpIHtcbiAgICAgIGlmIChfaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KSlcbiAgICAgICAgcmVzdWx0cy5wdXNoKHByb3BlcnR5KTtcbiAgICB9XG5cbiAgICBpZiAoSVNfRE9OVEVOVU1fQlVHR1kpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBwcm9wZXJ0eSA9IERPTlRfRU5VTVNbaV07IGkrKykge1xuICAgICAgICBpZiAoX2hhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpXG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHByb3BlcnR5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIGZ1bmN0aW9uIHZhbHVlcyhvYmplY3QpIHtcbiAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgIGZvciAodmFyIHByb3BlcnR5IGluIG9iamVjdClcbiAgICAgIHJlc3VsdHMucHVzaChvYmplY3RbcHJvcGVydHldKTtcbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsb25lKG9iamVjdCkge1xuICAgIHJldHVybiBleHRlbmQoeyB9LCBvYmplY3QpO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNFbGVtZW50KG9iamVjdCkge1xuICAgIHJldHVybiAhIShvYmplY3QgJiYgb2JqZWN0Lm5vZGVUeXBlID09IDEpO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNBcnJheShvYmplY3QpIHtcbiAgICByZXR1cm4gX3RvU3RyaW5nLmNhbGwob2JqZWN0KSA9PT0gQVJSQVlfQ0xBU1M7XG4gIH1cblxuICB2YXIgaGFzTmF0aXZlSXNBcnJheSA9ICh0eXBlb2YgQXJyYXkuaXNBcnJheSA9PSAnZnVuY3Rpb24nKVxuICAgICYmIEFycmF5LmlzQXJyYXkoW10pICYmICFBcnJheS5pc0FycmF5KHt9KTtcblxuICBpZiAoaGFzTmF0aXZlSXNBcnJheSkge1xuICAgIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5O1xuICB9XG5cbiAgZnVuY3Rpb24gaXNIYXNoKG9iamVjdCkge1xuICAgIHJldHVybiBvYmplY3QgaW5zdGFuY2VvZiBIYXNoO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNGdW5jdGlvbihvYmplY3QpIHtcbiAgICByZXR1cm4gX3RvU3RyaW5nLmNhbGwob2JqZWN0KSA9PT0gRlVOQ1RJT05fQ0xBU1M7XG4gIH1cblxuICBmdW5jdGlvbiBpc1N0cmluZyhvYmplY3QpIHtcbiAgICByZXR1cm4gX3RvU3RyaW5nLmNhbGwob2JqZWN0KSA9PT0gU1RSSU5HX0NMQVNTO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNOdW1iZXIob2JqZWN0KSB7XG4gICAgcmV0dXJuIF90b1N0cmluZy5jYWxsKG9iamVjdCkgPT09IE5VTUJFUl9DTEFTUztcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzRGF0ZShvYmplY3QpIHtcbiAgICByZXR1cm4gX3RvU3RyaW5nLmNhbGwob2JqZWN0KSA9PT0gREFURV9DTEFTUztcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzVW5kZWZpbmVkKG9iamVjdCkge1xuICAgIHJldHVybiB0eXBlb2Ygb2JqZWN0ID09PSBcInVuZGVmaW5lZFwiO1xuICB9XG5cbiAgZXh0ZW5kKE9iamVjdCwge1xuICAgIGV4dGVuZDogICAgICAgIGV4dGVuZCxcbiAgICBpbnNwZWN0OiAgICAgICBpbnNwZWN0LFxuICAgIHRvSlNPTjogICAgICAgIE5BVElWRV9KU09OX1NUUklOR0lGWV9TVVBQT1JUID8gc3RyaW5naWZ5IDogdG9KU09OLFxuICAgIHRvUXVlcnlTdHJpbmc6IHRvUXVlcnlTdHJpbmcsXG4gICAgdG9IVE1MOiAgICAgICAgdG9IVE1MLFxuICAgIGtleXM6ICAgICAgICAgIE9iamVjdC5rZXlzIHx8IGtleXMsXG4gICAgdmFsdWVzOiAgICAgICAgdmFsdWVzLFxuICAgIGNsb25lOiAgICAgICAgIGNsb25lLFxuICAgIGlzRWxlbWVudDogICAgIGlzRWxlbWVudCxcbiAgICBpc0FycmF5OiAgICAgICBpc0FycmF5LFxuICAgIGlzSGFzaDogICAgICAgIGlzSGFzaCxcbiAgICBpc0Z1bmN0aW9uOiAgICBpc0Z1bmN0aW9uLFxuICAgIGlzU3RyaW5nOiAgICAgIGlzU3RyaW5nLFxuICAgIGlzTnVtYmVyOiAgICAgIGlzTnVtYmVyLFxuICAgIGlzRGF0ZTogICAgICAgIGlzRGF0ZSxcbiAgICBpc1VuZGVmaW5lZDogICBpc1VuZGVmaW5lZFxuICB9KTtcbn0pKCk7XG5PYmplY3QuZXh0ZW5kKEZ1bmN0aW9uLnByb3RvdHlwZSwgKGZ1bmN0aW9uKCkge1xuICB2YXIgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG5cbiAgZnVuY3Rpb24gdXBkYXRlKGFycmF5LCBhcmdzKSB7XG4gICAgdmFyIGFycmF5TGVuZ3RoID0gYXJyYXkubGVuZ3RoLCBsZW5ndGggPSBhcmdzLmxlbmd0aDtcbiAgICB3aGlsZSAobGVuZ3RoLS0pIGFycmF5W2FycmF5TGVuZ3RoICsgbGVuZ3RoXSA9IGFyZ3NbbGVuZ3RoXTtcbiAgICByZXR1cm4gYXJyYXk7XG4gIH1cblxuICBmdW5jdGlvbiBtZXJnZShhcnJheSwgYXJncykge1xuICAgIGFycmF5ID0gc2xpY2UuY2FsbChhcnJheSwgMCk7XG4gICAgcmV0dXJuIHVwZGF0ZShhcnJheSwgYXJncyk7XG4gIH1cblxuICBmdW5jdGlvbiBhcmd1bWVudE5hbWVzKCkge1xuICAgIHZhciBuYW1lcyA9IHRoaXMudG9TdHJpbmcoKS5tYXRjaCgvXltcXHNcXChdKmZ1bmN0aW9uW14oXSpcXCgoW14pXSopXFwpLylbMV1cbiAgICAgIC5yZXBsYWNlKC9cXC9cXC8uKj9bXFxyXFxuXXxcXC9cXCooPzoufFtcXHJcXG5dKSo/XFwqXFwvL2csICcnKVxuICAgICAgLnJlcGxhY2UoL1xccysvZywgJycpLnNwbGl0KCcsJyk7XG4gICAgcmV0dXJuIG5hbWVzLmxlbmd0aCA9PSAxICYmICFuYW1lc1swXSA/IFtdIDogbmFtZXM7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIGJpbmQoY29udGV4dCkge1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMiAmJiBPYmplY3QuaXNVbmRlZmluZWQoYXJndW1lbnRzWzBdKSlcbiAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgaWYgKCFPYmplY3QuaXNGdW5jdGlvbih0aGlzKSlcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgb2JqZWN0IGlzIG5vdCBjYWxsYWJsZS5cIik7XG5cbiAgICB2YXIgbm9wID0gZnVuY3Rpb24oKSB7fTtcbiAgICB2YXIgX19tZXRob2QgPSB0aGlzLCBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuXG4gICAgdmFyIGJvdW5kID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYSA9IG1lcmdlKGFyZ3MsIGFyZ3VtZW50cyk7XG4gICAgICB2YXIgYyA9IHRoaXMgaW5zdGFuY2VvZiBib3VuZCA/IHRoaXMgOiBjb250ZXh0O1xuICAgICAgcmV0dXJuIF9fbWV0aG9kLmFwcGx5KGMsIGEpO1xuICAgIH07XG5cbiAgICBub3AucHJvdG90eXBlICAgPSB0aGlzLnByb3RvdHlwZTtcbiAgICBib3VuZC5wcm90b3R5cGUgPSBuZXcgbm9wKCk7XG5cbiAgICByZXR1cm4gYm91bmQ7XG4gIH1cblxuICBmdW5jdGlvbiBiaW5kQXNFdmVudExpc3RlbmVyKGNvbnRleHQpIHtcbiAgICB2YXIgX19tZXRob2QgPSB0aGlzLCBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICAgIHJldHVybiBmdW5jdGlvbihldmVudCkge1xuICAgICAgdmFyIGEgPSB1cGRhdGUoW2V2ZW50IHx8IHdpbmRvdy5ldmVudF0sIGFyZ3MpO1xuICAgICAgcmV0dXJuIF9fbWV0aG9kLmFwcGx5KGNvbnRleHQsIGEpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGN1cnJ5KCkge1xuICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRoaXM7XG4gICAgdmFyIF9fbWV0aG9kID0gdGhpcywgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTtcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYSA9IG1lcmdlKGFyZ3MsIGFyZ3VtZW50cyk7XG4gICAgICByZXR1cm4gX19tZXRob2QuYXBwbHkodGhpcywgYSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZGVsYXkodGltZW91dCkge1xuICAgIHZhciBfX21ldGhvZCA9IHRoaXMsIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgdGltZW91dCA9IHRpbWVvdXQgKiAxMDAwO1xuICAgIHJldHVybiB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBfX21ldGhvZC5hcHBseShfX21ldGhvZCwgYXJncyk7XG4gICAgfSwgdGltZW91dCk7XG4gIH1cblxuICBmdW5jdGlvbiBkZWZlcigpIHtcbiAgICB2YXIgYXJncyA9IHVwZGF0ZShbMC4wMV0sIGFyZ3VtZW50cyk7XG4gICAgcmV0dXJuIHRoaXMuZGVsYXkuYXBwbHkodGhpcywgYXJncyk7XG4gIH1cblxuICBmdW5jdGlvbiB3cmFwKHdyYXBwZXIpIHtcbiAgICB2YXIgX19tZXRob2QgPSB0aGlzO1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBhID0gdXBkYXRlKFtfX21ldGhvZC5iaW5kKHRoaXMpXSwgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiB3cmFwcGVyLmFwcGx5KHRoaXMsIGEpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG1ldGhvZGl6ZSgpIHtcbiAgICBpZiAodGhpcy5fbWV0aG9kaXplZCkgcmV0dXJuIHRoaXMuX21ldGhvZGl6ZWQ7XG4gICAgdmFyIF9fbWV0aG9kID0gdGhpcztcbiAgICByZXR1cm4gdGhpcy5fbWV0aG9kaXplZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGEgPSB1cGRhdGUoW3RoaXNdLCBhcmd1bWVudHMpO1xuICAgICAgcmV0dXJuIF9fbWV0aG9kLmFwcGx5KG51bGwsIGEpO1xuICAgIH07XG4gIH1cblxuICB2YXIgZXh0ZW5zaW9ucyA9IHtcbiAgICBhcmd1bWVudE5hbWVzOiAgICAgICBhcmd1bWVudE5hbWVzLFxuICAgIGJpbmRBc0V2ZW50TGlzdGVuZXI6IGJpbmRBc0V2ZW50TGlzdGVuZXIsXG4gICAgY3Vycnk6ICAgICAgICAgICAgICAgY3VycnksXG4gICAgZGVsYXk6ICAgICAgICAgICAgICAgZGVsYXksXG4gICAgZGVmZXI6ICAgICAgICAgICAgICAgZGVmZXIsXG4gICAgd3JhcDogICAgICAgICAgICAgICAgd3JhcCxcbiAgICBtZXRob2RpemU6ICAgICAgICAgICBtZXRob2RpemVcbiAgfTtcblxuICBpZiAoIUZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kKVxuICAgIGV4dGVuc2lvbnMuYmluZCA9IGJpbmQ7XG5cbiAgcmV0dXJuIGV4dGVuc2lvbnM7XG59KSgpKTtcblxuXG5cbihmdW5jdGlvbihwcm90bykge1xuXG5cbiAgZnVuY3Rpb24gdG9JU09TdHJpbmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0VVRDRnVsbFllYXIoKSArICctJyArXG4gICAgICAodGhpcy5nZXRVVENNb250aCgpICsgMSkudG9QYWRkZWRTdHJpbmcoMikgKyAnLScgK1xuICAgICAgdGhpcy5nZXRVVENEYXRlKCkudG9QYWRkZWRTdHJpbmcoMikgKyAnVCcgK1xuICAgICAgdGhpcy5nZXRVVENIb3VycygpLnRvUGFkZGVkU3RyaW5nKDIpICsgJzonICtcbiAgICAgIHRoaXMuZ2V0VVRDTWludXRlcygpLnRvUGFkZGVkU3RyaW5nKDIpICsgJzonICtcbiAgICAgIHRoaXMuZ2V0VVRDU2Vjb25kcygpLnRvUGFkZGVkU3RyaW5nKDIpICsgJ1onO1xuICB9XG5cblxuICBmdW5jdGlvbiB0b0pTT04oKSB7XG4gICAgcmV0dXJuIHRoaXMudG9JU09TdHJpbmcoKTtcbiAgfVxuXG4gIGlmICghcHJvdG8udG9JU09TdHJpbmcpIHByb3RvLnRvSVNPU3RyaW5nID0gdG9JU09TdHJpbmc7XG4gIGlmICghcHJvdG8udG9KU09OKSBwcm90by50b0pTT04gPSB0b0pTT047XG5cbn0pKERhdGUucHJvdG90eXBlKTtcblxuXG5SZWdFeHAucHJvdG90eXBlLm1hdGNoID0gUmVnRXhwLnByb3RvdHlwZS50ZXN0O1xuXG5SZWdFeHAuZXNjYXBlID0gZnVuY3Rpb24oc3RyKSB7XG4gIHJldHVybiBTdHJpbmcoc3RyKS5yZXBsYWNlKC8oWy4qKz9ePSE6JHt9KCl8W1xcXVxcL1xcXFxdKS9nLCAnXFxcXCQxJyk7XG59O1xudmFyIFBlcmlvZGljYWxFeGVjdXRlciA9IENsYXNzLmNyZWF0ZSh7XG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKGNhbGxiYWNrLCBmcmVxdWVuY3kpIHtcbiAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgdGhpcy5mcmVxdWVuY3kgPSBmcmVxdWVuY3k7XG4gICAgdGhpcy5jdXJyZW50bHlFeGVjdXRpbmcgPSBmYWxzZTtcblxuICAgIHRoaXMucmVnaXN0ZXJDYWxsYmFjaygpO1xuICB9LFxuXG4gIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudGltZXIgPSBzZXRJbnRlcnZhbCh0aGlzLm9uVGltZXJFdmVudC5iaW5kKHRoaXMpLCB0aGlzLmZyZXF1ZW5jeSAqIDEwMDApO1xuICB9LFxuXG4gIGV4ZWN1dGU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2FsbGJhY2sodGhpcyk7XG4gIH0sXG5cbiAgc3RvcDogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLnRpbWVyKSByZXR1cm47XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKTtcbiAgICB0aGlzLnRpbWVyID0gbnVsbDtcbiAgfSxcblxuICBvblRpbWVyRXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy5jdXJyZW50bHlFeGVjdXRpbmcpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuY3VycmVudGx5RXhlY3V0aW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5leGVjdXRlKCk7XG4gICAgICAgIHRoaXMuY3VycmVudGx5RXhlY3V0aW5nID0gZmFsc2U7XG4gICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50bHlFeGVjdXRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuT2JqZWN0LmV4dGVuZChTdHJpbmcsIHtcbiAgaW50ZXJwcmV0OiBmdW5jdGlvbih2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZSA9PSBudWxsID8gJycgOiBTdHJpbmcodmFsdWUpO1xuICB9LFxuICBzcGVjaWFsQ2hhcjoge1xuICAgICdcXGInOiAnXFxcXGInLFxuICAgICdcXHQnOiAnXFxcXHQnLFxuICAgICdcXG4nOiAnXFxcXG4nLFxuICAgICdcXGYnOiAnXFxcXGYnLFxuICAgICdcXHInOiAnXFxcXHInLFxuICAgICdcXFxcJzogJ1xcXFxcXFxcJ1xuICB9XG59KTtcblxuT2JqZWN0LmV4dGVuZChTdHJpbmcucHJvdG90eXBlLCAoZnVuY3Rpb24oKSB7XG4gIHZhciBOQVRJVkVfSlNPTl9QQVJTRV9TVVBQT1JUID0gd2luZG93LkpTT04gJiZcbiAgICB0eXBlb2YgSlNPTi5wYXJzZSA9PT0gJ2Z1bmN0aW9uJyAmJlxuICAgIEpTT04ucGFyc2UoJ3tcInRlc3RcIjogdHJ1ZX0nKS50ZXN0O1xuXG4gIGZ1bmN0aW9uIHByZXBhcmVSZXBsYWNlbWVudChyZXBsYWNlbWVudCkge1xuICAgIGlmIChPYmplY3QuaXNGdW5jdGlvbihyZXBsYWNlbWVudCkpIHJldHVybiByZXBsYWNlbWVudDtcbiAgICB2YXIgdGVtcGxhdGUgPSBuZXcgVGVtcGxhdGUocmVwbGFjZW1lbnQpO1xuICAgIHJldHVybiBmdW5jdGlvbihtYXRjaCkgeyByZXR1cm4gdGVtcGxhdGUuZXZhbHVhdGUobWF0Y2gpIH07XG4gIH1cblxuICBmdW5jdGlvbiBpc05vbkVtcHR5UmVnRXhwKHJlZ2V4cCkge1xuICAgIHJldHVybiByZWdleHAuc291cmNlICYmIHJlZ2V4cC5zb3VyY2UgIT09ICcoPzopJztcbiAgfVxuXG5cbiAgZnVuY3Rpb24gZ3N1YihwYXR0ZXJuLCByZXBsYWNlbWVudCkge1xuICAgIHZhciByZXN1bHQgPSAnJywgc291cmNlID0gdGhpcywgbWF0Y2g7XG4gICAgcmVwbGFjZW1lbnQgPSBwcmVwYXJlUmVwbGFjZW1lbnQocmVwbGFjZW1lbnQpO1xuXG4gICAgaWYgKE9iamVjdC5pc1N0cmluZyhwYXR0ZXJuKSlcbiAgICAgIHBhdHRlcm4gPSBSZWdFeHAuZXNjYXBlKHBhdHRlcm4pO1xuXG4gICAgaWYgKCEocGF0dGVybi5sZW5ndGggfHwgaXNOb25FbXB0eVJlZ0V4cChwYXR0ZXJuKSkpIHtcbiAgICAgIHJlcGxhY2VtZW50ID0gcmVwbGFjZW1lbnQoJycpO1xuICAgICAgcmV0dXJuIHJlcGxhY2VtZW50ICsgc291cmNlLnNwbGl0KCcnKS5qb2luKHJlcGxhY2VtZW50KSArIHJlcGxhY2VtZW50O1xuICAgIH1cblxuICAgIHdoaWxlIChzb3VyY2UubGVuZ3RoID4gMCkge1xuICAgICAgbWF0Y2ggPSBzb3VyY2UubWF0Y2gocGF0dGVybilcbiAgICAgIGlmIChtYXRjaCAmJiBtYXRjaFswXS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlc3VsdCArPSBzb3VyY2Uuc2xpY2UoMCwgbWF0Y2guaW5kZXgpO1xuICAgICAgICByZXN1bHQgKz0gU3RyaW5nLmludGVycHJldChyZXBsYWNlbWVudChtYXRjaCkpO1xuICAgICAgICBzb3VyY2UgID0gc291cmNlLnNsaWNlKG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdCArPSBzb3VyY2UsIHNvdXJjZSA9ICcnO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgZnVuY3Rpb24gc3ViKHBhdHRlcm4sIHJlcGxhY2VtZW50LCBjb3VudCkge1xuICAgIHJlcGxhY2VtZW50ID0gcHJlcGFyZVJlcGxhY2VtZW50KHJlcGxhY2VtZW50KTtcbiAgICBjb3VudCA9IE9iamVjdC5pc1VuZGVmaW5lZChjb3VudCkgPyAxIDogY291bnQ7XG5cbiAgICByZXR1cm4gdGhpcy5nc3ViKHBhdHRlcm4sIGZ1bmN0aW9uKG1hdGNoKSB7XG4gICAgICBpZiAoLS1jb3VudCA8IDApIHJldHVybiBtYXRjaFswXTtcbiAgICAgIHJldHVybiByZXBsYWNlbWVudChtYXRjaCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBzY2FuKHBhdHRlcm4sIGl0ZXJhdG9yKSB7XG4gICAgdGhpcy5nc3ViKHBhdHRlcm4sIGl0ZXJhdG9yKTtcbiAgICByZXR1cm4gU3RyaW5nKHRoaXMpO1xuICB9XG5cbiAgZnVuY3Rpb24gdHJ1bmNhdGUobGVuZ3RoLCB0cnVuY2F0aW9uKSB7XG4gICAgbGVuZ3RoID0gbGVuZ3RoIHx8IDMwO1xuICAgIHRydW5jYXRpb24gPSBPYmplY3QuaXNVbmRlZmluZWQodHJ1bmNhdGlvbikgPyAnLi4uJyA6IHRydW5jYXRpb247XG4gICAgcmV0dXJuIHRoaXMubGVuZ3RoID4gbGVuZ3RoID9cbiAgICAgIHRoaXMuc2xpY2UoMCwgbGVuZ3RoIC0gdHJ1bmNhdGlvbi5sZW5ndGgpICsgdHJ1bmNhdGlvbiA6IFN0cmluZyh0aGlzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0cmlwKCkge1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoL15cXHMrLywgJycpLnJlcGxhY2UoL1xccyskLywgJycpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RyaXBUYWdzKCkge1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoLzxcXHcrKFxccysoXCJbXlwiXSpcInwnW14nXSonfFtePl0pKyk/Pnw8XFwvXFx3Kz4vZ2ksICcnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0cmlwU2NyaXB0cygpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKG5ldyBSZWdFeHAoUHJvdG90eXBlLlNjcmlwdEZyYWdtZW50LCAnaW1nJyksICcnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGV4dHJhY3RTY3JpcHRzKCkge1xuICAgIHZhciBtYXRjaEFsbCA9IG5ldyBSZWdFeHAoUHJvdG90eXBlLlNjcmlwdEZyYWdtZW50LCAnaW1nJyksXG4gICAgICAgIG1hdGNoT25lID0gbmV3IFJlZ0V4cChQcm90b3R5cGUuU2NyaXB0RnJhZ21lbnQsICdpbScpO1xuICAgIHJldHVybiAodGhpcy5tYXRjaChtYXRjaEFsbCkgfHwgW10pLm1hcChmdW5jdGlvbihzY3JpcHRUYWcpIHtcbiAgICAgIHJldHVybiAoc2NyaXB0VGFnLm1hdGNoKG1hdGNoT25lKSB8fCBbJycsICcnXSlbMV07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBldmFsU2NyaXB0cygpIHtcbiAgICByZXR1cm4gdGhpcy5leHRyYWN0U2NyaXB0cygpLm1hcChmdW5jdGlvbihzY3JpcHQpIHsgcmV0dXJuIGV2YWwoc2NyaXB0KTsgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBlc2NhcGVIVE1MKCkge1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoLyYvZywnJmFtcDsnKS5yZXBsYWNlKC88L2csJyZsdDsnKS5yZXBsYWNlKC8+L2csJyZndDsnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVuZXNjYXBlSFRNTCgpIHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcFRhZ3MoKS5yZXBsYWNlKC8mbHQ7L2csJzwnKS5yZXBsYWNlKC8mZ3Q7L2csJz4nKS5yZXBsYWNlKC8mYW1wOy9nLCcmJyk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHRvUXVlcnlQYXJhbXMoc2VwYXJhdG9yKSB7XG4gICAgdmFyIG1hdGNoID0gdGhpcy5zdHJpcCgpLm1hdGNoKC8oW14/I10qKSgjLiopPyQvKTtcbiAgICBpZiAoIW1hdGNoKSByZXR1cm4geyB9O1xuXG4gICAgcmV0dXJuIG1hdGNoWzFdLnNwbGl0KHNlcGFyYXRvciB8fCAnJicpLmluamVjdCh7IH0sIGZ1bmN0aW9uKGhhc2gsIHBhaXIpIHtcbiAgICAgIGlmICgocGFpciA9IHBhaXIuc3BsaXQoJz0nKSlbMF0pIHtcbiAgICAgICAgdmFyIGtleSA9IGRlY29kZVVSSUNvbXBvbmVudChwYWlyLnNoaWZ0KCkpLFxuICAgICAgICAgICAgdmFsdWUgPSBwYWlyLmxlbmd0aCA+IDEgPyBwYWlyLmpvaW4oJz0nKSA6IHBhaXJbMF07XG5cbiAgICAgICAgaWYgKHZhbHVlICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHZhbHVlID0gdmFsdWUuZ3N1YignKycsICcgJyk7XG4gICAgICAgICAgdmFsdWUgPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGtleSBpbiBoYXNoKSB7XG4gICAgICAgICAgaWYgKCFPYmplY3QuaXNBcnJheShoYXNoW2tleV0pKSBoYXNoW2tleV0gPSBbaGFzaFtrZXldXTtcbiAgICAgICAgICBoYXNoW2tleV0ucHVzaCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBoYXNoW2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBoYXNoO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gdG9BcnJheSgpIHtcbiAgICByZXR1cm4gdGhpcy5zcGxpdCgnJyk7XG4gIH1cblxuICBmdW5jdGlvbiBzdWNjKCkge1xuICAgIHJldHVybiB0aGlzLnNsaWNlKDAsIHRoaXMubGVuZ3RoIC0gMSkgK1xuICAgICAgU3RyaW5nLmZyb21DaGFyQ29kZSh0aGlzLmNoYXJDb2RlQXQodGhpcy5sZW5ndGggLSAxKSArIDEpO1xuICB9XG5cbiAgZnVuY3Rpb24gdGltZXMoY291bnQpIHtcbiAgICByZXR1cm4gY291bnQgPCAxID8gJycgOiBuZXcgQXJyYXkoY291bnQgKyAxKS5qb2luKHRoaXMpO1xuICB9XG5cbiAgZnVuY3Rpb24gY2FtZWxpemUoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvLSsoLik/L2csIGZ1bmN0aW9uKG1hdGNoLCBjaHIpIHtcbiAgICAgIHJldHVybiBjaHIgPyBjaHIudG9VcHBlckNhc2UoKSA6ICcnO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY2FwaXRhbGl6ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMuc3Vic3RyaW5nKDEpLnRvTG93ZXJDYXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiB1bmRlcnNjb3JlKCkge1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoLzo6L2csICcvJylcbiAgICAgICAgICAgICAgIC5yZXBsYWNlKC8oW0EtWl0rKShbQS1aXVthLXpdKS9nLCAnJDFfJDInKVxuICAgICAgICAgICAgICAgLnJlcGxhY2UoLyhbYS16XFxkXSkoW0EtWl0pL2csICckMV8kMicpXG4gICAgICAgICAgICAgICAucmVwbGFjZSgvLS9nLCAnXycpXG4gICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRhc2hlcml6ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC9fL2csICctJyk7XG4gIH1cblxuICBmdW5jdGlvbiBpbnNwZWN0KHVzZURvdWJsZVF1b3Rlcykge1xuICAgIHZhciBlc2NhcGVkU3RyaW5nID0gdGhpcy5yZXBsYWNlKC9bXFx4MDAtXFx4MWZcXFxcXS9nLCBmdW5jdGlvbihjaGFyYWN0ZXIpIHtcbiAgICAgIGlmIChjaGFyYWN0ZXIgaW4gU3RyaW5nLnNwZWNpYWxDaGFyKSB7XG4gICAgICAgIHJldHVybiBTdHJpbmcuc3BlY2lhbENoYXJbY2hhcmFjdGVyXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAnXFxcXHUwMCcgKyBjaGFyYWN0ZXIuY2hhckNvZGVBdCgpLnRvUGFkZGVkU3RyaW5nKDIsIDE2KTtcbiAgICB9KTtcbiAgICBpZiAodXNlRG91YmxlUXVvdGVzKSByZXR1cm4gJ1wiJyArIGVzY2FwZWRTdHJpbmcucmVwbGFjZSgvXCIvZywgJ1xcXFxcIicpICsgJ1wiJztcbiAgICByZXR1cm4gXCInXCIgKyBlc2NhcGVkU3RyaW5nLnJlcGxhY2UoLycvZywgJ1xcXFxcXCcnKSArIFwiJ1wiO1xuICB9XG5cbiAgZnVuY3Rpb24gdW5maWx0ZXJKU09OKGZpbHRlcikge1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoZmlsdGVyIHx8IFByb3RvdHlwZS5KU09ORmlsdGVyLCAnJDEnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzSlNPTigpIHtcbiAgICB2YXIgc3RyID0gdGhpcztcbiAgICBpZiAoc3RyLmJsYW5rKCkpIHJldHVybiBmYWxzZTtcbiAgICBzdHIgPSBzdHIucmVwbGFjZSgvXFxcXCg/OltcIlxcXFxcXC9iZm5ydF18dVswLTlhLWZBLUZdezR9KS9nLCAnQCcpO1xuICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9cIlteXCJcXFxcXFxuXFxyXSpcInx0cnVlfGZhbHNlfG51bGx8LT9cXGQrKD86XFwuXFxkKik/KD86W2VFXVsrXFwtXT9cXGQrKT8vZywgJ10nKTtcbiAgICBzdHIgPSBzdHIucmVwbGFjZSgvKD86Xnw6fCwpKD86XFxzKlxcWykrL2csICcnKTtcbiAgICByZXR1cm4gKC9eW1xcXSw6e31cXHNdKiQvKS50ZXN0KHN0cik7XG4gIH1cblxuICBmdW5jdGlvbiBldmFsSlNPTihzYW5pdGl6ZSkge1xuICAgIHZhciBqc29uID0gdGhpcy51bmZpbHRlckpTT04oKSxcbiAgICAgICAgY3ggPSAvW1xcdTAwMDBcXHUwMGFkXFx1MDYwMC1cXHUwNjA0XFx1MDcwZlxcdTE3YjRcXHUxN2I1XFx1MjAwYy1cXHUyMDBmXFx1MjAyOC1cXHUyMDJmXFx1MjA2MC1cXHUyMDZmXFx1ZmVmZlxcdWZmZjAtXFx1ZmZmZl0vZztcbiAgICBpZiAoY3gudGVzdChqc29uKSkge1xuICAgICAganNvbiA9IGpzb24ucmVwbGFjZShjeCwgZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgcmV0dXJuICdcXFxcdScgKyAoJzAwMDAnICsgYS5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTQpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBpZiAoIXNhbml0aXplIHx8IGpzb24uaXNKU09OKCkpIHJldHVybiBldmFsKCcoJyArIGpzb24gKyAnKScpO1xuICAgIH0gY2F0Y2ggKGUpIHsgfVxuICAgIHRocm93IG5ldyBTeW50YXhFcnJvcignQmFkbHkgZm9ybWVkIEpTT04gc3RyaW5nOiAnICsgdGhpcy5pbnNwZWN0KCkpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VKU09OKCkge1xuICAgIHZhciBqc29uID0gdGhpcy51bmZpbHRlckpTT04oKTtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShqc29uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluY2x1ZGUocGF0dGVybikge1xuICAgIHJldHVybiB0aGlzLmluZGV4T2YocGF0dGVybikgPiAtMTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0YXJ0c1dpdGgocGF0dGVybiwgcG9zaXRpb24pIHtcbiAgICBwb3NpdGlvbiA9IE9iamVjdC5pc051bWJlcihwb3NpdGlvbikgPyBwb3NpdGlvbiA6IDA7XG4gICAgcmV0dXJuIHRoaXMubGFzdEluZGV4T2YocGF0dGVybiwgcG9zaXRpb24pID09PSBwb3NpdGlvbjtcbiAgfVxuXG4gIGZ1bmN0aW9uIGVuZHNXaXRoKHBhdHRlcm4sIHBvc2l0aW9uKSB7XG4gICAgcGF0dGVybiA9IFN0cmluZyhwYXR0ZXJuKTtcbiAgICBwb3NpdGlvbiA9IE9iamVjdC5pc051bWJlcihwb3NpdGlvbikgPyBwb3NpdGlvbiA6IHRoaXMubGVuZ3RoO1xuICAgIGlmIChwb3NpdGlvbiA8IDApIHBvc2l0aW9uID0gMDtcbiAgICBpZiAocG9zaXRpb24gPiB0aGlzLmxlbmd0aCkgcG9zaXRpb24gPSB0aGlzLmxlbmd0aDtcbiAgICB2YXIgZCA9IHBvc2l0aW9uIC0gcGF0dGVybi5sZW5ndGg7XG4gICAgcmV0dXJuIGQgPj0gMCAmJiB0aGlzLmluZGV4T2YocGF0dGVybiwgZCkgPT09IGQ7XG4gIH1cblxuICBmdW5jdGlvbiBlbXB0eSgpIHtcbiAgICByZXR1cm4gdGhpcyA9PSAnJztcbiAgfVxuXG4gIGZ1bmN0aW9uIGJsYW5rKCkge1xuICAgIHJldHVybiAvXlxccyokLy50ZXN0KHRoaXMpO1xuICB9XG5cbiAgZnVuY3Rpb24gaW50ZXJwb2xhdGUob2JqZWN0LCBwYXR0ZXJuKSB7XG4gICAgcmV0dXJuIG5ldyBUZW1wbGF0ZSh0aGlzLCBwYXR0ZXJuKS5ldmFsdWF0ZShvYmplY3QpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBnc3ViOiAgICAgICAgICAgZ3N1YixcbiAgICBzdWI6ICAgICAgICAgICAgc3ViLFxuICAgIHNjYW46ICAgICAgICAgICBzY2FuLFxuICAgIHRydW5jYXRlOiAgICAgICB0cnVuY2F0ZSxcbiAgICBzdHJpcDogICAgICAgICAgU3RyaW5nLnByb3RvdHlwZS50cmltIHx8IHN0cmlwLFxuICAgIHN0cmlwVGFnczogICAgICBzdHJpcFRhZ3MsXG4gICAgc3RyaXBTY3JpcHRzOiAgIHN0cmlwU2NyaXB0cyxcbiAgICBleHRyYWN0U2NyaXB0czogZXh0cmFjdFNjcmlwdHMsXG4gICAgZXZhbFNjcmlwdHM6ICAgIGV2YWxTY3JpcHRzLFxuICAgIGVzY2FwZUhUTUw6ICAgICBlc2NhcGVIVE1MLFxuICAgIHVuZXNjYXBlSFRNTDogICB1bmVzY2FwZUhUTUwsXG4gICAgdG9RdWVyeVBhcmFtczogIHRvUXVlcnlQYXJhbXMsXG4gICAgcGFyc2VRdWVyeTogICAgIHRvUXVlcnlQYXJhbXMsXG4gICAgdG9BcnJheTogICAgICAgIHRvQXJyYXksXG4gICAgc3VjYzogICAgICAgICAgIHN1Y2MsXG4gICAgdGltZXM6ICAgICAgICAgIHRpbWVzLFxuICAgIGNhbWVsaXplOiAgICAgICBjYW1lbGl6ZSxcbiAgICBjYXBpdGFsaXplOiAgICAgY2FwaXRhbGl6ZSxcbiAgICB1bmRlcnNjb3JlOiAgICAgdW5kZXJzY29yZSxcbiAgICBkYXNoZXJpemU6ICAgICAgZGFzaGVyaXplLFxuICAgIGluc3BlY3Q6ICAgICAgICBpbnNwZWN0LFxuICAgIHVuZmlsdGVySlNPTjogICB1bmZpbHRlckpTT04sXG4gICAgaXNKU09OOiAgICAgICAgIGlzSlNPTixcbiAgICBldmFsSlNPTjogICAgICAgTkFUSVZFX0pTT05fUEFSU0VfU1VQUE9SVCA/IHBhcnNlSlNPTiA6IGV2YWxKU09OLFxuICAgIGluY2x1ZGU6ICAgICAgICBpbmNsdWRlLFxuICAgIHN0YXJ0c1dpdGg6ICAgICBTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGggfHwgc3RhcnRzV2l0aCxcbiAgICBlbmRzV2l0aDogICAgICAgU3RyaW5nLnByb3RvdHlwZS5lbmRzV2l0aCB8fCBlbmRzV2l0aCxcbiAgICBlbXB0eTogICAgICAgICAgZW1wdHksXG4gICAgYmxhbms6ICAgICAgICAgIGJsYW5rLFxuICAgIGludGVycG9sYXRlOiAgICBpbnRlcnBvbGF0ZVxuICB9O1xufSkoKSk7XG5cbnZhciBUZW1wbGF0ZSA9IENsYXNzLmNyZWF0ZSh7XG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKHRlbXBsYXRlLCBwYXR0ZXJuKSB7XG4gICAgdGhpcy50ZW1wbGF0ZSA9IHRlbXBsYXRlLnRvU3RyaW5nKCk7XG4gICAgdGhpcy5wYXR0ZXJuID0gcGF0dGVybiB8fCBUZW1wbGF0ZS5QYXR0ZXJuO1xuICB9LFxuXG4gIGV2YWx1YXRlOiBmdW5jdGlvbihvYmplY3QpIHtcbiAgICBpZiAob2JqZWN0ICYmIE9iamVjdC5pc0Z1bmN0aW9uKG9iamVjdC50b1RlbXBsYXRlUmVwbGFjZW1lbnRzKSlcbiAgICAgIG9iamVjdCA9IG9iamVjdC50b1RlbXBsYXRlUmVwbGFjZW1lbnRzKCk7XG5cbiAgICByZXR1cm4gdGhpcy50ZW1wbGF0ZS5nc3ViKHRoaXMucGF0dGVybiwgZnVuY3Rpb24obWF0Y2gpIHtcbiAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkgcmV0dXJuIChtYXRjaFsxXSArICcnKTtcblxuICAgICAgdmFyIGJlZm9yZSA9IG1hdGNoWzFdIHx8ICcnO1xuICAgICAgaWYgKGJlZm9yZSA9PSAnXFxcXCcpIHJldHVybiBtYXRjaFsyXTtcblxuICAgICAgdmFyIGN0eCA9IG9iamVjdCwgZXhwciA9IG1hdGNoWzNdLFxuICAgICAgICAgIHBhdHRlcm4gPSAvXihbXi5bXSt8XFxbKCg/Oi4qP1teXFxcXF0pPylcXF0pKFxcLnxcXFt8JCkvO1xuXG4gICAgICBtYXRjaCA9IHBhdHRlcm4uZXhlYyhleHByKTtcbiAgICAgIGlmIChtYXRjaCA9PSBudWxsKSByZXR1cm4gYmVmb3JlO1xuXG4gICAgICB3aGlsZSAobWF0Y2ggIT0gbnVsbCkge1xuICAgICAgICB2YXIgY29tcCA9IG1hdGNoWzFdLnN0YXJ0c1dpdGgoJ1snKSA/IG1hdGNoWzJdLnJlcGxhY2UoL1xcXFxcXFxcXS9nLCAnXScpIDogbWF0Y2hbMV07XG4gICAgICAgIGN0eCA9IGN0eFtjb21wXTtcbiAgICAgICAgaWYgKG51bGwgPT0gY3R4IHx8ICcnID09IG1hdGNoWzNdKSBicmVhaztcbiAgICAgICAgZXhwciA9IGV4cHIuc3Vic3RyaW5nKCdbJyA9PSBtYXRjaFszXSA/IG1hdGNoWzFdLmxlbmd0aCA6IG1hdGNoWzBdLmxlbmd0aCk7XG4gICAgICAgIG1hdGNoID0gcGF0dGVybi5leGVjKGV4cHIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYmVmb3JlICsgU3RyaW5nLmludGVycHJldChjdHgpO1xuICAgIH0pO1xuICB9XG59KTtcblRlbXBsYXRlLlBhdHRlcm4gPSAvKF58LnxcXHJ8XFxuKSgjXFx7KC4qPylcXH0pLztcblxudmFyICRicmVhayA9IHsgfTtcblxudmFyIEVudW1lcmFibGUgPSAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIGVhY2goaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5fZWFjaChpdGVyYXRvciwgY29udGV4dCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgaWYgKGUgIT0gJGJyZWFrKSB0aHJvdyBlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGZ1bmN0aW9uIGVhY2hTbGljZShudW1iZXIsIGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgdmFyIGluZGV4ID0gLW51bWJlciwgc2xpY2VzID0gW10sIGFycmF5ID0gdGhpcy50b0FycmF5KCk7XG4gICAgaWYgKG51bWJlciA8IDEpIHJldHVybiBhcnJheTtcbiAgICB3aGlsZSAoKGluZGV4ICs9IG51bWJlcikgPCBhcnJheS5sZW5ndGgpXG4gICAgICBzbGljZXMucHVzaChhcnJheS5zbGljZShpbmRleCwgaW5kZXgrbnVtYmVyKSk7XG4gICAgcmV0dXJuIHNsaWNlcy5jb2xsZWN0KGl0ZXJhdG9yLCBjb250ZXh0KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFsbChpdGVyYXRvciwgY29udGV4dCkge1xuICAgIGl0ZXJhdG9yID0gaXRlcmF0b3IgfHwgUHJvdG90eXBlLks7XG4gICAgdmFyIHJlc3VsdCA9IHRydWU7XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkge1xuICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmICEhaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIHRoaXMpO1xuICAgICAgaWYgKCFyZXN1bHQpIHRocm93ICRicmVhaztcbiAgICB9LCB0aGlzKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgZnVuY3Rpb24gYW55KGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgaXRlcmF0b3IgPSBpdGVyYXRvciB8fCBQcm90b3R5cGUuSztcbiAgICB2YXIgcmVzdWx0ID0gZmFsc2U7XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkge1xuICAgICAgaWYgKHJlc3VsdCA9ICEhaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIHRoaXMpKVxuICAgICAgICB0aHJvdyAkYnJlYWs7XG4gICAgfSwgdGhpcyk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNvbGxlY3QoaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LO1xuICAgIHZhciByZXN1bHRzID0gW107XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkge1xuICAgICAgcmVzdWx0cy5wdXNoKGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCB0aGlzKSk7XG4gICAgfSwgdGhpcyk7XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICBmdW5jdGlvbiBkZXRlY3QoaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICB2YXIgcmVzdWx0O1xuICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIGlmIChpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgdGhpcykpIHtcbiAgICAgICAgcmVzdWx0ID0gdmFsdWU7XG4gICAgICAgIHRocm93ICRicmVhaztcbiAgICAgIH1cbiAgICB9LCB0aGlzKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgZnVuY3Rpb24gZmluZEFsbChpdGVyYXRvciwgY29udGV4dCkge1xuICAgIHZhciByZXN1bHRzID0gW107XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkge1xuICAgICAgaWYgKGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCB0aGlzKSlcbiAgICAgICAgcmVzdWx0cy5wdXNoKHZhbHVlKTtcbiAgICB9LCB0aGlzKTtcbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIGZ1bmN0aW9uIGdyZXAoZmlsdGVyLCBpdGVyYXRvciwgY29udGV4dCkge1xuICAgIGl0ZXJhdG9yID0gaXRlcmF0b3IgfHwgUHJvdG90eXBlLks7XG4gICAgdmFyIHJlc3VsdHMgPSBbXTtcblxuICAgIGlmIChPYmplY3QuaXNTdHJpbmcoZmlsdGVyKSlcbiAgICAgIGZpbHRlciA9IG5ldyBSZWdFeHAoUmVnRXhwLmVzY2FwZShmaWx0ZXIpKTtcblxuICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIGlmIChmaWx0ZXIubWF0Y2godmFsdWUpKVxuICAgICAgICByZXN1bHRzLnB1c2goaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIHRoaXMpKTtcbiAgICB9LCB0aGlzKTtcbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIGZ1bmN0aW9uIGluY2x1ZGUob2JqZWN0KSB7XG4gICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKHRoaXMuaW5kZXhPZikgJiYgdGhpcy5pbmRleE9mKG9iamVjdCkgIT0gLTEpXG4gICAgICByZXR1cm4gdHJ1ZTtcblxuICAgIHZhciBmb3VuZCA9IGZhbHNlO1xuICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKHZhbHVlID09IG9iamVjdCkge1xuICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgIHRocm93ICRicmVhaztcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gZm91bmQ7XG4gIH1cblxuICBmdW5jdGlvbiBpbkdyb3Vwc09mKG51bWJlciwgZmlsbFdpdGgpIHtcbiAgICBmaWxsV2l0aCA9IE9iamVjdC5pc1VuZGVmaW5lZChmaWxsV2l0aCkgPyBudWxsIDogZmlsbFdpdGg7XG4gICAgcmV0dXJuIHRoaXMuZWFjaFNsaWNlKG51bWJlciwgZnVuY3Rpb24oc2xpY2UpIHtcbiAgICAgIHdoaWxlKHNsaWNlLmxlbmd0aCA8IG51bWJlcikgc2xpY2UucHVzaChmaWxsV2l0aCk7XG4gICAgICByZXR1cm4gc2xpY2U7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBpbmplY3QobWVtbywgaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICB0aGlzLmVhY2goZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7XG4gICAgICBtZW1vID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCBtZW1vLCB2YWx1ZSwgaW5kZXgsIHRoaXMpO1xuICAgIH0sIHRoaXMpO1xuICAgIHJldHVybiBtZW1vO1xuICB9XG5cbiAgZnVuY3Rpb24gaW52b2tlKG1ldGhvZCkge1xuICAgIHZhciBhcmdzID0gJEEoYXJndW1lbnRzKS5zbGljZSgxKTtcbiAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIHJldHVybiB2YWx1ZVttZXRob2RdLmFwcGx5KHZhbHVlLCBhcmdzKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1heChpdGVyYXRvciwgY29udGV4dCkge1xuICAgIGl0ZXJhdG9yID0gaXRlcmF0b3IgfHwgUHJvdG90eXBlLks7XG4gICAgdmFyIHJlc3VsdDtcbiAgICB0aGlzLmVhY2goZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7XG4gICAgICB2YWx1ZSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCB0aGlzKTtcbiAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCB8fCB2YWx1ZSA+PSByZXN1bHQpXG4gICAgICAgIHJlc3VsdCA9IHZhbHVlO1xuICAgIH0sIHRoaXMpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBmdW5jdGlvbiBtaW4oaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LO1xuICAgIHZhciByZXN1bHQ7XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkge1xuICAgICAgdmFsdWUgPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgdGhpcyk7XG4gICAgICBpZiAocmVzdWx0ID09IG51bGwgfHwgdmFsdWUgPCByZXN1bHQpXG4gICAgICAgIHJlc3VsdCA9IHZhbHVlO1xuICAgIH0sIHRoaXMpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJ0aXRpb24oaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LO1xuICAgIHZhciB0cnVlcyA9IFtdLCBmYWxzZXMgPSBbXTtcbiAgICB0aGlzLmVhY2goZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7XG4gICAgICAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIHRoaXMpID9cbiAgICAgICAgdHJ1ZXMgOiBmYWxzZXMpLnB1c2godmFsdWUpO1xuICAgIH0sIHRoaXMpO1xuICAgIHJldHVybiBbdHJ1ZXMsIGZhbHNlc107XG4gIH1cblxuICBmdW5jdGlvbiBwbHVjayhwcm9wZXJ0eSkge1xuICAgIHZhciByZXN1bHRzID0gW107XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXN1bHRzLnB1c2godmFsdWVbcHJvcGVydHldKTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlamVjdChpdGVyYXRvciwgY29udGV4dCkge1xuICAgIHZhciByZXN1bHRzID0gW107XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkge1xuICAgICAgaWYgKCFpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgdGhpcykpXG4gICAgICAgIHJlc3VsdHMucHVzaCh2YWx1ZSk7XG4gICAgfSwgdGhpcyk7XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICBmdW5jdGlvbiBzb3J0QnkoaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgIGNyaXRlcmlhOiBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgdGhpcylcbiAgICAgIH07XG4gICAgfSwgdGhpcykuc29ydChmdW5jdGlvbihsZWZ0LCByaWdodCkge1xuICAgICAgdmFyIGEgPSBsZWZ0LmNyaXRlcmlhLCBiID0gcmlnaHQuY3JpdGVyaWE7XG4gICAgICByZXR1cm4gYSA8IGIgPyAtMSA6IGEgPiBiID8gMSA6IDA7XG4gICAgfSkucGx1Y2soJ3ZhbHVlJyk7XG4gIH1cblxuICBmdW5jdGlvbiB0b0FycmF5KCkge1xuICAgIHJldHVybiB0aGlzLm1hcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gemlwKCkge1xuICAgIHZhciBpdGVyYXRvciA9IFByb3RvdHlwZS5LLCBhcmdzID0gJEEoYXJndW1lbnRzKTtcbiAgICBpZiAoT2JqZWN0LmlzRnVuY3Rpb24oYXJncy5sYXN0KCkpKVxuICAgICAgaXRlcmF0b3IgPSBhcmdzLnBvcCgpO1xuXG4gICAgdmFyIGNvbGxlY3Rpb25zID0gW3RoaXNdLmNvbmNhdChhcmdzKS5tYXAoJEEpO1xuICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIHJldHVybiBpdGVyYXRvcihjb2xsZWN0aW9ucy5wbHVjayhpbmRleCkpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2l6ZSgpIHtcbiAgICByZXR1cm4gdGhpcy50b0FycmF5KCkubGVuZ3RoO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5zcGVjdCgpIHtcbiAgICByZXR1cm4gJyM8RW51bWVyYWJsZTonICsgdGhpcy50b0FycmF5KCkuaW5zcGVjdCgpICsgJz4nO1xuICB9XG5cblxuXG5cblxuXG5cblxuXG4gIHJldHVybiB7XG4gICAgZWFjaDogICAgICAgZWFjaCxcbiAgICBlYWNoU2xpY2U6ICBlYWNoU2xpY2UsXG4gICAgYWxsOiAgICAgICAgYWxsLFxuICAgIGV2ZXJ5OiAgICAgIGFsbCxcbiAgICBhbnk6ICAgICAgICBhbnksXG4gICAgc29tZTogICAgICAgYW55LFxuICAgIGNvbGxlY3Q6ICAgIGNvbGxlY3QsXG4gICAgbWFwOiAgICAgICAgY29sbGVjdCxcbiAgICBkZXRlY3Q6ICAgICBkZXRlY3QsXG4gICAgZmluZEFsbDogICAgZmluZEFsbCxcbiAgICBzZWxlY3Q6ICAgICBmaW5kQWxsLFxuICAgIGZpbHRlcjogICAgIGZpbmRBbGwsXG4gICAgZ3JlcDogICAgICAgZ3JlcCxcbiAgICBpbmNsdWRlOiAgICBpbmNsdWRlLFxuICAgIG1lbWJlcjogICAgIGluY2x1ZGUsXG4gICAgaW5Hcm91cHNPZjogaW5Hcm91cHNPZixcbiAgICBpbmplY3Q6ICAgICBpbmplY3QsXG4gICAgaW52b2tlOiAgICAgaW52b2tlLFxuICAgIG1heDogICAgICAgIG1heCxcbiAgICBtaW46ICAgICAgICBtaW4sXG4gICAgcGFydGl0aW9uOiAgcGFydGl0aW9uLFxuICAgIHBsdWNrOiAgICAgIHBsdWNrLFxuICAgIHJlamVjdDogICAgIHJlamVjdCxcbiAgICBzb3J0Qnk6ICAgICBzb3J0QnksXG4gICAgdG9BcnJheTogICAgdG9BcnJheSxcbiAgICBlbnRyaWVzOiAgICB0b0FycmF5LFxuICAgIHppcDogICAgICAgIHppcCxcbiAgICBzaXplOiAgICAgICBzaXplLFxuICAgIGluc3BlY3Q6ICAgIGluc3BlY3QsXG4gICAgZmluZDogICAgICAgZGV0ZWN0XG4gIH07XG59KSgpO1xuXG5mdW5jdGlvbiAkQShpdGVyYWJsZSkge1xuICBpZiAoIWl0ZXJhYmxlKSByZXR1cm4gW107XG4gIGlmICgndG9BcnJheScgaW4gT2JqZWN0KGl0ZXJhYmxlKSkgcmV0dXJuIGl0ZXJhYmxlLnRvQXJyYXkoKTtcbiAgdmFyIGxlbmd0aCA9IGl0ZXJhYmxlLmxlbmd0aCB8fCAwLCByZXN1bHRzID0gbmV3IEFycmF5KGxlbmd0aCk7XG4gIHdoaWxlIChsZW5ndGgtLSkgcmVzdWx0c1tsZW5ndGhdID0gaXRlcmFibGVbbGVuZ3RoXTtcbiAgcmV0dXJuIHJlc3VsdHM7XG59XG5cblxuZnVuY3Rpb24gJHcoc3RyaW5nKSB7XG4gIGlmICghT2JqZWN0LmlzU3RyaW5nKHN0cmluZykpIHJldHVybiBbXTtcbiAgc3RyaW5nID0gc3RyaW5nLnN0cmlwKCk7XG4gIHJldHVybiBzdHJpbmcgPyBzdHJpbmcuc3BsaXQoL1xccysvKSA6IFtdO1xufVxuXG5BcnJheS5mcm9tID0gJEE7XG5cblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgYXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSxcbiAgICAgIHNsaWNlID0gYXJyYXlQcm90by5zbGljZSxcbiAgICAgIF9lYWNoID0gYXJyYXlQcm90by5mb3JFYWNoOyAvLyB1c2UgbmF0aXZlIGJyb3dzZXIgSlMgMS42IGltcGxlbWVudGF0aW9uIGlmIGF2YWlsYWJsZVxuXG4gIGZ1bmN0aW9uIGVhY2goaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gdGhpcy5sZW5ndGggPj4+IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGkgaW4gdGhpcykgaXRlcmF0b3IuY2FsbChjb250ZXh0LCB0aGlzW2ldLCBpLCB0aGlzKTtcbiAgICB9XG4gIH1cbiAgaWYgKCFfZWFjaCkgX2VhY2ggPSBlYWNoO1xuXG4gIGZ1bmN0aW9uIGNsZWFyKCkge1xuICAgIHRoaXMubGVuZ3RoID0gMDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpcnN0KCkge1xuICAgIHJldHVybiB0aGlzWzBdO1xuICB9XG5cbiAgZnVuY3Rpb24gbGFzdCgpIHtcbiAgICByZXR1cm4gdGhpc1t0aGlzLmxlbmd0aCAtIDFdO1xuICB9XG5cbiAgZnVuY3Rpb24gY29tcGFjdCgpIHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3QoZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIHJldHVybiB2YWx1ZSAhPSBudWxsO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZmxhdHRlbigpIHtcbiAgICByZXR1cm4gdGhpcy5pbmplY3QoW10sIGZ1bmN0aW9uKGFycmF5LCB2YWx1ZSkge1xuICAgICAgaWYgKE9iamVjdC5pc0FycmF5KHZhbHVlKSlcbiAgICAgICAgcmV0dXJuIGFycmF5LmNvbmNhdCh2YWx1ZS5mbGF0dGVuKCkpO1xuICAgICAgYXJyYXkucHVzaCh2YWx1ZSk7XG4gICAgICByZXR1cm4gYXJyYXk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiB3aXRob3V0KCkge1xuICAgIHZhciB2YWx1ZXMgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0KGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXR1cm4gIXZhbHVlcy5pbmNsdWRlKHZhbHVlKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJldmVyc2UoaW5saW5lKSB7XG4gICAgcmV0dXJuIChpbmxpbmUgPT09IGZhbHNlID8gdGhpcy50b0FycmF5KCkgOiB0aGlzKS5fcmV2ZXJzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gdW5pcShzb3J0ZWQpIHtcbiAgICByZXR1cm4gdGhpcy5pbmplY3QoW10sIGZ1bmN0aW9uKGFycmF5LCB2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIGlmICgwID09IGluZGV4IHx8IChzb3J0ZWQgPyBhcnJheS5sYXN0KCkgIT0gdmFsdWUgOiAhYXJyYXkuaW5jbHVkZSh2YWx1ZSkpKVxuICAgICAgICBhcnJheS5wdXNoKHZhbHVlKTtcbiAgICAgIHJldHVybiBhcnJheTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGludGVyc2VjdChhcnJheSkge1xuICAgIHJldHVybiB0aGlzLnVuaXEoKS5maW5kQWxsKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIHJldHVybiBhcnJheS5pbmRleE9mKGl0ZW0pICE9PSAtMTtcbiAgICB9KTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gY2xvbmUoKSB7XG4gICAgcmV0dXJuIHNsaWNlLmNhbGwodGhpcywgMCk7XG4gIH1cblxuICBmdW5jdGlvbiBzaXplKCkge1xuICAgIHJldHVybiB0aGlzLmxlbmd0aDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluc3BlY3QoKSB7XG4gICAgcmV0dXJuICdbJyArIHRoaXMubWFwKE9iamVjdC5pbnNwZWN0KS5qb2luKCcsICcpICsgJ10nO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5kZXhPZihpdGVtLCBpKSB7XG4gICAgaWYgKHRoaXMgPT0gbnVsbCkgdGhyb3cgbmV3IFR5cGVFcnJvcigpO1xuXG4gICAgdmFyIGFycmF5ID0gT2JqZWN0KHRoaXMpLCBsZW5ndGggPSBhcnJheS5sZW5ndGggPj4+IDA7XG4gICAgaWYgKGxlbmd0aCA9PT0gMCkgcmV0dXJuIC0xO1xuXG4gICAgaSA9IE51bWJlcihpKTtcbiAgICBpZiAoaXNOYU4oaSkpIHtcbiAgICAgIGkgPSAwO1xuICAgIH0gZWxzZSBpZiAoaSAhPT0gMCAmJiBpc0Zpbml0ZShpKSkge1xuICAgICAgaSA9IChpID4gMCA/IDEgOiAtMSkgKiBNYXRoLmZsb29yKE1hdGguYWJzKGkpKTtcbiAgICB9XG5cbiAgICBpZiAoaSA+IGxlbmd0aCkgcmV0dXJuIC0xO1xuXG4gICAgdmFyIGsgPSBpID49IDAgPyBpIDogTWF0aC5tYXgobGVuZ3RoIC0gTWF0aC5hYnMoaSksIDApO1xuICAgIGZvciAoOyBrIDwgbGVuZ3RoOyBrKyspXG4gICAgICBpZiAoayBpbiBhcnJheSAmJiBhcnJheVtrXSA9PT0gaXRlbSkgcmV0dXJuIGs7XG4gICAgcmV0dXJuIC0xO1xuICB9XG5cblxuICBmdW5jdGlvbiBsYXN0SW5kZXhPZihpdGVtLCBpKSB7XG4gICAgaWYgKHRoaXMgPT0gbnVsbCkgdGhyb3cgbmV3IFR5cGVFcnJvcigpO1xuXG4gICAgdmFyIGFycmF5ID0gT2JqZWN0KHRoaXMpLCBsZW5ndGggPSBhcnJheS5sZW5ndGggPj4+IDA7XG4gICAgaWYgKGxlbmd0aCA9PT0gMCkgcmV0dXJuIC0xO1xuXG4gICAgaWYgKCFPYmplY3QuaXNVbmRlZmluZWQoaSkpIHtcbiAgICAgIGkgPSBOdW1iZXIoaSk7XG4gICAgICBpZiAoaXNOYU4oaSkpIHtcbiAgICAgICAgaSA9IDA7XG4gICAgICB9IGVsc2UgaWYgKGkgIT09IDAgJiYgaXNGaW5pdGUoaSkpIHtcbiAgICAgICAgaSA9IChpID4gMCA/IDEgOiAtMSkgKiBNYXRoLmZsb29yKE1hdGguYWJzKGkpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaSA9IGxlbmd0aDtcbiAgICB9XG5cbiAgICB2YXIgayA9IGkgPj0gMCA/IE1hdGgubWluKGksIGxlbmd0aCAtIDEpIDpcbiAgICAgbGVuZ3RoIC0gTWF0aC5hYnMoaSk7XG5cbiAgICBmb3IgKDsgayA+PSAwOyBrLS0pXG4gICAgICBpZiAoayBpbiBhcnJheSAmJiBhcnJheVtrXSA9PT0gaXRlbSkgcmV0dXJuIGs7XG4gICAgcmV0dXJuIC0xO1xuICB9XG5cbiAgZnVuY3Rpb24gY29uY2F0KF8pIHtcbiAgICB2YXIgYXJyYXkgPSBbXSwgaXRlbXMgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMCksIGl0ZW0sIG4gPSAwO1xuICAgIGl0ZW1zLnVuc2hpZnQodGhpcyk7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGl0ZW1zLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBpdGVtID0gaXRlbXNbaV07XG4gICAgICBpZiAoT2JqZWN0LmlzQXJyYXkoaXRlbSkgJiYgISgnY2FsbGVlJyBpbiBpdGVtKSkge1xuICAgICAgICBmb3IgKHZhciBqID0gMCwgYXJyYXlMZW5ndGggPSBpdGVtLmxlbmd0aDsgaiA8IGFycmF5TGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICBpZiAoaiBpbiBpdGVtKSBhcnJheVtuXSA9IGl0ZW1bal07XG4gICAgICAgICAgbisrO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhcnJheVtuKytdID0gaXRlbTtcbiAgICAgIH1cbiAgICB9XG4gICAgYXJyYXkubGVuZ3RoID0gbjtcbiAgICByZXR1cm4gYXJyYXk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHdyYXBOYXRpdmUobWV0aG9kKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIG1ldGhvZC5jYWxsKHRoaXMsIFByb3RvdHlwZS5LKTtcbiAgICAgIH0gZWxzZSBpZiAoYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgICAgIGFyZ3MudW5zaGlmdChQcm90b3R5cGUuSyk7XG4gICAgICAgIHJldHVybiBtZXRob2QuYXBwbHkodGhpcywgYXJncyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gbWFwKGl0ZXJhdG9yKSB7XG4gICAgaWYgKHRoaXMgPT0gbnVsbCkgdGhyb3cgbmV3IFR5cGVFcnJvcigpO1xuICAgIGl0ZXJhdG9yID0gaXRlcmF0b3IgfHwgUHJvdG90eXBlLks7XG5cbiAgICB2YXIgb2JqZWN0ID0gT2JqZWN0KHRoaXMpO1xuICAgIHZhciByZXN1bHRzID0gW10sIGNvbnRleHQgPSBhcmd1bWVudHNbMV0sIG4gPSAwO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IG9iamVjdC5sZW5ndGggPj4+IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGkgaW4gb2JqZWN0KSB7XG4gICAgICAgIHJlc3VsdHNbbl0gPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9iamVjdFtpXSwgaSwgb2JqZWN0KTtcbiAgICAgIH1cbiAgICAgIG4rKztcbiAgICB9XG4gICAgcmVzdWx0cy5sZW5ndGggPSBuO1xuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG5cbiAgaWYgKGFycmF5UHJvdG8ubWFwKSB7XG4gICAgbWFwID0gd3JhcE5hdGl2ZShBcnJheS5wcm90b3R5cGUubWFwKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbHRlcihpdGVyYXRvcikge1xuICAgIGlmICh0aGlzID09IG51bGwgfHwgIU9iamVjdC5pc0Z1bmN0aW9uKGl0ZXJhdG9yKSlcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoKTtcblxuICAgIHZhciBvYmplY3QgPSBPYmplY3QodGhpcyk7XG4gICAgdmFyIHJlc3VsdHMgPSBbXSwgY29udGV4dCA9IGFyZ3VtZW50c1sxXSwgdmFsdWU7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gb2JqZWN0Lmxlbmd0aCA+Pj4gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoaSBpbiBvYmplY3QpIHtcbiAgICAgICAgdmFsdWUgPSBvYmplY3RbaV07XG4gICAgICAgIGlmIChpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpLCBvYmplY3QpKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIGlmIChhcnJheVByb3RvLmZpbHRlcikge1xuICAgIGZpbHRlciA9IEFycmF5LnByb3RvdHlwZS5maWx0ZXI7XG4gIH1cblxuICBmdW5jdGlvbiBzb21lKGl0ZXJhdG9yKSB7XG4gICAgaWYgKHRoaXMgPT0gbnVsbCkgdGhyb3cgbmV3IFR5cGVFcnJvcigpO1xuICAgIGl0ZXJhdG9yID0gaXRlcmF0b3IgfHwgUHJvdG90eXBlLks7XG4gICAgdmFyIGNvbnRleHQgPSBhcmd1bWVudHNbMV07XG5cbiAgICB2YXIgb2JqZWN0ID0gT2JqZWN0KHRoaXMpO1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBvYmplY3QubGVuZ3RoID4+PiAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChpIGluIG9iamVjdCAmJiBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9iamVjdFtpXSwgaSwgb2JqZWN0KSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoYXJyYXlQcm90by5zb21lKSB7XG4gICAgdmFyIHNvbWUgPSB3cmFwTmF0aXZlKEFycmF5LnByb3RvdHlwZS5zb21lKTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gZXZlcnkoaXRlcmF0b3IpIHtcbiAgICBpZiAodGhpcyA9PSBudWxsKSB0aHJvdyBuZXcgVHlwZUVycm9yKCk7XG4gICAgaXRlcmF0b3IgPSBpdGVyYXRvciB8fCBQcm90b3R5cGUuSztcbiAgICB2YXIgY29udGV4dCA9IGFyZ3VtZW50c1sxXTtcblxuICAgIHZhciBvYmplY3QgPSBPYmplY3QodGhpcyk7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IG9iamVjdC5sZW5ndGggPj4+IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGkgaW4gb2JqZWN0ICYmICFpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9iamVjdFtpXSwgaSwgb2JqZWN0KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBpZiAoYXJyYXlQcm90by5ldmVyeSkge1xuICAgIHZhciBldmVyeSA9IHdyYXBOYXRpdmUoQXJyYXkucHJvdG90eXBlLmV2ZXJ5KTtcbiAgfVxuXG4gIHZhciBfcmVkdWNlID0gYXJyYXlQcm90by5yZWR1Y2U7XG4gIGZ1bmN0aW9uIGluamVjdChtZW1vLCBpdGVyYXRvcikge1xuICAgIGl0ZXJhdG9yID0gaXRlcmF0b3IgfHwgUHJvdG90eXBlLks7XG4gICAgdmFyIGNvbnRleHQgPSBhcmd1bWVudHNbMl07XG4gICAgcmV0dXJuIF9yZWR1Y2UuY2FsbCh0aGlzLCBpdGVyYXRvci5iaW5kKGNvbnRleHQpLCBtZW1vKTtcbiAgfVxuXG4gIGlmICghYXJyYXlQcm90by5yZWR1Y2UpIHtcbiAgICB2YXIgaW5qZWN0ID0gRW51bWVyYWJsZS5pbmplY3Q7XG4gIH1cblxuICBPYmplY3QuZXh0ZW5kKGFycmF5UHJvdG8sIEVudW1lcmFibGUpO1xuXG4gIGlmICghYXJyYXlQcm90by5fcmV2ZXJzZSlcbiAgICBhcnJheVByb3RvLl9yZXZlcnNlID0gYXJyYXlQcm90by5yZXZlcnNlO1xuXG4gIE9iamVjdC5leHRlbmQoYXJyYXlQcm90bywge1xuICAgIF9lYWNoOiAgICAgX2VhY2gsXG5cbiAgICBtYXA6ICAgICAgIG1hcCxcbiAgICBjb2xsZWN0OiAgIG1hcCxcbiAgICBzZWxlY3Q6ICAgIGZpbHRlcixcbiAgICBmaWx0ZXI6ICAgIGZpbHRlcixcbiAgICBmaW5kQWxsOiAgIGZpbHRlcixcbiAgICBzb21lOiAgICAgIHNvbWUsXG4gICAgYW55OiAgICAgICBzb21lLFxuICAgIGV2ZXJ5OiAgICAgZXZlcnksXG4gICAgYWxsOiAgICAgICBldmVyeSxcbiAgICBpbmplY3Q6ICAgIGluamVjdCxcblxuICAgIGNsZWFyOiAgICAgY2xlYXIsXG4gICAgZmlyc3Q6ICAgICBmaXJzdCxcbiAgICBsYXN0OiAgICAgIGxhc3QsXG4gICAgY29tcGFjdDogICBjb21wYWN0LFxuICAgIGZsYXR0ZW46ICAgZmxhdHRlbixcbiAgICB3aXRob3V0OiAgIHdpdGhvdXQsXG4gICAgcmV2ZXJzZTogICByZXZlcnNlLFxuICAgIHVuaXE6ICAgICAgdW5pcSxcbiAgICBpbnRlcnNlY3Q6IGludGVyc2VjdCxcbiAgICBjbG9uZTogICAgIGNsb25lLFxuICAgIHRvQXJyYXk6ICAgY2xvbmUsXG4gICAgc2l6ZTogICAgICBzaXplLFxuICAgIGluc3BlY3Q6ICAgaW5zcGVjdFxuICB9KTtcblxuICB2YXIgQ09OQ0FUX0FSR1VNRU5UU19CVUdHWSA9IChmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gW10uY29uY2F0KGFyZ3VtZW50cylbMF1bMF0gIT09IDE7XG4gIH0pKDEsMik7XG5cbiAgaWYgKENPTkNBVF9BUkdVTUVOVFNfQlVHR1kpIGFycmF5UHJvdG8uY29uY2F0ID0gY29uY2F0O1xuXG4gIGlmICghYXJyYXlQcm90by5pbmRleE9mKSBhcnJheVByb3RvLmluZGV4T2YgPSBpbmRleE9mO1xuICBpZiAoIWFycmF5UHJvdG8ubGFzdEluZGV4T2YpIGFycmF5UHJvdG8ubGFzdEluZGV4T2YgPSBsYXN0SW5kZXhPZjtcbn0pKCk7XG5mdW5jdGlvbiAkSChvYmplY3QpIHtcbiAgcmV0dXJuIG5ldyBIYXNoKG9iamVjdCk7XG59O1xuXG52YXIgSGFzaCA9IENsYXNzLmNyZWF0ZShFbnVtZXJhYmxlLCAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIGluaXRpYWxpemUob2JqZWN0KSB7XG4gICAgdGhpcy5fb2JqZWN0ID0gT2JqZWN0LmlzSGFzaChvYmplY3QpID8gb2JqZWN0LnRvT2JqZWN0KCkgOiBPYmplY3QuY2xvbmUob2JqZWN0KTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gX2VhY2goaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICB2YXIgaSA9IDA7XG4gICAgZm9yICh2YXIga2V5IGluIHRoaXMuX29iamVjdCkge1xuICAgICAgdmFyIHZhbHVlID0gdGhpcy5fb2JqZWN0W2tleV0sIHBhaXIgPSBba2V5LCB2YWx1ZV07XG4gICAgICBwYWlyLmtleSA9IGtleTtcbiAgICAgIHBhaXIudmFsdWUgPSB2YWx1ZTtcbiAgICAgIGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgcGFpciwgaSk7XG4gICAgICBpKys7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUpIHtcbiAgICByZXR1cm4gdGhpcy5fb2JqZWN0W2tleV0gPSB2YWx1ZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldChrZXkpIHtcbiAgICBpZiAodGhpcy5fb2JqZWN0W2tleV0gIT09IE9iamVjdC5wcm90b3R5cGVba2V5XSlcbiAgICAgIHJldHVybiB0aGlzLl9vYmplY3Rba2V5XTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVuc2V0KGtleSkge1xuICAgIHZhciB2YWx1ZSA9IHRoaXMuX29iamVjdFtrZXldO1xuICAgIGRlbGV0ZSB0aGlzLl9vYmplY3Rba2V5XTtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICBmdW5jdGlvbiB0b09iamVjdCgpIHtcbiAgICByZXR1cm4gT2JqZWN0LmNsb25lKHRoaXMuX29iamVjdCk7XG4gIH1cblxuXG5cbiAgZnVuY3Rpb24ga2V5cygpIHtcbiAgICByZXR1cm4gdGhpcy5wbHVjaygna2V5Jyk7XG4gIH1cblxuICBmdW5jdGlvbiB2YWx1ZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMucGx1Y2soJ3ZhbHVlJyk7XG4gIH1cblxuICBmdW5jdGlvbiBpbmRleCh2YWx1ZSkge1xuICAgIHZhciBtYXRjaCA9IHRoaXMuZGV0ZWN0KGZ1bmN0aW9uKHBhaXIpIHtcbiAgICAgIHJldHVybiBwYWlyLnZhbHVlID09PSB2YWx1ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gbWF0Y2ggJiYgbWF0Y2gua2V5O1xuICB9XG5cbiAgZnVuY3Rpb24gbWVyZ2Uob2JqZWN0KSB7XG4gICAgcmV0dXJuIHRoaXMuY2xvbmUoKS51cGRhdGUob2JqZWN0KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZShvYmplY3QpIHtcbiAgICByZXR1cm4gbmV3IEhhc2gob2JqZWN0KS5pbmplY3QodGhpcywgZnVuY3Rpb24ocmVzdWx0LCBwYWlyKSB7XG4gICAgICByZXN1bHQuc2V0KHBhaXIua2V5LCBwYWlyLnZhbHVlKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiB0b1F1ZXJ5UGFpcihrZXksIHZhbHVlKSB7XG4gICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZCh2YWx1ZSkpIHJldHVybiBrZXk7XG5cbiAgICB2YWx1ZSA9IFN0cmluZy5pbnRlcnByZXQodmFsdWUpO1xuXG4gICAgdmFsdWUgPSB2YWx1ZS5nc3ViKC8oXFxyKT9cXG4vLCAnXFxyXFxuJyk7XG4gICAgdmFsdWUgPSBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpO1xuICAgIHZhbHVlID0gdmFsdWUuZ3N1YigvJTIwLywgJysnKTtcbiAgICByZXR1cm4ga2V5ICsgJz0nICsgdmFsdWU7XG4gIH1cblxuICBmdW5jdGlvbiB0b1F1ZXJ5U3RyaW5nKCkge1xuICAgIHJldHVybiB0aGlzLmluamVjdChbXSwgZnVuY3Rpb24ocmVzdWx0cywgcGFpcikge1xuICAgICAgdmFyIGtleSA9IGVuY29kZVVSSUNvbXBvbmVudChwYWlyLmtleSksIHZhbHVlcyA9IHBhaXIudmFsdWU7XG5cbiAgICAgIGlmICh2YWx1ZXMgJiYgdHlwZW9mIHZhbHVlcyA9PSAnb2JqZWN0Jykge1xuICAgICAgICBpZiAoT2JqZWN0LmlzQXJyYXkodmFsdWVzKSkge1xuICAgICAgICAgIHZhciBxdWVyeVZhbHVlcyA9IFtdO1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB2YWx1ZXMubGVuZ3RoLCB2YWx1ZTsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlc1tpXTtcbiAgICAgICAgICAgIHF1ZXJ5VmFsdWVzLnB1c2godG9RdWVyeVBhaXIoa2V5LCB2YWx1ZSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcmVzdWx0cy5jb25jYXQocXVlcnlWYWx1ZXMpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgcmVzdWx0cy5wdXNoKHRvUXVlcnlQYWlyKGtleSwgdmFsdWVzKSk7XG4gICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9KS5qb2luKCcmJyk7XG4gIH1cblxuICBmdW5jdGlvbiBpbnNwZWN0KCkge1xuICAgIHJldHVybiAnIzxIYXNoOnsnICsgdGhpcy5tYXAoZnVuY3Rpb24ocGFpcikge1xuICAgICAgcmV0dXJuIHBhaXIubWFwKE9iamVjdC5pbnNwZWN0KS5qb2luKCc6ICcpO1xuICAgIH0pLmpvaW4oJywgJykgKyAnfT4nO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xvbmUoKSB7XG4gICAgcmV0dXJuIG5ldyBIYXNoKHRoaXMpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBpbml0aWFsaXplOiAgICAgICAgICAgICBpbml0aWFsaXplLFxuICAgIF9lYWNoOiAgICAgICAgICAgICAgICAgIF9lYWNoLFxuICAgIHNldDogICAgICAgICAgICAgICAgICAgIHNldCxcbiAgICBnZXQ6ICAgICAgICAgICAgICAgICAgICBnZXQsXG4gICAgdW5zZXQ6ICAgICAgICAgICAgICAgICAgdW5zZXQsXG4gICAgdG9PYmplY3Q6ICAgICAgICAgICAgICAgdG9PYmplY3QsXG4gICAgdG9UZW1wbGF0ZVJlcGxhY2VtZW50czogdG9PYmplY3QsXG4gICAga2V5czogICAgICAgICAgICAgICAgICAga2V5cyxcbiAgICB2YWx1ZXM6ICAgICAgICAgICAgICAgICB2YWx1ZXMsXG4gICAgaW5kZXg6ICAgICAgICAgICAgICAgICAgaW5kZXgsXG4gICAgbWVyZ2U6ICAgICAgICAgICAgICAgICAgbWVyZ2UsXG4gICAgdXBkYXRlOiAgICAgICAgICAgICAgICAgdXBkYXRlLFxuICAgIHRvUXVlcnlTdHJpbmc6ICAgICAgICAgIHRvUXVlcnlTdHJpbmcsXG4gICAgaW5zcGVjdDogICAgICAgICAgICAgICAgaW5zcGVjdCxcbiAgICB0b0pTT046ICAgICAgICAgICAgICAgICB0b09iamVjdCxcbiAgICBjbG9uZTogICAgICAgICAgICAgICAgICBjbG9uZVxuICB9O1xufSkoKSk7XG5cbkhhc2guZnJvbSA9ICRIO1xuT2JqZWN0LmV4dGVuZChOdW1iZXIucHJvdG90eXBlLCAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIHRvQ29sb3JQYXJ0KCkge1xuICAgIHJldHVybiB0aGlzLnRvUGFkZGVkU3RyaW5nKDIsIDE2KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN1Y2MoKSB7XG4gICAgcmV0dXJuIHRoaXMgKyAxO1xuICB9XG5cbiAgZnVuY3Rpb24gdGltZXMoaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICAkUigwLCB0aGlzLCB0cnVlKS5lYWNoKGl0ZXJhdG9yLCBjb250ZXh0KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGZ1bmN0aW9uIHRvUGFkZGVkU3RyaW5nKGxlbmd0aCwgcmFkaXgpIHtcbiAgICB2YXIgc3RyaW5nID0gdGhpcy50b1N0cmluZyhyYWRpeCB8fCAxMCk7XG4gICAgcmV0dXJuICcwJy50aW1lcyhsZW5ndGggLSBzdHJpbmcubGVuZ3RoKSArIHN0cmluZztcbiAgfVxuXG4gIGZ1bmN0aW9uIGFicygpIHtcbiAgICByZXR1cm4gTWF0aC5hYnModGhpcyk7XG4gIH1cblxuICBmdW5jdGlvbiByb3VuZCgpIHtcbiAgICByZXR1cm4gTWF0aC5yb3VuZCh0aGlzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNlaWwoKSB7XG4gICAgcmV0dXJuIE1hdGguY2VpbCh0aGlzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZsb29yKCkge1xuICAgIHJldHVybiBNYXRoLmZsb29yKHRoaXMpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0b0NvbG9yUGFydDogICAgdG9Db2xvclBhcnQsXG4gICAgc3VjYzogICAgICAgICAgIHN1Y2MsXG4gICAgdGltZXM6ICAgICAgICAgIHRpbWVzLFxuICAgIHRvUGFkZGVkU3RyaW5nOiB0b1BhZGRlZFN0cmluZyxcbiAgICBhYnM6ICAgICAgICAgICAgYWJzLFxuICAgIHJvdW5kOiAgICAgICAgICByb3VuZCxcbiAgICBjZWlsOiAgICAgICAgICAgY2VpbCxcbiAgICBmbG9vcjogICAgICAgICAgZmxvb3JcbiAgfTtcbn0pKCkpO1xuXG5mdW5jdGlvbiAkUihzdGFydCwgZW5kLCBleGNsdXNpdmUpIHtcbiAgcmV0dXJuIG5ldyBPYmplY3RSYW5nZShzdGFydCwgZW5kLCBleGNsdXNpdmUpO1xufVxuXG52YXIgT2JqZWN0UmFuZ2UgPSBDbGFzcy5jcmVhdGUoRW51bWVyYWJsZSwgKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBpbml0aWFsaXplKHN0YXJ0LCBlbmQsIGV4Y2x1c2l2ZSkge1xuICAgIHRoaXMuc3RhcnQgPSBzdGFydDtcbiAgICB0aGlzLmVuZCA9IGVuZDtcbiAgICB0aGlzLmV4Y2x1c2l2ZSA9IGV4Y2x1c2l2ZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9lYWNoKGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgdmFyIHZhbHVlID0gdGhpcy5zdGFydCwgaTtcbiAgICBmb3IgKGkgPSAwOyB0aGlzLmluY2x1ZGUodmFsdWUpOyBpKyspIHtcbiAgICAgIGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGkpO1xuICAgICAgdmFsdWUgPSB2YWx1ZS5zdWNjKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaW5jbHVkZSh2YWx1ZSkge1xuICAgIGlmICh2YWx1ZSA8IHRoaXMuc3RhcnQpXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKHRoaXMuZXhjbHVzaXZlKVxuICAgICAgcmV0dXJuIHZhbHVlIDwgdGhpcy5lbmQ7XG4gICAgcmV0dXJuIHZhbHVlIDw9IHRoaXMuZW5kO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBpbml0aWFsaXplOiBpbml0aWFsaXplLFxuICAgIF9lYWNoOiAgICAgIF9lYWNoLFxuICAgIGluY2x1ZGU6ICAgIGluY2x1ZGVcbiAgfTtcbn0pKCkpO1xuXG5cblxudmFyIEFic3RyYWN0ID0geyB9O1xuXG5cbnZhciBUcnkgPSB7XG4gIHRoZXNlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcmV0dXJuVmFsdWU7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgbGFtYmRhID0gYXJndW1lbnRzW2ldO1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuVmFsdWUgPSBsYW1iZGEoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9IGNhdGNoIChlKSB7IH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gIH1cbn07XG5cbnZhciBBamF4ID0ge1xuICBnZXRUcmFuc3BvcnQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBUcnkudGhlc2UoXG4gICAgICBmdW5jdGlvbigpIHtyZXR1cm4gbmV3IFhNTEh0dHBSZXF1ZXN0KCl9LFxuICAgICAgZnVuY3Rpb24oKSB7cmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KCdNc3htbDIuWE1MSFRUUCcpfSxcbiAgICAgIGZ1bmN0aW9uKCkge3JldHVybiBuZXcgQWN0aXZlWE9iamVjdCgnTWljcm9zb2Z0LlhNTEhUVFAnKX1cbiAgICApIHx8IGZhbHNlO1xuICB9LFxuXG4gIGFjdGl2ZVJlcXVlc3RDb3VudDogMFxufTtcblxuQWpheC5SZXNwb25kZXJzID0ge1xuICByZXNwb25kZXJzOiBbXSxcblxuICBfZWFjaDogZnVuY3Rpb24oaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICB0aGlzLnJlc3BvbmRlcnMuX2VhY2goaXRlcmF0b3IsIGNvbnRleHQpO1xuICB9LFxuXG4gIHJlZ2lzdGVyOiBmdW5jdGlvbihyZXNwb25kZXIpIHtcbiAgICBpZiAoIXRoaXMuaW5jbHVkZShyZXNwb25kZXIpKVxuICAgICAgdGhpcy5yZXNwb25kZXJzLnB1c2gocmVzcG9uZGVyKTtcbiAgfSxcblxuICB1bnJlZ2lzdGVyOiBmdW5jdGlvbihyZXNwb25kZXIpIHtcbiAgICB0aGlzLnJlc3BvbmRlcnMgPSB0aGlzLnJlc3BvbmRlcnMud2l0aG91dChyZXNwb25kZXIpO1xuICB9LFxuXG4gIGRpc3BhdGNoOiBmdW5jdGlvbihjYWxsYmFjaywgcmVxdWVzdCwgdHJhbnNwb3J0LCBqc29uKSB7XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHJlc3BvbmRlcikge1xuICAgICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKHJlc3BvbmRlcltjYWxsYmFja10pKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmVzcG9uZGVyW2NhbGxiYWNrXS5hcHBseShyZXNwb25kZXIsIFtyZXF1ZXN0LCB0cmFuc3BvcnQsIGpzb25dKTtcbiAgICAgICAgfSBjYXRjaCAoZSkgeyB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn07XG5cbk9iamVjdC5leHRlbmQoQWpheC5SZXNwb25kZXJzLCBFbnVtZXJhYmxlKTtcblxuQWpheC5SZXNwb25kZXJzLnJlZ2lzdGVyKHtcbiAgb25DcmVhdGU6ICAgZnVuY3Rpb24oKSB7IEFqYXguYWN0aXZlUmVxdWVzdENvdW50KysgfSxcbiAgb25Db21wbGV0ZTogZnVuY3Rpb24oKSB7IEFqYXguYWN0aXZlUmVxdWVzdENvdW50LS0gfVxufSk7XG5BamF4LkJhc2UgPSBDbGFzcy5jcmVhdGUoe1xuICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgdGhpcy5vcHRpb25zID0ge1xuICAgICAgbWV0aG9kOiAgICAgICAncG9zdCcsXG4gICAgICBhc3luY2hyb25vdXM6IHRydWUsXG4gICAgICBjb250ZW50VHlwZTogICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxuICAgICAgZW5jb2Rpbmc6ICAgICAnVVRGLTgnLFxuICAgICAgcGFyYW1ldGVyczogICAnJyxcbiAgICAgIGV2YWxKU09OOiAgICAgdHJ1ZSxcbiAgICAgIGV2YWxKUzogICAgICAgdHJ1ZVxuICAgIH07XG4gICAgT2JqZWN0LmV4dGVuZCh0aGlzLm9wdGlvbnMsIG9wdGlvbnMgfHwgeyB9KTtcblxuICAgIHRoaXMub3B0aW9ucy5tZXRob2QgPSB0aGlzLm9wdGlvbnMubWV0aG9kLnRvTG93ZXJDYXNlKCk7XG5cbiAgICBpZiAoT2JqZWN0LmlzSGFzaCh0aGlzLm9wdGlvbnMucGFyYW1ldGVycykpXG4gICAgICB0aGlzLm9wdGlvbnMucGFyYW1ldGVycyA9IHRoaXMub3B0aW9ucy5wYXJhbWV0ZXJzLnRvT2JqZWN0KCk7XG4gIH1cbn0pO1xuQWpheC5SZXF1ZXN0ID0gQ2xhc3MuY3JlYXRlKEFqYXguQmFzZSwge1xuICBfY29tcGxldGU6IGZhbHNlLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCRzdXBlciwgdXJsLCBvcHRpb25zKSB7XG4gICAgJHN1cGVyKG9wdGlvbnMpO1xuICAgIHRoaXMudHJhbnNwb3J0ID0gQWpheC5nZXRUcmFuc3BvcnQoKTtcbiAgICB0aGlzLnJlcXVlc3QodXJsKTtcbiAgfSxcblxuICByZXF1ZXN0OiBmdW5jdGlvbih1cmwpIHtcbiAgICB0aGlzLnVybCA9IHVybDtcbiAgICB0aGlzLm1ldGhvZCA9IHRoaXMub3B0aW9ucy5tZXRob2Q7XG4gICAgdmFyIHBhcmFtcyA9IE9iamVjdC5pc1N0cmluZyh0aGlzLm9wdGlvbnMucGFyYW1ldGVycykgP1xuICAgICAgICAgIHRoaXMub3B0aW9ucy5wYXJhbWV0ZXJzIDpcbiAgICAgICAgICBPYmplY3QudG9RdWVyeVN0cmluZyh0aGlzLm9wdGlvbnMucGFyYW1ldGVycyk7XG5cbiAgICBpZiAoIVsnZ2V0JywgJ3Bvc3QnXS5pbmNsdWRlKHRoaXMubWV0aG9kKSkge1xuICAgICAgcGFyYW1zICs9IChwYXJhbXMgPyAnJicgOiAnJykgKyBcIl9tZXRob2Q9XCIgKyB0aGlzLm1ldGhvZDtcbiAgICAgIHRoaXMubWV0aG9kID0gJ3Bvc3QnO1xuICAgIH1cblxuICAgIGlmIChwYXJhbXMgJiYgdGhpcy5tZXRob2QgPT09ICdnZXQnKSB7XG4gICAgICB0aGlzLnVybCArPSAodGhpcy51cmwuaW5jbHVkZSgnPycpID8gJyYnIDogJz8nKSArIHBhcmFtcztcbiAgICB9XG5cbiAgICB0aGlzLnBhcmFtZXRlcnMgPSBwYXJhbXMudG9RdWVyeVBhcmFtcygpO1xuXG4gICAgdHJ5IHtcbiAgICAgIHZhciByZXNwb25zZSA9IG5ldyBBamF4LlJlc3BvbnNlKHRoaXMpO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5vbkNyZWF0ZSkgdGhpcy5vcHRpb25zLm9uQ3JlYXRlKHJlc3BvbnNlKTtcbiAgICAgIEFqYXguUmVzcG9uZGVycy5kaXNwYXRjaCgnb25DcmVhdGUnLCB0aGlzLCByZXNwb25zZSk7XG5cbiAgICAgIHRoaXMudHJhbnNwb3J0Lm9wZW4odGhpcy5tZXRob2QudG9VcHBlckNhc2UoKSwgdGhpcy51cmwsXG4gICAgICAgIHRoaXMub3B0aW9ucy5hc3luY2hyb25vdXMpO1xuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLmFzeW5jaHJvbm91cykgdGhpcy5yZXNwb25kVG9SZWFkeVN0YXRlLmJpbmQodGhpcykuZGVmZXIoMSk7XG5cbiAgICAgIHRoaXMudHJhbnNwb3J0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IHRoaXMub25TdGF0ZUNoYW5nZS5iaW5kKHRoaXMpO1xuICAgICAgdGhpcy5zZXRSZXF1ZXN0SGVhZGVycygpO1xuXG4gICAgICB0aGlzLmJvZHkgPSB0aGlzLm1ldGhvZCA9PSAncG9zdCcgPyAodGhpcy5vcHRpb25zLnBvc3RCb2R5IHx8IHBhcmFtcykgOiBudWxsO1xuICAgICAgdGhpcy50cmFuc3BvcnQuc2VuZCh0aGlzLmJvZHkpO1xuXG4gICAgICAvKiBGb3JjZSBGaXJlZm94IHRvIGhhbmRsZSByZWFkeSBzdGF0ZSA0IGZvciBzeW5jaHJvbm91cyByZXF1ZXN0cyAqL1xuICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuYXN5bmNocm9ub3VzICYmIHRoaXMudHJhbnNwb3J0Lm92ZXJyaWRlTWltZVR5cGUpXG4gICAgICAgIHRoaXMub25TdGF0ZUNoYW5nZSgpO1xuXG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICB0aGlzLmRpc3BhdGNoRXhjZXB0aW9uKGUpO1xuICAgIH1cbiAgfSxcblxuICBvblN0YXRlQ2hhbmdlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcmVhZHlTdGF0ZSA9IHRoaXMudHJhbnNwb3J0LnJlYWR5U3RhdGU7XG4gICAgaWYgKHJlYWR5U3RhdGUgPiAxICYmICEoKHJlYWR5U3RhdGUgPT0gNCkgJiYgdGhpcy5fY29tcGxldGUpKVxuICAgICAgdGhpcy5yZXNwb25kVG9SZWFkeVN0YXRlKHRoaXMudHJhbnNwb3J0LnJlYWR5U3RhdGUpO1xuICB9LFxuXG4gIHNldFJlcXVlc3RIZWFkZXJzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgaGVhZGVycyA9IHtcbiAgICAgICdYLVJlcXVlc3RlZC1XaXRoJzogJ1hNTEh0dHBSZXF1ZXN0JyxcbiAgICAgICdYLVByb3RvdHlwZS1WZXJzaW9uJzogUHJvdG90eXBlLlZlcnNpb24sXG4gICAgICAnQWNjZXB0JzogJ3RleHQvamF2YXNjcmlwdCwgdGV4dC9odG1sLCBhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sLCAqLyonXG4gICAgfTtcblxuICAgIGlmICh0aGlzLm1ldGhvZCA9PSAncG9zdCcpIHtcbiAgICAgIGhlYWRlcnNbJ0NvbnRlbnQtdHlwZSddID0gdGhpcy5vcHRpb25zLmNvbnRlbnRUeXBlICtcbiAgICAgICAgKHRoaXMub3B0aW9ucy5lbmNvZGluZyA/ICc7IGNoYXJzZXQ9JyArIHRoaXMub3B0aW9ucy5lbmNvZGluZyA6ICcnKTtcblxuICAgICAgLyogRm9yY2UgXCJDb25uZWN0aW9uOiBjbG9zZVwiIGZvciBvbGRlciBNb3ppbGxhIGJyb3dzZXJzIHRvIHdvcmtcbiAgICAgICAqIGFyb3VuZCBhIGJ1ZyB3aGVyZSBYTUxIdHRwUmVxdWVzdCBzZW5kcyBhbiBpbmNvcnJlY3RcbiAgICAgICAqIENvbnRlbnQtbGVuZ3RoIGhlYWRlci4gU2VlIE1vemlsbGEgQnVnemlsbGEgIzI0NjY1MS5cbiAgICAgICAqL1xuICAgICAgaWYgKHRoaXMudHJhbnNwb3J0Lm92ZXJyaWRlTWltZVR5cGUgJiZcbiAgICAgICAgICAobmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvR2Vja29cXC8oXFxkezR9KS8pIHx8IFswLDIwMDVdKVsxXSA8IDIwMDUpXG4gICAgICAgICAgICBoZWFkZXJzWydDb25uZWN0aW9uJ10gPSAnY2xvc2UnO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLnJlcXVlc3RIZWFkZXJzID09ICdvYmplY3QnKSB7XG4gICAgICB2YXIgZXh0cmFzID0gdGhpcy5vcHRpb25zLnJlcXVlc3RIZWFkZXJzO1xuXG4gICAgICBpZiAoT2JqZWN0LmlzRnVuY3Rpb24oZXh0cmFzLnB1c2gpKVxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZXh0cmFzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSArPSAyKVxuICAgICAgICAgIGhlYWRlcnNbZXh0cmFzW2ldXSA9IGV4dHJhc1tpKzFdO1xuICAgICAgZWxzZVxuICAgICAgICAkSChleHRyYXMpLmVhY2goZnVuY3Rpb24ocGFpcikgeyBoZWFkZXJzW3BhaXIua2V5XSA9IHBhaXIudmFsdWUgfSk7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgbmFtZSBpbiBoZWFkZXJzKVxuICAgICAgaWYgKGhlYWRlcnNbbmFtZV0gIT0gbnVsbClcbiAgICAgICAgdGhpcy50cmFuc3BvcnQuc2V0UmVxdWVzdEhlYWRlcihuYW1lLCBoZWFkZXJzW25hbWVdKTtcbiAgfSxcblxuICBzdWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3RhdHVzID0gdGhpcy5nZXRTdGF0dXMoKTtcbiAgICByZXR1cm4gIXN0YXR1cyB8fCAoc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPCAzMDApIHx8IHN0YXR1cyA9PSAzMDQ7XG4gIH0sXG5cbiAgZ2V0U3RhdHVzOiBmdW5jdGlvbigpIHtcbiAgICB0cnkge1xuICAgICAgaWYgKHRoaXMudHJhbnNwb3J0LnN0YXR1cyA9PT0gMTIyMykgcmV0dXJuIDIwNDtcbiAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydC5zdGF0dXMgfHwgMDtcbiAgICB9IGNhdGNoIChlKSB7IHJldHVybiAwIH1cbiAgfSxcblxuICByZXNwb25kVG9SZWFkeVN0YXRlOiBmdW5jdGlvbihyZWFkeVN0YXRlKSB7XG4gICAgdmFyIHN0YXRlID0gQWpheC5SZXF1ZXN0LkV2ZW50c1tyZWFkeVN0YXRlXSwgcmVzcG9uc2UgPSBuZXcgQWpheC5SZXNwb25zZSh0aGlzKTtcblxuICAgIGlmIChzdGF0ZSA9PSAnQ29tcGxldGUnKSB7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLl9jb21wbGV0ZSA9IHRydWU7XG4gICAgICAgICh0aGlzLm9wdGlvbnNbJ29uJyArIHJlc3BvbnNlLnN0YXR1c11cbiAgICAgICAgIHx8IHRoaXMub3B0aW9uc1snb24nICsgKHRoaXMuc3VjY2VzcygpID8gJ1N1Y2Nlc3MnIDogJ0ZhaWx1cmUnKV1cbiAgICAgICAgIHx8IFByb3RvdHlwZS5lbXB0eUZ1bmN0aW9uKShyZXNwb25zZSwgcmVzcG9uc2UuaGVhZGVySlNPTik7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRoaXMuZGlzcGF0Y2hFeGNlcHRpb24oZSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBjb250ZW50VHlwZSA9IHJlc3BvbnNlLmdldEhlYWRlcignQ29udGVudC10eXBlJyk7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmV2YWxKUyA9PSAnZm9yY2UnXG4gICAgICAgICAgfHwgKHRoaXMub3B0aW9ucy5ldmFsSlMgJiYgdGhpcy5pc1NhbWVPcmlnaW4oKSAmJiBjb250ZW50VHlwZVxuICAgICAgICAgICYmIGNvbnRlbnRUeXBlLm1hdGNoKC9eXFxzKih0ZXh0fGFwcGxpY2F0aW9uKVxcLyh4LSk/KGphdmF8ZWNtYSlzY3JpcHQoOy4qKT9cXHMqJC9pKSkpXG4gICAgICAgIHRoaXMuZXZhbFJlc3BvbnNlKCk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICh0aGlzLm9wdGlvbnNbJ29uJyArIHN0YXRlXSB8fCBQcm90b3R5cGUuZW1wdHlGdW5jdGlvbikocmVzcG9uc2UsIHJlc3BvbnNlLmhlYWRlckpTT04pO1xuICAgICAgQWpheC5SZXNwb25kZXJzLmRpc3BhdGNoKCdvbicgKyBzdGF0ZSwgdGhpcywgcmVzcG9uc2UsIHJlc3BvbnNlLmhlYWRlckpTT04pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRoaXMuZGlzcGF0Y2hFeGNlcHRpb24oZSk7XG4gICAgfVxuXG4gICAgaWYgKHN0YXRlID09ICdDb21wbGV0ZScpIHtcbiAgICAgIHRoaXMudHJhbnNwb3J0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IFByb3RvdHlwZS5lbXB0eUZ1bmN0aW9uO1xuICAgIH1cbiAgfSxcblxuICBpc1NhbWVPcmlnaW46IGZ1bmN0aW9uKCkge1xuICAgIHZhciBtID0gdGhpcy51cmwubWF0Y2goL15cXHMqaHR0cHM/OlxcL1xcL1teXFwvXSovKTtcbiAgICByZXR1cm4gIW0gfHwgKG1bMF0gPT0gJyN7cHJvdG9jb2x9Ly8je2RvbWFpbn0je3BvcnR9Jy5pbnRlcnBvbGF0ZSh7XG4gICAgICBwcm90b2NvbDogbG9jYXRpb24ucHJvdG9jb2wsXG4gICAgICBkb21haW46IGRvY3VtZW50LmRvbWFpbixcbiAgICAgIHBvcnQ6IGxvY2F0aW9uLnBvcnQgPyAnOicgKyBsb2NhdGlvbi5wb3J0IDogJydcbiAgICB9KSk7XG4gIH0sXG5cbiAgZ2V0SGVhZGVyOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydC5nZXRSZXNwb25zZUhlYWRlcihuYW1lKSB8fCBudWxsO1xuICAgIH0gY2F0Y2ggKGUpIHsgcmV0dXJuIG51bGw7IH1cbiAgfSxcblxuICBldmFsUmVzcG9uc2U6IGZ1bmN0aW9uKCkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gZXZhbCgodGhpcy50cmFuc3BvcnQucmVzcG9uc2VUZXh0IHx8ICcnKS51bmZpbHRlckpTT04oKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhpcy5kaXNwYXRjaEV4Y2VwdGlvbihlKTtcbiAgICB9XG4gIH0sXG5cbiAgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uKGV4Y2VwdGlvbikge1xuICAgICh0aGlzLm9wdGlvbnMub25FeGNlcHRpb24gfHwgUHJvdG90eXBlLmVtcHR5RnVuY3Rpb24pKHRoaXMsIGV4Y2VwdGlvbik7XG4gICAgQWpheC5SZXNwb25kZXJzLmRpc3BhdGNoKCdvbkV4Y2VwdGlvbicsIHRoaXMsIGV4Y2VwdGlvbik7XG4gIH1cbn0pO1xuXG5BamF4LlJlcXVlc3QuRXZlbnRzID1cbiAgWydVbmluaXRpYWxpemVkJywgJ0xvYWRpbmcnLCAnTG9hZGVkJywgJ0ludGVyYWN0aXZlJywgJ0NvbXBsZXRlJ107XG5cblxuXG5cblxuXG5cblxuQWpheC5SZXNwb25zZSA9IENsYXNzLmNyZWF0ZSh7XG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKHJlcXVlc3Qpe1xuICAgIHRoaXMucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgdmFyIHRyYW5zcG9ydCAgPSB0aGlzLnRyYW5zcG9ydCAgPSByZXF1ZXN0LnRyYW5zcG9ydCxcbiAgICAgICAgcmVhZHlTdGF0ZSA9IHRoaXMucmVhZHlTdGF0ZSA9IHRyYW5zcG9ydC5yZWFkeVN0YXRlO1xuXG4gICAgaWYgKChyZWFkeVN0YXRlID4gMiAmJiAhUHJvdG90eXBlLkJyb3dzZXIuSUUpIHx8IHJlYWR5U3RhdGUgPT0gNCkge1xuICAgICAgdGhpcy5zdGF0dXMgICAgICAgPSB0aGlzLmdldFN0YXR1cygpO1xuICAgICAgdGhpcy5zdGF0dXNUZXh0ICAgPSB0aGlzLmdldFN0YXR1c1RleHQoKTtcbiAgICAgIHRoaXMucmVzcG9uc2VUZXh0ID0gU3RyaW5nLmludGVycHJldCh0cmFuc3BvcnQucmVzcG9uc2VUZXh0KTtcbiAgICAgIHRoaXMuaGVhZGVySlNPTiAgID0gdGhpcy5fZ2V0SGVhZGVySlNPTigpO1xuICAgIH1cblxuICAgIGlmIChyZWFkeVN0YXRlID09IDQpIHtcbiAgICAgIHZhciB4bWwgPSB0cmFuc3BvcnQucmVzcG9uc2VYTUw7XG4gICAgICB0aGlzLnJlc3BvbnNlWE1MICA9IE9iamVjdC5pc1VuZGVmaW5lZCh4bWwpID8gbnVsbCA6IHhtbDtcbiAgICAgIHRoaXMucmVzcG9uc2VKU09OID0gdGhpcy5fZ2V0UmVzcG9uc2VKU09OKCk7XG4gICAgfVxuICB9LFxuXG4gIHN0YXR1czogICAgICAwLFxuXG4gIHN0YXR1c1RleHQ6ICcnLFxuXG4gIGdldFN0YXR1czogQWpheC5SZXF1ZXN0LnByb3RvdHlwZS5nZXRTdGF0dXMsXG5cbiAgZ2V0U3RhdHVzVGV4dDogZnVuY3Rpb24oKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydC5zdGF0dXNUZXh0IHx8ICcnO1xuICAgIH0gY2F0Y2ggKGUpIHsgcmV0dXJuICcnIH1cbiAgfSxcblxuICBnZXRIZWFkZXI6IEFqYXguUmVxdWVzdC5wcm90b3R5cGUuZ2V0SGVhZGVyLFxuXG4gIGdldEFsbEhlYWRlcnM6IGZ1bmN0aW9uKCkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKTtcbiAgICB9IGNhdGNoIChlKSB7IHJldHVybiBudWxsIH1cbiAgfSxcblxuICBnZXRSZXNwb25zZUhlYWRlcjogZnVuY3Rpb24obmFtZSkge1xuICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydC5nZXRSZXNwb25zZUhlYWRlcihuYW1lKTtcbiAgfSxcblxuICBnZXRBbGxSZXNwb25zZUhlYWRlcnM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydC5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKTtcbiAgfSxcblxuICBfZ2V0SGVhZGVySlNPTjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGpzb24gPSB0aGlzLmdldEhlYWRlcignWC1KU09OJyk7XG4gICAgaWYgKCFqc29uKSByZXR1cm4gbnVsbDtcblxuICAgIHRyeSB7XG4gICAgICBqc29uID0gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZShqc29uKSk7XG4gICAgfSBjYXRjaChlKSB7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBqc29uLmV2YWxKU09OKHRoaXMucmVxdWVzdC5vcHRpb25zLnNhbml0aXplSlNPTiB8fFxuICAgICAgICAhdGhpcy5yZXF1ZXN0LmlzU2FtZU9yaWdpbigpKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLnJlcXVlc3QuZGlzcGF0Y2hFeGNlcHRpb24oZSk7XG4gICAgfVxuICB9LFxuXG4gIF9nZXRSZXNwb25zZUpTT046IGZ1bmN0aW9uKCkge1xuICAgIHZhciBvcHRpb25zID0gdGhpcy5yZXF1ZXN0Lm9wdGlvbnM7XG4gICAgaWYgKCFvcHRpb25zLmV2YWxKU09OIHx8IChvcHRpb25zLmV2YWxKU09OICE9ICdmb3JjZScgJiZcbiAgICAgICEodGhpcy5nZXRIZWFkZXIoJ0NvbnRlbnQtdHlwZScpIHx8ICcnKS5pbmNsdWRlKCdhcHBsaWNhdGlvbi9qc29uJykpIHx8XG4gICAgICAgIHRoaXMucmVzcG9uc2VUZXh0LmJsYW5rKCkpXG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB0aGlzLnJlc3BvbnNlVGV4dC5ldmFsSlNPTihvcHRpb25zLnNhbml0aXplSlNPTiB8fFxuICAgICAgICAhdGhpcy5yZXF1ZXN0LmlzU2FtZU9yaWdpbigpKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLnJlcXVlc3QuZGlzcGF0Y2hFeGNlcHRpb24oZSk7XG4gICAgfVxuICB9XG59KTtcblxuQWpheC5VcGRhdGVyID0gQ2xhc3MuY3JlYXRlKEFqYXguUmVxdWVzdCwge1xuICBpbml0aWFsaXplOiBmdW5jdGlvbigkc3VwZXIsIGNvbnRhaW5lciwgdXJsLCBvcHRpb25zKSB7XG4gICAgdGhpcy5jb250YWluZXIgPSB7XG4gICAgICBzdWNjZXNzOiAoY29udGFpbmVyLnN1Y2Nlc3MgfHwgY29udGFpbmVyKSxcbiAgICAgIGZhaWx1cmU6IChjb250YWluZXIuZmFpbHVyZSB8fCAoY29udGFpbmVyLnN1Y2Nlc3MgPyBudWxsIDogY29udGFpbmVyKSlcbiAgICB9O1xuXG4gICAgb3B0aW9ucyA9IE9iamVjdC5jbG9uZShvcHRpb25zKTtcbiAgICB2YXIgb25Db21wbGV0ZSA9IG9wdGlvbnMub25Db21wbGV0ZTtcbiAgICBvcHRpb25zLm9uQ29tcGxldGUgPSAoZnVuY3Rpb24ocmVzcG9uc2UsIGpzb24pIHtcbiAgICAgIHRoaXMudXBkYXRlQ29udGVudChyZXNwb25zZS5yZXNwb25zZVRleHQpO1xuICAgICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKG9uQ29tcGxldGUpKSBvbkNvbXBsZXRlKHJlc3BvbnNlLCBqc29uKTtcbiAgICB9KS5iaW5kKHRoaXMpO1xuXG4gICAgJHN1cGVyKHVybCwgb3B0aW9ucyk7XG4gIH0sXG5cbiAgdXBkYXRlQ29udGVudDogZnVuY3Rpb24ocmVzcG9uc2VUZXh0KSB7XG4gICAgdmFyIHJlY2VpdmVyID0gdGhpcy5jb250YWluZXJbdGhpcy5zdWNjZXNzKCkgPyAnc3VjY2VzcycgOiAnZmFpbHVyZSddLFxuICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuXG4gICAgaWYgKCFvcHRpb25zLmV2YWxTY3JpcHRzKSByZXNwb25zZVRleHQgPSByZXNwb25zZVRleHQuc3RyaXBTY3JpcHRzKCk7XG5cbiAgICBpZiAocmVjZWl2ZXIgPSAkKHJlY2VpdmVyKSkge1xuICAgICAgaWYgKG9wdGlvbnMuaW5zZXJ0aW9uKSB7XG4gICAgICAgIGlmIChPYmplY3QuaXNTdHJpbmcob3B0aW9ucy5pbnNlcnRpb24pKSB7XG4gICAgICAgICAgdmFyIGluc2VydGlvbiA9IHsgfTsgaW5zZXJ0aW9uW29wdGlvbnMuaW5zZXJ0aW9uXSA9IHJlc3BvbnNlVGV4dDtcbiAgICAgICAgICByZWNlaXZlci5pbnNlcnQoaW5zZXJ0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIG9wdGlvbnMuaW5zZXJ0aW9uKHJlY2VpdmVyLCByZXNwb25zZVRleHQpO1xuICAgICAgfVxuICAgICAgZWxzZSByZWNlaXZlci51cGRhdGUocmVzcG9uc2VUZXh0KTtcbiAgICB9XG4gIH1cbn0pO1xuXG5BamF4LlBlcmlvZGljYWxVcGRhdGVyID0gQ2xhc3MuY3JlYXRlKEFqYXguQmFzZSwge1xuICBpbml0aWFsaXplOiBmdW5jdGlvbigkc3VwZXIsIGNvbnRhaW5lciwgdXJsLCBvcHRpb25zKSB7XG4gICAgJHN1cGVyKG9wdGlvbnMpO1xuICAgIHRoaXMub25Db21wbGV0ZSA9IHRoaXMub3B0aW9ucy5vbkNvbXBsZXRlO1xuXG4gICAgdGhpcy5mcmVxdWVuY3kgPSAodGhpcy5vcHRpb25zLmZyZXF1ZW5jeSB8fCAyKTtcbiAgICB0aGlzLmRlY2F5ID0gKHRoaXMub3B0aW9ucy5kZWNheSB8fCAxKTtcblxuICAgIHRoaXMudXBkYXRlciA9IHsgfTtcbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB0aGlzLnVybCA9IHVybDtcblxuICAgIHRoaXMuc3RhcnQoKTtcbiAgfSxcblxuICBzdGFydDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5vcHRpb25zLm9uQ29tcGxldGUgPSB0aGlzLnVwZGF0ZUNvbXBsZXRlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vblRpbWVyRXZlbnQoKTtcbiAgfSxcblxuICBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnVwZGF0ZXIub3B0aW9ucy5vbkNvbXBsZXRlID0gdW5kZWZpbmVkO1xuICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKTtcbiAgICAodGhpcy5vbkNvbXBsZXRlIHx8IFByb3RvdHlwZS5lbXB0eUZ1bmN0aW9uKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9LFxuXG4gIHVwZGF0ZUNvbXBsZXRlOiBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZGVjYXkpIHtcbiAgICAgIHRoaXMuZGVjYXkgPSAocmVzcG9uc2UucmVzcG9uc2VUZXh0ID09IHRoaXMubGFzdFRleHQgP1xuICAgICAgICB0aGlzLmRlY2F5ICogdGhpcy5vcHRpb25zLmRlY2F5IDogMSk7XG5cbiAgICAgIHRoaXMubGFzdFRleHQgPSByZXNwb25zZS5yZXNwb25zZVRleHQ7XG4gICAgfVxuICAgIHRoaXMudGltZXIgPSB0aGlzLm9uVGltZXJFdmVudC5iaW5kKHRoaXMpLmRlbGF5KHRoaXMuZGVjYXkgKiB0aGlzLmZyZXF1ZW5jeSk7XG4gIH0sXG5cbiAgb25UaW1lckV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnVwZGF0ZXIgPSBuZXcgQWpheC5VcGRhdGVyKHRoaXMuY29udGFpbmVyLCB0aGlzLnVybCwgdGhpcy5vcHRpb25zKTtcbiAgfVxufSk7XG5cbihmdW5jdGlvbihHTE9CQUwpIHtcblxuICB2YXIgVU5ERUZJTkVEO1xuICB2YXIgU0xJQ0UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG5cbiAgdmFyIERJViA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG5cbiAgZnVuY3Rpb24gJChlbGVtZW50KSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgZWxlbWVudHMgPSBbXSwgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKVxuICAgICAgICBlbGVtZW50cy5wdXNoKCQoYXJndW1lbnRzW2ldKSk7XG4gICAgICByZXR1cm4gZWxlbWVudHM7XG4gICAgfVxuXG4gICAgaWYgKE9iamVjdC5pc1N0cmluZyhlbGVtZW50KSlcbiAgICAgIGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50KTtcbiAgICByZXR1cm4gRWxlbWVudC5leHRlbmQoZWxlbWVudCk7XG4gIH1cblxuICBHTE9CQUwuJCA9ICQ7XG5cblxuICBpZiAoIUdMT0JBTC5Ob2RlKSBHTE9CQUwuTm9kZSA9IHt9O1xuXG4gIGlmICghR0xPQkFMLk5vZGUuRUxFTUVOVF9OT0RFKSB7XG4gICAgT2JqZWN0LmV4dGVuZChHTE9CQUwuTm9kZSwge1xuICAgICAgRUxFTUVOVF9OT0RFOiAgICAgICAgICAgICAgICAxLFxuICAgICAgQVRUUklCVVRFX05PREU6ICAgICAgICAgICAgICAyLFxuICAgICAgVEVYVF9OT0RFOiAgICAgICAgICAgICAgICAgICAzLFxuICAgICAgQ0RBVEFfU0VDVElPTl9OT0RFOiAgICAgICAgICA0LFxuICAgICAgRU5USVRZX1JFRkVSRU5DRV9OT0RFOiAgICAgICA1LFxuICAgICAgRU5USVRZX05PREU6ICAgICAgICAgICAgICAgICA2LFxuICAgICAgUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFOiA3LFxuICAgICAgQ09NTUVOVF9OT0RFOiAgICAgICAgICAgICAgICA4LFxuICAgICAgRE9DVU1FTlRfTk9ERTogICAgICAgICAgICAgICA5LFxuICAgICAgRE9DVU1FTlRfVFlQRV9OT0RFOiAgICAgICAgIDEwLFxuICAgICAgRE9DVU1FTlRfRlJBR01FTlRfTk9ERTogICAgIDExLFxuICAgICAgTk9UQVRJT05fTk9ERTogICAgICAgICAgICAgIDEyXG4gICAgfSk7XG4gIH1cblxuICB2YXIgRUxFTUVOVF9DQUNIRSA9IHt9O1xuXG4gIGZ1bmN0aW9uIHNob3VsZFVzZUNyZWF0aW9uQ2FjaGUodGFnTmFtZSwgYXR0cmlidXRlcykge1xuICAgIGlmICh0YWdOYW1lID09PSAnc2VsZWN0JykgcmV0dXJuIGZhbHNlO1xuICAgIGlmICgndHlwZScgaW4gYXR0cmlidXRlcykgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgdmFyIEhBU19FWFRFTkRFRF9DUkVBVEVfRUxFTUVOVF9TWU5UQVggPSAoZnVuY3Rpb24oKXtcbiAgICB0cnkge1xuICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnPGlucHV0IG5hbWU9XCJ4XCI+Jyk7XG4gICAgICByZXR1cm4gZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnICYmIGVsLm5hbWUgPT09ICd4JztcbiAgICB9XG4gICAgY2F0Y2goZXJyKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9KSgpO1xuXG5cbiAgdmFyIG9sZEVsZW1lbnQgPSBHTE9CQUwuRWxlbWVudDtcbiAgZnVuY3Rpb24gRWxlbWVudCh0YWdOYW1lLCBhdHRyaWJ1dGVzKSB7XG4gICAgYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXMgfHwge307XG4gICAgdGFnTmFtZSA9IHRhZ05hbWUudG9Mb3dlckNhc2UoKTtcblxuICAgIGlmIChIQVNfRVhURU5ERURfQ1JFQVRFX0VMRU1FTlRfU1lOVEFYICYmIGF0dHJpYnV0ZXMubmFtZSkge1xuICAgICAgdGFnTmFtZSA9ICc8JyArIHRhZ05hbWUgKyAnIG5hbWU9XCInICsgYXR0cmlidXRlcy5uYW1lICsgJ1wiPic7XG4gICAgICBkZWxldGUgYXR0cmlidXRlcy5uYW1lO1xuICAgICAgcmV0dXJuIEVsZW1lbnQud3JpdGVBdHRyaWJ1dGUoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKSwgYXR0cmlidXRlcyk7XG4gICAgfVxuXG4gICAgaWYgKCFFTEVNRU5UX0NBQ0hFW3RhZ05hbWVdKVxuICAgICAgRUxFTUVOVF9DQUNIRVt0YWdOYW1lXSA9IEVsZW1lbnQuZXh0ZW5kKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSkpO1xuXG4gICAgdmFyIG5vZGUgPSBzaG91bGRVc2VDcmVhdGlvbkNhY2hlKHRhZ05hbWUsIGF0dHJpYnV0ZXMpID9cbiAgICAgRUxFTUVOVF9DQUNIRVt0YWdOYW1lXS5jbG9uZU5vZGUoZmFsc2UpIDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKTtcblxuICAgIHJldHVybiBFbGVtZW50LndyaXRlQXR0cmlidXRlKG5vZGUsIGF0dHJpYnV0ZXMpO1xuICB9XG5cbiAgR0xPQkFMLkVsZW1lbnQgPSBFbGVtZW50O1xuXG4gIE9iamVjdC5leHRlbmQoR0xPQkFMLkVsZW1lbnQsIG9sZEVsZW1lbnQgfHwge30pO1xuICBpZiAob2xkRWxlbWVudCkgR0xPQkFMLkVsZW1lbnQucHJvdG90eXBlID0gb2xkRWxlbWVudC5wcm90b3R5cGU7XG5cbiAgRWxlbWVudC5NZXRob2RzID0geyBCeVRhZzoge30sIFNpbXVsYXRlZDoge30gfTtcblxuICB2YXIgbWV0aG9kcyA9IHt9O1xuXG4gIHZhciBJTlNQRUNUX0FUVFJJQlVURVMgPSB7IGlkOiAnaWQnLCBjbGFzc05hbWU6ICdjbGFzcycgfTtcbiAgZnVuY3Rpb24gaW5zcGVjdChlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgdmFyIHJlc3VsdCA9ICc8JyArIGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgdmFyIGF0dHJpYnV0ZSwgdmFsdWU7XG4gICAgZm9yICh2YXIgcHJvcGVydHkgaW4gSU5TUEVDVF9BVFRSSUJVVEVTKSB7XG4gICAgICBhdHRyaWJ1dGUgPSBJTlNQRUNUX0FUVFJJQlVURVNbcHJvcGVydHldO1xuICAgICAgdmFsdWUgPSAoZWxlbWVudFtwcm9wZXJ0eV0gfHwgJycpLnRvU3RyaW5nKCk7XG4gICAgICBpZiAodmFsdWUpIHJlc3VsdCArPSAnICcgKyBhdHRyaWJ1dGUgKyAnPScgKyB2YWx1ZS5pbnNwZWN0KHRydWUpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQgKyAnPic7XG4gIH1cblxuICBtZXRob2RzLmluc3BlY3QgPSBpbnNwZWN0O1xuXG5cbiAgZnVuY3Rpb24gdmlzaWJsZShlbGVtZW50KSB7XG4gICAgcmV0dXJuICQoZWxlbWVudCkuc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnO1xuICB9XG5cbiAgZnVuY3Rpb24gdG9nZ2xlKGVsZW1lbnQsIGJvb2wpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKGJvb2wpKVxuICAgICAgYm9vbCA9ICFFbGVtZW50LnZpc2libGUoZWxlbWVudCk7XG4gICAgRWxlbWVudFtib29sID8gJ3Nob3cnIDogJ2hpZGUnXShlbGVtZW50KTtcblxuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gaGlkZShlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvdyhlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuXG4gIE9iamVjdC5leHRlbmQobWV0aG9kcywge1xuICAgIHZpc2libGU6IHZpc2libGUsXG4gICAgdG9nZ2xlOiAgdG9nZ2xlLFxuICAgIGhpZGU6ICAgIGhpZGUsXG4gICAgc2hvdzogICAgc2hvd1xuICB9KTtcblxuXG4gIGZ1bmN0aW9uIHJlbW92ZShlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgdmFyIFNFTEVDVF9FTEVNRU5UX0lOTkVSSFRNTF9CVUdHWSA9IChmdW5jdGlvbigpe1xuICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIiksXG4gICAgICAgIGlzQnVnZ3kgPSB0cnVlO1xuICAgIGVsLmlubmVySFRNTCA9IFwiPG9wdGlvbiB2YWx1ZT1cXFwidGVzdFxcXCI+dGVzdDwvb3B0aW9uPlwiO1xuICAgIGlmIChlbC5vcHRpb25zICYmIGVsLm9wdGlvbnNbMF0pIHtcbiAgICAgIGlzQnVnZ3kgPSBlbC5vcHRpb25zWzBdLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgIT09IFwiT1BUSU9OXCI7XG4gICAgfVxuICAgIGVsID0gbnVsbDtcbiAgICByZXR1cm4gaXNCdWdneTtcbiAgfSkoKTtcblxuICB2YXIgVEFCTEVfRUxFTUVOVF9JTk5FUkhUTUxfQlVHR1kgPSAoZnVuY3Rpb24oKXtcbiAgICB0cnkge1xuICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpO1xuICAgICAgaWYgKGVsICYmIGVsLnRCb2RpZXMpIHtcbiAgICAgICAgZWwuaW5uZXJIVE1MID0gXCI8dGJvZHk+PHRyPjx0ZD50ZXN0PC90ZD48L3RyPjwvdGJvZHk+XCI7XG4gICAgICAgIHZhciBpc0J1Z2d5ID0gdHlwZW9mIGVsLnRCb2RpZXNbMF0gPT0gXCJ1bmRlZmluZWRcIjtcbiAgICAgICAgZWwgPSBudWxsO1xuICAgICAgICByZXR1cm4gaXNCdWdneTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0pKCk7XG5cbiAgdmFyIExJTktfRUxFTUVOVF9JTk5FUkhUTUxfQlVHR1kgPSAoZnVuY3Rpb24oKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgZWwuaW5uZXJIVE1MID0gXCI8bGluayAvPlwiO1xuICAgICAgdmFyIGlzQnVnZ3kgPSAoZWwuY2hpbGROb2Rlcy5sZW5ndGggPT09IDApO1xuICAgICAgZWwgPSBudWxsO1xuICAgICAgcmV0dXJuIGlzQnVnZ3k7XG4gICAgfSBjYXRjaChlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0pKCk7XG5cbiAgdmFyIEFOWV9JTk5FUkhUTUxfQlVHR1kgPSBTRUxFQ1RfRUxFTUVOVF9JTk5FUkhUTUxfQlVHR1kgfHxcbiAgIFRBQkxFX0VMRU1FTlRfSU5ORVJIVE1MX0JVR0dZIHx8IExJTktfRUxFTUVOVF9JTk5FUkhUTUxfQlVHR1k7XG5cbiAgdmFyIFNDUklQVF9FTEVNRU5UX1JFSkVDVFNfVEVYVE5PREVfQVBQRU5ESU5HID0gKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIiksXG4gICAgICAgIGlzQnVnZ3kgPSBmYWxzZTtcbiAgICB0cnkge1xuICAgICAgcy5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcIlwiKSk7XG4gICAgICBpc0J1Z2d5ID0gIXMuZmlyc3RDaGlsZCB8fFxuICAgICAgICBzLmZpcnN0Q2hpbGQgJiYgcy5maXJzdENoaWxkLm5vZGVUeXBlICE9PSAzO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGlzQnVnZ3kgPSB0cnVlO1xuICAgIH1cbiAgICBzID0gbnVsbDtcbiAgICByZXR1cm4gaXNCdWdneTtcbiAgfSkoKTtcblxuICBmdW5jdGlvbiB1cGRhdGUoZWxlbWVudCwgY29udGVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgdmFyIGRlc2NlbmRhbnRzID0gZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpLFxuICAgICBpID0gZGVzY2VuZGFudHMubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHB1cmdlRWxlbWVudChkZXNjZW5kYW50c1tpXSk7XG5cbiAgICBpZiAoY29udGVudCAmJiBjb250ZW50LnRvRWxlbWVudClcbiAgICAgIGNvbnRlbnQgPSBjb250ZW50LnRvRWxlbWVudCgpO1xuXG4gICAgaWYgKE9iamVjdC5pc0VsZW1lbnQoY29udGVudCkpXG4gICAgICByZXR1cm4gZWxlbWVudC51cGRhdGUoKS5pbnNlcnQoY29udGVudCk7XG5cblxuICAgIGNvbnRlbnQgPSBPYmplY3QudG9IVE1MKGNvbnRlbnQpO1xuICAgIHZhciB0YWdOYW1lID0gZWxlbWVudC50YWdOYW1lLnRvVXBwZXJDYXNlKCk7XG5cbiAgICBpZiAodGFnTmFtZSA9PT0gJ1NDUklQVCcgJiYgU0NSSVBUX0VMRU1FTlRfUkVKRUNUU19URVhUTk9ERV9BUFBFTkRJTkcpIHtcbiAgICAgIGVsZW1lbnQudGV4dCA9IGNvbnRlbnQ7XG4gICAgICByZXR1cm4gZWxlbWVudDtcbiAgICB9XG5cbiAgICBpZiAoQU5ZX0lOTkVSSFRNTF9CVUdHWSkge1xuICAgICAgaWYgKHRhZ05hbWUgaW4gSU5TRVJUSU9OX1RSQU5TTEFUSU9OUy50YWdzKSB7XG4gICAgICAgIHdoaWxlIChlbGVtZW50LmZpcnN0Q2hpbGQpXG4gICAgICAgICAgZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmZpcnN0Q2hpbGQpO1xuXG4gICAgICAgIHZhciBub2RlcyA9IGdldENvbnRlbnRGcm9tQW5vbnltb3VzRWxlbWVudCh0YWdOYW1lLCBjb250ZW50LnN0cmlwU2NyaXB0cygpKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBub2Rlc1tpXTsgaSsrKVxuICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQobm9kZSk7XG5cbiAgICAgIH0gZWxzZSBpZiAoTElOS19FTEVNRU5UX0lOTkVSSFRNTF9CVUdHWSAmJiBPYmplY3QuaXNTdHJpbmcoY29udGVudCkgJiYgY29udGVudC5pbmRleE9mKCc8bGluaycpID4gLTEpIHtcbiAgICAgICAgd2hpbGUgKGVsZW1lbnQuZmlyc3RDaGlsZClcbiAgICAgICAgICBlbGVtZW50LnJlbW92ZUNoaWxkKGVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cbiAgICAgICAgdmFyIG5vZGVzID0gZ2V0Q29udGVudEZyb21Bbm9ueW1vdXNFbGVtZW50KHRhZ05hbWUsXG4gICAgICAgICBjb250ZW50LnN0cmlwU2NyaXB0cygpLCB0cnVlKTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspXG4gICAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gY29udGVudC5zdHJpcFNjcmlwdHMoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSBjb250ZW50LnN0cmlwU2NyaXB0cygpO1xuICAgIH1cblxuICAgIGNvbnRlbnQuZXZhbFNjcmlwdHMuYmluZChjb250ZW50KS5kZWZlcigpO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gcmVwbGFjZShlbGVtZW50LCBjb250ZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICBpZiAoY29udGVudCAmJiBjb250ZW50LnRvRWxlbWVudCkge1xuICAgICAgY29udGVudCA9IGNvbnRlbnQudG9FbGVtZW50KCk7XG4gICAgfSBlbHNlIGlmICghT2JqZWN0LmlzRWxlbWVudChjb250ZW50KSkge1xuICAgICAgY29udGVudCA9IE9iamVjdC50b0hUTUwoY29udGVudCk7XG4gICAgICB2YXIgcmFuZ2UgPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgICAgIHJhbmdlLnNlbGVjdE5vZGUoZWxlbWVudCk7XG4gICAgICBjb250ZW50LmV2YWxTY3JpcHRzLmJpbmQoY29udGVudCkuZGVmZXIoKTtcbiAgICAgIGNvbnRlbnQgPSByYW5nZS5jcmVhdGVDb250ZXh0dWFsRnJhZ21lbnQoY29udGVudC5zdHJpcFNjcmlwdHMoKSk7XG4gICAgfVxuXG4gICAgZWxlbWVudC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChjb250ZW50LCBlbGVtZW50KTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIHZhciBJTlNFUlRJT05fVFJBTlNMQVRJT05TID0ge1xuICAgIGJlZm9yZTogZnVuY3Rpb24oZWxlbWVudCwgbm9kZSkge1xuICAgICAgZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShub2RlLCBlbGVtZW50KTtcbiAgICB9LFxuICAgIHRvcDogZnVuY3Rpb24oZWxlbWVudCwgbm9kZSkge1xuICAgICAgZWxlbWVudC5pbnNlcnRCZWZvcmUobm9kZSwgZWxlbWVudC5maXJzdENoaWxkKTtcbiAgICB9LFxuICAgIGJvdHRvbTogZnVuY3Rpb24oZWxlbWVudCwgbm9kZSkge1xuICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChub2RlKTtcbiAgICB9LFxuICAgIGFmdGVyOiBmdW5jdGlvbihlbGVtZW50LCBub2RlKSB7XG4gICAgICBlbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUsIGVsZW1lbnQubmV4dFNpYmxpbmcpO1xuICAgIH0sXG5cbiAgICB0YWdzOiB7XG4gICAgICBUQUJMRTogIFsnPHRhYmxlPicsICAgICAgICAgICAgICAgICc8L3RhYmxlPicsICAgICAgICAgICAgICAgICAgIDFdLFxuICAgICAgVEJPRFk6ICBbJzx0YWJsZT48dGJvZHk+JywgICAgICAgICAnPC90Ym9keT48L3RhYmxlPicsICAgICAgICAgICAyXSxcbiAgICAgIFRSOiAgICAgWyc8dGFibGU+PHRib2R5Pjx0cj4nLCAgICAgJzwvdHI+PC90Ym9keT48L3RhYmxlPicsICAgICAgM10sXG4gICAgICBURDogICAgIFsnPHRhYmxlPjx0Ym9keT48dHI+PHRkPicsICc8L3RkPjwvdHI+PC90Ym9keT48L3RhYmxlPicsIDRdLFxuICAgICAgU0VMRUNUOiBbJzxzZWxlY3Q+JywgICAgICAgICAgICAgICAnPC9zZWxlY3Q+JywgICAgICAgICAgICAgICAgICAxXVxuICAgIH1cbiAgfTtcblxuICB2YXIgdGFncyA9IElOU0VSVElPTl9UUkFOU0xBVElPTlMudGFncztcblxuICBPYmplY3QuZXh0ZW5kKHRhZ3MsIHtcbiAgICBUSEVBRDogdGFncy5UQk9EWSxcbiAgICBURk9PVDogdGFncy5UQk9EWSxcbiAgICBUSDogICAgdGFncy5URFxuICB9KTtcblxuICBmdW5jdGlvbiByZXBsYWNlX0lFKGVsZW1lbnQsIGNvbnRlbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICBpZiAoY29udGVudCAmJiBjb250ZW50LnRvRWxlbWVudClcbiAgICAgIGNvbnRlbnQgPSBjb250ZW50LnRvRWxlbWVudCgpO1xuICAgIGlmIChPYmplY3QuaXNFbGVtZW50KGNvbnRlbnQpKSB7XG4gICAgICBlbGVtZW50LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGNvbnRlbnQsIGVsZW1lbnQpO1xuICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfVxuXG4gICAgY29udGVudCA9IE9iamVjdC50b0hUTUwoY29udGVudCk7XG4gICAgdmFyIHBhcmVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSwgdGFnTmFtZSA9IHBhcmVudC50YWdOYW1lLnRvVXBwZXJDYXNlKCk7XG5cbiAgICBpZiAodGFnTmFtZSBpbiBJTlNFUlRJT05fVFJBTlNMQVRJT05TLnRhZ3MpIHtcbiAgICAgIHZhciBuZXh0U2libGluZyA9IEVsZW1lbnQubmV4dChlbGVtZW50KTtcbiAgICAgIHZhciBmcmFnbWVudHMgPSBnZXRDb250ZW50RnJvbUFub255bW91c0VsZW1lbnQoXG4gICAgICAgdGFnTmFtZSwgY29udGVudC5zdHJpcFNjcmlwdHMoKSk7XG5cbiAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChlbGVtZW50KTtcblxuICAgICAgdmFyIGl0ZXJhdG9yO1xuICAgICAgaWYgKG5leHRTaWJsaW5nKVxuICAgICAgICBpdGVyYXRvciA9IGZ1bmN0aW9uKG5vZGUpIHsgcGFyZW50Lmluc2VydEJlZm9yZShub2RlLCBuZXh0U2libGluZykgfTtcbiAgICAgIGVsc2VcbiAgICAgICAgaXRlcmF0b3IgPSBmdW5jdGlvbihub2RlKSB7IHBhcmVudC5hcHBlbmRDaGlsZChub2RlKTsgfVxuXG4gICAgICBmcmFnbWVudHMuZWFjaChpdGVyYXRvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVsZW1lbnQub3V0ZXJIVE1MID0gY29udGVudC5zdHJpcFNjcmlwdHMoKTtcbiAgICB9XG5cbiAgICBjb250ZW50LmV2YWxTY3JpcHRzLmJpbmQoY29udGVudCkuZGVmZXIoKTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGlmICgnb3V0ZXJIVE1MJyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpXG4gICAgcmVwbGFjZSA9IHJlcGxhY2VfSUU7XG5cbiAgZnVuY3Rpb24gaXNDb250ZW50KGNvbnRlbnQpIHtcbiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKGNvbnRlbnQpIHx8IGNvbnRlbnQgPT09IG51bGwpIHJldHVybiBmYWxzZTtcblxuICAgIGlmIChPYmplY3QuaXNTdHJpbmcoY29udGVudCkgfHwgT2JqZWN0LmlzTnVtYmVyKGNvbnRlbnQpKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAoT2JqZWN0LmlzRWxlbWVudChjb250ZW50KSkgcmV0dXJuIHRydWU7XG4gICAgaWYgKGNvbnRlbnQudG9FbGVtZW50IHx8IGNvbnRlbnQudG9IVE1MKSByZXR1cm4gdHJ1ZTtcblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluc2VydENvbnRlbnRBdChlbGVtZW50LCBjb250ZW50LCBwb3NpdGlvbikge1xuICAgIHBvc2l0aW9uICAgPSBwb3NpdGlvbi50b0xvd2VyQ2FzZSgpO1xuICAgIHZhciBtZXRob2QgPSBJTlNFUlRJT05fVFJBTlNMQVRJT05TW3Bvc2l0aW9uXTtcblxuICAgIGlmIChjb250ZW50ICYmIGNvbnRlbnQudG9FbGVtZW50KSBjb250ZW50ID0gY29udGVudC50b0VsZW1lbnQoKTtcbiAgICBpZiAoT2JqZWN0LmlzRWxlbWVudChjb250ZW50KSkge1xuICAgICAgbWV0aG9kKGVsZW1lbnQsIGNvbnRlbnQpO1xuICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfVxuXG4gICAgY29udGVudCA9IE9iamVjdC50b0hUTUwoY29udGVudCk7XG4gICAgdmFyIHRhZ05hbWUgPSAoKHBvc2l0aW9uID09PSAnYmVmb3JlJyB8fCBwb3NpdGlvbiA9PT0gJ2FmdGVyJykgP1xuICAgICBlbGVtZW50LnBhcmVudE5vZGUgOiBlbGVtZW50KS50YWdOYW1lLnRvVXBwZXJDYXNlKCk7XG5cbiAgICB2YXIgY2hpbGROb2RlcyA9IGdldENvbnRlbnRGcm9tQW5vbnltb3VzRWxlbWVudCh0YWdOYW1lLCBjb250ZW50LnN0cmlwU2NyaXB0cygpKTtcblxuICAgIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcgfHwgcG9zaXRpb24gPT09ICdhZnRlcicpIGNoaWxkTm9kZXMucmV2ZXJzZSgpO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBjaGlsZE5vZGVzW2ldOyBpKyspXG4gICAgICBtZXRob2QoZWxlbWVudCwgbm9kZSk7XG5cbiAgICBjb250ZW50LmV2YWxTY3JpcHRzLmJpbmQoY29udGVudCkuZGVmZXIoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluc2VydChlbGVtZW50LCBpbnNlcnRpb25zKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICBpZiAoaXNDb250ZW50KGluc2VydGlvbnMpKVxuICAgICAgaW5zZXJ0aW9ucyA9IHsgYm90dG9tOiBpbnNlcnRpb25zIH07XG5cbiAgICBmb3IgKHZhciBwb3NpdGlvbiBpbiBpbnNlcnRpb25zKVxuICAgICAgaW5zZXJ0Q29udGVudEF0KGVsZW1lbnQsIGluc2VydGlvbnNbcG9zaXRpb25dLCBwb3NpdGlvbik7XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHdyYXAoZWxlbWVudCwgd3JhcHBlciwgYXR0cmlidXRlcykge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgaWYgKE9iamVjdC5pc0VsZW1lbnQod3JhcHBlcikpIHtcbiAgICAgICQod3JhcHBlcikud3JpdGVBdHRyaWJ1dGUoYXR0cmlidXRlcyB8fCB7fSk7XG4gICAgfSBlbHNlIGlmIChPYmplY3QuaXNTdHJpbmcod3JhcHBlcikpIHtcbiAgICAgIHdyYXBwZXIgPSBuZXcgRWxlbWVudCh3cmFwcGVyLCBhdHRyaWJ1dGVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgd3JhcHBlciA9IG5ldyBFbGVtZW50KCdkaXYnLCB3cmFwcGVyKTtcbiAgICB9XG5cbiAgICBpZiAoZWxlbWVudC5wYXJlbnROb2RlKVxuICAgICAgZWxlbWVudC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZCh3cmFwcGVyLCBlbGVtZW50KTtcblxuICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG5cbiAgICByZXR1cm4gd3JhcHBlcjtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsZWFuV2hpdGVzcGFjZShlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgdmFyIG5vZGUgPSBlbGVtZW50LmZpcnN0Q2hpbGQ7XG5cbiAgICB3aGlsZSAobm9kZSkge1xuICAgICAgdmFyIG5leHROb2RlID0gbm9kZS5uZXh0U2libGluZztcbiAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSAmJiAhL1xcUy8udGVzdChub2RlLm5vZGVWYWx1ZSkpXG4gICAgICAgIGVsZW1lbnQucmVtb3ZlQ2hpbGQobm9kZSk7XG4gICAgICBub2RlID0gbmV4dE5vZGU7XG4gICAgfVxuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gZW1wdHkoZWxlbWVudCkge1xuICAgIHJldHVybiAkKGVsZW1lbnQpLmlubmVySFRNTC5ibGFuaygpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0Q29udGVudEZyb21Bbm9ueW1vdXNFbGVtZW50KHRhZ05hbWUsIGh0bWwsIGZvcmNlKSB7XG4gICAgdmFyIHQgPSBJTlNFUlRJT05fVFJBTlNMQVRJT05TLnRhZ3NbdGFnTmFtZV0sIGRpdiA9IERJVjtcblxuICAgIHZhciB3b3JrYXJvdW5kID0gISF0O1xuICAgIGlmICghd29ya2Fyb3VuZCAmJiBmb3JjZSkge1xuICAgICAgd29ya2Fyb3VuZCA9IHRydWU7XG4gICAgICB0ID0gWycnLCAnJywgMF07XG4gICAgfVxuXG4gICAgaWYgKHdvcmthcm91bmQpIHtcbiAgICAgIGRpdi5pbm5lckhUTUwgPSAnJiMxNjA7JyArIHRbMF0gKyBodG1sICsgdFsxXTtcbiAgICAgIGRpdi5yZW1vdmVDaGlsZChkaXYuZmlyc3RDaGlsZCk7XG4gICAgICBmb3IgKHZhciBpID0gdFsyXTsgaS0tOyApXG4gICAgICAgIGRpdiA9IGRpdi5maXJzdENoaWxkO1xuICAgIH0gZWxzZSB7XG4gICAgICBkaXYuaW5uZXJIVE1MID0gaHRtbDtcbiAgICB9XG5cbiAgICByZXR1cm4gJEEoZGl2LmNoaWxkTm9kZXMpO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xvbmUoZWxlbWVudCwgZGVlcCkge1xuICAgIGlmICghKGVsZW1lbnQgPSAkKGVsZW1lbnQpKSkgcmV0dXJuO1xuICAgIHZhciBjbG9uZSA9IGVsZW1lbnQuY2xvbmVOb2RlKGRlZXApO1xuICAgIGlmICghSEFTX1VOSVFVRV9JRF9QUk9QRVJUWSkge1xuICAgICAgY2xvbmUuX3Byb3RvdHlwZVVJRCA9IFVOREVGSU5FRDtcbiAgICAgIGlmIChkZWVwKSB7XG4gICAgICAgIHZhciBkZXNjZW5kYW50cyA9IEVsZW1lbnQuc2VsZWN0KGNsb25lLCAnKicpLFxuICAgICAgICAgaSA9IGRlc2NlbmRhbnRzLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKGktLSlcbiAgICAgICAgICBkZXNjZW5kYW50c1tpXS5fcHJvdG90eXBlVUlEID0gVU5ERUZJTkVEO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gRWxlbWVudC5leHRlbmQoY2xvbmUpO1xuICB9XG5cbiAgZnVuY3Rpb24gcHVyZ2VFbGVtZW50KGVsZW1lbnQpIHtcbiAgICB2YXIgdWlkID0gZ2V0VW5pcXVlRWxlbWVudElEKGVsZW1lbnQpO1xuICAgIGlmICh1aWQpIHtcbiAgICAgIEVsZW1lbnQuc3RvcE9ic2VydmluZyhlbGVtZW50KTtcbiAgICAgIGlmICghSEFTX1VOSVFVRV9JRF9QUk9QRVJUWSlcbiAgICAgICAgZWxlbWVudC5fcHJvdG90eXBlVUlEID0gVU5ERUZJTkVEO1xuICAgICAgZGVsZXRlIEVsZW1lbnQuU3RvcmFnZVt1aWRdO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHB1cmdlQ29sbGVjdGlvbihlbGVtZW50cykge1xuICAgIHZhciBpID0gZWxlbWVudHMubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pXG4gICAgICBwdXJnZUVsZW1lbnQoZWxlbWVudHNbaV0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHVyZ2VDb2xsZWN0aW9uX0lFKGVsZW1lbnRzKSB7XG4gICAgdmFyIGkgPSBlbGVtZW50cy5sZW5ndGgsIGVsZW1lbnQsIHVpZDtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICBlbGVtZW50ID0gZWxlbWVudHNbaV07XG4gICAgICB1aWQgPSBnZXRVbmlxdWVFbGVtZW50SUQoZWxlbWVudCk7XG4gICAgICBkZWxldGUgRWxlbWVudC5TdG9yYWdlW3VpZF07XG4gICAgICBkZWxldGUgRXZlbnQuY2FjaGVbdWlkXTtcbiAgICB9XG4gIH1cblxuICBpZiAoSEFTX1VOSVFVRV9JRF9QUk9QRVJUWSkge1xuICAgIHB1cmdlQ29sbGVjdGlvbiA9IHB1cmdlQ29sbGVjdGlvbl9JRTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gcHVyZ2UoZWxlbWVudCkge1xuICAgIGlmICghKGVsZW1lbnQgPSAkKGVsZW1lbnQpKSkgcmV0dXJuO1xuICAgIHB1cmdlRWxlbWVudChlbGVtZW50KTtcblxuICAgIHZhciBkZXNjZW5kYW50cyA9IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJyonKSxcbiAgICAgaSA9IGRlc2NlbmRhbnRzLmxlbmd0aDtcblxuICAgIHdoaWxlIChpLS0pIHB1cmdlRWxlbWVudChkZXNjZW5kYW50c1tpXSk7XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIE9iamVjdC5leHRlbmQobWV0aG9kcywge1xuICAgIHJlbW92ZTogIHJlbW92ZSxcbiAgICB1cGRhdGU6ICB1cGRhdGUsXG4gICAgcmVwbGFjZTogcmVwbGFjZSxcbiAgICBpbnNlcnQ6ICBpbnNlcnQsXG4gICAgd3JhcDogICAgd3JhcCxcbiAgICBjbGVhbldoaXRlc3BhY2U6IGNsZWFuV2hpdGVzcGFjZSxcbiAgICBlbXB0eTogICBlbXB0eSxcbiAgICBjbG9uZTogICBjbG9uZSxcbiAgICBwdXJnZTogICBwdXJnZVxuICB9KTtcblxuXG5cbiAgZnVuY3Rpb24gcmVjdXJzaXZlbHlDb2xsZWN0KGVsZW1lbnQsIHByb3BlcnR5LCBtYXhpbXVtTGVuZ3RoKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgbWF4aW11bUxlbmd0aCA9IG1heGltdW1MZW5ndGggfHwgLTE7XG4gICAgdmFyIGVsZW1lbnRzID0gW107XG5cbiAgICB3aGlsZSAoZWxlbWVudCA9IGVsZW1lbnRbcHJvcGVydHldKSB7XG4gICAgICBpZiAoZWxlbWVudC5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREUpXG4gICAgICAgIGVsZW1lbnRzLnB1c2goRWxlbWVudC5leHRlbmQoZWxlbWVudCkpO1xuXG4gICAgICBpZiAoZWxlbWVudHMubGVuZ3RoID09PSBtYXhpbXVtTGVuZ3RoKSBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gZWxlbWVudHM7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIGFuY2VzdG9ycyhlbGVtZW50KSB7XG4gICAgcmV0dXJuIHJlY3Vyc2l2ZWx5Q29sbGVjdChlbGVtZW50LCAncGFyZW50Tm9kZScpO1xuICB9XG5cbiAgZnVuY3Rpb24gZGVzY2VuZGFudHMoZWxlbWVudCkge1xuICAgIHJldHVybiBFbGVtZW50LnNlbGVjdChlbGVtZW50LCAnKicpO1xuICB9XG5cbiAgZnVuY3Rpb24gZmlyc3REZXNjZW5kYW50KGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KS5maXJzdENoaWxkO1xuICAgIHdoaWxlIChlbGVtZW50ICYmIGVsZW1lbnQubm9kZVR5cGUgIT09IE5vZGUuRUxFTUVOVF9OT0RFKVxuICAgICAgZWxlbWVudCA9IGVsZW1lbnQubmV4dFNpYmxpbmc7XG5cbiAgICByZXR1cm4gJChlbGVtZW50KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGltbWVkaWF0ZURlc2NlbmRhbnRzKGVsZW1lbnQpIHtcbiAgICB2YXIgcmVzdWx0cyA9IFtdLCBjaGlsZCA9ICQoZWxlbWVudCkuZmlyc3RDaGlsZDtcblxuICAgIHdoaWxlIChjaGlsZCkge1xuICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSlcbiAgICAgICAgcmVzdWx0cy5wdXNoKEVsZW1lbnQuZXh0ZW5kKGNoaWxkKSk7XG5cbiAgICAgIGNoaWxkID0gY2hpbGQubmV4dFNpYmxpbmc7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICBmdW5jdGlvbiBwcmV2aW91c1NpYmxpbmdzKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gcmVjdXJzaXZlbHlDb2xsZWN0KGVsZW1lbnQsICdwcmV2aW91c1NpYmxpbmcnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG5leHRTaWJsaW5ncyhlbGVtZW50KSB7XG4gICAgcmV0dXJuIHJlY3Vyc2l2ZWx5Q29sbGVjdChlbGVtZW50LCAnbmV4dFNpYmxpbmcnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNpYmxpbmdzKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICB2YXIgcHJldmlvdXMgPSBwcmV2aW91c1NpYmxpbmdzKGVsZW1lbnQpLFxuICAgICBuZXh0ID0gbmV4dFNpYmxpbmdzKGVsZW1lbnQpO1xuICAgIHJldHVybiBwcmV2aW91cy5yZXZlcnNlKCkuY29uY2F0KG5leHQpO1xuICB9XG5cbiAgZnVuY3Rpb24gbWF0Y2goZWxlbWVudCwgc2VsZWN0b3IpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgIGlmIChPYmplY3QuaXNTdHJpbmcoc2VsZWN0b3IpKVxuICAgICAgcmV0dXJuIFByb3RvdHlwZS5TZWxlY3Rvci5tYXRjaChlbGVtZW50LCBzZWxlY3Rvcik7XG5cbiAgICByZXR1cm4gc2VsZWN0b3IubWF0Y2goZWxlbWVudCk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIF9yZWN1cnNpdmVseUZpbmQoZWxlbWVudCwgcHJvcGVydHksIGV4cHJlc3Npb24sIGluZGV4KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCksIGV4cHJlc3Npb24gPSBleHByZXNzaW9uIHx8IDAsIGluZGV4ID0gaW5kZXggfHwgMDtcbiAgICBpZiAoT2JqZWN0LmlzTnVtYmVyKGV4cHJlc3Npb24pKSB7XG4gICAgICBpbmRleCA9IGV4cHJlc3Npb24sIGV4cHJlc3Npb24gPSBudWxsO1xuICAgIH1cblxuICAgIHdoaWxlIChlbGVtZW50ID0gZWxlbWVudFtwcm9wZXJ0eV0pIHtcbiAgICAgIGlmIChlbGVtZW50Lm5vZGVUeXBlICE9PSAxKSBjb250aW51ZTtcbiAgICAgIGlmIChleHByZXNzaW9uICYmICFQcm90b3R5cGUuU2VsZWN0b3IubWF0Y2goZWxlbWVudCwgZXhwcmVzc2lvbikpXG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgaWYgKC0taW5kZXggPj0gMCkgY29udGludWU7XG5cbiAgICAgIHJldHVybiBFbGVtZW50LmV4dGVuZChlbGVtZW50KTtcbiAgICB9XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHVwKGVsZW1lbnQsIGV4cHJlc3Npb24sIGluZGV4KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgcmV0dXJuICQoZWxlbWVudC5wYXJlbnROb2RlKTtcbiAgICByZXR1cm4gX3JlY3Vyc2l2ZWx5RmluZChlbGVtZW50LCAncGFyZW50Tm9kZScsIGV4cHJlc3Npb24sIGluZGV4KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRvd24oZWxlbWVudCwgZXhwcmVzc2lvbiwgaW5kZXgpIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgcmV0dXJuIGZpcnN0RGVzY2VuZGFudChlbGVtZW50KTtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KSwgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24gfHwgMCwgaW5kZXggPSBpbmRleCB8fCAwO1xuXG4gICAgaWYgKE9iamVjdC5pc051bWJlcihleHByZXNzaW9uKSlcbiAgICAgIGluZGV4ID0gZXhwcmVzc2lvbiwgZXhwcmVzc2lvbiA9ICcqJztcblxuICAgIHZhciBub2RlID0gUHJvdG90eXBlLlNlbGVjdG9yLnNlbGVjdChleHByZXNzaW9uLCBlbGVtZW50KVtpbmRleF07XG4gICAgcmV0dXJuIEVsZW1lbnQuZXh0ZW5kKG5vZGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJldmlvdXMoZWxlbWVudCwgZXhwcmVzc2lvbiwgaW5kZXgpIHtcbiAgICByZXR1cm4gX3JlY3Vyc2l2ZWx5RmluZChlbGVtZW50LCAncHJldmlvdXNTaWJsaW5nJywgZXhwcmVzc2lvbiwgaW5kZXgpO1xuICB9XG5cbiAgZnVuY3Rpb24gbmV4dChlbGVtZW50LCBleHByZXNzaW9uLCBpbmRleCkge1xuICAgIHJldHVybiBfcmVjdXJzaXZlbHlGaW5kKGVsZW1lbnQsICduZXh0U2libGluZycsIGV4cHJlc3Npb24sIGluZGV4KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNlbGVjdChlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgdmFyIGV4cHJlc3Npb25zID0gU0xJQ0UuY2FsbChhcmd1bWVudHMsIDEpLmpvaW4oJywgJyk7XG4gICAgcmV0dXJuIFByb3RvdHlwZS5TZWxlY3Rvci5zZWxlY3QoZXhwcmVzc2lvbnMsIGVsZW1lbnQpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRqYWNlbnQoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBleHByZXNzaW9ucyA9IFNMSUNFLmNhbGwoYXJndW1lbnRzLCAxKS5qb2luKCcsICcpO1xuICAgIHZhciBzaWJsaW5ncyA9IEVsZW1lbnQuc2libGluZ3MoZWxlbWVudCksIHJlc3VsdHMgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMCwgc2libGluZzsgc2libGluZyA9IHNpYmxpbmdzW2ldOyBpKyspIHtcbiAgICAgIGlmIChQcm90b3R5cGUuU2VsZWN0b3IubWF0Y2goc2libGluZywgZXhwcmVzc2lvbnMpKVxuICAgICAgICByZXN1bHRzLnB1c2goc2libGluZyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICBmdW5jdGlvbiBkZXNjZW5kYW50T2ZfRE9NKGVsZW1lbnQsIGFuY2VzdG9yKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCksIGFuY2VzdG9yID0gJChhbmNlc3Rvcik7XG4gICAgd2hpbGUgKGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGUpXG4gICAgICBpZiAoZWxlbWVudCA9PT0gYW5jZXN0b3IpIHJldHVybiB0cnVlO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlc2NlbmRhbnRPZl9jb250YWlucyhlbGVtZW50LCBhbmNlc3Rvcikge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpLCBhbmNlc3RvciA9ICQoYW5jZXN0b3IpO1xuICAgIGlmICghYW5jZXN0b3IuY29udGFpbnMpIHJldHVybiBkZXNjZW5kYW50T2ZfRE9NKGVsZW1lbnQsIGFuY2VzdG9yKTtcbiAgICByZXR1cm4gYW5jZXN0b3IuY29udGFpbnMoZWxlbWVudCkgJiYgYW5jZXN0b3IgIT09IGVsZW1lbnQ7XG4gIH1cblxuICBmdW5jdGlvbiBkZXNjZW5kYW50T2ZfY29tcGFyZURvY3VtZW50UG9zaXRpb24oZWxlbWVudCwgYW5jZXN0b3IpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KSwgYW5jZXN0b3IgPSAkKGFuY2VzdG9yKTtcbiAgICByZXR1cm4gKGVsZW1lbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYW5jZXN0b3IpICYgOCkgPT09IDg7XG4gIH1cblxuICB2YXIgZGVzY2VuZGFudE9mO1xuICBpZiAoRElWLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKSB7XG4gICAgZGVzY2VuZGFudE9mID0gZGVzY2VuZGFudE9mX2NvbXBhcmVEb2N1bWVudFBvc2l0aW9uO1xuICB9IGVsc2UgaWYgKERJVi5jb250YWlucykge1xuICAgIGRlc2NlbmRhbnRPZiA9IGRlc2NlbmRhbnRPZl9jb250YWlucztcbiAgfSBlbHNlIHtcbiAgICBkZXNjZW5kYW50T2YgPSBkZXNjZW5kYW50T2ZfRE9NO1xuICB9XG5cblxuICBPYmplY3QuZXh0ZW5kKG1ldGhvZHMsIHtcbiAgICByZWN1cnNpdmVseUNvbGxlY3Q6ICAgcmVjdXJzaXZlbHlDb2xsZWN0LFxuICAgIGFuY2VzdG9yczogICAgICAgICAgICBhbmNlc3RvcnMsXG4gICAgZGVzY2VuZGFudHM6ICAgICAgICAgIGRlc2NlbmRhbnRzLFxuICAgIGZpcnN0RGVzY2VuZGFudDogICAgICBmaXJzdERlc2NlbmRhbnQsXG4gICAgaW1tZWRpYXRlRGVzY2VuZGFudHM6IGltbWVkaWF0ZURlc2NlbmRhbnRzLFxuICAgIHByZXZpb3VzU2libGluZ3M6ICAgICBwcmV2aW91c1NpYmxpbmdzLFxuICAgIG5leHRTaWJsaW5nczogICAgICAgICBuZXh0U2libGluZ3MsXG4gICAgc2libGluZ3M6ICAgICAgICAgICAgIHNpYmxpbmdzLFxuICAgIG1hdGNoOiAgICAgICAgICAgICAgICBtYXRjaCxcbiAgICB1cDogICAgICAgICAgICAgICAgICAgdXAsXG4gICAgZG93bjogICAgICAgICAgICAgICAgIGRvd24sXG4gICAgcHJldmlvdXM6ICAgICAgICAgICAgIHByZXZpb3VzLFxuICAgIG5leHQ6ICAgICAgICAgICAgICAgICBuZXh0LFxuICAgIHNlbGVjdDogICAgICAgICAgICAgICBzZWxlY3QsXG4gICAgYWRqYWNlbnQ6ICAgICAgICAgICAgIGFkamFjZW50LFxuICAgIGRlc2NlbmRhbnRPZjogICAgICAgICBkZXNjZW5kYW50T2YsXG5cbiAgICBnZXRFbGVtZW50c0J5U2VsZWN0b3I6IHNlbGVjdCxcblxuICAgIGNoaWxkRWxlbWVudHM6ICAgICAgICAgaW1tZWRpYXRlRGVzY2VuZGFudHNcbiAgfSk7XG5cblxuICB2YXIgaWRDb3VudGVyID0gMTtcbiAgZnVuY3Rpb24gaWRlbnRpZnkoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBpZCA9IEVsZW1lbnQucmVhZEF0dHJpYnV0ZShlbGVtZW50LCAnaWQnKTtcbiAgICBpZiAoaWQpIHJldHVybiBpZDtcblxuICAgIGRvIHsgaWQgPSAnYW5vbnltb3VzX2VsZW1lbnRfJyArIGlkQ291bnRlcisrIH0gd2hpbGUgKCQoaWQpKTtcblxuICAgIEVsZW1lbnQud3JpdGVBdHRyaWJ1dGUoZWxlbWVudCwgJ2lkJywgaWQpO1xuICAgIHJldHVybiBpZDtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gcmVhZEF0dHJpYnV0ZShlbGVtZW50LCBuYW1lKSB7XG4gICAgcmV0dXJuICQoZWxlbWVudCkuZ2V0QXR0cmlidXRlKG5hbWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVhZEF0dHJpYnV0ZV9JRShlbGVtZW50LCBuYW1lKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICB2YXIgdGFibGUgPSBBVFRSSUJVVEVfVFJBTlNMQVRJT05TLnJlYWQ7XG4gICAgaWYgKHRhYmxlLnZhbHVlc1tuYW1lXSlcbiAgICAgIHJldHVybiB0YWJsZS52YWx1ZXNbbmFtZV0oZWxlbWVudCwgbmFtZSk7XG5cbiAgICBpZiAodGFibGUubmFtZXNbbmFtZV0pIG5hbWUgPSB0YWJsZS5uYW1lc1tuYW1lXTtcblxuICAgIGlmIChuYW1lLmluY2x1ZGUoJzonKSkge1xuICAgICAgaWYgKCFlbGVtZW50LmF0dHJpYnV0ZXMgfHwgIWVsZW1lbnQuYXR0cmlidXRlc1tuYW1lXSkgcmV0dXJuIG51bGw7XG4gICAgICByZXR1cm4gZWxlbWVudC5hdHRyaWJ1dGVzW25hbWVdLnZhbHVlO1xuICAgIH1cblxuICAgIHJldHVybiBlbGVtZW50LmdldEF0dHJpYnV0ZShuYW1lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRBdHRyaWJ1dGVfT3BlcmEoZWxlbWVudCwgbmFtZSkge1xuICAgIGlmIChuYW1lID09PSAndGl0bGUnKSByZXR1cm4gZWxlbWVudC50aXRsZTtcbiAgICByZXR1cm4gZWxlbWVudC5nZXRBdHRyaWJ1dGUobmFtZSk7XG4gIH1cblxuICB2YXIgUFJPQkxFTUFUSUNfQVRUUklCVVRFX1JFQURJTkcgPSAoZnVuY3Rpb24oKSB7XG4gICAgRElWLnNldEF0dHJpYnV0ZSgnb25jbGljaycsIFtdKTtcbiAgICB2YXIgdmFsdWUgPSBESVYuZ2V0QXR0cmlidXRlKCdvbmNsaWNrJyk7XG4gICAgdmFyIGlzRnVuY3Rpb24gPSBPYmplY3QuaXNBcnJheSh2YWx1ZSk7XG4gICAgRElWLnJlbW92ZUF0dHJpYnV0ZSgnb25jbGljaycpO1xuICAgIHJldHVybiBpc0Z1bmN0aW9uO1xuICB9KSgpO1xuXG4gIGlmIChQUk9CTEVNQVRJQ19BVFRSSUJVVEVfUkVBRElORykge1xuICAgIHJlYWRBdHRyaWJ1dGUgPSByZWFkQXR0cmlidXRlX0lFO1xuICB9IGVsc2UgaWYgKFByb3RvdHlwZS5Ccm93c2VyLk9wZXJhKSB7XG4gICAgcmVhZEF0dHJpYnV0ZSA9IHJlYWRBdHRyaWJ1dGVfT3BlcmE7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHdyaXRlQXR0cmlidXRlKGVsZW1lbnQsIG5hbWUsIHZhbHVlKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgdmFyIGF0dHJpYnV0ZXMgPSB7fSwgdGFibGUgPSBBVFRSSUJVVEVfVFJBTlNMQVRJT05TLndyaXRlO1xuXG4gICAgaWYgKHR5cGVvZiBuYW1lID09PSAnb2JqZWN0Jykge1xuICAgICAgYXR0cmlidXRlcyA9IG5hbWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF0dHJpYnV0ZXNbbmFtZV0gPSBPYmplY3QuaXNVbmRlZmluZWQodmFsdWUpID8gdHJ1ZSA6IHZhbHVlO1xuICAgIH1cblxuICAgIGZvciAodmFyIGF0dHIgaW4gYXR0cmlidXRlcykge1xuICAgICAgbmFtZSA9IHRhYmxlLm5hbWVzW2F0dHJdIHx8IGF0dHI7XG4gICAgICB2YWx1ZSA9IGF0dHJpYnV0ZXNbYXR0cl07XG4gICAgICBpZiAodGFibGUudmFsdWVzW2F0dHJdKVxuICAgICAgICBuYW1lID0gdGFibGUudmFsdWVzW2F0dHJdKGVsZW1lbnQsIHZhbHVlKSB8fCBuYW1lO1xuICAgICAgaWYgKHZhbHVlID09PSBmYWxzZSB8fCB2YWx1ZSA9PT0gbnVsbClcbiAgICAgICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUobmFtZSk7XG4gICAgICBlbHNlIGlmICh2YWx1ZSA9PT0gdHJ1ZSlcbiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUobmFtZSwgbmFtZSk7XG4gICAgICBlbHNlIGVsZW1lbnQuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIHZhciBQUk9CTEVNQVRJQ19IQVNfQVRUUklCVVRFX1dJVEhfQ0hFQ0tCT1hFUyA9IChmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCFIQVNfRVhURU5ERURfQ1JFQVRFX0VMRU1FTlRfU1lOVEFYKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHZhciBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJzxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIj4nKTtcbiAgICBjaGVja2JveC5jaGVja2VkID0gdHJ1ZTtcbiAgICB2YXIgbm9kZSA9IGNoZWNrYm94LmdldEF0dHJpYnV0ZU5vZGUoJ2NoZWNrZWQnKTtcbiAgICByZXR1cm4gIW5vZGUgfHwgIW5vZGUuc3BlY2lmaWVkO1xuICB9KSgpO1xuXG4gIGZ1bmN0aW9uIGhhc0F0dHJpYnV0ZShlbGVtZW50LCBhdHRyaWJ1dGUpIHtcbiAgICBhdHRyaWJ1dGUgPSBBVFRSSUJVVEVfVFJBTlNMQVRJT05TLmhhc1thdHRyaWJ1dGVdIHx8IGF0dHJpYnV0ZTtcbiAgICB2YXIgbm9kZSA9ICQoZWxlbWVudCkuZ2V0QXR0cmlidXRlTm9kZShhdHRyaWJ1dGUpO1xuICAgIHJldHVybiAhIShub2RlICYmIG5vZGUuc3BlY2lmaWVkKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhhc0F0dHJpYnV0ZV9JRShlbGVtZW50LCBhdHRyaWJ1dGUpIHtcbiAgICBpZiAoYXR0cmlidXRlID09PSAnY2hlY2tlZCcpIHtcbiAgICAgIHJldHVybiBlbGVtZW50LmNoZWNrZWQ7XG4gICAgfVxuICAgIHJldHVybiBoYXNBdHRyaWJ1dGUoZWxlbWVudCwgYXR0cmlidXRlKTtcbiAgfVxuXG4gIEdMT0JBTC5FbGVtZW50Lk1ldGhvZHMuU2ltdWxhdGVkLmhhc0F0dHJpYnV0ZSA9XG4gICBQUk9CTEVNQVRJQ19IQVNfQVRUUklCVVRFX1dJVEhfQ0hFQ0tCT1hFUyA/XG4gICBoYXNBdHRyaWJ1dGVfSUUgOiBoYXNBdHRyaWJ1dGU7XG5cbiAgZnVuY3Rpb24gY2xhc3NOYW1lcyhlbGVtZW50KSB7XG4gICAgcmV0dXJuIG5ldyBFbGVtZW50LkNsYXNzTmFtZXMoZWxlbWVudCk7XG4gIH1cblxuICB2YXIgcmVnRXhwQ2FjaGUgPSB7fTtcbiAgZnVuY3Rpb24gZ2V0UmVnRXhwRm9yQ2xhc3NOYW1lKGNsYXNzTmFtZSkge1xuICAgIGlmIChyZWdFeHBDYWNoZVtjbGFzc05hbWVdKSByZXR1cm4gcmVnRXhwQ2FjaGVbY2xhc3NOYW1lXTtcblxuICAgIHZhciByZSA9IG5ldyBSZWdFeHAoXCIoXnxcXFxccyspXCIgKyBjbGFzc05hbWUgKyBcIihcXFxccyt8JClcIik7XG4gICAgcmVnRXhwQ2FjaGVbY2xhc3NOYW1lXSA9IHJlO1xuICAgIHJldHVybiByZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhhc0NsYXNzTmFtZShlbGVtZW50LCBjbGFzc05hbWUpIHtcbiAgICBpZiAoIShlbGVtZW50ID0gJChlbGVtZW50KSkpIHJldHVybjtcblxuICAgIHZhciBlbGVtZW50Q2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWU7XG5cbiAgICBpZiAoZWxlbWVudENsYXNzTmFtZS5sZW5ndGggPT09IDApIHJldHVybiBmYWxzZTtcbiAgICBpZiAoZWxlbWVudENsYXNzTmFtZSA9PT0gY2xhc3NOYW1lKSByZXR1cm4gdHJ1ZTtcblxuICAgIHJldHVybiBnZXRSZWdFeHBGb3JDbGFzc05hbWUoY2xhc3NOYW1lKS50ZXN0KGVsZW1lbnRDbGFzc05hbWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkQ2xhc3NOYW1lKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICAgIGlmICghKGVsZW1lbnQgPSAkKGVsZW1lbnQpKSkgcmV0dXJuO1xuXG4gICAgaWYgKCFoYXNDbGFzc05hbWUoZWxlbWVudCwgY2xhc3NOYW1lKSlcbiAgICAgIGVsZW1lbnQuY2xhc3NOYW1lICs9IChlbGVtZW50LmNsYXNzTmFtZSA/ICcgJyA6ICcnKSArIGNsYXNzTmFtZTtcblxuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlQ2xhc3NOYW1lKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICAgIGlmICghKGVsZW1lbnQgPSAkKGVsZW1lbnQpKSkgcmV0dXJuO1xuXG4gICAgZWxlbWVudC5jbGFzc05hbWUgPSBlbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKFxuICAgICBnZXRSZWdFeHBGb3JDbGFzc05hbWUoY2xhc3NOYW1lKSwgJyAnKS5zdHJpcCgpO1xuXG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICBmdW5jdGlvbiB0b2dnbGVDbGFzc05hbWUoZWxlbWVudCwgY2xhc3NOYW1lLCBib29sKSB7XG4gICAgaWYgKCEoZWxlbWVudCA9ICQoZWxlbWVudCkpKSByZXR1cm47XG5cbiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKGJvb2wpKVxuICAgICAgYm9vbCA9ICFoYXNDbGFzc05hbWUoZWxlbWVudCwgY2xhc3NOYW1lKTtcblxuICAgIHZhciBtZXRob2QgPSBFbGVtZW50W2Jvb2wgPyAnYWRkQ2xhc3NOYW1lJyA6ICdyZW1vdmVDbGFzc05hbWUnXTtcbiAgICByZXR1cm4gbWV0aG9kKGVsZW1lbnQsIGNsYXNzTmFtZSk7XG4gIH1cblxuICB2YXIgQVRUUklCVVRFX1RSQU5TTEFUSU9OUyA9IHt9O1xuXG4gIHZhciBjbGFzc1Byb3AgPSAnY2xhc3NOYW1lJywgZm9yUHJvcCA9ICdmb3InO1xuXG4gIERJVi5zZXRBdHRyaWJ1dGUoY2xhc3NQcm9wLCAneCcpO1xuICBpZiAoRElWLmNsYXNzTmFtZSAhPT0gJ3gnKSB7XG4gICAgRElWLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAneCcpO1xuICAgIGlmIChESVYuY2xhc3NOYW1lID09PSAneCcpXG4gICAgICBjbGFzc1Byb3AgPSAnY2xhc3MnO1xuICB9XG5cbiAgdmFyIExBQkVMID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgTEFCRUwuc2V0QXR0cmlidXRlKGZvclByb3AsICd4Jyk7XG4gIGlmIChMQUJFTC5odG1sRm9yICE9PSAneCcpIHtcbiAgICBMQUJFTC5zZXRBdHRyaWJ1dGUoJ2h0bWxGb3InLCAneCcpO1xuICAgIGlmIChMQUJFTC5odG1sRm9yID09PSAneCcpXG4gICAgICBmb3JQcm9wID0gJ2h0bWxGb3InO1xuICB9XG4gIExBQkVMID0gbnVsbDtcblxuICBmdW5jdGlvbiBfZ2V0QXR0cihlbGVtZW50LCBhdHRyaWJ1dGUpIHtcbiAgICByZXR1cm4gZWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRBdHRyMihlbGVtZW50LCBhdHRyaWJ1dGUpIHtcbiAgICByZXR1cm4gZWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlLCAyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRBdHRyTm9kZShlbGVtZW50LCBhdHRyaWJ1dGUpIHtcbiAgICB2YXIgbm9kZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlTm9kZShhdHRyaWJ1dGUpO1xuICAgIHJldHVybiBub2RlID8gbm9kZS52YWx1ZSA6ICcnO1xuICB9XG5cbiAgZnVuY3Rpb24gX2dldEZsYWcoZWxlbWVudCwgYXR0cmlidXRlKSB7XG4gICAgcmV0dXJuICQoZWxlbWVudCkuaGFzQXR0cmlidXRlKGF0dHJpYnV0ZSkgPyBhdHRyaWJ1dGUgOiBudWxsO1xuICB9XG5cbiAgRElWLm9uY2xpY2sgPSBQcm90b3R5cGUuZW1wdHlGdW5jdGlvbjtcbiAgdmFyIG9uY2xpY2tWYWx1ZSA9IERJVi5nZXRBdHRyaWJ1dGUoJ29uY2xpY2snKTtcblxuICB2YXIgX2dldEV2O1xuXG4gIGlmIChTdHJpbmcob25jbGlja1ZhbHVlKS5pbmRleE9mKCd7JykgPiAtMSkge1xuICAgIF9nZXRFdiA9IGZ1bmN0aW9uKGVsZW1lbnQsIGF0dHJpYnV0ZSkge1xuICAgICAgdmFyIHZhbHVlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKTtcbiAgICAgIGlmICghdmFsdWUpIHJldHVybiBudWxsO1xuICAgICAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpO1xuICAgICAgdmFsdWUgPSB2YWx1ZS5zcGxpdCgneycpWzFdO1xuICAgICAgdmFsdWUgPSB2YWx1ZS5zcGxpdCgnfScpWzBdO1xuICAgICAgcmV0dXJuIHZhbHVlLnN0cmlwKCk7XG4gICAgfTtcbiAgfVxuICBlbHNlIGlmIChvbmNsaWNrVmFsdWUgPT09ICcnKSB7XG4gICAgX2dldEV2ID0gZnVuY3Rpb24oZWxlbWVudCwgYXR0cmlidXRlKSB7XG4gICAgICB2YXIgdmFsdWUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpO1xuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuIG51bGw7XG4gICAgICByZXR1cm4gdmFsdWUuc3RyaXAoKTtcbiAgICB9O1xuICB9XG5cbiAgQVRUUklCVVRFX1RSQU5TTEFUSU9OUy5yZWFkID0ge1xuICAgIG5hbWVzOiB7XG4gICAgICAnY2xhc3MnOiAgICAgY2xhc3NQcm9wLFxuICAgICAgJ2NsYXNzTmFtZSc6IGNsYXNzUHJvcCxcbiAgICAgICdmb3InOiAgICAgICBmb3JQcm9wLFxuICAgICAgJ2h0bWxGb3InOiAgIGZvclByb3BcbiAgICB9LFxuXG4gICAgdmFsdWVzOiB7XG4gICAgICBzdHlsZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZWxlbWVudC5zdHlsZS5jc3NUZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgICB9LFxuICAgICAgdGl0bGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQudGl0bGU7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIEFUVFJJQlVURV9UUkFOU0xBVElPTlMud3JpdGUgPSB7XG4gICAgbmFtZXM6IHtcbiAgICAgIGNsYXNzTmFtZTogICAnY2xhc3MnLFxuICAgICAgaHRtbEZvcjogICAgICdmb3InLFxuICAgICAgY2VsbHBhZGRpbmc6ICdjZWxsUGFkZGluZycsXG4gICAgICBjZWxsc3BhY2luZzogJ2NlbGxTcGFjaW5nJ1xuICAgIH0sXG5cbiAgICB2YWx1ZXM6IHtcbiAgICAgIGNoZWNrZWQ6IGZ1bmN0aW9uKGVsZW1lbnQsIHZhbHVlKSB7XG4gICAgICAgIGVsZW1lbnQuY2hlY2tlZCA9ICEhdmFsdWU7XG4gICAgICB9LFxuXG4gICAgICBzdHlsZTogZnVuY3Rpb24oZWxlbWVudCwgdmFsdWUpIHtcbiAgICAgICAgZWxlbWVudC5zdHlsZS5jc3NUZXh0ID0gdmFsdWUgPyB2YWx1ZSA6ICcnO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBBVFRSSUJVVEVfVFJBTlNMQVRJT05TLmhhcyA9IHsgbmFtZXM6IHt9IH07XG5cbiAgT2JqZWN0LmV4dGVuZChBVFRSSUJVVEVfVFJBTlNMQVRJT05TLndyaXRlLm5hbWVzLFxuICAgQVRUUklCVVRFX1RSQU5TTEFUSU9OUy5yZWFkLm5hbWVzKTtcblxuICB2YXIgQ0FNRUxfQ0FTRURfQVRUUklCVVRFX05BTUVTID0gJHcoJ2NvbFNwYW4gcm93U3BhbiB2QWxpZ24gZGF0ZVRpbWUgJyArXG4gICAnYWNjZXNzS2V5IHRhYkluZGV4IGVuY1R5cGUgbWF4TGVuZ3RoIHJlYWRPbmx5IGxvbmdEZXNjIGZyYW1lQm9yZGVyJyk7XG5cbiAgZm9yICh2YXIgaSA9IDAsIGF0dHI7IGF0dHIgPSBDQU1FTF9DQVNFRF9BVFRSSUJVVEVfTkFNRVNbaV07IGkrKykge1xuICAgIEFUVFJJQlVURV9UUkFOU0xBVElPTlMud3JpdGUubmFtZXNbYXR0ci50b0xvd2VyQ2FzZSgpXSA9IGF0dHI7XG4gICAgQVRUUklCVVRFX1RSQU5TTEFUSU9OUy5oYXMubmFtZXNbYXR0ci50b0xvd2VyQ2FzZSgpXSAgID0gYXR0cjtcbiAgfVxuXG4gIE9iamVjdC5leHRlbmQoQVRUUklCVVRFX1RSQU5TTEFUSU9OUy5yZWFkLnZhbHVlcywge1xuICAgIGhyZWY6ICAgICAgICBfZ2V0QXR0cjIsXG4gICAgc3JjOiAgICAgICAgIF9nZXRBdHRyMixcbiAgICB0eXBlOiAgICAgICAgX2dldEF0dHIsXG4gICAgYWN0aW9uOiAgICAgIF9nZXRBdHRyTm9kZSxcbiAgICBkaXNhYmxlZDogICAgX2dldEZsYWcsXG4gICAgY2hlY2tlZDogICAgIF9nZXRGbGFnLFxuICAgIHJlYWRvbmx5OiAgICBfZ2V0RmxhZyxcbiAgICBtdWx0aXBsZTogICAgX2dldEZsYWcsXG4gICAgb25sb2FkOiAgICAgIF9nZXRFdixcbiAgICBvbnVubG9hZDogICAgX2dldEV2LFxuICAgIG9uY2xpY2s6ICAgICBfZ2V0RXYsXG4gICAgb25kYmxjbGljazogIF9nZXRFdixcbiAgICBvbm1vdXNlZG93bjogX2dldEV2LFxuICAgIG9ubW91c2V1cDogICBfZ2V0RXYsXG4gICAgb25tb3VzZW92ZXI6IF9nZXRFdixcbiAgICBvbm1vdXNlbW92ZTogX2dldEV2LFxuICAgIG9ubW91c2VvdXQ6ICBfZ2V0RXYsXG4gICAgb25mb2N1czogICAgIF9nZXRFdixcbiAgICBvbmJsdXI6ICAgICAgX2dldEV2LFxuICAgIG9ua2V5cHJlc3M6ICBfZ2V0RXYsXG4gICAgb25rZXlkb3duOiAgIF9nZXRFdixcbiAgICBvbmtleXVwOiAgICAgX2dldEV2LFxuICAgIG9uc3VibWl0OiAgICBfZ2V0RXYsXG4gICAgb25yZXNldDogICAgIF9nZXRFdixcbiAgICBvbnNlbGVjdDogICAgX2dldEV2LFxuICAgIG9uY2hhbmdlOiAgICBfZ2V0RXZcbiAgfSk7XG5cblxuICBPYmplY3QuZXh0ZW5kKG1ldGhvZHMsIHtcbiAgICBpZGVudGlmeTogICAgICAgIGlkZW50aWZ5LFxuICAgIHJlYWRBdHRyaWJ1dGU6ICAgcmVhZEF0dHJpYnV0ZSxcbiAgICB3cml0ZUF0dHJpYnV0ZTogIHdyaXRlQXR0cmlidXRlLFxuICAgIGNsYXNzTmFtZXM6ICAgICAgY2xhc3NOYW1lcyxcbiAgICBoYXNDbGFzc05hbWU6ICAgIGhhc0NsYXNzTmFtZSxcbiAgICBhZGRDbGFzc05hbWU6ICAgIGFkZENsYXNzTmFtZSxcbiAgICByZW1vdmVDbGFzc05hbWU6IHJlbW92ZUNsYXNzTmFtZSxcbiAgICB0b2dnbGVDbGFzc05hbWU6IHRvZ2dsZUNsYXNzTmFtZVxuICB9KTtcblxuXG4gIGZ1bmN0aW9uIG5vcm1hbGl6ZVN0eWxlTmFtZShzdHlsZSkge1xuICAgIGlmIChzdHlsZSA9PT0gJ2Zsb2F0JyB8fCBzdHlsZSA9PT0gJ3N0eWxlRmxvYXQnKVxuICAgICAgcmV0dXJuICdjc3NGbG9hdCc7XG4gICAgcmV0dXJuIHN0eWxlLmNhbWVsaXplKCk7XG4gIH1cblxuICBmdW5jdGlvbiBub3JtYWxpemVTdHlsZU5hbWVfSUUoc3R5bGUpIHtcbiAgICBpZiAoc3R5bGUgPT09ICdmbG9hdCcgfHwgc3R5bGUgPT09ICdjc3NGbG9hdCcpXG4gICAgICByZXR1cm4gJ3N0eWxlRmxvYXQnO1xuICAgIHJldHVybiBzdHlsZS5jYW1lbGl6ZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0U3R5bGUoZWxlbWVudCwgc3R5bGVzKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgdmFyIGVsZW1lbnRTdHlsZSA9IGVsZW1lbnQuc3R5bGUsIG1hdGNoO1xuXG4gICAgaWYgKE9iamVjdC5pc1N0cmluZyhzdHlsZXMpKSB7XG4gICAgICBlbGVtZW50U3R5bGUuY3NzVGV4dCArPSAnOycgKyBzdHlsZXM7XG4gICAgICBpZiAoc3R5bGVzLmluY2x1ZGUoJ29wYWNpdHknKSkge1xuICAgICAgICB2YXIgb3BhY2l0eSA9IHN0eWxlcy5tYXRjaCgvb3BhY2l0eTpcXHMqKFxcZD9cXC4/XFxkKikvKVsxXTtcbiAgICAgICAgRWxlbWVudC5zZXRPcGFjaXR5KGVsZW1lbnQsIG9wYWNpdHkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgcHJvcGVydHkgaW4gc3R5bGVzKSB7XG4gICAgICBpZiAocHJvcGVydHkgPT09ICdvcGFjaXR5Jykge1xuICAgICAgICBFbGVtZW50LnNldE9wYWNpdHkoZWxlbWVudCwgc3R5bGVzW3Byb3BlcnR5XSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdmFsdWUgPSBzdHlsZXNbcHJvcGVydHldO1xuICAgICAgICBpZiAocHJvcGVydHkgPT09ICdmbG9hdCcgfHwgcHJvcGVydHkgPT09ICdjc3NGbG9hdCcpIHtcbiAgICAgICAgICBwcm9wZXJ0eSA9IE9iamVjdC5pc1VuZGVmaW5lZChlbGVtZW50U3R5bGUuc3R5bGVGbG9hdCkgP1xuICAgICAgICAgICAnY3NzRmxvYXQnIDogJ3N0eWxlRmxvYXQnO1xuICAgICAgICB9XG4gICAgICAgIGVsZW1lbnRTdHlsZVtwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gZ2V0U3R5bGUoZWxlbWVudCwgc3R5bGUpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICBzdHlsZSA9IG5vcm1hbGl6ZVN0eWxlTmFtZShzdHlsZSk7XG5cbiAgICB2YXIgdmFsdWUgPSBlbGVtZW50LnN0eWxlW3N0eWxlXTtcbiAgICBpZiAoIXZhbHVlIHx8IHZhbHVlID09PSAnYXV0bycpIHtcbiAgICAgIHZhciBjc3MgPSBkb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsIG51bGwpO1xuICAgICAgdmFsdWUgPSBjc3MgPyBjc3Nbc3R5bGVdIDogbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoc3R5bGUgPT09ICdvcGFjaXR5JykgcmV0dXJuIHZhbHVlID8gcGFyc2VGbG9hdCh2YWx1ZSkgOiAxLjA7XG4gICAgcmV0dXJuIHZhbHVlID09PSAnYXV0bycgPyBudWxsIDogdmFsdWU7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTdHlsZV9PcGVyYShlbGVtZW50LCBzdHlsZSkge1xuICAgIHN3aXRjaCAoc3R5bGUpIHtcbiAgICAgIGNhc2UgJ2hlaWdodCc6IGNhc2UgJ3dpZHRoJzpcbiAgICAgICAgaWYgKCFFbGVtZW50LnZpc2libGUoZWxlbWVudCkpIHJldHVybiBudWxsO1xuXG4gICAgICAgIHZhciBkaW0gPSBwYXJzZUludChnZXRTdHlsZShlbGVtZW50LCBzdHlsZSksIDEwKTtcblxuICAgICAgICBpZiAoZGltICE9PSBlbGVtZW50WydvZmZzZXQnICsgc3R5bGUuY2FwaXRhbGl6ZSgpXSlcbiAgICAgICAgICByZXR1cm4gZGltICsgJ3B4JztcblxuICAgICAgICByZXR1cm4gRWxlbWVudC5tZWFzdXJlKGVsZW1lbnQsIHN0eWxlKTtcblxuICAgICAgZGVmYXVsdDogcmV0dXJuIGdldFN0eWxlKGVsZW1lbnQsIHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTdHlsZV9JRShlbGVtZW50LCBzdHlsZSkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHN0eWxlID0gbm9ybWFsaXplU3R5bGVOYW1lX0lFKHN0eWxlKTtcblxuICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQuc3R5bGVbc3R5bGVdO1xuICAgIGlmICghdmFsdWUgJiYgZWxlbWVudC5jdXJyZW50U3R5bGUpIHtcbiAgICAgIHZhbHVlID0gZWxlbWVudC5jdXJyZW50U3R5bGVbc3R5bGVdO1xuICAgIH1cblxuICAgIGlmIChzdHlsZSA9PT0gJ29wYWNpdHknICYmICFTVEFOREFSRF9DU1NfT1BBQ0lUWV9TVVBQT1JURUQpXG4gICAgICByZXR1cm4gZ2V0T3BhY2l0eV9JRShlbGVtZW50KTtcblxuICAgIGlmICh2YWx1ZSA9PT0gJ2F1dG8nKSB7XG4gICAgICBpZiAoKHN0eWxlID09PSAnd2lkdGgnIHx8IHN0eWxlID09PSAnaGVpZ2h0JykgJiYgRWxlbWVudC52aXNpYmxlKGVsZW1lbnQpKVxuICAgICAgICByZXR1cm4gRWxlbWVudC5tZWFzdXJlKGVsZW1lbnQsIHN0eWxlKSArICdweCc7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICBmdW5jdGlvbiBzdHJpcEFscGhhRnJvbUZpbHRlcl9JRShmaWx0ZXIpIHtcbiAgICByZXR1cm4gKGZpbHRlciB8fCAnJykucmVwbGFjZSgvYWxwaGFcXChbXlxcKV0qXFwpL2dpLCAnJyk7XG4gIH1cblxuICBmdW5jdGlvbiBoYXNMYXlvdXRfSUUoZWxlbWVudCkge1xuICAgIGlmICghZWxlbWVudC5jdXJyZW50U3R5bGUgfHwgIWVsZW1lbnQuY3VycmVudFN0eWxlLmhhc0xheW91dClcbiAgICAgIGVsZW1lbnQuc3R5bGUuem9vbSA9IDE7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICB2YXIgU1RBTkRBUkRfQ1NTX09QQUNJVFlfU1VQUE9SVEVEID0gKGZ1bmN0aW9uKCkge1xuICAgIERJVi5zdHlsZS5jc3NUZXh0ID0gXCJvcGFjaXR5Oi41NVwiO1xuICAgIHJldHVybiAvXjAuNTUvLnRlc3QoRElWLnN0eWxlLm9wYWNpdHkpO1xuICB9KSgpO1xuXG4gIGZ1bmN0aW9uIHNldE9wYWNpdHkoZWxlbWVudCwgdmFsdWUpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICBpZiAodmFsdWUgPT0gMSB8fCB2YWx1ZSA9PT0gJycpIHZhbHVlID0gJyc7XG4gICAgZWxzZSBpZiAodmFsdWUgPCAwLjAwMDAxKSB2YWx1ZSA9IDA7XG4gICAgZWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gdmFsdWU7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRPcGFjaXR5X0lFKGVsZW1lbnQsIHZhbHVlKSB7XG4gICAgaWYgKFNUQU5EQVJEX0NTU19PUEFDSVRZX1NVUFBPUlRFRClcbiAgICAgIHJldHVybiBzZXRPcGFjaXR5KGVsZW1lbnQsIHZhbHVlKTtcblxuICAgIGVsZW1lbnQgPSBoYXNMYXlvdXRfSUUoJChlbGVtZW50KSk7XG4gICAgdmFyIGZpbHRlciA9IEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwgJ2ZpbHRlcicpLFxuICAgICBzdHlsZSA9IGVsZW1lbnQuc3R5bGU7XG5cbiAgICBpZiAodmFsdWUgPT0gMSB8fCB2YWx1ZSA9PT0gJycpIHtcbiAgICAgIGZpbHRlciA9IHN0cmlwQWxwaGFGcm9tRmlsdGVyX0lFKGZpbHRlcik7XG4gICAgICBpZiAoZmlsdGVyKSBzdHlsZS5maWx0ZXIgPSBmaWx0ZXI7XG4gICAgICBlbHNlIHN0eWxlLnJlbW92ZUF0dHJpYnV0ZSgnZmlsdGVyJyk7XG4gICAgICByZXR1cm4gZWxlbWVudDtcbiAgICB9XG5cbiAgICBpZiAodmFsdWUgPCAwLjAwMDAxKSB2YWx1ZSA9IDA7XG5cbiAgICBzdHlsZS5maWx0ZXIgPSBzdHJpcEFscGhhRnJvbUZpbHRlcl9JRShmaWx0ZXIpICtcbiAgICAgJ2FscGhhKG9wYWNpdHk9JyArICh2YWx1ZSAqIDEwMCkgKyAnKSc7XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gZ2V0T3BhY2l0eShlbGVtZW50KSB7XG4gICAgcmV0dXJuIEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwgJ29wYWNpdHknKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldE9wYWNpdHlfSUUoZWxlbWVudCkge1xuICAgIGlmIChTVEFOREFSRF9DU1NfT1BBQ0lUWV9TVVBQT1JURUQpXG4gICAgICByZXR1cm4gZ2V0T3BhY2l0eShlbGVtZW50KTtcblxuICAgIHZhciBmaWx0ZXIgPSBFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdmaWx0ZXInKTtcbiAgICBpZiAoZmlsdGVyLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDEuMDtcbiAgICB2YXIgbWF0Y2ggPSAoZmlsdGVyIHx8ICcnKS5tYXRjaCgvYWxwaGFcXChvcGFjaXR5PSguKilcXCkvKTtcbiAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHJldHVybiBwYXJzZUZsb2F0KG1hdGNoWzFdKSAvIDEwMDtcbiAgICByZXR1cm4gMS4wO1xuICB9XG5cblxuICBPYmplY3QuZXh0ZW5kKG1ldGhvZHMsIHtcbiAgICBzZXRTdHlsZTogICBzZXRTdHlsZSxcbiAgICBnZXRTdHlsZTogICBnZXRTdHlsZSxcbiAgICBzZXRPcGFjaXR5OiBzZXRPcGFjaXR5LFxuICAgIGdldE9wYWNpdHk6IGdldE9wYWNpdHlcbiAgfSk7XG5cbiAgaWYgKCdzdHlsZUZsb2F0JyBpbiBESVYuc3R5bGUpIHtcbiAgICBtZXRob2RzLmdldFN0eWxlID0gZ2V0U3R5bGVfSUU7XG4gICAgbWV0aG9kcy5zZXRPcGFjaXR5ID0gc2V0T3BhY2l0eV9JRTtcbiAgICBtZXRob2RzLmdldE9wYWNpdHkgPSBnZXRPcGFjaXR5X0lFO1xuICB9XG5cbiAgdmFyIFVJRCA9IDA7XG5cbiAgR0xPQkFMLkVsZW1lbnQuU3RvcmFnZSA9IHsgVUlEOiAxIH07XG5cbiAgZnVuY3Rpb24gZ2V0VW5pcXVlRWxlbWVudElEKGVsZW1lbnQpIHtcbiAgICBpZiAoZWxlbWVudCA9PT0gd2luZG93KSByZXR1cm4gMDtcblxuICAgIGlmICh0eXBlb2YgZWxlbWVudC5fcHJvdG90eXBlVUlEID09PSAndW5kZWZpbmVkJylcbiAgICAgIGVsZW1lbnQuX3Byb3RvdHlwZVVJRCA9IEVsZW1lbnQuU3RvcmFnZS5VSUQrKztcbiAgICByZXR1cm4gZWxlbWVudC5fcHJvdG90eXBlVUlEO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0VW5pcXVlRWxlbWVudElEX0lFKGVsZW1lbnQpIHtcbiAgICBpZiAoZWxlbWVudCA9PT0gd2luZG93KSByZXR1cm4gMDtcbiAgICBpZiAoZWxlbWVudCA9PSBkb2N1bWVudCkgcmV0dXJuIDE7XG4gICAgcmV0dXJuIGVsZW1lbnQudW5pcXVlSUQ7XG4gIH1cblxuICB2YXIgSEFTX1VOSVFVRV9JRF9QUk9QRVJUWSA9ICgndW5pcXVlSUQnIGluIERJVik7XG4gIGlmIChIQVNfVU5JUVVFX0lEX1BST1BFUlRZKVxuICAgIGdldFVuaXF1ZUVsZW1lbnRJRCA9IGdldFVuaXF1ZUVsZW1lbnRJRF9JRTtcblxuICBmdW5jdGlvbiBnZXRTdG9yYWdlKGVsZW1lbnQpIHtcbiAgICBpZiAoIShlbGVtZW50ID0gJChlbGVtZW50KSkpIHJldHVybjtcblxuICAgIHZhciB1aWQgPSBnZXRVbmlxdWVFbGVtZW50SUQoZWxlbWVudCk7XG5cbiAgICBpZiAoIUVsZW1lbnQuU3RvcmFnZVt1aWRdKVxuICAgICAgRWxlbWVudC5TdG9yYWdlW3VpZF0gPSAkSCgpO1xuXG4gICAgcmV0dXJuIEVsZW1lbnQuU3RvcmFnZVt1aWRdO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcmUoZWxlbWVudCwga2V5LCB2YWx1ZSkge1xuICAgIGlmICghKGVsZW1lbnQgPSAkKGVsZW1lbnQpKSkgcmV0dXJuO1xuICAgIHZhciBzdG9yYWdlID0gZ2V0U3RvcmFnZShlbGVtZW50KTtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuICAgICAgc3RvcmFnZS51cGRhdGUoa2V5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RvcmFnZS5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gcmV0cmlldmUoZWxlbWVudCwga2V5LCBkZWZhdWx0VmFsdWUpIHtcbiAgICBpZiAoIShlbGVtZW50ID0gJChlbGVtZW50KSkpIHJldHVybjtcbiAgICB2YXIgc3RvcmFnZSA9IGdldFN0b3JhZ2UoZWxlbWVudCksIHZhbHVlID0gc3RvcmFnZS5nZXQoa2V5KTtcblxuICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQodmFsdWUpKSB7XG4gICAgICBzdG9yYWdlLnNldChrZXksIGRlZmF1bHRWYWx1ZSk7XG4gICAgICB2YWx1ZSA9IGRlZmF1bHRWYWx1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuXG4gIE9iamVjdC5leHRlbmQobWV0aG9kcywge1xuICAgIGdldFN0b3JhZ2U6IGdldFN0b3JhZ2UsXG4gICAgc3RvcmU6ICAgICAgc3RvcmUsXG4gICAgcmV0cmlldmU6ICAgcmV0cmlldmVcbiAgfSk7XG5cblxuICB2YXIgTWV0aG9kcyA9IHt9LCBCeVRhZyA9IEVsZW1lbnQuTWV0aG9kcy5CeVRhZyxcbiAgIEYgPSBQcm90b3R5cGUuQnJvd3NlckZlYXR1cmVzO1xuXG4gIGlmICghRi5FbGVtZW50RXh0ZW5zaW9ucyAmJiAoJ19fcHJvdG9fXycgaW4gRElWKSkge1xuICAgIEdMT0JBTC5IVE1MRWxlbWVudCA9IHt9O1xuICAgIEdMT0JBTC5IVE1MRWxlbWVudC5wcm90b3R5cGUgPSBESVZbJ19fcHJvdG9fXyddO1xuICAgIEYuRWxlbWVudEV4dGVuc2lvbnMgPSB0cnVlO1xuICB9XG5cbiAgZnVuY3Rpb24gY2hlY2tFbGVtZW50UHJvdG90eXBlRGVmaWNpZW5jeSh0YWdOYW1lKSB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cuRWxlbWVudCA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiBmYWxzZTtcbiAgICBpZiAoIUhBU19FWFRFTkRFRF9DUkVBVEVfRUxFTUVOVF9TWU5UQVgpIHJldHVybiBmYWxzZTtcbiAgICB2YXIgcHJvdG8gPSB3aW5kb3cuRWxlbWVudC5wcm90b3R5cGU7XG4gICAgaWYgKHByb3RvKSB7XG4gICAgICB2YXIgaWQgPSAnXycgKyAoTWF0aC5yYW5kb20oKSArICcnKS5zbGljZSgyKSxcbiAgICAgICBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSk7XG4gICAgICBwcm90b1tpZF0gPSAneCc7XG4gICAgICB2YXIgaXNCdWdneSA9IChlbFtpZF0gIT09ICd4Jyk7XG4gICAgICBkZWxldGUgcHJvdG9baWRdO1xuICAgICAgZWwgPSBudWxsO1xuICAgICAgcmV0dXJuIGlzQnVnZ3k7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdmFyIEhUTUxPQkpFQ1RFTEVNRU5UX1BST1RPVFlQRV9CVUdHWSA9XG4gICBjaGVja0VsZW1lbnRQcm90b3R5cGVEZWZpY2llbmN5KCdvYmplY3QnKTtcblxuICBmdW5jdGlvbiBleHRlbmRFbGVtZW50V2l0aChlbGVtZW50LCBtZXRob2RzKSB7XG4gICAgZm9yICh2YXIgcHJvcGVydHkgaW4gbWV0aG9kcykge1xuICAgICAgdmFyIHZhbHVlID0gbWV0aG9kc1twcm9wZXJ0eV07XG4gICAgICBpZiAoT2JqZWN0LmlzRnVuY3Rpb24odmFsdWUpICYmICEocHJvcGVydHkgaW4gZWxlbWVudCkpXG4gICAgICAgIGVsZW1lbnRbcHJvcGVydHldID0gdmFsdWUubWV0aG9kaXplKCk7XG4gICAgfVxuICB9XG5cbiAgdmFyIEVYVEVOREVEID0ge307XG4gIGZ1bmN0aW9uIGVsZW1lbnRJc0V4dGVuZGVkKGVsZW1lbnQpIHtcbiAgICB2YXIgdWlkID0gZ2V0VW5pcXVlRWxlbWVudElEKGVsZW1lbnQpO1xuICAgIHJldHVybiAodWlkIGluIEVYVEVOREVEKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGV4dGVuZChlbGVtZW50KSB7XG4gICAgaWYgKCFlbGVtZW50IHx8IGVsZW1lbnRJc0V4dGVuZGVkKGVsZW1lbnQpKSByZXR1cm4gZWxlbWVudDtcbiAgICBpZiAoZWxlbWVudC5ub2RlVHlwZSAhPT0gTm9kZS5FTEVNRU5UX05PREUgfHwgZWxlbWVudCA9PSB3aW5kb3cpXG4gICAgICByZXR1cm4gZWxlbWVudDtcblxuICAgIHZhciBtZXRob2RzID0gT2JqZWN0LmNsb25lKE1ldGhvZHMpLFxuICAgICB0YWdOYW1lID0gZWxlbWVudC50YWdOYW1lLnRvVXBwZXJDYXNlKCk7XG5cbiAgICBpZiAoQnlUYWdbdGFnTmFtZV0pIE9iamVjdC5leHRlbmQobWV0aG9kcywgQnlUYWdbdGFnTmFtZV0pO1xuXG4gICAgZXh0ZW5kRWxlbWVudFdpdGgoZWxlbWVudCwgbWV0aG9kcyk7XG4gICAgRVhURU5ERURbZ2V0VW5pcXVlRWxlbWVudElEKGVsZW1lbnQpXSA9IHRydWU7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICBmdW5jdGlvbiBleHRlbmRfSUU4KGVsZW1lbnQpIHtcbiAgICBpZiAoIWVsZW1lbnQgfHwgZWxlbWVudElzRXh0ZW5kZWQoZWxlbWVudCkpIHJldHVybiBlbGVtZW50O1xuXG4gICAgdmFyIHQgPSBlbGVtZW50LnRhZ05hbWU7XG4gICAgaWYgKHQgJiYgKC9eKD86b2JqZWN0fGFwcGxldHxlbWJlZCkkL2kudGVzdCh0KSkpIHtcbiAgICAgIGV4dGVuZEVsZW1lbnRXaXRoKGVsZW1lbnQsIEVsZW1lbnQuTWV0aG9kcyk7XG4gICAgICBleHRlbmRFbGVtZW50V2l0aChlbGVtZW50LCBFbGVtZW50Lk1ldGhvZHMuU2ltdWxhdGVkKTtcbiAgICAgIGV4dGVuZEVsZW1lbnRXaXRoKGVsZW1lbnQsIEVsZW1lbnQuTWV0aG9kcy5CeVRhZ1t0LnRvVXBwZXJDYXNlKCldKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGlmIChGLlNwZWNpZmljRWxlbWVudEV4dGVuc2lvbnMpIHtcbiAgICBleHRlbmQgPSBIVE1MT0JKRUNURUxFTUVOVF9QUk9UT1RZUEVfQlVHR1kgPyBleHRlbmRfSUU4IDogUHJvdG90eXBlLks7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRNZXRob2RzVG9UYWdOYW1lKHRhZ05hbWUsIG1ldGhvZHMpIHtcbiAgICB0YWdOYW1lID0gdGFnTmFtZS50b1VwcGVyQ2FzZSgpO1xuICAgIGlmICghQnlUYWdbdGFnTmFtZV0pIEJ5VGFnW3RhZ05hbWVdID0ge307XG4gICAgT2JqZWN0LmV4dGVuZChCeVRhZ1t0YWdOYW1lXSwgbWV0aG9kcyk7XG4gIH1cblxuICBmdW5jdGlvbiBtZXJnZU1ldGhvZHMoZGVzdGluYXRpb24sIG1ldGhvZHMsIG9ubHlJZkFic2VudCkge1xuICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQob25seUlmQWJzZW50KSkgb25seUlmQWJzZW50ID0gZmFsc2U7XG4gICAgZm9yICh2YXIgcHJvcGVydHkgaW4gbWV0aG9kcykge1xuICAgICAgdmFyIHZhbHVlID0gbWV0aG9kc1twcm9wZXJ0eV07XG4gICAgICBpZiAoIU9iamVjdC5pc0Z1bmN0aW9uKHZhbHVlKSkgY29udGludWU7XG4gICAgICBpZiAoIW9ubHlJZkFic2VudCB8fCAhKHByb3BlcnR5IGluIGRlc3RpbmF0aW9uKSlcbiAgICAgICAgZGVzdGluYXRpb25bcHJvcGVydHldID0gdmFsdWUubWV0aG9kaXplKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZmluZERPTUNsYXNzKHRhZ05hbWUpIHtcbiAgICB2YXIga2xhc3M7XG4gICAgdmFyIHRyYW5zID0ge1xuICAgICAgXCJPUFRHUk9VUFwiOiBcIk9wdEdyb3VwXCIsIFwiVEVYVEFSRUFcIjogXCJUZXh0QXJlYVwiLCBcIlBcIjogXCJQYXJhZ3JhcGhcIixcbiAgICAgIFwiRklFTERTRVRcIjogXCJGaWVsZFNldFwiLCBcIlVMXCI6IFwiVUxpc3RcIiwgXCJPTFwiOiBcIk9MaXN0XCIsIFwiRExcIjogXCJETGlzdFwiLFxuICAgICAgXCJESVJcIjogXCJEaXJlY3RvcnlcIiwgXCJIMVwiOiBcIkhlYWRpbmdcIiwgXCJIMlwiOiBcIkhlYWRpbmdcIiwgXCJIM1wiOiBcIkhlYWRpbmdcIixcbiAgICAgIFwiSDRcIjogXCJIZWFkaW5nXCIsIFwiSDVcIjogXCJIZWFkaW5nXCIsIFwiSDZcIjogXCJIZWFkaW5nXCIsIFwiUVwiOiBcIlF1b3RlXCIsXG4gICAgICBcIklOU1wiOiBcIk1vZFwiLCBcIkRFTFwiOiBcIk1vZFwiLCBcIkFcIjogXCJBbmNob3JcIiwgXCJJTUdcIjogXCJJbWFnZVwiLCBcIkNBUFRJT05cIjpcbiAgICAgIFwiVGFibGVDYXB0aW9uXCIsIFwiQ09MXCI6IFwiVGFibGVDb2xcIiwgXCJDT0xHUk9VUFwiOiBcIlRhYmxlQ29sXCIsIFwiVEhFQURcIjpcbiAgICAgIFwiVGFibGVTZWN0aW9uXCIsIFwiVEZPT1RcIjogXCJUYWJsZVNlY3Rpb25cIiwgXCJUQk9EWVwiOiBcIlRhYmxlU2VjdGlvblwiLCBcIlRSXCI6XG4gICAgICBcIlRhYmxlUm93XCIsIFwiVEhcIjogXCJUYWJsZUNlbGxcIiwgXCJURFwiOiBcIlRhYmxlQ2VsbFwiLCBcIkZSQU1FU0VUXCI6XG4gICAgICBcIkZyYW1lU2V0XCIsIFwiSUZSQU1FXCI6IFwiSUZyYW1lXCJcbiAgICB9O1xuICAgIGlmICh0cmFuc1t0YWdOYW1lXSkga2xhc3MgPSAnSFRNTCcgKyB0cmFuc1t0YWdOYW1lXSArICdFbGVtZW50JztcbiAgICBpZiAod2luZG93W2tsYXNzXSkgcmV0dXJuIHdpbmRvd1trbGFzc107XG4gICAga2xhc3MgPSAnSFRNTCcgKyB0YWdOYW1lICsgJ0VsZW1lbnQnO1xuICAgIGlmICh3aW5kb3dba2xhc3NdKSByZXR1cm4gd2luZG93W2tsYXNzXTtcbiAgICBrbGFzcyA9ICdIVE1MJyArIHRhZ05hbWUuY2FwaXRhbGl6ZSgpICsgJ0VsZW1lbnQnO1xuICAgIGlmICh3aW5kb3dba2xhc3NdKSByZXR1cm4gd2luZG93W2tsYXNzXTtcblxuICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKSxcbiAgICAgcHJvdG8gPSBlbGVtZW50WydfX3Byb3RvX18nXSB8fCBlbGVtZW50LmNvbnN0cnVjdG9yLnByb3RvdHlwZTtcblxuICAgIGVsZW1lbnQgPSBudWxsO1xuICAgIHJldHVybiBwcm90bztcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZE1ldGhvZHMobWV0aG9kcykge1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSBhZGRGb3JtTWV0aG9kcygpO1xuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcbiAgICAgIHZhciB0YWdOYW1lID0gbWV0aG9kcztcbiAgICAgIG1ldGhvZHMgPSBhcmd1bWVudHNbMV07XG4gICAgfVxuXG4gICAgaWYgKCF0YWdOYW1lKSB7XG4gICAgICBPYmplY3QuZXh0ZW5kKEVsZW1lbnQuTWV0aG9kcywgbWV0aG9kcyB8fCB7fSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChPYmplY3QuaXNBcnJheSh0YWdOYW1lKSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgdGFnOyB0YWcgPSB0YWdOYW1lW2ldOyBpKyspXG4gICAgICAgICAgYWRkTWV0aG9kc1RvVGFnTmFtZSh0YWcsIG1ldGhvZHMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWRkTWV0aG9kc1RvVGFnTmFtZSh0YWdOYW1lLCBtZXRob2RzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgRUxFTUVOVF9QUk9UT1RZUEUgPSB3aW5kb3cuSFRNTEVsZW1lbnQgPyBIVE1MRWxlbWVudC5wcm90b3R5cGUgOlxuICAgICBFbGVtZW50LnByb3RvdHlwZTtcblxuICAgIGlmIChGLkVsZW1lbnRFeHRlbnNpb25zKSB7XG4gICAgICBtZXJnZU1ldGhvZHMoRUxFTUVOVF9QUk9UT1RZUEUsIEVsZW1lbnQuTWV0aG9kcyk7XG4gICAgICBtZXJnZU1ldGhvZHMoRUxFTUVOVF9QUk9UT1RZUEUsIEVsZW1lbnQuTWV0aG9kcy5TaW11bGF0ZWQsIHRydWUpO1xuICAgIH1cblxuICAgIGlmIChGLlNwZWNpZmljRWxlbWVudEV4dGVuc2lvbnMpIHtcbiAgICAgIGZvciAodmFyIHRhZyBpbiBFbGVtZW50Lk1ldGhvZHMuQnlUYWcpIHtcbiAgICAgICAgdmFyIGtsYXNzID0gZmluZERPTUNsYXNzKHRhZyk7XG4gICAgICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQoa2xhc3MpKSBjb250aW51ZTtcbiAgICAgICAgbWVyZ2VNZXRob2RzKGtsYXNzLnByb3RvdHlwZSwgQnlUYWdbdGFnXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgT2JqZWN0LmV4dGVuZChFbGVtZW50LCBFbGVtZW50Lk1ldGhvZHMpO1xuICAgIE9iamVjdC5leHRlbmQoRWxlbWVudCwgRWxlbWVudC5NZXRob2RzLlNpbXVsYXRlZCk7XG4gICAgZGVsZXRlIEVsZW1lbnQuQnlUYWc7XG4gICAgZGVsZXRlIEVsZW1lbnQuU2ltdWxhdGVkO1xuXG4gICAgRWxlbWVudC5leHRlbmQucmVmcmVzaCgpO1xuXG4gICAgRUxFTUVOVF9DQUNIRSA9IHt9O1xuICB9XG5cbiAgT2JqZWN0LmV4dGVuZChHTE9CQUwuRWxlbWVudCwge1xuICAgIGV4dGVuZDogICAgIGV4dGVuZCxcbiAgICBhZGRNZXRob2RzOiBhZGRNZXRob2RzXG4gIH0pO1xuXG4gIGlmIChleHRlbmQgPT09IFByb3RvdHlwZS5LKSB7XG4gICAgR0xPQkFMLkVsZW1lbnQuZXh0ZW5kLnJlZnJlc2ggPSBQcm90b3R5cGUuZW1wdHlGdW5jdGlvbjtcbiAgfSBlbHNlIHtcbiAgICBHTE9CQUwuRWxlbWVudC5leHRlbmQucmVmcmVzaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKFByb3RvdHlwZS5Ccm93c2VyRmVhdHVyZXMuRWxlbWVudEV4dGVuc2lvbnMpIHJldHVybjtcbiAgICAgIE9iamVjdC5leHRlbmQoTWV0aG9kcywgRWxlbWVudC5NZXRob2RzKTtcbiAgICAgIE9iamVjdC5leHRlbmQoTWV0aG9kcywgRWxlbWVudC5NZXRob2RzLlNpbXVsYXRlZCk7XG5cbiAgICAgIEVYVEVOREVEID0ge307XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZEZvcm1NZXRob2RzKCkge1xuICAgIE9iamVjdC5leHRlbmQoRm9ybSwgRm9ybS5NZXRob2RzKTtcbiAgICBPYmplY3QuZXh0ZW5kKEZvcm0uRWxlbWVudCwgRm9ybS5FbGVtZW50Lk1ldGhvZHMpO1xuICAgIE9iamVjdC5leHRlbmQoRWxlbWVudC5NZXRob2RzLkJ5VGFnLCB7XG4gICAgICBcIkZPUk1cIjogICAgIE9iamVjdC5jbG9uZShGb3JtLk1ldGhvZHMpLFxuICAgICAgXCJJTlBVVFwiOiAgICBPYmplY3QuY2xvbmUoRm9ybS5FbGVtZW50Lk1ldGhvZHMpLFxuICAgICAgXCJTRUxFQ1RcIjogICBPYmplY3QuY2xvbmUoRm9ybS5FbGVtZW50Lk1ldGhvZHMpLFxuICAgICAgXCJURVhUQVJFQVwiOiBPYmplY3QuY2xvbmUoRm9ybS5FbGVtZW50Lk1ldGhvZHMpLFxuICAgICAgXCJCVVRUT05cIjogICBPYmplY3QuY2xvbmUoRm9ybS5FbGVtZW50Lk1ldGhvZHMpXG4gICAgfSk7XG4gIH1cblxuICBFbGVtZW50LmFkZE1ldGhvZHMobWV0aG9kcyk7XG5cbiAgZnVuY3Rpb24gZGVzdHJveUNhY2hlX0lFKCkge1xuICAgIERJViA9IG51bGw7XG4gICAgRUxFTUVOVF9DQUNIRSA9IG51bGw7XG4gIH1cblxuICBpZiAod2luZG93LmF0dGFjaEV2ZW50KVxuICAgIHdpbmRvdy5hdHRhY2hFdmVudCgnb251bmxvYWQnLCBkZXN0cm95Q2FjaGVfSUUpO1xuXG59KSh0aGlzKTtcbihmdW5jdGlvbigpIHtcblxuICBmdW5jdGlvbiB0b0RlY2ltYWwocGN0U3RyaW5nKSB7XG4gICAgdmFyIG1hdGNoID0gcGN0U3RyaW5nLm1hdGNoKC9eKFxcZCspJT8kL2kpO1xuICAgIGlmICghbWF0Y2gpIHJldHVybiBudWxsO1xuICAgIHJldHVybiAoTnVtYmVyKG1hdGNoWzFdKSAvIDEwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRSYXdTdHlsZShlbGVtZW50LCBzdHlsZSkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgdmFyIHZhbHVlID0gZWxlbWVudC5zdHlsZVtzdHlsZV07XG4gICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZSA9PT0gJ2F1dG8nKSB7XG4gICAgICB2YXIgY3NzID0gZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBudWxsKTtcbiAgICAgIHZhbHVlID0gY3NzID8gY3NzW3N0eWxlXSA6IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKHN0eWxlID09PSAnb3BhY2l0eScpIHJldHVybiB2YWx1ZSA/IHBhcnNlRmxvYXQodmFsdWUpIDogMS4wO1xuICAgIHJldHVybiB2YWx1ZSA9PT0gJ2F1dG8nID8gbnVsbCA6IHZhbHVlO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0UmF3U3R5bGVfSUUoZWxlbWVudCwgc3R5bGUpIHtcbiAgICB2YXIgdmFsdWUgPSBlbGVtZW50LnN0eWxlW3N0eWxlXTtcbiAgICBpZiAoIXZhbHVlICYmIGVsZW1lbnQuY3VycmVudFN0eWxlKSB7XG4gICAgICB2YWx1ZSA9IGVsZW1lbnQuY3VycmVudFN0eWxlW3N0eWxlXTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0Q29udGVudFdpZHRoKGVsZW1lbnQsIGNvbnRleHQpIHtcbiAgICB2YXIgYm94V2lkdGggPSBlbGVtZW50Lm9mZnNldFdpZHRoO1xuXG4gICAgdmFyIGJsID0gZ2V0UGl4ZWxWYWx1ZShlbGVtZW50LCAnYm9yZGVyTGVmdFdpZHRoJywgIGNvbnRleHQpIHx8IDA7XG4gICAgdmFyIGJyID0gZ2V0UGl4ZWxWYWx1ZShlbGVtZW50LCAnYm9yZGVyUmlnaHRXaWR0aCcsIGNvbnRleHQpIHx8IDA7XG4gICAgdmFyIHBsID0gZ2V0UGl4ZWxWYWx1ZShlbGVtZW50LCAncGFkZGluZ0xlZnQnLCAgICAgIGNvbnRleHQpIHx8IDA7XG4gICAgdmFyIHByID0gZ2V0UGl4ZWxWYWx1ZShlbGVtZW50LCAncGFkZGluZ1JpZ2h0JywgICAgIGNvbnRleHQpIHx8IDA7XG5cbiAgICByZXR1cm4gYm94V2lkdGggLSBibCAtIGJyIC0gcGwgLSBwcjtcbiAgfVxuXG4gIGlmICgnY3VycmVudFN0eWxlJyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHtcbiAgICBnZXRSYXdTdHlsZSA9IGdldFJhd1N0eWxlX0lFO1xuICB9XG5cblxuICBmdW5jdGlvbiBnZXRQaXhlbFZhbHVlKHZhbHVlLCBwcm9wZXJ0eSwgY29udGV4dCkge1xuICAgIHZhciBlbGVtZW50ID0gbnVsbDtcbiAgICBpZiAoT2JqZWN0LmlzRWxlbWVudCh2YWx1ZSkpIHtcbiAgICAgIGVsZW1lbnQgPSB2YWx1ZTtcbiAgICAgIHZhbHVlID0gZ2V0UmF3U3R5bGUoZWxlbWVudCwgcHJvcGVydHkpO1xuICAgIH1cblxuICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCBPYmplY3QuaXNVbmRlZmluZWQodmFsdWUpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoKC9eKD86LSk/XFxkKyhcXC5cXGQrKT8ocHgpPyQvaSkudGVzdCh2YWx1ZSkpIHtcbiAgICAgIHJldHVybiB3aW5kb3cucGFyc2VGbG9hdCh2YWx1ZSk7XG4gICAgfVxuXG4gICAgdmFyIGlzUGVyY2VudGFnZSA9IHZhbHVlLmluY2x1ZGUoJyUnKSwgaXNWaWV3cG9ydCA9IChjb250ZXh0ID09PSBkb2N1bWVudC52aWV3cG9ydCk7XG5cbiAgICBpZiAoL1xcZC8udGVzdCh2YWx1ZSkgJiYgZWxlbWVudCAmJiBlbGVtZW50LnJ1bnRpbWVTdHlsZSAmJiAhKGlzUGVyY2VudGFnZSAmJiBpc1ZpZXdwb3J0KSkge1xuICAgICAgdmFyIHN0eWxlID0gZWxlbWVudC5zdHlsZS5sZWZ0LCByU3R5bGUgPSBlbGVtZW50LnJ1bnRpbWVTdHlsZS5sZWZ0O1xuICAgICAgZWxlbWVudC5ydW50aW1lU3R5bGUubGVmdCA9IGVsZW1lbnQuY3VycmVudFN0eWxlLmxlZnQ7XG4gICAgICBlbGVtZW50LnN0eWxlLmxlZnQgPSB2YWx1ZSB8fCAwO1xuICAgICAgdmFsdWUgPSBlbGVtZW50LnN0eWxlLnBpeGVsTGVmdDtcbiAgICAgIGVsZW1lbnQuc3R5bGUubGVmdCA9IHN0eWxlO1xuICAgICAgZWxlbWVudC5ydW50aW1lU3R5bGUubGVmdCA9IHJTdHlsZTtcblxuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIGlmIChlbGVtZW50ICYmIGlzUGVyY2VudGFnZSkge1xuICAgICAgY29udGV4dCA9IGNvbnRleHQgfHwgZWxlbWVudC5wYXJlbnROb2RlO1xuICAgICAgdmFyIGRlY2ltYWwgPSB0b0RlY2ltYWwodmFsdWUpLCB3aG9sZSA9IG51bGw7XG5cbiAgICAgIHZhciBpc0hvcml6b250YWwgPSBwcm9wZXJ0eS5pbmNsdWRlKCdsZWZ0JykgfHwgcHJvcGVydHkuaW5jbHVkZSgncmlnaHQnKSB8fFxuICAgICAgIHByb3BlcnR5LmluY2x1ZGUoJ3dpZHRoJyk7XG5cbiAgICAgIHZhciBpc1ZlcnRpY2FsICAgPSBwcm9wZXJ0eS5pbmNsdWRlKCd0b3AnKSB8fCBwcm9wZXJ0eS5pbmNsdWRlKCdib3R0b20nKSB8fFxuICAgICAgICBwcm9wZXJ0eS5pbmNsdWRlKCdoZWlnaHQnKTtcblxuICAgICAgaWYgKGNvbnRleHQgPT09IGRvY3VtZW50LnZpZXdwb3J0KSB7XG4gICAgICAgIGlmIChpc0hvcml6b250YWwpIHtcbiAgICAgICAgICB3aG9sZSA9IGRvY3VtZW50LnZpZXdwb3J0LmdldFdpZHRoKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNWZXJ0aWNhbCkge1xuICAgICAgICAgIHdob2xlID0gZG9jdW1lbnQudmlld3BvcnQuZ2V0SGVpZ2h0KCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChpc0hvcml6b250YWwpIHtcbiAgICAgICAgICB3aG9sZSA9ICQoY29udGV4dCkubWVhc3VyZSgnd2lkdGgnKTtcbiAgICAgICAgfSBlbHNlIGlmIChpc1ZlcnRpY2FsKSB7XG4gICAgICAgICAgd2hvbGUgPSAkKGNvbnRleHQpLm1lYXN1cmUoJ2hlaWdodCcpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAod2hvbGUgPT09IG51bGwpID8gMCA6IHdob2xlICogZGVjaW1hbDtcbiAgICB9XG5cbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRvQ1NTUGl4ZWxzKG51bWJlcikge1xuICAgIGlmIChPYmplY3QuaXNTdHJpbmcobnVtYmVyKSAmJiBudW1iZXIuZW5kc1dpdGgoJ3B4JykpXG4gICAgICByZXR1cm4gbnVtYmVyO1xuICAgIHJldHVybiBudW1iZXIgKyAncHgnO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNEaXNwbGF5ZWQoZWxlbWVudCkge1xuICAgIHdoaWxlIChlbGVtZW50ICYmIGVsZW1lbnQucGFyZW50Tm9kZSkge1xuICAgICAgdmFyIGRpc3BsYXkgPSBlbGVtZW50LmdldFN0eWxlKCdkaXNwbGF5Jyk7XG4gICAgICBpZiAoZGlzcGxheSA9PT0gJ25vbmUnKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQucGFyZW50Tm9kZSk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgdmFyIGhhc0xheW91dCA9IFByb3RvdHlwZS5LO1xuICBpZiAoJ2N1cnJlbnRTdHlsZScgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7XG4gICAgaGFzTGF5b3V0ID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgaWYgKCFlbGVtZW50LmN1cnJlbnRTdHlsZS5oYXNMYXlvdXQpIHtcbiAgICAgICAgZWxlbWVudC5zdHlsZS56b29tID0gMTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBjc3NOYW1lRm9yKGtleSkge1xuICAgIGlmIChrZXkuaW5jbHVkZSgnYm9yZGVyJykpIGtleSA9IGtleSArICctd2lkdGgnO1xuICAgIHJldHVybiBrZXkuY2FtZWxpemUoKTtcbiAgfVxuXG4gIEVsZW1lbnQuTGF5b3V0ID0gQ2xhc3MuY3JlYXRlKEhhc2gsIHtcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigkc3VwZXIsIGVsZW1lbnQsIHByZUNvbXB1dGUpIHtcbiAgICAgICRzdXBlcigpO1xuICAgICAgdGhpcy5lbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgICAgRWxlbWVudC5MYXlvdXQuUFJPUEVSVElFUy5lYWNoKCBmdW5jdGlvbihwcm9wZXJ0eSkge1xuICAgICAgICB0aGlzLl9zZXQocHJvcGVydHksIG51bGwpO1xuICAgICAgfSwgdGhpcyk7XG5cbiAgICAgIGlmIChwcmVDb21wdXRlKSB7XG4gICAgICAgIHRoaXMuX3ByZUNvbXB1dGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuX2JlZ2luKCk7XG4gICAgICAgIEVsZW1lbnQuTGF5b3V0LlBST1BFUlRJRVMuZWFjaCggdGhpcy5fY29tcHV0ZSwgdGhpcyApO1xuICAgICAgICB0aGlzLl9lbmQoKTtcbiAgICAgICAgdGhpcy5fcHJlQ29tcHV0aW5nID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9zZXQ6IGZ1bmN0aW9uKHByb3BlcnR5LCB2YWx1ZSkge1xuICAgICAgcmV0dXJuIEhhc2gucHJvdG90eXBlLnNldC5jYWxsKHRoaXMsIHByb3BlcnR5LCB2YWx1ZSk7XG4gICAgfSxcblxuICAgIHNldDogZnVuY3Rpb24ocHJvcGVydHksIHZhbHVlKSB7XG4gICAgICB0aHJvdyBcIlByb3BlcnRpZXMgb2YgRWxlbWVudC5MYXlvdXQgYXJlIHJlYWQtb25seS5cIjtcbiAgICB9LFxuXG4gICAgZ2V0OiBmdW5jdGlvbigkc3VwZXIsIHByb3BlcnR5KSB7XG4gICAgICB2YXIgdmFsdWUgPSAkc3VwZXIocHJvcGVydHkpO1xuICAgICAgcmV0dXJuIHZhbHVlID09PSBudWxsID8gdGhpcy5fY29tcHV0ZShwcm9wZXJ0eSkgOiB2YWx1ZTtcbiAgICB9LFxuXG4gICAgX2JlZ2luOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLl9pc1ByZXBhcmVkKCkpIHJldHVybjtcblxuICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICBpZiAoaXNEaXNwbGF5ZWQoZWxlbWVudCkpIHtcbiAgICAgICAgdGhpcy5fc2V0UHJlcGFyZWQodHJ1ZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuXG4gICAgICB2YXIgb3JpZ2luYWxTdHlsZXMgPSB7XG4gICAgICAgIHBvc2l0aW9uOiAgIGVsZW1lbnQuc3R5bGUucG9zaXRpb24gICB8fCAnJyxcbiAgICAgICAgd2lkdGg6ICAgICAgZWxlbWVudC5zdHlsZS53aWR0aCAgICAgIHx8ICcnLFxuICAgICAgICB2aXNpYmlsaXR5OiBlbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgfHwgJycsXG4gICAgICAgIGRpc3BsYXk6ICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSAgICB8fCAnJ1xuICAgICAgfTtcblxuICAgICAgZWxlbWVudC5zdG9yZSgncHJvdG90eXBlX29yaWdpbmFsX3N0eWxlcycsIG9yaWdpbmFsU3R5bGVzKTtcblxuICAgICAgdmFyIHBvc2l0aW9uID0gZ2V0UmF3U3R5bGUoZWxlbWVudCwgJ3Bvc2l0aW9uJyksIHdpZHRoID0gZWxlbWVudC5vZmZzZXRXaWR0aDtcblxuICAgICAgaWYgKHdpZHRoID09PSAwIHx8IHdpZHRoID09PSBudWxsKSB7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgIHdpZHRoID0gZWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICAgIH1cblxuICAgICAgdmFyIGNvbnRleHQgPSAocG9zaXRpb24gPT09ICdmaXhlZCcpID8gZG9jdW1lbnQudmlld3BvcnQgOlxuICAgICAgIGVsZW1lbnQucGFyZW50Tm9kZTtcblxuICAgICAgdmFyIHRlbXBTdHlsZXMgPSB7XG4gICAgICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nLFxuICAgICAgICBkaXNwbGF5OiAgICAnYmxvY2snXG4gICAgICB9O1xuXG4gICAgICBpZiAocG9zaXRpb24gIT09ICdmaXhlZCcpIHRlbXBTdHlsZXMucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuXG4gICAgICBlbGVtZW50LnNldFN0eWxlKHRlbXBTdHlsZXMpO1xuXG4gICAgICB2YXIgcG9zaXRpb25lZFdpZHRoID0gZWxlbWVudC5vZmZzZXRXaWR0aCwgbmV3V2lkdGg7XG4gICAgICBpZiAod2lkdGggJiYgKHBvc2l0aW9uZWRXaWR0aCA9PT0gd2lkdGgpKSB7XG4gICAgICAgIG5ld1dpZHRoID0gZ2V0Q29udGVudFdpZHRoKGVsZW1lbnQsIGNvbnRleHQpO1xuICAgICAgfSBlbHNlIGlmIChwb3NpdGlvbiA9PT0gJ2Fic29sdXRlJyB8fCBwb3NpdGlvbiA9PT0gJ2ZpeGVkJykge1xuICAgICAgICBuZXdXaWR0aCA9IGdldENvbnRlbnRXaWR0aChlbGVtZW50LCBjb250ZXh0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBwYXJlbnQgPSBlbGVtZW50LnBhcmVudE5vZGUsIHBMYXlvdXQgPSAkKHBhcmVudCkuZ2V0TGF5b3V0KCk7XG5cbiAgICAgICAgbmV3V2lkdGggPSBwTGF5b3V0LmdldCgnd2lkdGgnKSAtXG4gICAgICAgICB0aGlzLmdldCgnbWFyZ2luLWxlZnQnKSAtXG4gICAgICAgICB0aGlzLmdldCgnYm9yZGVyLWxlZnQnKSAtXG4gICAgICAgICB0aGlzLmdldCgncGFkZGluZy1sZWZ0JykgLVxuICAgICAgICAgdGhpcy5nZXQoJ3BhZGRpbmctcmlnaHQnKSAtXG4gICAgICAgICB0aGlzLmdldCgnYm9yZGVyLXJpZ2h0JykgLVxuICAgICAgICAgdGhpcy5nZXQoJ21hcmdpbi1yaWdodCcpO1xuICAgICAgfVxuXG4gICAgICBlbGVtZW50LnNldFN0eWxlKHsgd2lkdGg6IG5ld1dpZHRoICsgJ3B4JyB9KTtcblxuICAgICAgdGhpcy5fc2V0UHJlcGFyZWQodHJ1ZSk7XG4gICAgfSxcblxuICAgIF9lbmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICB2YXIgb3JpZ2luYWxTdHlsZXMgPSBlbGVtZW50LnJldHJpZXZlKCdwcm90b3R5cGVfb3JpZ2luYWxfc3R5bGVzJyk7XG4gICAgICBlbGVtZW50LnN0b3JlKCdwcm90b3R5cGVfb3JpZ2luYWxfc3R5bGVzJywgbnVsbCk7XG4gICAgICBlbGVtZW50LnNldFN0eWxlKG9yaWdpbmFsU3R5bGVzKTtcbiAgICAgIHRoaXMuX3NldFByZXBhcmVkKGZhbHNlKTtcbiAgICB9LFxuXG4gICAgX2NvbXB1dGU6IGZ1bmN0aW9uKHByb3BlcnR5KSB7XG4gICAgICB2YXIgQ09NUFVUQVRJT05TID0gRWxlbWVudC5MYXlvdXQuQ09NUFVUQVRJT05TO1xuICAgICAgaWYgKCEocHJvcGVydHkgaW4gQ09NUFVUQVRJT05TKSkge1xuICAgICAgICB0aHJvdyBcIlByb3BlcnR5IG5vdCBmb3VuZC5cIjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuX3NldChwcm9wZXJ0eSwgQ09NUFVUQVRJT05TW3Byb3BlcnR5XS5jYWxsKHRoaXMsIHRoaXMuZWxlbWVudCkpO1xuICAgIH0sXG5cbiAgICBfaXNQcmVwYXJlZDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5lbGVtZW50LnJldHJpZXZlKCdwcm90b3R5cGVfZWxlbWVudF9sYXlvdXRfcHJlcGFyZWQnLCBmYWxzZSk7XG4gICAgfSxcblxuICAgIF9zZXRQcmVwYXJlZDogZnVuY3Rpb24oYm9vbCkge1xuICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5zdG9yZSgncHJvdG90eXBlX2VsZW1lbnRfbGF5b3V0X3ByZXBhcmVkJywgYm9vbCk7XG4gICAgfSxcblxuICAgIHRvT2JqZWN0OiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBhcmdzID0gJEEoYXJndW1lbnRzKTtcbiAgICAgIHZhciBrZXlzID0gKGFyZ3MubGVuZ3RoID09PSAwKSA/IEVsZW1lbnQuTGF5b3V0LlBST1BFUlRJRVMgOlxuICAgICAgIGFyZ3Muam9pbignICcpLnNwbGl0KCcgJyk7XG4gICAgICB2YXIgb2JqID0ge307XG4gICAgICBrZXlzLmVhY2goIGZ1bmN0aW9uKGtleSkge1xuICAgICAgICBpZiAoIUVsZW1lbnQuTGF5b3V0LlBST1BFUlRJRVMuaW5jbHVkZShrZXkpKSByZXR1cm47XG4gICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZ2V0KGtleSk7XG4gICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSBvYmpba2V5XSA9IHZhbHVlO1xuICAgICAgfSwgdGhpcyk7XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH0sXG5cbiAgICB0b0hhc2g6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG9iaiA9IHRoaXMudG9PYmplY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiBuZXcgSGFzaChvYmopO1xuICAgIH0sXG5cbiAgICB0b0NTUzogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYXJncyA9ICRBKGFyZ3VtZW50cyk7XG4gICAgICB2YXIga2V5cyA9IChhcmdzLmxlbmd0aCA9PT0gMCkgPyBFbGVtZW50LkxheW91dC5QUk9QRVJUSUVTIDpcbiAgICAgICBhcmdzLmpvaW4oJyAnKS5zcGxpdCgnICcpO1xuICAgICAgdmFyIGNzcyA9IHt9O1xuXG4gICAgICBrZXlzLmVhY2goIGZ1bmN0aW9uKGtleSkge1xuICAgICAgICBpZiAoIUVsZW1lbnQuTGF5b3V0LlBST1BFUlRJRVMuaW5jbHVkZShrZXkpKSByZXR1cm47XG4gICAgICAgIGlmIChFbGVtZW50LkxheW91dC5DT01QT1NJVEVfUFJPUEVSVElFUy5pbmNsdWRlKGtleSkpIHJldHVybjtcblxuICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmdldChrZXkpO1xuICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkgY3NzW2Nzc05hbWVGb3Ioa2V5KV0gPSB2YWx1ZSArICdweCc7XG4gICAgICB9LCB0aGlzKTtcbiAgICAgIHJldHVybiBjc3M7XG4gICAgfSxcblxuICAgIGluc3BlY3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIFwiIzxFbGVtZW50LkxheW91dD5cIjtcbiAgICB9XG4gIH0pO1xuXG4gIE9iamVjdC5leHRlbmQoRWxlbWVudC5MYXlvdXQsIHtcbiAgICBQUk9QRVJUSUVTOiAkdygnaGVpZ2h0IHdpZHRoIHRvcCBsZWZ0IHJpZ2h0IGJvdHRvbSBib3JkZXItbGVmdCBib3JkZXItcmlnaHQgYm9yZGVyLXRvcCBib3JkZXItYm90dG9tIHBhZGRpbmctbGVmdCBwYWRkaW5nLXJpZ2h0IHBhZGRpbmctdG9wIHBhZGRpbmctYm90dG9tIG1hcmdpbi10b3AgbWFyZ2luLWJvdHRvbSBtYXJnaW4tbGVmdCBtYXJnaW4tcmlnaHQgcGFkZGluZy1ib3gtd2lkdGggcGFkZGluZy1ib3gtaGVpZ2h0IGJvcmRlci1ib3gtd2lkdGggYm9yZGVyLWJveC1oZWlnaHQgbWFyZ2luLWJveC13aWR0aCBtYXJnaW4tYm94LWhlaWdodCcpLFxuXG4gICAgQ09NUE9TSVRFX1BST1BFUlRJRVM6ICR3KCdwYWRkaW5nLWJveC13aWR0aCBwYWRkaW5nLWJveC1oZWlnaHQgbWFyZ2luLWJveC13aWR0aCBtYXJnaW4tYm94LWhlaWdodCBib3JkZXItYm94LXdpZHRoIGJvcmRlci1ib3gtaGVpZ2h0JyksXG5cbiAgICBDT01QVVRBVElPTlM6IHtcbiAgICAgICdoZWlnaHQnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIGlmICghdGhpcy5fcHJlQ29tcHV0aW5nKSB0aGlzLl9iZWdpbigpO1xuXG4gICAgICAgIHZhciBiSGVpZ2h0ID0gdGhpcy5nZXQoJ2JvcmRlci1ib3gtaGVpZ2h0Jyk7XG4gICAgICAgIGlmIChiSGVpZ2h0IDw9IDApIHtcbiAgICAgICAgICBpZiAoIXRoaXMuX3ByZUNvbXB1dGluZykgdGhpcy5fZW5kKCk7XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgYlRvcCA9IHRoaXMuZ2V0KCdib3JkZXItdG9wJyksXG4gICAgICAgICBiQm90dG9tID0gdGhpcy5nZXQoJ2JvcmRlci1ib3R0b20nKTtcblxuICAgICAgICB2YXIgcFRvcCA9IHRoaXMuZ2V0KCdwYWRkaW5nLXRvcCcpLFxuICAgICAgICAgcEJvdHRvbSA9IHRoaXMuZ2V0KCdwYWRkaW5nLWJvdHRvbScpO1xuXG4gICAgICAgIGlmICghdGhpcy5fcHJlQ29tcHV0aW5nKSB0aGlzLl9lbmQoKTtcblxuICAgICAgICByZXR1cm4gYkhlaWdodCAtIGJUb3AgLSBiQm90dG9tIC0gcFRvcCAtIHBCb3R0b207XG4gICAgICB9LFxuXG4gICAgICAnd2lkdGgnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIGlmICghdGhpcy5fcHJlQ29tcHV0aW5nKSB0aGlzLl9iZWdpbigpO1xuXG4gICAgICAgIHZhciBiV2lkdGggPSB0aGlzLmdldCgnYm9yZGVyLWJveC13aWR0aCcpO1xuICAgICAgICBpZiAoYldpZHRoIDw9IDApIHtcbiAgICAgICAgICBpZiAoIXRoaXMuX3ByZUNvbXB1dGluZykgdGhpcy5fZW5kKCk7XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgYkxlZnQgPSB0aGlzLmdldCgnYm9yZGVyLWxlZnQnKSxcbiAgICAgICAgIGJSaWdodCA9IHRoaXMuZ2V0KCdib3JkZXItcmlnaHQnKTtcblxuICAgICAgICB2YXIgcExlZnQgPSB0aGlzLmdldCgncGFkZGluZy1sZWZ0JyksXG4gICAgICAgICBwUmlnaHQgPSB0aGlzLmdldCgncGFkZGluZy1yaWdodCcpO1xuXG4gICAgICAgIGlmICghdGhpcy5fcHJlQ29tcHV0aW5nKSB0aGlzLl9lbmQoKTtcbiAgICAgICAgcmV0dXJuIGJXaWR0aCAtIGJMZWZ0IC0gYlJpZ2h0IC0gcExlZnQgLSBwUmlnaHQ7XG4gICAgICB9LFxuXG4gICAgICAncGFkZGluZy1ib3gtaGVpZ2h0JzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICB2YXIgaGVpZ2h0ID0gdGhpcy5nZXQoJ2hlaWdodCcpLFxuICAgICAgICAgcFRvcCA9IHRoaXMuZ2V0KCdwYWRkaW5nLXRvcCcpLFxuICAgICAgICAgcEJvdHRvbSA9IHRoaXMuZ2V0KCdwYWRkaW5nLWJvdHRvbScpO1xuXG4gICAgICAgIHJldHVybiBoZWlnaHQgKyBwVG9wICsgcEJvdHRvbTtcbiAgICAgIH0sXG5cbiAgICAgICdwYWRkaW5nLWJveC13aWR0aCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHdpZHRoID0gdGhpcy5nZXQoJ3dpZHRoJyksXG4gICAgICAgICBwTGVmdCA9IHRoaXMuZ2V0KCdwYWRkaW5nLWxlZnQnKSxcbiAgICAgICAgIHBSaWdodCA9IHRoaXMuZ2V0KCdwYWRkaW5nLXJpZ2h0Jyk7XG5cbiAgICAgICAgcmV0dXJuIHdpZHRoICsgcExlZnQgKyBwUmlnaHQ7XG4gICAgICB9LFxuXG4gICAgICAnYm9yZGVyLWJveC1oZWlnaHQnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIGlmICghdGhpcy5fcHJlQ29tcHV0aW5nKSB0aGlzLl9iZWdpbigpO1xuICAgICAgICB2YXIgaGVpZ2h0ID0gZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgICAgIGlmICghdGhpcy5fcHJlQ29tcHV0aW5nKSB0aGlzLl9lbmQoKTtcbiAgICAgICAgcmV0dXJuIGhlaWdodDtcbiAgICAgIH0sXG5cbiAgICAgICdib3JkZXItYm94LXdpZHRoJzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICBpZiAoIXRoaXMuX3ByZUNvbXB1dGluZykgdGhpcy5fYmVnaW4oKTtcbiAgICAgICAgdmFyIHdpZHRoID0gZWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICAgICAgaWYgKCF0aGlzLl9wcmVDb21wdXRpbmcpIHRoaXMuX2VuZCgpO1xuICAgICAgICByZXR1cm4gd2lkdGg7XG4gICAgICB9LFxuXG4gICAgICAnbWFyZ2luLWJveC1oZWlnaHQnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBiSGVpZ2h0ID0gdGhpcy5nZXQoJ2JvcmRlci1ib3gtaGVpZ2h0JyksXG4gICAgICAgICBtVG9wID0gdGhpcy5nZXQoJ21hcmdpbi10b3AnKSxcbiAgICAgICAgIG1Cb3R0b20gPSB0aGlzLmdldCgnbWFyZ2luLWJvdHRvbScpO1xuXG4gICAgICAgIGlmIChiSGVpZ2h0IDw9IDApIHJldHVybiAwO1xuXG4gICAgICAgIHJldHVybiBiSGVpZ2h0ICsgbVRvcCArIG1Cb3R0b207XG4gICAgICB9LFxuXG4gICAgICAnbWFyZ2luLWJveC13aWR0aCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGJXaWR0aCA9IHRoaXMuZ2V0KCdib3JkZXItYm94LXdpZHRoJyksXG4gICAgICAgICBtTGVmdCA9IHRoaXMuZ2V0KCdtYXJnaW4tbGVmdCcpLFxuICAgICAgICAgbVJpZ2h0ID0gdGhpcy5nZXQoJ21hcmdpbi1yaWdodCcpO1xuXG4gICAgICAgIGlmIChiV2lkdGggPD0gMCkgcmV0dXJuIDA7XG5cbiAgICAgICAgcmV0dXJuIGJXaWR0aCArIG1MZWZ0ICsgbVJpZ2h0O1xuICAgICAgfSxcblxuICAgICAgJ3RvcCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIG9mZnNldCA9IGVsZW1lbnQucG9zaXRpb25lZE9mZnNldCgpO1xuICAgICAgICByZXR1cm4gb2Zmc2V0LnRvcDtcbiAgICAgIH0sXG5cbiAgICAgICdib3R0b20nOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBvZmZzZXQgPSBlbGVtZW50LnBvc2l0aW9uZWRPZmZzZXQoKSxcbiAgICAgICAgIHBhcmVudCA9IGVsZW1lbnQuZ2V0T2Zmc2V0UGFyZW50KCksXG4gICAgICAgICBwSGVpZ2h0ID0gcGFyZW50Lm1lYXN1cmUoJ2hlaWdodCcpO1xuXG4gICAgICAgIHZhciBtSGVpZ2h0ID0gdGhpcy5nZXQoJ2JvcmRlci1ib3gtaGVpZ2h0Jyk7XG5cbiAgICAgICAgcmV0dXJuIHBIZWlnaHQgLSBtSGVpZ2h0IC0gb2Zmc2V0LnRvcDtcbiAgICAgIH0sXG5cbiAgICAgICdsZWZ0JzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICB2YXIgb2Zmc2V0ID0gZWxlbWVudC5wb3NpdGlvbmVkT2Zmc2V0KCk7XG4gICAgICAgIHJldHVybiBvZmZzZXQubGVmdDtcbiAgICAgIH0sXG5cbiAgICAgICdyaWdodCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIG9mZnNldCA9IGVsZW1lbnQucG9zaXRpb25lZE9mZnNldCgpLFxuICAgICAgICAgcGFyZW50ID0gZWxlbWVudC5nZXRPZmZzZXRQYXJlbnQoKSxcbiAgICAgICAgIHBXaWR0aCA9IHBhcmVudC5tZWFzdXJlKCd3aWR0aCcpO1xuXG4gICAgICAgIHZhciBtV2lkdGggPSB0aGlzLmdldCgnYm9yZGVyLWJveC13aWR0aCcpO1xuXG4gICAgICAgIHJldHVybiBwV2lkdGggLSBtV2lkdGggLSBvZmZzZXQubGVmdDtcbiAgICAgIH0sXG5cbiAgICAgICdwYWRkaW5nLXRvcCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ3BhZGRpbmdUb3AnKTtcbiAgICAgIH0sXG5cbiAgICAgICdwYWRkaW5nLWJvdHRvbSc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ3BhZGRpbmdCb3R0b20nKTtcbiAgICAgIH0sXG5cbiAgICAgICdwYWRkaW5nLWxlZnQnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBnZXRQaXhlbFZhbHVlKGVsZW1lbnQsICdwYWRkaW5nTGVmdCcpO1xuICAgICAgfSxcblxuICAgICAgJ3BhZGRpbmctcmlnaHQnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBnZXRQaXhlbFZhbHVlKGVsZW1lbnQsICdwYWRkaW5nUmlnaHQnKTtcbiAgICAgIH0sXG5cbiAgICAgICdib3JkZXItdG9wJzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZ2V0UGl4ZWxWYWx1ZShlbGVtZW50LCAnYm9yZGVyVG9wV2lkdGgnKTtcbiAgICAgIH0sXG5cbiAgICAgICdib3JkZXItYm90dG9tJzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZ2V0UGl4ZWxWYWx1ZShlbGVtZW50LCAnYm9yZGVyQm90dG9tV2lkdGgnKTtcbiAgICAgIH0sXG5cbiAgICAgICdib3JkZXItbGVmdCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ2JvcmRlckxlZnRXaWR0aCcpO1xuICAgICAgfSxcblxuICAgICAgJ2JvcmRlci1yaWdodCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ2JvcmRlclJpZ2h0V2lkdGgnKTtcbiAgICAgIH0sXG5cbiAgICAgICdtYXJnaW4tdG9wJzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZ2V0UGl4ZWxWYWx1ZShlbGVtZW50LCAnbWFyZ2luVG9wJyk7XG4gICAgICB9LFxuXG4gICAgICAnbWFyZ2luLWJvdHRvbSc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ21hcmdpbkJvdHRvbScpO1xuICAgICAgfSxcblxuICAgICAgJ21hcmdpbi1sZWZ0JzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZ2V0UGl4ZWxWYWx1ZShlbGVtZW50LCAnbWFyZ2luTGVmdCcpO1xuICAgICAgfSxcblxuICAgICAgJ21hcmdpbi1yaWdodCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ21hcmdpblJpZ2h0Jyk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBpZiAoJ2dldEJvdW5kaW5nQ2xpZW50UmVjdCcgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7XG4gICAgT2JqZWN0LmV4dGVuZChFbGVtZW50LkxheW91dC5DT01QVVRBVElPTlMsIHtcbiAgICAgICdyaWdodCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHBhcmVudCA9IGhhc0xheW91dChlbGVtZW50LmdldE9mZnNldFBhcmVudCgpKTtcbiAgICAgICAgdmFyIHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuICAgICAgICAgcFJlY3QgPSBwYXJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgcmV0dXJuIChwUmVjdC5yaWdodCAtIHJlY3QucmlnaHQpLnJvdW5kKCk7XG4gICAgICB9LFxuXG4gICAgICAnYm90dG9tJzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICB2YXIgcGFyZW50ID0gaGFzTGF5b3V0KGVsZW1lbnQuZ2V0T2Zmc2V0UGFyZW50KCkpO1xuICAgICAgICB2YXIgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgICBwUmVjdCA9IHBhcmVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgICByZXR1cm4gKHBSZWN0LmJvdHRvbSAtIHJlY3QuYm90dG9tKS5yb3VuZCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgRWxlbWVudC5PZmZzZXQgPSBDbGFzcy5jcmVhdGUoe1xuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGxlZnQsIHRvcCkge1xuICAgICAgdGhpcy5sZWZ0ID0gbGVmdC5yb3VuZCgpO1xuICAgICAgdGhpcy50b3AgID0gdG9wLnJvdW5kKCk7XG5cbiAgICAgIHRoaXNbMF0gPSB0aGlzLmxlZnQ7XG4gICAgICB0aGlzWzFdID0gdGhpcy50b3A7XG4gICAgfSxcblxuICAgIHJlbGF0aXZlVG86IGZ1bmN0aW9uKG9mZnNldCkge1xuICAgICAgcmV0dXJuIG5ldyBFbGVtZW50Lk9mZnNldChcbiAgICAgICAgdGhpcy5sZWZ0IC0gb2Zmc2V0LmxlZnQsXG4gICAgICAgIHRoaXMudG9wICAtIG9mZnNldC50b3BcbiAgICAgICk7XG4gICAgfSxcblxuICAgIGluc3BlY3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIFwiIzxFbGVtZW50Lk9mZnNldCBsZWZ0OiAje2xlZnR9IHRvcDogI3t0b3B9PlwiLmludGVycG9sYXRlKHRoaXMpO1xuICAgIH0sXG5cbiAgICB0b1N0cmluZzogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gXCJbI3tsZWZ0fSwgI3t0b3B9XVwiLmludGVycG9sYXRlKHRoaXMpO1xuICAgIH0sXG5cbiAgICB0b0FycmF5OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBbdGhpcy5sZWZ0LCB0aGlzLnRvcF07XG4gICAgfVxuICB9KTtcblxuICBmdW5jdGlvbiBnZXRMYXlvdXQoZWxlbWVudCwgcHJlQ29tcHV0ZSkge1xuICAgIHJldHVybiBuZXcgRWxlbWVudC5MYXlvdXQoZWxlbWVudCwgcHJlQ29tcHV0ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBtZWFzdXJlKGVsZW1lbnQsIHByb3BlcnR5KSB7XG4gICAgcmV0dXJuICQoZWxlbWVudCkuZ2V0TGF5b3V0KCkuZ2V0KHByb3BlcnR5KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEhlaWdodChlbGVtZW50KSB7XG4gICAgcmV0dXJuIEVsZW1lbnQuZ2V0RGltZW5zaW9ucyhlbGVtZW50KS5oZWlnaHQ7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRXaWR0aChlbGVtZW50KSB7XG4gICAgcmV0dXJuIEVsZW1lbnQuZ2V0RGltZW5zaW9ucyhlbGVtZW50KS53aWR0aDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldERpbWVuc2lvbnMoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBkaXNwbGF5ID0gRWxlbWVudC5nZXRTdHlsZShlbGVtZW50LCAnZGlzcGxheScpO1xuXG4gICAgaWYgKGRpc3BsYXkgJiYgZGlzcGxheSAhPT0gJ25vbmUnKSB7XG4gICAgICByZXR1cm4geyB3aWR0aDogZWxlbWVudC5vZmZzZXRXaWR0aCwgaGVpZ2h0OiBlbGVtZW50Lm9mZnNldEhlaWdodCB9O1xuICAgIH1cblxuICAgIHZhciBzdHlsZSA9IGVsZW1lbnQuc3R5bGU7XG4gICAgdmFyIG9yaWdpbmFsU3R5bGVzID0ge1xuICAgICAgdmlzaWJpbGl0eTogc3R5bGUudmlzaWJpbGl0eSxcbiAgICAgIHBvc2l0aW9uOiAgIHN0eWxlLnBvc2l0aW9uLFxuICAgICAgZGlzcGxheTogICAgc3R5bGUuZGlzcGxheVxuICAgIH07XG5cbiAgICB2YXIgbmV3U3R5bGVzID0ge1xuICAgICAgdmlzaWJpbGl0eTogJ2hpZGRlbicsXG4gICAgICBkaXNwbGF5OiAgICAnYmxvY2snXG4gICAgfTtcblxuICAgIGlmIChvcmlnaW5hbFN0eWxlcy5wb3NpdGlvbiAhPT0gJ2ZpeGVkJylcbiAgICAgIG5ld1N0eWxlcy5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG5cbiAgICBFbGVtZW50LnNldFN0eWxlKGVsZW1lbnQsIG5ld1N0eWxlcyk7XG5cbiAgICB2YXIgZGltZW5zaW9ucyA9IHtcbiAgICAgIHdpZHRoOiAgZWxlbWVudC5vZmZzZXRXaWR0aCxcbiAgICAgIGhlaWdodDogZWxlbWVudC5vZmZzZXRIZWlnaHRcbiAgICB9O1xuXG4gICAgRWxlbWVudC5zZXRTdHlsZShlbGVtZW50LCBvcmlnaW5hbFN0eWxlcyk7XG5cbiAgICByZXR1cm4gZGltZW5zaW9ucztcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldE9mZnNldFBhcmVudChlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICBpZiAoaXNEb2N1bWVudChlbGVtZW50KSB8fCBpc0RldGFjaGVkKGVsZW1lbnQpIHx8IGlzQm9keShlbGVtZW50KSB8fCBpc0h0bWwoZWxlbWVudCkpXG4gICAgICByZXR1cm4gJChkb2N1bWVudC5ib2R5KTtcblxuICAgIHZhciBpc0lubGluZSA9IChFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdkaXNwbGF5JykgPT09ICdpbmxpbmUnKTtcbiAgICBpZiAoIWlzSW5saW5lICYmIGVsZW1lbnQub2Zmc2V0UGFyZW50KSByZXR1cm4gJChlbGVtZW50Lm9mZnNldFBhcmVudCk7XG5cbiAgICB3aGlsZSAoKGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGUpICYmIGVsZW1lbnQgIT09IGRvY3VtZW50LmJvZHkpIHtcbiAgICAgIGlmIChFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpICE9PSAnc3RhdGljJykge1xuICAgICAgICByZXR1cm4gaXNIdG1sKGVsZW1lbnQpID8gJChkb2N1bWVudC5ib2R5KSA6ICQoZWxlbWVudCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuICQoZG9jdW1lbnQuYm9keSk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIGN1bXVsYXRpdmVPZmZzZXQoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciB2YWx1ZVQgPSAwLCB2YWx1ZUwgPSAwO1xuICAgIGlmIChlbGVtZW50LnBhcmVudE5vZGUpIHtcbiAgICAgIGRvIHtcbiAgICAgICAgdmFsdWVUICs9IGVsZW1lbnQub2Zmc2V0VG9wICB8fCAwO1xuICAgICAgICB2YWx1ZUwgKz0gZWxlbWVudC5vZmZzZXRMZWZ0IHx8IDA7XG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50Lm9mZnNldFBhcmVudDtcbiAgICAgIH0gd2hpbGUgKGVsZW1lbnQpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IEVsZW1lbnQuT2Zmc2V0KHZhbHVlTCwgdmFsdWVUKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBvc2l0aW9uZWRPZmZzZXQoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgdmFyIGxheW91dCA9IGVsZW1lbnQuZ2V0TGF5b3V0KCk7XG5cbiAgICB2YXIgdmFsdWVUID0gMCwgdmFsdWVMID0gMDtcbiAgICBkbyB7XG4gICAgICB2YWx1ZVQgKz0gZWxlbWVudC5vZmZzZXRUb3AgIHx8IDA7XG4gICAgICB2YWx1ZUwgKz0gZWxlbWVudC5vZmZzZXRMZWZ0IHx8IDA7XG4gICAgICBlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQ7XG4gICAgICBpZiAoZWxlbWVudCkge1xuICAgICAgICBpZiAoaXNCb2R5KGVsZW1lbnQpKSBicmVhaztcbiAgICAgICAgdmFyIHAgPSBFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpO1xuICAgICAgICBpZiAocCAhPT0gJ3N0YXRpYycpIGJyZWFrO1xuICAgICAgfVxuICAgIH0gd2hpbGUgKGVsZW1lbnQpO1xuXG4gICAgdmFsdWVMIC09IGxheW91dC5nZXQoJ21hcmdpbi10b3AnKTtcbiAgICB2YWx1ZVQgLT0gbGF5b3V0LmdldCgnbWFyZ2luLWxlZnQnKTtcblxuICAgIHJldHVybiBuZXcgRWxlbWVudC5PZmZzZXQodmFsdWVMLCB2YWx1ZVQpO1xuICB9XG5cbiAgZnVuY3Rpb24gY3VtdWxhdGl2ZVNjcm9sbE9mZnNldChlbGVtZW50KSB7XG4gICAgdmFyIHZhbHVlVCA9IDAsIHZhbHVlTCA9IDA7XG4gICAgZG8ge1xuICAgICAgaWYgKGVsZW1lbnQgPT09IGRvY3VtZW50LmJvZHkpIHtcbiAgICAgICAgdmFyIGJvZHlTY3JvbGxOb2RlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50IHx8IGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZSB8fCBkb2N1bWVudC5ib2R5O1xuICAgICAgICB2YWx1ZVQgKz0gIU9iamVjdC5pc1VuZGVmaW5lZCh3aW5kb3cucGFnZVlPZmZzZXQpID8gd2luZG93LnBhZ2VZT2Zmc2V0IDogYm9keVNjcm9sbE5vZGUuc2Nyb2xsVG9wIHx8IDA7XG4gICAgICAgIHZhbHVlTCArPSAhT2JqZWN0LmlzVW5kZWZpbmVkKHdpbmRvdy5wYWdlWE9mZnNldCkgPyB3aW5kb3cucGFnZVhPZmZzZXQgOiBib2R5U2Nyb2xsTm9kZS5zY3JvbGxMZWZ0IHx8IDA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWVUICs9IGVsZW1lbnQuc2Nyb2xsVG9wICB8fCAwO1xuICAgICAgICB2YWx1ZUwgKz0gZWxlbWVudC5zY3JvbGxMZWZ0IHx8IDA7XG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGU7XG4gICAgICB9XG4gICAgfSB3aGlsZSAoZWxlbWVudCk7XG4gICAgcmV0dXJuIG5ldyBFbGVtZW50Lk9mZnNldCh2YWx1ZUwsIHZhbHVlVCk7XG4gIH1cblxuICBmdW5jdGlvbiB2aWV3cG9ydE9mZnNldChmb3JFbGVtZW50KSB7XG4gICAgdmFyIHZhbHVlVCA9IDAsIHZhbHVlTCA9IDAsIGRvY0JvZHkgPSBkb2N1bWVudC5ib2R5O1xuXG4gICAgZm9yRWxlbWVudCA9ICQoZm9yRWxlbWVudCk7XG4gICAgdmFyIGVsZW1lbnQgPSBmb3JFbGVtZW50O1xuICAgIGRvIHtcbiAgICAgIHZhbHVlVCArPSBlbGVtZW50Lm9mZnNldFRvcCAgfHwgMDtcbiAgICAgIHZhbHVlTCArPSBlbGVtZW50Lm9mZnNldExlZnQgfHwgMDtcbiAgICAgIGlmIChlbGVtZW50Lm9mZnNldFBhcmVudCA9PSBkb2NCb2R5ICYmXG4gICAgICAgIEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwgJ3Bvc2l0aW9uJykgPT0gJ2Fic29sdXRlJykgYnJlYWs7XG4gICAgfSB3aGlsZSAoZWxlbWVudCA9IGVsZW1lbnQub2Zmc2V0UGFyZW50KTtcblxuICAgIGVsZW1lbnQgPSBmb3JFbGVtZW50O1xuICAgIGRvIHtcbiAgICAgIGlmIChlbGVtZW50ICE9IGRvY0JvZHkpIHtcbiAgICAgICAgdmFsdWVUIC09IGVsZW1lbnQuc2Nyb2xsVG9wICB8fCAwO1xuICAgICAgICB2YWx1ZUwgLT0gZWxlbWVudC5zY3JvbGxMZWZ0IHx8IDA7XG4gICAgICB9XG4gICAgfSB3aGlsZSAoZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSk7XG4gICAgcmV0dXJuIG5ldyBFbGVtZW50Lk9mZnNldCh2YWx1ZUwsIHZhbHVlVCk7XG4gIH1cblxuICBmdW5jdGlvbiBhYnNvbHV0aXplKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgIGlmIChFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpID09PSAnYWJzb2x1dGUnKSB7XG4gICAgICByZXR1cm4gZWxlbWVudDtcbiAgICB9XG5cbiAgICB2YXIgb2Zmc2V0UGFyZW50ID0gZ2V0T2Zmc2V0UGFyZW50KGVsZW1lbnQpO1xuICAgIHZhciBlT2Zmc2V0ID0gZWxlbWVudC52aWV3cG9ydE9mZnNldCgpLFxuICAgICBwT2Zmc2V0ID0gb2Zmc2V0UGFyZW50LnZpZXdwb3J0T2Zmc2V0KCk7XG5cbiAgICB2YXIgb2Zmc2V0ID0gZU9mZnNldC5yZWxhdGl2ZVRvKHBPZmZzZXQpO1xuICAgIHZhciBsYXlvdXQgPSBlbGVtZW50LmdldExheW91dCgpO1xuXG4gICAgZWxlbWVudC5zdG9yZSgncHJvdG90eXBlX2Fic29sdXRpemVfb3JpZ2luYWxfc3R5bGVzJywge1xuICAgICAgcG9zaXRpb246IGVsZW1lbnQuZ2V0U3R5bGUoJ3Bvc2l0aW9uJyksXG4gICAgICBsZWZ0OiAgICAgZWxlbWVudC5nZXRTdHlsZSgnbGVmdCcpLFxuICAgICAgdG9wOiAgICAgIGVsZW1lbnQuZ2V0U3R5bGUoJ3RvcCcpLFxuICAgICAgd2lkdGg6ICAgIGVsZW1lbnQuZ2V0U3R5bGUoJ3dpZHRoJyksXG4gICAgICBoZWlnaHQ6ICAgZWxlbWVudC5nZXRTdHlsZSgnaGVpZ2h0JylcbiAgICB9KTtcblxuICAgIGVsZW1lbnQuc2V0U3R5bGUoe1xuICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICB0b3A6ICAgIG9mZnNldC50b3AgKyAncHgnLFxuICAgICAgbGVmdDogICBvZmZzZXQubGVmdCArICdweCcsXG4gICAgICB3aWR0aDogIGxheW91dC5nZXQoJ3dpZHRoJykgKyAncHgnLFxuICAgICAgaGVpZ2h0OiBsYXlvdXQuZ2V0KCdoZWlnaHQnKSArICdweCdcbiAgICB9KTtcblxuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gcmVsYXRpdml6ZShlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgaWYgKEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwgJ3Bvc2l0aW9uJykgPT09ICdyZWxhdGl2ZScpIHtcbiAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH1cblxuICAgIHZhciBvcmlnaW5hbFN0eWxlcyA9XG4gICAgIGVsZW1lbnQucmV0cmlldmUoJ3Byb3RvdHlwZV9hYnNvbHV0aXplX29yaWdpbmFsX3N0eWxlcycpO1xuXG4gICAgaWYgKG9yaWdpbmFsU3R5bGVzKSBlbGVtZW50LnNldFN0eWxlKG9yaWdpbmFsU3R5bGVzKTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gc2Nyb2xsVG8oZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBwb3MgPSBFbGVtZW50LmN1bXVsYXRpdmVPZmZzZXQoZWxlbWVudCk7XG4gICAgd2luZG93LnNjcm9sbFRvKHBvcy5sZWZ0LCBwb3MudG9wKTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gbWFrZVBvc2l0aW9uZWQoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBwb3NpdGlvbiA9IEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwgJ3Bvc2l0aW9uJyksIHN0eWxlcyA9IHt9O1xuICAgIGlmIChwb3NpdGlvbiA9PT0gJ3N0YXRpYycgfHwgIXBvc2l0aW9uKSB7XG4gICAgICBzdHlsZXMucG9zaXRpb24gPSAncmVsYXRpdmUnO1xuICAgICAgaWYgKFByb3RvdHlwZS5Ccm93c2VyLk9wZXJhKSB7XG4gICAgICAgIHN0eWxlcy50b3AgID0gMDtcbiAgICAgICAgc3R5bGVzLmxlZnQgPSAwO1xuICAgICAgfVxuICAgICAgRWxlbWVudC5zZXRTdHlsZShlbGVtZW50LCBzdHlsZXMpO1xuICAgICAgRWxlbWVudC5zdG9yZShlbGVtZW50LCAncHJvdG90eXBlX21hZGVfcG9zaXRpb25lZCcsIHRydWUpO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVuZG9Qb3NpdGlvbmVkKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICB2YXIgc3RvcmFnZSA9IEVsZW1lbnQuZ2V0U3RvcmFnZShlbGVtZW50KSxcbiAgICAgbWFkZVBvc2l0aW9uZWQgPSBzdG9yYWdlLmdldCgncHJvdG90eXBlX21hZGVfcG9zaXRpb25lZCcpO1xuXG4gICAgaWYgKG1hZGVQb3NpdGlvbmVkKSB7XG4gICAgICBzdG9yYWdlLnVuc2V0KCdwcm90b3R5cGVfbWFkZV9wb3NpdGlvbmVkJyk7XG4gICAgICBFbGVtZW50LnNldFN0eWxlKGVsZW1lbnQsIHtcbiAgICAgICAgcG9zaXRpb246ICcnLFxuICAgICAgICB0b3A6ICAgICAgJycsXG4gICAgICAgIGJvdHRvbTogICAnJyxcbiAgICAgICAgbGVmdDogICAgICcnLFxuICAgICAgICByaWdodDogICAgJydcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1ha2VDbGlwcGluZyhlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICB2YXIgc3RvcmFnZSA9IEVsZW1lbnQuZ2V0U3RvcmFnZShlbGVtZW50KSxcbiAgICAgbWFkZUNsaXBwaW5nID0gc3RvcmFnZS5nZXQoJ3Byb3RvdHlwZV9tYWRlX2NsaXBwaW5nJyk7XG5cbiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKG1hZGVDbGlwcGluZykpIHtcbiAgICAgIHZhciBvdmVyZmxvdyA9IEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwgJ292ZXJmbG93Jyk7XG4gICAgICBzdG9yYWdlLnNldCgncHJvdG90eXBlX21hZGVfY2xpcHBpbmcnLCBvdmVyZmxvdyk7XG4gICAgICBpZiAob3ZlcmZsb3cgIT09ICdoaWRkZW4nKVxuICAgICAgICBlbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICBmdW5jdGlvbiB1bmRvQ2xpcHBpbmcoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBzdG9yYWdlID0gRWxlbWVudC5nZXRTdG9yYWdlKGVsZW1lbnQpLFxuICAgICBvdmVyZmxvdyA9IHN0b3JhZ2UuZ2V0KCdwcm90b3R5cGVfbWFkZV9jbGlwcGluZycpO1xuXG4gICAgaWYgKCFPYmplY3QuaXNVbmRlZmluZWQob3ZlcmZsb3cpKSB7XG4gICAgICBzdG9yYWdlLnVuc2V0KCdwcm90b3R5cGVfbWFkZV9jbGlwcGluZycpO1xuICAgICAgZWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9IG92ZXJmbG93IHx8ICcnO1xuICAgIH1cblxuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gY2xvbmVQb3NpdGlvbihlbGVtZW50LCBzb3VyY2UsIG9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0gT2JqZWN0LmV4dGVuZCh7XG4gICAgICBzZXRMZWZ0OiAgICB0cnVlLFxuICAgICAgc2V0VG9wOiAgICAgdHJ1ZSxcbiAgICAgIHNldFdpZHRoOiAgIHRydWUsXG4gICAgICBzZXRIZWlnaHQ6ICB0cnVlLFxuICAgICAgb2Zmc2V0VG9wOiAgMCxcbiAgICAgIG9mZnNldExlZnQ6IDBcbiAgICB9LCBvcHRpb25zIHx8IHt9KTtcblxuICAgIHNvdXJjZSAgPSAkKHNvdXJjZSk7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgdmFyIHAsIGRlbHRhLCBsYXlvdXQsIHN0eWxlcyA9IHt9O1xuXG4gICAgaWYgKG9wdGlvbnMuc2V0TGVmdCB8fCBvcHRpb25zLnNldFRvcCkge1xuICAgICAgcCA9IEVsZW1lbnQudmlld3BvcnRPZmZzZXQoc291cmNlKTtcbiAgICAgIGRlbHRhID0gWzAsIDBdO1xuICAgICAgaWYgKEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwgJ3Bvc2l0aW9uJykgPT09ICdhYnNvbHV0ZScpIHtcbiAgICAgICAgdmFyIHBhcmVudCA9IEVsZW1lbnQuZ2V0T2Zmc2V0UGFyZW50KGVsZW1lbnQpO1xuICAgICAgICBpZiAocGFyZW50ICE9PSBkb2N1bWVudC5ib2R5KSBkZWx0YSA9IEVsZW1lbnQudmlld3BvcnRPZmZzZXQocGFyZW50KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5zZXRXaWR0aCB8fCBvcHRpb25zLnNldEhlaWdodCkge1xuICAgICAgbGF5b3V0ID0gRWxlbWVudC5nZXRMYXlvdXQoc291cmNlKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5zZXRMZWZ0KVxuICAgICAgc3R5bGVzLmxlZnQgPSAocFswXSAtIGRlbHRhWzBdICsgb3B0aW9ucy5vZmZzZXRMZWZ0KSArICdweCc7XG4gICAgaWYgKG9wdGlvbnMuc2V0VG9wKVxuICAgICAgc3R5bGVzLnRvcCAgPSAocFsxXSAtIGRlbHRhWzFdICsgb3B0aW9ucy5vZmZzZXRUb3ApICArICdweCc7XG5cbiAgICBpZiAob3B0aW9ucy5zZXRXaWR0aClcbiAgICAgIHN0eWxlcy53aWR0aCAgPSBsYXlvdXQuZ2V0KCdib3JkZXItYm94LXdpZHRoJykgICsgJ3B4JztcbiAgICBpZiAob3B0aW9ucy5zZXRIZWlnaHQpXG4gICAgICBzdHlsZXMuaGVpZ2h0ID0gbGF5b3V0LmdldCgnYm9yZGVyLWJveC1oZWlnaHQnKSArICdweCc7XG5cbiAgICByZXR1cm4gRWxlbWVudC5zZXRTdHlsZShlbGVtZW50LCBzdHlsZXMpO1xuICB9XG5cblxuICBpZiAoUHJvdG90eXBlLkJyb3dzZXIuSUUpIHtcbiAgICBnZXRPZmZzZXRQYXJlbnQgPSBnZXRPZmZzZXRQYXJlbnQud3JhcChcbiAgICAgIGZ1bmN0aW9uKHByb2NlZWQsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICAgICAgaWYgKGlzRG9jdW1lbnQoZWxlbWVudCkgfHwgaXNEZXRhY2hlZChlbGVtZW50KSB8fCBpc0JvZHkoZWxlbWVudCkgfHwgaXNIdG1sKGVsZW1lbnQpKVxuICAgICAgICAgIHJldHVybiAkKGRvY3VtZW50LmJvZHkpO1xuXG4gICAgICAgIHZhciBwb3NpdGlvbiA9IGVsZW1lbnQuZ2V0U3R5bGUoJ3Bvc2l0aW9uJyk7XG4gICAgICAgIGlmIChwb3NpdGlvbiAhPT0gJ3N0YXRpYycpIHJldHVybiBwcm9jZWVkKGVsZW1lbnQpO1xuXG4gICAgICAgIGVsZW1lbnQuc2V0U3R5bGUoeyBwb3NpdGlvbjogJ3JlbGF0aXZlJyB9KTtcbiAgICAgICAgdmFyIHZhbHVlID0gcHJvY2VlZChlbGVtZW50KTtcbiAgICAgICAgZWxlbWVudC5zZXRTdHlsZSh7IHBvc2l0aW9uOiBwb3NpdGlvbiB9KTtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfVxuICAgICk7XG5cbiAgICBwb3NpdGlvbmVkT2Zmc2V0ID0gcG9zaXRpb25lZE9mZnNldC53cmFwKGZ1bmN0aW9uKHByb2NlZWQsIGVsZW1lbnQpIHtcbiAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgaWYgKCFlbGVtZW50LnBhcmVudE5vZGUpIHJldHVybiBuZXcgRWxlbWVudC5PZmZzZXQoMCwgMCk7XG4gICAgICB2YXIgcG9zaXRpb24gPSBlbGVtZW50LmdldFN0eWxlKCdwb3NpdGlvbicpO1xuICAgICAgaWYgKHBvc2l0aW9uICE9PSAnc3RhdGljJykgcmV0dXJuIHByb2NlZWQoZWxlbWVudCk7XG5cbiAgICAgIHZhciBvZmZzZXRQYXJlbnQgPSBlbGVtZW50LmdldE9mZnNldFBhcmVudCgpO1xuICAgICAgaWYgKG9mZnNldFBhcmVudCAmJiBvZmZzZXRQYXJlbnQuZ2V0U3R5bGUoJ3Bvc2l0aW9uJykgPT09ICdmaXhlZCcpXG4gICAgICAgIGhhc0xheW91dChvZmZzZXRQYXJlbnQpO1xuXG4gICAgICBlbGVtZW50LnNldFN0eWxlKHsgcG9zaXRpb246ICdyZWxhdGl2ZScgfSk7XG4gICAgICB2YXIgdmFsdWUgPSBwcm9jZWVkKGVsZW1lbnQpO1xuICAgICAgZWxlbWVudC5zZXRTdHlsZSh7IHBvc2l0aW9uOiBwb3NpdGlvbiB9KTtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChQcm90b3R5cGUuQnJvd3Nlci5XZWJraXQpIHtcbiAgICBjdW11bGF0aXZlT2Zmc2V0ID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICB2YXIgdmFsdWVUID0gMCwgdmFsdWVMID0gMDtcbiAgICAgIGRvIHtcbiAgICAgICAgdmFsdWVUICs9IGVsZW1lbnQub2Zmc2V0VG9wICB8fCAwO1xuICAgICAgICB2YWx1ZUwgKz0gZWxlbWVudC5vZmZzZXRMZWZ0IHx8IDA7XG4gICAgICAgIGlmIChlbGVtZW50Lm9mZnNldFBhcmVudCA9PSBkb2N1bWVudC5ib2R5KSB7XG4gICAgICAgICAgaWYgKEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwgJ3Bvc2l0aW9uJykgPT0gJ2Fic29sdXRlJykgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQ7XG4gICAgICB9IHdoaWxlIChlbGVtZW50KTtcblxuICAgICAgcmV0dXJuIG5ldyBFbGVtZW50Lk9mZnNldCh2YWx1ZUwsIHZhbHVlVCk7XG4gICAgfTtcbiAgfVxuXG5cbiAgRWxlbWVudC5hZGRNZXRob2RzKHtcbiAgICBnZXRMYXlvdXQ6ICAgICAgICAgICAgICBnZXRMYXlvdXQsXG4gICAgbWVhc3VyZTogICAgICAgICAgICAgICAgbWVhc3VyZSxcbiAgICBnZXRXaWR0aDogICAgICAgICAgICAgICBnZXRXaWR0aCxcbiAgICBnZXRIZWlnaHQ6ICAgICAgICAgICAgICBnZXRIZWlnaHQsXG4gICAgZ2V0RGltZW5zaW9uczogICAgICAgICAgZ2V0RGltZW5zaW9ucyxcbiAgICBnZXRPZmZzZXRQYXJlbnQ6ICAgICAgICBnZXRPZmZzZXRQYXJlbnQsXG4gICAgY3VtdWxhdGl2ZU9mZnNldDogICAgICAgY3VtdWxhdGl2ZU9mZnNldCxcbiAgICBwb3NpdGlvbmVkT2Zmc2V0OiAgICAgICBwb3NpdGlvbmVkT2Zmc2V0LFxuICAgIGN1bXVsYXRpdmVTY3JvbGxPZmZzZXQ6IGN1bXVsYXRpdmVTY3JvbGxPZmZzZXQsXG4gICAgdmlld3BvcnRPZmZzZXQ6ICAgICAgICAgdmlld3BvcnRPZmZzZXQsXG4gICAgYWJzb2x1dGl6ZTogICAgICAgICAgICAgYWJzb2x1dGl6ZSxcbiAgICByZWxhdGl2aXplOiAgICAgICAgICAgICByZWxhdGl2aXplLFxuICAgIHNjcm9sbFRvOiAgICAgICAgICAgICAgIHNjcm9sbFRvLFxuICAgIG1ha2VQb3NpdGlvbmVkOiAgICAgICAgIG1ha2VQb3NpdGlvbmVkLFxuICAgIHVuZG9Qb3NpdGlvbmVkOiAgICAgICAgIHVuZG9Qb3NpdGlvbmVkLFxuICAgIG1ha2VDbGlwcGluZzogICAgICAgICAgIG1ha2VDbGlwcGluZyxcbiAgICB1bmRvQ2xpcHBpbmc6ICAgICAgICAgICB1bmRvQ2xpcHBpbmcsXG4gICAgY2xvbmVQb3NpdGlvbjogICAgICAgICAgY2xvbmVQb3NpdGlvblxuICB9KTtcblxuICBmdW5jdGlvbiBpc0JvZHkoZWxlbWVudCkge1xuICAgIHJldHVybiBlbGVtZW50Lm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdCT0RZJztcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzSHRtbChlbGVtZW50KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PT0gJ0hUTUwnO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNEb2N1bWVudChlbGVtZW50KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQubm9kZVR5cGUgPT09IE5vZGUuRE9DVU1FTlRfTk9ERTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzRGV0YWNoZWQoZWxlbWVudCkge1xuICAgIHJldHVybiBlbGVtZW50ICE9PSBkb2N1bWVudC5ib2R5ICYmXG4gICAgICFFbGVtZW50LmRlc2NlbmRhbnRPZihlbGVtZW50LCBkb2N1bWVudC5ib2R5KTtcbiAgfVxuXG4gIGlmICgnZ2V0Qm91bmRpbmdDbGllbnRSZWN0JyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHtcbiAgICBFbGVtZW50LmFkZE1ldGhvZHMoe1xuICAgICAgdmlld3BvcnRPZmZzZXQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIGlmIChpc0RldGFjaGVkKGVsZW1lbnQpKSByZXR1cm4gbmV3IEVsZW1lbnQuT2Zmc2V0KDAsIDApO1xuXG4gICAgICAgIHZhciByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgIGRvY0VsID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgICAgICByZXR1cm4gbmV3IEVsZW1lbnQuT2Zmc2V0KHJlY3QubGVmdCAtIGRvY0VsLmNsaWVudExlZnQsXG4gICAgICAgICByZWN0LnRvcCAtIGRvY0VsLmNsaWVudFRvcCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuXG59KSgpO1xuXG4oZnVuY3Rpb24oKSB7XG5cbiAgdmFyIElTX09MRF9PUEVSQSA9IFByb3RvdHlwZS5Ccm93c2VyLk9wZXJhICYmXG4gICAod2luZG93LnBhcnNlRmxvYXQod2luZG93Lm9wZXJhLnZlcnNpb24oKSkgPCA5LjUpO1xuICB2YXIgUk9PVCA9IG51bGw7XG4gIGZ1bmN0aW9uIGdldFJvb3RFbGVtZW50KCkge1xuICAgIGlmIChST09UKSByZXR1cm4gUk9PVDtcbiAgICBST09UID0gSVNfT0xEX09QRVJBID8gZG9jdW1lbnQuYm9keSA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgICByZXR1cm4gUk9PVDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldERpbWVuc2lvbnMoKSB7XG4gICAgcmV0dXJuIHsgd2lkdGg6IHRoaXMuZ2V0V2lkdGgoKSwgaGVpZ2h0OiB0aGlzLmdldEhlaWdodCgpIH07XG4gIH1cblxuICBmdW5jdGlvbiBnZXRXaWR0aCgpIHtcbiAgICByZXR1cm4gZ2V0Um9vdEVsZW1lbnQoKS5jbGllbnRXaWR0aDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEhlaWdodCgpIHtcbiAgICByZXR1cm4gZ2V0Um9vdEVsZW1lbnQoKS5jbGllbnRIZWlnaHQ7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTY3JvbGxPZmZzZXRzKCkge1xuICAgIHZhciB4ID0gd2luZG93LnBhZ2VYT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0IHx8XG4gICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdDtcbiAgICB2YXIgeSA9IHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8XG4gICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wO1xuXG4gICAgcmV0dXJuIG5ldyBFbGVtZW50Lk9mZnNldCh4LCB5KTtcbiAgfVxuXG4gIGRvY3VtZW50LnZpZXdwb3J0ID0ge1xuICAgIGdldERpbWVuc2lvbnM6ICAgIGdldERpbWVuc2lvbnMsXG4gICAgZ2V0V2lkdGg6ICAgICAgICAgZ2V0V2lkdGgsXG4gICAgZ2V0SGVpZ2h0OiAgICAgICAgZ2V0SGVpZ2h0LFxuICAgIGdldFNjcm9sbE9mZnNldHM6IGdldFNjcm9sbE9mZnNldHNcbiAgfTtcblxufSkoKTtcbndpbmRvdy4kJCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgZXhwcmVzc2lvbiA9ICRBKGFyZ3VtZW50cykuam9pbignLCAnKTtcbiAgcmV0dXJuIFByb3RvdHlwZS5TZWxlY3Rvci5zZWxlY3QoZXhwcmVzc2lvbiwgZG9jdW1lbnQpO1xufTtcblxuUHJvdG90eXBlLlNlbGVjdG9yID0gKGZ1bmN0aW9uKCkge1xuXG4gIGZ1bmN0aW9uIHNlbGVjdCgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZCBcIlByb3RvdHlwZS5TZWxlY3Rvci5zZWxlY3RcIiBtdXN0IGJlIGRlZmluZWQuJyk7XG4gIH1cblxuICBmdW5jdGlvbiBtYXRjaCgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZCBcIlByb3RvdHlwZS5TZWxlY3Rvci5tYXRjaFwiIG11c3QgYmUgZGVmaW5lZC4nKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmQoZWxlbWVudHMsIGV4cHJlc3Npb24sIGluZGV4KSB7XG4gICAgaW5kZXggPSBpbmRleCB8fCAwO1xuICAgIHZhciBtYXRjaCA9IFByb3RvdHlwZS5TZWxlY3Rvci5tYXRjaCwgbGVuZ3RoID0gZWxlbWVudHMubGVuZ3RoLCBtYXRjaEluZGV4ID0gMCwgaTtcblxuICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKG1hdGNoKGVsZW1lbnRzW2ldLCBleHByZXNzaW9uKSAmJiBpbmRleCA9PSBtYXRjaEluZGV4KyspIHtcbiAgICAgICAgcmV0dXJuIEVsZW1lbnQuZXh0ZW5kKGVsZW1lbnRzW2ldKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBleHRlbmRFbGVtZW50cyhlbGVtZW50cykge1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBlbGVtZW50cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgRWxlbWVudC5leHRlbmQoZWxlbWVudHNbaV0pO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudHM7XG4gIH1cblxuXG4gIHZhciBLID0gUHJvdG90eXBlLks7XG5cbiAgcmV0dXJuIHtcbiAgICBzZWxlY3Q6IHNlbGVjdCxcbiAgICBtYXRjaDogbWF0Y2gsXG4gICAgZmluZDogZmluZCxcbiAgICBleHRlbmRFbGVtZW50czogKEVsZW1lbnQuZXh0ZW5kID09PSBLKSA/IEsgOiBleHRlbmRFbGVtZW50cyxcbiAgICBleHRlbmRFbGVtZW50OiBFbGVtZW50LmV4dGVuZFxuICB9O1xufSkoKTtcblByb3RvdHlwZS5fb3JpZ2luYWxfcHJvcGVydHkgPSB3aW5kb3cuU2l6emxlO1xuLyohXG4gKiBTaXp6bGUgQ1NTIFNlbGVjdG9yIEVuZ2luZSB2QFZFUlNJT05cbiAqIGh0dHA6Ly9zaXp6bGVqcy5jb20vXG4gKlxuICogQ29weXJpZ2h0IDIwMTMgalF1ZXJ5IEZvdW5kYXRpb24sIEluYy4gYW5kIG90aGVyIGNvbnRyaWJ1dG9yc1xuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlXG4gKlxuICogRGF0ZTogQERBVEVcbiAqL1xuKGZ1bmN0aW9uKCB3aW5kb3cgKSB7XG5cbnZhciBpLFxuXHRzdXBwb3J0LFxuXHRFeHByLFxuXHRnZXRUZXh0LFxuXHRpc1hNTCxcblx0Y29tcGlsZSxcblx0c2VsZWN0LFxuXHRvdXRlcm1vc3RDb250ZXh0LFxuXHRzb3J0SW5wdXQsXG5cdGhhc0R1cGxpY2F0ZSxcblxuXHRzZXREb2N1bWVudCxcblx0ZG9jdW1lbnQsXG5cdGRvY0VsZW0sXG5cdGRvY3VtZW50SXNIVE1MLFxuXHRyYnVnZ3lRU0EsXG5cdHJidWdneU1hdGNoZXMsXG5cdG1hdGNoZXMsXG5cdGNvbnRhaW5zLFxuXG5cdGV4cGFuZG8gPSBcInNpenpsZVwiICsgLShuZXcgRGF0ZSgpKSxcblx0cHJlZmVycmVkRG9jID0gd2luZG93LmRvY3VtZW50LFxuXHRkaXJydW5zID0gMCxcblx0ZG9uZSA9IDAsXG5cdGNsYXNzQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLFxuXHR0b2tlbkNhY2hlID0gY3JlYXRlQ2FjaGUoKSxcblx0Y29tcGlsZXJDYWNoZSA9IGNyZWF0ZUNhY2hlKCksXG5cdHNvcnRPcmRlciA9IGZ1bmN0aW9uKCBhLCBiICkge1xuXHRcdGlmICggYSA9PT0gYiApIHtcblx0XHRcdGhhc0R1cGxpY2F0ZSA9IHRydWU7XG5cdFx0fVxuXHRcdHJldHVybiAwO1xuXHR9LFxuXG5cdHN0cnVuZGVmaW5lZCA9IHR5cGVvZiB1bmRlZmluZWQsXG5cdE1BWF9ORUdBVElWRSA9IDEgPDwgMzEsXG5cblx0aGFzT3duID0gKHt9KS5oYXNPd25Qcm9wZXJ0eSxcblx0YXJyID0gW10sXG5cdHBvcCA9IGFyci5wb3AsXG5cdHB1c2hfbmF0aXZlID0gYXJyLnB1c2gsXG5cdHB1c2ggPSBhcnIucHVzaCxcblx0c2xpY2UgPSBhcnIuc2xpY2UsXG5cdGluZGV4T2YgPSBhcnIuaW5kZXhPZiB8fCBmdW5jdGlvbiggZWxlbSApIHtcblx0XHR2YXIgaSA9IDAsXG5cdFx0XHRsZW4gPSB0aGlzLmxlbmd0aDtcblx0XHRmb3IgKCA7IGkgPCBsZW47IGkrKyApIHtcblx0XHRcdGlmICggdGhpc1tpXSA9PT0gZWxlbSApIHtcblx0XHRcdFx0cmV0dXJuIGk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiAtMTtcblx0fSxcblxuXHRib29sZWFucyA9IFwiY2hlY2tlZHxzZWxlY3RlZHxhc3luY3xhdXRvZm9jdXN8YXV0b3BsYXl8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGlzbWFwfGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWRcIixcblxuXG5cdHdoaXRlc3BhY2UgPSBcIltcXFxceDIwXFxcXHRcXFxcclxcXFxuXFxcXGZdXCIsXG5cdGNoYXJhY3RlckVuY29kaW5nID0gXCIoPzpcXFxcXFxcXC58W1xcXFx3LV18W15cXFxceDAwLVxcXFx4YTBdKStcIixcblxuXHRpZGVudGlmaWVyID0gY2hhcmFjdGVyRW5jb2RpbmcucmVwbGFjZSggXCJ3XCIsIFwidyNcIiApLFxuXG5cdGF0dHJpYnV0ZXMgPSBcIlxcXFxbXCIgKyB3aGl0ZXNwYWNlICsgXCIqKFwiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyBcIilcIiArIHdoaXRlc3BhY2UgK1xuXHRcdFwiKig/OihbKl4kfCF+XT89KVwiICsgd2hpdGVzcGFjZSArIFwiKig/OihbJ1xcXCJdKSgoPzpcXFxcXFxcXC58W15cXFxcXFxcXF0pKj8pXFxcXDN8KFwiICsgaWRlbnRpZmllciArIFwiKXwpfClcIiArIHdoaXRlc3BhY2UgKyBcIipcXFxcXVwiLFxuXG5cdHBzZXVkb3MgPSBcIjooXCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArIFwiKSg/OlxcXFwoKChbJ1xcXCJdKSgoPzpcXFxcXFxcXC58W15cXFxcXFxcXF0pKj8pXFxcXDN8KCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcKClbXFxcXF1dfFwiICsgYXR0cmlidXRlcy5yZXBsYWNlKCAzLCA4ICkgKyBcIikqKXwuKilcXFxcKXwpXCIsXG5cblx0cnRyaW0gPSBuZXcgUmVnRXhwKCBcIl5cIiArIHdoaXRlc3BhY2UgKyBcIit8KCg/Ol58W15cXFxcXFxcXF0pKD86XFxcXFxcXFwuKSopXCIgKyB3aGl0ZXNwYWNlICsgXCIrJFwiLCBcImdcIiApLFxuXG5cdHJjb21tYSA9IG5ldyBSZWdFeHAoIFwiXlwiICsgd2hpdGVzcGFjZSArIFwiKixcIiArIHdoaXRlc3BhY2UgKyBcIipcIiApLFxuXHRyY29tYmluYXRvcnMgPSBuZXcgUmVnRXhwKCBcIl5cIiArIHdoaXRlc3BhY2UgKyBcIiooWz4rfl18XCIgKyB3aGl0ZXNwYWNlICsgXCIpXCIgKyB3aGl0ZXNwYWNlICsgXCIqXCIgKSxcblxuXHRyYXR0cmlidXRlUXVvdGVzID0gbmV3IFJlZ0V4cCggXCI9XCIgKyB3aGl0ZXNwYWNlICsgXCIqKFteXFxcXF0nXFxcIl0qPylcIiArIHdoaXRlc3BhY2UgKyBcIipcXFxcXVwiLCBcImdcIiApLFxuXG5cdHJwc2V1ZG8gPSBuZXcgUmVnRXhwKCBwc2V1ZG9zICksXG5cdHJpZGVudGlmaWVyID0gbmV3IFJlZ0V4cCggXCJeXCIgKyBpZGVudGlmaWVyICsgXCIkXCIgKSxcblxuXHRtYXRjaEV4cHIgPSB7XG5cdFx0XCJJRFwiOiBuZXcgUmVnRXhwKCBcIl4jKFwiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyBcIilcIiApLFxuXHRcdFwiQ0xBU1NcIjogbmV3IFJlZ0V4cCggXCJeXFxcXC4oXCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArIFwiKVwiICksXG5cdFx0XCJUQUdcIjogbmV3IFJlZ0V4cCggXCJeKFwiICsgY2hhcmFjdGVyRW5jb2RpbmcucmVwbGFjZSggXCJ3XCIsIFwidypcIiApICsgXCIpXCIgKSxcblx0XHRcIkFUVFJcIjogbmV3IFJlZ0V4cCggXCJeXCIgKyBhdHRyaWJ1dGVzICksXG5cdFx0XCJQU0VVRE9cIjogbmV3IFJlZ0V4cCggXCJeXCIgKyBwc2V1ZG9zICksXG5cdFx0XCJDSElMRFwiOiBuZXcgUmVnRXhwKCBcIl46KG9ubHl8Zmlyc3R8bGFzdHxudGh8bnRoLWxhc3QpLShjaGlsZHxvZi10eXBlKSg/OlxcXFwoXCIgKyB3aGl0ZXNwYWNlICtcblx0XHRcdFwiKihldmVufG9kZHwoKFsrLV18KShcXFxcZCopbnwpXCIgKyB3aGl0ZXNwYWNlICsgXCIqKD86KFsrLV18KVwiICsgd2hpdGVzcGFjZSArXG5cdFx0XHRcIiooXFxcXGQrKXwpKVwiICsgd2hpdGVzcGFjZSArIFwiKlxcXFwpfClcIiwgXCJpXCIgKSxcblx0XHRcImJvb2xcIjogbmV3IFJlZ0V4cCggXCJeKD86XCIgKyBib29sZWFucyArIFwiKSRcIiwgXCJpXCIgKSxcblx0XHRcIm5lZWRzQ29udGV4dFwiOiBuZXcgUmVnRXhwKCBcIl5cIiArIHdoaXRlc3BhY2UgKyBcIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcXFwoXCIgK1xuXHRcdFx0d2hpdGVzcGFjZSArIFwiKigoPzotXFxcXGQpP1xcXFxkKilcIiArIHdoaXRlc3BhY2UgKyBcIipcXFxcKXwpKD89W14tXXwkKVwiLCBcImlcIiApXG5cdH0sXG5cblx0cmlucHV0cyA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbikkL2ksXG5cdHJoZWFkZXIgPSAvXmhcXGQkL2ksXG5cblx0cm5hdGl2ZSA9IC9eW157XStcXHtcXHMqXFxbbmF0aXZlIFxcdy8sXG5cblx0cnF1aWNrRXhwciA9IC9eKD86IyhbXFx3LV0rKXwoXFx3Kyl8XFwuKFtcXHctXSspKSQvLFxuXG5cdHJzaWJsaW5nID0gL1srfl0vLFxuXHRyZXNjYXBlID0gLyd8XFxcXC9nLFxuXG5cdHJ1bmVzY2FwZSA9IG5ldyBSZWdFeHAoIFwiXFxcXFxcXFwoW1xcXFxkYS1mXXsxLDZ9XCIgKyB3aGl0ZXNwYWNlICsgXCI/fChcIiArIHdoaXRlc3BhY2UgKyBcIil8LilcIiwgXCJpZ1wiICksXG5cdGZ1bmVzY2FwZSA9IGZ1bmN0aW9uKCBfLCBlc2NhcGVkLCBlc2NhcGVkV2hpdGVzcGFjZSApIHtcblx0XHR2YXIgaGlnaCA9IFwiMHhcIiArIGVzY2FwZWQgLSAweDEwMDAwO1xuXHRcdHJldHVybiBoaWdoICE9PSBoaWdoIHx8IGVzY2FwZWRXaGl0ZXNwYWNlID9cblx0XHRcdGVzY2FwZWQgOlxuXHRcdFx0aGlnaCA8IDAgP1xuXHRcdFx0XHRTdHJpbmcuZnJvbUNoYXJDb2RlKCBoaWdoICsgMHgxMDAwMCApIDpcblx0XHRcdFx0U3RyaW5nLmZyb21DaGFyQ29kZSggaGlnaCA+PiAxMCB8IDB4RDgwMCwgaGlnaCAmIDB4M0ZGIHwgMHhEQzAwICk7XG5cdH07XG5cbnRyeSB7XG5cdHB1c2guYXBwbHkoXG5cdFx0KGFyciA9IHNsaWNlLmNhbGwoIHByZWZlcnJlZERvYy5jaGlsZE5vZGVzICkpLFxuXHRcdHByZWZlcnJlZERvYy5jaGlsZE5vZGVzXG5cdCk7XG5cdGFyclsgcHJlZmVycmVkRG9jLmNoaWxkTm9kZXMubGVuZ3RoIF0ubm9kZVR5cGU7XG59IGNhdGNoICggZSApIHtcblx0cHVzaCA9IHsgYXBwbHk6IGFyci5sZW5ndGggP1xuXG5cdFx0ZnVuY3Rpb24oIHRhcmdldCwgZWxzICkge1xuXHRcdFx0cHVzaF9uYXRpdmUuYXBwbHkoIHRhcmdldCwgc2xpY2UuY2FsbChlbHMpICk7XG5cdFx0fSA6XG5cblx0XHRmdW5jdGlvbiggdGFyZ2V0LCBlbHMgKSB7XG5cdFx0XHR2YXIgaiA9IHRhcmdldC5sZW5ndGgsXG5cdFx0XHRcdGkgPSAwO1xuXHRcdFx0d2hpbGUgKCAodGFyZ2V0W2orK10gPSBlbHNbaSsrXSkgKSB7fVxuXHRcdFx0dGFyZ2V0Lmxlbmd0aCA9IGogLSAxO1xuXHRcdH1cblx0fTtcbn1cblxuZnVuY3Rpb24gU2l6emxlKCBzZWxlY3RvciwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApIHtcblx0dmFyIG1hdGNoLCBlbGVtLCBtLCBub2RlVHlwZSxcblx0XHRpLCBncm91cHMsIG9sZCwgbmlkLCBuZXdDb250ZXh0LCBuZXdTZWxlY3RvcjtcblxuXHRpZiAoICggY29udGV4dCA/IGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0IDogcHJlZmVycmVkRG9jICkgIT09IGRvY3VtZW50ICkge1xuXHRcdHNldERvY3VtZW50KCBjb250ZXh0ICk7XG5cdH1cblxuXHRjb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDtcblx0cmVzdWx0cyA9IHJlc3VsdHMgfHwgW107XG5cblx0aWYgKCAhc2VsZWN0b3IgfHwgdHlwZW9mIHNlbGVjdG9yICE9PSBcInN0cmluZ1wiICkge1xuXHRcdHJldHVybiByZXN1bHRzO1xuXHR9XG5cblx0aWYgKCAobm9kZVR5cGUgPSBjb250ZXh0Lm5vZGVUeXBlKSAhPT0gMSAmJiBub2RlVHlwZSAhPT0gOSApIHtcblx0XHRyZXR1cm4gW107XG5cdH1cblxuXHRpZiAoIGRvY3VtZW50SXNIVE1MICYmICFzZWVkICkge1xuXG5cdFx0aWYgKCAobWF0Y2ggPSBycXVpY2tFeHByLmV4ZWMoIHNlbGVjdG9yICkpICkge1xuXHRcdFx0aWYgKCAobSA9IG1hdGNoWzFdKSApIHtcblx0XHRcdFx0aWYgKCBub2RlVHlwZSA9PT0gOSApIHtcblx0XHRcdFx0XHRlbGVtID0gY29udGV4dC5nZXRFbGVtZW50QnlJZCggbSApO1xuXHRcdFx0XHRcdGlmICggZWxlbSAmJiBlbGVtLnBhcmVudE5vZGUgKSB7XG5cdFx0XHRcdFx0XHRpZiAoIGVsZW0uaWQgPT09IG0gKSB7XG5cdFx0XHRcdFx0XHRcdHJlc3VsdHMucHVzaCggZWxlbSApO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0cztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3VsdHM7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGlmICggY29udGV4dC5vd25lckRvY3VtZW50ICYmIChlbGVtID0gY29udGV4dC5vd25lckRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBtICkpICYmXG5cdFx0XHRcdFx0XHRjb250YWlucyggY29udGV4dCwgZWxlbSApICYmIGVsZW0uaWQgPT09IG0gKSB7XG5cdFx0XHRcdFx0XHRyZXN1bHRzLnB1c2goIGVsZW0gKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXN1bHRzO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHR9IGVsc2UgaWYgKCBtYXRjaFsyXSApIHtcblx0XHRcdFx0cHVzaC5hcHBseSggcmVzdWx0cywgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggc2VsZWN0b3IgKSApO1xuXHRcdFx0XHRyZXR1cm4gcmVzdWx0cztcblxuXHRcdFx0fSBlbHNlIGlmICggKG0gPSBtYXRjaFszXSkgJiYgc3VwcG9ydC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICYmIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSApIHtcblx0XHRcdFx0cHVzaC5hcHBseSggcmVzdWx0cywgY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCBtICkgKTtcblx0XHRcdFx0cmV0dXJuIHJlc3VsdHM7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCBzdXBwb3J0LnFzYSAmJiAoIXJidWdneVFTQSB8fCAhcmJ1Z2d5UVNBLnRlc3QoIHNlbGVjdG9yICkpICkge1xuXHRcdFx0bmlkID0gb2xkID0gZXhwYW5kbztcblx0XHRcdG5ld0NvbnRleHQgPSBjb250ZXh0O1xuXHRcdFx0bmV3U2VsZWN0b3IgPSBub2RlVHlwZSA9PT0gOSAmJiBzZWxlY3RvcjtcblxuXHRcdFx0aWYgKCBub2RlVHlwZSA9PT0gMSAmJiBjb250ZXh0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09IFwib2JqZWN0XCIgKSB7XG5cdFx0XHRcdGdyb3VwcyA9IHRva2VuaXplKCBzZWxlY3RvciApO1xuXG5cdFx0XHRcdGlmICggKG9sZCA9IGNvbnRleHQuZ2V0QXR0cmlidXRlKFwiaWRcIikpICkge1xuXHRcdFx0XHRcdG5pZCA9IG9sZC5yZXBsYWNlKCByZXNjYXBlLCBcIlxcXFwkJlwiICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29udGV4dC5zZXRBdHRyaWJ1dGUoIFwiaWRcIiwgbmlkICk7XG5cdFx0XHRcdH1cblx0XHRcdFx0bmlkID0gXCJbaWQ9J1wiICsgbmlkICsgXCInXSBcIjtcblxuXHRcdFx0XHRpID0gZ3JvdXBzLmxlbmd0aDtcblx0XHRcdFx0d2hpbGUgKCBpLS0gKSB7XG5cdFx0XHRcdFx0Z3JvdXBzW2ldID0gbmlkICsgdG9TZWxlY3RvciggZ3JvdXBzW2ldICk7XG5cdFx0XHRcdH1cblx0XHRcdFx0bmV3Q29udGV4dCA9IHJzaWJsaW5nLnRlc3QoIHNlbGVjdG9yICkgJiYgdGVzdENvbnRleHQoIGNvbnRleHQucGFyZW50Tm9kZSApIHx8IGNvbnRleHQ7XG5cdFx0XHRcdG5ld1NlbGVjdG9yID0gZ3JvdXBzLmpvaW4oXCIsXCIpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIG5ld1NlbGVjdG9yICkge1xuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdHB1c2guYXBwbHkoIHJlc3VsdHMsXG5cdFx0XHRcdFx0XHRuZXdDb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwoIG5ld1NlbGVjdG9yIClcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdHJldHVybiByZXN1bHRzO1xuXHRcdFx0XHR9IGNhdGNoKHFzYUVycm9yKSB7XG5cdFx0XHRcdH0gZmluYWxseSB7XG5cdFx0XHRcdFx0aWYgKCAhb2xkICkge1xuXHRcdFx0XHRcdFx0Y29udGV4dC5yZW1vdmVBdHRyaWJ1dGUoXCJpZFwiKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gc2VsZWN0KCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgXCIkMVwiICksIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQgKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUga2V5LXZhbHVlIGNhY2hlcyBvZiBsaW1pdGVkIHNpemVcbiAqIEByZXR1cm5zIHtGdW5jdGlvbihzdHJpbmcsIE9iamVjdCl9IFJldHVybnMgdGhlIE9iamVjdCBkYXRhIGFmdGVyIHN0b3JpbmcgaXQgb24gaXRzZWxmIHdpdGhcbiAqXHRwcm9wZXJ0eSBuYW1lIHRoZSAoc3BhY2Utc3VmZml4ZWQpIHN0cmluZyBhbmQgKGlmIHRoZSBjYWNoZSBpcyBsYXJnZXIgdGhhbiBFeHByLmNhY2hlTGVuZ3RoKVxuICpcdGRlbGV0aW5nIHRoZSBvbGRlc3QgZW50cnlcbiAqL1xuZnVuY3Rpb24gY3JlYXRlQ2FjaGUoKSB7XG5cdHZhciBrZXlzID0gW107XG5cblx0ZnVuY3Rpb24gY2FjaGUoIGtleSwgdmFsdWUgKSB7XG5cdFx0aWYgKCBrZXlzLnB1c2goIGtleSArIFwiIFwiICkgPiBFeHByLmNhY2hlTGVuZ3RoICkge1xuXHRcdFx0ZGVsZXRlIGNhY2hlWyBrZXlzLnNoaWZ0KCkgXTtcblx0XHR9XG5cdFx0cmV0dXJuIChjYWNoZVsga2V5ICsgXCIgXCIgXSA9IHZhbHVlKTtcblx0fVxuXHRyZXR1cm4gY2FjaGU7XG59XG5cbi8qKlxuICogTWFyayBhIGZ1bmN0aW9uIGZvciBzcGVjaWFsIHVzZSBieSBTaXp6bGVcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFRoZSBmdW5jdGlvbiB0byBtYXJrXG4gKi9cbmZ1bmN0aW9uIG1hcmtGdW5jdGlvbiggZm4gKSB7XG5cdGZuWyBleHBhbmRvIF0gPSB0cnVlO1xuXHRyZXR1cm4gZm47XG59XG5cbi8qKlxuICogU3VwcG9ydCB0ZXN0aW5nIHVzaW5nIGFuIGVsZW1lbnRcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFBhc3NlZCB0aGUgY3JlYXRlZCBkaXYgYW5kIGV4cGVjdHMgYSBib29sZWFuIHJlc3VsdFxuICovXG5mdW5jdGlvbiBhc3NlcnQoIGZuICkge1xuXHR2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHR0cnkge1xuXHRcdHJldHVybiAhIWZuKCBkaXYgKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fSBmaW5hbGx5IHtcblx0XHRpZiAoIGRpdi5wYXJlbnROb2RlICkge1xuXHRcdFx0ZGl2LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIGRpdiApO1xuXHRcdH1cblx0XHRkaXYgPSBudWxsO1xuXHR9XG59XG5cbi8qKlxuICogQWRkcyB0aGUgc2FtZSBoYW5kbGVyIGZvciBhbGwgb2YgdGhlIHNwZWNpZmllZCBhdHRyc1xuICogQHBhcmFtIHtTdHJpbmd9IGF0dHJzIFBpcGUtc2VwYXJhdGVkIGxpc3Qgb2YgYXR0cmlidXRlc1xuICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciBUaGUgbWV0aG9kIHRoYXQgd2lsbCBiZSBhcHBsaWVkXG4gKi9cbmZ1bmN0aW9uIGFkZEhhbmRsZSggYXR0cnMsIGhhbmRsZXIgKSB7XG5cdHZhciBhcnIgPSBhdHRycy5zcGxpdChcInxcIiksXG5cdFx0aSA9IGF0dHJzLmxlbmd0aDtcblxuXHR3aGlsZSAoIGktLSApIHtcblx0XHRFeHByLmF0dHJIYW5kbGVbIGFycltpXSBdID0gaGFuZGxlcjtcblx0fVxufVxuXG4vKipcbiAqIENoZWNrcyBkb2N1bWVudCBvcmRlciBvZiB0d28gc2libGluZ3NcbiAqIEBwYXJhbSB7RWxlbWVudH0gYVxuICogQHBhcmFtIHtFbGVtZW50fSBiXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBSZXR1cm5zIGxlc3MgdGhhbiAwIGlmIGEgcHJlY2VkZXMgYiwgZ3JlYXRlciB0aGFuIDAgaWYgYSBmb2xsb3dzIGJcbiAqL1xuZnVuY3Rpb24gc2libGluZ0NoZWNrKCBhLCBiICkge1xuXHR2YXIgY3VyID0gYiAmJiBhLFxuXHRcdGRpZmYgPSBjdXIgJiYgYS5ub2RlVHlwZSA9PT0gMSAmJiBiLm5vZGVUeXBlID09PSAxICYmXG5cdFx0XHQoIH5iLnNvdXJjZUluZGV4IHx8IE1BWF9ORUdBVElWRSApIC1cblx0XHRcdCggfmEuc291cmNlSW5kZXggfHwgTUFYX05FR0FUSVZFICk7XG5cblx0aWYgKCBkaWZmICkge1xuXHRcdHJldHVybiBkaWZmO1xuXHR9XG5cblx0aWYgKCBjdXIgKSB7XG5cdFx0d2hpbGUgKCAoY3VyID0gY3VyLm5leHRTaWJsaW5nKSApIHtcblx0XHRcdGlmICggY3VyID09PSBiICkge1xuXHRcdFx0XHRyZXR1cm4gLTE7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIGEgPyAxIDogLTE7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBpbnB1dCB0eXBlc1xuICogQHBhcmFtIHtTdHJpbmd9IHR5cGVcbiAqL1xuZnVuY3Rpb24gY3JlYXRlSW5wdXRQc2V1ZG8oIHR5cGUgKSB7XG5cdHJldHVybiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHR2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRyZXR1cm4gbmFtZSA9PT0gXCJpbnB1dFwiICYmIGVsZW0udHlwZSA9PT0gdHlwZTtcblx0fTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGJ1dHRvbnNcbiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUJ1dHRvblBzZXVkbyggdHlwZSApIHtcblx0cmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdHZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO1xuXHRcdHJldHVybiAobmFtZSA9PT0gXCJpbnB1dFwiIHx8IG5hbWUgPT09IFwiYnV0dG9uXCIpICYmIGVsZW0udHlwZSA9PT0gdHlwZTtcblx0fTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIHBvc2l0aW9uYWxzXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmblxuICovXG5mdW5jdGlvbiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKCBmbiApIHtcblx0cmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggYXJndW1lbnQgKSB7XG5cdFx0YXJndW1lbnQgPSArYXJndW1lbnQ7XG5cdFx0cmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgbWF0Y2hlcyApIHtcblx0XHRcdHZhciBqLFxuXHRcdFx0XHRtYXRjaEluZGV4ZXMgPSBmbiggW10sIHNlZWQubGVuZ3RoLCBhcmd1bWVudCApLFxuXHRcdFx0XHRpID0gbWF0Y2hJbmRleGVzLmxlbmd0aDtcblxuXHRcdFx0d2hpbGUgKCBpLS0gKSB7XG5cdFx0XHRcdGlmICggc2VlZFsgKGogPSBtYXRjaEluZGV4ZXNbaV0pIF0gKSB7XG5cdFx0XHRcdFx0c2VlZFtqXSA9ICEobWF0Y2hlc1tqXSA9IHNlZWRbal0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH0pO1xufVxuXG4vKipcbiAqIENoZWNrcyBhIG5vZGUgZm9yIHZhbGlkaXR5IGFzIGEgU2l6emxlIGNvbnRleHRcbiAqIEBwYXJhbSB7RWxlbWVudHxPYmplY3Q9fSBjb250ZXh0XG4gKiBAcmV0dXJucyB7RWxlbWVudHxPYmplY3R8Qm9vbGVhbn0gVGhlIGlucHV0IG5vZGUgaWYgYWNjZXB0YWJsZSwgb3RoZXJ3aXNlIGEgZmFsc3kgdmFsdWVcbiAqL1xuZnVuY3Rpb24gdGVzdENvbnRleHQoIGNvbnRleHQgKSB7XG5cdHJldHVybiBjb250ZXh0ICYmIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSBzdHJ1bmRlZmluZWQgJiYgY29udGV4dDtcbn1cblxuc3VwcG9ydCA9IFNpenpsZS5zdXBwb3J0ID0ge307XG5cbi8qKlxuICogRGV0ZWN0cyBYTUwgbm9kZXNcbiAqIEBwYXJhbSB7RWxlbWVudHxPYmplY3R9IGVsZW0gQW4gZWxlbWVudCBvciBhIGRvY3VtZW50XG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZmYgZWxlbSBpcyBhIG5vbi1IVE1MIFhNTCBub2RlXG4gKi9cbmlzWE1MID0gU2l6emxlLmlzWE1MID0gZnVuY3Rpb24oIGVsZW0gKSB7XG5cdHZhciBkb2N1bWVudEVsZW1lbnQgPSBlbGVtICYmIChlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbSkuZG9jdW1lbnRFbGVtZW50O1xuXHRyZXR1cm4gZG9jdW1lbnRFbGVtZW50ID8gZG9jdW1lbnRFbGVtZW50Lm5vZGVOYW1lICE9PSBcIkhUTUxcIiA6IGZhbHNlO1xufTtcblxuLyoqXG4gKiBTZXRzIGRvY3VtZW50LXJlbGF0ZWQgdmFyaWFibGVzIG9uY2UgYmFzZWQgb24gdGhlIGN1cnJlbnQgZG9jdW1lbnRcbiAqIEBwYXJhbSB7RWxlbWVudHxPYmplY3R9IFtkb2NdIEFuIGVsZW1lbnQgb3IgZG9jdW1lbnQgb2JqZWN0IHRvIHVzZSB0byBzZXQgdGhlIGRvY3VtZW50XG4gKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjdXJyZW50IGRvY3VtZW50XG4gKi9cbnNldERvY3VtZW50ID0gU2l6emxlLnNldERvY3VtZW50ID0gZnVuY3Rpb24oIG5vZGUgKSB7XG5cdHZhciBoYXNDb21wYXJlLFxuXHRcdGRvYyA9IG5vZGUgPyBub2RlLm93bmVyRG9jdW1lbnQgfHwgbm9kZSA6IHByZWZlcnJlZERvYyxcblx0XHRwYXJlbnQgPSBkb2MuZGVmYXVsdFZpZXc7XG5cblx0aWYgKCBkb2MgPT09IGRvY3VtZW50IHx8IGRvYy5ub2RlVHlwZSAhPT0gOSB8fCAhZG9jLmRvY3VtZW50RWxlbWVudCApIHtcblx0XHRyZXR1cm4gZG9jdW1lbnQ7XG5cdH1cblxuXHRkb2N1bWVudCA9IGRvYztcblx0ZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7XG5cblx0ZG9jdW1lbnRJc0hUTUwgPSAhaXNYTUwoIGRvYyApO1xuXG5cdGlmICggcGFyZW50ICYmIHBhcmVudCAhPT0gcGFyZW50LnRvcCApIHtcblx0XHRpZiAoIHBhcmVudC5hZGRFdmVudExpc3RlbmVyICkge1xuXHRcdFx0cGFyZW50LmFkZEV2ZW50TGlzdGVuZXIoIFwidW5sb2FkXCIsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRzZXREb2N1bWVudCgpO1xuXHRcdFx0fSwgZmFsc2UgKTtcblx0XHR9IGVsc2UgaWYgKCBwYXJlbnQuYXR0YWNoRXZlbnQgKSB7XG5cdFx0XHRwYXJlbnQuYXR0YWNoRXZlbnQoIFwib251bmxvYWRcIiwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHNldERvY3VtZW50KCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHQvKiBBdHRyaWJ1dGVzXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuXHRzdXBwb3J0LmF0dHJpYnV0ZXMgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHtcblx0XHRkaXYuY2xhc3NOYW1lID0gXCJpXCI7XG5cdFx0cmV0dXJuICFkaXYuZ2V0QXR0cmlidXRlKFwiY2xhc3NOYW1lXCIpO1xuXHR9KTtcblxuXHQvKiBnZXRFbGVtZW50KHMpQnkqXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuXHRzdXBwb3J0LmdldEVsZW1lbnRzQnlUYWdOYW1lID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7XG5cdFx0ZGl2LmFwcGVuZENoaWxkKCBkb2MuY3JlYXRlQ29tbWVudChcIlwiKSApO1xuXHRcdHJldHVybiAhZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKS5sZW5ndGg7XG5cdH0pO1xuXG5cdHN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IHJuYXRpdmUudGVzdCggZG9jLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKSAmJiBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHtcblx0XHRkaXYuaW5uZXJIVE1MID0gXCI8ZGl2IGNsYXNzPSdhJz48L2Rpdj48ZGl2IGNsYXNzPSdhIGknPjwvZGl2PlwiO1xuXG5cdFx0ZGl2LmZpcnN0Q2hpbGQuY2xhc3NOYW1lID0gXCJpXCI7XG5cdFx0cmV0dXJuIGRpdi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiaVwiKS5sZW5ndGggPT09IDI7XG5cdH0pO1xuXG5cdHN1cHBvcnQuZ2V0QnlJZCA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkge1xuXHRcdGRvY0VsZW0uYXBwZW5kQ2hpbGQoIGRpdiApLmlkID0gZXhwYW5kbztcblx0XHRyZXR1cm4gIWRvYy5nZXRFbGVtZW50c0J5TmFtZSB8fCAhZG9jLmdldEVsZW1lbnRzQnlOYW1lKCBleHBhbmRvICkubGVuZ3RoO1xuXHR9KTtcblxuXHRpZiAoIHN1cHBvcnQuZ2V0QnlJZCApIHtcblx0XHRFeHByLmZpbmRbXCJJRFwiXSA9IGZ1bmN0aW9uKCBpZCwgY29udGV4dCApIHtcblx0XHRcdGlmICggdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQgIT09IHN0cnVuZGVmaW5lZCAmJiBkb2N1bWVudElzSFRNTCApIHtcblx0XHRcdFx0dmFyIG0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKCBpZCApO1xuXHRcdFx0XHRyZXR1cm4gbSAmJiBtLnBhcmVudE5vZGUgPyBbbV0gOiBbXTtcblx0XHRcdH1cblx0XHR9O1xuXHRcdEV4cHIuZmlsdGVyW1wiSURcIl0gPSBmdW5jdGlvbiggaWQgKSB7XG5cdFx0XHR2YXIgYXR0cklkID0gaWQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTtcblx0XHRcdHJldHVybiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdFx0cmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKFwiaWRcIikgPT09IGF0dHJJZDtcblx0XHRcdH07XG5cdFx0fTtcblx0fSBlbHNlIHtcblx0XHRkZWxldGUgRXhwci5maW5kW1wiSURcIl07XG5cblx0XHRFeHByLmZpbHRlcltcIklEXCJdID0gIGZ1bmN0aW9uKCBpZCApIHtcblx0XHRcdHZhciBhdHRySWQgPSBpZC5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApO1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHR2YXIgbm9kZSA9IHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZU5vZGUgIT09IHN0cnVuZGVmaW5lZCAmJiBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoXCJpZFwiKTtcblx0XHRcdFx0cmV0dXJuIG5vZGUgJiYgbm9kZS52YWx1ZSA9PT0gYXR0cklkO1xuXHRcdFx0fTtcblx0XHR9O1xuXHR9XG5cblx0RXhwci5maW5kW1wiVEFHXCJdID0gc3VwcG9ydC5nZXRFbGVtZW50c0J5VGFnTmFtZSA/XG5cdFx0ZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHtcblx0XHRcdGlmICggdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgIT09IHN0cnVuZGVmaW5lZCApIHtcblx0XHRcdFx0cmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApO1xuXHRcdFx0fVxuXHRcdH0gOlxuXHRcdGZ1bmN0aW9uKCB0YWcsIGNvbnRleHQgKSB7XG5cdFx0XHR2YXIgZWxlbSxcblx0XHRcdFx0dG1wID0gW10sXG5cdFx0XHRcdGkgPSAwLFxuXHRcdFx0XHRyZXN1bHRzID0gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnICk7XG5cblx0XHRcdGlmICggdGFnID09PSBcIipcIiApIHtcblx0XHRcdFx0d2hpbGUgKCAoZWxlbSA9IHJlc3VsdHNbaSsrXSkgKSB7XG5cdFx0XHRcdFx0aWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkge1xuXHRcdFx0XHRcdFx0dG1wLnB1c2goIGVsZW0gKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdG1wO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJlc3VsdHM7XG5cdFx0fTtcblxuXHRFeHByLmZpbmRbXCJDTEFTU1wiXSA9IHN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBmdW5jdGlvbiggY2xhc3NOYW1lLCBjb250ZXh0ICkge1xuXHRcdGlmICggdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAhPT0gc3RydW5kZWZpbmVkICYmIGRvY3VtZW50SXNIVE1MICkge1xuXHRcdFx0cmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSggY2xhc3NOYW1lICk7XG5cdFx0fVxuXHR9O1xuXG5cdC8qIFFTQS9tYXRjaGVzU2VsZWN0b3Jcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5cblx0cmJ1Z2d5TWF0Y2hlcyA9IFtdO1xuXG5cdHJidWdneVFTQSA9IFtdO1xuXG5cdGlmICggKHN1cHBvcnQucXNhID0gcm5hdGl2ZS50ZXN0KCBkb2MucXVlcnlTZWxlY3RvckFsbCApKSApIHtcblx0XHRhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHtcblx0XHRcdGRpdi5pbm5lckhUTUwgPSBcIjxzZWxlY3QgdD0nJz48b3B0aW9uIHNlbGVjdGVkPScnPjwvb3B0aW9uPjwvc2VsZWN0PlwiO1xuXG5cdFx0XHRpZiAoIGRpdi5xdWVyeVNlbGVjdG9yQWxsKFwiW3RePScnXVwiKS5sZW5ndGggKSB7XG5cdFx0XHRcdHJidWdneVFTQS5wdXNoKCBcIlsqXiRdPVwiICsgd2hpdGVzcGFjZSArIFwiKig/OicnfFxcXCJcXFwiKVwiICk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKFwiW3NlbGVjdGVkXVwiKS5sZW5ndGggKSB7XG5cdFx0XHRcdHJidWdneVFTQS5wdXNoKCBcIlxcXFxbXCIgKyB3aGl0ZXNwYWNlICsgXCIqKD86dmFsdWV8XCIgKyBib29sZWFucyArIFwiKVwiICk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKFwiOmNoZWNrZWRcIikubGVuZ3RoICkge1xuXHRcdFx0XHRyYnVnZ3lRU0EucHVzaChcIjpjaGVja2VkXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0YXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7XG5cdFx0XHR2YXIgaW5wdXQgPSBkb2MuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuXHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKCBcInR5cGVcIiwgXCJoaWRkZW5cIiApO1xuXHRcdFx0ZGl2LmFwcGVuZENoaWxkKCBpbnB1dCApLnNldEF0dHJpYnV0ZSggXCJuYW1lXCIsIFwiRFwiICk7XG5cblx0XHRcdGlmICggZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbbmFtZT1kXVwiKS5sZW5ndGggKSB7XG5cdFx0XHRcdHJidWdneVFTQS5wdXNoKCBcIm5hbWVcIiArIHdoaXRlc3BhY2UgKyBcIipbKl4kfCF+XT89XCIgKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoXCI6ZW5hYmxlZFwiKS5sZW5ndGggKSB7XG5cdFx0XHRcdHJidWdneVFTQS5wdXNoKCBcIjplbmFibGVkXCIsIFwiOmRpc2FibGVkXCIgKTtcblx0XHRcdH1cblxuXHRcdFx0ZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoXCIqLDp4XCIpO1xuXHRcdFx0cmJ1Z2d5UVNBLnB1c2goXCIsLio6XCIpO1xuXHRcdH0pO1xuXHR9XG5cblx0aWYgKCAoc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgPSBybmF0aXZlLnRlc3QoIChtYXRjaGVzID0gZG9jRWxlbS53ZWJraXRNYXRjaGVzU2VsZWN0b3IgfHxcblx0XHRkb2NFbGVtLm1vek1hdGNoZXNTZWxlY3RvciB8fFxuXHRcdGRvY0VsZW0ub01hdGNoZXNTZWxlY3RvciB8fFxuXHRcdGRvY0VsZW0ubXNNYXRjaGVzU2VsZWN0b3IpICkpICkge1xuXG5cdFx0YXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7XG5cdFx0XHRzdXBwb3J0LmRpc2Nvbm5lY3RlZE1hdGNoID0gbWF0Y2hlcy5jYWxsKCBkaXYsIFwiZGl2XCIgKTtcblxuXHRcdFx0bWF0Y2hlcy5jYWxsKCBkaXYsIFwiW3MhPScnXTp4XCIgKTtcblx0XHRcdHJidWdneU1hdGNoZXMucHVzaCggXCIhPVwiLCBwc2V1ZG9zICk7XG5cdFx0fSk7XG5cdH1cblxuXHRyYnVnZ3lRU0EgPSByYnVnZ3lRU0EubGVuZ3RoICYmIG5ldyBSZWdFeHAoIHJidWdneVFTQS5qb2luKFwifFwiKSApO1xuXHRyYnVnZ3lNYXRjaGVzID0gcmJ1Z2d5TWF0Y2hlcy5sZW5ndGggJiYgbmV3IFJlZ0V4cCggcmJ1Z2d5TWF0Y2hlcy5qb2luKFwifFwiKSApO1xuXG5cdC8qIENvbnRhaW5zXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblx0aGFzQ29tcGFyZSA9IHJuYXRpdmUudGVzdCggZG9jRWxlbS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiApO1xuXG5cdGNvbnRhaW5zID0gaGFzQ29tcGFyZSB8fCBybmF0aXZlLnRlc3QoIGRvY0VsZW0uY29udGFpbnMgKSA/XG5cdFx0ZnVuY3Rpb24oIGEsIGIgKSB7XG5cdFx0XHR2YXIgYWRvd24gPSBhLm5vZGVUeXBlID09PSA5ID8gYS5kb2N1bWVudEVsZW1lbnQgOiBhLFxuXHRcdFx0XHRidXAgPSBiICYmIGIucGFyZW50Tm9kZTtcblx0XHRcdHJldHVybiBhID09PSBidXAgfHwgISEoIGJ1cCAmJiBidXAubm9kZVR5cGUgPT09IDEgJiYgKFxuXHRcdFx0XHRhZG93bi5jb250YWlucyA/XG5cdFx0XHRcdFx0YWRvd24uY29udGFpbnMoIGJ1cCApIDpcblx0XHRcdFx0XHRhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGJ1cCApICYgMTZcblx0XHRcdCkpO1xuXHRcdH0gOlxuXHRcdGZ1bmN0aW9uKCBhLCBiICkge1xuXHRcdFx0aWYgKCBiICkge1xuXHRcdFx0XHR3aGlsZSAoIChiID0gYi5wYXJlbnROb2RlKSApIHtcblx0XHRcdFx0XHRpZiAoIGIgPT09IGEgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9O1xuXG5cdC8qIFNvcnRpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5cdHNvcnRPcmRlciA9IGhhc0NvbXBhcmUgP1xuXHRmdW5jdGlvbiggYSwgYiApIHtcblxuXHRcdGlmICggYSA9PT0gYiApIHtcblx0XHRcdGhhc0R1cGxpY2F0ZSA9IHRydWU7XG5cdFx0XHRyZXR1cm4gMDtcblx0XHR9XG5cblx0XHR2YXIgY29tcGFyZSA9ICFhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uIC0gIWIuY29tcGFyZURvY3VtZW50UG9zaXRpb247XG5cdFx0aWYgKCBjb21wYXJlICkge1xuXHRcdFx0cmV0dXJuIGNvbXBhcmU7XG5cdFx0fVxuXG5cdFx0Y29tcGFyZSA9ICggYS5vd25lckRvY3VtZW50IHx8IGEgKSA9PT0gKCBiLm93bmVyRG9jdW1lbnQgfHwgYiApID9cblx0XHRcdGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGIgKSA6XG5cblx0XHRcdDE7XG5cblx0XHRpZiAoIGNvbXBhcmUgJiAxIHx8XG5cdFx0XHQoIXN1cHBvcnQuc29ydERldGFjaGVkICYmIGIuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGEgKSA9PT0gY29tcGFyZSkgKSB7XG5cblx0XHRcdGlmICggYSA9PT0gZG9jIHx8IGEub3duZXJEb2N1bWVudCA9PT0gcHJlZmVycmVkRG9jICYmIGNvbnRhaW5zKHByZWZlcnJlZERvYywgYSkgKSB7XG5cdFx0XHRcdHJldHVybiAtMTtcblx0XHRcdH1cblx0XHRcdGlmICggYiA9PT0gZG9jIHx8IGIub3duZXJEb2N1bWVudCA9PT0gcHJlZmVycmVkRG9jICYmIGNvbnRhaW5zKHByZWZlcnJlZERvYywgYikgKSB7XG5cdFx0XHRcdHJldHVybiAxO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc29ydElucHV0ID9cblx0XHRcdFx0KCBpbmRleE9mLmNhbGwoIHNvcnRJbnB1dCwgYSApIC0gaW5kZXhPZi5jYWxsKCBzb3J0SW5wdXQsIGIgKSApIDpcblx0XHRcdFx0MDtcblx0XHR9XG5cblx0XHRyZXR1cm4gY29tcGFyZSAmIDQgPyAtMSA6IDE7XG5cdH0gOlxuXHRmdW5jdGlvbiggYSwgYiApIHtcblx0XHRpZiAoIGEgPT09IGIgKSB7XG5cdFx0XHRoYXNEdXBsaWNhdGUgPSB0cnVlO1xuXHRcdFx0cmV0dXJuIDA7XG5cdFx0fVxuXG5cdFx0dmFyIGN1cixcblx0XHRcdGkgPSAwLFxuXHRcdFx0YXVwID0gYS5wYXJlbnROb2RlLFxuXHRcdFx0YnVwID0gYi5wYXJlbnROb2RlLFxuXHRcdFx0YXAgPSBbIGEgXSxcblx0XHRcdGJwID0gWyBiIF07XG5cblx0XHRpZiAoICFhdXAgfHwgIWJ1cCApIHtcblx0XHRcdHJldHVybiBhID09PSBkb2MgPyAtMSA6XG5cdFx0XHRcdGIgPT09IGRvYyA/IDEgOlxuXHRcdFx0XHRhdXAgPyAtMSA6XG5cdFx0XHRcdGJ1cCA/IDEgOlxuXHRcdFx0XHRzb3J0SW5wdXQgP1xuXHRcdFx0XHQoIGluZGV4T2YuY2FsbCggc29ydElucHV0LCBhICkgLSBpbmRleE9mLmNhbGwoIHNvcnRJbnB1dCwgYiApICkgOlxuXHRcdFx0XHQwO1xuXG5cdFx0fSBlbHNlIGlmICggYXVwID09PSBidXAgKSB7XG5cdFx0XHRyZXR1cm4gc2libGluZ0NoZWNrKCBhLCBiICk7XG5cdFx0fVxuXG5cdFx0Y3VyID0gYTtcblx0XHR3aGlsZSAoIChjdXIgPSBjdXIucGFyZW50Tm9kZSkgKSB7XG5cdFx0XHRhcC51bnNoaWZ0KCBjdXIgKTtcblx0XHR9XG5cdFx0Y3VyID0gYjtcblx0XHR3aGlsZSAoIChjdXIgPSBjdXIucGFyZW50Tm9kZSkgKSB7XG5cdFx0XHRicC51bnNoaWZ0KCBjdXIgKTtcblx0XHR9XG5cblx0XHR3aGlsZSAoIGFwW2ldID09PSBicFtpXSApIHtcblx0XHRcdGkrKztcblx0XHR9XG5cblx0XHRyZXR1cm4gaSA/XG5cdFx0XHRzaWJsaW5nQ2hlY2soIGFwW2ldLCBicFtpXSApIDpcblxuXHRcdFx0YXBbaV0gPT09IHByZWZlcnJlZERvYyA/IC0xIDpcblx0XHRcdGJwW2ldID09PSBwcmVmZXJyZWREb2MgPyAxIDpcblx0XHRcdDA7XG5cdH07XG5cblx0cmV0dXJuIGRvYztcbn07XG5cblNpenpsZS5tYXRjaGVzID0gZnVuY3Rpb24oIGV4cHIsIGVsZW1lbnRzICkge1xuXHRyZXR1cm4gU2l6emxlKCBleHByLCBudWxsLCBudWxsLCBlbGVtZW50cyApO1xufTtcblxuU2l6emxlLm1hdGNoZXNTZWxlY3RvciA9IGZ1bmN0aW9uKCBlbGVtLCBleHByICkge1xuXHRpZiAoICggZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0gKSAhPT0gZG9jdW1lbnQgKSB7XG5cdFx0c2V0RG9jdW1lbnQoIGVsZW0gKTtcblx0fVxuXG5cdGV4cHIgPSBleHByLnJlcGxhY2UoIHJhdHRyaWJ1dGVRdW90ZXMsIFwiPSckMSddXCIgKTtcblxuXHRpZiAoIHN1cHBvcnQubWF0Y2hlc1NlbGVjdG9yICYmIGRvY3VtZW50SXNIVE1MICYmXG5cdFx0KCAhcmJ1Z2d5TWF0Y2hlcyB8fCAhcmJ1Z2d5TWF0Y2hlcy50ZXN0KCBleHByICkgKSAmJlxuXHRcdCggIXJidWdneVFTQSAgICAgfHwgIXJidWdneVFTQS50ZXN0KCBleHByICkgKSApIHtcblxuXHRcdHRyeSB7XG5cdFx0XHR2YXIgcmV0ID0gbWF0Y2hlcy5jYWxsKCBlbGVtLCBleHByICk7XG5cblx0XHRcdGlmICggcmV0IHx8IHN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggfHxcblx0XHRcdFx0XHRlbGVtLmRvY3VtZW50ICYmIGVsZW0uZG9jdW1lbnQubm9kZVR5cGUgIT09IDExICkge1xuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fVxuXHRcdH0gY2F0Y2goZSkge31cblx0fVxuXG5cdHJldHVybiBTaXp6bGUoIGV4cHIsIGRvY3VtZW50LCBudWxsLCBbZWxlbV0gKS5sZW5ndGggPiAwO1xufTtcblxuU2l6emxlLmNvbnRhaW5zID0gZnVuY3Rpb24oIGNvbnRleHQsIGVsZW0gKSB7XG5cdGlmICggKCBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCApICE9PSBkb2N1bWVudCApIHtcblx0XHRzZXREb2N1bWVudCggY29udGV4dCApO1xuXHR9XG5cdHJldHVybiBjb250YWlucyggY29udGV4dCwgZWxlbSApO1xufTtcblxuU2l6emxlLmF0dHIgPSBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHtcblx0aWYgKCAoIGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtICkgIT09IGRvY3VtZW50ICkge1xuXHRcdHNldERvY3VtZW50KCBlbGVtICk7XG5cdH1cblxuXHR2YXIgZm4gPSBFeHByLmF0dHJIYW5kbGVbIG5hbWUudG9Mb3dlckNhc2UoKSBdLFxuXHRcdHZhbCA9IGZuICYmIGhhc093bi5jYWxsKCBFeHByLmF0dHJIYW5kbGUsIG5hbWUudG9Mb3dlckNhc2UoKSApID9cblx0XHRcdGZuKCBlbGVtLCBuYW1lLCAhZG9jdW1lbnRJc0hUTUwgKSA6XG5cdFx0XHR1bmRlZmluZWQ7XG5cblx0cmV0dXJuIHZhbCAhPT0gdW5kZWZpbmVkID9cblx0XHR2YWwgOlxuXHRcdHN1cHBvcnQuYXR0cmlidXRlcyB8fCAhZG9jdW1lbnRJc0hUTUwgP1xuXHRcdFx0ZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKSA6XG5cdFx0XHQodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpKSAmJiB2YWwuc3BlY2lmaWVkID9cblx0XHRcdFx0dmFsLnZhbHVlIDpcblx0XHRcdFx0bnVsbDtcbn07XG5cblNpenpsZS5lcnJvciA9IGZ1bmN0aW9uKCBtc2cgKSB7XG5cdHRocm93IG5ldyBFcnJvciggXCJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiBcIiArIG1zZyApO1xufTtcblxuLyoqXG4gKiBEb2N1bWVudCBzb3J0aW5nIGFuZCByZW1vdmluZyBkdXBsaWNhdGVzXG4gKiBAcGFyYW0ge0FycmF5TGlrZX0gcmVzdWx0c1xuICovXG5TaXp6bGUudW5pcXVlU29ydCA9IGZ1bmN0aW9uKCByZXN1bHRzICkge1xuXHR2YXIgZWxlbSxcblx0XHRkdXBsaWNhdGVzID0gW10sXG5cdFx0aiA9IDAsXG5cdFx0aSA9IDA7XG5cblx0aGFzRHVwbGljYXRlID0gIXN1cHBvcnQuZGV0ZWN0RHVwbGljYXRlcztcblx0c29ydElucHV0ID0gIXN1cHBvcnQuc29ydFN0YWJsZSAmJiByZXN1bHRzLnNsaWNlKCAwICk7XG5cdHJlc3VsdHMuc29ydCggc29ydE9yZGVyICk7XG5cblx0aWYgKCBoYXNEdXBsaWNhdGUgKSB7XG5cdFx0d2hpbGUgKCAoZWxlbSA9IHJlc3VsdHNbaSsrXSkgKSB7XG5cdFx0XHRpZiAoIGVsZW0gPT09IHJlc3VsdHNbIGkgXSApIHtcblx0XHRcdFx0aiA9IGR1cGxpY2F0ZXMucHVzaCggaSApO1xuXHRcdFx0fVxuXHRcdH1cblx0XHR3aGlsZSAoIGotLSApIHtcblx0XHRcdHJlc3VsdHMuc3BsaWNlKCBkdXBsaWNhdGVzWyBqIF0sIDEgKTtcblx0XHR9XG5cdH1cblxuXHRzb3J0SW5wdXQgPSBudWxsO1xuXG5cdHJldHVybiByZXN1bHRzO1xufTtcblxuLyoqXG4gKiBVdGlsaXR5IGZ1bmN0aW9uIGZvciByZXRyaWV2aW5nIHRoZSB0ZXh0IHZhbHVlIG9mIGFuIGFycmF5IG9mIERPTSBub2Rlc1xuICogQHBhcmFtIHtBcnJheXxFbGVtZW50fSBlbGVtXG4gKi9cbmdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uKCBlbGVtICkge1xuXHR2YXIgbm9kZSxcblx0XHRyZXQgPSBcIlwiLFxuXHRcdGkgPSAwLFxuXHRcdG5vZGVUeXBlID0gZWxlbS5ub2RlVHlwZTtcblxuXHRpZiAoICFub2RlVHlwZSApIHtcblx0XHR3aGlsZSAoIChub2RlID0gZWxlbVtpKytdKSApIHtcblx0XHRcdHJldCArPSBnZXRUZXh0KCBub2RlICk7XG5cdFx0fVxuXHR9IGVsc2UgaWYgKCBub2RlVHlwZSA9PT0gMSB8fCBub2RlVHlwZSA9PT0gOSB8fCBub2RlVHlwZSA9PT0gMTEgKSB7XG5cdFx0aWYgKCB0eXBlb2YgZWxlbS50ZXh0Q29udGVudCA9PT0gXCJzdHJpbmdcIiApIHtcblx0XHRcdHJldHVybiBlbGVtLnRleHRDb250ZW50O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRmb3IgKCBlbGVtID0gZWxlbS5maXJzdENoaWxkOyBlbGVtOyBlbGVtID0gZWxlbS5uZXh0U2libGluZyApIHtcblx0XHRcdFx0cmV0ICs9IGdldFRleHQoIGVsZW0gKTtcblx0XHRcdH1cblx0XHR9XG5cdH0gZWxzZSBpZiAoIG5vZGVUeXBlID09PSAzIHx8IG5vZGVUeXBlID09PSA0ICkge1xuXHRcdHJldHVybiBlbGVtLm5vZGVWYWx1ZTtcblx0fVxuXG5cdHJldHVybiByZXQ7XG59O1xuXG5FeHByID0gU2l6emxlLnNlbGVjdG9ycyA9IHtcblxuXHRjYWNoZUxlbmd0aDogNTAsXG5cblx0Y3JlYXRlUHNldWRvOiBtYXJrRnVuY3Rpb24sXG5cblx0bWF0Y2g6IG1hdGNoRXhwcixcblxuXHRhdHRySGFuZGxlOiB7fSxcblxuXHRmaW5kOiB7fSxcblxuXHRyZWxhdGl2ZToge1xuXHRcdFwiPlwiOiB7IGRpcjogXCJwYXJlbnROb2RlXCIsIGZpcnN0OiB0cnVlIH0sXG5cdFx0XCIgXCI6IHsgZGlyOiBcInBhcmVudE5vZGVcIiB9LFxuXHRcdFwiK1wiOiB7IGRpcjogXCJwcmV2aW91c1NpYmxpbmdcIiwgZmlyc3Q6IHRydWUgfSxcblx0XHRcIn5cIjogeyBkaXI6IFwicHJldmlvdXNTaWJsaW5nXCIgfVxuXHR9LFxuXG5cdHByZUZpbHRlcjoge1xuXHRcdFwiQVRUUlwiOiBmdW5jdGlvbiggbWF0Y2ggKSB7XG5cdFx0XHRtYXRjaFsxXSA9IG1hdGNoWzFdLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7XG5cblx0XHRcdG1hdGNoWzNdID0gKCBtYXRjaFs0XSB8fCBtYXRjaFs1XSB8fCBcIlwiICkucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTtcblxuXHRcdFx0aWYgKCBtYXRjaFsyXSA9PT0gXCJ+PVwiICkge1xuXHRcdFx0XHRtYXRjaFszXSA9IFwiIFwiICsgbWF0Y2hbM10gKyBcIiBcIjtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG1hdGNoLnNsaWNlKCAwLCA0ICk7XG5cdFx0fSxcblxuXHRcdFwiQ0hJTERcIjogZnVuY3Rpb24oIG1hdGNoICkge1xuXHRcdFx0LyogbWF0Y2hlcyBmcm9tIG1hdGNoRXhwcltcIkNISUxEXCJdXG5cdFx0XHRcdDEgdHlwZSAob25seXxudGh8Li4uKVxuXHRcdFx0XHQyIHdoYXQgKGNoaWxkfG9mLXR5cGUpXG5cdFx0XHRcdDMgYXJndW1lbnQgKGV2ZW58b2RkfFxcZCp8XFxkKm4oWystXVxcZCspP3wuLi4pXG5cdFx0XHRcdDQgeG4tY29tcG9uZW50IG9mIHhuK3kgYXJndW1lbnQgKFsrLV0/XFxkKm58KVxuXHRcdFx0XHQ1IHNpZ24gb2YgeG4tY29tcG9uZW50XG5cdFx0XHRcdDYgeCBvZiB4bi1jb21wb25lbnRcblx0XHRcdFx0NyBzaWduIG9mIHktY29tcG9uZW50XG5cdFx0XHRcdDggeSBvZiB5LWNvbXBvbmVudFxuXHRcdFx0Ki9cblx0XHRcdG1hdGNoWzFdID0gbWF0Y2hbMV0udG9Mb3dlckNhc2UoKTtcblxuXHRcdFx0aWYgKCBtYXRjaFsxXS5zbGljZSggMCwgMyApID09PSBcIm50aFwiICkge1xuXHRcdFx0XHRpZiAoICFtYXRjaFszXSApIHtcblx0XHRcdFx0XHRTaXp6bGUuZXJyb3IoIG1hdGNoWzBdICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRtYXRjaFs0XSA9ICsoIG1hdGNoWzRdID8gbWF0Y2hbNV0gKyAobWF0Y2hbNl0gfHwgMSkgOiAyICogKCBtYXRjaFszXSA9PT0gXCJldmVuXCIgfHwgbWF0Y2hbM10gPT09IFwib2RkXCIgKSApO1xuXHRcdFx0XHRtYXRjaFs1XSA9ICsoICggbWF0Y2hbN10gKyBtYXRjaFs4XSApIHx8IG1hdGNoWzNdID09PSBcIm9kZFwiICk7XG5cblx0XHRcdH0gZWxzZSBpZiAoIG1hdGNoWzNdICkge1xuXHRcdFx0XHRTaXp6bGUuZXJyb3IoIG1hdGNoWzBdICk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBtYXRjaDtcblx0XHR9LFxuXG5cdFx0XCJQU0VVRE9cIjogZnVuY3Rpb24oIG1hdGNoICkge1xuXHRcdFx0dmFyIGV4Y2Vzcyxcblx0XHRcdFx0dW5xdW90ZWQgPSAhbWF0Y2hbNV0gJiYgbWF0Y2hbMl07XG5cblx0XHRcdGlmICggbWF0Y2hFeHByW1wiQ0hJTERcIl0udGVzdCggbWF0Y2hbMF0gKSApIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdGlmICggbWF0Y2hbM10gJiYgbWF0Y2hbNF0gIT09IHVuZGVmaW5lZCApIHtcblx0XHRcdFx0bWF0Y2hbMl0gPSBtYXRjaFs0XTtcblxuXHRcdFx0fSBlbHNlIGlmICggdW5xdW90ZWQgJiYgcnBzZXVkby50ZXN0KCB1bnF1b3RlZCApICYmXG5cdFx0XHRcdChleGNlc3MgPSB0b2tlbml6ZSggdW5xdW90ZWQsIHRydWUgKSkgJiZcblx0XHRcdFx0KGV4Y2VzcyA9IHVucXVvdGVkLmluZGV4T2YoIFwiKVwiLCB1bnF1b3RlZC5sZW5ndGggLSBleGNlc3MgKSAtIHVucXVvdGVkLmxlbmd0aCkgKSB7XG5cblx0XHRcdFx0bWF0Y2hbMF0gPSBtYXRjaFswXS5zbGljZSggMCwgZXhjZXNzICk7XG5cdFx0XHRcdG1hdGNoWzJdID0gdW5xdW90ZWQuc2xpY2UoIDAsIGV4Y2VzcyApO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDMgKTtcblx0XHR9XG5cdH0sXG5cblx0ZmlsdGVyOiB7XG5cblx0XHRcIlRBR1wiOiBmdW5jdGlvbiggbm9kZU5hbWVTZWxlY3RvciApIHtcblx0XHRcdHZhciBub2RlTmFtZSA9IG5vZGVOYW1lU2VsZWN0b3IucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0cmV0dXJuIG5vZGVOYW1lU2VsZWN0b3IgPT09IFwiKlwiID9cblx0XHRcdFx0ZnVuY3Rpb24oKSB7IHJldHVybiB0cnVlOyB9IDpcblx0XHRcdFx0ZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGVsZW0ubm9kZU5hbWUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBub2RlTmFtZTtcblx0XHRcdFx0fTtcblx0XHR9LFxuXG5cdFx0XCJDTEFTU1wiOiBmdW5jdGlvbiggY2xhc3NOYW1lICkge1xuXHRcdFx0dmFyIHBhdHRlcm4gPSBjbGFzc0NhY2hlWyBjbGFzc05hbWUgKyBcIiBcIiBdO1xuXG5cdFx0XHRyZXR1cm4gcGF0dGVybiB8fFxuXHRcdFx0XHQocGF0dGVybiA9IG5ldyBSZWdFeHAoIFwiKF58XCIgKyB3aGl0ZXNwYWNlICsgXCIpXCIgKyBjbGFzc05hbWUgKyBcIihcIiArIHdoaXRlc3BhY2UgKyBcInwkKVwiICkpICYmXG5cdFx0XHRcdGNsYXNzQ2FjaGUoIGNsYXNzTmFtZSwgZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHBhdHRlcm4udGVzdCggdHlwZW9mIGVsZW0uY2xhc3NOYW1lID09PSBcInN0cmluZ1wiICYmIGVsZW0uY2xhc3NOYW1lIHx8IHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSAhPT0gc3RydW5kZWZpbmVkICYmIGVsZW0uZ2V0QXR0cmlidXRlKFwiY2xhc3NcIikgfHwgXCJcIiApO1xuXHRcdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0XCJBVFRSXCI6IGZ1bmN0aW9uKCBuYW1lLCBvcGVyYXRvciwgY2hlY2sgKSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRcdHZhciByZXN1bHQgPSBTaXp6bGUuYXR0ciggZWxlbSwgbmFtZSApO1xuXG5cdFx0XHRcdGlmICggcmVzdWx0ID09IG51bGwgKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG9wZXJhdG9yID09PSBcIiE9XCI7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKCAhb3BlcmF0b3IgKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXN1bHQgKz0gXCJcIjtcblxuXHRcdFx0XHRyZXR1cm4gb3BlcmF0b3IgPT09IFwiPVwiID8gcmVzdWx0ID09PSBjaGVjayA6XG5cdFx0XHRcdFx0b3BlcmF0b3IgPT09IFwiIT1cIiA/IHJlc3VsdCAhPT0gY2hlY2sgOlxuXHRcdFx0XHRcdG9wZXJhdG9yID09PSBcIl49XCIgPyBjaGVjayAmJiByZXN1bHQuaW5kZXhPZiggY2hlY2sgKSA9PT0gMCA6XG5cdFx0XHRcdFx0b3BlcmF0b3IgPT09IFwiKj1cIiA/IGNoZWNrICYmIHJlc3VsdC5pbmRleE9mKCBjaGVjayApID4gLTEgOlxuXHRcdFx0XHRcdG9wZXJhdG9yID09PSBcIiQ9XCIgPyBjaGVjayAmJiByZXN1bHQuc2xpY2UoIC1jaGVjay5sZW5ndGggKSA9PT0gY2hlY2sgOlxuXHRcdFx0XHRcdG9wZXJhdG9yID09PSBcIn49XCIgPyAoIFwiIFwiICsgcmVzdWx0ICsgXCIgXCIgKS5pbmRleE9mKCBjaGVjayApID4gLTEgOlxuXHRcdFx0XHRcdG9wZXJhdG9yID09PSBcInw9XCIgPyByZXN1bHQgPT09IGNoZWNrIHx8IHJlc3VsdC5zbGljZSggMCwgY2hlY2subGVuZ3RoICsgMSApID09PSBjaGVjayArIFwiLVwiIDpcblx0XHRcdFx0XHRmYWxzZTtcblx0XHRcdH07XG5cdFx0fSxcblxuXHRcdFwiQ0hJTERcIjogZnVuY3Rpb24oIHR5cGUsIHdoYXQsIGFyZ3VtZW50LCBmaXJzdCwgbGFzdCApIHtcblx0XHRcdHZhciBzaW1wbGUgPSB0eXBlLnNsaWNlKCAwLCAzICkgIT09IFwibnRoXCIsXG5cdFx0XHRcdGZvcndhcmQgPSB0eXBlLnNsaWNlKCAtNCApICE9PSBcImxhc3RcIixcblx0XHRcdFx0b2ZUeXBlID0gd2hhdCA9PT0gXCJvZi10eXBlXCI7XG5cblx0XHRcdHJldHVybiBmaXJzdCA9PT0gMSAmJiBsYXN0ID09PSAwID9cblxuXHRcdFx0XHRmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdFx0XHRyZXR1cm4gISFlbGVtLnBhcmVudE5vZGU7XG5cdFx0XHRcdH0gOlxuXG5cdFx0XHRcdGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7XG5cdFx0XHRcdFx0dmFyIGNhY2hlLCBvdXRlckNhY2hlLCBub2RlLCBkaWZmLCBub2RlSW5kZXgsIHN0YXJ0LFxuXHRcdFx0XHRcdFx0ZGlyID0gc2ltcGxlICE9PSBmb3J3YXJkID8gXCJuZXh0U2libGluZ1wiIDogXCJwcmV2aW91c1NpYmxpbmdcIixcblx0XHRcdFx0XHRcdHBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZSxcblx0XHRcdFx0XHRcdG5hbWUgPSBvZlR5cGUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLFxuXHRcdFx0XHRcdFx0dXNlQ2FjaGUgPSAheG1sICYmICFvZlR5cGU7XG5cblx0XHRcdFx0XHRpZiAoIHBhcmVudCApIHtcblxuXHRcdFx0XHRcdFx0aWYgKCBzaW1wbGUgKSB7XG5cdFx0XHRcdFx0XHRcdHdoaWxlICggZGlyICkge1xuXHRcdFx0XHRcdFx0XHRcdG5vZGUgPSBlbGVtO1xuXHRcdFx0XHRcdFx0XHRcdHdoaWxlICggKG5vZGUgPSBub2RlWyBkaXIgXSkgKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoIG9mVHlwZSA/IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZSA6IG5vZGUubm9kZVR5cGUgPT09IDEgKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0c3RhcnQgPSBkaXIgPSB0eXBlID09PSBcIm9ubHlcIiAmJiAhc3RhcnQgJiYgXCJuZXh0U2libGluZ1wiO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRzdGFydCA9IFsgZm9yd2FyZCA/IHBhcmVudC5maXJzdENoaWxkIDogcGFyZW50Lmxhc3RDaGlsZCBdO1xuXG5cdFx0XHRcdFx0XHRpZiAoIGZvcndhcmQgJiYgdXNlQ2FjaGUgKSB7XG5cdFx0XHRcdFx0XHRcdG91dGVyQ2FjaGUgPSBwYXJlbnRbIGV4cGFuZG8gXSB8fCAocGFyZW50WyBleHBhbmRvIF0gPSB7fSk7XG5cdFx0XHRcdFx0XHRcdGNhY2hlID0gb3V0ZXJDYWNoZVsgdHlwZSBdIHx8IFtdO1xuXHRcdFx0XHRcdFx0XHRub2RlSW5kZXggPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsxXTtcblx0XHRcdFx0XHRcdFx0ZGlmZiA9IGNhY2hlWzBdID09PSBkaXJydW5zICYmIGNhY2hlWzJdO1xuXHRcdFx0XHRcdFx0XHRub2RlID0gbm9kZUluZGV4ICYmIHBhcmVudC5jaGlsZE5vZGVzWyBub2RlSW5kZXggXTtcblxuXHRcdFx0XHRcdFx0XHR3aGlsZSAoIChub2RlID0gKytub2RlSW5kZXggJiYgbm9kZSAmJiBub2RlWyBkaXIgXSB8fFxuXG5cdFx0XHRcdFx0XHRcdFx0KGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7XG5cblx0XHRcdFx0XHRcdFx0XHRpZiAoIG5vZGUubm9kZVR5cGUgPT09IDEgJiYgKytkaWZmICYmIG5vZGUgPT09IGVsZW0gKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRvdXRlckNhY2hlWyB0eXBlIF0gPSBbIGRpcnJ1bnMsIG5vZGVJbmRleCwgZGlmZiBdO1xuXHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoIHVzZUNhY2hlICYmIChjYWNoZSA9IChlbGVtWyBleHBhbmRvIF0gfHwgKGVsZW1bIGV4cGFuZG8gXSA9IHt9KSlbIHR5cGUgXSkgJiYgY2FjaGVbMF0gPT09IGRpcnJ1bnMgKSB7XG5cdFx0XHRcdFx0XHRcdGRpZmYgPSBjYWNoZVsxXTtcblxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0d2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHxcblx0XHRcdFx0XHRcdFx0XHQoZGlmZiA9IG5vZGVJbmRleCA9IDApIHx8IHN0YXJ0LnBvcCgpKSApIHtcblxuXHRcdFx0XHRcdFx0XHRcdGlmICggKCBvZlR5cGUgPyBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgOiBub2RlLm5vZGVUeXBlID09PSAxICkgJiYgKytkaWZmICkge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKCB1c2VDYWNoZSApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0KG5vZGVbIGV4cGFuZG8gXSB8fCAobm9kZVsgZXhwYW5kbyBdID0ge30pKVsgdHlwZSBdID0gWyBkaXJydW5zLCBkaWZmIF07XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdGlmICggbm9kZSA9PT0gZWxlbSApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGRpZmYgLT0gbGFzdDtcblx0XHRcdFx0XHRcdHJldHVybiBkaWZmID09PSBmaXJzdCB8fCAoIGRpZmYgJSBmaXJzdCA9PT0gMCAmJiBkaWZmIC8gZmlyc3QgPj0gMCApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblx0XHR9LFxuXG5cdFx0XCJQU0VVRE9cIjogZnVuY3Rpb24oIHBzZXVkbywgYXJndW1lbnQgKSB7XG5cdFx0XHR2YXIgYXJncyxcblx0XHRcdFx0Zm4gPSBFeHByLnBzZXVkb3NbIHBzZXVkbyBdIHx8IEV4cHIuc2V0RmlsdGVyc1sgcHNldWRvLnRvTG93ZXJDYXNlKCkgXSB8fFxuXHRcdFx0XHRcdFNpenpsZS5lcnJvciggXCJ1bnN1cHBvcnRlZCBwc2V1ZG86IFwiICsgcHNldWRvICk7XG5cblx0XHRcdGlmICggZm5bIGV4cGFuZG8gXSApIHtcblx0XHRcdFx0cmV0dXJuIGZuKCBhcmd1bWVudCApO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIGZuLmxlbmd0aCA+IDEgKSB7XG5cdFx0XHRcdGFyZ3MgPSBbIHBzZXVkbywgcHNldWRvLCBcIlwiLCBhcmd1bWVudCBdO1xuXHRcdFx0XHRyZXR1cm4gRXhwci5zZXRGaWx0ZXJzLmhhc093blByb3BlcnR5KCBwc2V1ZG8udG9Mb3dlckNhc2UoKSApID9cblx0XHRcdFx0XHRtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlZWQsIG1hdGNoZXMgKSB7XG5cdFx0XHRcdFx0XHR2YXIgaWR4LFxuXHRcdFx0XHRcdFx0XHRtYXRjaGVkID0gZm4oIHNlZWQsIGFyZ3VtZW50ICksXG5cdFx0XHRcdFx0XHRcdGkgPSBtYXRjaGVkLmxlbmd0aDtcblx0XHRcdFx0XHRcdHdoaWxlICggaS0tICkge1xuXHRcdFx0XHRcdFx0XHRpZHggPSBpbmRleE9mLmNhbGwoIHNlZWQsIG1hdGNoZWRbaV0gKTtcblx0XHRcdFx0XHRcdFx0c2VlZFsgaWR4IF0gPSAhKCBtYXRjaGVzWyBpZHggXSA9IG1hdGNoZWRbaV0gKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KSA6XG5cdFx0XHRcdFx0ZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZm4oIGVsZW0sIDAsIGFyZ3MgKTtcblx0XHRcdFx0XHR9O1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZm47XG5cdFx0fVxuXHR9LFxuXG5cdHBzZXVkb3M6IHtcblx0XHRcIm5vdFwiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlbGVjdG9yICkge1xuXHRcdFx0dmFyIGlucHV0ID0gW10sXG5cdFx0XHRcdHJlc3VsdHMgPSBbXSxcblx0XHRcdFx0bWF0Y2hlciA9IGNvbXBpbGUoIHNlbGVjdG9yLnJlcGxhY2UoIHJ0cmltLCBcIiQxXCIgKSApO1xuXG5cdFx0XHRyZXR1cm4gbWF0Y2hlclsgZXhwYW5kbyBdID9cblx0XHRcdFx0bWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzLCBjb250ZXh0LCB4bWwgKSB7XG5cdFx0XHRcdFx0dmFyIGVsZW0sXG5cdFx0XHRcdFx0XHR1bm1hdGNoZWQgPSBtYXRjaGVyKCBzZWVkLCBudWxsLCB4bWwsIFtdICksXG5cdFx0XHRcdFx0XHRpID0gc2VlZC5sZW5ndGg7XG5cblx0XHRcdFx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdFx0XHRcdGlmICggKGVsZW0gPSB1bm1hdGNoZWRbaV0pICkge1xuXHRcdFx0XHRcdFx0XHRzZWVkW2ldID0gIShtYXRjaGVzW2ldID0gZWxlbSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KSA6XG5cdFx0XHRcdGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7XG5cdFx0XHRcdFx0aW5wdXRbMF0gPSBlbGVtO1xuXHRcdFx0XHRcdG1hdGNoZXIoIGlucHV0LCBudWxsLCB4bWwsIHJlc3VsdHMgKTtcblx0XHRcdFx0XHRyZXR1cm4gIXJlc3VsdHMucG9wKCk7XG5cdFx0XHRcdH07XG5cdFx0fSksXG5cblx0XHRcImhhc1wiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlbGVjdG9yICkge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHRyZXR1cm4gU2l6emxlKCBzZWxlY3RvciwgZWxlbSApLmxlbmd0aCA+IDA7XG5cdFx0XHR9O1xuXHRcdH0pLFxuXG5cdFx0XCJjb250YWluc1wiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHRleHQgKSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRcdHJldHVybiAoIGVsZW0udGV4dENvbnRlbnQgfHwgZWxlbS5pbm5lclRleHQgfHwgZ2V0VGV4dCggZWxlbSApICkuaW5kZXhPZiggdGV4dCApID4gLTE7XG5cdFx0XHR9O1xuXHRcdH0pLFxuXG5cdFx0XCJsYW5nXCI6IG1hcmtGdW5jdGlvbiggZnVuY3Rpb24oIGxhbmcgKSB7XG5cdFx0XHRpZiAoICFyaWRlbnRpZmllci50ZXN0KGxhbmcgfHwgXCJcIikgKSB7XG5cdFx0XHRcdFNpenpsZS5lcnJvciggXCJ1bnN1cHBvcnRlZCBsYW5nOiBcIiArIGxhbmcgKTtcblx0XHRcdH1cblx0XHRcdGxhbmcgPSBsYW5nLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTtcblx0XHRcdHJldHVybiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdFx0dmFyIGVsZW1MYW5nO1xuXHRcdFx0XHRkbyB7XG5cdFx0XHRcdFx0aWYgKCAoZWxlbUxhbmcgPSBkb2N1bWVudElzSFRNTCA/XG5cdFx0XHRcdFx0XHRlbGVtLmxhbmcgOlxuXHRcdFx0XHRcdFx0ZWxlbS5nZXRBdHRyaWJ1dGUoXCJ4bWw6bGFuZ1wiKSB8fCBlbGVtLmdldEF0dHJpYnV0ZShcImxhbmdcIikpICkge1xuXG5cdFx0XHRcdFx0XHRlbGVtTGFuZyA9IGVsZW1MYW5nLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZWxlbUxhbmcgPT09IGxhbmcgfHwgZWxlbUxhbmcuaW5kZXhPZiggbGFuZyArIFwiLVwiICkgPT09IDA7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IHdoaWxlICggKGVsZW0gPSBlbGVtLnBhcmVudE5vZGUpICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKTtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fTtcblx0XHR9KSxcblxuXHRcdFwidGFyZ2V0XCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0dmFyIGhhc2ggPSB3aW5kb3cubG9jYXRpb24gJiYgd2luZG93LmxvY2F0aW9uLmhhc2g7XG5cdFx0XHRyZXR1cm4gaGFzaCAmJiBoYXNoLnNsaWNlKCAxICkgPT09IGVsZW0uaWQ7XG5cdFx0fSxcblxuXHRcdFwicm9vdFwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHJldHVybiBlbGVtID09PSBkb2NFbGVtO1xuXHRcdH0sXG5cblx0XHRcImZvY3VzXCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0cmV0dXJuIGVsZW0gPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgKCFkb2N1bWVudC5oYXNGb2N1cyB8fCBkb2N1bWVudC5oYXNGb2N1cygpKSAmJiAhIShlbGVtLnR5cGUgfHwgZWxlbS5ocmVmIHx8IH5lbGVtLnRhYkluZGV4KTtcblx0XHR9LFxuXG5cdFx0XCJlbmFibGVkXCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0cmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IGZhbHNlO1xuXHRcdH0sXG5cblx0XHRcImRpc2FibGVkXCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0cmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IHRydWU7XG5cdFx0fSxcblxuXHRcdFwiY2hlY2tlZFwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHZhciBub2RlTmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRcdHJldHVybiAobm9kZU5hbWUgPT09IFwiaW5wdXRcIiAmJiAhIWVsZW0uY2hlY2tlZCkgfHwgKG5vZGVOYW1lID09PSBcIm9wdGlvblwiICYmICEhZWxlbS5zZWxlY3RlZCk7XG5cdFx0fSxcblxuXHRcdFwic2VsZWN0ZWRcIjogZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRpZiAoIGVsZW0ucGFyZW50Tm9kZSApIHtcblx0XHRcdFx0ZWxlbS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBlbGVtLnNlbGVjdGVkID09PSB0cnVlO1xuXHRcdH0sXG5cblx0XHRcImVtcHR5XCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0Zm9yICggZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcgKSB7XG5cdFx0XHRcdGlmICggZWxlbS5ub2RlVHlwZSA8IDYgKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9LFxuXG5cdFx0XCJwYXJlbnRcIjogZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRyZXR1cm4gIUV4cHIucHNldWRvc1tcImVtcHR5XCJdKCBlbGVtICk7XG5cdFx0fSxcblxuXHRcdFwiaGVhZGVyXCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0cmV0dXJuIHJoZWFkZXIudGVzdCggZWxlbS5ub2RlTmFtZSApO1xuXHRcdH0sXG5cblx0XHRcImlucHV0XCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0cmV0dXJuIHJpbnB1dHMudGVzdCggZWxlbS5ub2RlTmFtZSApO1xuXHRcdH0sXG5cblx0XHRcImJ1dHRvblwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0cmV0dXJuIG5hbWUgPT09IFwiaW5wdXRcIiAmJiBlbGVtLnR5cGUgPT09IFwiYnV0dG9uXCIgfHwgbmFtZSA9PT0gXCJidXR0b25cIjtcblx0XHR9LFxuXG5cdFx0XCJ0ZXh0XCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0dmFyIGF0dHI7XG5cdFx0XHRyZXR1cm4gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImlucHV0XCIgJiZcblx0XHRcdFx0ZWxlbS50eXBlID09PSBcInRleHRcIiAmJlxuXG5cdFx0XHRcdCggKGF0dHIgPSBlbGVtLmdldEF0dHJpYnV0ZShcInR5cGVcIikpID09IG51bGwgfHwgYXR0ci50b0xvd2VyQ2FzZSgpID09PSBcInRleHRcIiApO1xuXHRcdH0sXG5cblx0XHRcImZpcnN0XCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gWyAwIF07XG5cdFx0fSksXG5cblx0XHRcImxhc3RcIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7XG5cdFx0XHRyZXR1cm4gWyBsZW5ndGggLSAxIF07XG5cdFx0fSksXG5cblx0XHRcImVxXCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoLCBhcmd1bWVudCApIHtcblx0XHRcdHJldHVybiBbIGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQgXTtcblx0XHR9KSxcblxuXHRcdFwiZXZlblwiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHtcblx0XHRcdHZhciBpID0gMDtcblx0XHRcdGZvciAoIDsgaSA8IGxlbmd0aDsgaSArPSAyICkge1xuXHRcdFx0XHRtYXRjaEluZGV4ZXMucHVzaCggaSApO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIG1hdGNoSW5kZXhlcztcblx0XHR9KSxcblxuXHRcdFwib2RkXCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoICkge1xuXHRcdFx0dmFyIGkgPSAxO1xuXHRcdFx0Zm9yICggOyBpIDwgbGVuZ3RoOyBpICs9IDIgKSB7XG5cdFx0XHRcdG1hdGNoSW5kZXhlcy5wdXNoKCBpICk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gbWF0Y2hJbmRleGVzO1xuXHRcdH0pLFxuXG5cdFx0XCJsdFwiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7XG5cdFx0XHR2YXIgaSA9IGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQ7XG5cdFx0XHRmb3IgKCA7IC0taSA+PSAwOyApIHtcblx0XHRcdFx0bWF0Y2hJbmRleGVzLnB1c2goIGkgKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBtYXRjaEluZGV4ZXM7XG5cdFx0fSksXG5cblx0XHRcImd0XCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoLCBhcmd1bWVudCApIHtcblx0XHRcdHZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudDtcblx0XHRcdGZvciAoIDsgKytpIDwgbGVuZ3RoOyApIHtcblx0XHRcdFx0bWF0Y2hJbmRleGVzLnB1c2goIGkgKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBtYXRjaEluZGV4ZXM7XG5cdFx0fSlcblx0fVxufTtcblxuRXhwci5wc2V1ZG9zW1wibnRoXCJdID0gRXhwci5wc2V1ZG9zW1wiZXFcIl07XG5cbmZvciAoIGkgaW4geyByYWRpbzogdHJ1ZSwgY2hlY2tib3g6IHRydWUsIGZpbGU6IHRydWUsIHBhc3N3b3JkOiB0cnVlLCBpbWFnZTogdHJ1ZSB9ICkge1xuXHRFeHByLnBzZXVkb3NbIGkgXSA9IGNyZWF0ZUlucHV0UHNldWRvKCBpICk7XG59XG5mb3IgKCBpIGluIHsgc3VibWl0OiB0cnVlLCByZXNldDogdHJ1ZSB9ICkge1xuXHRFeHByLnBzZXVkb3NbIGkgXSA9IGNyZWF0ZUJ1dHRvblBzZXVkbyggaSApO1xufVxuXG5mdW5jdGlvbiBzZXRGaWx0ZXJzKCkge31cbnNldEZpbHRlcnMucHJvdG90eXBlID0gRXhwci5maWx0ZXJzID0gRXhwci5wc2V1ZG9zO1xuRXhwci5zZXRGaWx0ZXJzID0gbmV3IHNldEZpbHRlcnMoKTtcblxuZnVuY3Rpb24gdG9rZW5pemUoIHNlbGVjdG9yLCBwYXJzZU9ubHkgKSB7XG5cdHZhciBtYXRjaGVkLCBtYXRjaCwgdG9rZW5zLCB0eXBlLFxuXHRcdHNvRmFyLCBncm91cHMsIHByZUZpbHRlcnMsXG5cdFx0Y2FjaGVkID0gdG9rZW5DYWNoZVsgc2VsZWN0b3IgKyBcIiBcIiBdO1xuXG5cdGlmICggY2FjaGVkICkge1xuXHRcdHJldHVybiBwYXJzZU9ubHkgPyAwIDogY2FjaGVkLnNsaWNlKCAwICk7XG5cdH1cblxuXHRzb0ZhciA9IHNlbGVjdG9yO1xuXHRncm91cHMgPSBbXTtcblx0cHJlRmlsdGVycyA9IEV4cHIucHJlRmlsdGVyO1xuXG5cdHdoaWxlICggc29GYXIgKSB7XG5cblx0XHRpZiAoICFtYXRjaGVkIHx8IChtYXRjaCA9IHJjb21tYS5leGVjKCBzb0ZhciApKSApIHtcblx0XHRcdGlmICggbWF0Y2ggKSB7XG5cdFx0XHRcdHNvRmFyID0gc29GYXIuc2xpY2UoIG1hdGNoWzBdLmxlbmd0aCApIHx8IHNvRmFyO1xuXHRcdFx0fVxuXHRcdFx0Z3JvdXBzLnB1c2goICh0b2tlbnMgPSBbXSkgKTtcblx0XHR9XG5cblx0XHRtYXRjaGVkID0gZmFsc2U7XG5cblx0XHRpZiAoIChtYXRjaCA9IHJjb21iaW5hdG9ycy5leGVjKCBzb0ZhciApKSApIHtcblx0XHRcdG1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpO1xuXHRcdFx0dG9rZW5zLnB1c2goe1xuXHRcdFx0XHR2YWx1ZTogbWF0Y2hlZCxcblx0XHRcdFx0dHlwZTogbWF0Y2hbMF0ucmVwbGFjZSggcnRyaW0sIFwiIFwiIClcblx0XHRcdH0pO1xuXHRcdFx0c29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTtcblx0XHR9XG5cblx0XHRmb3IgKCB0eXBlIGluIEV4cHIuZmlsdGVyICkge1xuXHRcdFx0aWYgKCAobWF0Y2ggPSBtYXRjaEV4cHJbIHR5cGUgXS5leGVjKCBzb0ZhciApKSAmJiAoIXByZUZpbHRlcnNbIHR5cGUgXSB8fFxuXHRcdFx0XHQobWF0Y2ggPSBwcmVGaWx0ZXJzWyB0eXBlIF0oIG1hdGNoICkpKSApIHtcblx0XHRcdFx0bWF0Y2hlZCA9IG1hdGNoLnNoaWZ0KCk7XG5cdFx0XHRcdHRva2Vucy5wdXNoKHtcblx0XHRcdFx0XHR2YWx1ZTogbWF0Y2hlZCxcblx0XHRcdFx0XHR0eXBlOiB0eXBlLFxuXHRcdFx0XHRcdG1hdGNoZXM6IG1hdGNoXG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRzb0ZhciA9IHNvRmFyLnNsaWNlKCBtYXRjaGVkLmxlbmd0aCApO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICggIW1hdGNoZWQgKSB7XG5cdFx0XHRicmVhaztcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gcGFyc2VPbmx5ID9cblx0XHRzb0Zhci5sZW5ndGggOlxuXHRcdHNvRmFyID9cblx0XHRcdFNpenpsZS5lcnJvciggc2VsZWN0b3IgKSA6XG5cdFx0XHR0b2tlbkNhY2hlKCBzZWxlY3RvciwgZ3JvdXBzICkuc2xpY2UoIDAgKTtcbn1cblxuZnVuY3Rpb24gdG9TZWxlY3RvciggdG9rZW5zICkge1xuXHR2YXIgaSA9IDAsXG5cdFx0bGVuID0gdG9rZW5zLmxlbmd0aCxcblx0XHRzZWxlY3RvciA9IFwiXCI7XG5cdGZvciAoIDsgaSA8IGxlbjsgaSsrICkge1xuXHRcdHNlbGVjdG9yICs9IHRva2Vuc1tpXS52YWx1ZTtcblx0fVxuXHRyZXR1cm4gc2VsZWN0b3I7XG59XG5cbmZ1bmN0aW9uIGFkZENvbWJpbmF0b3IoIG1hdGNoZXIsIGNvbWJpbmF0b3IsIGJhc2UgKSB7XG5cdHZhciBkaXIgPSBjb21iaW5hdG9yLmRpcixcblx0XHRjaGVja05vbkVsZW1lbnRzID0gYmFzZSAmJiBkaXIgPT09IFwicGFyZW50Tm9kZVwiLFxuXHRcdGRvbmVOYW1lID0gZG9uZSsrO1xuXG5cdHJldHVybiBjb21iaW5hdG9yLmZpcnN0ID9cblx0XHRmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkge1xuXHRcdFx0d2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHtcblx0XHRcdFx0aWYgKCBlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMgKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSA6XG5cblx0XHRmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkge1xuXHRcdFx0dmFyIG9sZENhY2hlLCBvdXRlckNhY2hlLFxuXHRcdFx0XHRuZXdDYWNoZSA9IFsgZGlycnVucywgZG9uZU5hbWUgXTtcblxuXHRcdFx0aWYgKCB4bWwgKSB7XG5cdFx0XHRcdHdoaWxlICggKGVsZW0gPSBlbGVtWyBkaXIgXSkgKSB7XG5cdFx0XHRcdFx0aWYgKCBlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMgKSB7XG5cdFx0XHRcdFx0XHRpZiAoIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApICkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHdoaWxlICggKGVsZW0gPSBlbGVtWyBkaXIgXSkgKSB7XG5cdFx0XHRcdFx0aWYgKCBlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMgKSB7XG5cdFx0XHRcdFx0XHRvdXRlckNhY2hlID0gZWxlbVsgZXhwYW5kbyBdIHx8IChlbGVtWyBleHBhbmRvIF0gPSB7fSk7XG5cdFx0XHRcdFx0XHRpZiAoIChvbGRDYWNoZSA9IG91dGVyQ2FjaGVbIGRpciBdKSAmJlxuXHRcdFx0XHRcdFx0XHRvbGRDYWNoZVsgMCBdID09PSBkaXJydW5zICYmIG9sZENhY2hlWyAxIF0gPT09IGRvbmVOYW1lICkge1xuXG5cdFx0XHRcdFx0XHRcdHJldHVybiAobmV3Q2FjaGVbIDIgXSA9IG9sZENhY2hlWyAyIF0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0b3V0ZXJDYWNoZVsgZGlyIF0gPSBuZXdDYWNoZTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIChuZXdDYWNoZVsgMiBdID0gbWF0Y2hlciggZWxlbSwgY29udGV4dCwgeG1sICkpICkge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcbn1cblxuZnVuY3Rpb24gZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICkge1xuXHRyZXR1cm4gbWF0Y2hlcnMubGVuZ3RoID4gMSA/XG5cdFx0ZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHtcblx0XHRcdHZhciBpID0gbWF0Y2hlcnMubGVuZ3RoO1xuXHRcdFx0d2hpbGUgKCBpLS0gKSB7XG5cdFx0XHRcdGlmICggIW1hdGNoZXJzW2ldKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH0gOlxuXHRcdG1hdGNoZXJzWzBdO1xufVxuXG5mdW5jdGlvbiBtdWx0aXBsZUNvbnRleHRzKCBzZWxlY3RvciwgY29udGV4dHMsIHJlc3VsdHMgKSB7XG5cdHZhciBpID0gMCxcblx0XHRsZW4gPSBjb250ZXh0cy5sZW5ndGg7XG5cdGZvciAoIDsgaSA8IGxlbjsgaSsrICkge1xuXHRcdFNpenpsZSggc2VsZWN0b3IsIGNvbnRleHRzW2ldLCByZXN1bHRzICk7XG5cdH1cblx0cmV0dXJuIHJlc3VsdHM7XG59XG5cbmZ1bmN0aW9uIGNvbmRlbnNlKCB1bm1hdGNoZWQsIG1hcCwgZmlsdGVyLCBjb250ZXh0LCB4bWwgKSB7XG5cdHZhciBlbGVtLFxuXHRcdG5ld1VubWF0Y2hlZCA9IFtdLFxuXHRcdGkgPSAwLFxuXHRcdGxlbiA9IHVubWF0Y2hlZC5sZW5ndGgsXG5cdFx0bWFwcGVkID0gbWFwICE9IG51bGw7XG5cblx0Zm9yICggOyBpIDwgbGVuOyBpKysgKSB7XG5cdFx0aWYgKCAoZWxlbSA9IHVubWF0Y2hlZFtpXSkgKSB7XG5cdFx0XHRpZiAoICFmaWx0ZXIgfHwgZmlsdGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHtcblx0XHRcdFx0bmV3VW5tYXRjaGVkLnB1c2goIGVsZW0gKTtcblx0XHRcdFx0aWYgKCBtYXBwZWQgKSB7XG5cdFx0XHRcdFx0bWFwLnB1c2goIGkgKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiBuZXdVbm1hdGNoZWQ7XG59XG5cbmZ1bmN0aW9uIHNldE1hdGNoZXIoIHByZUZpbHRlciwgc2VsZWN0b3IsIG1hdGNoZXIsIHBvc3RGaWx0ZXIsIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvciApIHtcblx0aWYgKCBwb3N0RmlsdGVyICYmICFwb3N0RmlsdGVyWyBleHBhbmRvIF0gKSB7XG5cdFx0cG9zdEZpbHRlciA9IHNldE1hdGNoZXIoIHBvc3RGaWx0ZXIgKTtcblx0fVxuXHRpZiAoIHBvc3RGaW5kZXIgJiYgIXBvc3RGaW5kZXJbIGV4cGFuZG8gXSApIHtcblx0XHRwb3N0RmluZGVyID0gc2V0TWF0Y2hlciggcG9zdEZpbmRlciwgcG9zdFNlbGVjdG9yICk7XG5cdH1cblx0cmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgcmVzdWx0cywgY29udGV4dCwgeG1sICkge1xuXHRcdHZhciB0ZW1wLCBpLCBlbGVtLFxuXHRcdFx0cHJlTWFwID0gW10sXG5cdFx0XHRwb3N0TWFwID0gW10sXG5cdFx0XHRwcmVleGlzdGluZyA9IHJlc3VsdHMubGVuZ3RoLFxuXG5cdFx0XHRlbGVtcyA9IHNlZWQgfHwgbXVsdGlwbGVDb250ZXh0cyggc2VsZWN0b3IgfHwgXCIqXCIsIGNvbnRleHQubm9kZVR5cGUgPyBbIGNvbnRleHQgXSA6IGNvbnRleHQsIFtdICksXG5cblx0XHRcdG1hdGNoZXJJbiA9IHByZUZpbHRlciAmJiAoIHNlZWQgfHwgIXNlbGVjdG9yICkgP1xuXHRcdFx0XHRjb25kZW5zZSggZWxlbXMsIHByZU1hcCwgcHJlRmlsdGVyLCBjb250ZXh0LCB4bWwgKSA6XG5cdFx0XHRcdGVsZW1zLFxuXG5cdFx0XHRtYXRjaGVyT3V0ID0gbWF0Y2hlciA/XG5cdFx0XHRcdHBvc3RGaW5kZXIgfHwgKCBzZWVkID8gcHJlRmlsdGVyIDogcHJlZXhpc3RpbmcgfHwgcG9zdEZpbHRlciApID9cblxuXHRcdFx0XHRcdFtdIDpcblxuXHRcdFx0XHRcdHJlc3VsdHMgOlxuXHRcdFx0XHRtYXRjaGVySW47XG5cblx0XHRpZiAoIG1hdGNoZXIgKSB7XG5cdFx0XHRtYXRjaGVyKCBtYXRjaGVySW4sIG1hdGNoZXJPdXQsIGNvbnRleHQsIHhtbCApO1xuXHRcdH1cblxuXHRcdGlmICggcG9zdEZpbHRlciApIHtcblx0XHRcdHRlbXAgPSBjb25kZW5zZSggbWF0Y2hlck91dCwgcG9zdE1hcCApO1xuXHRcdFx0cG9zdEZpbHRlciggdGVtcCwgW10sIGNvbnRleHQsIHhtbCApO1xuXG5cdFx0XHRpID0gdGVtcC5sZW5ndGg7XG5cdFx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdFx0aWYgKCAoZWxlbSA9IHRlbXBbaV0pICkge1xuXHRcdFx0XHRcdG1hdGNoZXJPdXRbIHBvc3RNYXBbaV0gXSA9ICEobWF0Y2hlckluWyBwb3N0TWFwW2ldIF0gPSBlbGVtKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICggc2VlZCApIHtcblx0XHRcdGlmICggcG9zdEZpbmRlciB8fCBwcmVGaWx0ZXIgKSB7XG5cdFx0XHRcdGlmICggcG9zdEZpbmRlciApIHtcblx0XHRcdFx0XHR0ZW1wID0gW107XG5cdFx0XHRcdFx0aSA9IG1hdGNoZXJPdXQubGVuZ3RoO1xuXHRcdFx0XHRcdHdoaWxlICggaS0tICkge1xuXHRcdFx0XHRcdFx0aWYgKCAoZWxlbSA9IG1hdGNoZXJPdXRbaV0pICkge1xuXHRcdFx0XHRcdFx0XHR0ZW1wLnB1c2goIChtYXRjaGVySW5baV0gPSBlbGVtKSApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRwb3N0RmluZGVyKCBudWxsLCAobWF0Y2hlck91dCA9IFtdKSwgdGVtcCwgeG1sICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpID0gbWF0Y2hlck91dC5sZW5ndGg7XG5cdFx0XHRcdHdoaWxlICggaS0tICkge1xuXHRcdFx0XHRcdGlmICggKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSAmJlxuXHRcdFx0XHRcdFx0KHRlbXAgPSBwb3N0RmluZGVyID8gaW5kZXhPZi5jYWxsKCBzZWVkLCBlbGVtICkgOiBwcmVNYXBbaV0pID4gLTEgKSB7XG5cblx0XHRcdFx0XHRcdHNlZWRbdGVtcF0gPSAhKHJlc3VsdHNbdGVtcF0gPSBlbGVtKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRtYXRjaGVyT3V0ID0gY29uZGVuc2UoXG5cdFx0XHRcdG1hdGNoZXJPdXQgPT09IHJlc3VsdHMgP1xuXHRcdFx0XHRcdG1hdGNoZXJPdXQuc3BsaWNlKCBwcmVleGlzdGluZywgbWF0Y2hlck91dC5sZW5ndGggKSA6XG5cdFx0XHRcdFx0bWF0Y2hlck91dFxuXHRcdFx0KTtcblx0XHRcdGlmICggcG9zdEZpbmRlciApIHtcblx0XHRcdFx0cG9zdEZpbmRlciggbnVsbCwgcmVzdWx0cywgbWF0Y2hlck91dCwgeG1sICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRwdXNoLmFwcGx5KCByZXN1bHRzLCBtYXRjaGVyT3V0ICk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcbn1cblxuZnVuY3Rpb24gbWF0Y2hlckZyb21Ub2tlbnMoIHRva2VucyApIHtcblx0dmFyIGNoZWNrQ29udGV4dCwgbWF0Y2hlciwgaixcblx0XHRsZW4gPSB0b2tlbnMubGVuZ3RoLFxuXHRcdGxlYWRpbmdSZWxhdGl2ZSA9IEV4cHIucmVsYXRpdmVbIHRva2Vuc1swXS50eXBlIF0sXG5cdFx0aW1wbGljaXRSZWxhdGl2ZSA9IGxlYWRpbmdSZWxhdGl2ZSB8fCBFeHByLnJlbGF0aXZlW1wiIFwiXSxcblx0XHRpID0gbGVhZGluZ1JlbGF0aXZlID8gMSA6IDAsXG5cblx0XHRtYXRjaENvbnRleHQgPSBhZGRDb21iaW5hdG9yKCBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHJldHVybiBlbGVtID09PSBjaGVja0NvbnRleHQ7XG5cdFx0fSwgaW1wbGljaXRSZWxhdGl2ZSwgdHJ1ZSApLFxuXHRcdG1hdGNoQW55Q29udGV4dCA9IGFkZENvbWJpbmF0b3IoIGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0cmV0dXJuIGluZGV4T2YuY2FsbCggY2hlY2tDb250ZXh0LCBlbGVtICkgPiAtMTtcblx0XHR9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlICksXG5cdFx0bWF0Y2hlcnMgPSBbIGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7XG5cdFx0XHRyZXR1cm4gKCAhbGVhZGluZ1JlbGF0aXZlICYmICggeG1sIHx8IGNvbnRleHQgIT09IG91dGVybW9zdENvbnRleHQgKSApIHx8IChcblx0XHRcdFx0KGNoZWNrQ29udGV4dCA9IGNvbnRleHQpLm5vZGVUeXBlID9cblx0XHRcdFx0XHRtYXRjaENvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApIDpcblx0XHRcdFx0XHRtYXRjaEFueUNvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApICk7XG5cdFx0fSBdO1xuXG5cdGZvciAoIDsgaSA8IGxlbjsgaSsrICkge1xuXHRcdGlmICggKG1hdGNoZXIgPSBFeHByLnJlbGF0aXZlWyB0b2tlbnNbaV0udHlwZSBdKSApIHtcblx0XHRcdG1hdGNoZXJzID0gWyBhZGRDb21iaW5hdG9yKGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApLCBtYXRjaGVyKSBdO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRtYXRjaGVyID0gRXhwci5maWx0ZXJbIHRva2Vuc1tpXS50eXBlIF0uYXBwbHkoIG51bGwsIHRva2Vuc1tpXS5tYXRjaGVzICk7XG5cblx0XHRcdGlmICggbWF0Y2hlclsgZXhwYW5kbyBdICkge1xuXHRcdFx0XHRqID0gKytpO1xuXHRcdFx0XHRmb3IgKCA7IGogPCBsZW47IGorKyApIHtcblx0XHRcdFx0XHRpZiAoIEV4cHIucmVsYXRpdmVbIHRva2Vuc1tqXS50eXBlIF0gKSB7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHNldE1hdGNoZXIoXG5cdFx0XHRcdFx0aSA+IDEgJiYgZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICksXG5cdFx0XHRcdFx0aSA+IDEgJiYgdG9TZWxlY3Rvcihcblx0XHRcdFx0XHRcdHRva2Vucy5zbGljZSggMCwgaSAtIDEgKS5jb25jYXQoeyB2YWx1ZTogdG9rZW5zWyBpIC0gMiBdLnR5cGUgPT09IFwiIFwiID8gXCIqXCIgOiBcIlwiIH0pXG5cdFx0XHRcdFx0KS5yZXBsYWNlKCBydHJpbSwgXCIkMVwiICksXG5cdFx0XHRcdFx0bWF0Y2hlcixcblx0XHRcdFx0XHRpIDwgaiAmJiBtYXRjaGVyRnJvbVRva2VucyggdG9rZW5zLnNsaWNlKCBpLCBqICkgKSxcblx0XHRcdFx0XHRqIDwgbGVuICYmIG1hdGNoZXJGcm9tVG9rZW5zKCAodG9rZW5zID0gdG9rZW5zLnNsaWNlKCBqICkpICksXG5cdFx0XHRcdFx0aiA8IGxlbiAmJiB0b1NlbGVjdG9yKCB0b2tlbnMgKVxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdFx0bWF0Y2hlcnMucHVzaCggbWF0Y2hlciApO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiBlbGVtZW50TWF0Y2hlciggbWF0Y2hlcnMgKTtcbn1cblxuZnVuY3Rpb24gbWF0Y2hlckZyb21Hcm91cE1hdGNoZXJzKCBlbGVtZW50TWF0Y2hlcnMsIHNldE1hdGNoZXJzICkge1xuXHR2YXIgYnlTZXQgPSBzZXRNYXRjaGVycy5sZW5ndGggPiAwLFxuXHRcdGJ5RWxlbWVudCA9IGVsZW1lbnRNYXRjaGVycy5sZW5ndGggPiAwLFxuXHRcdHN1cGVyTWF0Y2hlciA9IGZ1bmN0aW9uKCBzZWVkLCBjb250ZXh0LCB4bWwsIHJlc3VsdHMsIG91dGVybW9zdCApIHtcblx0XHRcdHZhciBlbGVtLCBqLCBtYXRjaGVyLFxuXHRcdFx0XHRtYXRjaGVkQ291bnQgPSAwLFxuXHRcdFx0XHRpID0gXCIwXCIsXG5cdFx0XHRcdHVubWF0Y2hlZCA9IHNlZWQgJiYgW10sXG5cdFx0XHRcdHNldE1hdGNoZWQgPSBbXSxcblx0XHRcdFx0Y29udGV4dEJhY2t1cCA9IG91dGVybW9zdENvbnRleHQsXG5cdFx0XHRcdGVsZW1zID0gc2VlZCB8fCBieUVsZW1lbnQgJiYgRXhwci5maW5kW1wiVEFHXCJdKCBcIipcIiwgb3V0ZXJtb3N0ICksXG5cdFx0XHRcdGRpcnJ1bnNVbmlxdWUgPSAoZGlycnVucyArPSBjb250ZXh0QmFja3VwID09IG51bGwgPyAxIDogTWF0aC5yYW5kb20oKSB8fCAwLjEpLFxuXHRcdFx0XHRsZW4gPSBlbGVtcy5sZW5ndGg7XG5cblx0XHRcdGlmICggb3V0ZXJtb3N0ICkge1xuXHRcdFx0XHRvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dCAhPT0gZG9jdW1lbnQgJiYgY29udGV4dDtcblx0XHRcdH1cblxuXHRcdFx0Zm9yICggOyBpICE9PSBsZW4gJiYgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkge1xuXHRcdFx0XHRpZiAoIGJ5RWxlbWVudCAmJiBlbGVtICkge1xuXHRcdFx0XHRcdGogPSAwO1xuXHRcdFx0XHRcdHdoaWxlICggKG1hdGNoZXIgPSBlbGVtZW50TWF0Y2hlcnNbaisrXSkgKSB7XG5cdFx0XHRcdFx0XHRpZiAoIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApICkge1xuXHRcdFx0XHRcdFx0XHRyZXN1bHRzLnB1c2goIGVsZW0gKTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICggb3V0ZXJtb3N0ICkge1xuXHRcdFx0XHRcdFx0ZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCBieVNldCApIHtcblx0XHRcdFx0XHRpZiAoIChlbGVtID0gIW1hdGNoZXIgJiYgZWxlbSkgKSB7XG5cdFx0XHRcdFx0XHRtYXRjaGVkQ291bnQtLTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIHNlZWQgKSB7XG5cdFx0XHRcdFx0XHR1bm1hdGNoZWQucHVzaCggZWxlbSApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRtYXRjaGVkQ291bnQgKz0gaTtcblx0XHRcdGlmICggYnlTZXQgJiYgaSAhPT0gbWF0Y2hlZENvdW50ICkge1xuXHRcdFx0XHRqID0gMDtcblx0XHRcdFx0d2hpbGUgKCAobWF0Y2hlciA9IHNldE1hdGNoZXJzW2orK10pICkge1xuXHRcdFx0XHRcdG1hdGNoZXIoIHVubWF0Y2hlZCwgc2V0TWF0Y2hlZCwgY29udGV4dCwgeG1sICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIHNlZWQgKSB7XG5cdFx0XHRcdFx0aWYgKCBtYXRjaGVkQ291bnQgPiAwICkge1xuXHRcdFx0XHRcdFx0d2hpbGUgKCBpLS0gKSB7XG5cdFx0XHRcdFx0XHRcdGlmICggISh1bm1hdGNoZWRbaV0gfHwgc2V0TWF0Y2hlZFtpXSkgKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2V0TWF0Y2hlZFtpXSA9IHBvcC5jYWxsKCByZXN1bHRzICk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRzZXRNYXRjaGVkID0gY29uZGVuc2UoIHNldE1hdGNoZWQgKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHB1c2guYXBwbHkoIHJlc3VsdHMsIHNldE1hdGNoZWQgKTtcblxuXHRcdFx0XHRpZiAoIG91dGVybW9zdCAmJiAhc2VlZCAmJiBzZXRNYXRjaGVkLmxlbmd0aCA+IDAgJiZcblx0XHRcdFx0XHQoIG1hdGNoZWRDb3VudCArIHNldE1hdGNoZXJzLmxlbmd0aCApID4gMSApIHtcblxuXHRcdFx0XHRcdFNpenpsZS51bmlxdWVTb3J0KCByZXN1bHRzICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKCBvdXRlcm1vc3QgKSB7XG5cdFx0XHRcdGRpcnJ1bnMgPSBkaXJydW5zVW5pcXVlO1xuXHRcdFx0XHRvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dEJhY2t1cDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHVubWF0Y2hlZDtcblx0XHR9O1xuXG5cdHJldHVybiBieVNldCA/XG5cdFx0bWFya0Z1bmN0aW9uKCBzdXBlck1hdGNoZXIgKSA6XG5cdFx0c3VwZXJNYXRjaGVyO1xufVxuXG5jb21waWxlID0gU2l6emxlLmNvbXBpbGUgPSBmdW5jdGlvbiggc2VsZWN0b3IsIG1hdGNoIC8qIEludGVybmFsIFVzZSBPbmx5ICovICkge1xuXHR2YXIgaSxcblx0XHRzZXRNYXRjaGVycyA9IFtdLFxuXHRcdGVsZW1lbnRNYXRjaGVycyA9IFtdLFxuXHRcdGNhY2hlZCA9IGNvbXBpbGVyQ2FjaGVbIHNlbGVjdG9yICsgXCIgXCIgXTtcblxuXHRpZiAoICFjYWNoZWQgKSB7XG5cdFx0aWYgKCAhbWF0Y2ggKSB7XG5cdFx0XHRtYXRjaCA9IHRva2VuaXplKCBzZWxlY3RvciApO1xuXHRcdH1cblx0XHRpID0gbWF0Y2gubGVuZ3RoO1xuXHRcdHdoaWxlICggaS0tICkge1xuXHRcdFx0Y2FjaGVkID0gbWF0Y2hlckZyb21Ub2tlbnMoIG1hdGNoW2ldICk7XG5cdFx0XHRpZiAoIGNhY2hlZFsgZXhwYW5kbyBdICkge1xuXHRcdFx0XHRzZXRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGVsZW1lbnRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRjYWNoZWQgPSBjb21waWxlckNhY2hlKCBzZWxlY3RvciwgbWF0Y2hlckZyb21Hcm91cE1hdGNoZXJzKCBlbGVtZW50TWF0Y2hlcnMsIHNldE1hdGNoZXJzICkgKTtcblxuXHRcdGNhY2hlZC5zZWxlY3RvciA9IHNlbGVjdG9yO1xuXHR9XG5cdHJldHVybiBjYWNoZWQ7XG59O1xuXG4vKipcbiAqIEEgbG93LWxldmVsIHNlbGVjdGlvbiBmdW5jdGlvbiB0aGF0IHdvcmtzIHdpdGggU2l6emxlJ3MgY29tcGlsZWRcbiAqICBzZWxlY3RvciBmdW5jdGlvbnNcbiAqIEBwYXJhbSB7U3RyaW5nfEZ1bmN0aW9ufSBzZWxlY3RvciBBIHNlbGVjdG9yIG9yIGEgcHJlLWNvbXBpbGVkXG4gKiAgc2VsZWN0b3IgZnVuY3Rpb24gYnVpbHQgd2l0aCBTaXp6bGUuY29tcGlsZVxuICogQHBhcmFtIHtFbGVtZW50fSBjb250ZXh0XG4gKiBAcGFyYW0ge0FycmF5fSBbcmVzdWx0c11cbiAqIEBwYXJhbSB7QXJyYXl9IFtzZWVkXSBBIHNldCBvZiBlbGVtZW50cyB0byBtYXRjaCBhZ2FpbnN0XG4gKi9cbnNlbGVjdCA9IFNpenpsZS5zZWxlY3QgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQgKSB7XG5cdHZhciBpLCB0b2tlbnMsIHRva2VuLCB0eXBlLCBmaW5kLFxuXHRcdGNvbXBpbGVkID0gdHlwZW9mIHNlbGVjdG9yID09PSBcImZ1bmN0aW9uXCIgJiYgc2VsZWN0b3IsXG5cdFx0bWF0Y2ggPSAhc2VlZCAmJiB0b2tlbml6ZSggKHNlbGVjdG9yID0gY29tcGlsZWQuc2VsZWN0b3IgfHwgc2VsZWN0b3IpICk7XG5cblx0cmVzdWx0cyA9IHJlc3VsdHMgfHwgW107XG5cblx0aWYgKCBtYXRjaC5sZW5ndGggPT09IDEgKSB7XG5cblx0XHR0b2tlbnMgPSBtYXRjaFswXSA9IG1hdGNoWzBdLnNsaWNlKCAwICk7XG5cdFx0aWYgKCB0b2tlbnMubGVuZ3RoID4gMiAmJiAodG9rZW4gPSB0b2tlbnNbMF0pLnR5cGUgPT09IFwiSURcIiAmJlxuXHRcdFx0XHRzdXBwb3J0LmdldEJ5SWQgJiYgY29udGV4dC5ub2RlVHlwZSA9PT0gOSAmJiBkb2N1bWVudElzSFRNTCAmJlxuXHRcdFx0XHRFeHByLnJlbGF0aXZlWyB0b2tlbnNbMV0udHlwZSBdICkge1xuXG5cdFx0XHRjb250ZXh0ID0gKCBFeHByLmZpbmRbXCJJRFwiXSggdG9rZW4ubWF0Y2hlc1swXS5yZXBsYWNlKHJ1bmVzY2FwZSwgZnVuZXNjYXBlKSwgY29udGV4dCApIHx8IFtdIClbMF07XG5cdFx0XHRpZiAoICFjb250ZXh0ICkge1xuXHRcdFx0XHRyZXR1cm4gcmVzdWx0cztcblxuXHRcdFx0fSBlbHNlIGlmICggY29tcGlsZWQgKSB7XG5cdFx0XHRcdGNvbnRleHQgPSBjb250ZXh0LnBhcmVudE5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGVjdG9yID0gc2VsZWN0b3Iuc2xpY2UoIHRva2Vucy5zaGlmdCgpLnZhbHVlLmxlbmd0aCApO1xuXHRcdH1cblxuXHRcdGkgPSBtYXRjaEV4cHJbXCJuZWVkc0NvbnRleHRcIl0udGVzdCggc2VsZWN0b3IgKSA/IDAgOiB0b2tlbnMubGVuZ3RoO1xuXHRcdHdoaWxlICggaS0tICkge1xuXHRcdFx0dG9rZW4gPSB0b2tlbnNbaV07XG5cblx0XHRcdGlmICggRXhwci5yZWxhdGl2ZVsgKHR5cGUgPSB0b2tlbi50eXBlKSBdICkge1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHRcdGlmICggKGZpbmQgPSBFeHByLmZpbmRbIHR5cGUgXSkgKSB7XG5cdFx0XHRcdGlmICggKHNlZWQgPSBmaW5kKFxuXHRcdFx0XHRcdHRva2VuLm1hdGNoZXNbMF0ucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKSxcblx0XHRcdFx0XHRyc2libGluZy50ZXN0KCB0b2tlbnNbMF0udHlwZSApICYmIHRlc3RDb250ZXh0KCBjb250ZXh0LnBhcmVudE5vZGUgKSB8fCBjb250ZXh0XG5cdFx0XHRcdCkpICkge1xuXG5cdFx0XHRcdFx0dG9rZW5zLnNwbGljZSggaSwgMSApO1xuXHRcdFx0XHRcdHNlbGVjdG9yID0gc2VlZC5sZW5ndGggJiYgdG9TZWxlY3RvciggdG9rZW5zICk7XG5cdFx0XHRcdFx0aWYgKCAhc2VsZWN0b3IgKSB7XG5cdFx0XHRcdFx0XHRwdXNoLmFwcGx5KCByZXN1bHRzLCBzZWVkICk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0cztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdCggY29tcGlsZWQgfHwgY29tcGlsZSggc2VsZWN0b3IsIG1hdGNoICkgKShcblx0XHRzZWVkLFxuXHRcdGNvbnRleHQsXG5cdFx0IWRvY3VtZW50SXNIVE1MLFxuXHRcdHJlc3VsdHMsXG5cdFx0cnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKSAmJiB0ZXN0Q29udGV4dCggY29udGV4dC5wYXJlbnROb2RlICkgfHwgY29udGV4dFxuXHQpO1xuXHRyZXR1cm4gcmVzdWx0cztcbn07XG5cblxuc3VwcG9ydC5zb3J0U3RhYmxlID0gZXhwYW5kby5zcGxpdChcIlwiKS5zb3J0KCBzb3J0T3JkZXIgKS5qb2luKFwiXCIpID09PSBleHBhbmRvO1xuXG5zdXBwb3J0LmRldGVjdER1cGxpY2F0ZXMgPSAhIWhhc0R1cGxpY2F0ZTtcblxuc2V0RG9jdW1lbnQoKTtcblxuc3VwcG9ydC5zb3J0RGV0YWNoZWQgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdjEgKSB7XG5cdHJldHVybiBkaXYxLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpICkgJiAxO1xufSk7XG5cbmlmICggIWFzc2VydChmdW5jdGlvbiggZGl2ICkge1xuXHRkaXYuaW5uZXJIVE1MID0gXCI8YSBocmVmPScjJz48L2E+XCI7XG5cdHJldHVybiBkaXYuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpID09PSBcIiNcIiA7XG59KSApIHtcblx0YWRkSGFuZGxlKCBcInR5cGV8aHJlZnxoZWlnaHR8d2lkdGhcIiwgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGlzWE1MICkge1xuXHRcdGlmICggIWlzWE1MICkge1xuXHRcdFx0cmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lLCBuYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwidHlwZVwiID8gMSA6IDIgKTtcblx0XHR9XG5cdH0pO1xufVxuXG5pZiAoICFzdXBwb3J0LmF0dHJpYnV0ZXMgfHwgIWFzc2VydChmdW5jdGlvbiggZGl2ICkge1xuXHRkaXYuaW5uZXJIVE1MID0gXCI8aW5wdXQvPlwiO1xuXHRkaXYuZmlyc3RDaGlsZC5zZXRBdHRyaWJ1dGUoIFwidmFsdWVcIiwgXCJcIiApO1xuXHRyZXR1cm4gZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCBcInZhbHVlXCIgKSA9PT0gXCJcIjtcbn0pICkge1xuXHRhZGRIYW5kbGUoIFwidmFsdWVcIiwgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGlzWE1MICkge1xuXHRcdGlmICggIWlzWE1MICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJpbnB1dFwiICkge1xuXHRcdFx0cmV0dXJuIGVsZW0uZGVmYXVsdFZhbHVlO1xuXHRcdH1cblx0fSk7XG59XG5cbmlmICggIWFzc2VydChmdW5jdGlvbiggZGl2ICkge1xuXHRyZXR1cm4gZGl2LmdldEF0dHJpYnV0ZShcImRpc2FibGVkXCIpID09IG51bGw7XG59KSApIHtcblx0YWRkSGFuZGxlKCBib29sZWFucywgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGlzWE1MICkge1xuXHRcdHZhciB2YWw7XG5cdFx0aWYgKCAhaXNYTUwgKSB7XG5cdFx0XHRyZXR1cm4gZWxlbVsgbmFtZSBdID09PSB0cnVlID8gbmFtZS50b0xvd2VyQ2FzZSgpIDpcblx0XHRcdFx0XHQodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICkpICYmIHZhbC5zcGVjaWZpZWQgP1xuXHRcdFx0XHRcdHZhbC52YWx1ZSA6XG5cdFx0XHRcdG51bGw7XG5cdFx0fVxuXHR9KTtcbn1cblxuaWYgKCB0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCApIHtcblx0ZGVmaW5lKGZ1bmN0aW9uKCkgeyByZXR1cm4gU2l6emxlOyB9KTtcbn0gZWxzZSBpZiAoIHR5cGVvZiBtb2R1bGUgIT09IFwidW5kZWZpbmVkXCIgJiYgbW9kdWxlLmV4cG9ydHMgKSB7XG5cdG1vZHVsZS5leHBvcnRzID0gU2l6emxlO1xufSBlbHNlIHtcblx0d2luZG93LlNpenpsZSA9IFNpenpsZTtcbn1cblxufSkoIHdpbmRvdyApO1xuXG47KGZ1bmN0aW9uKGVuZ2luZSkge1xuICB2YXIgZXh0ZW5kRWxlbWVudHMgPSBQcm90b3R5cGUuU2VsZWN0b3IuZXh0ZW5kRWxlbWVudHM7XG5cbiAgZnVuY3Rpb24gc2VsZWN0KHNlbGVjdG9yLCBzY29wZSkge1xuICAgIHJldHVybiBleHRlbmRFbGVtZW50cyhlbmdpbmUoc2VsZWN0b3IsIHNjb3BlIHx8IGRvY3VtZW50KSk7XG4gIH1cblxuICBmdW5jdGlvbiBtYXRjaChlbGVtZW50LCBzZWxlY3Rvcikge1xuICAgIHJldHVybiBlbmdpbmUubWF0Y2hlcyhzZWxlY3RvciwgW2VsZW1lbnRdKS5sZW5ndGggPT0gMTtcbiAgfVxuXG4gIFByb3RvdHlwZS5TZWxlY3Rvci5lbmdpbmUgPSBlbmdpbmU7XG4gIFByb3RvdHlwZS5TZWxlY3Rvci5zZWxlY3QgPSBzZWxlY3Q7XG4gIFByb3RvdHlwZS5TZWxlY3Rvci5tYXRjaCA9IG1hdGNoO1xufSkoU2l6emxlKTtcblxud2luZG93LlNpenpsZSA9IFByb3RvdHlwZS5fb3JpZ2luYWxfcHJvcGVydHk7XG5kZWxldGUgUHJvdG90eXBlLl9vcmlnaW5hbF9wcm9wZXJ0eTtcblxudmFyIEZvcm0gPSB7XG4gIHJlc2V0OiBmdW5jdGlvbihmb3JtKSB7XG4gICAgZm9ybSA9ICQoZm9ybSk7XG4gICAgZm9ybS5yZXNldCgpO1xuICAgIHJldHVybiBmb3JtO1xuICB9LFxuXG4gIHNlcmlhbGl6ZUVsZW1lbnRzOiBmdW5jdGlvbihlbGVtZW50cywgb3B0aW9ucykge1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyAhPSAnb2JqZWN0Jykgb3B0aW9ucyA9IHsgaGFzaDogISFvcHRpb25zIH07XG4gICAgZWxzZSBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKG9wdGlvbnMuaGFzaCkpIG9wdGlvbnMuaGFzaCA9IHRydWU7XG4gICAgdmFyIGtleSwgdmFsdWUsIHN1Ym1pdHRlZCA9IGZhbHNlLCBzdWJtaXQgPSBvcHRpb25zLnN1Ym1pdCwgYWNjdW11bGF0b3IsIGluaXRpYWw7XG5cbiAgICBpZiAob3B0aW9ucy5oYXNoKSB7XG4gICAgICBpbml0aWFsID0ge307XG4gICAgICBhY2N1bXVsYXRvciA9IGZ1bmN0aW9uKHJlc3VsdCwga2V5LCB2YWx1ZSkge1xuICAgICAgICBpZiAoa2V5IGluIHJlc3VsdCkge1xuICAgICAgICAgIGlmICghT2JqZWN0LmlzQXJyYXkocmVzdWx0W2tleV0pKSByZXN1bHRba2V5XSA9IFtyZXN1bHRba2V5XV07XG4gICAgICAgICAgcmVzdWx0W2tleV0gPSByZXN1bHRba2V5XS5jb25jYXQodmFsdWUpO1xuICAgICAgICB9IGVsc2UgcmVzdWx0W2tleV0gPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGluaXRpYWwgPSAnJztcbiAgICAgIGFjY3VtdWxhdG9yID0gZnVuY3Rpb24ocmVzdWx0LCBrZXksIHZhbHVlcykge1xuICAgICAgICBpZiAoIU9iamVjdC5pc0FycmF5KHZhbHVlcykpIHt2YWx1ZXMgPSBbdmFsdWVzXTt9XG4gICAgICAgIGlmICghdmFsdWVzLmxlbmd0aCkge3JldHVybiByZXN1bHQ7fVxuICAgICAgICB2YXIgZW5jb2RlZEtleSA9IGVuY29kZVVSSUNvbXBvbmVudChrZXkpLmdzdWIoLyUyMC8sICcrJyk7XG4gICAgICAgIHJldHVybiByZXN1bHQgKyAocmVzdWx0ID8gXCImXCIgOiBcIlwiKSArIHZhbHVlcy5tYXAoZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgdmFsdWUgPSB2YWx1ZS5nc3ViKC8oXFxyKT9cXG4vLCAnXFxyXFxuJyk7XG4gICAgICAgICAgdmFsdWUgPSBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpO1xuICAgICAgICAgIHZhbHVlID0gdmFsdWUuZ3N1YigvJTIwLywgJysnKTtcbiAgICAgICAgICByZXR1cm4gZW5jb2RlZEtleSArIFwiPVwiICsgdmFsdWU7XG4gICAgICAgIH0pLmpvaW4oXCImXCIpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gZWxlbWVudHMuaW5qZWN0KGluaXRpYWwsIGZ1bmN0aW9uKHJlc3VsdCwgZWxlbWVudCkge1xuICAgICAgaWYgKCFlbGVtZW50LmRpc2FibGVkICYmIGVsZW1lbnQubmFtZSkge1xuICAgICAgICBrZXkgPSBlbGVtZW50Lm5hbWU7IHZhbHVlID0gJChlbGVtZW50KS5nZXRWYWx1ZSgpO1xuICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCAmJiBlbGVtZW50LnR5cGUgIT0gJ2ZpbGUnICYmIChlbGVtZW50LnR5cGUgIT0gJ3N1Ym1pdCcgfHwgKCFzdWJtaXR0ZWQgJiZcbiAgICAgICAgICAgIHN1Ym1pdCAhPT0gZmFsc2UgJiYgKCFzdWJtaXQgfHwga2V5ID09IHN1Ym1pdCkgJiYgKHN1Ym1pdHRlZCA9IHRydWUpKSkpIHtcbiAgICAgICAgICByZXN1bHQgPSBhY2N1bXVsYXRvcihyZXN1bHQsIGtleSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0pO1xuICB9XG59O1xuXG5Gb3JtLk1ldGhvZHMgPSB7XG4gIHNlcmlhbGl6ZTogZnVuY3Rpb24oZm9ybSwgb3B0aW9ucykge1xuICAgIHJldHVybiBGb3JtLnNlcmlhbGl6ZUVsZW1lbnRzKEZvcm0uZ2V0RWxlbWVudHMoZm9ybSksIG9wdGlvbnMpO1xuICB9LFxuXG5cbiAgZ2V0RWxlbWVudHM6IGZ1bmN0aW9uKGZvcm0pIHtcbiAgICB2YXIgZWxlbWVudHMgPSAkKGZvcm0pLmdldEVsZW1lbnRzQnlUYWdOYW1lKCcqJyk7XG4gICAgdmFyIGVsZW1lbnQsIHJlc3VsdHMgPSBbXSwgc2VyaWFsaXplcnMgPSBGb3JtLkVsZW1lbnQuU2VyaWFsaXplcnM7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgZWxlbWVudCA9IGVsZW1lbnRzW2ldOyBpKyspIHtcbiAgICAgIGlmIChzZXJpYWxpemVyc1tlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKV0pXG4gICAgICAgIHJlc3VsdHMucHVzaChFbGVtZW50LmV4dGVuZChlbGVtZW50KSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzO1xuICB9LFxuXG4gIGdldElucHV0czogZnVuY3Rpb24oZm9ybSwgdHlwZU5hbWUsIG5hbWUpIHtcbiAgICBmb3JtID0gJChmb3JtKTtcbiAgICB2YXIgaW5wdXRzID0gZm9ybS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5wdXQnKTtcblxuICAgIGlmICghdHlwZU5hbWUgJiYgIW5hbWUpIHJldHVybiAkQShpbnB1dHMpLm1hcChFbGVtZW50LmV4dGVuZCk7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbWF0Y2hpbmdJbnB1dHMgPSBbXSwgbGVuZ3RoID0gaW5wdXRzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgaW5wdXQgPSBpbnB1dHNbaV07XG4gICAgICBpZiAoKHR5cGVOYW1lICYmIGlucHV0LnR5cGUgIT0gdHlwZU5hbWUpIHx8IChuYW1lICYmIGlucHV0Lm5hbWUgIT0gbmFtZSkpXG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgbWF0Y2hpbmdJbnB1dHMucHVzaChFbGVtZW50LmV4dGVuZChpbnB1dCkpO1xuICAgIH1cblxuICAgIHJldHVybiBtYXRjaGluZ0lucHV0cztcbiAgfSxcblxuICBkaXNhYmxlOiBmdW5jdGlvbihmb3JtKSB7XG4gICAgZm9ybSA9ICQoZm9ybSk7XG4gICAgRm9ybS5nZXRFbGVtZW50cyhmb3JtKS5pbnZva2UoJ2Rpc2FibGUnKTtcbiAgICByZXR1cm4gZm9ybTtcbiAgfSxcblxuICBlbmFibGU6IGZ1bmN0aW9uKGZvcm0pIHtcbiAgICBmb3JtID0gJChmb3JtKTtcbiAgICBGb3JtLmdldEVsZW1lbnRzKGZvcm0pLmludm9rZSgnZW5hYmxlJyk7XG4gICAgcmV0dXJuIGZvcm07XG4gIH0sXG5cbiAgZmluZEZpcnN0RWxlbWVudDogZnVuY3Rpb24oZm9ybSkge1xuICAgIHZhciBlbGVtZW50cyA9ICQoZm9ybSkuZ2V0RWxlbWVudHMoKS5maW5kQWxsKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiAnaGlkZGVuJyAhPSBlbGVtZW50LnR5cGUgJiYgIWVsZW1lbnQuZGlzYWJsZWQ7XG4gICAgfSk7XG4gICAgdmFyIGZpcnN0QnlJbmRleCA9IGVsZW1lbnRzLmZpbmRBbGwoZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGVsZW1lbnQuaGFzQXR0cmlidXRlKCd0YWJJbmRleCcpICYmIGVsZW1lbnQudGFiSW5kZXggPj0gMDtcbiAgICB9KS5zb3J0QnkoZnVuY3Rpb24oZWxlbWVudCkgeyByZXR1cm4gZWxlbWVudC50YWJJbmRleCB9KS5maXJzdCgpO1xuXG4gICAgcmV0dXJuIGZpcnN0QnlJbmRleCA/IGZpcnN0QnlJbmRleCA6IGVsZW1lbnRzLmZpbmQoZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgcmV0dXJuIC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhKSQvaS50ZXN0KGVsZW1lbnQudGFnTmFtZSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgZm9jdXNGaXJzdEVsZW1lbnQ6IGZ1bmN0aW9uKGZvcm0pIHtcbiAgICBmb3JtID0gJChmb3JtKTtcbiAgICB2YXIgZWxlbWVudCA9IGZvcm0uZmluZEZpcnN0RWxlbWVudCgpO1xuICAgIGlmIChlbGVtZW50KSBlbGVtZW50LmFjdGl2YXRlKCk7XG4gICAgcmV0dXJuIGZvcm07XG4gIH0sXG5cbiAgcmVxdWVzdDogZnVuY3Rpb24oZm9ybSwgb3B0aW9ucykge1xuICAgIGZvcm0gPSAkKGZvcm0pLCBvcHRpb25zID0gT2JqZWN0LmNsb25lKG9wdGlvbnMgfHwgeyB9KTtcblxuICAgIHZhciBwYXJhbXMgPSBvcHRpb25zLnBhcmFtZXRlcnMsIGFjdGlvbiA9IGZvcm0ucmVhZEF0dHJpYnV0ZSgnYWN0aW9uJykgfHwgJyc7XG4gICAgaWYgKGFjdGlvbi5ibGFuaygpKSBhY3Rpb24gPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICBvcHRpb25zLnBhcmFtZXRlcnMgPSBmb3JtLnNlcmlhbGl6ZSh0cnVlKTtcblxuICAgIGlmIChwYXJhbXMpIHtcbiAgICAgIGlmIChPYmplY3QuaXNTdHJpbmcocGFyYW1zKSkgcGFyYW1zID0gcGFyYW1zLnRvUXVlcnlQYXJhbXMoKTtcbiAgICAgIE9iamVjdC5leHRlbmQob3B0aW9ucy5wYXJhbWV0ZXJzLCBwYXJhbXMpO1xuICAgIH1cblxuICAgIGlmIChmb3JtLmhhc0F0dHJpYnV0ZSgnbWV0aG9kJykgJiYgIW9wdGlvbnMubWV0aG9kKVxuICAgICAgb3B0aW9ucy5tZXRob2QgPSBmb3JtLm1ldGhvZDtcblxuICAgIHJldHVybiBuZXcgQWpheC5SZXF1ZXN0KGFjdGlvbiwgb3B0aW9ucyk7XG4gIH1cbn07XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cbkZvcm0uRWxlbWVudCA9IHtcbiAgZm9jdXM6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAkKGVsZW1lbnQpLmZvY3VzKCk7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH0sXG5cbiAgc2VsZWN0OiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgJChlbGVtZW50KS5zZWxlY3QoKTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxufTtcblxuRm9ybS5FbGVtZW50Lk1ldGhvZHMgPSB7XG5cbiAgc2VyaWFsaXplOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgaWYgKCFlbGVtZW50LmRpc2FibGVkICYmIGVsZW1lbnQubmFtZSkge1xuICAgICAgdmFyIHZhbHVlID0gZWxlbWVudC5nZXRWYWx1ZSgpO1xuICAgICAgaWYgKHZhbHVlICE9IHVuZGVmaW5lZCkge1xuICAgICAgICB2YXIgcGFpciA9IHsgfTtcbiAgICAgICAgcGFpcltlbGVtZW50Lm5hbWVdID0gdmFsdWU7XG4gICAgICAgIHJldHVybiBPYmplY3QudG9RdWVyeVN0cmluZyhwYWlyKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9LFxuXG4gIGdldFZhbHVlOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgdmFyIG1ldGhvZCA9IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIHJldHVybiBGb3JtLkVsZW1lbnQuU2VyaWFsaXplcnNbbWV0aG9kXShlbGVtZW50KTtcbiAgfSxcblxuICBzZXRWYWx1ZTogZnVuY3Rpb24oZWxlbWVudCwgdmFsdWUpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICB2YXIgbWV0aG9kID0gZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgRm9ybS5FbGVtZW50LlNlcmlhbGl6ZXJzW21ldGhvZF0oZWxlbWVudCwgdmFsdWUpO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9LFxuXG4gIGNsZWFyOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgJChlbGVtZW50KS52YWx1ZSA9ICcnO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9LFxuXG4gIHByZXNlbnQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gJChlbGVtZW50KS52YWx1ZSAhPSAnJztcbiAgfSxcblxuICBhY3RpdmF0ZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHRyeSB7XG4gICAgICBlbGVtZW50LmZvY3VzKCk7XG4gICAgICBpZiAoZWxlbWVudC5zZWxlY3QgJiYgKGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9ICdpbnB1dCcgfHxcbiAgICAgICAgICAhKC9eKD86YnV0dG9ufHJlc2V0fHN1Ym1pdCkkL2kudGVzdChlbGVtZW50LnR5cGUpKSkpXG4gICAgICAgIGVsZW1lbnQuc2VsZWN0KCk7XG4gICAgfSBjYXRjaCAoZSkgeyB9XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH0sXG5cbiAgZGlzYWJsZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIGVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9LFxuXG4gIGVuYWJsZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIGVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxufTtcblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbnZhciBGaWVsZCA9IEZvcm0uRWxlbWVudDtcblxudmFyICRGID0gRm9ybS5FbGVtZW50Lk1ldGhvZHMuZ2V0VmFsdWU7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5Gb3JtLkVsZW1lbnQuU2VyaWFsaXplcnMgPSAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIGlucHV0KGVsZW1lbnQsIHZhbHVlKSB7XG4gICAgc3dpdGNoIChlbGVtZW50LnR5cGUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgY2FzZSAnY2hlY2tib3gnOlxuICAgICAgY2FzZSAncmFkaW8nOlxuICAgICAgICByZXR1cm4gaW5wdXRTZWxlY3RvcihlbGVtZW50LCB2YWx1ZSk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gdmFsdWVTZWxlY3RvcihlbGVtZW50LCB2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaW5wdXRTZWxlY3RvcihlbGVtZW50LCB2YWx1ZSkge1xuICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQodmFsdWUpKVxuICAgICAgcmV0dXJuIGVsZW1lbnQuY2hlY2tlZCA/IGVsZW1lbnQudmFsdWUgOiBudWxsO1xuICAgIGVsc2UgZWxlbWVudC5jaGVja2VkID0gISF2YWx1ZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHZhbHVlU2VsZWN0b3IoZWxlbWVudCwgdmFsdWUpIHtcbiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKHZhbHVlKSkgcmV0dXJuIGVsZW1lbnQudmFsdWU7XG4gICAgZWxzZSBlbGVtZW50LnZhbHVlID0gdmFsdWU7XG4gIH1cblxuICBmdW5jdGlvbiBzZWxlY3QoZWxlbWVudCwgdmFsdWUpIHtcbiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKHZhbHVlKSlcbiAgICAgIHJldHVybiAoZWxlbWVudC50eXBlID09PSAnc2VsZWN0LW9uZScgPyBzZWxlY3RPbmUgOiBzZWxlY3RNYW55KShlbGVtZW50KTtcblxuICAgIHZhciBvcHQsIGN1cnJlbnRWYWx1ZSwgc2luZ2xlID0gIU9iamVjdC5pc0FycmF5KHZhbHVlKTtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZWxlbWVudC5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgb3B0ID0gZWxlbWVudC5vcHRpb25zW2ldO1xuICAgICAgY3VycmVudFZhbHVlID0gdGhpcy5vcHRpb25WYWx1ZShvcHQpO1xuICAgICAgaWYgKHNpbmdsZSkge1xuICAgICAgICBpZiAoY3VycmVudFZhbHVlID09IHZhbHVlKSB7XG4gICAgICAgICAgb3B0LnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2Ugb3B0LnNlbGVjdGVkID0gdmFsdWUuaW5jbHVkZShjdXJyZW50VmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNlbGVjdE9uZShlbGVtZW50KSB7XG4gICAgdmFyIGluZGV4ID0gZWxlbWVudC5zZWxlY3RlZEluZGV4O1xuICAgIHJldHVybiBpbmRleCA+PSAwID8gb3B0aW9uVmFsdWUoZWxlbWVudC5vcHRpb25zW2luZGV4XSkgOiBudWxsO1xuICB9XG5cbiAgZnVuY3Rpb24gc2VsZWN0TWFueShlbGVtZW50KSB7XG4gICAgdmFyIHZhbHVlcywgbGVuZ3RoID0gZWxlbWVudC5sZW5ndGg7XG4gICAgaWYgKCFsZW5ndGgpIHJldHVybiBudWxsO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIHZhbHVlcyA9IFtdOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBvcHQgPSBlbGVtZW50Lm9wdGlvbnNbaV07XG4gICAgICBpZiAob3B0LnNlbGVjdGVkKSB2YWx1ZXMucHVzaChvcHRpb25WYWx1ZShvcHQpKTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlcztcbiAgfVxuXG4gIGZ1bmN0aW9uIG9wdGlvblZhbHVlKG9wdCkge1xuICAgIHJldHVybiBFbGVtZW50Lmhhc0F0dHJpYnV0ZShvcHQsICd2YWx1ZScpID8gb3B0LnZhbHVlIDogb3B0LnRleHQ7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGlucHV0OiAgICAgICAgIGlucHV0LFxuICAgIGlucHV0U2VsZWN0b3I6IGlucHV0U2VsZWN0b3IsXG4gICAgdGV4dGFyZWE6ICAgICAgdmFsdWVTZWxlY3RvcixcbiAgICBzZWxlY3Q6ICAgICAgICBzZWxlY3QsXG4gICAgc2VsZWN0T25lOiAgICAgc2VsZWN0T25lLFxuICAgIHNlbGVjdE1hbnk6ICAgIHNlbGVjdE1hbnksXG4gICAgb3B0aW9uVmFsdWU6ICAgb3B0aW9uVmFsdWUsXG4gICAgYnV0dG9uOiAgICAgICAgdmFsdWVTZWxlY3RvclxuICB9O1xufSkoKTtcblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblxuQWJzdHJhY3QuVGltZWRPYnNlcnZlciA9IENsYXNzLmNyZWF0ZShQZXJpb2RpY2FsRXhlY3V0ZXIsIHtcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oJHN1cGVyLCBlbGVtZW50LCBmcmVxdWVuY3ksIGNhbGxiYWNrKSB7XG4gICAgJHN1cGVyKGNhbGxiYWNrLCBmcmVxdWVuY3kpO1xuICAgIHRoaXMuZWxlbWVudCAgID0gJChlbGVtZW50KTtcbiAgICB0aGlzLmxhc3RWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoKTtcbiAgfSxcblxuICBleGVjdXRlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG4gICAgaWYgKE9iamVjdC5pc1N0cmluZyh0aGlzLmxhc3RWYWx1ZSkgJiYgT2JqZWN0LmlzU3RyaW5nKHZhbHVlKSA/XG4gICAgICAgIHRoaXMubGFzdFZhbHVlICE9IHZhbHVlIDogU3RyaW5nKHRoaXMubGFzdFZhbHVlKSAhPSBTdHJpbmcodmFsdWUpKSB7XG4gICAgICB0aGlzLmNhbGxiYWNrKHRoaXMuZWxlbWVudCwgdmFsdWUpO1xuICAgICAgdGhpcy5sYXN0VmFsdWUgPSB2YWx1ZTtcbiAgICB9XG4gIH1cbn0pO1xuXG5Gb3JtLkVsZW1lbnQuT2JzZXJ2ZXIgPSBDbGFzcy5jcmVhdGUoQWJzdHJhY3QuVGltZWRPYnNlcnZlciwge1xuICBnZXRWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIEZvcm0uRWxlbWVudC5nZXRWYWx1ZSh0aGlzLmVsZW1lbnQpO1xuICB9XG59KTtcblxuRm9ybS5PYnNlcnZlciA9IENsYXNzLmNyZWF0ZShBYnN0cmFjdC5UaW1lZE9ic2VydmVyLCB7XG4gIGdldFZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gRm9ybS5zZXJpYWxpemUodGhpcy5lbGVtZW50KTtcbiAgfVxufSk7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5BYnN0cmFjdC5FdmVudE9ic2VydmVyID0gQ2xhc3MuY3JlYXRlKHtcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oZWxlbWVudCwgY2FsbGJhY2spIHtcbiAgICB0aGlzLmVsZW1lbnQgID0gJChlbGVtZW50KTtcbiAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG5cbiAgICB0aGlzLmxhc3RWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoKTtcbiAgICBpZiAodGhpcy5lbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PSAnZm9ybScpXG4gICAgICB0aGlzLnJlZ2lzdGVyRm9ybUNhbGxiYWNrcygpO1xuICAgIGVsc2VcbiAgICAgIHRoaXMucmVnaXN0ZXJDYWxsYmFjayh0aGlzLmVsZW1lbnQpO1xuICB9LFxuXG4gIG9uRWxlbWVudEV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG4gICAgaWYgKHRoaXMubGFzdFZhbHVlICE9IHZhbHVlKSB7XG4gICAgICB0aGlzLmNhbGxiYWNrKHRoaXMuZWxlbWVudCwgdmFsdWUpO1xuICAgICAgdGhpcy5sYXN0VmFsdWUgPSB2YWx1ZTtcbiAgICB9XG4gIH0sXG5cbiAgcmVnaXN0ZXJGb3JtQ2FsbGJhY2tzOiBmdW5jdGlvbigpIHtcbiAgICBGb3JtLmdldEVsZW1lbnRzKHRoaXMuZWxlbWVudCkuZWFjaCh0aGlzLnJlZ2lzdGVyQ2FsbGJhY2ssIHRoaXMpO1xuICB9LFxuXG4gIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICBpZiAoZWxlbWVudC50eXBlKSB7XG4gICAgICBzd2l0Y2ggKGVsZW1lbnQudHlwZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgIGNhc2UgJ2NoZWNrYm94JzpcbiAgICAgICAgY2FzZSAncmFkaW8nOlxuICAgICAgICAgIEV2ZW50Lm9ic2VydmUoZWxlbWVudCwgJ2NsaWNrJywgdGhpcy5vbkVsZW1lbnRFdmVudC5iaW5kKHRoaXMpKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBFdmVudC5vYnNlcnZlKGVsZW1lbnQsICdjaGFuZ2UnLCB0aGlzLm9uRWxlbWVudEV2ZW50LmJpbmQodGhpcykpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSk7XG5cbkZvcm0uRWxlbWVudC5FdmVudE9ic2VydmVyID0gQ2xhc3MuY3JlYXRlKEFic3RyYWN0LkV2ZW50T2JzZXJ2ZXIsIHtcbiAgZ2V0VmFsdWU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBGb3JtLkVsZW1lbnQuZ2V0VmFsdWUodGhpcy5lbGVtZW50KTtcbiAgfVxufSk7XG5cbkZvcm0uRXZlbnRPYnNlcnZlciA9IENsYXNzLmNyZWF0ZShBYnN0cmFjdC5FdmVudE9ic2VydmVyLCB7XG4gIGdldFZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gRm9ybS5zZXJpYWxpemUodGhpcy5lbGVtZW50KTtcbiAgfVxufSk7XG4oZnVuY3Rpb24oR0xPQkFMKSB7XG4gIHZhciBESVYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgdmFyIGRvY0VsID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICB2YXIgTU9VU0VFTlRFUl9NT1VTRUxFQVZFX0VWRU5UU19TVVBQT1JURUQgPSAnb25tb3VzZWVudGVyJyBpbiBkb2NFbFxuICAgJiYgJ29ubW91c2VsZWF2ZScgaW4gZG9jRWw7XG5cbiAgdmFyIEV2ZW50ID0ge1xuICAgIEtFWV9CQUNLU1BBQ0U6IDgsXG4gICAgS0VZX1RBQjogICAgICAgOSxcbiAgICBLRVlfUkVUVVJOOiAgIDEzLFxuICAgIEtFWV9FU0M6ICAgICAgMjcsXG4gICAgS0VZX0xFRlQ6ICAgICAzNyxcbiAgICBLRVlfVVA6ICAgICAgIDM4LFxuICAgIEtFWV9SSUdIVDogICAgMzksXG4gICAgS0VZX0RPV046ICAgICA0MCxcbiAgICBLRVlfREVMRVRFOiAgIDQ2LFxuICAgIEtFWV9IT01FOiAgICAgMzYsXG4gICAgS0VZX0VORDogICAgICAzNSxcbiAgICBLRVlfUEFHRVVQOiAgIDMzLFxuICAgIEtFWV9QQUdFRE9XTjogMzQsXG4gICAgS0VZX0lOU0VSVDogICA0NVxuICB9O1xuXG5cbiAgdmFyIGlzSUVMZWdhY3lFdmVudCA9IGZ1bmN0aW9uKGV2ZW50KSB7IHJldHVybiBmYWxzZTsgfTtcblxuICBpZiAod2luZG93LmF0dGFjaEV2ZW50KSB7XG4gICAgaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7XG4gICAgICBpc0lFTGVnYWN5RXZlbnQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICByZXR1cm4gIShldmVudCBpbnN0YW5jZW9mIHdpbmRvdy5FdmVudCk7XG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBpc0lFTGVnYWN5RXZlbnQgPSBmdW5jdGlvbihldmVudCkgeyByZXR1cm4gdHJ1ZTsgfTtcbiAgICB9XG4gIH1cblxuICB2YXIgX2lzQnV0dG9uO1xuXG4gIGZ1bmN0aW9uIF9pc0J1dHRvbkZvckRPTUV2ZW50cyhldmVudCwgY29kZSkge1xuICAgIHJldHVybiBldmVudC53aGljaCA/IChldmVudC53aGljaCA9PT0gY29kZSArIDEpIDogKGV2ZW50LmJ1dHRvbiA9PT0gY29kZSk7XG4gIH1cblxuICB2YXIgbGVnYWN5QnV0dG9uTWFwID0geyAwOiAxLCAxOiA0LCAyOiAyIH07XG4gIGZ1bmN0aW9uIF9pc0J1dHRvbkZvckxlZ2FjeUV2ZW50cyhldmVudCwgY29kZSkge1xuICAgIHJldHVybiBldmVudC5idXR0b24gPT09IGxlZ2FjeUJ1dHRvbk1hcFtjb2RlXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9pc0J1dHRvbkZvcldlYktpdChldmVudCwgY29kZSkge1xuICAgIHN3aXRjaCAoY29kZSkge1xuICAgICAgY2FzZSAwOiByZXR1cm4gZXZlbnQud2hpY2ggPT0gMSAmJiAhZXZlbnQubWV0YUtleTtcbiAgICAgIGNhc2UgMTogcmV0dXJuIGV2ZW50LndoaWNoID09IDIgfHwgKGV2ZW50LndoaWNoID09IDEgJiYgZXZlbnQubWV0YUtleSk7XG4gICAgICBjYXNlIDI6IHJldHVybiBldmVudC53aGljaCA9PSAzO1xuICAgICAgZGVmYXVsdDogcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGlmICh3aW5kb3cuYXR0YWNoRXZlbnQpIHtcbiAgICBpZiAoIXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7XG4gICAgICBfaXNCdXR0b24gPSBfaXNCdXR0b25Gb3JMZWdhY3lFdmVudHM7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9pc0J1dHRvbiA9IGZ1bmN0aW9uKGV2ZW50LCBjb2RlKSB7XG4gICAgICAgIHJldHVybiBpc0lFTGVnYWN5RXZlbnQoZXZlbnQpID8gX2lzQnV0dG9uRm9yTGVnYWN5RXZlbnRzKGV2ZW50LCBjb2RlKSA6XG4gICAgICAgICBfaXNCdXR0b25Gb3JET01FdmVudHMoZXZlbnQsIGNvZGUpO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIGlmIChQcm90b3R5cGUuQnJvd3Nlci5XZWJLaXQpIHtcbiAgICBfaXNCdXR0b24gPSBfaXNCdXR0b25Gb3JXZWJLaXQ7XG4gIH0gZWxzZSB7XG4gICAgX2lzQnV0dG9uID0gX2lzQnV0dG9uRm9yRE9NRXZlbnRzO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNMZWZ0Q2xpY2soZXZlbnQpICAgeyByZXR1cm4gX2lzQnV0dG9uKGV2ZW50LCAwKSB9XG5cbiAgZnVuY3Rpb24gaXNNaWRkbGVDbGljayhldmVudCkgeyByZXR1cm4gX2lzQnV0dG9uKGV2ZW50LCAxKSB9XG5cbiAgZnVuY3Rpb24gaXNSaWdodENsaWNrKGV2ZW50KSAgeyByZXR1cm4gX2lzQnV0dG9uKGV2ZW50LCAyKSB9XG5cbiAgZnVuY3Rpb24gZWxlbWVudChldmVudCkge1xuICAgIHJldHVybiBFbGVtZW50LmV4dGVuZChfZWxlbWVudChldmVudCkpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2VsZW1lbnQoZXZlbnQpIHtcbiAgICBldmVudCA9IEV2ZW50LmV4dGVuZChldmVudCk7XG5cbiAgICB2YXIgbm9kZSA9IGV2ZW50LnRhcmdldCwgdHlwZSA9IGV2ZW50LnR5cGUsXG4gICAgIGN1cnJlbnRUYXJnZXQgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuXG4gICAgaWYgKGN1cnJlbnRUYXJnZXQgJiYgY3VycmVudFRhcmdldC50YWdOYW1lKSB7XG4gICAgICBpZiAodHlwZSA9PT0gJ2xvYWQnIHx8IHR5cGUgPT09ICdlcnJvcicgfHxcbiAgICAgICAgKHR5cGUgPT09ICdjbGljaycgJiYgY3VycmVudFRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpbnB1dCdcbiAgICAgICAgICAmJiBjdXJyZW50VGFyZ2V0LnR5cGUgPT09ICdyYWRpbycpKVxuICAgICAgICAgICAgbm9kZSA9IGN1cnJlbnRUYXJnZXQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5vZGUubm9kZVR5cGUgPT0gTm9kZS5URVhUX05PREUgPyBub2RlLnBhcmVudE5vZGUgOiBub2RlO1xuICB9XG5cbiAgZnVuY3Rpb24gZmluZEVsZW1lbnQoZXZlbnQsIGV4cHJlc3Npb24pIHtcbiAgICB2YXIgZWxlbWVudCA9IF9lbGVtZW50KGV2ZW50KSwgc2VsZWN0b3IgPSBQcm90b3R5cGUuU2VsZWN0b3I7XG4gICAgaWYgKCFleHByZXNzaW9uKSByZXR1cm4gRWxlbWVudC5leHRlbmQoZWxlbWVudCk7XG4gICAgd2hpbGUgKGVsZW1lbnQpIHtcbiAgICAgIGlmIChPYmplY3QuaXNFbGVtZW50KGVsZW1lbnQpICYmIHNlbGVjdG9yLm1hdGNoKGVsZW1lbnQsIGV4cHJlc3Npb24pKVxuICAgICAgICByZXR1cm4gRWxlbWVudC5leHRlbmQoZWxlbWVudCk7XG4gICAgICBlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBvaW50ZXIoZXZlbnQpIHtcbiAgICByZXR1cm4geyB4OiBwb2ludGVyWChldmVudCksIHk6IHBvaW50ZXJZKGV2ZW50KSB9O1xuICB9XG5cbiAgZnVuY3Rpb24gcG9pbnRlclgoZXZlbnQpIHtcbiAgICB2YXIgZG9jRWxlbWVudCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxcbiAgICAgYm9keSA9IGRvY3VtZW50LmJvZHkgfHwgeyBzY3JvbGxMZWZ0OiAwIH07XG5cbiAgICByZXR1cm4gZXZlbnQucGFnZVggfHwgKGV2ZW50LmNsaWVudFggK1xuICAgICAgKGRvY0VsZW1lbnQuc2Nyb2xsTGVmdCB8fCBib2R5LnNjcm9sbExlZnQpIC1cbiAgICAgIChkb2NFbGVtZW50LmNsaWVudExlZnQgfHwgMCkpO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9pbnRlclkoZXZlbnQpIHtcbiAgICB2YXIgZG9jRWxlbWVudCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxcbiAgICAgYm9keSA9IGRvY3VtZW50LmJvZHkgfHwgeyBzY3JvbGxUb3A6IDAgfTtcblxuICAgIHJldHVybiAgZXZlbnQucGFnZVkgfHwgKGV2ZW50LmNsaWVudFkgK1xuICAgICAgIChkb2NFbGVtZW50LnNjcm9sbFRvcCB8fCBib2R5LnNjcm9sbFRvcCkgLVxuICAgICAgIChkb2NFbGVtZW50LmNsaWVudFRvcCB8fCAwKSk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHN0b3AoZXZlbnQpIHtcbiAgICBFdmVudC5leHRlbmQoZXZlbnQpO1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICBldmVudC5zdG9wcGVkID0gdHJ1ZTtcbiAgfVxuXG5cbiAgRXZlbnQuTWV0aG9kcyA9IHtcbiAgICBpc0xlZnRDbGljazogICBpc0xlZnRDbGljayxcbiAgICBpc01pZGRsZUNsaWNrOiBpc01pZGRsZUNsaWNrLFxuICAgIGlzUmlnaHRDbGljazogIGlzUmlnaHRDbGljayxcblxuICAgIGVsZW1lbnQ6ICAgICBlbGVtZW50LFxuICAgIGZpbmRFbGVtZW50OiBmaW5kRWxlbWVudCxcblxuICAgIHBvaW50ZXI6ICBwb2ludGVyLFxuICAgIHBvaW50ZXJYOiBwb2ludGVyWCxcbiAgICBwb2ludGVyWTogcG9pbnRlclksXG5cbiAgICBzdG9wOiBzdG9wXG4gIH07XG5cbiAgdmFyIG1ldGhvZHMgPSBPYmplY3Qua2V5cyhFdmVudC5NZXRob2RzKS5pbmplY3QoeyB9LCBmdW5jdGlvbihtLCBuYW1lKSB7XG4gICAgbVtuYW1lXSA9IEV2ZW50Lk1ldGhvZHNbbmFtZV0ubWV0aG9kaXplKCk7XG4gICAgcmV0dXJuIG07XG4gIH0pO1xuXG4gIGlmICh3aW5kb3cuYXR0YWNoRXZlbnQpIHtcbiAgICBmdW5jdGlvbiBfcmVsYXRlZFRhcmdldChldmVudCkge1xuICAgICAgdmFyIGVsZW1lbnQ7XG4gICAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHtcbiAgICAgICAgY2FzZSAnbW91c2VvdmVyJzpcbiAgICAgICAgY2FzZSAnbW91c2VlbnRlcic6XG4gICAgICAgICAgZWxlbWVudCA9IGV2ZW50LmZyb21FbGVtZW50O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdtb3VzZW91dCc6XG4gICAgICAgIGNhc2UgJ21vdXNlbGVhdmUnOlxuICAgICAgICAgIGVsZW1lbnQgPSBldmVudC50b0VsZW1lbnQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm4gRWxlbWVudC5leHRlbmQoZWxlbWVudCk7XG4gICAgfVxuXG4gICAgdmFyIGFkZGl0aW9uYWxNZXRob2RzID0ge1xuICAgICAgc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsgdGhpcy5jYW5jZWxCdWJibGUgPSB0cnVlIH0sXG4gICAgICBwcmV2ZW50RGVmYXVsdDogIGZ1bmN0aW9uKCkgeyB0aGlzLnJldHVyblZhbHVlID0gZmFsc2UgfSxcbiAgICAgIGluc3BlY3Q6IGZ1bmN0aW9uKCkgeyByZXR1cm4gJ1tvYmplY3QgRXZlbnRdJyB9XG4gICAgfTtcblxuICAgIEV2ZW50LmV4dGVuZCA9IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICBpZiAoIWV2ZW50KSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIGlmICghaXNJRUxlZ2FjeUV2ZW50KGV2ZW50KSkgcmV0dXJuIGV2ZW50O1xuXG4gICAgICBpZiAoZXZlbnQuX2V4dGVuZGVkQnlQcm90b3R5cGUpIHJldHVybiBldmVudDtcbiAgICAgIGV2ZW50Ll9leHRlbmRlZEJ5UHJvdG90eXBlID0gUHJvdG90eXBlLmVtcHR5RnVuY3Rpb247XG5cbiAgICAgIHZhciBwb2ludGVyID0gRXZlbnQucG9pbnRlcihldmVudCk7XG5cbiAgICAgIE9iamVjdC5leHRlbmQoZXZlbnQsIHtcbiAgICAgICAgdGFyZ2V0OiBldmVudC5zcmNFbGVtZW50IHx8IGVsZW1lbnQsXG4gICAgICAgIHJlbGF0ZWRUYXJnZXQ6IF9yZWxhdGVkVGFyZ2V0KGV2ZW50KSxcbiAgICAgICAgcGFnZVg6ICBwb2ludGVyLngsXG4gICAgICAgIHBhZ2VZOiAgcG9pbnRlci55XG4gICAgICB9KTtcblxuICAgICAgT2JqZWN0LmV4dGVuZChldmVudCwgbWV0aG9kcyk7XG4gICAgICBPYmplY3QuZXh0ZW5kKGV2ZW50LCBhZGRpdGlvbmFsTWV0aG9kcyk7XG5cbiAgICAgIHJldHVybiBldmVudDtcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIEV2ZW50LmV4dGVuZCA9IFByb3RvdHlwZS5LO1xuICB9XG5cbiAgaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7XG4gICAgRXZlbnQucHJvdG90eXBlID0gd2luZG93LkV2ZW50LnByb3RvdHlwZSB8fCBkb2N1bWVudC5jcmVhdGVFdmVudCgnSFRNTEV2ZW50cycpLl9fcHJvdG9fXztcbiAgICBPYmplY3QuZXh0ZW5kKEV2ZW50LnByb3RvdHlwZSwgbWV0aG9kcyk7XG4gIH1cblxuICB2YXIgRVZFTlRfVFJBTlNMQVRJT05TID0ge1xuICAgIG1vdXNlZW50ZXI6ICdtb3VzZW92ZXInLFxuICAgIG1vdXNlbGVhdmU6ICdtb3VzZW91dCdcbiAgfTtcblxuICBmdW5jdGlvbiBnZXRET01FdmVudE5hbWUoZXZlbnROYW1lKSB7XG4gICAgcmV0dXJuIEVWRU5UX1RSQU5TTEFUSU9OU1tldmVudE5hbWVdIHx8IGV2ZW50TmFtZTtcbiAgfVxuXG4gIGlmIChNT1VTRUVOVEVSX01PVVNFTEVBVkVfRVZFTlRTX1NVUFBPUlRFRClcbiAgICBnZXRET01FdmVudE5hbWUgPSBQcm90b3R5cGUuSztcblxuICBmdW5jdGlvbiBnZXRVbmlxdWVFbGVtZW50SUQoZWxlbWVudCkge1xuICAgIGlmIChlbGVtZW50ID09PSB3aW5kb3cpIHJldHVybiAwO1xuXG4gICAgaWYgKHR5cGVvZiBlbGVtZW50Ll9wcm90b3R5cGVVSUQgPT09ICd1bmRlZmluZWQnKVxuICAgICAgZWxlbWVudC5fcHJvdG90eXBlVUlEID0gRWxlbWVudC5TdG9yYWdlLlVJRCsrO1xuICAgIHJldHVybiBlbGVtZW50Ll9wcm90b3R5cGVVSUQ7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRVbmlxdWVFbGVtZW50SURfSUUoZWxlbWVudCkge1xuICAgIGlmIChlbGVtZW50ID09PSB3aW5kb3cpIHJldHVybiAwO1xuICAgIGlmIChlbGVtZW50ID09IGRvY3VtZW50KSByZXR1cm4gMTtcbiAgICByZXR1cm4gZWxlbWVudC51bmlxdWVJRDtcbiAgfVxuXG4gIGlmICgndW5pcXVlSUQnIGluIERJVilcbiAgICBnZXRVbmlxdWVFbGVtZW50SUQgPSBnZXRVbmlxdWVFbGVtZW50SURfSUU7XG5cbiAgZnVuY3Rpb24gaXNDdXN0b21FdmVudChldmVudE5hbWUpIHtcbiAgICByZXR1cm4gZXZlbnROYW1lLmluY2x1ZGUoJzonKTtcbiAgfVxuXG4gIEV2ZW50Ll9pc0N1c3RvbUV2ZW50ID0gaXNDdXN0b21FdmVudDtcblxuICBmdW5jdGlvbiBnZXRSZWdpc3RyeUZvckVsZW1lbnQoZWxlbWVudCwgdWlkKSB7XG4gICAgdmFyIENBQ0hFID0gR0xPQkFMLkV2ZW50LmNhY2hlO1xuICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQodWlkKSlcbiAgICAgIHVpZCA9IGdldFVuaXF1ZUVsZW1lbnRJRChlbGVtZW50KTtcbiAgICBpZiAoIUNBQ0hFW3VpZF0pIENBQ0hFW3VpZF0gPSB7IGVsZW1lbnQ6IGVsZW1lbnQgfTtcbiAgICByZXR1cm4gQ0FDSEVbdWlkXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlc3Ryb3lSZWdpc3RyeUZvckVsZW1lbnQoZWxlbWVudCwgdWlkKSB7XG4gICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZCh1aWQpKVxuICAgICAgdWlkID0gZ2V0VW5pcXVlRWxlbWVudElEKGVsZW1lbnQpO1xuICAgIGRlbGV0ZSBHTE9CQUwuRXZlbnQuY2FjaGVbdWlkXTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gcmVnaXN0ZXIoZWxlbWVudCwgZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgdmFyIHJlZ2lzdHJ5ID0gZ2V0UmVnaXN0cnlGb3JFbGVtZW50KGVsZW1lbnQpO1xuICAgIGlmICghcmVnaXN0cnlbZXZlbnROYW1lXSkgcmVnaXN0cnlbZXZlbnROYW1lXSA9IFtdO1xuICAgIHZhciBlbnRyaWVzID0gcmVnaXN0cnlbZXZlbnROYW1lXTtcblxuICAgIHZhciBpID0gZW50cmllcy5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSlcbiAgICAgIGlmIChlbnRyaWVzW2ldLmhhbmRsZXIgPT09IGhhbmRsZXIpIHJldHVybiBudWxsO1xuXG4gICAgdmFyIHVpZCA9IGdldFVuaXF1ZUVsZW1lbnRJRChlbGVtZW50KTtcbiAgICB2YXIgcmVzcG9uZGVyID0gR0xPQkFMLkV2ZW50Ll9jcmVhdGVSZXNwb25kZXIodWlkLCBldmVudE5hbWUsIGhhbmRsZXIpO1xuICAgIHZhciBlbnRyeSA9IHtcbiAgICAgIHJlc3BvbmRlcjogcmVzcG9uZGVyLFxuICAgICAgaGFuZGxlcjogICBoYW5kbGVyXG4gICAgfTtcblxuICAgIGVudHJpZXMucHVzaChlbnRyeSk7XG4gICAgcmV0dXJuIGVudHJ5O1xuICB9XG5cbiAgZnVuY3Rpb24gdW5yZWdpc3RlcihlbGVtZW50LCBldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgICB2YXIgcmVnaXN0cnkgPSBnZXRSZWdpc3RyeUZvckVsZW1lbnQoZWxlbWVudCk7XG4gICAgdmFyIGVudHJpZXMgPSByZWdpc3RyeVtldmVudE5hbWVdO1xuICAgIGlmICghZW50cmllcykgcmV0dXJuO1xuXG4gICAgdmFyIGkgPSBlbnRyaWVzLmxlbmd0aCwgZW50cnk7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgaWYgKGVudHJpZXNbaV0uaGFuZGxlciA9PT0gaGFuZGxlcikge1xuICAgICAgICBlbnRyeSA9IGVudHJpZXNbaV07XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghZW50cnkpIHJldHVybjtcblxuICAgIHZhciBpbmRleCA9IGVudHJpZXMuaW5kZXhPZihlbnRyeSk7XG4gICAgZW50cmllcy5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgcmV0dXJuIGVudHJ5O1xuICB9XG5cblxuICBmdW5jdGlvbiBvYnNlcnZlKGVsZW1lbnQsIGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBlbnRyeSA9IHJlZ2lzdGVyKGVsZW1lbnQsIGV2ZW50TmFtZSwgaGFuZGxlcik7XG5cbiAgICBpZiAoZW50cnkgPT09IG51bGwpIHJldHVybiBlbGVtZW50O1xuXG4gICAgdmFyIHJlc3BvbmRlciA9IGVudHJ5LnJlc3BvbmRlcjtcbiAgICBpZiAoaXNDdXN0b21FdmVudChldmVudE5hbWUpKVxuICAgICAgb2JzZXJ2ZUN1c3RvbUV2ZW50KGVsZW1lbnQsIGV2ZW50TmFtZSwgcmVzcG9uZGVyKTtcbiAgICBlbHNlXG4gICAgICBvYnNlcnZlU3RhbmRhcmRFdmVudChlbGVtZW50LCBldmVudE5hbWUsIHJlc3BvbmRlcik7XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9ic2VydmVTdGFuZGFyZEV2ZW50KGVsZW1lbnQsIGV2ZW50TmFtZSwgcmVzcG9uZGVyKSB7XG4gICAgdmFyIGFjdHVhbEV2ZW50TmFtZSA9IGdldERPTUV2ZW50TmFtZShldmVudE5hbWUpO1xuICAgIGlmIChlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihhY3R1YWxFdmVudE5hbWUsIHJlc3BvbmRlciwgZmFsc2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtZW50LmF0dGFjaEV2ZW50KCdvbicgKyBhY3R1YWxFdmVudE5hbWUsIHJlc3BvbmRlcik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gb2JzZXJ2ZUN1c3RvbUV2ZW50KGVsZW1lbnQsIGV2ZW50TmFtZSwgcmVzcG9uZGVyKSB7XG4gICAgaWYgKGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkYXRhYXZhaWxhYmxlJywgcmVzcG9uZGVyLCBmYWxzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVsZW1lbnQuYXR0YWNoRXZlbnQoJ29uZGF0YWF2YWlsYWJsZScsIHJlc3BvbmRlcik7XG4gICAgICBlbGVtZW50LmF0dGFjaEV2ZW50KCdvbmxvc2VjYXB0dXJlJywgICByZXNwb25kZXIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3BPYnNlcnZpbmcoZWxlbWVudCwgZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgdmFyIGhhbmRsZXJHaXZlbiA9ICFPYmplY3QuaXNVbmRlZmluZWQoaGFuZGxlciksXG4gICAgIGV2ZW50TmFtZUdpdmVuID0gIU9iamVjdC5pc1VuZGVmaW5lZChldmVudE5hbWUpO1xuXG4gICAgaWYgKCFldmVudE5hbWVHaXZlbiAmJiAhaGFuZGxlckdpdmVuKSB7XG4gICAgICBzdG9wT2JzZXJ2aW5nRWxlbWVudChlbGVtZW50KTtcbiAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH1cblxuICAgIGlmICghaGFuZGxlckdpdmVuKSB7XG4gICAgICBzdG9wT2JzZXJ2aW5nRXZlbnROYW1lKGVsZW1lbnQsIGV2ZW50TmFtZSk7XG4gICAgICByZXR1cm4gZWxlbWVudDtcbiAgICB9XG5cbiAgICB2YXIgZW50cnkgPSB1bnJlZ2lzdGVyKGVsZW1lbnQsIGV2ZW50TmFtZSwgaGFuZGxlcik7XG5cbiAgICBpZiAoIWVudHJ5KSByZXR1cm4gZWxlbWVudDtcbiAgICByZW1vdmVFdmVudChlbGVtZW50LCBldmVudE5hbWUsIGVudHJ5LnJlc3BvbmRlcik7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wT2JzZXJ2aW5nU3RhbmRhcmRFdmVudChlbGVtZW50LCBldmVudE5hbWUsIHJlc3BvbmRlcikge1xuICAgIHZhciBhY3R1YWxFdmVudE5hbWUgPSBnZXRET01FdmVudE5hbWUoZXZlbnROYW1lKTtcbiAgICBpZiAoZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKSB7XG4gICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoYWN0dWFsRXZlbnROYW1lLCByZXNwb25kZXIsIGZhbHNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbWVudC5kZXRhY2hFdmVudCgnb24nICsgYWN0dWFsRXZlbnROYW1lLCByZXNwb25kZXIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3BPYnNlcnZpbmdDdXN0b21FdmVudChlbGVtZW50LCBldmVudE5hbWUsIHJlc3BvbmRlcikge1xuICAgIGlmIChlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIpIHtcbiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZGF0YWF2YWlsYWJsZScsIHJlc3BvbmRlciwgZmFsc2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtZW50LmRldGFjaEV2ZW50KCdvbmRhdGFhdmFpbGFibGUnLCByZXNwb25kZXIpO1xuICAgICAgZWxlbWVudC5kZXRhY2hFdmVudCgnb25sb3NlY2FwdHVyZScsICAgcmVzcG9uZGVyKTtcbiAgICB9XG4gIH1cblxuXG5cbiAgZnVuY3Rpb24gc3RvcE9ic2VydmluZ0VsZW1lbnQoZWxlbWVudCkge1xuICAgIHZhciB1aWQgPSBnZXRVbmlxdWVFbGVtZW50SUQoZWxlbWVudCksIHJlZ2lzdHJ5ID0gR0xPQkFMLkV2ZW50LmNhY2hlW3VpZF07XG4gICAgaWYgKCFyZWdpc3RyeSkgcmV0dXJuO1xuXG4gICAgZGVzdHJveVJlZ2lzdHJ5Rm9yRWxlbWVudChlbGVtZW50LCB1aWQpO1xuXG4gICAgdmFyIGVudHJpZXMsIGk7XG4gICAgZm9yICh2YXIgZXZlbnROYW1lIGluIHJlZ2lzdHJ5KSB7XG4gICAgICBpZiAoZXZlbnROYW1lID09PSAnZWxlbWVudCcpIGNvbnRpbnVlO1xuXG4gICAgICBlbnRyaWVzID0gcmVnaXN0cnlbZXZlbnROYW1lXTtcbiAgICAgIGkgPSBlbnRyaWVzLmxlbmd0aDtcbiAgICAgIHdoaWxlIChpLS0pXG4gICAgICAgIHJlbW92ZUV2ZW50KGVsZW1lbnQsIGV2ZW50TmFtZSwgZW50cmllc1tpXS5yZXNwb25kZXIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3BPYnNlcnZpbmdFdmVudE5hbWUoZWxlbWVudCwgZXZlbnROYW1lKSB7XG4gICAgdmFyIHJlZ2lzdHJ5ID0gZ2V0UmVnaXN0cnlGb3JFbGVtZW50KGVsZW1lbnQpO1xuICAgIHZhciBlbnRyaWVzID0gcmVnaXN0cnlbZXZlbnROYW1lXTtcbiAgICBpZiAoIWVudHJpZXMpIHJldHVybjtcbiAgICBkZWxldGUgcmVnaXN0cnlbZXZlbnROYW1lXTtcblxuICAgIHZhciBpID0gZW50cmllcy5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSlcbiAgICAgIHJlbW92ZUV2ZW50KGVsZW1lbnQsIGV2ZW50TmFtZSwgZW50cmllc1tpXS5yZXNwb25kZXIpO1xuICB9XG5cblxuICBmdW5jdGlvbiByZW1vdmVFdmVudChlbGVtZW50LCBldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgICBpZiAoaXNDdXN0b21FdmVudChldmVudE5hbWUpKVxuICAgICAgc3RvcE9ic2VydmluZ0N1c3RvbUV2ZW50KGVsZW1lbnQsIGV2ZW50TmFtZSwgaGFuZGxlcik7XG4gICAgZWxzZVxuICAgICAgc3RvcE9ic2VydmluZ1N0YW5kYXJkRXZlbnQoZWxlbWVudCwgZXZlbnROYW1lLCBoYW5kbGVyKTtcbiAgfVxuXG5cblxuICBmdW5jdGlvbiBnZXRGaXJlVGFyZ2V0KGVsZW1lbnQpIHtcbiAgICBpZiAoZWxlbWVudCAhPT0gZG9jdW1lbnQpIHJldHVybiBlbGVtZW50O1xuICAgIGlmIChkb2N1bWVudC5jcmVhdGVFdmVudCAmJiAhZWxlbWVudC5kaXNwYXRjaEV2ZW50KVxuICAgICAgcmV0dXJuIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpcmUoZWxlbWVudCwgZXZlbnROYW1lLCBtZW1vLCBidWJibGUpIHtcbiAgICBlbGVtZW50ID0gZ2V0RmlyZVRhcmdldCgkKGVsZW1lbnQpKTtcbiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKGJ1YmJsZSkpIGJ1YmJsZSA9IHRydWU7XG4gICAgbWVtbyA9IG1lbW8gfHwge307XG5cbiAgICB2YXIgZXZlbnQgPSBmaXJlRXZlbnQoZWxlbWVudCwgZXZlbnROYW1lLCBtZW1vLCBidWJibGUpO1xuICAgIHJldHVybiBFdmVudC5leHRlbmQoZXZlbnQpO1xuICB9XG5cbiAgZnVuY3Rpb24gZmlyZUV2ZW50X0RPTShlbGVtZW50LCBldmVudE5hbWUsIG1lbW8sIGJ1YmJsZSkge1xuICAgIHZhciBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdIVE1MRXZlbnRzJyk7XG4gICAgZXZlbnQuaW5pdEV2ZW50KCdkYXRhYXZhaWxhYmxlJywgYnViYmxlLCB0cnVlKTtcblxuICAgIGV2ZW50LmV2ZW50TmFtZSA9IGV2ZW50TmFtZTtcbiAgICBldmVudC5tZW1vID0gbWVtbztcblxuICAgIGVsZW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgcmV0dXJuIGV2ZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gZmlyZUV2ZW50X0lFKGVsZW1lbnQsIGV2ZW50TmFtZSwgbWVtbywgYnViYmxlKSB7XG4gICAgdmFyIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnRPYmplY3QoKTtcbiAgICBldmVudC5ldmVudFR5cGUgPSBidWJibGUgPyAnb25kYXRhYXZhaWxhYmxlJyA6ICdvbmxvc2VjYXB0dXJlJztcblxuICAgIGV2ZW50LmV2ZW50TmFtZSA9IGV2ZW50TmFtZTtcbiAgICBldmVudC5tZW1vID0gbWVtbztcblxuICAgIGVsZW1lbnQuZmlyZUV2ZW50KGV2ZW50LmV2ZW50VHlwZSwgZXZlbnQpO1xuICAgIHJldHVybiBldmVudDtcbiAgfVxuXG4gIHZhciBmaXJlRXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCA/IGZpcmVFdmVudF9ET00gOiBmaXJlRXZlbnRfSUU7XG5cblxuXG4gIEV2ZW50LkhhbmRsZXIgPSBDbGFzcy5jcmVhdGUoe1xuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGVsZW1lbnQsIGV2ZW50TmFtZSwgc2VsZWN0b3IsIGNhbGxiYWNrKSB7XG4gICAgICB0aGlzLmVsZW1lbnQgICA9ICQoZWxlbWVudCk7XG4gICAgICB0aGlzLmV2ZW50TmFtZSA9IGV2ZW50TmFtZTtcbiAgICAgIHRoaXMuc2VsZWN0b3IgID0gc2VsZWN0b3I7XG4gICAgICB0aGlzLmNhbGxiYWNrICA9IGNhbGxiYWNrO1xuICAgICAgdGhpcy5oYW5kbGVyICAgPSB0aGlzLmhhbmRsZUV2ZW50LmJpbmQodGhpcyk7XG4gICAgfSxcblxuXG4gICAgc3RhcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgRXZlbnQub2JzZXJ2ZSh0aGlzLmVsZW1lbnQsIHRoaXMuZXZlbnROYW1lLCB0aGlzLmhhbmRsZXIpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHN0b3A6IGZ1bmN0aW9uKCkge1xuICAgICAgRXZlbnQuc3RvcE9ic2VydmluZyh0aGlzLmVsZW1lbnQsIHRoaXMuZXZlbnROYW1lLCB0aGlzLmhhbmRsZXIpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGhhbmRsZUV2ZW50OiBmdW5jdGlvbihldmVudCkge1xuICAgICAgdmFyIGVsZW1lbnQgPSBFdmVudC5maW5kRWxlbWVudChldmVudCwgdGhpcy5zZWxlY3Rvcik7XG4gICAgICBpZiAoZWxlbWVudCkgdGhpcy5jYWxsYmFjay5jYWxsKHRoaXMuZWxlbWVudCwgZXZlbnQsIGVsZW1lbnQpO1xuICAgIH1cbiAgfSk7XG5cbiAgZnVuY3Rpb24gb24oZWxlbWVudCwgZXZlbnROYW1lLCBzZWxlY3RvciwgY2FsbGJhY2spIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICBpZiAoT2JqZWN0LmlzRnVuY3Rpb24oc2VsZWN0b3IpICYmIE9iamVjdC5pc1VuZGVmaW5lZChjYWxsYmFjaykpIHtcbiAgICAgIGNhbGxiYWNrID0gc2VsZWN0b3IsIHNlbGVjdG9yID0gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IEV2ZW50LkhhbmRsZXIoZWxlbWVudCwgZXZlbnROYW1lLCBzZWxlY3RvciwgY2FsbGJhY2spLnN0YXJ0KCk7XG4gIH1cblxuICBPYmplY3QuZXh0ZW5kKEV2ZW50LCBFdmVudC5NZXRob2RzKTtcblxuICBPYmplY3QuZXh0ZW5kKEV2ZW50LCB7XG4gICAgZmlyZTogICAgICAgICAgZmlyZSxcbiAgICBvYnNlcnZlOiAgICAgICBvYnNlcnZlLFxuICAgIHN0b3BPYnNlcnZpbmc6IHN0b3BPYnNlcnZpbmcsXG4gICAgb246ICAgICAgICAgICAgb25cbiAgfSk7XG5cbiAgRWxlbWVudC5hZGRNZXRob2RzKHtcbiAgICBmaXJlOiAgICAgICAgICBmaXJlLFxuXG4gICAgb2JzZXJ2ZTogICAgICAgb2JzZXJ2ZSxcblxuICAgIHN0b3BPYnNlcnZpbmc6IHN0b3BPYnNlcnZpbmcsXG5cbiAgICBvbjogICAgICAgICAgICBvblxuICB9KTtcblxuICBPYmplY3QuZXh0ZW5kKGRvY3VtZW50LCB7XG4gICAgZmlyZTogICAgICAgICAgZmlyZS5tZXRob2RpemUoKSxcblxuICAgIG9ic2VydmU6ICAgICAgIG9ic2VydmUubWV0aG9kaXplKCksXG5cbiAgICBzdG9wT2JzZXJ2aW5nOiBzdG9wT2JzZXJ2aW5nLm1ldGhvZGl6ZSgpLFxuXG4gICAgb246ICAgICAgICAgICAgb24ubWV0aG9kaXplKCksXG5cbiAgICBsb2FkZWQ6ICAgICAgICBmYWxzZVxuICB9KTtcblxuICBpZiAoR0xPQkFMLkV2ZW50KSBPYmplY3QuZXh0ZW5kKHdpbmRvdy5FdmVudCwgRXZlbnQpO1xuICBlbHNlIEdMT0JBTC5FdmVudCA9IEV2ZW50O1xuXG4gIEdMT0JBTC5FdmVudC5jYWNoZSA9IHt9O1xuXG4gIGZ1bmN0aW9uIGRlc3Ryb3lDYWNoZV9JRSgpIHtcbiAgICBHTE9CQUwuRXZlbnQuY2FjaGUgPSBudWxsO1xuICB9XG5cbiAgaWYgKHdpbmRvdy5hdHRhY2hFdmVudClcbiAgICB3aW5kb3cuYXR0YWNoRXZlbnQoJ29udW5sb2FkJywgZGVzdHJveUNhY2hlX0lFKTtcblxuICBESVYgPSBudWxsO1xuICBkb2NFbCA9IG51bGw7XG59KSh0aGlzKTtcblxuKGZ1bmN0aW9uKEdMT0JBTCkge1xuICAvKiBDb2RlIGZvciBjcmVhdGluZyBsZWFrLWZyZWUgZXZlbnQgcmVzcG9uZGVycyBpcyBiYXNlZCBvbiB3b3JrIGJ5XG4gICBKb2huLURhdmlkIERhbHRvbi4gKi9cblxuICB2YXIgZG9jRWwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gIHZhciBNT1VTRUVOVEVSX01PVVNFTEVBVkVfRVZFTlRTX1NVUFBPUlRFRCA9ICdvbm1vdXNlZW50ZXInIGluIGRvY0VsXG4gICAgJiYgJ29ubW91c2VsZWF2ZScgaW4gZG9jRWw7XG5cbiAgZnVuY3Rpb24gaXNTaW11bGF0ZWRNb3VzZUVudGVyTGVhdmVFdmVudChldmVudE5hbWUpIHtcbiAgICByZXR1cm4gIU1PVVNFRU5URVJfTU9VU0VMRUFWRV9FVkVOVFNfU1VQUE9SVEVEICYmXG4gICAgIChldmVudE5hbWUgPT09ICdtb3VzZWVudGVyJyB8fCBldmVudE5hbWUgPT09ICdtb3VzZWxlYXZlJyk7XG4gIH1cblxuICBmdW5jdGlvbiBjcmVhdGVSZXNwb25kZXIodWlkLCBldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgICBpZiAoRXZlbnQuX2lzQ3VzdG9tRXZlbnQoZXZlbnROYW1lKSlcbiAgICAgIHJldHVybiBjcmVhdGVSZXNwb25kZXJGb3JDdXN0b21FdmVudCh1aWQsIGV2ZW50TmFtZSwgaGFuZGxlcik7XG4gICAgaWYgKGlzU2ltdWxhdGVkTW91c2VFbnRlckxlYXZlRXZlbnQoZXZlbnROYW1lKSlcbiAgICAgIHJldHVybiBjcmVhdGVNb3VzZUVudGVyTGVhdmVSZXNwb25kZXIodWlkLCBldmVudE5hbWUsIGhhbmRsZXIpO1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBpZiAoIUV2ZW50LmNhY2hlKSByZXR1cm47XG5cbiAgICAgIHZhciBlbGVtZW50ID0gRXZlbnQuY2FjaGVbdWlkXS5lbGVtZW50O1xuICAgICAgRXZlbnQuZXh0ZW5kKGV2ZW50LCBlbGVtZW50KTtcbiAgICAgIGhhbmRsZXIuY2FsbChlbGVtZW50LCBldmVudCk7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNyZWF0ZVJlc3BvbmRlckZvckN1c3RvbUV2ZW50KHVpZCwgZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICB2YXIgZWxlbWVudCA9IEV2ZW50LmNhY2hlW3VpZF0uZWxlbWVudDtcblxuICAgICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZChldmVudC5ldmVudE5hbWUpKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgIGlmIChldmVudC5ldmVudE5hbWUgIT09IGV2ZW50TmFtZSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICBFdmVudC5leHRlbmQoZXZlbnQsIGVsZW1lbnQpO1xuICAgICAgaGFuZGxlci5jYWxsKGVsZW1lbnQsIGV2ZW50KTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlTW91c2VFbnRlckxlYXZlUmVzcG9uZGVyKHVpZCwgZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICB2YXIgZWxlbWVudCA9IEV2ZW50LmNhY2hlW3VpZF0uZWxlbWVudDtcblxuICAgICAgRXZlbnQuZXh0ZW5kKGV2ZW50LCBlbGVtZW50KTtcbiAgICAgIHZhciBwYXJlbnQgPSBldmVudC5yZWxhdGVkVGFyZ2V0O1xuXG4gICAgICB3aGlsZSAocGFyZW50ICYmIHBhcmVudCAhPT0gZWxlbWVudCkge1xuICAgICAgICB0cnkgeyBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTsgfVxuICAgICAgICBjYXRjaChlKSB7IHBhcmVudCA9IGVsZW1lbnQ7IH1cbiAgICAgIH1cblxuICAgICAgaWYgKHBhcmVudCA9PT0gZWxlbWVudCkgcmV0dXJuO1xuICAgICAgaGFuZGxlci5jYWxsKGVsZW1lbnQsIGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBHTE9CQUwuRXZlbnQuX2NyZWF0ZVJlc3BvbmRlciA9IGNyZWF0ZVJlc3BvbmRlcjtcbiAgZG9jRWwgPSBudWxsO1xufSkodGhpcyk7XG5cbihmdW5jdGlvbihHTE9CQUwpIHtcbiAgLyogU3VwcG9ydCBmb3IgdGhlIERPTUNvbnRlbnRMb2FkZWQgZXZlbnQgaXMgYmFzZWQgb24gd29yayBieSBEYW4gV2ViYixcbiAgICAgTWF0dGhpYXMgTWlsbGVyLCBEZWFuIEVkd2FyZHMsIEpvaG4gUmVzaWcsIGFuZCBEaWVnbyBQZXJpbmkuICovXG5cbiAgdmFyIFRJTUVSO1xuXG4gIGZ1bmN0aW9uIGZpcmVDb250ZW50TG9hZGVkRXZlbnQoKSB7XG4gICAgaWYgKGRvY3VtZW50LmxvYWRlZCkgcmV0dXJuO1xuICAgIGlmIChUSU1FUikgd2luZG93LmNsZWFyVGltZW91dChUSU1FUik7XG4gICAgZG9jdW1lbnQubG9hZGVkID0gdHJ1ZTtcbiAgICBkb2N1bWVudC5maXJlKCdkb206bG9hZGVkJyk7XG4gIH1cblxuICBmdW5jdGlvbiBjaGVja1JlYWR5U3RhdGUoKSB7XG4gICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHtcbiAgICAgIGRvY3VtZW50LmRldGFjaEV2ZW50KCdvbnJlYWR5c3RhdGVjaGFuZ2UnLCBjaGVja1JlYWR5U3RhdGUpO1xuICAgICAgZmlyZUNvbnRlbnRMb2FkZWRFdmVudCgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBvbGxEb1Njcm9sbCgpIHtcbiAgICB0cnkge1xuICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKCdsZWZ0Jyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgVElNRVIgPSBwb2xsRG9TY3JvbGwuZGVmZXIoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBmaXJlQ29udGVudExvYWRlZEV2ZW50KCk7XG4gIH1cblxuXG4gIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSB7XG4gICAgZmlyZUNvbnRlbnRMb2FkZWRFdmVudCgpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZpcmVDb250ZW50TG9hZGVkRXZlbnQsIGZhbHNlKTtcbiAgfSBlbHNlIHtcbiAgICBkb2N1bWVudC5hdHRhY2hFdmVudCgnb25yZWFkeXN0YXRlY2hhbmdlJywgY2hlY2tSZWFkeVN0YXRlKTtcbiAgICBpZiAod2luZG93ID09IHRvcCkgVElNRVIgPSBwb2xsRG9TY3JvbGwuZGVmZXIoKTtcbiAgfVxuXG4gIEV2ZW50Lm9ic2VydmUod2luZG93LCAnbG9hZCcsIGZpcmVDb250ZW50TG9hZGVkRXZlbnQpO1xufSkodGhpcyk7XG5cblxuRWxlbWVudC5hZGRNZXRob2RzKCk7XG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gREVQUkVDQVRFRCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuSGFzaC50b1F1ZXJ5U3RyaW5nID0gT2JqZWN0LnRvUXVlcnlTdHJpbmc7XG5cbnZhciBUb2dnbGUgPSB7IGRpc3BsYXk6IEVsZW1lbnQudG9nZ2xlIH07XG5cbkVsZW1lbnQuTWV0aG9kcy5jaGlsZE9mID0gRWxlbWVudC5NZXRob2RzLmRlc2NlbmRhbnRPZjtcblxudmFyIEluc2VydGlvbiA9IHtcbiAgQmVmb3JlOiBmdW5jdGlvbihlbGVtZW50LCBjb250ZW50KSB7XG4gICAgcmV0dXJuIEVsZW1lbnQuaW5zZXJ0KGVsZW1lbnQsIHtiZWZvcmU6Y29udGVudH0pO1xuICB9LFxuXG4gIFRvcDogZnVuY3Rpb24oZWxlbWVudCwgY29udGVudCkge1xuICAgIHJldHVybiBFbGVtZW50Lmluc2VydChlbGVtZW50LCB7dG9wOmNvbnRlbnR9KTtcbiAgfSxcblxuICBCb3R0b206IGZ1bmN0aW9uKGVsZW1lbnQsIGNvbnRlbnQpIHtcbiAgICByZXR1cm4gRWxlbWVudC5pbnNlcnQoZWxlbWVudCwge2JvdHRvbTpjb250ZW50fSk7XG4gIH0sXG5cbiAgQWZ0ZXI6IGZ1bmN0aW9uKGVsZW1lbnQsIGNvbnRlbnQpIHtcbiAgICByZXR1cm4gRWxlbWVudC5pbnNlcnQoZWxlbWVudCwge2FmdGVyOmNvbnRlbnR9KTtcbiAgfVxufTtcblxudmFyICRjb250aW51ZSA9IG5ldyBFcnJvcignXCJ0aHJvdyAkY29udGludWVcIiBpcyBkZXByZWNhdGVkLCB1c2UgXCJyZXR1cm5cIiBpbnN0ZWFkJyk7XG5cbnZhciBQb3NpdGlvbiA9IHtcbiAgaW5jbHVkZVNjcm9sbE9mZnNldHM6IGZhbHNlLFxuXG4gIHByZXBhcmU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZGVsdGFYID0gIHdpbmRvdy5wYWdlWE9mZnNldFxuICAgICAgICAgICAgICAgIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0XG4gICAgICAgICAgICAgICAgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0XG4gICAgICAgICAgICAgICAgfHwgMDtcbiAgICB0aGlzLmRlbHRhWSA9ICB3aW5kb3cucGFnZVlPZmZzZXRcbiAgICAgICAgICAgICAgICB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wXG4gICAgICAgICAgICAgICAgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3BcbiAgICAgICAgICAgICAgICB8fCAwO1xuICB9LFxuXG4gIHdpdGhpbjogZnVuY3Rpb24oZWxlbWVudCwgeCwgeSkge1xuICAgIGlmICh0aGlzLmluY2x1ZGVTY3JvbGxPZmZzZXRzKVxuICAgICAgcmV0dXJuIHRoaXMud2l0aGluSW5jbHVkaW5nU2Nyb2xsb2Zmc2V0cyhlbGVtZW50LCB4LCB5KTtcbiAgICB0aGlzLnhjb21wID0geDtcbiAgICB0aGlzLnljb21wID0geTtcbiAgICB0aGlzLm9mZnNldCA9IEVsZW1lbnQuY3VtdWxhdGl2ZU9mZnNldChlbGVtZW50KTtcblxuICAgIHJldHVybiAoeSA+PSB0aGlzLm9mZnNldFsxXSAmJlxuICAgICAgICAgICAgeSA8ICB0aGlzLm9mZnNldFsxXSArIGVsZW1lbnQub2Zmc2V0SGVpZ2h0ICYmXG4gICAgICAgICAgICB4ID49IHRoaXMub2Zmc2V0WzBdICYmXG4gICAgICAgICAgICB4IDwgIHRoaXMub2Zmc2V0WzBdICsgZWxlbWVudC5vZmZzZXRXaWR0aCk7XG4gIH0sXG5cbiAgd2l0aGluSW5jbHVkaW5nU2Nyb2xsb2Zmc2V0czogZnVuY3Rpb24oZWxlbWVudCwgeCwgeSkge1xuICAgIHZhciBvZmZzZXRjYWNoZSA9IEVsZW1lbnQuY3VtdWxhdGl2ZVNjcm9sbE9mZnNldChlbGVtZW50KTtcblxuICAgIHRoaXMueGNvbXAgPSB4ICsgb2Zmc2V0Y2FjaGVbMF0gLSB0aGlzLmRlbHRhWDtcbiAgICB0aGlzLnljb21wID0geSArIG9mZnNldGNhY2hlWzFdIC0gdGhpcy5kZWx0YVk7XG4gICAgdGhpcy5vZmZzZXQgPSBFbGVtZW50LmN1bXVsYXRpdmVPZmZzZXQoZWxlbWVudCk7XG5cbiAgICByZXR1cm4gKHRoaXMueWNvbXAgPj0gdGhpcy5vZmZzZXRbMV0gJiZcbiAgICAgICAgICAgIHRoaXMueWNvbXAgPCAgdGhpcy5vZmZzZXRbMV0gKyBlbGVtZW50Lm9mZnNldEhlaWdodCAmJlxuICAgICAgICAgICAgdGhpcy54Y29tcCA+PSB0aGlzLm9mZnNldFswXSAmJlxuICAgICAgICAgICAgdGhpcy54Y29tcCA8ICB0aGlzLm9mZnNldFswXSArIGVsZW1lbnQub2Zmc2V0V2lkdGgpO1xuICB9LFxuXG4gIG92ZXJsYXA6IGZ1bmN0aW9uKG1vZGUsIGVsZW1lbnQpIHtcbiAgICBpZiAoIW1vZGUpIHJldHVybiAwO1xuICAgIGlmIChtb2RlID09ICd2ZXJ0aWNhbCcpXG4gICAgICByZXR1cm4gKCh0aGlzLm9mZnNldFsxXSArIGVsZW1lbnQub2Zmc2V0SGVpZ2h0KSAtIHRoaXMueWNvbXApIC9cbiAgICAgICAgZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgaWYgKG1vZGUgPT0gJ2hvcml6b250YWwnKVxuICAgICAgcmV0dXJuICgodGhpcy5vZmZzZXRbMF0gKyBlbGVtZW50Lm9mZnNldFdpZHRoKSAtIHRoaXMueGNvbXApIC9cbiAgICAgICAgZWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgfSxcblxuXG4gIGN1bXVsYXRpdmVPZmZzZXQ6IEVsZW1lbnQuTWV0aG9kcy5jdW11bGF0aXZlT2Zmc2V0LFxuXG4gIHBvc2l0aW9uZWRPZmZzZXQ6IEVsZW1lbnQuTWV0aG9kcy5wb3NpdGlvbmVkT2Zmc2V0LFxuXG4gIGFic29sdXRpemU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICBQb3NpdGlvbi5wcmVwYXJlKCk7XG4gICAgcmV0dXJuIEVsZW1lbnQuYWJzb2x1dGl6ZShlbGVtZW50KTtcbiAgfSxcblxuICByZWxhdGl2aXplOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgUG9zaXRpb24ucHJlcGFyZSgpO1xuICAgIHJldHVybiBFbGVtZW50LnJlbGF0aXZpemUoZWxlbWVudCk7XG4gIH0sXG5cbiAgcmVhbE9mZnNldDogRWxlbWVudC5NZXRob2RzLmN1bXVsYXRpdmVTY3JvbGxPZmZzZXQsXG5cbiAgb2Zmc2V0UGFyZW50OiBFbGVtZW50Lk1ldGhvZHMuZ2V0T2Zmc2V0UGFyZW50LFxuXG4gIHBhZ2U6IEVsZW1lbnQuTWV0aG9kcy52aWV3cG9ydE9mZnNldCxcblxuICBjbG9uZTogZnVuY3Rpb24oc291cmNlLCB0YXJnZXQsIG9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7IH07XG4gICAgcmV0dXJuIEVsZW1lbnQuY2xvbmVQb3NpdGlvbih0YXJnZXQsIHNvdXJjZSwgb3B0aW9ucyk7XG4gIH1cbn07XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5pZiAoIWRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUpIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgPSBmdW5jdGlvbihpbnN0YW5jZU1ldGhvZHMpe1xuICBmdW5jdGlvbiBpdGVyKG5hbWUpIHtcbiAgICByZXR1cm4gbmFtZS5ibGFuaygpID8gbnVsbCA6IFwiW2NvbnRhaW5zKGNvbmNhdCgnICcsIEBjbGFzcywgJyAnKSwgJyBcIiArIG5hbWUgKyBcIiAnKV1cIjtcbiAgfVxuXG4gIGluc3RhbmNlTWV0aG9kcy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lID0gUHJvdG90eXBlLkJyb3dzZXJGZWF0dXJlcy5YUGF0aCA/XG4gIGZ1bmN0aW9uKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZS50b1N0cmluZygpLnN0cmlwKCk7XG4gICAgdmFyIGNvbmQgPSAvXFxzLy50ZXN0KGNsYXNzTmFtZSkgPyAkdyhjbGFzc05hbWUpLm1hcChpdGVyKS5qb2luKCcnKSA6IGl0ZXIoY2xhc3NOYW1lKTtcbiAgICByZXR1cm4gY29uZCA/IGRvY3VtZW50Ll9nZXRFbGVtZW50c0J5WFBhdGgoJy4vLyonICsgY29uZCwgZWxlbWVudCkgOiBbXTtcbiAgfSA6IGZ1bmN0aW9uKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZS50b1N0cmluZygpLnN0cmlwKCk7XG4gICAgdmFyIGVsZW1lbnRzID0gW10sIGNsYXNzTmFtZXMgPSAoL1xccy8udGVzdChjbGFzc05hbWUpID8gJHcoY2xhc3NOYW1lKSA6IG51bGwpO1xuICAgIGlmICghY2xhc3NOYW1lcyAmJiAhY2xhc3NOYW1lKSByZXR1cm4gZWxlbWVudHM7XG5cbiAgICB2YXIgbm9kZXMgPSAkKGVsZW1lbnQpLmdldEVsZW1lbnRzQnlUYWdOYW1lKCcqJyk7XG4gICAgY2xhc3NOYW1lID0gJyAnICsgY2xhc3NOYW1lICsgJyAnO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGNoaWxkLCBjbjsgY2hpbGQgPSBub2Rlc1tpXTsgaSsrKSB7XG4gICAgICBpZiAoY2hpbGQuY2xhc3NOYW1lICYmIChjbiA9ICcgJyArIGNoaWxkLmNsYXNzTmFtZSArICcgJykgJiYgKGNuLmluY2x1ZGUoY2xhc3NOYW1lKSB8fFxuICAgICAgICAgIChjbGFzc05hbWVzICYmIGNsYXNzTmFtZXMuYWxsKGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiAhbmFtZS50b1N0cmluZygpLmJsYW5rKCkgJiYgY24uaW5jbHVkZSgnICcgKyBuYW1lICsgJyAnKTtcbiAgICAgICAgICB9KSkpKVxuICAgICAgICBlbGVtZW50cy5wdXNoKEVsZW1lbnQuZXh0ZW5kKGNoaWxkKSk7XG4gICAgfVxuICAgIHJldHVybiBlbGVtZW50cztcbiAgfTtcblxuICByZXR1cm4gZnVuY3Rpb24oY2xhc3NOYW1lLCBwYXJlbnRFbGVtZW50KSB7XG4gICAgcmV0dXJuICQocGFyZW50RWxlbWVudCB8fCBkb2N1bWVudC5ib2R5KS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSk7XG4gIH07XG59KEVsZW1lbnQuTWV0aG9kcyk7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5FbGVtZW50LkNsYXNzTmFtZXMgPSBDbGFzcy5jcmVhdGUoKTtcbkVsZW1lbnQuQ2xhc3NOYW1lcy5wcm90b3R5cGUgPSB7XG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICB0aGlzLmVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICB9LFxuXG4gIF9lYWNoOiBmdW5jdGlvbihpdGVyYXRvciwgY29udGV4dCkge1xuICAgIHRoaXMuZWxlbWVudC5jbGFzc05hbWUuc3BsaXQoL1xccysvKS5zZWxlY3QoZnVuY3Rpb24obmFtZSkge1xuICAgICAgcmV0dXJuIG5hbWUubGVuZ3RoID4gMDtcbiAgICB9KS5fZWFjaChpdGVyYXRvciwgY29udGV4dCk7XG4gIH0sXG5cbiAgc2V0OiBmdW5jdGlvbihjbGFzc05hbWUpIHtcbiAgICB0aGlzLmVsZW1lbnQuY2xhc3NOYW1lID0gY2xhc3NOYW1lO1xuICB9LFxuXG4gIGFkZDogZnVuY3Rpb24oY2xhc3NOYW1lVG9BZGQpIHtcbiAgICBpZiAodGhpcy5pbmNsdWRlKGNsYXNzTmFtZVRvQWRkKSkgcmV0dXJuO1xuICAgIHRoaXMuc2V0KCRBKHRoaXMpLmNvbmNhdChjbGFzc05hbWVUb0FkZCkuam9pbignICcpKTtcbiAgfSxcblxuICByZW1vdmU6IGZ1bmN0aW9uKGNsYXNzTmFtZVRvUmVtb3ZlKSB7XG4gICAgaWYgKCF0aGlzLmluY2x1ZGUoY2xhc3NOYW1lVG9SZW1vdmUpKSByZXR1cm47XG4gICAgdGhpcy5zZXQoJEEodGhpcykud2l0aG91dChjbGFzc05hbWVUb1JlbW92ZSkuam9pbignICcpKTtcbiAgfSxcblxuICB0b1N0cmluZzogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICRBKHRoaXMpLmpvaW4oJyAnKTtcbiAgfVxufTtcblxuT2JqZWN0LmV4dGVuZChFbGVtZW50LkNsYXNzTmFtZXMucHJvdG90eXBlLCBFbnVtZXJhYmxlKTtcblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbihmdW5jdGlvbigpIHtcbiAgd2luZG93LlNlbGVjdG9yID0gQ2xhc3MuY3JlYXRlKHtcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihleHByZXNzaW9uKSB7XG4gICAgICB0aGlzLmV4cHJlc3Npb24gPSBleHByZXNzaW9uLnN0cmlwKCk7XG4gICAgfSxcblxuICAgIGZpbmRFbGVtZW50czogZnVuY3Rpb24ocm9vdEVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBQcm90b3R5cGUuU2VsZWN0b3Iuc2VsZWN0KHRoaXMuZXhwcmVzc2lvbiwgcm9vdEVsZW1lbnQpO1xuICAgIH0sXG5cbiAgICBtYXRjaDogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgcmV0dXJuIFByb3RvdHlwZS5TZWxlY3Rvci5tYXRjaChlbGVtZW50LCB0aGlzLmV4cHJlc3Npb24pO1xuICAgIH0sXG5cbiAgICB0b1N0cmluZzogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5leHByZXNzaW9uO1xuICAgIH0sXG5cbiAgICBpbnNwZWN0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBcIiM8U2VsZWN0b3I6IFwiICsgdGhpcy5leHByZXNzaW9uICsgXCI+XCI7XG4gICAgfVxuICB9KTtcblxuICBPYmplY3QuZXh0ZW5kKFNlbGVjdG9yLCB7XG4gICAgbWF0Y2hFbGVtZW50czogZnVuY3Rpb24oZWxlbWVudHMsIGV4cHJlc3Npb24pIHtcbiAgICAgIHZhciBtYXRjaCA9IFByb3RvdHlwZS5TZWxlY3Rvci5tYXRjaCxcbiAgICAgICAgICByZXN1bHRzID0gW107XG5cbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBlbGVtZW50cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgZWxlbWVudCA9IGVsZW1lbnRzW2ldO1xuICAgICAgICBpZiAobWF0Y2goZWxlbWVudCwgZXhwcmVzc2lvbikpIHtcbiAgICAgICAgICByZXN1bHRzLnB1c2goRWxlbWVudC5leHRlbmQoZWxlbWVudCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9LFxuXG4gICAgZmluZEVsZW1lbnQ6IGZ1bmN0aW9uKGVsZW1lbnRzLCBleHByZXNzaW9uLCBpbmRleCkge1xuICAgICAgaW5kZXggPSBpbmRleCB8fCAwO1xuICAgICAgdmFyIG1hdGNoSW5kZXggPSAwLCBlbGVtZW50O1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGVsZW1lbnRzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50c1tpXTtcbiAgICAgICAgaWYgKFByb3RvdHlwZS5TZWxlY3Rvci5tYXRjaChlbGVtZW50LCBleHByZXNzaW9uKSAmJiBpbmRleCA9PT0gbWF0Y2hJbmRleCsrKSB7XG4gICAgICAgICAgcmV0dXJuIEVsZW1lbnQuZXh0ZW5kKGVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIGZpbmRDaGlsZEVsZW1lbnRzOiBmdW5jdGlvbihlbGVtZW50LCBleHByZXNzaW9ucykge1xuICAgICAgdmFyIHNlbGVjdG9yID0gZXhwcmVzc2lvbnMudG9BcnJheSgpLmpvaW4oJywgJyk7XG4gICAgICByZXR1cm4gUHJvdG90eXBlLlNlbGVjdG9yLnNlbGVjdChzZWxlY3RvciwgZWxlbWVudCB8fCBkb2N1bWVudCk7XG4gICAgfVxuICB9KTtcbn0pKCk7XG4iLCJcInVzZSBzdHJpY3RcIjtcclxuLypcdD09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHRcdFx0XHRcdFx0XHRcdFx0R2lic29uIFJlc2VhcmNoIENvcnBvcmF0aW9uXHJcblx0XHRcdFx0VUhFUFJORyAtIFVsdHJhIEhpZ2ggRW50cm9weSBQc2V1ZG8tUmFuZG9tIE51bWJlciBHZW5lcmF0b3JcclxuXHQ9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblx0VGhpcyBpcyBHUkMncyBjcnlwdG9ncmFwaGljYWxseSBzdHJvbmcgUFJORyAocHNldWRvLXJhbmRvbSBudW1iZXIgZ2VuZXJhdG9yKVxyXG5cdGZvciBKYXZhU2NyaXB0LiBJdCBpcyBkcml2ZW4gYnkgMTUzNiBiaXRzIG9mIGVudHJvcHksIHN0b3JlZCBpbiBhbiBhcnJheSBvZlxyXG5cdDQ4LCAzMi1iaXQgSmF2YVNjcmlwdCB2YXJpYWJsZXMuICBTaW5jZSBtYW55IGFwcGxpY2F0aW9ucyBvZiB0aGlzIGdlbmVyYXRvcixcclxuXHRpbmNsdWRpbmcgb3VycyB3aXRoIHRoZSBcIk9mZiBUaGUgR3JpZFwiIExhdGluIFNxdWFyZSBnZW5lcmF0b3IsIG1heSByZXF1aXJlXHJcblx0dGhlIGRldGVyaW1pbmlzdGljIHJlLWdlbmVyYXRpb24gb2YgYSBzZXF1ZW5jZSBvZiBQUk5zLCB0aGlzIFBSTkcncyBpbml0aWFsXHJcblx0ZW50cm9waWMgc3RhdGUgY2FuIGJlIHJlYWQgYW5kIHdyaXR0ZW4gYXMgYSBzdGF0aWMgd2hvbGUsIGFuZCBpbmNyZW1lbnRhbGx5XHJcblx0ZXZvbHZlZCBieSBwb3VyaW5nIG5ldyBzb3VyY2UgZW50cm9weSBpbnRvIHRoZSBnZW5lcmF0b3IncyBpbnRlcm5hbCBzdGF0ZS5cclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblx0RU5ETEVTUyBUSEFOS1MgYXJlIGR1ZSBKb2hhbm5lcyBCYWFnb2UgZm9yIGhpcyBjYXJlZnVsIGRldmVsb3BtZW50IG9mIGhpZ2hseVxyXG5cdHJvYnVzdCBKYXZhU2NyaXB0IGltcGxlbWVudGF0aW9ucyBvZiBKUyBQUk5Hcy4gIFRoaXMgd29yayB3YXMgYmFzZWQgdXBvbiBoaXNcclxuXHRKYXZhU2NyaXB0IFwiQWxlYVwiIFBSTkcgd2hpY2ggaXMgYmFzZWQgdXBvbiB0aGUgZXh0cmVtZWx5IHJvYnVzdCBNdWx0aXBseS1cclxuXHRXaXRoLUNhcnJ5IChNV0MpIFBSTkcgaW52ZW50ZWQgYnkgR2VvcmdlIE1hcnNhZ2xpYS4gTVdDIEFsZ29yaXRobSBSZWZlcmVuY2VzOlxyXG5cdGh0dHA6Ly93d3cuR1JDLmNvbS9vdGcvTWFyc2FnbGlhX1BSTkdzLnBkZlxyXG5cdGh0dHA6Ly93d3cuR1JDLmNvbS9vdGcvTWFyc2FnbGlhX01XQ19HZW5lcmF0b3JzLnBkZlxyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHRUaGUgcXVhbGl0eSBvZiB0aGlzIGFsZ29yaXRobSdzIHBzZXVkby1yYW5kb20gbnVtYmVycyBoYXZlIGJlZW4gdmVyaWZpZWQgYnlcclxuXHRtdWx0aXBsZSBpbmRlcGVuZGVudCByZXNlYXJjaGVycy4gSXQgaGFuZGlseSBwYXNzZXMgdGhlIGZlcm1pbGFiLmNoIHRlc3RzIGFzXHJcblx0d2VsbCBhcyB0aGUgXCJkaWVoYXJkXCIgYW5kIFwiZGllaGFyZGVyXCIgdGVzdCBzdWl0ZXMuICBGb3IgaW5kaXZpZHVhbHMgd2lzaGluZ1xyXG5cdHRvIGZ1cnRoZXIgdmVyaWZ5IHRoZSBxdWFsaXR5IG9mIHRoaXMgYWxnb3JpdGhtJ3MgcHNldWRvLXJhbmRvbSBudW1iZXJzLCBhXHJcblx0MjU2LW1lZ2FieXRlIGZpbGUgb2YgdGhpcyBhbGdvcml0aG0ncyBvdXRwdXQgbWF5IGJlIGRvd25sb2FkZWQgZnJvbSBHUkMuY29tLFxyXG5cdGFuZCBhIE1pY3Jvc29mdCBXaW5kb3dzIHNjcmlwdGluZyBob3N0IChXU0gpIHZlcnNpb24gb2YgdGhpcyBhbGdvcml0aG0gbWF5IGJlXHJcblx0ZG93bmxvYWRlZCBhbmQgcnVuIGZyb20gdGhlIFdpbmRvd3MgY29tbWFuZCBwcm9tcHQgdG8gZ2VuZXJhdGUgdW5pcXVlIGZpbGVzXHJcblx0b2YgYW55IHNpemU6XHJcblx0VGhlIEZlcm1pbGFiIFwiRU5UXCIgdGVzdHM6IGh0dHA6Ly9mb3VybWlsYWIuY2gvcmFuZG9tL1xyXG5cdFRoZSAyNTYtbWVnYWJ5dGUgc2FtcGxlIFBSTiBmaWxlIGF0IEdSQzogaHR0cHM6Ly93d3cuR1JDLmNvbS9vdGcvdWhlcHJuZy5iaW5cclxuXHRUaGUgV2luZG93cyBzY3JpcHRpbmcgaG9zdCB2ZXJzaW9uOiBodHRwczovL3d3dy5HUkMuY29tL290Zy93c2gtdWhlcHJuZy5qc1xyXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHRRdWFsaWZ5aW5nIE1XQyBtdWx0aXBsaWVycyBhcmU6IDE4Nzg4NCwgNjg2MTE4LCA4OTgxMzQsIDExMDQzNzUsIDEyNTAyMDUsXHJcblx0MTQ2MDkxMCBhbmQgMTc2ODg2My4gKFdlIHVzZSB0aGUgbGFyZ2VzdCBvbmUgdGhhdCdzIDwgMl4yMSlcclxuXHQ9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXHJcblxyXG5mdW5jdGlvbiB1aGVwcm5nKCkge1xyXG5cdHJldHVybiAoZnVuY3Rpb24oKSB7XHJcbiAgXHRcdHZhciBvID0gNDg7XHRcdFx0XHRcdC8vIHNldCB0aGUgJ29yZGVyJyBudW1iZXIgb2YgRU5UUk9QWS1ob2xkaW5nIDMyLWJpdCB2YWx1ZXNcclxuXHRcdHZhciBjID0gMTtcdFx0XHRcdFx0Ly8gaW5pdCB0aGUgJ2NhcnJ5JyB1c2VkIGJ5IHRoZSBtdWx0aXBseS13aXRoLWNhcnJ5IChNV0MpIGFsZ29yaXRobVxyXG5cdFx0dmFyIHAgPSBvO1x0XHRcdFx0XHQvLyBpbml0IHRoZSAncGhhc2UnIChtYXgtMSkgb2YgdGhlIGludGVybWVkaWF0ZSB2YXJpYWJsZSBwb2ludGVyXHJcblx0XHR2YXIgcyA9IG5ldyBBcnJheShvKTtcdC8vIGRlY2xhcmUgb3VyIGludGVybWVkaWF0ZSB2YXJpYWJsZXMgYXJyYXlcclxuXHRcdHZhciBpLGosaz0wO1x0XHRcdFx0Ly8gZ2VuZXJhbCBwdXJwb3NlIGxvY2Fsc1xyXG5cclxuXHRcdC8vIHdoZW4gb3VyIFwidWhlcHJuZ1wiIGlzIGluaXRpYWxseSBpbnZva2VkIG91ciBQUk5HIHN0YXRlIGlzIGluaXRpYWxpemVkIGZyb20gdGhlXHJcblx0XHQvLyBicm93c2VyJ3Mgb3duIGxvY2FsIFBSTkcuIFRoaXMgaXMgb2theSBzaW5jZSBhbHRob3VnaCBpdHMgZ2VuZXJhdG9yIG1pZ2h0IG5vdFxyXG5cdFx0Ly8gYmUgd29uZGVyZnVsLCBpdCdzIHVzZWZ1bCBmb3IgZXN0YWJsaXNoaW5nIGxhcmdlIHN0YXJ0dXAgZW50cm9weSBmb3Igb3VyIHVzYWdlLlx0XHRcclxuXHRcdHZhciBtYXNoID0gTWFzaCgpO1x0XHQvLyBnZXQgYSBwb2ludGVyIHRvIG91ciBoaWdoLXBlcmZvcm1hbmNlIFwiTWFzaFwiIGhhc2hcclxuXHRcdGZvciAoaSA9IDA7IGkgPCBvOyBpKyspIHNbaV0gPSBtYXNoKCBNYXRoLnJhbmRvbSgpICk7XHQvLyBmaWxsIHRoZSBhcnJheSB3aXRoIGluaXRpYWwgbWFzaCBoYXNoIHZhbHVlc1xyXG5cclxuXHRcdC8vIHRoaXMgUFJJVkFURSAoaW50ZXJuYWwgYWNjZXNzIG9ubHkpIGZ1bmN0aW9uIGlzIHRoZSBoZWFydCBvZiB0aGUgbXVsdGlwbHktd2l0aC1jYXJyeVxyXG5cdFx0Ly8gKE1XQykgUFJORyBhbGdvcml0aG0uIFdoZW4gY2FsbGVkIGl0IHJldHVybnMgYSBwc2V1ZG8tcmFuZG9tIG51bWJlciBpbiB0aGUgZm9ybSBvZiBhXHJcblx0XHQvLyAzMi1iaXQgSmF2YVNjcmlwdCBmcmFjdGlvbiAoMC4wIHRvIDwxLjApIGl0IGlzIGEgUFJJVkFURSBmdW5jdGlvbiB1c2VkIGJ5IHRoZSBkZWZhdWx0XHJcblx0XHQvLyBbMC0xXSByZXR1cm4gZnVuY3Rpb24sIGFuZCBieSB0aGUgcmFuZG9tICdzdHJpbmcobiknIGZ1bmN0aW9uIHdoaWNoIHJldHVybnMgJ24nXHJcblx0XHQvLyBjaGFyYWN0ZXJzIGZyb20gMzMgdG8gMTI2LlxyXG5cdFx0ZnVuY3Rpb24gcmF3cHJuZygpIHtcclxuXHRcdFx0aWYgKCsrcCA+PSBvKSBwID0gMDtcclxuXHRcdFx0dmFyIHQgPSAxNzY4ODYzICogc1twXSArIGMgKiAyLjMyODMwNjQzNjUzODY5NjNlLTEwOyAvLyAyXi0zMlxyXG4gICAgICBcdHJldHVybiBzW3BdID0gdCAtIChjID0gdCB8IDApO1xyXG5cdFx0fTtcclxuXHRcdFxyXG5cdFx0Ly8gdGhpcyBFWFBPUlRFRCBmdW5jdGlvbiBpcyB0aGUgZGVmYXVsdCBmdW5jdGlvbiByZXR1cm5lZCBieSB0aGlzIGxpYnJhcnkuXHJcblx0XHQvLyBUaGUgdmFsdWVzIHJldHVybmVkIGFyZSBpbnRlZ2VycyBpbiB0aGUgcmFuZ2UgZnJvbSAwIHRvIHJhbmdlLTEuIFdlIGZpcnN0XHJcblx0XHQvLyBvYnRhaW4gdHdvIDMyLWJpdCBmcmFjdGlvbnMgKGZyb20gcmF3cHJuZykgdG8gc3ludGhlc2l6ZSBhIHNpbmdsZSBoaWdoXHJcblx0XHQvLyByZXNvbHV0aW9uIDUzLWJpdCBwcm5nICgwIHRvIDwxKSwgdGhlbiB3ZSBtdWx0aXBseSB0aGlzIGJ5IHRoZSBjYWxsZXInc1xyXG5cdFx0Ly8gXCJyYW5nZVwiIHBhcmFtIGFuZCB0YWtlIHRoZSBcImZsb29yXCIgdG8gcmV0dXJuIGEgZXF1YWxseSBwcm9iYWJsZSBpbnRlZ2VyLlxyXG5cdFx0dmFyIHJhbmRvbSA9IGZ1bmN0aW9uKCByYW5nZSApIHtcclxuXHRcdFx0cmV0dXJuIE1hdGguZmxvb3IocmFuZ2UgKiAocmF3cHJuZygpICsgKHJhd3BybmcoKSAqIDB4MjAwMDAwIHwgMCkgKiAxLjExMDIyMzAyNDYyNTE1NjVlLTE2KSk7IC8vIDJeLTUzXHJcblx0XHR9O1xyXG5cclxuXHRcdC8vIHRoaXMgRVhQT1JURUQgZnVuY3Rpb24gJ3N0cmluZyhuKScgcmV0dXJucyBhIHBzZXVkby1yYW5kb20gc3RyaW5nIG9mXHJcblx0XHQvLyAnbicgcHJpbnRhYmxlIGNoYXJhY3RlcnMgcmFuZ2luZyBmcm9tIGNocigzMykgdG8gY2hyKDEyNikgaW5jbHVzaXZlLlxyXG5cdFx0cmFuZG9tLnN0cmluZyA9IGZ1bmN0aW9uKCBjb3VudCApIHtcclxuXHRcdFx0dmFyIGksIHM9Jyc7XHJcblx0XHRcdGZvciAoIGk9MDsgaTxjb3VudDsgaSsrICkgcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCAzMytyYW5kb20oOTQpICk7XHJcblx0XHRcdHJldHVybiBzO1xyXG5cdFx0fTtcclxuXHJcblx0XHQvLyB0aGlzIFBSSVZBVEUgXCJoYXNoXCIgZnVuY3Rpb24gaXMgdXNlZCB0byBldm9sdmUgdGhlIGdlbmVyYXRvcidzIGludGVybmFsXHJcblx0XHQvLyBlbnRyb3B5IHN0YXRlLiBJdCBpcyBhbHNvIGNhbGxlZCBieSB0aGUgRVhQT1JURUQgYWRkRW50cm9weSgpIGZ1bmN0aW9uXHJcblx0XHQvLyB3aGljaCBpcyB1c2VkIHRvIHBvdXIgZW50cm9weSBpbnRvIHRoZSBQUk5HLlxyXG5cdFx0ZnVuY3Rpb24gaGFzaCgpIHtcclxuXHRcdFx0dmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpXHJcblx0XHRcdGZvciAoaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0Zm9yIChqID0gMDsgaiA8IG87IGorKykge1xyXG5cdFx0XHRcdFx0c1tqXSAtPSBtYXNoKGFyZ3NbaV0pO1xyXG5cdFx0XHRcdFx0aWYgKHNbal0gPCAwKSBzW2pdICs9IDE7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cclxuXHRcdC8vIHRoaXMgRVhQT1JURUQgXCJjbGVhbiBzdHJpbmdcIiBmdW5jdGlvbiByZW1vdmVzIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHNwYWNlcyBhbmQgbm9uLXByaW50aW5nXHJcblx0XHQvLyBjb250cm9sIGNoYXJhY3RlcnMsIGluY2x1ZGluZyBhbnkgZW1iZWRkZWQgY2FycmlhZ2UtcmV0dXJuIChDUikgYW5kIGxpbmUtZmVlZCAoTEYpIGNoYXJhY3RlcnMsXHJcblx0XHQvLyBmcm9tIGFueSBzdHJpbmcgaXQgaXMgaGFuZGVkLiB0aGlzIGlzIGFsc28gdXNlZCBieSB0aGUgJ2hhc2hzdHJpbmcnIGZ1bmN0aW9uIChiZWxvdykgdG8gaGVscFxyXG5cdFx0Ly8gdXNlcnMgYWx3YXlzIG9idGFpbiB0aGUgc2FtZSBFRkZFQ1RJVkUgdWhlcHJuZyBzZWVkaW5nIGtleS5cclxuXHRcdHJhbmRvbS5jbGVhblN0cmluZyA9IGZ1bmN0aW9uKCBpblN0ciApIHtcclxuXHRcdFx0aW5TdHIgPSBpblN0ci5yZXBsYWNlKC8oXlxccyopfChcXHMqJCkvZ2ksXCJcIik7IC8vIHJlbW92ZSBhbnkvYWxsIGxlYWRpbmcgc3BhY2VzXHJcblx0XHRcdGluU3RyID0gaW5TdHIucmVwbGFjZSgvW1xceDAwLVxceDFGXS9naSxcIlwiKTtcdC8vIHJlbW92ZSBhbnkvYWxsIGNvbnRyb2wgY2hhcmFjdGVyc1xyXG5cdFx0XHRpblN0ciA9IGluU3RyLnJlcGxhY2UoL1xcbiAvLFwiXFxuXCIpO1x0XHRcdFx0Ly8gcmVtb3ZlIGFueS9hbGwgdHJhaWxpbmcgc3BhY2VzXHJcblx0XHRcdHJldHVybiBpblN0cjtcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gcmV0dXJuIHRoZSBjbGVhbmVkIHVwIHJlc3VsdFxyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHQvLyB0aGlzIEVYUE9SVEVEIFwiaGFzaCBzdHJpbmdcIiBmdW5jdGlvbiBoYXNoZXMgdGhlIHByb3ZpZGVkIGNoYXJhY3RlciBzdHJpbmcgYWZ0ZXIgZmlyc3QgcmVtb3ZpbmdcclxuXHRcdC8vIGFueSBsZWFkaW5nIG9yIHRyYWlsaW5nIHNwYWNlcyBhbmQgaWdub3JpbmcgYW55IGVtYmVkZGVkIGNhcnJpYWdlIHJldHVybnMgKENSKSBvciBMaW5lIEZlZWRzIChMRilcclxuXHRcdHJhbmRvbS5oYXNoU3RyaW5nID0gZnVuY3Rpb24oIGluU3RyICkge1xyXG5cdFx0XHRpblN0ciA9IHJhbmRvbS5jbGVhblN0cmluZyggaW5TdHIgKTtcclxuXHRcdFx0bWFzaCggaW5TdHIgKTtcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gdXNlIHRoZSBzdHJpbmcgdG8gZXZvbHZlIHRoZSAnbWFzaCcgc3RhdGVcclxuXHRcdFx0Zm9yICggaSA9IDA7IGkgPCBpblN0ci5sZW5ndGg7IGkrKykge1x0XHRcdC8vIHNjYW4gdGhyb3VnaCB0aGUgY2hhcmFjdGVycyBpbiBvdXIgc3RyaW5nXHJcblx0XHRcdFx0ayA9IGluU3RyLmNoYXJDb2RlQXQoIGkgKTtcdFx0XHRcdFx0XHQvLyBnZXQgdGhlIGNoYXJhY3RlciBjb2RlIGF0IHRoZSBsb2NhdGlvblxyXG5cdFx0XHRcdGZvciAoaiA9IDA7IGogPCBvOyBqKyspIHtcdFx0XHRcdFx0XHQvL1x0XCJtYXNoXCIgaXQgaW50byB0aGUgVUhFUFJORyBzdGF0ZVxyXG5cdFx0XHRcdFx0c1tqXSAtPSBtYXNoKCBrICk7XHJcblx0XHRcdFx0XHRpZiAoc1tqXSA8IDApIHNbal0gKz0gMTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH07XHJcblx0XHRcdFx0XHJcblx0XHQvLyB0aGlzIGhhbmR5IGV4cG9ydGVkIGZ1bmN0aW9uIGlzIHVzZWQgdG8gYWRkIGVudHJvcHkgdG8gb3VyIHVoZXBybmcgYXQgYW55IHRpbWVcclxuXHRcdHJhbmRvbS5hZGRFbnRyb3B5ID0gZnVuY3Rpb24oIC8qIGFjY2VwdCB6ZXJvIG9yIG1vcmUgYXJndW1lbnRzICovICkge1xyXG5cdFx0XHR2YXIgYXJncyA9IFtdO1xyXG5cdFx0XHRmb3IgKCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKyApIGFyZ3MucHVzaCggYXJndW1lbnRzW2ldICk7XHJcblx0XHRcdGhhc2goIChrKyspICsgKG5ldyBEYXRlKCkuZ2V0VGltZSgpKSArIGFyZ3Muam9pbignJykgKyBNYXRoLnJhbmRvbSgpICk7XHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHQvLyBpZiB3ZSB3YW50IHRvIHByb3ZpZGUgYSBkZXRlcm1pbmlzdGljIHN0YXJ0dXAgY29udGV4dCBmb3Igb3VyIFBSTkcsXHJcblx0XHQvLyBidXQgd2l0aG91dCBkaXJlY3RseSBzZXR0aW5nIHRoZSBpbnRlcm5hbCBzdGF0ZSB2YXJpYWJsZXMsIHRoaXMgYWxsb3dzXHJcblx0XHQvLyB1cyB0byBpbml0aWFsaXplIHRoZSBtYXNoIGhhc2ggYW5kIFBSTkcncyBpbnRlcm5hbCBzdGF0ZSBiZWZvcmUgcHJvdmlkaW5nXHJcblx0XHQvLyBzb21lIGhhc2hpbmcgaW5wdXRcclxuXHRcdHJhbmRvbS5pbml0U3RhdGUgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0bWFzaCgpO1x0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gcGFzcyBhIG51bGwgYXJnIHRvIGZvcmNlIG1hc2ggaGFzaCB0byBpbml0XHJcblx0XHRcdGZvciAoaSA9IDA7IGkgPCBvOyBpKyspIHNbaV0gPSBtYXNoKCAnICcgKTtcdC8vIGZpbGwgdGhlIGFycmF5IHdpdGggaW5pdGlhbCBtYXNoIGhhc2ggdmFsdWVzXHJcblx0XHRcdGMgPSAxO1x0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gaW5pdCBvdXIgbXVsdGlwbHktd2l0aC1jYXJyeSBjYXJyeVxyXG5cdFx0XHRwID0gbztcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vIGluaXQgb3VyIHBoYXNlXHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHQvLyB3ZSB1c2UgdGhpcyAob3B0aW9uYWwpIGV4cG9ydGVkIGZ1bmN0aW9uIHRvIHNpZ25hbCB0aGUgSmF2YVNjcmlwdCBpbnRlcnByZXRlclxyXG5cdFx0Ly8gdGhhdCB3ZSdyZSBmaW5pc2hlZCB1c2luZyB0aGUgXCJNYXNoXCIgaGFzaCBmdW5jdGlvbiBzbyB0aGF0IGl0IGNhbiBmcmVlIHVwIHRoZVxyXG5cdFx0Ly8gbG9jYWwgXCJpbnN0YW5jZSB2YXJpYWJsZXNcIiBpcyB3aWxsIGhhdmUgYmVlbiBtYWludGFpbmluZy4gIEl0J3Mgbm90IHN0cmljdGx5XHJcblx0XHQvLyBuZWNlc3NhcnksIG9mIGNvdXJzZSwgYnV0IGl0J3MgZ29vZCBKYXZhU2NyaXB0IGNpdGl6ZW5zaGlwLlxyXG5cdFx0cmFuZG9tLmRvbmUgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0bWFzaCA9IG51bGw7XHJcblx0XHR9O1xyXG5cclxuXHRcdC8vIHdoZW4gb3VyIG1haW4gb3V0ZXIgXCJ1aGVwcm5nXCIgZnVuY3Rpb24gaXMgY2FsbGVkLCBhZnRlciBzZXR0aW5nIHVwIG91clxyXG5cdFx0Ly8gaW5pdGlhbCB2YXJpYWJsZXMgYW5kIGVudHJvcGljIHN0YXRlLCB3ZSByZXR1cm4gYW4gXCJpbnN0YW5jZSBwb2ludGVyXCJcclxuXHRcdC8vIHRvIHRoZSBpbnRlcm5hbCBhbm9ueW1vdXMgZnVuY3Rpb24gd2hpY2ggY2FuIHRoZW4gYmUgdXNlZCB0byBhY2Nlc3NcclxuXHRcdC8vIHRoZSB1aGVwcm5nJ3MgdmFyaW91cyBleHBvcnRlZCBmdW5jdGlvbnMuICBBcyB3aXRoIHRoZSBcIi5kb25lXCIgZnVuY3Rpb25cclxuXHRcdC8vIGFib3ZlLCB3ZSBzaG91bGQgc2V0IHRoZSByZXR1cm5lZCB2YWx1ZSB0byAnbnVsbCcgb25jZSB3ZSdyZSBmaW5pc2hlZFxyXG5cdFx0Ly8gdXNpbmcgYW55IG9mIHRoZXNlIGZ1bmN0aW9ucy5cclxuXHRcdHJldHVybiByYW5kb207XHJcbiAgfSAoKSk7XHJcbn07XHJcblxyXG4vKlx0PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cdFRoaXMgaXMgYmFzZWQgdXBvbiBKb2hhbm5lcyBCYWFnb2UncyBjYXJlZnVsbHkgZGVzaWduZWQgYW5kIGVmZmljaWVudCBoYXNoXHJcblx0ZnVuY3Rpb24gZm9yIHVzZSB3aXRoIEphdmFTY3JpcHQuICBJdCBoYXMgYSBwcm92ZW4gXCJhdmFsYW5jaGVcIiBlZmZlY3Qgc3VjaFxyXG5cdHRoYXQgZXZlcnkgYml0IG9mIHRoZSBpbnB1dCBhZmZlY3RzIGV2ZXJ5IGJpdCBvZiB0aGUgb3V0cHV0IDUwJSBvZiB0aGUgdGltZSxcclxuXHR3aGljaCBpcyBnb29kLlx0U2VlOiBodHRwOi8vYmFhZ29lLmNvbS9lbi9SYW5kb21NdXNpbmdzL2hhc2gvYXZhbGFuY2hlLnhodG1sXHJcblx0PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4qL1xyXG5mdW5jdGlvbiBNYXNoKCkge1xyXG5cdHZhciBuID0gMHhlZmM4MjQ5ZDtcclxuXHR2YXIgbWFzaCA9IGZ1bmN0aW9uKGRhdGEpIHtcclxuXHRcdGlmICggZGF0YSApIHtcclxuXHRcdFx0ZGF0YSA9IGRhdGEudG9TdHJpbmcoKTtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0biArPSBkYXRhLmNoYXJDb2RlQXQoaSk7XHJcblx0XHRcdFx0dmFyIGggPSAwLjAyNTE5NjAzMjgyNDE2OTM4ICogbjtcclxuXHRcdFx0XHRuID0gaCA+Pj4gMDtcclxuXHRcdFx0XHRoIC09IG47XHJcblx0XHRcdFx0aCAqPSBuO1xyXG5cdFx0XHRcdG4gPSBoID4+PiAwO1xyXG5cdFx0XHRcdGggLT0gbjtcclxuXHRcdFx0XHRuICs9IGggKiAweDEwMDAwMDAwMDsgLy8gMl4zMlxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiAobiA+Pj4gMCkgKiAyLjMyODMwNjQzNjUzODY5NjNlLTEwOyAvLyAyXi0zMlxyXG5cdFx0fSBlbHNlIG4gPSAweGVmYzgyNDlkO1xyXG5cdH07XHJcbiAgcmV0dXJuIG1hc2g7XHJcbn1cclxuIiwiLypcclxuICogb3N3ZWIgXHJcbiAqICBcclxuICogQW4gZXhwZXJpbWVudCByZXNlYXJjaCB0b29sIHdyaXR0ZW4gaW4gSmF2YXNjcmlwdCBhbmQgSFRNTCB0byBiZSB1c2VkIGluIFxyXG4gKiBRdWFsdHJpY3Mgb3Igb3RoZXIgd2ViLWJhc2VkIHRvb2xzLiBCYXNlZCB1cG9uIE9wZW5TZXNhbWUuICAgICAgICAgXHJcbiAqXHJcbiAqIEF1dGhvcjogZHJzLiBKLiBCb3NcclxuICpcclxuICogQ29weXJpZ2h0IChjKSBVbml2ZXJzaXR5IG9mIEdyb25pbmdlbiBcclxuICogRmFjdWx0eSBvZiBCZWhhdmlvdXJhbCBhbmQgU29jaWFsIFNjaWVuY2VzXHJcbiAqIFRlY2huaWNhbCBTdXBwb3J0IFNlcnZpY2UgXHJcbiAqXHJcbiAqL1xyXG5cclxuLy8gVXNlIHN0cmljdCBtb2RlLiAgICAgXHJcblwidXNlIHN0cmljdFwiO1xyXG5cclxuLy8gU2V0IG9zd2ViIG5hbWVzcGFjZS5cclxudGhpcy5vc3dlYiA9IHRoaXMub3N3ZWJ8fHt9O1xyXG5cclxuLy8gRGVmaW5pdGlvbiBvZiBvc3dlYiB2ZXJzaW9uIGNvbnN0YW50cy4gXHJcbm9zd2ViLlZFUlNJT05fTkFNRSAgID0gJ29zd2ViJztcclxub3N3ZWIuVkVSU0lPTl9OVU1CRVIgPSAnMC4wNDEgKDE5LTA3LTIwMTYpJztcclxuXHJcbi8vIERlZmluaXRpb24gb2Ygb3N3ZWIgY2xhc3MgdXRpbGl0eSBtZXRob2RzLlxyXG5vc3dlYi5leHRlbmRDbGFzcyA9IGZ1bmN0aW9uKHN1Yl9jbGFzcywgc3VwZXJfY2xhc3MpIHtcclxuICAgIGZ1bmN0aW9uIG8oKSB7IFxyXG4gICAgICAgIHRoaXMuY29uc3RydWN0b3IgPSBzdWJfY2xhc3M7IFxyXG4gICAgfVxyXG4gICAgby5wcm90b3R5cGUgPSBzdXBlcl9jbGFzcy5wcm90b3R5cGU7XHJcbiAgICByZXR1cm4gKHN1Yl9jbGFzcy5wcm90b3R5cGUgPSBuZXcgbygpKTtcclxufTsgXHJcblxyXG5vc3dlYi5pc0NsYXNzID0gZnVuY3Rpb24oY2xhc3NfbmFtZSkge1xyXG4gICAgLy8gUmV0dXJuIHRydWUgaWYgdGhlIGNsYXNzbmFtZSBpcyBkZWZpbmVkIHdpdGhpbiB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgcmV0dXJuICh0aGlzW2NsYXNzX25hbWVdICE9PSB1bmRlZmluZWQpO1xyXG59O1xyXG5cclxub3N3ZWIubmV3SXRlbUNsYXNzID0gZnVuY3Rpb24odHlwZSwgZXhwZXJpbWVudCwgbmFtZSwgc3RyaW5nKSB7XHJcbiAgICAvLyBDcmVhdGUgdGhlIGVsZW1lbnQuXHJcbiAgICB2YXIgZWxlbWVudCA9IG5ldyB0aGlzW3R5cGVdKGV4cGVyaW1lbnQsIG5hbWUsIHN0cmluZyk7XHJcbiAgIFxyXG4gICAgLy8gU2V0IHRoZSB0eXBlIG9mIHRoZSBpdGVtLlxyXG4gICAgZWxlbWVudC50eXBlID0gdHlwZTtcclxuICAgIFxyXG4gICAgLy8gUmV0dXJuIHRoZSBlbGVtZW50XHJcbiAgICByZXR1cm4gZWxlbWVudDtcclxufTtcclxuXHJcbm9zd2ViLm5ld0VsZW1lbnRDbGFzcyA9IGZ1bmN0aW9uKHR5cGUsIHNrZXRjaHBhZCwgc3RyaW5nKSB7XHJcbiAgICAvLyBDcmVhdGUgdGhlIGVsZW1lbnQuXHJcbiAgICB2YXIgZWxlbWVudCA9IG5ldyB0aGlzW3R5cGVdKHNrZXRjaHBhZCwgc3RyaW5nKTtcclxuICAgIFxyXG4gICAgLy8gUmV0dXJuIHRoZSBlbGVtZW50XHJcbiAgICByZXR1cm4gZWxlbWVudDtcclxufTtcclxuXHJcbm9zd2ViLm5ld1dpZGdldENsYXNzID0gZnVuY3Rpb24odHlwZSwgZm9ybSwgdmFyaWFibGVzKSB7XHJcbiAgICAvLyBDcmVhdGUgdGhlIGVsZW1lbnQuXHJcbiAgICB2YXIgd2lkZ2V0ID0gbmV3IHRoaXNbdHlwZV0oZm9ybSwgdmFyaWFibGVzKTtcclxuICAgXHRcclxuICAgIC8vIFJldHVybiB0aGUgZWxlbWVudFxyXG4gICAgcmV0dXJuIHdpZGdldDtcclxufTsgXHJcblxyXG5vc3dlYi5wcm9tb3RlQ2xhc3MgPSBmdW5jdGlvbihzdWJfY2xhc3MsIHByZWZpeCkge1xyXG4gICAgdmFyIHN1YlAgPSBzdWJfY2xhc3MucHJvdG90eXBlLCBzdXBQID0gKE9iamVjdC5nZXRQcm90b3R5cGVPZiYmT2JqZWN0LmdldFByb3RvdHlwZU9mKHN1YlApKXx8c3ViUC5fX3Byb3RvX187XHJcbiAgICBpZiAoc3VwUCkge1xyXG4gICAgXHRzdWJQWyhwcmVmaXgrPVwiX1wiKSArIFwiY29uc3RydWN0b3JcIl0gPSBzdXBQLmNvbnN0cnVjdG9yOyBcclxuICAgIFx0Zm9yICh2YXIgbiBpbiBzdXBQKSB7XHJcbiAgICAgICAgICAgIGlmIChzdWJQLmhhc093blByb3BlcnR5KG4pICYmICh0eXBlb2Ygc3VwUFtuXSA9PT0gXCJmdW5jdGlvblwiKSkge1xyXG4gICAgICAgICAgICAgICAgc3ViUFtwcmVmaXggKyBuXSA9IHN1cFBbbl07IFxyXG4gICAgICAgICAgICB9XHJcblx0fVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN1Yl9jbGFzcztcclxufTsgXHJcbiIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBjb25zdGFudHMuXHJcbiAgICBmdW5jdGlvbiBjb25zdGFudHMoKSB7XHJcbiAgICBcdHRocm93ICdUaGUgY2xhc3MgY29uc3RhbnRzIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhJztcclxuICAgIH1cclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIGVycm9yIGNvbnN0YW50cy4gXHJcbiAgICBjb25zdGFudHMuRVJST1JfMDAxID0gJ29zd2ViIGhhcyBzdG9wcGVkIHJ1bm5pbmcgZHVlIGEgZmF0YWwgZXJyb3IuJztcclxuICAgIGNvbnN0YW50cy5FUlJPUl8wMDIgPSAnTm8gY29udGVudCBwYXJhbWV0ZXIgc3BlY2lmaWVkLic7XHJcbiAgICBjb25zdGFudHMuRVJST1JfMDAzID0gJ05vIGNvbnRleHQgcGFyYW1ldGVyIHNwZWNpZmllZC4nO1xyXG4gICAgY29uc3RhbnRzLkVSUk9SXzAwNCA9ICdJbnZhbGlkIHNjcmlwdElEIG9yIHNjcmlwdFVSTCBmb3IgcmV0cmlldmluZyBzY3JpcHQgZnJvbSBleHRlcm5hbCBsb2NhdGlvbi4nO1xyXG4gICAgY29uc3RhbnRzLkVSUk9SXzAwNSA9ICdGYWlsdXJlIHRvIHJldHJpZXZlIHNjcmlwdCBmcm9tIGV4dGVybmFsIGxvY2F0aW9uIChBamF4IGNhbGwgZXJyb3IpLic7XHJcbiAgICBjb25zdGFudHMuRVJST1JfMDA2ID0gJ0ZhaWx1cmUgdG8gcmV0cmlldmUgc2NyaXB0IGZyb20gZXh0ZXJuYWwgbG9jYXRpb24gKGRhdGFiYXNlIHJlc3BvbnNlIGVycm9yKSc7XHJcbiAgICBjb25zdGFudHMuRVJST1JfMDA3ID0gJ0ZhaWx1cmUgdG8gcmV0cmlldmUgc2NyaXB0IGZyb20gZXh0ZXJuYWwgbG9jYXRpb24gKGRhdGFiYXNlIHJldHJpZXZlIGVycm9yKS4nO1xyXG4gICAgY29uc3RhbnRzLkVSUk9SXzAwOCA9ICdJbnZhbGlkIHNjcmlwdCBkZWZpbml0aW9uLCBwYXJzaW5nIGVycm9yLic7XHJcbiAgICBjb25zdGFudHMuRVJST1JfMDA5ID0gJ1Vua25vd24gY2xhc3MgZGVmaW5pdGlvbiB3aXRoaW4gb3N3ZWIgc2NyaXB0IC0gJztcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIG1lc3NhZ2UgY29uc3RhbnRzLiBcclxuICAgIGNvbnN0YW50cy5NRVNTQUdFXzAwMSA9ICdPcyc7XHJcbiAgICBjb25zdGFudHMuTUVTU0FHRV8wMDIgPSAnd2ViIC0gdmVyc2lvbiAnO1xyXG4gICAgY29uc3RhbnRzLk1FU1NBR0VfMDAzID0gJ1N0YXJ0IHVwIG9zd2ViIGV4cGVyaW1lbnQgc2Vzc2lvbi4nO1xyXG4gICAgY29uc3RhbnRzLk1FU1NBR0VfMDA0ID0gJ1JldHJpZXZpbmcgc3RpbXVsaSBmaWxlcy4nO1xyXG4gICAgY29uc3RhbnRzLk1FU1NBR0VfMDA1ID0gJ1JldHJpZXZpbmcgaW5wdXQgcGFyYW1ldGVycy4nO1xyXG4gICAgY29uc3RhbnRzLk1FU1NBR0VfMDA2ID0gJ1ByZXNzIHdpdGggdGhlIG1vdXNlIG9uIHRoaXMgc2NyZWVuIHRvIGNvbnRpbnVlLic7XHJcbiAgICBjb25zdGFudHMuTUVTU0FHRV8wMDcgPSAnV2FybmluZzogdGhpcyBtZXRob2QgaXMgbm90IGltcGxlbWVudGVkIGluIHRoZSBjdXJyZW50IHZlcnNpb24gb2YgT3NXZWIgLSAnO1xyXG4gICAgY29uc3RhbnRzLk1FU1NBR0VfMDA4ID0gJ1JldHJpZXZpbmcgc2Vzc2lvbiBpbmZvcm1hdGlvbi4nO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgZ2VuZXJhbCBjb25zdGFudHMuIFxyXG4gICAgY29uc3RhbnRzLlNUQVRVU19OT05FID0gMDsgICAgICAgICAgICAgICAgICAgLy8gUnVubmluZyBzdGF0dXMgb2YgYW4gaXRlbS4gICBcclxuICAgIGNvbnN0YW50cy5TVEFUVVNfQlVJTEQgPSAxO1xyXG4gICAgY29uc3RhbnRzLlNUQVRVU19JTklUSUFMSVpFID0gMjtcclxuICAgIGNvbnN0YW50cy5TVEFUVVNfRVhFQ1VURSA9IDM7XHJcbiAgICBjb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFID0gNDtcclxuICAgIGNvbnN0YW50cy5QQVJTRVJfTk9ORSA9IDA7ICAgICAgICAgICAgICAgICAgIC8vIFJ1bm5pbmcgc3RhdHVzIG9mIHRoZSBwYXJzZXIuXHJcbiAgICBjb25zdGFudHMuUEFSU0VSX0VYRUNVVEUgPSAxO1xyXG4gICAgY29uc3RhbnRzLlNUQVRVU19QRU5ESU5HID0gMjtcclxuICAgIGNvbnN0YW50cy5TVEFUVVNfRE9ORSA9IDM7XHJcbiAgICBjb25zdGFudHMuUFJFU1NFU19PTkxZID0gMTsgICAgICAgICAgICAgICAgICAvLyBUeXBlIG9mIHVzZWQgY29sbGVjdGlvbiBtb2RlLiAgICAgICAgICAgXHJcbiAgICBjb25zdGFudHMuUkVMRUFTRVNfT05MWSA9IDI7XHJcbiAgICBjb25zdGFudHMuUFJFU1NFU19BTkRfUkVMRUFTRVMgPSAzO1xyXG4gICAgY29uc3RhbnRzLlJFU1BPTlNFX05PTkUgPSAwOyAgICAgICAgICAgICAgICAgLy8gVHlwZSBvZiByZXNwb25zZSB1c2VkLlxyXG4gICAgY29uc3RhbnRzLlJFU1BPTlNFX0RVUkFUSU9OID0gMTtcclxuICAgIGNvbnN0YW50cy5SRVNQT05TRV9LRVlCT0FSRCA9IDI7XHJcbiAgICBjb25zdGFudHMuUkVTUE9OU0VfTU9VU0UgPSAzO1xyXG4gICAgY29uc3RhbnRzLlJFU1BPTlNFX1NPVU5EID0gNDtcclxuICAgIGNvbnN0YW50cy5SRVNQT05TRV9BVVRPS0VZQk9BUkQgPSA1O1xyXG4gICAgY29uc3RhbnRzLlJFU1BPTlNFX0FVVE9NT1VTRSA9IDY7XHJcbiAgICBjb25zdGFudHMuVVBEQVRFX05PTkUgPSAwOyAgICAgICAgICAgICAgICAgIC8vIEl0ZW0gdXBkYXRlIHN0YXR1cyBmbGFnLlxyXG4gICAgY29uc3RhbnRzLlVQREFURV9PTlNFVCA9IDE7XHJcbiAgICBjb25zdGFudHMuVVBEQVRFX09GRlNFVCA9IDI7XHJcbiAgICBjb25zdGFudHMuU0VRVUVOVElBTCA9IDA7ICAgICAgICAgICAgICAgICAgIC8vIExvb3AgcmFuZG9taXphdGlvbiB0eXBlLlxyXG4gICAgY29uc3RhbnRzLlJBTkRPTSA9IDE7XHJcbiAgICBjb25zdGFudHMuUkFORE9NUkVQTEFDRU1FTlQgPSAyO1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGNvbnN0YW50cyBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuY29uc3RhbnRzID0gY29uc3RhbnRzO1xyXG59KCkpOyBcclxuIiwiXHJcbihmdW5jdGlvbigpIHtcclxuLy8gRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgY2FudmFzLlxyXG4gICAgZnVuY3Rpb24gY2FudmFzKGV4cGVyaW1lbnQsIGF1dG9fcHJlcGFyZSkge1xyXG5cdC8vIHNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuXHJcbiAgICAgICAgdGhpcy5hdXRvX3ByZXBhcmUgPSAodHlwZW9mIGF1dG9fcHJlcGFyZSA9PT0gJ3VuZGVmaW5lZCcpID8gdHJ1ZSA6IGF1dG9fcHJlcGFyZTsgICAgICAgICAgICAgIC8vIFNldCBhdXRvcHJlcGFyZSB0b2dnbGUgKG5vdCBzdXBwb3J0ZWQgeWV0KS4gXHRcclxuICAgICAgICB0aGlzLmV4cGVyaW1lbnQgPSAodHlwZW9mIGV4cGVyaW1lbnQgPT09ICd1bmRlZmluZWQnKSA/IG9zd2ViLnJ1bm5lci5leHBlcmltZW50IDogZXhwZXJpbWVudDsgLy8gQW5jaG9yIHRvIHRoZSBleHBlcmltZW50IG9iamVjdC5cclxuXHRcdFxyXG4gICAgICAgIC8vIFNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgXHR0aGlzLmJhY2tncm91bmRfY29sb3IgPSB0aGlzLmV4cGVyaW1lbnQudmFycy5iYWNrZ3JvdW5kOyAgICAgICAgICAgICAgICAgICAgICAgICAvLyBCYWNrZ3JvcHVuZCBjb2xvciBvZiBjYW52YXMuICAgICBcclxuICAgICAgICB0aGlzLmJpZGkgPSAodGhpcy5leHBlcmltZW50LnZhcnMuYmlkaSA9PT0gJ3llcycpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0cnVlIGJpZGkgbW9kZSBpcyBlbmFibGVkLlxyXG4gICAgICAgIHRoaXMuY29sb3IgPSB0aGlzLmV4cGVyaW1lbnQudmFycy5mb3JlZ291bmQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcmVncm91bmQgY29sb3Igb2YgY2FudmFzLlxyXG4gICAgICAgIHRoaXMuZmlsbCA9IGZhbHNlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRydWUgZmlsbCBtb2RlIGlzIHVzZWQuXHJcbiAgICAgICAgdGhpcy5mb250X2JvbGQgPSAodGhpcy5leHBlcmltZW50LnZhcnMuZm9udF9ib2xkID09PSAneWVzJyk7ICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdHJ1ZSBmb250IHN0eWxlIGJvbGQgaXMgZW5hYmxlZC5cclxuICAgICAgICB0aGlzLmZvbnRfZmFtaWx5ID0gKHRoaXMuZXhwZXJpbWVudC52YXJzLmZvbnRfZmFtaWx5KTsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGYW1pbHkgbmFtZSBvZiB0aGUgZm9udCB1c2VkLlxyXG4gICAgICAgIHRoaXMuZm9udF9pdGFsaWMgPSAodGhpcy5leHBlcmltZW50LnZhcnMuZm9udF9pdGFsaWMgPT09ICd5ZXMnKTsgICAgICAgICAgICAgICAgIC8vIElmIHRydWUgZm9udCBzdHlsZSBpdGFsaWMgaXMgZW5hYmxlZC5cclxuICAgICAgICB0aGlzLmZvbnRfc2l6ZSA9ICh0aGlzLmV4cGVyaW1lbnQudmFycy5mb250X3NpemUpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTaXplIG9mIHRoZSBmb250IGluIHBpeGVscy5cclxuICAgICAgICB0aGlzLmZvbnRfdW5kZXJsaW5lID0gKHRoaXMuZXhwZXJpbWVudC52YXJzLmZvbnRfdW5kZXJsaW5lID09PSAneWVzJyk7ICAgICAgICAgICAvLyBJZiB0cnVlIGZvbnQgc3R5bGUgdW5kZXJsaW5lIGlzIGVuYWJsZWQuXHJcbiAgICAgICAgdGhpcy5odG1sID0gdHJ1ZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdHJ1ZSBodG1sIGlzIHVzZWQgKG5vdCBzdXBwb3J0ZWQgeWV0KS5cclxuICAgICAgICB0aGlzLnBlbndpZHRoID0gMTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZhdWx0IHBlbndpZHRoIGZvciBkcmF3aW5nIHNoYXBlcy4gXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHRoZSBwcml2YXRlIHByb3BlcnRpZXMuICBcclxuICAgIFx0dGhpcy5fY29udGFpbmVyID0gbmV3IGNyZWF0ZWpzLkNvbnRhaW5lcigpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRUFTRUxKUzogQ29udGFpbmVyIHdoaWNoIGhvbGRzIHRoZSBzaGFwZXNcclxuICAgICAgICB0aGlzLl9mb250X3N0cmluZyA9ICdib2xkIDE4cHggQ291cmllciBOZXcnOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFQVNFTEpTOiBEZWZhdWx0IGZvbnQgZGVmaW5pdGlvbiBzdHJpbmcuXHJcblx0dGhpcy5faGVpZ2h0ID0gb3N3ZWIucnVubmVyLl9jYW52YXMuaGVpZ2h0OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGVpZ2h0IG9mIHRoZSBIVE1MIGNhbnZhcyB1c2VkIGZvciBkcmF3aW5nLlxyXG5cdHRoaXMuX3dpZHRoID0gb3N3ZWIucnVubmVyLl9jYW52YXMud2lkdGg7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdpZHRoIG9mIHRoZSBIVE1MIGNhbnZhcyB1c2VkIGZvciBkcmF3aW5nLlxyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IGNhbnZhcy5wcm90b3R5cGU7XHJcbiAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5hdXRvX3ByZXBhcmU9IGZhbHNlO1xyXG4gICAgcC5leHBlcmltZW50ID0gbnVsbDtcclxuICAgIHAudW5pZm9ybV9jb29yZGluYXRlcyA9IGZhbHNlO1xyXG5cdFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMuIFxyXG4gICAgXHJcbiAgICBwLl9hcnJvd19zaGFwZSA9IGZ1bmN0aW9uKHN4LCBzeSwgZXgsIGV5LCBib2R5X2xlbmd0aCwgYm9keV93aWR0aCwgaGVhZF93aWR0aCkge1xyXG4gICAgICAgIC8vIExlbmd0aFxyXG4gICAgICAgIHZhciBkID0gTWF0aC5zcXJ0KE1hdGgucG93KGV5IC0gc3ksMikgKyBNYXRoLnBvdyhzeCAtIGV4LDIpKTtcclxuICAgICAgICB2YXIgYW5nbGUgPSBNYXRoLmF0YW4yKGV5IC0gc3ksIGV4IC0gc3gpO1xyXG5cdHZhciBfaGVhZF93aWR0aCA9ICgxIC0gYm9keV93aWR0aCkgLyAyLjA7XHJcblx0Ym9keV93aWR0aCA9IGJvZHlfd2lkdGggLyAyLjA7XHJcblx0XHJcbiAgICAgICAgLy8gY2FsY3VsYXRlIGNvb3JkaW5hdGVzXHJcblx0dmFyIHA0ID0gW2V4LCBleV07XHJcblx0dmFyIHAxID0gW3N4ICsgYm9keV93aWR0aCAqIGhlYWRfd2lkdGggKiBNYXRoLmNvcyhhbmdsZSAtIE1hdGguUEkgLyAyKSwgc3kgKyBib2R5X3dpZHRoICogaGVhZF93aWR0aCAqIE1hdGguc2luKGFuZ2xlIC0gTWF0aC5QSSAvIDIpXTtcclxuXHR2YXIgcDIgPSBbcDFbMF0gKyBib2R5X2xlbmd0aCAqIE1hdGguY29zKGFuZ2xlKSAqIGQsIHAxWzFdICsgYm9keV9sZW5ndGggKiBNYXRoLnNpbihhbmdsZSkgKiBkXTtcclxuXHR2YXIgcDMgPSBbcDJbMF0gKyBfaGVhZF93aWR0aCAqIGhlYWRfd2lkdGggKiBNYXRoLmNvcyhhbmdsZSAtIE1hdGguUEkgLyAyKSwgcDJbMV0gKyBfaGVhZF93aWR0aCAqIGhlYWRfd2lkdGggKiBNYXRoLnNpbihhbmdsZSAtIE1hdGguUEkgLyAyKV07XHJcblx0dmFyIHA3ID0gW3N4ICsgYm9keV93aWR0aCAqIGhlYWRfd2lkdGggKiBNYXRoLmNvcyhhbmdsZSArIE1hdGguUEkgLyAyKSwgc3kgKyBib2R5X3dpZHRoICogaGVhZF93aWR0aCAqIE1hdGguc2luKGFuZ2xlICsgTWF0aC5QSSAvIDIpXTtcclxuXHR2YXIgcDYgPSBbcDdbMF0gKyBib2R5X2xlbmd0aCAqIE1hdGguY29zKGFuZ2xlKSAqIGQsIHA3WzFdICsgYm9keV9sZW5ndGggKiBNYXRoLnNpbihhbmdsZSkgKiBkXTtcclxuXHR2YXIgcDUgPSBbcDZbMF0gKyBfaGVhZF93aWR0aCAqIGhlYWRfd2lkdGggKiBNYXRoLmNvcyhhbmdsZSArIE1hdGguUEkgLyAyKSwgcDZbMV0gKyBfaGVhZF93aWR0aCAqIGhlYWRfd2lkdGggKiBNYXRoLnNpbihhbmdsZSArIE1hdGguUEkgLyAyKV07XHJcblx0XHJcbiAgICAgICAgcmV0dXJuIFtwMSwgcDIsIHAzLCBwNCwgcDUsIHA2LCBwN107XHJcbiAgICB9OyAgICBcclxuICAgICAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMuIFxyXG4gICAgXHJcbiAgICBwLmFycm93ID0gZnVuY3Rpb24gKHN4LCBzeSwgZXgsIGV5LCBjb2xvciwgcGVud2lkdGgsIGJvZHlfbGVuZ3RoLCBib2R5X3dpZHRoLCBoZWFkX3dpZHRoLCBmaWxsKSB7XHJcbiAgICAgICAgdmFyIHBvaW50cyA9IHRoaXMuX2Fycm93X3NoYXBlKHN4LCBzeSwgZXgsIGV5LCBib2R5X3dpZHRoLCBib2R5X2xlbmd0aCwgaGVhZF93aWR0aCk7XHJcbiAgICBcdHZhciBzaGFwZSA9IG5ldyBjcmVhdGVqcy5TaGFwZSgpO1xyXG5cdHNoYXBlLmdyYXBoaWNzLnNldFN0cm9rZVN0eWxlKHBlbndpZHRoKTtcclxuXHRzaGFwZS5ncmFwaGljcy5iZWdpblN0cm9rZShjb2xvcik7XHJcbiAgICAgICAgXHJcbiAgICAgICAgc2hhcGUuZ3JhcGhpY3MubW92ZVRvKHBvaW50c1swXVswXSxwb2ludHNbMF1bMV0pO1xyXG5cdHNoYXBlLmdyYXBoaWNzLmxpbmVUbyhwb2ludHNbMV1bMF0scG9pbnRzWzFdWzFdKTtcclxuXHRzaGFwZS5ncmFwaGljcy5saW5lVG8ocG9pbnRzWzJdWzBdLHBvaW50c1syXVsxXSk7XHJcblx0c2hhcGUuZ3JhcGhpY3MubGluZVRvKHBvaW50c1szXVswXSxwb2ludHNbM11bMV0pO1xyXG5cdHNoYXBlLmdyYXBoaWNzLmxpbmVUbyhwb2ludHNbNF1bMF0scG9pbnRzWzRdWzFdKTtcclxuXHRzaGFwZS5ncmFwaGljcy5saW5lVG8ocG9pbnRzWzVdWzBdLHBvaW50c1s1XVsxXSk7XHJcblx0c2hhcGUuZ3JhcGhpY3MubGluZVRvKHBvaW50c1s2XVswXSxwb2ludHNbNl1bMV0pO1xyXG5cdHNoYXBlLmdyYXBoaWNzLmxpbmVUbyhwb2ludHNbMF1bMF0scG9pbnRzWzBdWzFdKTtcclxuXHRcclxuICAgICAgIFx0Ly8gQWRkIHRoZSBsaW5lIGl0ZW0gdG8gY29udGFpbmVyLlxyXG5cdHRoaXMuX2NvbnRhaW5lci5hZGRDaGlsZChzaGFwZSk7IFxyXG4gICAgfTsgXHJcbiAgICBcdFx0XHJcbiAgICBwLmNpcmNsZSA9IGZ1bmN0aW9uKHgsIHksIHIsIGZpbGwsIGNvbG9yLCBwZW53aWR0aCkge1xyXG5cdHZhciBzaGFwZSA9IG5ldyBjcmVhdGVqcy5TaGFwZSgpO1xyXG5cdHNoYXBlLmdyYXBoaWNzLnNldFN0cm9rZVN0eWxlKHBlbndpZHRoKTtcclxuXHRzaGFwZS5ncmFwaGljcy5iZWdpblN0cm9rZShjb2xvcik7XHJcblx0aWYgKGZpbGwgPT0gMSlcclxuXHR7XHJcbiAgICAgICAgICAgIHNoYXBlLmdyYXBoaWNzLmJlZ2luRmlsbChjb2xvcik7XHJcblx0fVxyXG5cdHNoYXBlLmdyYXBoaWNzLmRyYXdDaXJjbGUoeCwgeSwgcik7XHJcblx0XHRcclxuXHQvLyBBZGQgdGhlIGxpbmUgaXRlbSB0byBjb250YWluZXIuXHJcblx0dGhpcy5fY29udGFpbmVyLmFkZENoaWxkKHNoYXBlKTsgXHJcbiAgICB9O1xyXG5cclxuICAgIHAuY2xlYXIgPSBmdW5jdGlvbihiYWNrcm91bmRfY29sb3IpIHtcclxuXHQvLyBSZW1vdmUgdGhlIGNvbnRhaW5lciBmcm9tIHRoZSBzdGFnZSBvYmplY3QuXHJcblx0b3N3ZWIucnVubmVyLl9zdGFnZS5yZW1vdmVDaGlsZCh0aGlzLl9jb250YWluZXIpO1xyXG5cdFxyXG4gICAgICAgIC8vIFJlbW92ZSB0aGUgY2hpbGRyZW4gZnJvbSB0aGUgY29udGFpbmVyLlxyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNsb3NlX2Rpc3BsYXkgPSBmdW5jdGlvbihleHBlcmltZW50KSB7XHJcbiAgICAgICAgb3N3ZWIuZGVidWcuYWRkTWVzc2FnZShvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDcgKyAnY2FudmFzLmNsb3NlX2Rpc3BsYXkoKS4nKTtcclxuICAgIH07XHJcblxyXG4gICAgcC5jb3B5ID0gZnVuY3Rpb24oY2FudmFzKSB7XHJcbiAgICAgICAgb3N3ZWIuZGVidWcuYWRkTWVzc2FnZShvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDcgKyAnY2FudmFzLmNvcHkoKS4nKTtcclxuICAgIH07XHJcblxyXG4gICAgcC5lbGxpcHNlID0gZnVuY3Rpb24oeCwgeSwgdywgaCwgZmlsbCwgY29sb3IsIHBlbndpZHRoKSB7XHJcblx0dmFyIHNoYXBlID0gbmV3IGNyZWF0ZWpzLlNoYXBlKCk7XHJcblx0c2hhcGUuZ3JhcGhpY3Muc2V0U3Ryb2tlU3R5bGUocGVud2lkdGgpO1xyXG5cdHNoYXBlLmdyYXBoaWNzLmJlZ2luU3Ryb2tlKGNvbG9yKTtcclxuXHRpZiAoZmlsbCA9PSAxKVxyXG5cdHtcclxuICAgICAgICAgICAgc2hhcGUuZ3JhcGhpY3MuYmVnaW5GaWxsKGNvbG9yKTtcclxuXHR9XHJcblx0c2hhcGUuZ3JhcGhpY3MuZHJhd0VsbGlwc2UoeCwgeSwgdywgaCk7IFxyXG5cclxuXHQvLyBBZGQgdGhlIHRleHQgaXRlbSB0byB0aGUgcGFydGVuIGZyYW1lLlxyXG5cdHRoaXMuX2NvbnRhaW5lci5hZGRDaGlsZChzaGFwZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZml4ZG90ID0gZnVuY3Rpb24oeCwgeSwgY29sb3IsIHN0eWxlKSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgdGhlIGNvbG9yIGFuZCBzdHlsZSBhcmd1bWVudHMuICAgICAgXHJcbiAgICAgICAgY29sb3IgPSAodHlwZW9mIGNvbG9yID09PSAndW5kZWZpbmVkJykgPyAnd2hpdGUnIDogY29sb3I7XHJcbiAgICAgICAgc3R5bGUgPSAodHlwZW9mIHN0eWxlID09PSAndW5kZWZpbmVkJykgPyAnZGVmYXVsdCcgOiBzdHlsZTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAodHlwZW9mIHggPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnVuaWZvcm1fY29vcmRpbmF0ZXMgPT09IHRydWUpIHtcclxuXHRcdHggPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgeCA9IHRoaXMuX3dpZHRoIC8gMjtcclxuICAgICAgICAgICAgfVxyXG5cdH1cclxuXHRpZiAodHlwZW9mIHkgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnVuaWZvcm1fY29vcmRpbmF0ZXMgPT09IHRydWUpIHtcclxuXHRcdHkgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG5cdFx0eSA9IHRoaXMuX2hlaWdodCAvIDI7XHJcbiAgICAgICAgICAgIH1cdFxyXG5cdH1cclxuXHRcdFxyXG5cdHZhciBzID0gNDtcclxuXHR2YXIgaCA9IDI7XHJcblx0aWYgKHN0eWxlLmluZGV4T2YoJ2xhcmdlJykgIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHMgPSAxNjtcclxuXHR9XHJcblx0ZWxzZSBpZiAoKHN0eWxlLmluZGV4T2YoJ21lZGl1bScpICE9PSAtMSkgfHwgKHN0eWxlID09PSAnZGVmYXVsdCcpKSB7XHJcbiAgICAgICAgICAgIHMgPSA4O1xyXG5cdH1cclxuXHRlbHNlIGlmIChzdHlsZS5pbmRleE9mKCdzbWFsbCcpICE9PSAtMSkge1xyXG4gICAgICAgICAgICBzID0gNDtcclxuXHR9XHJcblx0ZWxzZSB7XHJcbiAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKCdVbmtub3duIHN0eWxlOiAnICsgc3R5bGUpO1xyXG5cdH1cdFxyXG5cdFx0XHJcblx0aWYgKChzdHlsZS5pbmRleE9mKCdvcGVuJykgIT09IC0xKSB8fCAoc3R5bGUgPT09ICdkZWZhdWx0JykpIHtcdFxyXG4gICAgICAgICAgICB0aGlzLmVsbGlwc2UoeCAtIHMsIHkgLSBzLCAyICogcywgMiAqIHMsIDEsIGNvbG9yLCAxKTtcclxuICAgICAgICAgICAgdGhpcy5lbGxpcHNlKHggLSBoLCB5IC0gaCwgMiAqIGgsIDIgKiBoLCAxLCAnYmxhY2snLCAxKTtcclxuXHR9XHJcblx0ZWxzZSBpZiAoc3R5bGUuaW5kZXhPZignZmlsbGVkJykgIT09IC0xKVx0e1x0XHJcbiAgICAgICAgICAgIHRoaXMuZWxsaXBzZSh4IC0gcywgeSAtIHMsIDIgKiBzLCAyICogcywgMSwgY29sb3IsIDEpO1xyXG5cdH1cclxuICAgICAgICBlbHNlIGlmIChzdHlsZS5pbmRleE9mKCdjcm9zcycpICE9PSAtMSlcdHtcclxuICAgICAgICAgICAgdGhpcy5saW5lKHgsIHkgLSBzLCB4LCB5ICsgcyk7XHJcbiAgICAgICAgICAgIHRoaXMubGluZSh4IC0gcywgeSwgeCArIHMsIHkpO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuICAgICAgICAgICAgb3N3ZWIuZGVidWcuYWRkRXJyb3IoJ1Vua25vd24gc3R5bGU6ICcgKyBzdHlsZSk7XHJcblx0fVx0XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZ2Fib3IgPSBmdW5jdGlvbih4LCB5LCBvcmllbnQsIGZyZXEsIGVudiwgc2l6ZSwgc3RkZXYsIHBoYXNlLCBjb2xvcjEsIGNvbG9yMiwgYmdtb2RlKSB7XHJcbiAgICAgICAgb3N3ZWIuZGVidWcuYWRkTWVzc2FnZShvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDcgKyAnY2FudmFzLmdhYm9yKCkuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuaGVpZ2h0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcdHJldHVybiB0aGlzLl9oZWlndGgoKTtcclxuICAgIH07XHJcblxyXG4gICAgcC5pbWFnZSA9IGZ1bmN0aW9uKGZuYW1lLCBjZW50ZXIsIHgsIHksIHNjYWxlKSB7XHJcblx0Ly8gU2V0IHRoZSBjbGFzcyBwcml2YXRlIHByb3BlcnRpZXMuIFxyXG5cdHZhciBpbWFnZSA9IG5ldyBjcmVhdGVqcy5CaXRtYXAoKTtcclxuICAgIGltYWdlLmltYWdlID0gZm5hbWUuZGF0YTtcclxuXHRpbWFnZS5zY2FsZVggPSBzY2FsZTtcclxuICAgICAgICBpbWFnZS5zY2FsZVkgPSBzY2FsZTtcclxuICAgICAgICBpbWFnZS5zbmFwVG9QaXhlbCA9IHRydWU7XHJcbiAgICAgICAgaW1hZ2UueCA9IHggLSAoKGltYWdlLmltYWdlLndpZHRoICAqIHNjYWxlKSAvIDIpO1xyXG4gICAgXHRpbWFnZS55ID0geSAtICgoaW1hZ2UuaW1hZ2UuaGVpZ2h0ICogc2NhbGUpIC8gMik7XHJcblx0XHJcblx0Ly8gQWRkIHRoZSB0ZXh0IGl0ZW0gdG8gdGhlIHBhcnRlbiBmcmFtZS5cclxuXHR0aGlzLl9jb250YWluZXIuYWRkQ2hpbGQoaW1hZ2UpO1xyXG4gICAgfTtcclxuXHRcclxuICAgIHAuaW5pdF9kaXNwbGF5ID0gZnVuY3Rpb24oZXhwZXJpbWVudCkge1xyXG5cdC8vIFNldCB0aGUgZGltZW5zaW9uIHByb3BlcnRpZXMuXHJcblx0dGhpcy5faGVpZ2h0ID0gZXhwZXJpbWVudC52YXJzLmhlaWdodDtcclxuICAgIFx0dGhpcy5fd2lkdGggID0gZXhwZXJpbWVudC52YXJzLndpZHRoO1xyXG5cdFxyXG5cdC8vIEluaXRpYWxpemUgdGhlIGRpc3BsYXkgZGltZW5zaW9ucy5cclxuXHRvc3dlYi5ydW5uZXIuX2NhbnZhcy5oZWlnaHQgPSBleHBlcmltZW50LnZhcnMuaGVpZ2h0O1xyXG5cdG9zd2ViLnJ1bm5lci5fY2FudmFzLndpZHRoICA9IGV4cGVyaW1lbnQudmFycy53aWR0aDtcclxuXHRcdFxyXG5cdC8vIEluaXRpYWxpemUgdGhlIGRpc3BsYXkgY29sb3IuXHJcblx0b3N3ZWIucnVubmVyLl9jYW52YXMuc3R5bGUuYmFja2dyb3VuZCA9IGV4cGVyaW1lbnQudmFycy5iYWNrZ3JvdW5kO1xyXG5cclxuICAgICAgICAvLyBTZXQgdGhlIGN1cnNvciB2aXNpYmlsaXR5IHRvIG5vbmUgKGRlZmF1bHQpLlxyXG4gICAgICAgIG9zd2ViLnJ1bm5lci5fY2FudmFzLnN0eWxlLmN1cnNvciA9ICdub25lJztcclxuXHJcbiAgICAgICAgLy8gU2V0IGZvY3VzIHRvIHRoZSBleHBlcmltZW50IGNhbnZhcy5cclxuICAgICAgICBvc3dlYi5ydW5uZXIuX2NhbnZhcy5mb2N1cygpOyBcclxuICAgIH07XHJcblxyXG4gICAgcC5saW5lID0gZnVuY3Rpb24oc3gsIHN5LCBleCwgZXksIGNvbG9yLCBwZW53aWR0aCkge1xyXG4gICAgXHR2YXIgc2hhcGUgPSBuZXcgY3JlYXRlanMuU2hhcGUoKTtcclxuXHRzaGFwZS5ncmFwaGljcy5zZXRTdHJva2VTdHlsZShwZW53aWR0aCk7XHJcblx0c2hhcGUuZ3JhcGhpY3MuYmVnaW5TdHJva2UoY29sb3IpO1xyXG5cdHNoYXBlLmdyYXBoaWNzLm1vdmVUbyhzeCwgc3kpO1xyXG5cdHNoYXBlLmdyYXBoaWNzLmxpbmVUbyhleCwgZXkpOyBcclxuXHJcblx0Ly8gQWRkIHRoZSBsaW5lIGl0ZW0gdG8gY29udGFpbmVyLi5cclxuXHR0aGlzLl9jb250YWluZXIuYWRkQ2hpbGQoc2hhcGUpOyBcclxuICAgIH07XHJcblx0XHJcbiAgICBwLm5vaXNlX3BhdGNoID0gZnVuY3Rpb24ocFgsIHBZLCBwRW52LCBwU2l6ZSwgcFN0ZGV2LCBwQ29sb3IxLCBwQ29sb3IyLCBwQmdtb2RlKSB7XHJcbiAgICAgICAgb3N3ZWIuZGVidWcuYWRkTWVzc2FnZShvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDcgKyAnY2FudmFzLm5vaXNlX3BhdGNoKCkuJyk7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC5wb2x5Z29uID0gZnVuY3Rpb24odmVydGljbGVzKSB7XHJcbiAgICAgICAgb3N3ZWIuZGVidWcuYWRkTWVzc2FnZShvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDcgKyAnY2FudmFzLnBvbHlnb24oKS4nKTtcclxuICAgIH07XHJcblx0XHJcbiAgICBwLnByZXBhcmUgPSBmdW5jdGlvbigpIHtcclxuICAgIH07XHJcblx0XHJcbiAgICBwLnJlY3QgPSBmdW5jdGlvbih4LCB5LCB3LCBoLCBmaWxsLCBjb2xvciwgcGVud2lkdGgpIHtcclxuICAgIFx0dmFyIHNoYXBlID0gbmV3IGNyZWF0ZWpzLlNoYXBlKCk7XHJcblx0c2hhcGUuZ3JhcGhpY3Muc2V0U3Ryb2tlU3R5bGUocGVud2lkdGgpO1xyXG5cdHNoYXBlLmdyYXBoaWNzLmJlZ2luU3Ryb2tlKGNvbG9yKTtcclxuXHRpZiAoZmlsbCA9PSAxKVxyXG5cdHtcclxuICAgICAgICAgICAgc2hhcGUuZ3JhcGhpY3MuYmVnaW5GaWxsKGNvbG9yKTtcclxuXHR9XHJcblx0c2hhcGUuZ3JhcGhpY3MucmVjdCh4LCB5LCB3LCBoKTsgXHJcblxyXG5cdC8vIEFkZCB0aGUgbGluZSBpdGVtIHRvIGNvbnRhaW5lci4uXHJcblx0dGhpcy5fY29udGFpbmVyLmFkZENoaWxkKHNoYXBlKTsgXHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC5zZXRfZm9udCA9IGZ1bmN0aW9uKGZhbWlseSwgc2l6ZSwgaXRhbGljLCBib2xkLCB1bmRlcmxpbmUpIHtcclxuICAgXHQvLyBEZWZpbmUgdGhlIHRoZSBmb250IHN0eWxlcy5cclxuICAgIFx0dmFyIGZvbnRfYm9sZCA9IChib2xkID09PSB0cnVlKSA/ICdib2xkICcgOiAnJztcclxuICAgICAgICB2YXIgZm9udF9pdGFsaWMgPSAoaXRhbGljID09PSB0cnVlKSA/ICdpdGFsaWMgJyA6ICcnO1xyXG4gICAgICAgIHZhciBmb250X3VuZGVybGluZSA9ICh1bmRlcmxpbmUgPT09IHRydWUpID8gJ3VuZGVybGluZSAnIDogJyc7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHRoZSBmb250IHN0cmluZy5cclxuICAgICAgICB0aGlzLl9mb250X3N0cmluZyA9IGZvbnRfYm9sZCArIGZvbnRfaXRhbGljICsgZm9udF91bmRlcmxpbmUgKyBzaXplICsgJ3B4ICcgKyBmYW1pbHk7IFxyXG4gICAgIH07XHJcbiAgICAgICAgXHJcbiAgICBwLnNob3cgPSBmdW5jdGlvbigpIHtcclxuICAgIFx0Ly8gQWRkIHRoZSBjb250YWluZXIgdG8gdGhlIHN0YWdlIG9iamVjdCBhbmQgdXBkYXRlIHRoZSBzdGFnZS5cclxuXHRvc3dlYi5ydW5uZXIuX3N0YWdlLmFkZENoaWxkKHRoaXMuX2NvbnRhaW5lcik7XHJcblx0b3N3ZWIucnVubmVyLl9zdGFnZS51cGRhdGUoKTsgXHJcblxyXG5cdC8vIFJldHVybiB0aGUgY3VycmVudCB0aW1lLlxyXG5cdGlmICh0aGlzLmV4cGVyaW1lbnQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5leHBlcmltZW50LmNsb2NrLnRpbWUoKTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgICAgIGVsc2UgeyAgICBcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHRcclxuICAgIHAuc2l6ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgXHQvLyBDcmVhdGUgb2JqZWN0IHR1cGxlLlxyXG4gICAgXHR2YXIgc2l6ZSA9IHt3aWR0aDogdGhpcy5fd2lkdGgsIGhlaWdodDogdGhpcy5faGVpZ2h0fTtcclxuXHRyZXR1cm4gc2l6ZTtcclxuICAgIH07XHJcblx0XHJcbiAgICBwLnRleHQgPSBmdW5jdGlvbih0ZXh0LCBjZW50ZXIsIHgsIHkgLCBjb2xvciwgaHRtbCkge1xyXG5cdC8vIENyZWF0ZSB0aGUgdGV4dCBlbGVtZW50LiAgICAgICAgICBcclxuXHR2YXIgdGV4dF9lbGVtZW50ID0gbmV3IGNyZWF0ZWpzLlRleHQodGV4dCwgdGhpcy5fZm9udF9zdHJpbmcsIGNvbG9yKTtcclxuXHJcblx0Ly8gU2V0IHRoZSB0ZXh0IGVsZW1lbnQgcHJvcGVydGllcy5cclxuXHR0ZXh0X2VsZW1lbnQueCA9IHggLSAodGV4dF9lbGVtZW50LmdldE1lYXN1cmVkV2lkdGgoKSAvIDIpO1xyXG5cdHRleHRfZWxlbWVudC55ID0geSAtICh0ZXh0X2VsZW1lbnQuZ2V0TWVhc3VyZWRIZWlnaHQoKSAvIDIpO1xyXG5cdFx0IFxyXG5cdC8vIEFkZCB0aGUgdGV4dCBpdGVtIHRvIHRoZSBwYXJ0ZW4gZnJhbWUuXHJcblx0dGhpcy5fY29udGFpbmVyLmFkZENoaWxkKHRleHRfZWxlbWVudCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAudGV4dF9zaXplID0gZnVuY3Rpb24odGV4dCwgbWF4X3dpZHRoLCBzdHlsZV9hcmdzKSB7XHJcbiAgICAgICAgLy8gUmV0dXJuIHRoZSB0ZXh0IHNpemUgaW4gcGl4ZWxzLlxyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ2NhbnZhcy50ZXh0X3NpemUoKS4nKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgY2FudmFzIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5jYW52YXMgPSBjYW52YXM7XHJcbn0oKSk7XHJcblxyXG4iLCJcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgY2xvY2suXHJcbiAgICBmdW5jdGlvbiBjbG9jayhleHBlcmltZW50KSB7XHJcbiAgICAgICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIHByb3BlcnRpZXMuIFxyXG4gICAgICAgIHRoaXMuX3N0YXJ0VGltZSA9IHRoaXMuX25vdygpOyAgICAgICAgICAgICAgICAgICAgIC8vIFN0YXJ0IHRpbWUgYW5jaG9yIG9mIHRoZSBleHBlcmltZW50LlxyXG5cdFx0XHJcbiAgICAgICAgLy8gU2V0IHRoZSBjbGFzcyBwdWJsaWMgcHJvcGVydGllcy4gXHJcblx0dGhpcy5leHBlcmltZW50ID0gZXhwZXJpbWVudDsgICAgICAgICAgICAgICAgICAgICAgLy8gQW5jaG9yIHRvIHRoZSBleHBlcmltZW50IG9iamVjdC5cclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBjbG9jay5wcm90b3R5cGU7XHJcbiAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5leHBlcmltZW50ID0gbnVsbDtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcy4gICBcclxuICAgIFxyXG4gICAgcC5fbm93ID0gZnVuY3Rpb24oKSB7XHJcblx0Ly8gR2V0IHRoZSBjdXJyZW50IHRpbWUgc3RhbXAgdXNpbmcgdGhlIGJlc3QgYXZhaWxhYmxlIHRpbWluZyBtZXRob2QuXHJcblx0aWYgKHdpbmRvdy5wZXJmb3JtYW5jZS5ub3cpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQod2luZG93LnBlcmZvcm1hbmNlLm5vdygpKTtcclxuXHR9IFxyXG5cdGVsc2UgaWYgKHdpbmRvdy5wZXJmb3JtYW5jZS53ZWJraXROb3cpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQod2luZG93LnBlcmZvcm1hbmNlLndlYmtpdE5vdygpKTtcclxuXHR9IFxyXG5cdGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcblx0fVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzLiAgIFxyXG5cclxuICAgIHAuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIFNldCB0aGUgYWJzb2x1dGUgc3RhcnQgdGltZSBvZiB0aGUgZXhwZWlybWVudC5cclxuICAgICAgICB0aGlzLl9zdGFydFRpbWUgPSB0aGlzLl9ub3coKTtcclxuICAgIH07XHJcblxyXG4gICAgcC5zbGVlcCA9IGZ1bmN0aW9uKGR1cmF0aW9uKSB7XHJcbiAgICAgICAgLy8gU2xlZXBzIChwYXVzZXMpIGZvciBhIGR1cmF0aW9uIChpbiBtaWxsaXNlY29uZHMpLlxyXG5cdGlmICh0aGlzLmV4cGVyaW1lbnQgIT09ICBudWxsKSB7XHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgZXZlbnQgcHJvY2Vzc29yLlxyXG4gICAgICAgICAgICBvc3dlYi5ldmVudHMuX3J1bih0aGlzLCBkdXJhdGlvbiwgb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX0RVUkFUSU9OLCBudWxsKTtcclxuXHR9XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC50aW1lID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gR2l2ZXMgdGhlIGN1cnJlbnQgdGltZXN0YW1wIGluIG1pbGxpc2Vjb25kcy4gXHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXJ0VGltZSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9ub3coKSAtIHRoaXMuX3N0YXJ0VGltZSk7XHJcbiAgICAgICAgfSAgICBcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfSAgICBcclxuICAgIH07XHJcbiBcdFxyXG4gICAgLy8gQmluZCB0aGUgY2xvY2sgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmNsb2NrID0gY2xvY2s7XHJcbn0oKSk7XHJcblxyXG4iLCJcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3Mga2V5Ym9hcmQuXHJcbiAgICBmdW5jdGlvbiBrZXlib2FyZChleHBlcmltZW50LCB0aW1lb3V0LCBrZXlsaXN0KSB7XHJcbiAgICAgICAgLy8gU2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcblx0dGhpcy5leHBlcmltZW50ID0gZXhwZXJpbWVudDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBbmNob3IgdG8gdGhlIGV4cGVyaW1lbnQgb2JqZWN0LiBcclxuXHR0aGlzLmtleWxpc3QgPSAodHlwZW9mIGtleWxpc3QgPT09ICd1bmRlZmluZWQnKSA/IFtdIDoga2V5bGlzdDtcdCAgICAgICAvLyBMaXN0IG9mIGFjY2VwdGFibGUgcmVzcG9uc2Uga2V5cy4gXHJcblx0dGhpcy50aW1lb3V0ID0gKHR5cGVvZiB0aW1lb3V0ID09PSAndW5kZWZpbmVkJykgPyBudWxsIDogdGltZW91dDsgICAgICAvLyBEdXJhdGlvbiBpbiBtaWxsaXNlY29uZCBmb3IgdGltZS1vdXQuXHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0ga2V5Ym9hcmQucHJvdG90eXBlO1xyXG4gICAgXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZXhwZXJpbWVudCA9IG51bGw7XHJcbiAgICBwLmtleWxpc3QgPSBbXTtcclxuICAgIHAudGltZW91dCA9IG51bGw7XHJcblx0XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBzeW5vbmllbSBtYXAgZm9yIGFsbCBrZXlzLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgIHAuU1lOT05JRU1fTUFQID0gW1snICcsJ3NwYWNlJywnU1BBQ0UnXSxbJ1wiJywncXVvdGVkYmwnLCdRVU9URURCTCddLFsnIScsJ2V4Y2xhaW0nLCdFWENMQUlNJ10sWycjJywnaGFzaCcsJ0hBU0gnXSxcclxuICAgICAgICBbJyQnLCdkb2xsYXInLCdET0xMQVInXSxbJyYnLCdhbXBlcnNhbmQnLCdBTVBFUlNBTkQnXSxbXCInXCIsJ3F1b3RlJywnUVVPVEUnXSxbJygnLCdsZWZ0YnJhY2tldCcsJ2xlZnRwYXJlbicsJ0xFRlRCUkFDS0VUJywnTEVGVFBBUkVOJ10sXHJcbiAgICAgICAgWycpJywncmlnaHRicmFja2V0JywncmlnaHRwYXJlbicsJ1JJR0hUQlJBQ0tFVCcsJ1JJR0hUUEFSRU4nXSxbJyonLCdhc3RlcmlrcycsJ0FTVEVSSVNLJ10sWycrJywncGx1cycsJ1BMVVMnXSxbJywnLCdjb21tYScsJ0NPTU1BJ10sXHJcbiAgICAgICAgWyctJywnbWludXMnLCdNSU5VUyddLFsnLicsJ3BlcmlvZCcsJ1BFUklPRCddLFsnLycsJ3NsYXNoJywnU0xBU0gnXSxcclxuICAgICAgICBbJzEnXSxbJzInXSxbJzMnXSxbJzQnXSxbJzUnXSxbJzYnXSxbJzcnXSxbJzgnXSxbJzknXSxbJzAnXSxbJz0nLCdlcXVhbHMnLCdFUVVBTFMnXSxcclxuICAgICAgICBbJzonLCdjb2xvbicsJ0NPTE9OJ10sWyc7Jywnc2VtaWNvbG9uJywnU0VNSUNPTE9OJ10sWyc8JywnbGVzcycsJ0xFU1MnXSxbJz4nLCdncmVhdGVyJywnR1JFQVRFUiddLFxyXG4gICAgICAgIFsnPycsJ3F1ZXN0aW9uJywnUVVFU1RJT04nXSxbJ0AnLCdhdCcsJ0FUJ10sXHJcbiAgICAgICAgWydhJywnQSddLFsnYicsJ0InXSxbJ2MnLCdDJ10sWydkJywnRCddLFsnZScsJ0UnXSxbJ2YnLCdGJ10sXHJcbiAgICAgICAgWydnJywnRyddLFsnaCcsJ0gnXSxbJ2knLCdJJ10sWydqJywnSiddLFsnaycsJ0snXSxbJ2wnLCdMJ10sXHJcbiAgICAgICAgWydtJywnTSddLFsnbicsJ04nXSxbJ28nLCdPJ10sWydwJywnUCddLFsncScsJ1EnXSxbJ3InLCdSJ10sXHJcbiAgICAgICAgWydzJywnUyddLFsndCcsJ1QnXSxbJ3UnLCdVJ10sWyd2JywnViddLFsndycsJ1cnXSxbJ3gnLCdYJ10sXHJcbiAgICAgICAgWyd5JywnWSddLFsneicsJ1onXSxcclxuICAgICAgICBbJ2twMCcsJ0tQMCddLFsna3AxJywnS1AxJ10sWydrcDInLCdLUDInXSxbJ2twMycsJ0tQMyddLFsna3A0JywnS1A0J10sWydrcDUnLCdLUDUnXSxbJ2twNicsJ0tQNiddLFsna3A3JywnS1A3J10sWydrcDgnLCdLUDgnXSxbJ2twOScsJ0tQOSddLCAgXHJcbiAgICAgICAgWydrcF9kaXZpZGUnLCdLUF9ESVZJREUnXSxbJ2twX2VudGVyJywnS1BfRU5URVInXSxbJ2twX2VxdWFscycsJ0tQX0VRVUFMUyddLFsna3BfbWludXMnLCdLUF9NSU5VUyddLFsna3BfbXVsdGlwbHknLCdLUF9NVUxUSVBMWSddLFsna3BfcGVyaW9kJywnS1BfUEVSSU9EJ10sWydrcF9wbHVzJywnS1BfUExVUyddLFxyXG4gICAgICAgIFsnXFxcXCcsJ2JhY2tzbGFzaCcsJ0JBQ0tTTEFTSCddLFsnXicsJ3Bvd2VyJywnY2FyZXQnLCdQT1dFUicsJ0NBUkVUJ10sWydfJywndW5kZXJzY29yZScsJ1VOREVSU0NPUkUnXSxbJ2AnLCdiYWNrcXVvdGUnLCdCQUNLUVVPVEUnXSxcclxuICAgICAgICBbJ2YxJywnRjEnLCdoZWxwJywnSEVMUCddLFsnZjInLCdGMiddLFsnZjMnLCdGMyddLFsnZjQnLCdGNCddLFsnZjUnLCdGNSddLFsnZjYnLCdGNiddLFxyXG4gICAgICAgIFsnZjcnLCdGNyddLFsnZjgnLCdGOCddLFsnZjknLCdGOSddLFsnZjEwJywnRjEwJ10sWydmMTEnLCdGMTEnXSxbJ2YxMicsJ0YxMiddLFxyXG4gICAgICAgIFsnZjEzJywnRjEzJ10sWydmMTQnLCdGMTQnXSxbJ2YxNScsJ0YxNSddLFxyXG4gICAgICAgIFsndXAnLCdVUCddLFsnZG93bicsJ0RPV04nXSxbJ2xlZnQnLCdMRUZUJ10sWydyaWdodCcsJ1JJR0hUJ10sWydtZW51JywnTUVOVSddLFxyXG4gICAgICAgIFsnbHNoaWZ0JywnbGVmdCBzaGlmdCcsJ0xTSElGVCcsJ0xFRlQgU0hJRlQnXSxbJ2xjdHJsJywnbGVmdCBjdHJsJywnTENUUkwnLCdMRUZUIENUUkwnXSxbJ2xhbHQnLCdsZWZ0IGFsdCcsJ0xBTFQnLCdMRUZUIEFMVCddLFxyXG4gICAgICAgIFsncnNoaWZ0JywncmlnaHQgc2hpZnQnLCdSU0hJRlQnLCdSSUdIVCBTSElGVCddLFsncmN0cmwnLCdyaWdodCBjdHJsJywnUkNUUkwnLCdSSUdIVCBDVFJMJ10sWydyYWx0JywncmlnaHQgYWx0JywnYWx0IGdyJywnUkFMVCcsJ1JJR0hUIEFMVCcsJ0FMVCBHUiddLFxyXG4gICAgICAgIFsncGFnZSB1cCcsJ3BhZ2V1cCcsJ1BBR0UgVVAnLCdQQUdFVVAnXSxbJ3BhZ2UgZG93bicsJ3BhZ2Vkb3duJywnUEFHRSBET1dOJywnUEFHRURPV04nXSxbJ3BhdXNlJywnUEFVU0UnXSxcclxuICAgICAgICBbJ3Njcm9sbCBsb2NrJywnc2Nyb2xsb2NrJywnU0NST0xMIExPQ0snLCdTQ1JPTExPQ0snXSxbJ2NhcHMgbG9jaycsJ2NhcHNsb2NrJywnQ0FQUyBMT0NLJywnQ0FQU0xPQ0snXSxbJ251bW1sb2NrJywnTlVNTUxPQ0snXSxcclxuICAgICAgICBbJ2NsZWFyJywnQ0xFQVInXSxbJ2VudGVyJywnRU5URVInLCdyZXR1cm4nLCdSRVRVUk4nXSxbJ3RhYicsJ1RBQiddLFsnYmFja3NwYWNlJywnQkFDS1NQQUNFJ10sWydlbmQnLCdFTkQnXSxbJ2hvbWUnLCdIT01FJ10sWydpbnNlcnQnLCdJTlNFUlQnXSxbJ2RlbGV0ZScsJ0RFTEVURSddLFxyXG4gICAgICAgIFsnc3lzcmVxJywnc3lzIHJlcScsJ1NZU1JFUScsJ1NZUyBSRVEnXSxbJ2JyZWFrJywnQlJFQUsnXSxbJ2VzY2FwZScsJ0VTQ0FQRSddLFsncHJpbnQnLCdQUklOVCddLFsncHJpbnQgc2NyZWVuJywnUFJJTlQgU0NSRUVOJ10sXHJcbiAgICAgICAgWydsbWV0YScsJ2xlZnQgbWV0YScsJ0xNRVRBJywnTEVGVCBNRVRBJywsJ2xzdXBlcicsJ0xTVVBFUicsJ2xlZnQgc3VwZXInLCdMRUZUIFNVUEVSJ10sICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgWydybWV0YScsJ3JpZ2h0IG1ldGEnLCdSTUVUQScsJ1JJR0hUIE1FVEEnLCdyc3VwZXInLCdyaWdodCBzdXBlcicsJ1JTVVBFUicsJ1JJR0hUIFNVUEVSJ10sICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgLy8ga2V5IGRlZmluZWQgYmVsb3cgYXJlIG5vdCBzdXBwb3J0ZWQgeWV0LlxyXG4gICAgICAgIFsnZXVybycsJ0VVUk8nXSxbJ2ZpcnN0JywnRklSU1QnXSxbJ2xhc3QnLCdMQVNUJ10sWydrcCBlbnRlcicsJ0tQIEVOVEVSJ10sWydrcCBlcXVhbHMnLCdLUCBFUVVBTFMnXSxcclxuICAgICAgICBbJ21vZGUnLCdNT0RFJ10sWyd1bmtub3duJywnVU5LTk9XTiddLFsndW5rbm93biBrZXknLCdVTktOT1dOIEtFWSddXTsgIFxyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBtZXRob2RzLlxyXG5cclxuICAgIHAuX2dldF9kZWZhdWx0X2Zyb21fc3lub25pZW0gPSBmdW5jdGlvbihyZXNwb25zZXMpIHtcclxuICAgICAgICB2YXIgZGVmYXVsdHMgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDtpIDwgcmVzcG9uc2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBzeW5vbmllbSA9IHRoaXMuc3lub255bXMocmVzcG9uc2VzW2ldKTtcclxuICAgICAgICAgICAgZGVmYXVsdHMucHVzaChzeW5vbmllbVswXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkZWZhdWx0czsgICAgXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzLlxyXG5cclxuICAgIHAuZGVmYXVsdF9jb25maWcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBSZXR1cm4gdGhlIGRlZmF1bHQgY29uZmlndXJhdGlvbi5cclxuXHRyZXR1cm4geyd0aW1lb3V0JzogbnVsbCwgJ2tleWxpc3QnOiBbXX07XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBwLmZsdXNoID0gZnVuY3Rpb24oKSB7XHJcblx0Ly8gQ2xlYXIgYWxsIHBlbmRpbmcga2V5Ym9hcmQgaW5wdXQsIG5vdCBsaW1pdGVkIHRvIHRoZSBrZXlib2FyZC5cclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNyArICdrZXlib2FyZC5mbHVzaCgpLicpO1xyXG4gICAgfTtcclxuIFx0XHJcbiAgICBwLmdldF9rZXkgPSBmdW5jdGlvbih0aW1lb3V0LCBrZXlsaXN0KSB7XHJcblx0Ly8gQ29sbGVjdHMgYSBzaW5nbGUga2V5IHByZXNzLlxyXG5cdHRoaXMua2V5bGlzdCA9ICh0eXBlb2Yga2V5bGlzdCA9PT0gJ3VuZGVmaW5lZCcpID8gdGhpcy5rZXlsaXN0IDoga2V5bGlzdDtcdFxyXG5cdHRoaXMudGltZW91dCA9ICh0eXBlb2YgdGltZW91dCA9PT0gJ3VuZGVmaW5lZCcpID8gdGhpcy50aW1lb3V0IDogdGltZW91dDtcclxuXHRcdFxyXG5cdGlmICh0aGlzLmV4cGVyaW1lbnQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAvLyBTZXQgdGhlIGV2ZW50IHByb2Nlc3Nvci5cclxuICAgICAgICAgICAgb3N3ZWIuZXZlbnRzLl9ydW4odGhpcywgdGhpcy50aW1lb3V0LCBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfS0VZQk9BUkQsIHRoaXMua2V5bGlzdCk7XHJcblx0fTtcclxuICAgIH07XHJcblxyXG4gICAgcC5nZXRfbW9kcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgXHR2YXIgbW9kZXJhdG9ycyA9IFtdO1xyXG4gICAgICAgIGlmIChvc3dlYi5ldmVudHMuX2tleWJvYXJkX2V2ZW50ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlmIChvc3dlYi5ldmVudHMuX2tleWJvYXJkX2V2ZW50LnNoaWZ0S2V5ID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBtb2RlcmF0b3JzLnB1c2goJ3NoaWZ0Jyk7XHJcbiAgICAgICAgICAgIH07ICAgIFxyXG4gICAgICAgICAgICBpZiAob3N3ZWIuZXZlbnRzLl9rZXlib2FyZF9ldmVudC5jdHJsS2V5ID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBtb2RlcmF0b3JzLnB1c2goJ2N0cmwnKTtcclxuICAgICAgICAgICAgfTsgICAgXHJcbiAgICAgICAgICAgIGlmIChvc3dlYi5ldmVudHMuX2tleWJvYXJkX2V2ZW50LmFsdEtleSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgbW9kZXJhdG9ycy5wdXNoKCdhbHQnKTtcclxuICAgICAgICAgICAgfTsgICAgXHJcbiAgICAgICAgfSBcclxuICAgICAgICByZXR1cm4gbW9kZXJhdG9yczsgICAgXHJcbiAgICB9O1xyXG5cclxuICAgIHAuc2V0X2NvbmZpZyA9IGZ1bmN0aW9uKHRpbWVvdXQsIGtleWxpc3QpIHtcclxuXHQvLyBTZXQgdGhlIHByb3BlcnRpZXMuXHJcblx0dGhpcy5rZXlsaXN0ID0ga2V5bGlzdDtcdFxyXG5cdHRoaXMudGltZW91dCA9IHRpbWVvdXQ7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC5zaG93X3ZpcnR1YWxfa2V5Ym9hcmQgPSBmdW5jdGlvbih2aXNpYmxlKSB7XHJcbiAgICAgICAgLy8gU2hvd3Mgb3IgaGlkZXMgYSB2aXJ0dWFsIGtleWJvYXJkLlx0XHRcclxuICAgIFx0aWYgKHZpc2libGUgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgLy8gSGFjayB0byBzaG93IHRoZSB2aXJ1dGFsIGtleWJvYXJkLiAjIyBNdXN0IGJlIHRlc3RlZCFcclxuICAgICAgICAgICAgb3N3ZWIucnVubmVyLl9jYW52YXMuc2V0Zm9jdXMoKTtcclxuXHR9XHJcblx0ZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIEhhY2sgdG8gaGlkZSB0aGUgdmlydHVhbCBrZXlib2FyZC4gIyMgTXVzdCBiZSB0ZXN0ZWQhXHJcbiAgICAgICAgICAgIHZhciB0bXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodG1wKTtcclxuICAgICAgICAgICAgdG1wLmZvY3VzKCk7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodG1wKTtcclxuXHR9XHJcbiAgICB9O1xyXG5cclxuICAgIHAuc3lub255bXMgPSBmdW5jdGlvbihidXR0b24pIHtcclxuICAgICAgICBpZiAodHlwZW9mIGJ1dHRvbiAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7aSA8IHRoaXMuU1lOT05JRU1fTUFQLmxlbmd0aDtpKyspIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwO2ogPCB0aGlzLlNZTk9OSUVNX01BUFtpXS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLlNZTk9OSUVNX01BUFtpXVtqXSA9PSBidXR0b24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuU1lOT05JRU1fTUFQW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9ICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGtleWJvYXJkIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5rZXlib2FyZCA9IGtleWJvYXJkO1xyXG59KCkpO1xyXG4iLCJcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgbG9nLlxyXG4gICAgZnVuY3Rpb24gbG9nKGV4cGVyaW1lbnQsIHBhdGgpIHtcclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHByaXZhdGUgcHJvcGVydGllcy4gXHJcbiAgICBcdHRoaXMuX2FsbF92YXJzID0gbnVsbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRydWUgYWxsIHZhcmlhYmxlcyBhcmUgd3JpdHRlbiB0byB0aGUgbG9nLiAgXHJcblx0dGhpcy5faGVhZGVyX3dyaXR0ZW4gPSBmYWxzZTtcdCAgICAgICAgICAgICAgICAgICAvLyBJZiB0cnVlIHRoZSBoZWFkZXIgaGFzIGJlZW4gd3JpdHRlbiB0byB0aGUgbG9nLlxyXG5cdHRoaXMuX2xvZyA9IFtdOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFycmF5IGNvbnRhaW5pbmcgdGhlIGxvZyBlbnRyaWVzLlxyXG5cdHRoaXMuX3BhdGggPSAnJzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBhdGggdG8gd2ljaCB0aGUgbG9nIGlzIHdyaXR0ZW4uXHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuIFxyXG5cdHRoaXMuZXhwZXJpbWVudCA9IGV4cGVyaW1lbnQ7ICAgICAgICAgICAgICAgICAgICAgIC8vIEFuY2hvciB0byB0aGUgZXhwZXJpbWVudCBvYmplY3QuXHJcbiAgICBcdHRoaXMuZXhwZXJpbWVudC52YXJzLmxvZ2ZpbGUgPSBwYXRoOyAgICAgICAgICAgICAgIC8vIFN0b3JlIHRoZSBwYXRoIGxvY2F0aW9uIGludG8gdGhlIHZhcnMgbGlzdC4gICBcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBsb2cucHJvdG90eXBlO1xyXG4gICAgXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZXhwZXJpbWVudCA9IG51bGw7XHJcblx0XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzLiAgIFxyXG5cclxuICAgIHAuYWxsX3ZhcnMgPSBmdW5jdGlvbigpIHtcclxuXHQvLyBSZXRyaWV2ZXMgYSBsaXN0IG9mIGFsbCB2YXJpYWJsZXMgdGhhdCBleGlzdCBpbiB0aGUgZXhwZXJpbWVudC5cclxuXHRpZiAodGhpcy5fYWxsX3ZhcnMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5fYWxsX3ZhcnMgPSB0aGlzLmV4cGVyaW1lbnQudmFycy5pbnNwZWN0KCk7XHJcblx0fVxyXG5cdHJldHVybiB0aGlzLl9hbGxfdmFycztcclxuICAgIH07XHJcblxyXG4gICAgcC5jbG9zZSA9IGZ1bmN0aW9uKCkge1xyXG5cdC8vIENsb3NlcyB0aGUgY3VycmVudCBsb2cuXHJcblx0aWYgKHRoaXMuX2xvZy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIC8vIEVjaG8gdGhlIGRhdGEgdG8gdGhlIHJ1bm5lci5cclxuICAgICAgICAgICAgb3N3ZWIucnVubmVyLmRhdGEgPSB0aGlzLl9sb2cuam9pbignJyk7ICAgIFxyXG4gICAgICAgIH07XHJcblxyXG5cdC8vIENsZWFyIHRoZSBsb2cgZmlsZS5cclxuXHR0aGlzLl9sb2cgPSBbXTtcclxuICAgIH07XHJcblxyXG4gICAgcC5mbHVzaCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgXHQvLyBGbHVzaCB0aGUgbG9nIGZpbGUuXHJcbiAgICAgICAgdGhpcy5fbG9nID0gW107XHJcbiAgICB9O1xyXG5cclxuICAgIHAub3BlbiA9IGZ1bmN0aW9uKHBhdGgpIHtcdFxyXG5cdC8vIE9wZW5zIHRoZSBjdXJyZW50IGxvZy4gSWYgYSBsb2cgd2FzIGFscmVhZHkgb3BlbiwgaXQgaXMgY2xvc2VkLlxyXG5cdHRoaXMuX2hlYWRlcl93cml0dGVuID0gZmFsc2U7XHJcblx0dGhpcy5fcGF0aCA9IHBhdGg7IFxyXG5cdFxyXG5cdC8vIENoZWNrIGZvciBvbGQgZGF0YS5cclxuXHRpZiAodGhpcy5fbG9nICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIC8vIENsZWFyIHRoZSBvbGQgZGF0YS5cclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG5cdH1cclxuICAgIH07XHJcblxyXG4gICAgcC53cml0ZSA9IGZ1bmN0aW9uKG1zZywgbmV3X2xpbmUpIHtcclxuICAgIFx0Ly8gV3JpdGUgb25lIG1lc3NhZ2UgdG8gdGhlIGxvZy5cclxuXHRuZXdfbGluZSA9ICh0eXBlb2YgbmV3X2xpbmUgPT09ICd1bmRlZmluZWQnKSA/IHRydWUgOiBuZXdfbGluZTtcclxuXHRcclxuXHQvLyBXcml0ZSBhIG5ldyBsaW5lLlxyXG5cdGlmIChuZXdfbGluZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9sb2cucHVzaChtc2cgKyAnXFxuJyk7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBXcml0ZSB0aGUgTWVzc2FnZSBsaW5lLlxyXG4gICAgICAgICAgICB0aGlzLl9sb2cucHVzaChtc2cpO1xyXG5cdH1cclxuICAgIH07XHJcblxyXG4gICAgcC53cml0ZV92YXJzID0gZnVuY3Rpb24odmFyX2xpc3QpIHtcclxuICAgIFx0Ly8gV3JpdGVzIHZhcmlhYmxlcyB0byB0aGUgbG9nLlxyXG5cdHZhcl9saXN0ID0gKHR5cGVvZiB2YXJfbGlzdCA9PT0gJ3VuZGVmaW5lZCcpID8gbnVsbCA6IHZhcl9saXN0O1xyXG5cdFx0XHJcblx0dmFyIHZhbHVlOyBcclxuXHR2YXIgbCA9IFtdO1xyXG4gICAgICAgIC8vIElmIG5vIHZhciBsaXN0IGRlZmluZXMsIHJldHJpZXZlIGFsbCB2YXJpYWJsZS5cclxuXHRpZiAodmFyX2xpc3QgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB2YXJfbGlzdCA9IHRoaXMuYWxsX3ZhcnMoKTtcclxuXHR9XHJcblxyXG4gICAgICAgIC8vIFNvcnQgdGhlIHZhciBsaXN0LlxyXG4gICAgICAgIHZhcl9saXN0LnNvcnQoKTtcclxuICAgICAgICBcclxuXHQvLyBBZGQgdGhlIGhlYWRlciB0byB0aGUgbG9nIGZpbGUuXHJcbiAgICAgICAgaWYgKHRoaXMuX2hlYWRlcl93cml0dGVuID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhcl9saXN0Lmxlbmd0aDsgaSsrKSB7XHJcblx0XHRsLnB1c2goJ1wiJyArIHZhcl9saXN0W2ldICsgJ1wiJyk7XHJcbiAgICAgICAgICAgIH1cdFx0XHJcbiAgICAgICAgICAgIHRoaXMud3JpdGUobC5qb2luKCkpO1xyXG4gICAgICAgICAgICB0aGlzLl9oZWFkZXJfd3JpdHRlbiA9IHRydWU7XHJcblx0fVxyXG5cdFx0XHJcbiAgICAgICAgLy8gQWRkIHRoZSBkYXRhIGVudHJpZXMgdG8gdGhlIGxvZyBmaWxlLiAgICAgICAgXHJcbiAgICAgICAgbCA9IFtdO1xyXG5cdGZvciAodmFyIGkgPSAwOyBpIDwgdmFyX2xpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmV4cGVyaW1lbnQudmFycy5nZXQodmFyX2xpc3RbaV0sICdOQScsIGZhbHNlKTtcclxuICAgICAgICAgICAgbC5wdXNoKCdcIicgKyB2YWx1ZSArICdcIicpO1xyXG5cdH1cclxuICAgICAgICB0aGlzLndyaXRlKGwuam9pbigpKTtcclxuICAgIH07XHJcbiBcdFxyXG4gICAgLy8gQmluZCB0aGUgbG9nIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5sb2cgPSBsb2c7XHJcbn0oKSk7XHJcbiIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBtb3VzZS5cclxuICAgIGZ1bmN0aW9uIG1vdXNlKGV4cGVyaW1lbnQsIHRpbWVvdXQsIGJ1dHRvbmxpc3QsIHZpc2libGUpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gU2V0IHRoZSBjbGFzcyBwdWJsaWMgcHJvcGVydGllcy4gXHJcblx0dGhpcy5leHBlcmltZW50ID0gZXhwZXJpbWVudDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFuY2hvciB0byB0aGUgZXhwZXJpbWVudCBvYmplY3QuXHJcblx0dGhpcy50aW1lb3V0ID0gKHR5cGVvZiB0aW1lb3V0ID09PSAndW5kZWZpbmVkJykgPyBudWxsIDogdGltZW91dDsgICAgICAgICAgIC8vIER1cmF0aW9uIGluIG1pbGxpc2Vjb25kIGZvciB0aW1lLW91dC4gXHJcblx0dGhpcy5idXR0b25saXN0ID0gKHR5cGVvZiBidXR0b25saXN0ID09PSAndW5kZWZpbmVkJykgPyBudWxsIDogYnV0dG9ubGlzdDsgIC8vIExpc3Qgb2YgYWNjZXB0YWJsZSByZXNwb25zZSBidXR0b25zLlx0XHJcblx0dGhpcy52aXNpYmxlID0gKHR5cGVvZiB2aXNpYmxlID09PSAndW5kZWZpbmVkJykgPyBmYWxzZSA6IHZpc2libGU7XHQgICAgLy8gaWYgdHJ1ZSB0aGUgbW91c2UgY3Vyc29yIGlzIHZpc2libGUuXHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gbW91c2UucHJvdG90eXBlO1xyXG4gICAgXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZXhwZXJpbWVudCA9IG51bGw7XHJcbiAgICBwLmJ1dHRvbmxpc3QgPSBbXTtcclxuICAgIHAudGltZW91dCA9IC0xO1xyXG4gICAgcC52aXNpYmxlID0gZmFsc2U7XHJcblx0XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBzeW5vbmllbSBtYXAgZm9yIGFsbCBrZXlzLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgIHAuU1lOT05JRU1fTUFQID0gW1snMScsJ2xlZnRfYnV0dG9uJ10sIFsnMicsJ21pZGRsZV9idXR0b24nXSwgWyczJywncmlnaHRfYnV0dG9uJ10sIFsnNCcsJ3Njcm9sbF91cCddLCBbJzUnLCdzY3JvbGxfZG93biddXTtcclxuICAgICAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBtZXRob2RzLlxyXG5cclxuICAgIHAuX2dldF9kZWZhdWx0X2Zyb21fc3lub25pZW0gPSBmdW5jdGlvbihyZXNwb25zZXMpIHtcclxuICAgICAgICAvLyBSZXR1cm4gdGhlIGRlZmF1bHQgc3lub25pZW0gdmFsdWUgZnJvbSBhIHJlc3BvbnNlLlxyXG4gICAgICAgIHZhciBkZWZhdWx0cyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwO2kgPCByZXNwb25zZXMubGVuZ3RoO2krKykge1xyXG4gICAgICAgICAgICB2YXIgc3lub25pZW0gPSB0aGlzLnN5bm9ueW1zKHJlc3BvbnNlc1tpXSk7XHJcbiAgICAgICAgICAgIGRlZmF1bHRzLnB1c2goc3lub25pZW1bMF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZGVmYXVsdHM7ICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIGNsYXNzIHB1YmxpYyBtZXRob2RzLlxyXG4gICAgXHJcbiAgICBwLmRlZmF1bHRfY29uZmlnID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gUmV0dXJuIHRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24uXHJcbiAgICAgICAgcmV0dXJuIHsndGltZW91dCc6IG51bGwsICdidXR0b25saXN0JzogbnVsbCwgJ3Zpc2libGUnOiBmYWxzZX07XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZmx1c2ggPSBmdW5jdGlvbigpIHtcclxuXHQvLyBDbGVhcnMgYWxsIHBlbmRpbmcgbW91c2UgaW5wdXQsIG5vdCBsaW1pdGVkIHRvIHRoZSBtb3VzZS5cclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNyArICdtb3VzZS5mbHVzaCgpLicpO1xyXG4gICAgfTtcclxuIFx0XHJcbiAgICBwLmdldF9jbGljayA9IGZ1bmN0aW9uKHRpbWVvdXQsIGJ1dHRvbmxpc3QsIHZpc2libGUpIHtcclxuXHQvLyBDb2xsZWN0cyBhIHNpbmdsZSBtb3VzZSBjbGljay5cclxuXHR0aGlzLnRpbWVvdXQgPSAodHlwZW9mIHRpbWVvdXQgPT09ICd1bmRlZmluZWQnKSA/IHRoaXMudGltZW91dCA6IHRpbWVvdXQ7XHJcblx0dGhpcy5idXR0b25saXN0ID0gKHR5cGVvZiBidXR0b25saXN0ID09PSAndW5kZWZpbmVkJykgPyB0aGlzLmJ1dHRvbmxpc3QgOiBidXR0b25saXN0O1x0XHJcblx0dGhpcy52aXNpYmxlID0gKHR5cGVvZiB2aXNpYmxlID09PSAndW5kZWZpbmVkJykgPyB0aGlzLnZpc2libGUgOiB2aXNpYmxlO1x0XHJcblxyXG5cdGlmICh0aGlzLmV4cGVyaW1lbnQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAvLyBIaWRlIG9yIHNob3cgdGhlIG1vdXNlLlxyXG4gICAgICAgICAgICB0aGlzLnNob3dfY3Vyc29yKHRoaXMudmlzaWJsZSk7XHJcblx0XHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgZXZlbnQgcHJvY2Vzc29yLlxyXG4gICAgICAgICAgICBvc3dlYi5ldmVudHMuX3J1bih0aGlzLCB0aGlzLnRpbWVvdXQsIG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9NT1VTRSwgdGhpcy5idXR0b25saXN0KTtcclxuXHR9O1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmdldF9wb3MgPSBmdW5jdGlvbigpIHtcclxuICAgIFx0Ly8gUmV0dXJucyB0aGUgY3VycmVudCBtb3VzZSBwb3NpdGlvbi4gIVdhcm5pbmc6IHRoaXMgbWV0aG9kcyB1c2VzIHRoZSBzdGF0ZSBpbiB0aGUgbGFzdCBrbm93biBtb3VzZSByZXNwb25lLCBub3QgdGhlIGN1cnJlbnQgc3RhdGUuXHJcbiAgICAgICAgaWYgKG9zd2ViLmV2ZW50cy5fbW91c2VfbW92ZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4geydydFRpbWUnOiBvc3dlYi5ldmVudHMuX21vdXNlX21vdmUucnRUaW1lLCAneCc6IG9zd2ViLmV2ZW50cy5fbW91c2VfbW92ZS5ldmVudC5jbGllbnRYLCAneSc6IG9zd2ViLmV2ZW50cy5fbW91c2VfbW92ZS5ldmVudC5jbGllbnRZfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7J3J0VGltZSc6IC0xLCAneCc6IC0xLCAneSc6IC0xfTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICBwLmdldF9wcmVzc2VkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gUmV0dXJucyB0aGUgY3VycmVudCBidXR0b24gc3RhdGUgb2YgdGhlIG1vdXNlIGJ1dHRvbnMuICFXYXJuaW5nOiB0aGlzIG1ldGhvZHMgdXNlcyB0aGUgc3RhdGUgaW4gdGhlIGxhc3Qga25vd24gbW91c2UgcmVzcG9uZSwgbm90IHRoZSBjdXJyZW50IHN0YXRlLlxyXG4gICAgICAgIGlmIChvc3dlYi5ldmVudHMuX21vdXNlX3ByZXNzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7ICdidXR0b25zJzogWyhvc3dlYi5ldmVudHMuX21vdXNlX3ByZXNzLmJ1dHRvbiA9PT0gMCksIChvc3dlYi5ldmVudHMuX21vdXNlX3ByZXNzLmJ1dHRvbiA9PT0gMSksIChvc3dlYi5ldmVudHMuX21vdXNlX3ByZXNzLmJ1dHRvbiA9PT0gMildfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7ICdidXR0b25zJzogW251bGwsIG51bGwsIG51bGxdfTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICBwLnNldF9jb25maWcgPSBmdW5jdGlvbih0aW1lb3V0LCBidXR0b25saXN0LCB2aXNpYmxlKSB7XHJcblx0Ly8gU2V0IG1vdXNlIHByb3BlcnRpZXMuICAgICAgICAgIFxyXG5cdHRoaXMudGltZW91dCA9IHRpbWVvdXQ7XHJcblx0dGhpcy5idXR0b25saXN0ID0gYnV0dG9ubGlzdDtcdFxyXG5cdHRoaXMudmlzaWJsZSA9IHZpc2libGU7XHRcclxuICAgIH07XHJcblxyXG4gICAgcC5zZXRfcG9zID0gZnVuY3Rpb24ocG9zKSB7XHJcbiAgICBcdC8vIFJldHVybnMgdGhlIGN1cnJlbnQgcG9zaXRpb24gb2YgdGhlIGN1cnNvci5cdFxyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ21vdXNlLnNldF9wb3MoKS4nKTtcclxuICAgIH07XHJcblxyXG4gICAgcC5zaG93X2N1cnNvciA9IGZ1bmN0aW9uKHZpc2libGUpIHtcclxuICAgIFx0Ly8gU2V0IHRoZSBwcm9wZXJ0eVxyXG5cdHRoaXMudmlzaWJsZSA9IHZpc2libGU7XHJcblx0XHRcclxuXHQvLyBJbW1lZGlhdGVseSBjaGFuZ2VzIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBtb3VzZSBjdXJzb3IuXHRcclxuXHRpZiAodmlzaWJsZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAvLyBTaG93IHRoZSBtb3VzZSBjdXJzb3IuXHJcbiAgICAgICAgICAgIG9zd2ViLnJ1bm5lci5fc3RhZ2UuY2FudmFzLnN0eWxlLmN1cnNvciA9IFwiZGVmYXVsdFwiO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuICAgICAgICAgICAgLy8gU2V0IHRoZSBjdXJzb3IgdmlzaWJpbGl0eSB0byBub25lLlxyXG4gICAgICAgICAgICBvc3dlYi5ydW5uZXIuX3N0YWdlLmNhbnZhcy5zdHlsZS5jdXJzb3IgPSBcIm5vbmVcIjtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHAuc3lub255bXMgPSBmdW5jdGlvbihidXR0b24pXHJcbiAgICB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBidXR0b24gIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwO2kgPCB0aGlzLlNZTk9OSUVNX01BUC5sZW5ndGg7aSsrKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDtqIDwgdGhpcy5TWU5PTklFTV9NQVBbaV0ubGVuZ3RoO2orKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLlNZTk9OSUVNX01BUFtpXVtqXSA9PSBidXR0b24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuU1lOT05JRU1fTUFQW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9ICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIG1vdXNlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5tb3VzZSA9IG1vdXNlO1xyXG59KCkpOyBcclxuXHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBzYW1wbGVyLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBzYW1wbGVyKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5nZW5lcmljX3Jlc3BvbnNlX2NvbnN0cnVjdG9yKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCk7XHJcblxyXG4gICAgXHQvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgcHJvcGVydGllcy5cclxuICAgICAgICB0aGlzLl9zYW1wbGUgID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9zYW1wbGVyID0gbnVsbDtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhzYW1wbGVyLCBvc3dlYi5nZW5lcmljX3Jlc3BvbnNlKTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLlxyXG4gICAgcC5ibG9ja1x0ICA9IGZhbHNlO1xyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdQbGF5cyBhIHNvdW5kIGZpbGUgaW4gLndhdiBvciAub2dnIGZvcm1hdCc7XHJcbiAgICBcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gYnVpbGQgY3ljbGUuIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5yZXNldCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBSZXNldHMgYWxsIGl0ZW0gdmFyaWFibGVzIHRvIHRoZWlyIGRlZmF1bHQgdmFsdWUuXHJcblx0dGhpcy5ibG9jayAgICAgICAgICAgPSBmYWxzZTtcclxuXHR0aGlzLnZhcnMuc2FtcGxlICAgICA9ICcnO1xyXG5cdHRoaXMudmFycy5wYW4gICAgICAgID0gMDtcclxuXHR0aGlzLnZhcnMucGl0Y2ggICAgICA9IDE7XHJcblx0dGhpcy52YXJzLmZhZGVfaW4gICAgPSAwO1xyXG5cdHRoaXMudmFycy5zdG9wX2FmdGVyID0gMDtcclxuXHR0aGlzLnZhcnMudm9sdW1lICAgICA9IDE7XHJcblx0dGhpcy52YXJzLmR1cmF0aW9uICAgPSAnc291bmQnO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHJ1biBjeWNsZS4gXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnByZXBhcmUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBzYW1wbGVcclxuXHRpZiAodGhpcy52YXJzLnNhbXBsZSAhPSAnJylcclxuXHR7XHJcbiAgICAgICAgICAgIC8vIFJldHJpZXZlIHRoZSBjb250ZW50IGZyb20gdGhlIGZpbGUgcG9vbC5cclxuICAgICAgICAgICAgdGhpcy5fc2FtcGxlICAgICAgICAgPSBvc3dlYi5wb29sW3RoaXMuc3ludGF4LmV2YWxfdGV4dCh0aGlzLnZhcnMuc2FtcGxlKV07ICBcclxuICAgICAgICAgICAgdGhpcy5fc2FtcGxlciAgICAgICAgPSBuZXcgb3N3ZWIuc2FtcGxlcl9iYWNrZW5kKHRoaXMuZXhwZXJpbWVudCwgdGhpcy5fc2FtcGxlKTtcclxuICAgICAgICAgICAgdGhpcy5fc2FtcGxlci52b2x1bWUgPSB0aGlzLnZhcnMudm9sdW1lO1xyXG5cdH1cclxuXHRlbHNlXHJcblx0e1xyXG4gICAgICAgICAgICAvKiByYWlzZSBvc2V4Y2VwdGlvbihcclxuICAgICAgICAgICAgdSdObyBzYW1wbGUgaGFzIGJlZW4gc3BlY2lmaWVkIGluIHNhbXBsZXIgXCIlc1wiJyAlIHNlbGYubmFtZSkgKi9cclxuXHR9XHJcbiAgICBcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmdlbmVyaWNfcmVzcG9uc2VfcHJlcGFyZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnJ1biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0dGhpcy5zZXRfaXRlbV9vbnNldCgpO1xyXG5cdHRoaXMuc2V0X3NyaSgpO1xyXG5cdHRoaXMuX3NhbXBsZXIucGxheSgpO1xyXG5cdHRoaXMucHJvY2Vzc19yZXNwb25zZSgpO1xyXG4gICAgfTtcdFxyXG5cclxuICAgIC8vIEJpbmQgdGhlIHNhbXBsZXIgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnNhbXBsZXIgPSBvc3dlYi5wcm9tb3RlQ2xhc3Moc2FtcGxlciwgXCJnZW5lcmljX3Jlc3BvbnNlXCIpO1xyXG59KCkpO1xyXG4iLCJcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgdmlkZW8uXHJcbiAgICBmdW5jdGlvbiB2aWRlbyhleHBlcmltZW50LCBzcmMpIHtcclxuICAgICAgXHQvLyBTZXQgdGhlIGNsYXNzIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuXHR0aGlzLmV4cGVyaW1lbnQgPSBleHBlcmltZW50O1xyXG5cdFxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcGl2YXRlIHByb3BlcnRpZXMuIFxyXG4gICAgICAgIHRoaXMuX3BsYXlpbmcgPSBmYWxzZTsgXHJcbiAgICAgICAgdGhpcy5fc2NyaXB0ID0gbnVsbDtcclxuXHJcblx0Ly8gQ3JlYXRlIHRoZSB2aWRlbyBpbnN0YW5jZVxyXG5cdGlmIChzcmMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgLy8gU2V0IHRoZSB2aWRlbyBvYmplY3QuXHJcbiAgICAgICAgICAgIHRoaXMuX2N0eCA9IG9zd2ViLnJ1bm5lci5fY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZGVvID0gc3JjLmRhdGE7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTZXQgdGhlIGV2ZW50IGFuY2hvcnMuXHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZGVvLm9uKFwiZW5kZWRcIiwgb3N3ZWIuZXZlbnRzLl92aWRlb0VuZGVkLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICB0aGlzLl92aWRlby5vbihcInBsYXlcIiAsIG9zd2ViLmV2ZW50cy5fdmlkZW9QbGF5LmJpbmQodGhpcykpO1xyXG4gICAgXHR9XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gdmlkZW8ucHJvdG90eXBlO1xyXG4gICAgXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuYXVkaW8gPSB0cnVlO1xyXG4gICAgcC5kdXJhdGlvbiA9ICdrZXlwcmVzcyc7XHRcclxuICAgIHAuZnVsbF9zY3JlZW4gPSBmYWxzZTtcclxuICAgIFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMuXHJcbiAgICBcclxuICAgIHAuX3VwZGF0ZV92aWRlb19jYW52YXMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBDbGlwIHRoZSBjb250ZW50IG9mIHRoZSB2aWRlbyB0byB0aGUgY2FudmFzLlxyXG4gICAgICAgIGlmICh0aGlzLl9wbGF5aW5nID09PSB0cnVlKSB7ICAgIFxyXG4gICAgICAgICAgICB0aGlzLl9jdHguZHJhd0ltYWdlKHRoaXMuX3ZpZGVvLCAwLCAwKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGV4ZWN1dGUgc2NyaXB0LlxyXG4gICAgICAgICAgICBpZiAoKHRoaXMuX3NjcmlwdCAhPT0gbnVsbCkgJiYgKHRoaXMuX2V2ZW50X2hhbmRsZXJfYWx3YXlzID09PSB0cnVlKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHBhcnNlclxyXG4gICAgICAgICAgICAgICAgb3N3ZWIucGFyc2VyLl9ydW4obnVsbCwgdGhpcy5fc2NyaXB0KTsgICAgXHRcdFxyXG4gICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgIH0gICAgXHJcbiAgICB9OyAgICBcclxuICAgIFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcy5cclxuICAgIFxyXG4gICAgcC5wbGF5ID0gZnVuY3Rpb24oKSB7XHJcblx0Ly8gUGxheSB0aGUgYWN0dWFsIHZpZGVvLlxyXG4gICAgICAgIHRoaXMuX3ZpZGVvLnBsYXkoKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBTZXQgdGhlIHZvbHVtZVxyXG4gICAgICAgIHRoaXMuX3ZpZGVvLnZvbHVtZSA9ICh0aGlzLmF1ZGlvID09PSB0cnVlKSA/IDEgOiAwO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSB2aWRlbyBtdXN0IGJlIHNjYWxlZC5cclxuICAgICAgICBpZiAodGhpcy5mdWxsX3NjcmVlbiA9PSB0cnVlKSB7ICAgIFxyXG4gICAgICAgICAgICAvLyBEcmF3IHRoZSBmaXJzdCBpbWFnZSB3aXRoIHNjYWxpbmcuXHJcbiAgICAgICAgICAgIHZhciB4U2NhbGUgPSAodGhpcy5leHBlcmltZW50Ll9jYW52YXMuX3dpZHRoICAvIHRoaXMuX3ZpZGVvLnZpZGVvV2lkdGgpO1xyXG4gICAgICAgICAgICB2YXIgeVNjYWxlID0gKHRoaXMuZXhwZXJpbWVudC5fY2FudmFzLl9oZWlnaHQgLyB0aGlzLl92aWRlby52aWRlb0hlaWdodCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2N0eC5zY2FsZSh4U2NhbGUseVNjYWxlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gRHJhdyB0aGUgZmlyc3QgZnJhbWUuXHJcbiAgICAgICAgdGhpcy5fY3R4LmRyYXdJbWFnZSh0aGlzLl92aWRlbywgMCwgMCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHRoZSBwbGF5IHRvZ2dsZS5cclxuICAgICAgICB0aGlzLl9wbGF5aW5nID0gdHJ1ZTtcclxuICAgIH07XHJcblxyXG4gICAgcC5zdG9wID0gZnVuY3Rpb24oKSB7XHJcblx0Ly8gUGF1c2UgdGhlIGFjdHVhbCBzb3VuZC5cclxuXHR0aGlzLl92aWRlby5wYXVzZSgpO1xyXG4gICAgICAgIHRoaXMuX3BsYXlpbmcgPSBmYWxzZTtcclxuICAgIH07XHJcblxyXG4gICAgcC53YWl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gU2V0IHRoZSBibG9ja2luZyBvZiB0aGUgc291bmQuXHJcbiAgICAgICAgb3N3ZWIuZXZlbnRzLl9ydW4odGhpcywgLTEsIG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9WSURFTyxbXSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBCaW5kIHRoZSB2aWRlbyBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIudmlkZW9fYmFja2VuZCA9IHZpZGVvO1xyXG59KCkpO1xyXG4iLCJcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgZGVidWcuXHJcbiAgICBmdW5jdGlvbiBkZWJ1ZygpIHtcclxuICAgIFx0dGhyb3cgJ1RoZSBjbGFzcyBkZWJ1ZyBjYW5ub3QgYmUgaW5zdGFudGlhdGVkISc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwdWJsaWMgcHJvcGVydGllcy5cclxuICAgIGRlYnVnLmVuYWJsZWQgPSBmYWxzZTsgICAgICAgICAgICAgICAgICAgICAgICAvLyBFbmFibGUgdGhlIGRlYnVnZ2VyICBcclxuICAgIGRlYnVnLmVycm9yID0gZmFsc2U7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRydWUgaWYgYW4gZXJyb3Igb2NjdXJlZC5cclxuICAgIGRlYnVnLm1lc3NhZ2VMb2cgPSBuZXcgQXJyYXkoKTsgICAgICAgICAgICAgIC8vIEFycmF0eSB3aXRoIGFsbGUgbG9nIG1lc3NhZ2VzLlxyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgY2xhc3MgcHJpdmF0ZSBtZXRob2RzLiAgICAgICAgICAgICAgIFxyXG4gICBcclxuICAgIGRlYnVnLl9pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcdC8vIEVuYWJsZWQvZGlzYWJsZSB0aGUgZGVidWdnZXIuXHJcbiAgICBcdHRoaXMuZGVidWcgPSBvc3dlYi5ydW5uZXIuZGVidWc7XHJcbiAgICBcdC8vIENsZWFyIHRoZSBsb2cuXHJcbiAgICAgICAgdGhpcy5tZXNzYWdlTG9nID0gW107XHJcbiAgICB9O1x0XHJcblxyXG4gICAgZGVidWcuX2ZpbmFsaXplID0gZnVuY3Rpb24oKSB7XHJcblx0Ly8gSWYgZW5hYmxlZCBwdXNoIHRoZSBtZXNzYWdlcyB0byB0aGUgamF2YXNjcmlwdCBjb25zb2xlLlxyXG5cdGlmICh0aGlzLmVuYWJsZWQgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5tZXNzYWdlTG9nKTtcdFx0XHRcclxuXHR9XHJcblxyXG5cdC8vIENsZWFyIHRoZSBsb2cuXHJcblx0dGhpcy5tZXNzYWdlTG9nID0gW107XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgdGhlIHB1YmxpYyBtZXRob2RzLiAgICAgICAgICAgICAgIFxyXG4gICBcclxuICAgIGRlYnVnLmFkZEVycm9yID0gZnVuY3Rpb24oZXJyb3JfdGV4dCkge1xyXG4gICAgXHQvLyBTZXQgdGhlIGVycm9yIGZsYWcuXHJcbiAgICBcdHRoaXMuZXJyb3IgPSB0cnVlO1xyXG5cclxuICAgICAgICAvLyBTaG93IHRoZSBmYXRhbCBlcnJvciB3YXJuaW5nLlxyXG5cdGNvbnNvbGUubG9nKGVycm9yX3RleHQpO1xyXG5cdGNvbnNvbGUubG9nKG9zd2ViLmNvbnN0YW50cy5FUlJPUl8wMDEpO1xyXG5cclxuXHQvLyBUaHJvdyB0aGUgZXhjZXB0aW9uLlxyXG5cdHRocm93IG5ldyBFcnJvcihlcnJvcl90ZXh0KTtcdFxyXG4gICAgfTtcclxuXHRcclxuICAgIGRlYnVnLmFkZE1lc3NhZ2UgPSBmdW5jdGlvbihtZXNzYWdlX3RleHQpIHtcclxuICAgICAgICAvLyBQdXNoIHRoZSBlcnJvciBtZXNzYWdlIHRvIHRoZSBsb2cuXHJcblx0dGhpcy5tZXNzYWdlTG9nLnB1c2gobWVzc2FnZV90ZXh0KTtcdFx0XHJcblx0XHJcblx0aWYgKGRlYnVnLmVuYWJsZWQgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZV90ZXh0KTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICBkZWJ1Zy5tc2cgPSBmdW5jdGlvbihtZXNzYWdlX3RleHQpIHtcclxuXHQvLyBQdXNoIHRoZSBlcnJvciBtZXNzYWdlIHRvIHRoZSBsb2cuXHJcblx0dGhpcy5hZGRNZXNhZ2UobWVzc2FnZV90ZXh0KTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgZGVidWcgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmRlYnVnID0gZGVidWc7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBmaWxlX3Bvb2xfc3RvcmUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGZpbGVfcG9vbF9zdG9yZSgpXHJcbiAgICB7XHJcbiAgICBcdHRocm93IFwiVGhlIGNsYXNzIGZpbGVfcG9vbF9zdG9yZSBjYW5ub3QgYmUgaW5zdGFudGlhdGVkIVwiO1xyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgY2xhc3MgcHJvcGVydGllcy5cclxuICAgIGZpbGVfcG9vbF9zdG9yZS5fZGF0YSAgPSBbXTtcclxuICAgIGZpbGVfcG9vbF9zdG9yZS5faXRlbXMgPSBbXTsgIFxyXG5cdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHJpdmF0ZSBjbGFzcyBtZXRob2RzLiAgIFxyXG4gICAgICovXHJcblxyXG4gICAgZmlsZV9wb29sX3N0b3JlLmFkZF9mcm9tX2xvY2FsX3NvdXJjZSA9IGZ1bmN0aW9uKHBJdGVtKVxyXG4gICAge1xyXG4gICAgICAgIHZhciBleHQgPSBwSXRlbS5maWxlbmFtZS5zdWJzdHIocEl0ZW0uZmlsZW5hbWUubGFzdEluZGV4T2YoJy4nKSArIDEpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICgoZXh0ID09ICdqcGcnKSB8fCAoZXh0ID09ICdwbmcnKSlcclxuXHR7XHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIG5ldyBmaWxlIHBvb2wgbWFnZSBpdGVtLlxyXG4gICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XHJcbiAgICAgICAgICAgIGltZy5zcmMgPSBwSXRlbS50b0RhdGFVUkwoKTtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSB7ZGF0YTogaW1nLCBmb2xkZXI6IHBJdGVtLmZpbGVuYW1lLCBuYW1lOiBwSXRlbS5maWxlbmFtZS5yZXBsYWNlKC9eLipbXFxcXFxcL10vLCAnJyksIHNpemU6IHBJdGVtLmxlbmd0aCwgdHlwZTogJ2ltYWdlJ307XHJcblx0fVxyXG4gICAgICAgIGVsc2UgaWYgKChleHQgPT0gJ3dhdicpIHx8IChleHQgPT0gJ29nZycpKVxyXG5cdHtcclxuICAgICAgICAgICAgdmFyIGFkbyA9IG5ldyBBdWRpbygpO1xyXG4gICAgICAgICAgICBhZG8uc3JjID0gcEl0ZW0udG9EYXRhVVJMKCk7XHJcbiAgICAgICAgICAgIHZhciBpdGVtID0ge2RhdGE6IGFkbywgZm9sZGVyOiBwSXRlbS5maWxlbmFtZSwgbmFtZTogcEl0ZW0uZmlsZW5hbWUucmVwbGFjZSgvXi4qW1xcXFxcXC9dLywgJycpLCBzaXplOiBwSXRlbS5sZW5ndGgsIHR5cGU6ICdzb3VuZCd9O1xyXG5cdH1cclxuXHRlbHNlIGlmIChleHQgPT0gJ29ndicpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgYWRvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIlZJREVPXCIpO1xyXG4gICAgICAgICAgICBhZG8uc3JjID0gcEl0ZW0udG9EYXRhVVJMKCk7XHJcbiAgICAgICAgICAgIHZhciBpdGVtID0ge2RhdGE6IGFkbywgZm9sZGVyOiBwSXRlbS5maWxlbmFtZSwgbmFtZTogcEl0ZW0uZmlsZW5hbWUucmVwbGFjZSgvXi4qW1xcXFxcXC9dLywgJycpLCBzaXplOiBwSXRlbS5sZW5ndGgsIHR5cGU6ICd2aWRlbyd9O1xyXG4gICAgICAgIH0gICAgXHJcbiAgICAgICAgXHJcblx0Ly8gQWRkIHRoZSBpdGVtIHRvIHRoZSBwb29sLlxyXG5cdHRoaXMuX2l0ZW1zLnB1c2goaXRlbSk7XHJcblxyXG5cdC8vIExpbmsgdGhlIGl0ZW0gYXMgcHJvcGVydHlcclxuXHR0aGlzW2l0ZW0ubmFtZV0gPSBpdGVtO1xyXG4gICAgfTtcclxuXHJcbiAgICBmaWxlX3Bvb2xfc3RvcmUuYWRkX2Zyb21fc2VydmVyX3NvdXJjZSA9IGZ1bmN0aW9uKHBQYXRoLCBwRmlsZXMpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJy0tJyk7XHJcbiAgICAgICAgY29uc29sZS5sb2cocEZpbGVzKTtcclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIHN0aW11bGkgZmlsZXMuXHJcbiAgICAgICAgaWYgKHBGaWxlcy5sZW5ndGggPiAwKVxyXG5cdHtcclxuICAgICAgICAgICAgLy8gU2V0IHRoZSBwcmVsb2FkZXIuXHJcbiAgICAgICAgICAgIHRoaXMuX3F1ZXVlID0gbmV3IGNyZWF0ZWpzLkxvYWRRdWV1ZShmYWxzZSk7XHJcbiAgICAgICAgICAgIGNyZWF0ZWpzLlNvdW5kLnJlZ2lzdGVyUGx1Z2lucyhbY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luXSk7ICAvLyBuZWVkIHRoaXMgc28gaXQgZG9lc24ndCBkZWZhdWx0IHRvIFdlYiBBdWRpb1xyXG4gICAgICAgICAgICB0aGlzLl9xdWV1ZS5pbnN0YWxsUGx1Z2luKGNyZWF0ZWpzLlNvdW5kKTtcclxuIFx0XHRcclxuICAgICAgICAgICAgdGhpcy5fcXVldWUub24oXCJmaWxlbG9hZFwiLCB0aGlzLl9maWxlX2NvbXBsZXRlLCB0aGlzKTtcclxuICAgICAgICAgICAgdGhpcy5fcXVldWUub24oXCJjb21wbGV0ZVwiLCB0aGlzLl9sb2FkX2NvbXBsZXRlLCB0aGlzKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEFkZCB0aGUgc3RpbXVsaSBpbmZvcm1hdGlvbiB0byB0aGUgbG9hZGVyLlxyXG4gICAgICAgICAgICBmb3IgKHZhciBpPTA7aSA8IHBGaWxlcy5sZW5ndGg7aSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmUgPSAvKD86XFwuKFteLl0rKSk/JC87XHJcbiAgICAgICAgICAgICAgICB2YXIgZXh0ZW50aW9uID0gcmUuZXhlYyhwRmlsZXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXh0ZW50aW9uKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKGV4dGVudGlvblswXSA9PSAnLm9nZycpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NvdW5kJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcXVldWUubG9hZEZpbGUoe2lkOiBwRmlsZXNbaV0sIHNyYzogcFBhdGggKyBwRmlsZXNbaV0sIHR5cGU6IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNPVU5EfSk7XHJcbiAgICAgICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgeyBcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9xdWV1ZS5sb2FkRmlsZSh7aWQ6IHBGaWxlc1tpXSwgc3JjOiBwUGF0aCArIHBGaWxlc1tpXSwgdHlwZTogY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSU1BR0V9KTtcclxuICAgICAgICAgICAgICAgIH0gICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcblx0XHJcbiAgICAgICAgICAgIC8vIExvYWQgdGhlIHN0aW11bGkgZmlsZXMuXHJcbiAgICAgICAgICAgIHRoaXMuX3F1ZXVlLmxvYWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gQnVpbGQgdGhlIGV4cGVyaW1lbnQgb2JqZWN0cyB1c2luZyB0aGUgZ2l2ZW4gc2NyaXB0LlxyXG4gICAgICAgICAgICBvc3dlYi5ydW5uZXIuX2J1aWxkRXhwZXJpbWVudCgpO1xyXG4gICAgICAgIH0gXHJcbiAgICB9OyBcclxuICAgIFxyXG4gICAgZmlsZV9wb29sX3N0b3JlLl9maWxlX2NvbXBsZXRlID0gZnVuY3Rpb24ocEV2ZW50KVxyXG4gICAge1xyXG5cdC8vIFVwZGF0ZSB0aGUgbG9hZGVyIHRleHQuXHJcblx0b3N3ZWIucnVubmVyLl91cGRhdGVJbnRyb1NjcmVlbihvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDcpO1xyXG5cclxuICAgICAgICAvLyBQdXNoIHRoZSBzdGltdWx1cyBpdGVtIHRvIHRoZSBzdGltdWxpIG9iamVjdC5cclxuICAgICAgICB2YXIgaXRlbSA9IHtkYXRhOiBwRXZlbnQucmVzdWx0LCBmb2xkZXI6IHBFdmVudC5pdGVtLmlkLCBuYW1lOiBwRXZlbnQuaXRlbS5pZC5yZXBsYWNlKC9eLipbXFxcXFxcL10vLCAnJyksIHNpemU6IHBFdmVudC5pdGVtLmlkLCB0eXBlOiAnaW1hZ2UnfTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBBZGQgdGhlIGl0ZW0gdG8gdGhlIHBvb2wuXHJcblx0dGhpcy5faXRlbXMucHVzaChpdGVtKTtcclxuXHJcblx0Ly8gTGluayB0aGUgaXRlbSBhcyBwcm9wZXJ0eVxyXG5cdHRoaXNbaXRlbS5uYW1lXSA9IGl0ZW07XHJcbiAgICB9O1x0XHJcblx0XHJcbiAgICBmaWxlX3Bvb2xfc3RvcmUuX2xvYWRfY29tcGxldGUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gVXBkYXRlIHRoZSBsb2FkZXIgdGV4dC5cclxuXHRvc3dlYi5ydW5uZXIuX3VwZGF0ZUludHJvU2NyZWVuKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNik7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuX2l0ZW1zKTtcclxuXHJcblx0Ly8gQnVpbGRpbmcgaXMgZG9uZSwgZ28gdG8gbmV4dCBwaGFzZS5cclxuICAgICAgICBvc3dlYi5ydW5uZXIuX2J1aWxkRXhwZXJpbWVudCgpO1xyXG4gICAgfTtcdFxyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBjbGFzcyBtZXRob2RzLiAgIFxyXG4gICAgICovXHJcblxyXG4gICAgZmlsZV9wb29sX3N0b3JlLmFkZCA9IGZ1bmN0aW9uKHBQYXRoLCBwTmV3X05hbWUpXHJcbiAgICB7XHJcbiAgICBcdC8vIENvcGllcyBhIGZpbGUgdG8gdGhlIGZpbGUgcG9vbC4gXHJcbiAgICB9O1xyXG5cdFxyXG4gICAgZmlsZV9wb29sX3N0b3JlLmZhbGxiYWNrX2ZvbGRlciA9IGZ1bmN0aW9uKClcclxuICAgIHtcdFxyXG4gICAgXHQvLyBUaGUgZnVsbCBwYXRoIHRvIHRoZSBmYWxsYmFjayBwb29sIGZvbGRlci5cclxuICAgIH07XHJcblx0XHJcbiAgICBmaWxlX3Bvb2xfc3RvcmUuZmlsZXMgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICBcdC8vIFJldHVybnMgYWxsIGZpbGVzIGluIHRoZSBmaWxlIHBvb2wuXHJcbiAgICB9O1xyXG5cclxuICAgIGZpbGVfcG9vbF9zdG9yZS5mb2xkZXIgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICBcdC8vIFRoZSBmdWxsIHBhdGggdG8gdGhlIChtYWluKSBwb29sIGZvbGRlci5cclxuICAgIH07XHJcblx0XHJcbiAgICBmaWxlX3Bvb2xfc3RvcmUuZm9sZGVycyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gR2l2ZXMgYSBsaXN0IG9mIGFsbCBmb2xkZXJzIHRoYXQgYXJlIHNlYXJjaGVkIHdoZW4gcmV0cmlldmluZyB0aGUgZnVsbCBwYXRoIHRvIGEgZmlsZS4gXHJcbiAgICB9O1xyXG5cclxuICAgIGZpbGVfcG9vbF9zdG9yZS5pbl9mb2xkZXIgPSBmdW5jdGlvbihwUGF0aClcclxuICAgIHtcclxuICAgIFx0Ly8gQ2hlY2tzIHdoZXRoZXIgcGF0aCBpcyBpbiB0aGUgcG9vbCBmb2xkZXIuIFxyXG4gICAgfTtcclxuXHJcbiAgICBmaWxlX3Bvb2xfc3RvcmUucmVuYW1lID0gZnVuY3Rpb24ocE9sZF9wYXRoLCBwTmV3X3BhdGgpXHJcbiAgICB7XHJcblx0Ly8gUmVuYW1lcyBhIGZpbGUgaW4gdGhlIHBvb2wgZm9sZGVyLlxyXG4gICAgfTtcclxuXHRcclxuICAgIGZpbGVfcG9vbF9zdG9yZS5zaXplID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFRoZSBjb21iaW5lZCBzaXplIGluIGJ5dGVzIG9mIGFsbCBmaWxlcyBpbiB0aGUgZmlsZSBwb29sLlxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBzdGFjayBmaWxlX3BvbGVfc3RvcmUgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnBvb2wgPSBmaWxlX3Bvb2xfc3RvcmU7XHJcbn0oKSk7XHJcbiIsIi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGhlYXJ0YmVhdC5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gaGVhcnRiZWF0KHBFeHBlcmltZW50LCBwSW50ZXJ2YWwpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gU2V0IHRoZSBjbGFzcyBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBcdHRoaXMuZXhwZXJpbWVudCA9IHBFeHBlcmltZW50O1xyXG5cdHRoaXMuaW50ZXJ2YWwgICA9ICh0eXBlb2YgcEludGVydmFsID09PSAndW5kZWZpbmVkJykgPyAxIDogcEludGVydmFsO1x0XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gaGVhcnRiZWF0LnByb3RvdHlwZTtcclxuICAgIFxyXG4gICAgLy8gRGVmaW5lIHRoZSBjbGFzcyBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmV4cGVyaW1lbnQgPSBudWxsO1xyXG4gICAgcC5pbnRlcnZhbCAgID0gLTE7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgY2xhc3MgcHJpdmF0ZSBtZXRob2RzLiAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5iZWF0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnJ1biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIH07XHJcblxyXG4gICAgcC5zdGFydCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIH07XHJcblx0XHJcbiAgICAvLyBCaW5kIHRoZSBoZWFydGJlYXQgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmhlYXJ0YmVhdCA9IGhlYXJ0YmVhdDtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGl0ZW1fc3RhY2suXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGl0ZW1fc3RhY2soKVxyXG4gICAge1xyXG4gICBcdHRocm93IFwiVGhlIGNsYXNzIGl0ZW1fc3RhY2sgY2Fubm90IGJlIGluc3RhbnRpYXRlZCFcIjtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIGNsYXNzIHByb3BlcnRpZXMuXHJcbiAgICBpdGVtX3N0YWNrLl9pdGVtcyA9IFtdOyAgXHJcblx0XHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcy4gICBcclxuICAgICAqL1xyXG5cclxuICAgIGl0ZW1fc3RhY2suY2xlYXIgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICBcdC8vIENsZWFycyB0aGUgc3RhY2suXHJcblx0dGhpcy5faXRlbXMgPSBbXTtcclxuICAgIH07XHJcblxyXG4gICAgaXRlbV9zdGFjay5wdXNoID0gZnVuY3Rpb24ocEl0ZW0sIHBQaGFzZSlcclxuICAgIHtcclxuICAgIFx0Ly8gQ3JlYXRlIHRoZSBzdGFjayBpdGVtLlxyXG5cdHZhciBTdGFja0l0ZW0gPSB7J2l0ZW0nOiBwSXRlbSwgJ3BoYXNlJzogcFBoYXNlfTtcclxuXHJcblx0Ly8gUHVzaCB0aGUgaXRlbSBvbnRvIHRoZSBzdGFjay5cclxuXHR0aGlzLl9pdGVtcy5wdXNoKFN0YWNrSXRlbSk7XHJcbiAgICB9O1x0XHJcblxyXG4gICAgaXRlbV9zdGFjay5wb3AgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gUG9wcyB0aGUgbGFzdCBpdGVtIGZyb20gdGhlIHN0YWNrLlxyXG5cdHJldHVybiB0aGlzLl9pdGVtcy5wb3AoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgaXRlbV9zdGFjayBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuaXRlbV9zdGFjayA9IGl0ZW1fc3RhY2s7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBpdGVtX3N0b3JlLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBpdGVtX3N0b3JlKClcclxuICAgIHtcclxuXHR0aHJvdyBcIlRoZSBjbGFzcyBpdGVtX3N0b3JlIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhXCI7XHJcbiAgICB9IFxyXG5cdFx0XHJcbiAgICAvLyBTZXQgdGhlIGNsYXNzIHByaXZhdGUgcHJvcGVydGllcy4gXHJcbiAgICBpdGVtX3N0b3JlLl9leHBlcmltZW50ID0gbnVsbDtcclxuICAgIGl0ZW1fc3RvcmUuX2l0ZW1zICAgICAgPSB7fTtcclxuICAgIFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW5uaW5nIGl0ZW0uICAgICAgICAgXHJcbiAgICAgKi9cclxuICAgIFxyXG4gICAgaXRlbV9zdG9yZS5leGVjdXRlID0gZnVuY3Rpb24ocE5hbWUsIHBQYXJlbnQpXHJcbiAgICB7XHJcblx0Ly8gRXhlY3V0ZXMgdGhlIHJ1biBhbmQgcHJlcGFyZSBwaGFzZXMgb2YgYW4gaXRlbSwgYW5kIHVwZGF0ZXMgdGhlIGl0ZW0gc3RhY2suXHJcblx0dGhpcy5wcmVwYXJlKHBOYW1lKTtcclxuXHR0aGlzLnJ1bihwTmFtZSwgcFBhcmVudCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGl0ZW1fc3RvcmUuaXRlbXMgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gQ3JlYXRlIGEgbGlzdCBvIGtleXMuXHJcbiAgICAgICAgdmFyIGl0ZW1zID0gW107XHJcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuX2l0ZW1zKSBcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGl0ZW1zLnB1c2goW2tleSAsdGhpcy5faXRlbXNba2V5XV0pO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUmV0dXJucyBhIGxpc3Qgb2YgaXRlbSBuYW1lcy5cclxuXHRyZXR1cm4gaXRlbXM7XHJcbiAgICB9O1xyXG5cclxuICAgIGl0ZW1fc3RvcmUua2V5cyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBDcmVhdGUgYSBsaXN0IG8ga2V5cy5cclxuICAgICAgICB2YXIga2V5cyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl9pdGVtcykgXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBrZXlzLnB1c2goa2V5KTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFJldHVybnMgYSBsaXN0IG9mIGl0ZW0gbmFtZXMuXHJcblx0cmV0dXJuIGtleXM7XHJcbiAgICB9O1xyXG5cclxuICAgIGl0ZW1fc3RvcmUubmV3ID0gZnVuY3Rpb24ocFR5cGUsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIENoZWNrIGlmIHRoZSBlbGVtZW50IGlzIHBhcnQgb2YgdGhlIG9zd2ViIG5hbWUgc3BhY2VcclxuXHRpZiAob3N3ZWIuaXNDbGFzcyhwVHlwZSkgPT0gdHJ1ZSlcclxuXHR7XHJcbiAgICAgICAgICAgIC8vIEFkZCB0aGUgbmV3IGl0ZW0gYXMgcHJvcGVydHkgb2YgaXRlbXMuXHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW1zW3BOYW1lXSA9IG9zd2ViLm5ld0l0ZW1DbGFzcyhwVHlwZSwgdGhpcy5fZXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG4gICAgICAgIH1cclxuXHRlbHNlXHJcblx0e1xyXG4gICAgICAgICAgICAvLyBVbmt3b25lIGNsYXNzIGRlZmluaXRpb24sIHNob3cgZXJyb3IgbWVzc2FnZS5cclxuICAgICAgICAgICAgb3N3ZWIuZGVidWcuYWRkRXJyb3Iob3N3ZWIuY29uc3RhbnRzLkVSUk9SXzAwOSArIHBUeXBlKTtcclxuXHR9XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBpdGVtX3N0b3JlLnByZXBhcmUgPSBmdW5jdGlvbihwTmFtZSwgcFBhcmVudClcclxuICAgIHtcclxuICAgICAgICAvLyBFeGVjdXRlcyB0aGUgcHJlcGFyZSBwaGFzZSBvZiBhbiBpdGVtLCBhbmQgdXBkYXRlcyB0aGUgaXRlbSBzdGFjay5cclxuXHRvc3dlYi5pdGVtX3N0YWNrLnB1c2gocE5hbWUsICdwcmVwYXJlJyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5faXRlbXNbcE5hbWVdLl9wYXJlbnQgPSBwUGFyZW50O1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zW3BOYW1lXS5wcmVwYXJlKCk7XHJcbiAgICB9O1x0XHJcblxyXG4gICAgaXRlbV9zdG9yZS5ydW4gPSBmdW5jdGlvbihwTmFtZSwgcFBhcmVudClcclxuICAgIHtcclxuXHQvLyBTZXQgdGhlIGN1cnJlbnQgYW5kIGl0cyBwYXJlbnQgaXRlbS5cclxuXHRvc3dlYi5ldmVudHMuX2N1cnJlbnRfaXRlbSAgICAgICAgID0gdGhpcy5faXRlbXNbcE5hbWVdO1xyXG5cdG9zd2ViLmV2ZW50cy5fY3VycmVudF9pdGVtLl9wYXJlbnQgPSBwUGFyZW50O1xyXG5cdFx0XHJcblx0Ly8gRXhlY3V0ZXMgdGhlIHJ1biBwaGFzZSBvZiBhbiBpdGVtLCBhbmQgdXBkYXRlcyB0aGUgaXRlbSBzdGFjay5cclxuXHRvc3dlYi5pdGVtX3N0YWNrLnB1c2gocE5hbWUsICdydW4nKTtcclxuXHR0aGlzLl9pdGVtc1twTmFtZV0ucnVuKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGl0ZW1fc3RvcmUudmFsaWRfbmFtZSA9IGZ1bmN0aW9uKHBJdGVtX3R5cGUsIHBTdWdnZXN0aW9uKVxyXG4gICAge1xyXG4gICAgICAgIC8vIENoZWNrIHRoZSBvcHRpb25hbCBwYXJhbWV0ZXJzLlxyXG4gICAgICAgIHBTdWdnZXN0aW9uID0gKHR5cGVvZiBwU3VnZ2VzdGlvbiA9PT0gJ3VuZGVmaW5lZCcpID8gbnVsbCA6IHBTdWdnZXN0aW9uO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChwU3VnZ2VzdGlvbiA9PSBudWxsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIG5hbWUgPSAnbmV3XycgKyBwSXRlbV90eXBlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgbmFtZSA9IHRoaXMuX2V4cGVyaW1lbnQuc3ludGF4LnNhbml0aXplKHBTdWdnZXN0aW9uLCB0cnVlLCBmYWxzZSk7XHJcbiAgICAgICAgfSAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIENyZWF0ZSBhIHVuaXF1ZSBuYW1lLlxyXG4gICAgICAgIHZhciBpICAgICA9IDE7XHJcbiAgICAgICAgdmFyIF9uYW1lID0gbmFtZTtcclxuICAgICAgICB3aGlsZSAodGhpcy5faXRlbXMuaGFzT3duUHJvcGVydHkoX25hbWUpID09IHRydWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfbmFtZSA9IG5hbWUgKyAnXycgKyBTdHJpbmcoaSk7XHJcblx0ICAgIGkrKztcclxuICAgICAgICB9IFxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gZnVuY3Rpb24gcmVzdWx0XHJcbiAgICAgICAgcmV0dXJuIF9uYW1lOyBcclxuICAgIH07ICAgIFxyXG4gICAgXHJcbiAgICBpdGVtX3N0b3JlLnZhbHVlcyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICBcdC8vIENyZWF0ZSBhIGxpc3QgbyBrZXlzLlxyXG4gICAgICAgIHZhciB2YWx1ZXMgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5faXRlbXMpIFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFsdWVzLnB1c2godGhpcy5faXRlbXNba2V5XSk7XHJcbiAgICAgICAgfSAgICBcclxuICAgICAgICBcclxuICAgICAgICAvLyBSZXR1cm5zIGEgbGlzdCBvZiBpdGVtIG5hbWVzLlxyXG5cdHJldHVybiB2YWx1ZXM7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGl0ZW1fc3RvcmUgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLml0ZW1fc3RvcmUgPSBpdGVtX3N0b3JlO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgcHl0aG9uX3dvcmtzcGFjZS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gcHl0aG9uX3dvcmtzcGFjZSgpXHJcbiAgICB7XHJcbiAgICBcdHRocm93IFwiVGhlIGNsYXNzIHB5dGhvbl93b3Jrc3BhY2UgY2Fubm90IGJlIGluc3RhbnRpYXRlZCFcIjtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMuICAgXHJcbiAgICAgKi9cclxuICAgIFxyXG4gICAgcHl0aG9uX3dvcmtzcGFjZS5fZXZhbCA9IGZ1bmN0aW9uKHBCeXRlY29kZSlcclxuICAgIHtcclxuICAgICAgICAvLyBDaGVjayB3aWNoIHR5cGUgb2YgZXhwcmVzc2lvbiBtdXN0IGJlIGV2YWxlZC5cclxuICAgICAgICBpZiAodHlwZW9mIHBCeXRlY29kZSA9PT0gJ2Jvb2xlYW4nKSAgICBcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBwQnl0ZWNvZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBwQnl0ZWNvZGUgPT09ICdzdHJpbmcnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gT3BlbiBzZXNhbWUgc2NyaXB0LCBmaXJzdCBjaGVjayBmb3IgcGFyYW1ldGVyIHZhbHVlcy4gXHJcbiAgICAgICAgICAgIHBCeXRlY29kZSA9IG9zd2ViLnN5bnRheC5ldmFsX3RleHQocEJ5dGVjb2RlKTtcclxuICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gRXZhbHVhdGUgdGhlIGV4cHJlc3Npb24uXHJcbiAgICAgICAgICAgIGV2YWxfc3RyaW5nID0gb3N3ZWIuc3ludGF4LnJlbW92ZV9xdW90ZXMocEJ5dGVjb2RlKVxyXG4gICAgICAgICAgICBpZihldmFsX3N0cmluZyA9PSBcImFsd2F5c1wiKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihldmFsX3N0cmluZyA9PSBcIm5ldmVyXCIpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBldmFsKGV2YWxfc3RyaW5nKTtcclxuICAgICAgICAgICAgfSAgICBcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJz5weXRob24gc2NyaXB0IC0gbm90IHN1cHBvcnRlZCB5ZXQnKTtcclxuICAgICAgICAgICAgcmV0dXJuIGV2YWwocEJ5dGVjb2RlKTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgfTtcclxuXHRcclxuICAgIHB5dGhvbl93b3Jrc3BhY2UuaW5pdF9nbG9iYWxzID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgfTtcclxuXHRcclxuICAgIC8vIEJpbmQgdGhlIHB5dGhvbl93b3Jrc3BhY2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnB5dGhvbl93b3Jrc3BhY2UgPSBweXRob25fd29ya3NwYWNlO1xyXG59KCkpO1xyXG4iLCJcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgcHl0aG9uX3dvcmtzcGFjZS5cclxuICAgIGZ1bmN0aW9uIHB5dGhvbl93b3Jrc3BhY2VfYXBpKCkge1xyXG4gICAgXHR0aHJvdyAnVGhlIGNsYXNzIHB5dGhvbl93b3Jrc3BhY2VfYXBpIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhJztcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMuICAgXHJcblxyXG4gICAgcHl0aG9uX3dvcmtzcGFjZV9hcGkuX2luaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcclxuXHQvLyBDcmVhdGUgdGhlIGdsb2JhbCBmdW5jdGlvbiBjYWxscyBmb3IgdXNlIGluIHRoZSBpbmxpZGUgc2NyaXB0IGl0ZW0uXHJcblx0d2luZG93WydjYW52YXMnXSA9IHRoaXMuY2FudmFzO1xyXG5cdHdpbmRvd1snY29weV9za2V0Y2hwYWQnXSA9IHRoaXMuY29weV9za2V0Y2hwYWQ7XHJcblx0d2luZG93WydrZXlib2FyZCddID0gdGhpcy5rZXlib2FyZDtcclxuXHR3aW5kb3dbJ21vdXNlJ10gPSB0aGlzLm1vdXNlO1xyXG5cdHdpbmRvd1sncGF1c2UnXSA9IHRoaXMucGF1c2U7XHJcblx0d2luZG93WydyZXNldF9mZWVkYmFjayddID0gdGhpcy5yZXNldF9mZWVkYmFjaztcdFxyXG5cdHdpbmRvd1snc2FtcGxlciddID0gdGhpcy5zYW1wbGVyO1xyXG5cdHdpbmRvd1snc2V0X3Jlc3BvbnNlJ10gPSB0aGlzLnNldF9yZXNwb25zZTtcclxuXHR3aW5kb3dbJ3NldF9zdWJqZWN0X25yJ10gPSB0aGlzLnNldF9zdWJqZWN0X25yO1x0XHJcblx0d2luZG93Wydzb21ldGltZXMnXSA9IHRoaXMuc29tZXRpbWVzO1xyXG5cdHdpbmRvd1snc3ludGgnXSA9IHRoaXMuc3ludGg7XHJcblx0d2luZG93Wyd4eV9jaXJjbGUnXSA9IHRoaXMueHlfY2lyY2xlO1xyXG5cdHdpbmRvd1sneHlfZGlzdGFuY2UnXSA9IHRoaXMueHlfZGlzdGFuY2U7XHJcblx0d2luZG93Wyd4eV9mcm9tX3BvbGFyJ10gPSB0aGlzLnh5X2Zyb21fcG9sYXI7XHJcblx0d2luZG93Wyd4eV9ncmlkJ10gPSB0aGlzLnh5X2dyaWQ7XHJcblx0d2luZG93Wyd4eV9yYW5kb20nXSA9IHRoaXMueHlfcmFuZG9tO1xyXG5cdHdpbmRvd1sneHlfdG9fcG9sYXInXSA9IHRoaXMueHlfdG9fcG9sYXI7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBnbG9iYWwgZnVuY3Rpb25zLiAgIFxyXG5cclxuICAgIHB5dGhvbl93b3Jrc3BhY2VfYXBpLmNhbnZhcyA9IGZ1bmN0aW9uKGF1dG9fcHJlcGFyZSwgc3R5bGVfYXJncykge1xyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ2NhbnZhcygpLicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBweXRob25fd29ya3NwYWNlX2FwaS5jb3B5X3NrZXRjaHBhZCA9IGZ1bmN0aW9uKG5hbWUpIHtcclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNyArICdjb3B5X3NrZXRjaHBhZCgpLicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBweXRob25fd29ya3NwYWNlX2FwaS5rZXlib2FyZCA9IGZ1bmN0aW9uKHJlc3BfYXJncykge1xyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ2tleWJvYXJkKCkuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHB5dGhvbl93b3Jrc3BhY2VfYXBpLm1vdXNlID0gZnVuY3Rpb24ocmVzcF9hcmdzKSB7XHJcbiAgICAgICAgb3N3ZWIuZGVidWcuYWRkTWVzc2FnZShvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDcgKyAnbW91c2UoKS4nKTtcclxuICAgIH07XHJcblxyXG4gICAgcHl0aG9uX3dvcmtzcGFjZV9hcGkucGF1c2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNyArICdwYXVzZSgpLicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBweXRob25fd29ya3NwYWNlX2FwaS5yZXNldF9mZWVkYmFjayA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ3BhdXNlKCkuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHB5dGhvbl93b3Jrc3BhY2VfYXBpLnNhbXBsZXIgPSBmdW5jdGlvbihzcmMsIHBsYXliYWNrX2FyZ3MpIHtcclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNyArICdwYXVzZSgpLicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBweXRob25fd29ya3NwYWNlX2FwaS5zZXRfcmVzcG9uc2UgPSBmdW5jdGlvbihyZXNwb25zZSwgcmVzcG9uc2VfdGltZSwgY29ycmVjdCkge1xyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ3BhdXNlKCkuJyk7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcHl0aG9uX3dvcmtzcGFjZV9hcGkuc2V0X3N1YmplY3RfbnIgPSBmdW5jdGlvbihucikge1xyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ3BhdXNlKCkuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHB5dGhvbl93b3Jrc3BhY2VfYXBpLnNvbWV0aW1lcyA9IGZ1bmN0aW9uKHApIHtcclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNyArICdwYXVzZSgpLicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBweXRob25fd29ya3NwYWNlX2FwaS5zeW50aCA9IGZ1bmN0aW9uKG9zYywgZnJlcSwgbGVuZ3RoLCBhdHRhY2ssIGRlY2F5KSB7XHJcbiAgICAgICAgb3N3ZWIuZGVidWcuYWRkTWVzc2FnZShvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDcgKyAncGF1c2UoKS4nKTtcclxuICAgIH07XHJcblxyXG4gICAgcHl0aG9uX3dvcmtzcGFjZV9hcGkueHlfY2lyY2xlID0gZnVuY3Rpb24obiwgcmhvLCBwaGkwLCBwb2xlKSB7XHJcbiAgICAgICAgb3N3ZWIuZGVidWcuYWRkTWVzc2FnZShvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDcgKyAnY3lfY2lyY2xlKCkuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHB5dGhvbl93b3Jrc3BhY2VfYXBpLnh5X2Rpc3RhbmNlID0gZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIpIHtcclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNyArICd4eV9kaXN0YW5jZSgpLicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBweXRob25fd29ya3NwYWNlX2FwaS54eV9mcm9tX3BvbGFyID0gZnVuY3Rpb24ocmhvLCBwaGksIHBvbGUpIHtcclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNyArICd4eV9mcm9tX3BvbGFyKCkuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHB5dGhvbl93b3Jrc3BhY2VfYXBpLnh5X2dyaWQgPSBmdW5jdGlvbihuLCBzcGFjaW5nLCBwb2xlKSB7XHJcbiAgICAgICAgb3N3ZWIuZGVidWcuYWRkTWVzc2FnZShvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDcgKyAneHlfZ3JpZCgpLicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBweXRob25fd29ya3NwYWNlX2FwaS54eV9yYW5kb20gPSBmdW5jdGlvbihuLCB3aWR0aCwgaGVpZ2h0LCBtaW5fZGlzdCwgcG9sZSkge1xyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ3h5X3JhbmRvbSgpLicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBweXRob25fd29ya3NwYWNlX2FwaS54eV90b19wb2xhciA9IGZ1bmN0aW9uKHgsIHksIHBvbGUpIHtcclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNyArICd4eV90b19wb2xhcigpLicpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBweXRob25fd29ya3NwYWNlX2FwaSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIucHl0aG9uX3dvcmtzcGFjZV9hcGkgPSBweXRob25fd29ya3NwYWNlX2FwaTtcclxufSgpKTtcclxuIiwiXHJcbihmdW5jdGlvbigpIHtcclxuICAgIC8vIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIHJlc3BvbnNlX2luZm8uXHJcbiAgICBmdW5jdGlvbiByZXNwb25zZV9pbmZvKHJlc3BvbnNlX3N0b3JlLCByZXNwb25zZSwgY29ycmVjdCwgcmVzcG9uc2VfdGltZSwgaXRlbSwgZmVlZGJhY2spIHtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSByZXNwb25zZV9pbmZvLnByb3RvdHlwZTtcclxuICAgIFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHByb3BlcnRpZXMuICAgXHJcblxyXG4gICAgcC5tYXRjaCA9IGZ1bmN0aW9uKGt3ZGljdCkge1xyXG4gICAgfTsgICAgXHJcbiAgICAgICAgXHJcbiAgICBwLm1hdGNobm90ID0gZnVuY3Rpb24oa3dkaWN0KSB7XHJcbiAgICB9OyAgICBcclxuXHRcclxuICAgIC8vIEJpbmQgdGhlIHJlc3BvbnNlX2luZm8gY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnJlc3BvbnNlX2luZm8gPSByZXNwb25zZV9pbmZvO1xyXG59KCkpO1xyXG4iLCJcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgcmVzcG9uc2Vfc3RvcmUuXHJcbiAgICBmdW5jdGlvbiByZXNwb25zZV9zdG9yZShleHBlcmltZW50KSB7XHJcbiAgICAgICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIHByb3BlcnRpZXMuXHJcbiAgICAgICAgdGhpcy5fZXhwZXJpbWVudCA9IGV4cGVyaW1lbnQ7XHJcblx0dGhpcy5fZmVlZGJhY2tfZnJvbSA9IDA7XHJcblx0dGhpcy5fcmVzcG9uc2VzID0gW107XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gcmVzcG9uc2Vfc3RvcmUucHJvdG90eXBlO1xyXG4gICAgXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcHJvcGVydGllcy4gICBcclxuXHJcbiAgICBwLmFjYyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgfTsgICAgXHJcbiAgICAgICAgXHJcbiAgICBwLmF2Z19ydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgfTsgICAgXHJcbiAgICAgICAgXHJcbiAgICBwLmNvcnJlY3QgPSBmdW5jdGlvbigpIHtcclxuICAgIH07ICAgIFxyXG5cclxuICAgIHAuZmVlZGJhY2sgPSBmdW5jdGlvbigpIHtcclxuICAgIH07ICAgIFxyXG5cclxuICAgIHAuaXRlbSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgfTsgICAgXHJcbiAgICAgICAgXHJcbiAgICBwLnJlc3BvbnNlID0gZnVuY3Rpb24oKSB7XHJcbiAgICB9OyAgICBcclxuICAgICAgICBcclxuICAgIHAucmVzcG9uc2VfdGltZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgfTsgICAgXHJcbiAgICBcclxuICAgIHAudmFyID0gZnVuY3Rpb24oKSB7XHJcbiAgICB9OyAgICBcclxuICAgICAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBlZGl0LiAgIFxyXG5cclxuICAgIHAuYWRkID0gZnVuY3Rpb24ocmVzcG9uc2UsIGNvcnJlY3QsIHJlc3BvbnNlX3RpbWUsIGl0ZW0sZmVlZGJhY2spIHtcclxuICAgIH07ICAgIFxyXG4gICAgICAgIFxyXG4gICAgcC5jbGVhciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgfTsgICAgXHJcbiAgICAgICAgXHJcbiAgICBwLnJlc2V0X2ZlZWRiYWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICB9OyAgICBcclxuXHRcclxuICAgIC8vIEJpbmQgdGhlIHJlc3BvbnNlX3N0b3JlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5yZXNwb25zZV9zdG9yZSA9IHJlc3BvbnNlX3N0b3JlO1xyXG59KCkpO1xyXG4iLCIgXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIHN5bnRheC5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gc3ludGF4KClcclxuICAgIHtcclxuICAgIFx0dGhyb3cgXCJUaGUgY2xhc3Mgc3ludGF4IGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhXCI7XHJcbiAgICB9OyBcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwcml2YXRlIGNsYXNzIG1ldGhvZHMuICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBzeW50YXguX2NvbnZlcnRQeXRob24gPSBmdW5jdGlvbihwU2NyaXB0KVxyXG4gICAge1xyXG4gICAgXHRyZXR1cm4gcFNjcmlwdDtcclxuICAgIH07XHJcblxyXG4gICAgc3ludGF4LmlzTnVtYmVyID0gZnVuY3Rpb24obilcclxuICAgIHtcclxuICAgICAgICByZXR1cm4gTnVtYmVyKG4pID09IG47IC8vIGFhbmdlcGFzdCB2YW4gPT0gbmFhciA9PT0gZW4gd2VlciB0ZXJ1ZyBuYWFyICc9PScgYW5kZXJzIHdlcmt0IGR1cmF0aW9uIG5pZXQuXHJcbiAgICB9O1xyXG5cclxuICAgIHN5bnRheC5pc0Zsb2F0ID0gZnVuY3Rpb24obilcclxuICAgIHtcclxuICAgICAgICByZXR1cm4gTnVtYmVyKG4pID09PSBuICYmIG4gJSAxICE9PSAwO1xyXG4gICAgfTtcclxuXHJcbiAgICBzeW50YXgucmVtb3ZlX3F1b3RlcyA9IGZ1bmN0aW9uKHBTdHJpbmcpXHJcbiAgICB7XHJcbiAgICAgICAgaWYgKHBTdHJpbmcgPT0gJ1wiXCInKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICAgICAgZWxzZSBpZiAoKHBTdHJpbmdbMF0gPT0gJ1wiJykgJiYgKHBTdHJpbmdbcFN0cmluZy5sZW5ndGggLSAxXSA9PSAnXCInKSlcclxuXHR7XHJcbiAgICAgICAgICAgIHJldHVybiBwU3RyaW5nLnNsaWNlKDEsIHBTdHJpbmcubGVuZ3RoIC0gMSk7XHJcblx0fVxyXG5cdGVsc2VcclxuXHR7XHJcbiAgICAgICAgICAgIHJldHVybiBwU3RyaW5nO1xyXG5cdH1cdFxyXG4gICAgfTtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcy4gICBcclxuICAgICAqL1xyXG4gICAgXHJcbiAgICBzeW50YXguY29tcGlsZV9jb25kID0gZnVuY3Rpb24ocENuZCwgcEJ5dGVjb2RlKVxyXG4gICAge1xyXG5cdC8vIENoZWNrIGZvciBjb25kaXRpb25hbCBwYXJhbXRlcnMuXHJcblx0cEJ5dGVjb2RlID0gKHR5cGVvZiBwQnl0ZWNvZGUgPT09ICd1bmRlZmluZWQnKSA/IHRydWUgOiBwQnl0ZWNvZGU7XHRcclxuXHRcdFxyXG5cdGlmIChwQ25kID09ICdhbHdheXMnKVxyXG5cdHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcblx0fSBcclxuXHRlbHNlIGlmIChwQ25kID09ICduZXZlcicpXHJcblx0e1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblx0fSBcclxuICAgICAgICBlbHNlXHJcblx0e1xyXG4gICAgICAgICAgICBpZiAocENuZC5zdWJzdHJpbmcoMCwxKSA9PSAnPScpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vIFB5dGhvbiBzY3JpcHQsIGNvbXBpbGUgaXQgdG8gYW4gYXN0IHRyZWUuXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncHl0aG9uIHNjcmlwdCBpcyBub3Qgc3VwcG9ydGVkIHlldCcpO1xyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vIG9wZW5zZXNhbWUgc2NyaXB0LCBjb252ZXJ0IGl0IHRvIGphdmFzY3JpcHQuXHJcbiAgICAgICAgICAgICAgICBwQ25kID0gcENuZC5yZXBsYWNlKC9bXighPSldWz1dL2csICc9PScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSAgICBcclxuXHJcbiAgICAgICAgcmV0dXJuIHBDbmQ7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgc3ludGF4LmV2YWxfdGV4dCA9IGZ1bmN0aW9uKHBUeHQsIHBWYXJzLCBwUm91bmRfZmxvYXQsIHBWYXIpXHJcbiAgICB7XHJcblx0Ly8gRXZhbHVhdGVzIHZhcmlhYmxlcyBhbmQgaW5saW5lIFB5dGhvbiBpbiBhIHRleHQgc3RyaW5nLlxyXG5cdHZhciByZXN1bHQgICAgID0gcFR4dDtcclxuXHR2YXIgcHJvY2Vzc2luZyA9IHJlc3VsdC5zZWFyY2goL1teW1xcXV0rKD89XSkvZyk7XHJcblx0XHRcclxuXHR3aGlsZSAocHJvY2Vzc2luZyAhPSAtMSlcclxuXHR7XHJcbiAgICAgICAgICAgIC8vIFJlcGxhY2UgdGhlIGZvdW5kIHZhbHVlIHdpdGggdGhlIHZhcmlhYmxlLlxyXG4gICAgICAgICAgICB2YXIgdmFyaWFibGUgPSByZXN1bHQuc2xpY2UocHJvY2Vzc2luZyxyZXN1bHQuaW5kZXhPZignXScpKTtcclxuICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBwVmFycyA9PT0gJ3VuZGVmaW5lZCcpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG9zd2ViLnJ1bm5lci5leHBlcmltZW50LnZhcnNbdmFyaWFibGVdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gcFZhcnNbdmFyaWFibGVdO1xyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcmVzdWx0XHQgPSByZXN1bHQucmVwbGFjZSgnWycgKyB2YXJpYWJsZSArICddJyx2YWx1ZSk7XHRcdFx0XHJcbiAgICAgICAgICAgIHByb2Nlc3NpbmcgICA9IHJlc3VsdC5zZWFyY2goL1teW1xcXV0rKD89XSkvZyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuXHJcbiAgICBzeW50YXgucGFyc2VfY21kID0gZnVuY3Rpb24ocFN0cmluZylcclxuICAgIHtcclxuXHQvLyBzcGxpdCB0aGUgYXN0cmluZy5cclxuXHR2YXIgdG9rZW5zID0gdGhpcy5zcGxpdChwU3RyaW5nKTtcclxuXHR0b2tlbnMuc2hpZnQoKTtcclxuXHR0b2tlbnMuc2hpZnQoKTtcclxuXHRyZXR1cm4gdG9rZW5zO1xyXG4gICAgfTtcclxuXHJcbiAgICBzeW50YXguc2FuaXRpemUgPSBmdW5jdGlvbihwU3RyaW5nLCBwU3RyaWN0LCBwQWxsb3dWYXJzKVxyXG4gICAge1xyXG5cdC8vIFJlbW92ZXMgaW52YWxpZCBjaGFyYWN0ZXJzIChub3RhYmx5IHF1b3RlcykgZnJvbSB0aGUgc3RyaW5nLlxyXG5cdHJldHVybiBwU3RyaW5nO1xyXG4gICAgfTtcclxuXHJcbiAgICBzeW50YXguc3BsaXQgPSBmdW5jdGlvbihwTGluZSlcclxuICAgIHtcclxuICAgIFx0Ly8gUmV0dXJuIGFuIGFycmF5IHdpdGggdG9rZW5zIGlnbm9yaW5nIHdoaXRlc3BhY2VzIHdpdGhpbi4gXHJcblx0dmFyIHJlc3VsdCA9IHBMaW5lLm1hdGNoKC8oPzpbXlxcc1wiXSt8XCJbXlwiXSpcIikrL2cpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiAocmVzdWx0ICE9IG51bGwpID8gcmVzdWx0IDogW107XHJcbiAgICB9OyAgICBcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBzeW50YXggY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnN5bnRheCA9IHN5bnRheDtcclxufSgpKTtcclxuXHJcbiIsIi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIHZhcl9zdG9yZS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gdmFyX3N0b3JlKHBJdGVtLCBwUGFyZW50KVxyXG4gICAge1xyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHJvcGVydGllcy4gXHJcbiAgICAgICAgdGhpcy5faXRlbSAgID0gcEl0ZW07XHJcbiAgICAgICAgdGhpcy5fcGFyZW50ID0gcFBhcmVudDtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSB2YXJfc3RvcmUucHJvdG90eXBlO1xyXG4gICAgXHJcbiAgICAvLyBTZXQgdGhlIGNsYXNzIGRlZmF1bHQgcHJvcGVydGllcy4gXHJcbiAgICBwLl9pdGVtICAgPSBudWxsO1xyXG4gICAgcC5fcGFyZW50ID0gbnVsbDsgICAgICAgIFxyXG5cdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMuICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLmdldCA9IGZ1bmN0aW9uKHBWYXIsIHBEZWZhdWx0LCBwRXZhbCwgcFZhbGlkKVxyXG4gICAge1xyXG5cdC8vIFNldCB0aGUgb3B0aW9uYWwgYXJndW1lbnRzXHJcblx0cERlZmF1bHQgPSAodHlwZW9mIHBEZWZhdWx0ID09PSAndW5kZWZpbmVkJykgPyBudWxsIDogcERlZmF1bHQ7XHJcblx0cEV2YWwgICAgPSAodHlwZW9mIHBFdmFsID09PSAndW5kZWZpbmVkJykgICAgPyB0cnVlIDogcEV2YWw7XHJcblx0cFZhbGlkICAgPSAodHlwZW9mIHBWYWxpZCA9PT0gJ3VuZGVmaW5lZCcpICAgPyBudWxsIDogcFZhbGlkO1xyXG5cdFx0XHJcblx0dmFyIHZhbHVlID0gbnVsbDtcclxuXHJcblx0Ly8gR2V0cyBhbiBleHBlcmltZW50YWwgdmFyaWFibGUuXHJcblx0aWYgKHBWYXIgaW4gdGhpcylcclxuXHR7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpc1twVmFyXSA9PSAnc3RyaW5nJylcclxuICAgICAgICAgICAge1xyXG5cdCBcdHZhbHVlID0gb3N3ZWIuc3ludGF4LmV2YWxfdGV4dCh0aGlzW3BWYXJdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuIFx0XHR2YWx1ZSA9IHRoaXNbcFZhcl07XHJcbiAgICAgICAgICAgIH1cclxuIFx0fVxyXG5cclxuXHQvLyBSZXR1cm4gZnVuY3Rpb24gcmVzdWx0LlxyXG5cdHJldHVybiB2YWx1ZTtcclxuICAgIH07XHJcblxyXG4gICAgcC5pbnNwZWN0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdHZhciBrZXlzID0gW107XHJcblx0Zm9yKHZhciBrZXkgaW4gdGhpcylcclxuICBcdHtcclxuICAgICAgICAgICAga2V5cy5wdXNoKGtleSk7XHJcbiAgIFx0fVxyXG4gICBcdFx0XHJcbiAgIFx0Ly8gU2xpZGUgZGVmYXVsdCBwcm9wZXJ0aWVzLiBcclxuICAgXHRrZXlzID0ga2V5cy5zbGljZSgyLGtleXMubGVuZ3RoIC0gMyk7XHJcbiAgIFx0XHRcclxuXHRyZXR1cm4ga2V5cztcclxuICAgIH07XHJcblxyXG4gICAgcC5zZXQgPSBmdW5jdGlvbihwVmFyLCBwVmFsKVxyXG4gICAge1xyXG5cdC8vIFNldHMgYW5kIGV4cGVyaW1lbnRhbCB2YXJpYWJsZS5cclxuXHR0aGlzW3BWYXJdID0gcFZhbDtcclxuICAgIH07XHJcblx0XHJcbiAgICAvLyBCaW5kIHRoZSB2YXJzIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi52YXJfc3RvcmUgPSB2YXJfc3RvcmU7XHJcbn0oKSk7XHJcbiIsIlx0XHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGl0ZW0uXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGl0ZW0ocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIFNldCB0aGUgY2xhc3MgcHJpdmF0ZSBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuX2dldF9sb2NrID0gbnVsbDtcclxuXHR0aGlzLl9wYXJlbnQgICA9IG51bGw7XHJcblx0dGhpcy5fc3RhdHVzICAgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX05PTkU7XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuXHJcblx0dGhpcy5jb3VudCAgICAgID0gMDtcdFxyXG5cdHRoaXMuZGVidWdcdD0gb3N3ZWIuZGVidWcuZW5hYmxlZDtcclxuXHR0aGlzLmV4cGVyaW1lbnQgPSAocEV4cGVyaW1lbnQgPT0gbnVsbCkgPyB0aGlzIDogcEV4cGVyaW1lbnQ7XHJcblx0dGhpcy5uYW1lICAgICAgID0gcE5hbWU7XHRcclxuXHR0aGlzLnZhcnMgXHQ9ICh0aGlzLnZhcnMpID8gdGhpcy52YXJzIDogbmV3IG9zd2ViLnZhcl9zdG9yZSh0aGlzLCBudWxsKTtcclxuXHJcbiAgICAgICAgLy8gU2V0IHRoZSBvYmplY3QgcmVhbHRlZCBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuY2xvY2sgICAgICAgICAgICA9IHRoaXMuZXhwZXJpbWVudC5fY2xvY2s7XHRcdFxyXG5cdHRoaXMubG9nICAgICAgICAgICAgICA9IHRoaXMuZXhwZXJpbWVudC5fbG9nO1xyXG5cdHRoaXMucHl0aG9uX3dvcmtzcGFjZSA9IHRoaXMuZXhwZXJpbWVudC5fcHl0aG9uX3dvcmtzcGFjZTtcdFxyXG4gICAgICAgIHRoaXMuc3ludGF4ICAgICAgICAgICA9IHRoaXMuZXhwZXJpbWVudC5fc3ludGF4OyBcdFxyXG5cdFxyXG4gICAgICAgIC8vIFJlYWQgdGhlIGl0ZW0gZGVmaW5pdGlvbiBzdHJpbmcuXHRcclxuXHR0aGlzLmZyb21fc3RyaW5nKHBTY3JpcHQpO1xyXG4gICAgfSBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gaXRlbS5wcm90b3R5cGU7XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBjbGFzcyBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmNsb2NrICAgICAgICAgICAgPSBudWxsO1xyXG4gICAgcC5jb21tZW50cyAgICAgICAgID0gbnVsbDtcclxuICAgIHAuY291bnQgICAgICAgICAgICA9IDA7XHJcbiAgICBwLmRlYnVnICAgICAgICAgICAgPSBmYWxzZTtcclxuICAgIHAuZXhwZXJpbWVudCAgICAgICA9IG51bGw7XHJcbiAgICBwLmxvZyAgICAgICAgICAgICAgPSBudWxsO1xyXG4gICAgcC5uYW1lICAgICAgICAgICAgID0gJyc7XHJcbiAgICBwLnN5bnRheCAgICAgICAgICAgPSBudWxsO1xyXG4gICAgcC5weXRob25fd29ya3NwYWNlID0gbnVsbDtcclxuICAgIHAudmFycyAgICAgICAgICAgICA9IG51bGw7XHJcbiAgICBwLnZhcmlhYmxlcyAgICAgICAgPSBudWxsO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gZ2VuZXJhbCBmdW5jdGlvbi5cclxuICAgICAqL1xyXG5cclxuICAgIHAuZHVtbXkgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICBcdC8vIER1bW15IGZ1bmN0aW9uLCBjb250aW51ZSBleGVjdXRpb24gb2YgYW4gaXRlbSBkaXJlY3RseS5cclxuICAgIH07XHJcbiAgIFxyXG4gICAgcC5yZXNvbHV0aW9uID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgXHQvKiAvLyBSZXR1cm5zIHRoZSBkaXNwbGF5IHJlc29sdXRpb24gYW5kIGNoZWNrcyB3aGV0aGVyIHRoZSByZXNvbHV0aW9uIGlzIHZhbGlkLlxyXG4gICAgICAgIHZhciB3ID0gdGhpcy52YXJzLmdldCgnd2lkdGgnKTtcclxuXHR2YXIgaCA9IHRoaXMudmFycy5nZXQoJ2hlaWdodCcpO1xyXG5cdGlmICgodHlwZW9mIHcgIT09ICdudW1iZXInKSB8fCAodHlwZW9mIGggIT09ICdudW1iZXInKSlcclxuXHR7XHJcbiAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKCcoJyArIFN0cmluZyh3KSArICcsJyArIFN0cmluZyhoKSArICcpIGlzIG5vdCBhIHZhbGlkIHJlc29sdXRpb24nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIFt3LCBoXTsgKi9cclxuICAgIH07XHJcbiAgIFxyXG4gICAgcC5zZXRfcmVzcG9uc2UgPSBmdW5jdGlvbihwUmVzcG9uc2UsIHBSZXNwb25zZV90aW1lLCBwQ29ycmVjdClcclxuICAgIHtcclxuXHQvLyBQcm9jZXNzZXMgYSByZXNwb25zZSBpbiBzdWNoIGEgd2F5IHRoYXQgZmVlZGJhY2sgdmFyaWFibGVzIGFyZSB1cGRhdGVkIGFzIHdlbGwuXHJcbiAgICAgICAgY29uc29sZS5sb2coJ3dhcm5pbmc6IG1ldGhvZCBcIml0ZW0uc2V0X3Jlc3BvbnNlXCIgbm90IGltcGxlbWVudGVkIHlldC4nKTtcclxuICAgIH07XHJcbiBcclxuICAgIHAuc2xlZXAgPSBmdW5jdGlvbihwTXMpXHJcbiAgICB7XHJcblx0Ly8gUGF1c2VzIHRoZSBvYmplY3QgZXhlY3V0aW9uLiAhV0FSTklORyBUaGlzIGZ1bmN0aW9uIGNhbiBub3QgYmUgaW1wbGVtZW50ZWQgZHVlIHRoZSBzY3JpcHQgYmxvY2tpbmcgb2YgamF2YXNjcmlwdC5cclxuXHR0aGlzLmNsb2NrLnNsZWVwKHBNcyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAudGltZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBSZXR1cm5zIHRoZSBjdXJyZW50IHRpbWUuXHJcbiAgICBcdHJldHVybiB0aGlzLmNsb2NrLnRpbWUoKTtcclxuICAgIH07XHJcblxyXG4gICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gYnVpbGQgY3ljbGUuICAgICAgICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLmZyb21fc3RyaW5nID0gZnVuY3Rpb24ocFN0cmluZylcclxuICAgIHtcclxuXHQvLyBQYXJzZXMgdGhlIGl0ZW0gZnJvbSBhIGRlZmluaXRpb24gc3RyaW5nLlxyXG5cdG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2UoJycpO1xyXG4gICAgICAgIHRoaXMudmFyaWFibGVzID0ge307XHJcblx0dGhpcy5yZXNldCgpO1xyXG5cdHRoaXMuY29tbWVudHMgPSBbXTtcclxuXHR0aGlzLnJlc2V0KCk7XHJcblx0XHRcclxuXHQvLyBTcGxpdCB0aGUgc3RyaW5nIGludG8gYW4gYXJyYXkgb2YgbGluZXMuICBcclxuXHRpZiAocFN0cmluZyAhPSBudWxsKVxyXG5cdHtcclxuICAgICAgICAgICAgdmFyIGxpbmVzID0gcFN0cmluZy5zcGxpdCgnXFxuJyk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGk9MDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKGxpbmVzW2ldICE9ICcnKSAmJiAodGhpcy5wYXJzZV92YXJpYWJsZShsaW5lc1tpXSkgPT0gZmFsc2UpKVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJzZV9saW5lKGxpbmVzW2ldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cdH1cdFx0XHRcdFx0XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC5wYXJzZV9jb21tZW50ID0gZnVuY3Rpb24ocExpbmUpXHJcbiAgICB7XHJcblx0Ly8gUGFyc2VzIGNvbW1lbnRzIGZyb20gYSBzaW5nbGUgZGVmaW5pdGlvbiBsaW5lLCBpbmRpY2F0ZWQgYnkgIyAvLyBvciAnLlxyXG5cdHBMaW5lID0gcExpbmUudHJpbSgpO1xyXG5cdGlmICgocExpbmUubGVuZ3RoID4gMCkgJiYgKHBMaW5lLmNoYXJBdCgwKSA9PSAnIycpKVxyXG5cdHtcclxuICAgICAgICAgICAgLy8gQWRkIGNvbW1lbnRzIHRvIHRoZSBhcnJheSByZW1vdmluZyB0aGUgZmlyc3QgY2hhcmFjdGVyLlxyXG4gICAgICAgICAgICB0aGlzLmNvbW1lbnRzLnB1c2gocExpbmUuc2xpY2UoMSkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcblx0fVx0XHJcblx0ZWxzZSBpZiAoKHBMaW5lLmxlbmd0aCA+IDEpICYmIChwTGluZS5jaGFyQXQoMCkgPT0gJy8nKSlcclxuXHR7XHJcbiAgICAgICAgICAgIC8vIEFkZCBjb21tZW50cyB0byB0aGUgYXJyYXkgcmVtb3ZpbmcgdGhlIGZpcnN0IHR3byBjaGFyYWN0ZXJzLlxyXG4gICAgICAgICAgICB0aGlzLmNvbW1lbnRzLnB1c2gocExpbmUuc2xpY2UoMikpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHRcdFx0XHJcblx0fVxyXG5cdGVsc2VcclxuXHR7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHR9XHJcbiAgICB9O1x0XHJcblx0XHJcbiAgICBwLnBhcnNlX2tleXdvcmQgPSBmdW5jdGlvbihwTGluZSwgcEZyb21fYXNjaWksIHBFdmFsKVxyXG4gICAge1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnBhcnNlX2xpbmUgPSBmdW5jdGlvbihwTGluZSlcclxuICAgIHtcclxuXHQvLyBBbGxvd3MgZm9yIGFyYml0cmFyeSBsaW5lIHBhcnNpbmcsIGZvciBpdGVtLXNwZWNpZmljIHJlcXVpcmVtZW50cy5cclxuICAgIH07XHJcblxyXG4gICAgcC5wYXJzZV92YXJpYWJsZSA9IGZ1bmN0aW9uKHBMaW5lKVxyXG4gICAge1xyXG4gICAgICAgIC8vIFJlYWRzIGEgc2luZ2xlIHZhcmlhYmxlIGZyb20gYSBzaW5nbGUgZGVmaW5pdGlvbiBsaW5lLlxyXG4gICAgICAgIGlmICh0aGlzLnBhcnNlX2NvbW1lbnQocExpbmUpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciB0b2tlbnMgPSBvc3dlYi5zeW50YXguc3BsaXQocExpbmUpO1xyXG4gICAgICAgICAgICBpZiAoKHRva2VucyAhPSBudWxsKSAmJiAodG9rZW5zLmxlbmd0aCA+IDApICYmICh0b2tlbnNbMF0gPT0gJ3NldCcpKVxyXG4gICAgICAgICAgICB7XHJcblx0XHRpZiAodG9rZW5zLmxlbmd0aCAhPSAzKVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKCdFcnJvciBwYXJzaW5nIHZhcmlhYmxlIGRlZmluaXRpb246ICcgKyBwTGluZSk7XHJcblx0XHR9XHRcclxuICAgICAgICAgICAgXHRlbHNlXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dHJpZXZlIHRoZSB2YWx1ZSBvZiB0aGUgdmFyaWFibGUsIHJlbW92ZSBhZGRpdGlvbmFsIHF1b3Rlcy5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBvc3dlYi5zeW50YXgucmVtb3ZlX3F1b3Rlcyh0b2tlbnNbMl0pO1xyXG4gICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBudW1iZXIgdHlwZXMuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvc3dlYi5zeW50YXguaXNOdW1iZXIodmFsdWUpID8gTnVtYmVyKHZhbHVlKSA6IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmFycy5zZXQodG9rZW5zWzFdLCB2YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG5cdFx0fVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVx0XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW5uIGN5Y2xlLiBcclxuICAgICAqL1xyXG4gICAgXHJcbiAgICBwLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFJlc2V0cyBhbGwgaXRlbSB2YXJpYWJsZXMgdG8gdGhlaXIgZGVmYXVsdCB2YWx1ZS5cclxuICAgIH07XHJcblxyXG4gICAgcC5wcmVwYXJlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIEltcGxlbWVudHMgdGhlIHByZXBhcmUgcGhhc2Ugb2YgdGhlIGl0ZW0uXHJcblx0dGhpcy5leHBlcmltZW50LnZhcnMuc2V0KCdjb3VudF8nICsgdGhpcy5uYW1lLCB0aGlzLmNvdW50KTtcclxuXHR0aGlzLmNvdW50Kys7XHJcblx0XHRcclxuXHQvLyBTZXQgdGhlIHN0YXR1cyB0byBpbml0aWFsaXplLlxyXG5cdHRoaXMuX3N0YXR1cyA9IG9zd2ViLmNvbnN0YW50cy5TVEFUVVNfSU5JVElBTElaRTtcclxuICAgIFx0XHJcbiAgICAgICAgLy8gRm9yIGRlYnVnZ2luZy5cclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKCdwcmVwYXJlJyArIHRoaXMubmFtZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gSW1wbGVtZW50cyB0aGUgY29tcGxldGUgcGhhc2Ugb2YgdGhlIGl0ZW0gKHRvIHN1cHBvcnQgYmxvY2tpbmcgc2NyaXB0IGluIHRoZSBwcmVwYXJlIHBoYXNlKS5cclxuXHRpZiAoKHRoaXMuX3BhcmVudCAhPT0gbnVsbCkgJiYgKHRoaXMudHlwZSAhPT0gJ2ZlZWRiYWNrJykpXHJcblx0e1xyXG4gICAgICAgICAgICAvLyBQcmVwYXJlIGN5Y2xlIG9mIHBhcmVudC5cclxuICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByZXBhcmVfY29tcGxldGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHAucHJlcGFyZV9jb21wbGV0ZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBEdW1teSBmdW5jdGlvbiBmb3IgY29tcGxldGlvbiBwcm9jZXNzLlxyXG4gICAgfTtcclxuXHJcbiAgICBwLnNldF9pdGVtX29uc2V0ID0gZnVuY3Rpb24ocFRpbWUpXHJcbiAgICB7XHJcbiBcdC8vIFNldCBhIHRpbWVzdGFtcCBmb3IgdGhlIGl0ZW0ncyBleGVjdXRpb25zXHJcblx0dmFyIHRpbWUgPSAocFRpbWUgIT0gbnVsbCkgPyBwVGltZSA6IHRoaXMuY2xvY2sudGltZSgpO1xyXG5cdHRoaXMuZXhwZXJpbWVudC52YXJzLnNldCgndGltZV8nICsgdGhpcy5uYW1lLCB0aW1lKTtcclxuICAgIH07XHRcclxuXHJcbiAgICBwLnJ1biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gSW1wbGVtZW50cyB0aGUgcnVuIHBoYXNlIG9mIHRoZSBpdGVtLlxyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2UoJ3J1bicgKyB0aGlzLm5hbWUpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnVwZGF0ZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gSW1wbGVtZW50cyB0aGUgdXBkYXRlIHBoYXNlIG9mIHRoZSBpdGVtLlxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcC51cGRhdGVfcmVzcG9uc2UgPSBmdW5jdGlvbihwUmVzcG9uc2UpXHJcbiAgICB7XHJcblx0Ly8gSW1wbGVtZW50cyB0aGUgdXBkYXRlX3Jlc3BvbnNlIHBoYXNlIG9mIGFuIGl0ZW0uXHJcbiAgICB9O1x0XHJcblxyXG4gICAgcC5jb21wbGV0ZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gSW1wbGVtZW50cyB0aGUgY29tcGxldGUgcGhhc2Ugb2YgdGhlIGl0ZW0uXHJcblx0aWYgKHRoaXMuX3BhcmVudCAhPT0gbnVsbClcclxuXHR7XHJcbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgcHJvY2VzcyBjb250cm9sIHRvIHRoZSBwYXJlbnQgb2YgdGhlIGVsZW1lbnQuXHJcbiAgICAgICAgICAgIG9zd2ViLmV2ZW50cy5fY3VycmVudF9pdGVtID0gdGhpcy5fcGFyZW50O1xyXG4gICAgICAgICAgICBvc3dlYi5ldmVudHMuX2N1cnJlbnRfaXRlbS5ydW4oKTsgIFxyXG5cdH1cclxuICAgIH07XHJcbiAgXHJcbiAgICAvLyBCaW5kIHRoZSBpdGVtIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5pdGVtID0gaXRlbTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGdlbmVyaWNfcmVzcG9uc2UuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGdlbmVyaWNfcmVzcG9uc2UocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZCBjcmVhdGUuXHJcblx0dGhpcy5pdGVtX2NvbnN0cnVjdG9yKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCk7XHJcblx0XHJcblx0Ly8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIHByb3BlcnRpZXMuXHJcblx0dGhpcy5fYWxsb3dlZF9yZXNwb25zZXMgPSBudWxsO1xyXG5cdHRoaXMuX2R1cmF0aW9uICAgICAgICAgID0gMDtcclxuXHR0aGlzLl9kdXJhdGlvbl9mdW5jIFx0PSBudWxsO1xyXG5cdHRoaXMuX2tleWJvYXJkXHRcdD0gbnVsbDtcclxuXHR0aGlzLl9tb3VzZSAgICAgICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5fcmVzcG9uc2V0eXBlXHQ9IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9OT05FO1xyXG5cdHRoaXMuX3RpbWVvdXQgICAgICAgICAgID0gLTE7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MoZ2VuZXJpY19yZXNwb25zZSwgb3N3ZWIuaXRlbSk7XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwdWJsaWMgcHJvcGVydGllcy5cclxuICAgIHAuYXV0b19yZXNwb25zZSAgICA9IFwiYVwiO1xyXG4gICAgcC5wcm9jZXNzX2ZlZWRiYWNrID0gZmFsc2U7XHJcbiAgICBwLnN5bm9ueW1zICAgICAgICAgPSBudWxsO1xyXG4gIFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBidWlsZCBjeWNsZS4gXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLmF1dG9fcmVzcG9uc2VyID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmF1dG9fcmVzcG9uc2VyX21vdXNlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnByZXBhcmVfYWxsb3dlZF9yZXNwb25zZXMgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gUHJlcGFyZSB0aGUgYWxsb3dlZCByZXNwb25zZXMuLlxyXG4gICAgICAgIGlmICh0aGlzLnZhcnMuZ2V0KCdhbGxvd2VkX3Jlc3BvbnNlcycpID09IG51bGwpXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLl9hbGxvd2VkX3Jlc3BvbnNlcyA9IG51bGw7XHJcblx0fVxyXG5cdGVsc2VcclxuXHR7XHRcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbGlzdCBvZiBhbGxvd2VkIHJlc3BvbnNlcyB0aGF0IGFyZSBzZXBhcmF0ZWQgYnkgc2VtaWNvbG9ucy4gQWxzbyB0cmltIGFueSB3aGl0ZXNwYWNlLlxyXG4gICAgICAgICAgICB2YXIgYWxsb3dlZF9yZXNwb25zZXMgPSBTdHJpbmcodGhpcy52YXJzLmFsbG93ZWRfcmVzcG9uc2VzKS5zcGxpdCgnOycpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHRoaXMudmFycy5kdXJhdGlvbiA9PSAna2V5cHJlc3MnKVxyXG4gICAgICAgICAgICB7XHRcclxuXHRcdC8vdGhpcy5fYWxsb3dlZF9yZXNwb25zZXMgPSBhbGxvd2VkX3Jlc3BvbnNlcztcclxuICAgICAgICAgICAgICAgIHRoaXMuX2FsbG93ZWRfcmVzcG9uc2VzID0gdGhpcy5fa2V5Ym9hcmQuX2dldF9kZWZhdWx0X2Zyb21fc3lub25pZW0oYWxsb3dlZF9yZXNwb25zZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMudmFycy5kdXJhdGlvbiA9PSAnbW91c2VjbGljaycpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vIEZvciBtb3VzZSByZXNwb25zZXMsIHdlIGRvbid0IGNoZWNrIGlmIHRoZSBhbGxvd2VkIHJlc3BvbnNlcyBtYWtlIHNlbnNlLlxyXG4gICAgICAgICAgICBcdHRoaXMuX2FsbG93ZWRfcmVzcG9uc2VzID0gdGhpcy5fbW91c2UuX2dldF9kZWZhdWx0X2Zyb21fc3lub25pZW0oYWxsb3dlZF9yZXNwb25zZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBJZiBhbGxvd2VkIHJlc3BvbnNlcyBhcmUgcHJvdmlkZWQsIHRoZSBsaXN0IHNob3VsZCBub3QgYmUgZW1wdHkuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9hbGxvd2VkX3Jlc3BvbnNlcy5sZW5ndGggPT0gMClcclxuICAgICAgICAgICAge1xyXG5cdFx0b3N3ZWIuZGVidWcuYWRkRXJyb3IodGhpcy52YXJzLmdldCgnYWxsb3dlZF9yZXNwb25zZXMnKSArICcgYXJlIG5vdCB2YWxpZCBhbGxvd2VkIHJlc3BvbnNlcyBpbiBrZXlib2FyZF9yZXNwb25zZSAnKyB0aGlzLm5hbWUpO1x0XHJcbiAgICAgICAgICAgIH0gXHJcblx0fVxyXG4gICAgfTtcclxuXHRcdFxyXG4gICAgcC5wcmVwYXJlX2R1cmF0aW9uID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFByZXBhcmUgdGhlIGR1cmF0aW9uLlxyXG4gICAgICAgIGlmICh0aGlzLnZhcnMuZ2V0KCdkdXJhdGlvbicpICE9IG51bGwpXHJcblx0e1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMudmFycy5kdXJhdGlvbiA9PSAnbnVtYmVyJylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgIFx0Ly8gUHJlcGFyZSBhIGR1cmF0aW9uIGluIG1pbGxpc2Vjb25kc1xyXG5cdFx0dGhpcy5fZHVyYXRpb24gPSB0aGlzLnZhcnMuZHVyYXRpb247XHJcblx0XHRpZiAodGhpcy5fZHVyYXRpb24gPT0gMClcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNwb25zZXR5cGUgPSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfTk9ORTtcclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdHtcdFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc3BvbnNldHlwZSA9IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9EVVJBVElPTjtcclxuXHRcdH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuXHRcdHRoaXMuX2R1cmF0aW9uID0gLTE7XHJcblx0XHRpZiAodGhpcy52YXJzLmR1cmF0aW9uID09ICdrZXlwcmVzcycpXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmVwYXJlX2R1cmF0aW9uX2tleXByZXNzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzcG9uc2V0eXBlID0gb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX0tFWUJPQVJEO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAodGhpcy52YXJzLmR1cmF0aW9uID09ICdtb3VzZWNsaWNrJylcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXBhcmVfZHVyYXRpb25fbW91c2VjbGljaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc3BvbnNldHlwZSA9IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9NT1VTRTtcclxuXHRcdH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMudmFycy5kdXJhdGlvbiA9PSAnc291bmQnKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc3BvbnNldHlwZSA9IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9TT1VORDtcclxuICAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLnZhcnMuZHVyYXRpb24gPT0gJ3ZpZGVvJylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNwb25zZXR5cGUgPSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfVklERU87XHJcbiAgICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICB9XHRcdFxyXG5cdH1cclxuICAgIH07XHJcblx0XHJcbiAgICBwLnByZXBhcmVfZHVyYXRpb25fa2V5cHJlc3MgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gUHJlcGFyZSBhIGtleWJvYXJkIGR1cmF0aW9uLlxyXG5cdHRoaXMuX2tleWJvYXJkID0gbmV3IG9zd2ViLmtleWJvYXJkKHRoaXMuZXhwZXJpbWVudCk7XHJcblx0aWYgKHRoaXMuZXhwZXJpbWVudC5hdXRvX3Jlc3BvbnNlID09IHRydWUpXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLl9kdXJhdGlvbl9mdW5jID0gdGhpcy5hdXRvX3Jlc3BvbmRlcjtcclxuXHR9XHJcblx0ZWxzZVxyXG5cdHtcclxuICAgICAgICAgICAgdmFyIGZpbmFsX2R1cmF0aW9uID0gKHRoaXMuX3RpbWVvdXQgIT0gLTEpID8gdGhpcy5fdGltZW91dCA6IHRoaXMuX2R1cmF0aW9uO1xyXG4gICAgICAgICAgICB0aGlzLl9rZXlib2FyZC5zZXRfY29uZmlnKGZpbmFsX2R1cmF0aW9uLCB0aGlzLl9hbGxvd2VkX3Jlc3BvbnNlcyk7XHJcblx0fVxyXG4gICAgfTtcclxuXHRcclxuICAgIHAucHJlcGFyZV9kdXJhdGlvbl9tb3VzZWNsaWNrID0gZnVuY3Rpb24oc2VsZilcclxuICAgIHtcclxuXHQvLyBQcmVwYXJlIGEgbW91c2VjbGljayBkdXJhdGlvbi5cclxuXHR0aGlzLl9tb3VzZSA9IG5ldyBvc3dlYi5tb3VzZSh0aGlzLmV4cGVyaW1lbnQpO1xyXG5cdGlmICh0aGlzLmV4cGVyaW1lbnQuYXV0b19yZXNwb25zZSA9PSB0cnVlKVxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy5fZHVyYXRpb25fZnVuYyA9IHRoaXMuYXV0b19yZXNwb25kZXJfbW91c2U7XHJcblx0fVxyXG5cdGVsc2VcclxuXHR7XHJcbiAgICAgICAgICAgIHZhciBmaW5hbF9kdXJhdGlvbiA9ICh0aGlzLl90aW1lb3V0ICE9IC0xKSA/IHRoaXMuX3RpbWVvdXQgOiB0aGlzLl9kdXJhdGlvbjtcclxuICAgICAgICAgICAgdGhpcy5fbW91c2Uuc2V0X2NvbmZpZyhmaW5hbF9kdXJhdGlvbiwgdGhpcy5fYWxsb3dlZF9yZXNwb25zZXMsIGZhbHNlKTtcclxuXHR9XHJcbiAgICB9O1x0XHJcblxyXG4gICAgcC5wcmVwYXJlX3RpbWVvdXQgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gUHJlcGFyZSB0aGUgdGltZW91dC5cclxuXHRpZiAodGhpcy52YXJzLmdldCgndGltZW91dCcpICE9IG51bGwpIFxyXG5cdHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnZhcnMudGltZW91dCA9PSAnbnVtYmVyJylcclxuICAgICAgICAgICAge1xyXG5cdFx0Ly8gUHJlcGFyZSBhIGR1cmF0aW9uIGluIG1pbGxpc2Vjb25kc1xyXG4gICAgICAgICAgICBcdHRoaXMuX3RpbWVvdXQgPSB0aGlzLnZhcnMudGltZW91dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuXHRcdHRoaXMuX3RpbWVvdXQgPSAtMTtcclxuICAgICAgICAgICAgfVx0XHRcclxuXHR9XHJcbiAgICB9O1x0XHJcbiAgICBcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVuIGN5Y2xlLiBcclxuICAgICAqL1xyXG5cclxuICAgIHAucHJvY2Vzc19yZXNwb25zZV9rZXlwcmVzcyA9IGZ1bmN0aW9uKHBSZXR2YWwpXHJcbiAgICB7XHJcblx0dGhpcy5leHBlcmltZW50Ll9zdGFydF9yZXNwb25zZV9pbnRlcnZhbCA9IHRoaXMuc3JpO1xyXG5cdHRoaXMuZXhwZXJpbWVudC5fZW5kX3Jlc3BvbnNlX2ludGVydmFsICAgPSBwUmV0dmFsLnJ0VGltZTtcclxuXHR0aGlzLmV4cGVyaW1lbnQudmFycy5yZXNwb25zZSAgICAgICAgICAgID0gdGhpcy5zeW50YXguc2FuaXRpemUocFJldHZhbC5yZXNwKTtcclxuXHR0aGlzLnN5bm9ueW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gdGhpcy5fa2V5Ym9hcmQuc3lub255bXModGhpcy5leHBlcmltZW50LnZhcnMucmVzcG9uc2UpOyBcclxuXHR0aGlzLnJlc3BvbnNlX2Jvb2trZWVwaW5nKCk7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC5wcm9jZXNzX3Jlc3BvbnNlX21vdXNlY2xpY2sgPSBmdW5jdGlvbihwUmV0dmFsKVxyXG4gICAge1xyXG4gXHR0aGlzLmV4cGVyaW1lbnQuX3N0YXJ0X3Jlc3BvbnNlX2ludGVydmFsID0gdGhpcy5zcmk7XHJcblx0dGhpcy5leHBlcmltZW50Ll9lbmRfcmVzcG9uc2VfaW50ZXJ2YWwgICA9IHBSZXR2YWwucnRUaW1lO1xyXG5cdHRoaXMuZXhwZXJpbWVudC52YXJzLnJlc3BvbnNlXHRcdCA9IHBSZXR2YWwucmVzcDtcclxuXHR0aGlzLnN5bm9ueW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gdGhpcy5fbW91c2Uuc3lub255bXModGhpcy5leHBlcmltZW50LnZhcnMucmVzcG9uc2UpO1xyXG5cdHRoaXMuZXhwZXJpbWVudC52YXJzLmN1cnNvcl94ICAgICAgICAgICAgPSBwUmV0dmFsLmV2ZW50LmNsaWVudFg7XHJcblx0dGhpcy5leHBlcmltZW50LnZhcnMuY3Vyc29yX3kgICAgICAgICAgICA9IHBSZXR2YWwuZXZlbnQuY2xpZW50WTtcclxuXHR0aGlzLnJlc3BvbnNlX2Jvb2trZWVwaW5nKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAucmVzcG9uc2VfYm9va2tlZXBpbmcgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gVGhlIHJlc3BvbmUgYW5kIHJlc3BvbnNlX3RpbWUgdmFyaWFibGVzIGFyZSBhbHdheXMgc2V0LCBmb3IgZXZlcnkgcmVzcG9uc2UgaXRlbVxyXG5cdHRoaXMuZXhwZXJpbWVudC52YXJzLnNldCgncmVzcG9uc2VfdGltZScsIHRoaXMuZXhwZXJpbWVudC5fZW5kX3Jlc3BvbnNlX2ludGVydmFsIC0gdGhpcy5leHBlcmltZW50Ll9zdGFydF9yZXNwb25zZV9pbnRlcnZhbCk7XHJcblx0dGhpcy5leHBlcmltZW50LnZhcnMuc2V0KCdyZXNwb25zZV8nICsgdGhpcy5uYW1lLCB0aGlzLmV4cGVyaW1lbnQudmFycy5nZXQoJ3Jlc3BvbnNlJykpO1xyXG5cdHRoaXMuZXhwZXJpbWVudC52YXJzLnNldCgncmVzcG9uc2VfdGltZV8nICsgdGhpcy5uYW1lLCB0aGlzLmV4cGVyaW1lbnQudmFycy5nZXQoJ3Jlc3BvbnNlX3RpbWUnKSk7XHJcblx0dGhpcy5leHBlcmltZW50Ll9zdGFydF9yZXNwb25zZV9pbnRlcnZhbCA9IG51bGw7XHJcblxyXG5cdC8vIEJ1dCBjb3JyZWN0bmVzcyBpbmZvcm1hdGlvbiBpcyBvbmx5IHNldCBmb3IgZGVkaWNhdGVkIHJlc3BvbnNlIGl0ZW1zLCBzdWNoIGFzIGtleWJvYXJkX3Jlc3BvbnNlIGl0ZW1zLCBiZWNhdXNlIG90aGVyd2lzZSB3ZSBtaWdodCBjb25mb3VuZCB0aGUgZmVlZGJhY2tcclxuXHRpZiAodGhpcy5wcm9jZXNzX2ZlZWRiYWNrID09IHRydWUpXHJcblx0e1xyXG4gICAgICAgICAgICAvLyBkZWJ1Zy5tc2codVwicHJvY2Vzc2luZyBmZWVkYmFjayBmb3IgJyVzJ1wiICUgc2VsZi5uYW1lKVxyXG4gICAgICAgICAgICBpZiAodGhpcy52YXJzLmNvcnJlY3RfcmVzcG9uc2UgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy8gSWYgYSBjb3JyZWN0X3Jlc2Jwb25zZSBoYXMgYmVlbiBkZWZpbmVkLCB3ZSB1c2UgaXQgdG8gZGV0ZXJtaW5lIGFjY3VyYWN5IGV0Yy5cclxuXHRcdGlmICh0aGlzLnN5bm9ueW1zICE9IG51bGwpICBcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zeW5vbnltcy5pbmRleE9mKFN0cmluZyh0aGlzLnZhcnMuZ2V0KCdjb3JyZWN0X3Jlc3BvbnNlJykpKSAhPSAtMSlcclxuICAgICAgICAgICAgICAgICAgICB7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQudmFycy5jb3JyZWN0ICAgICAgID0gMTtcclxuXHRcdFx0dGhpcy5leHBlcmltZW50LnZhcnMudG90YWxfY29ycmVjdCA9IHRoaXMuZXhwZXJpbWVudC52YXJzLnRvdGFsX2NvcnJlY3QgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQudmFycy5jb3JyZWN0ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblx0XHR9XHRcclxuXHRcdGVsc2VcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQudmFycy5jb3JyZWN0ID0gJ3VuZGVmaW5lZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgLyogaWYgc2VsZi5leHBlcmltZW50LnJlc3BvbnNlIGluIChjb3JyZWN0X3Jlc3BvbnNlLCBzYWZlX2RlY29kZShjb3JyZWN0X3Jlc3BvbnNlKSk6XHJcbiAgICAgICAgICAgICAgICAgICAgXHRzZWxmLmV4cGVyaW1lbnQudmFyLmNvcnJlY3QgPSAxXHJcblx0XHRcdHNlbGYuZXhwZXJpbWVudC52YXIudG90YWxfY29ycmVjdCArPSAxXHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZTpcclxuICAgICAgICAgICAgICAgICAgICBcdHNlbGYuZXhwZXJpbWVudC52YXIuY29ycmVjdCA9IDAgKi9cclxuXHRcdH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vIElmIGEgY29ycmVjdF9yZXNwb25zZSBoYXNuJ3QgYmVlbiBkZWZpbmVkLCB3ZSBzaW1wbHkgc2V0IGNvcnJlY3QgdG8gdW5kZWZpbmVkLlxyXG5cdFx0dGhpcy5leHBlcmltZW50LnZhcnMuY29ycmVjdCA9ICd1bmRlZmluZWQnO1xyXG4gICAgICAgICAgICB9XHRcclxuXHJcbiAgICAgICAgICAgIC8vIERvIHNvbWUgcmVzcG9uc2UgYm9va2tlZXBpbmdcclxuICAgICAgICAgICAgdGhpcy5leHBlcmltZW50LnZhcnMudG90YWxfcmVzcG9uc2VfdGltZSAgID0gdGhpcy5leHBlcmltZW50LnZhcnMudG90YWxfcmVzcG9uc2VfdGltZSArIHRoaXMuZXhwZXJpbWVudC52YXJzLnJlc3BvbnNlX3RpbWU7XHJcbiAgICAgICAgICAgIHRoaXMuZXhwZXJpbWVudC52YXJzLnRvdGFsX3Jlc3BvbnNlcyAgICAgICA9IHRoaXMuZXhwZXJpbWVudC52YXJzLnRvdGFsX3Jlc3BvbnNlcyArIDE7XHJcbiAgICAgICAgICAgIHRoaXMuZXhwZXJpbWVudC52YXJzLmFjY3VyYWN5ICAgICAgICAgICAgICA9IE1hdGgucm91bmQoMTAwLjAgKiB0aGlzLmV4cGVyaW1lbnQudmFycy50b3RhbF9jb3JyZWN0IC8gdGhpcy5leHBlcmltZW50LnZhcnMudG90YWxfcmVzcG9uc2VzKTtcclxuICAgICAgICAgICAgdGhpcy5leHBlcmltZW50LnZhcnMuYWNjICAgICAgICBcdCAgICAgICA9IHRoaXMuZXhwZXJpbWVudC52YXJzLmFjY3VyYWN5O1xyXG4gICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQudmFycy5hdmVyYWdlX3Jlc3BvbnNlX3RpbWUgPSBNYXRoLnJvdW5kKHRoaXMuZXhwZXJpbWVudC52YXJzLnRvdGFsX3Jlc3BvbnNlX3RpbWUgLyB0aGlzLmV4cGVyaW1lbnQudmFycy50b3RhbF9yZXNwb25zZXMpO1xyXG4gICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQudmFycy5hdmdfcnQgICAgICAgICAgICAgICAgPSB0aGlzLmV4cGVyaW1lbnQudmFycy5hdmVyYWdlX3Jlc3BvbnNlX3RpbWU7XHJcbiAgICAgICAgICAgIHRoaXMuZXhwZXJpbWVudC52YXJzLnNldCgnY29ycmVjdF8nICsgdGhpcy5uYW1lLCB0aGlzLnZhcnMuY29ycmVjdCk7IFxyXG5cdH0gXHJcbiAgICB9O1x0XHJcblx0XHJcbiAgICBwLnByb2Nlc3NfcmVzcG9uc2UgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gU3RhcnQgc3RpbXVsdXMgcmVzcG9uc2UgY3ljbGUuXHJcbiAgIFx0c3dpdGNoICh0aGlzLl9yZXNwb25zZXR5cGUpXHJcbiAgIFx0e1xyXG4gICAgICAgICAgICBjYXNlIG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9OT05FOlxyXG4gXHRcdC8vIER1cmF0aW9uIGlzIDAsIHNvIGNvbXBsZXRlIHRoZSBzdGltdWx1cy9yZXNwb25zZSBjeWNsZS5cclxuIFx0XHR0aGlzLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfRFVSQVRJT046XHJcblx0XHR0aGlzLnNsZWVwX2Zvcl9kdXJhdGlvbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2Ugb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX0tFWUJPQVJEOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fa2V5Ym9hcmQuZ2V0X2tleSgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2Ugb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX01PVVNFOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fbW91c2UuZ2V0X2NsaWNrKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfU09VTkQ6XHJcbiAgICAgICAgICAgICAgIHRoaXMuX3NhbXBsZXIud2FpdCgpO1xyXG5cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2Ugb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX1ZJREVPOlxyXG4gICAgICAgICAgICAgICB0aGlzLl92aWRlby53YWl0KCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgXHR9XHRcdFxyXG4gICAgfTtcclxuXHJcbiAgICBwLnNldF9zcmkgPSBmdW5jdGlvbihwUmVzZXQpXHJcbiAgICB7XHJcblx0Ly8gU2V0cyB0aGUgc3RhcnQgb2YgdGhlIHJlc3BvbnNlIGludGVydmFsLlxyXG5cdGlmIChwUmVzZXQgPT0gdHJ1ZSlcclxuXHR7XHJcbiAgICAgICAgICAgIHRoaXMuc3JpID0gc2VsZi52YXJzLmdldCgndGltZV8nICsgdGhpcy5uYW1lKTtcclxuICAgICAgICAgICAgdGhpcy5leHBlcmltZW50Ll9zdGFydF9yZXNwb25zZV9pbnRlcnZhbCA9IHRoaXMudmFycy5nZXQoJ3RpbWVfJyArIHRoaXMubmFtZSk7XHJcblx0fVxyXG5cdFxyXG5cdGlmICh0aGlzLmV4cGVyaW1lbnQuX3N0YXJ0X3Jlc3BvbnNlX2ludGVydmFsID09IG51bGwpXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLnNyaSA9IHRoaXMuZXhwZXJpbWVudC52YXJzLmdldCgndGltZV8nICsgdGhpcy5uYW1lKTtcclxuXHR9XHJcblx0ZWxzZVxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy5zcmkgPSB0aGlzLmV4cGVyaW1lbnQuX3N0YXJ0X3Jlc3BvbnNlX2ludGVydmFsO1xyXG5cdH1cclxuICAgIH07XHRcdFxyXG5cclxuICAgIHAuc2xlZXBfZm9yX2R1cmF0aW9uID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFNsZWVwIGZvciBhIHNwZWNpZmllZCB0aW1lLlxyXG5cdHRoaXMuc2xlZXAodGhpcy5fZHVyYXRpb24pO1x0XHRcclxuICAgIH07XHJcbiAgIFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW5uaW5nIGl0ZW0uIFxyXG4gICAgICovXHJcbiAgICBcclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBJbXBsZW1lbnRzIHRoZSBwcmVwYXJlIHBoYXNlIG9mIHRoZSBpdGVtLlxyXG5cdHRoaXMucHJlcGFyZV90aW1lb3V0KCk7XHJcblx0dGhpcy5wcmVwYXJlX2FsbG93ZWRfcmVzcG9uc2VzKCk7XHJcblx0dGhpcy5wcmVwYXJlX2R1cmF0aW9uKCk7XHJcbiAgICBcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLml0ZW1fcHJlcGFyZSgpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcC51cGRhdGVfcmVzcG9uc2UgPSBmdW5jdGlvbihwUmVzcG9uc2UpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW1wbGVtZW50cyB0aGUgdXBkYXRlIHJlc3BvbnNlIHBoYXNlIG9mIHRoZSBpdGVtLlxyXG5cdGlmICgodGhpcy5fcmVzcG9uc2V0eXBlID09IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9LRVlCT0FSRCkgJiYgKHBSZXNwb25zZS50eXBlID09IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9LRVlCT0FSRCkpIFxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy5wcm9jZXNzX3Jlc3BvbnNlX2tleXByZXNzKHBSZXNwb25zZSk7XHJcblx0fVxyXG5cdGVsc2UgaWYgKCh0aGlzLl9yZXNwb25zZXR5cGUgPT0gb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX01PVVNFKSAmJiAocFJlc3BvbnNlLnR5cGUgPT0gb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX01PVVNFKSkgXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NfcmVzcG9uc2VfbW91c2VjbGljayhwUmVzcG9uc2UpOyAgICAgXHJcblx0fVxyXG4gICAgfTsgXHJcblxyXG4gICAgLy8gQmluZCB0aGUgZ2VuZXJpY19yZXNwb25zZSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuZ2VuZXJpY19yZXNwb25zZSA9IG9zd2ViLnByb21vdGVDbGFzcyhnZW5lcmljX3Jlc3BvbnNlLCBcIml0ZW1cIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBleHBlcmltZW50LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBleHBlcmltZW50KHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCwgcFBvb2xfZm9sZGVyLCBwRXhwZXJpbWVudF9wYXRoLCBwRnVsbHNjcmVlbiwgcEF1dG9fcmVzcG9uc2UsIHBMb2dmaWxlLCBwU3ViamVjdF9uciwgcFdvcmtzcGFjZSwgcFJlc291cmNlcywgcEhlYXJ0YmVhdF9pbnRlcnZhbClcclxuICAgIHtcclxuXHQvLyBTZXQgdGhlIGl0ZW1zIHByb3BlcnR5IGZvciB0aGlzIGV4cGVyaW1lbnQuXHJcblx0b3N3ZWIuaXRlbV9zdG9yZS5fZXhwZXJpbWVudCA9IHRoaXM7XHJcblxyXG5cdC8vIFNldCB0aGUgb3B0aW9uYWwgYXJndW1lbnRzXHJcblx0cExvZ2ZpbGUgPSAodHlwZW9mIHBMb2dmaWxlID09PSAndW5kZWZpbmVkJykgPyBudWxsIDogcExvZ2ZpbGU7XHJcblxyXG5cdC8vIFNldCB0aGUgcHJpdmF0ZSBwcm9wZXJ0aWVzLiBcclxuXHR0aGlzLl9lbmRfcmVzcG9uc2VfaW50ZXJ2YWwgICA9IG51bGw7XHJcblx0dGhpcy5fc3RhcnRfcmVzcG9uc2VfaW50ZXJ2YWwgPSBudWxsO1xyXG5cdHRoaXMuX3N5bnRheCAgICAgICAgICAgICAgICAgID0gb3N3ZWIuc3ludGF4O1xyXG5cdHRoaXMuX3B5dGhvbl93b3Jrc3BhY2UgICAgICAgID0gKHBXb3Jrc3BhY2UpID8gcFdvcmtzcGFjZSA6IG9zd2ViLnB5dGhvbl93b3Jrc3BhY2U7XHJcblxyXG5cdC8vIFNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG5cdHRoaXMuYXV0b19yZXNwb25zZSAgICAgID0gKHBBdXRvX3Jlc3BvbnNlKSA/IHBBdXRvX3Jlc3BvbnNlIDogZmFsc2U7XHJcblx0dGhpcy5jbGVhbnVwX2Z1bmN0aW9ucyAgPSBbXTtcclxuXHR0aGlzLmhlYXJ0YmVhdF9pbnRlcnZhbCA9IChwSGVhcnRiZWF0X2ludGVydmFsKSA/IHBIZWFydGJlYXRfaW50ZXJ2YWwgOiAxO1xyXG5cdHRoaXMuaXRlbXMgICAgICAgICAgICAgID0gb3N3ZWIuaXRlbV9zdG9yZTtcclxuXHR0aGlzLm91dHB1dF9jaGFubmVsIFx0PSBudWxsO1xyXG5cdHRoaXMucGF1c2VkIFx0XHQ9IGZhbHNlO1xyXG5cdHRoaXMucGx1Z2luX2ZvbGRlciBcdD0gJ3BsdWdpbnMnO1xyXG5cdHRoaXMucG9vbCAgICAgICAgICAgICAgID0gb3N3ZWIuZmlsZV9wb29sX3N0b3JlO1xyXG5cdHRoaXMucmVzb3VyY2VzIFx0XHQ9IChwUmVzb3VyY2VzKSA/IHBSZXNvdXJjZXMgOiB7fTtcclxuXHR0aGlzLnJlc3RhcnQgXHRcdD0gZmFsc2U7XHJcblx0dGhpcy5ydW5uaW5nXHRcdD0gZmFsc2U7XHJcblx0dGhpcy52YXJzICAgICAgICAgICAgICAgPSBuZXcgb3N3ZWIudmFyX3N0b3JlKHRoaXMsIG51bGwpO1xyXG5cdFx0XHJcblx0Ly8gU2V0IGRlZmF1bHQgdmFyaWFibGVzXHJcblx0dGhpcy52YXJzLnN0YXJ0ICAgICAgICAgICAgICAgPSAnZXhwZXJpbWVudCc7XHJcblx0dGhpcy52YXJzLnRpdGxlICAgICAgICAgICAgICAgPSAnTXkgRXhwZXJpbWVudCc7XHJcblx0dGhpcy52YXJzLmJpZGkgICAgICAgICAgICAgICAgPSAnbm8nO1xyXG5cdHRoaXMudmFycy5yb3VuZF9kZWNpbWFscyAgICAgID0gMjtcclxuXHR0aGlzLnZhcnMuZm9ybV9jbGlja3MgICAgICAgICA9ICdubyc7XHJcblx0dGhpcy52YXJzLnVuaWZvcm1fY29vcmRpbmF0ZXMgPSAnbm8nO1xyXG5cclxuICAgICAgICAvLyBTb3VuZCBwYXJhbWV0ZXJzLlxyXG5cdHRoaXMudmFycy5zb3VuZF9mcmVxICAgICAgICAgID0gNDgwMDA7XHJcblx0dGhpcy52YXJzLnNvdW5kX3NhbXBsZV9zaXplICAgPSAtMTY7IFxyXG5cdHRoaXMudmFycy5zb3VuZF9jaGFubmVscyAgICAgID0gMjtcclxuXHR0aGlzLnZhcnMuc291bmRfYnVmX3NpemUgICAgICA9IDEwMjQ7XHJcblxyXG5cdC8vIERlZmF1bHQgYmFja2VuZFxyXG5cdHRoaXMudmFycy5jYW52YXNfYmFja2VuZCAgICAgID0gJ3hweXJpbWVudCc7XHJcblxyXG5cdC8vIERpc3BsYXkgcGFyYW1ldGVycy5cclxuXHR0aGlzLnZhcnMud2lkdGggICAgICAgICAgICAgICA9IDEwMjQ7XHJcblx0dGhpcy52YXJzLmhlaWdodCAgICAgICAgICAgICAgPSA3Njg7XHJcblx0dGhpcy52YXJzLmJhY2tncm91bmQgICAgICAgICAgPSAnYmxhY2snO1xyXG5cdHRoaXMudmFycy5mb3JlZ3JvdW5kICAgICAgICAgID0gJ3doaXRlJztcclxuXHR0aGlzLnZhcnMuZnVsbHNjcmVlbiAgICAgICAgICA9IChwRnVsbHNjcmVlbikgPyAneWVzJyA6ICdubyc7XHJcblxyXG5cdC8vIEZvbnQgcGFyYW1ldGVycy5cclxuXHR0aGlzLnZhcnMuZm9udF9zaXplICAgICAgICAgICA9IDE4O1xyXG5cdHRoaXMudmFycy5mb250X2ZhbWlseSAgICAgICAgID0gJ21vbm8nO1xyXG5cdHRoaXMudmFycy5mb250X2l0YWxpYyAgICAgICAgID0gJ25vJztcclxuXHR0aGlzLnZhcnMuZm9udF9ib2xkIFx0ICAgICAgPSAnbm8nO1xyXG5cdHRoaXMudmFycy5mb250X3VuZGVybGluZSAgICAgID0gJ25vJzsgXHJcblxyXG5cdC8vIExvZ2ZpbGUgcGFyYW1ldGVyc1xyXG5cdHRoaXMubG9nZmlsZSA9IHBMb2dmaWxlO1xyXG5cdHRoaXMuZGVidWcgICA9IG9zd2ViLmRlYnVnLmVuYWJsZWQ7XHJcblxyXG5cdC8vIENyZWF0ZSB0aGUgYmFja2VuZCBvYmplY3RzLlxyXG5cdHRoaXMuX2NhbnZhcyA9IG5ldyBvc3dlYi5jYW52YXModGhpcyk7XHJcblx0dGhpcy5fY2xvY2sgID0gbmV3IG9zd2ViLmNsb2NrKHRoaXMpO1xyXG5cdHRoaXMuX2xvZyAgICA9IG5ldyBvc3dlYi5sb2codGhpcywgdGhpcy5sb2dmaWxlKTtcclxuXHRcclxuICAgICAgICAvLyBTZXQgdGhlIGdsb2JhbCBhbmNob3JzLlxyXG4gICAgICAgIHdpbmRvd1snY2xvY2snXSA9IHRoaXMuX2Nsb2NrO1xyXG4gICAgICAgIHdpbmRvd1snbG9nJ10gICA9IHRoaXMuX2xvZzsgICAgXHJcbiAgICAgICAgXHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuaXRlbV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG4gICAgfSBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MoZXhwZXJpbWVudCwgb3N3ZWIuaXRlbSk7XHJcbiAgXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuYXV0b19yZXNwb25zZSAgICAgID0gZmFsc2U7XHJcbiAgICBwLmNsZWFudXBfZnVuY3Rpb25zICA9IFtdO1xyXG4gICAgcC5oZWFydGJlYXRfaW50ZXJ2YWwgPSAxO1xyXG4gICAgcC5pdGVtcyAgICAgICAgICAgICAgPSBudWxsO1xyXG4gICAgcC5vdXRwdXRfY2hhbm5lbCAgICAgPSBudWxsO1xyXG4gICAgcC5wYXVzZWQgICAgICAgICAgICAgPSBmYWxzZTtcclxuICAgIHAucGx1Z2luX2ZvbGRlciAgICAgID0gJyc7XHJcbiAgICBwLnBvb2wgICAgICAgICAgICAgICA9IG51bGw7XHJcbiAgICBwLnJlc291cmNlcyAgICAgICAgICA9IG51bGw7XHJcbiAgICBwLnJlc3RhcnQgICAgICAgICAgICA9IGZhbHNlO1xyXG4gICAgcC5ydW5uaW5nICAgICAgICAgICAgPSBmYWxzZTtcclxuICBcdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBnZW5lcmFsIGZ1bmN0aW9uLlxyXG4gICAgICovXHJcblxyXG4gICAgcC5pdGVtX3ByZWZpeCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBBIHByZWZpeCBmb3IgdGhlIHBsdWctaW4gY2xhc3Nlcywgc28gdGhhdCBbcHJlZml4XVtwbHVnaW5dIGNsYXNzIGlzIHVzZWQgaW5zdGVhZCBvZiB0aGUgW3BsdWdpbl0gY2xhc3MuXHJcblx0cmV0dXJuICcnO1x0XHRcclxuICAgIH07XHJcblxyXG4gICAgcC5yZXNldF9mZWVkYmFjayA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBSZXNldHMgdGhlIGZlZWRiYWNrIHZhcmlhYmxlcyAoYWNjLCBhdmdfcnQsIGV0Yy4pLlwiXCJcIlxyXG5cdHRoaXMudmFycy50b3RhbF9yZXNwb25zZXMgICAgICAgPSAwO1xyXG5cdHRoaXMudmFycy50b3RhbF9jb3JyZWN0ICAgICAgICAgPSAwO1xyXG5cdHRoaXMudmFycy50b3RhbF9yZXNwb25zZV90aW1lICAgPSAwO1xyXG5cdHRoaXMudmFycy5hdmdfcnQgICAgICAgICAgICAgICAgPSAndW5kZWZpbmVkJztcclxuXHR0aGlzLnZhcnMuYXZlcmFnZV9yZXNwb25zZV90aW1lID0gJ3VuZGVmaW5lZCc7XHJcblx0dGhpcy52YXJzLmFjY3VyYWN5ICAgICAgICAgICAgICA9ICd1bmRlZmluZWQnO1xyXG5cdHRoaXMudmFycy5hY2MgICAgICAgICAgICAgICAgICAgPSAndW5kZWZpbmVkJztcclxuICAgIH07XHJcblxyXG4gICAgcC5zZXRfc3ViamVjdCA9IGZ1bmN0aW9uKHBOcilcclxuICAgIHtcclxuXHQvLyBTZXRzIHRoZSBzdWJqZWN0IG51bWJlciBhbmQgcGFyaXR5IChldmVuLyBvZGQpLiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhdXRvbWF0aWNhbGx5IHdoZW4gYW4gZXhwZXJpbWVudCBpcyBzdGFydGVkLCBzbyB5b3UgZG8gbm90IGdlbmVyYWxseSBuZWVkIHRvIGNhbGwgaXQgeW91cnNlbGYuXHJcblx0dGhpcy52YXJzLnN1YmplY3RfbnIgPSBwTnI7XHJcblx0aWYgKChwTnIgJSAyKSA9PSAwKVxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy52YXJzLnN1YmplY3RfcGFyaXR5ID0gJ2V2ZW4nO1xyXG5cdH1cclxuXHRlbHNlXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLnZhcnMuc3ViamVjdF9wYXJpdHkgPSAnb2RkJztcclxuXHR9XHJcbiAgICB9O1xyXG4gIFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBidWlsZGluZyBpdGVtLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5yZWFkX2RlZmluaXRpb24gPSBmdW5jdGlvbihwU3RyaW5nKVxyXG4gICAge1xyXG4gICAgXHQvLyBFeHRyYWN0cyBhIHRoZSBkZWZpbml0aW9uIG9mIGEgc2luZ2xlIGl0ZW0gZnJvbSB0aGUgc3RyaW5nLlxyXG5cdHZhciBsaW5lID0gcFN0cmluZy5zaGlmdCgpO1xyXG5cdHZhciBkZWZfc3RyID0gJyc7XHJcbiAgICBcdHdoaWxlICgobGluZSAhPSBudWxsKSAmJiAobGluZS5sZW5ndGggPiAwKSAmJiAobGluZS5jaGFyQXQoMCkgPT0gJ1xcdCcpKVxyXG5cdHtcclxuICAgICAgICAgICAgZGVmX3N0ciA9IGRlZl9zdHIgKyBsaW5lICsgJ1xcbic7XHJcbiAgICAgICAgICAgIGxpbmUgPSBwU3RyaW5nLnNoaWZ0KCk7XHJcblx0fVx0XHJcblx0cmV0dXJuIGRlZl9zdHI7XHJcbiAgICB9O1x0XHJcblxyXG4gICAgcC5mcm9tX3N0cmluZyA9IGZ1bmN0aW9uKHBTdHJpbmcpXHJcbiAgICB7XHJcbiAgICBcdC8vIFNldCBkZWJ1ZyBtZXNzYWdlLlxyXG5cdG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2UoJ2J1aWxkaW5nIGV4cGVyaW1lbnQnKTtcclxuXHRcdFxyXG5cdC8vIFNwbGl0IHRoZSBzdHJpbmcgaW50byBhbiBhcnJheSBvZiBsaW5lcy4gIFxyXG5cdGlmIChwU3RyaW5nICE9IG51bGwpXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLl9zb3VyY2UgPSBwU3RyaW5nLnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgdmFyIGwgPSB0aGlzLl9zb3VyY2Uuc2hpZnQoKTtcclxuICAgICAgICAgICAgd2hpbGUgKGwgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG5cdFx0Ly8gU2V0IHRoZSBwcm9jZXNzaW5nIG9mIHRoZSBuZXh0IGxpbmUuXHJcblx0XHR2YXIgZ2V0X25leHQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIHRyeVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFNwbGl0IHRoZSBzaW5nbGUgbGluZSBpbnRvIGEgc2V0IG9mIHRva2Vucy5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IG9zd2ViLnN5bnRheC5zcGxpdChsKTtcdFx0XHRcdFx0XHJcblx0XHR9XHJcblx0XHRjYXRjaChlKVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHVcIkZhaWxlZCB0byBwYXJzZSBzY3JpcHQuIE1heWJlIGl0IGNvbnRhaW5zIGlsbGVnYWwgY2hhcmFjdGVycyBvciB1bmNsb3NlZCBxdW90ZXM/XCIsIFxcXHJcblx0XHR9XHRcclxuXHJcblx0XHRpZiAoKHQgIT0gbnVsbCkgJiYgKHQubGVuZ3RoID4gMCkpXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIHBhcnNlIHRoZSBsaW5lIGFzIHZhcmlhYmxlIChvciBjb21tZW50KVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhcnNlX3ZhcmlhYmxlKGwpID09IGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRbMF0gPT0gJ2RlZmluZScpIFxyXG5cdFx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5sZW5ndGggPT0gMylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuXHRcdFx0XHQvLyBHZXQgdGhlIHR5cGUsIG5hbWUgYW5kIGRlZmluaXRpb24gc3RyaW5nIG9mIGFuIGl0ZW0uXHJcblx0XHRcdFx0dmFyIGl0ZW1fdHlwZSA9IHRbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1fbmFtZSA9IG9zd2ViLnN5bnRheC5zYW5pdGl6ZSh0WzJdKTtcclxuXHRcdFx0XHR2YXIgZGVmX3N0ciA9IHRoaXMucmVhZF9kZWZpbml0aW9uKHRoaXMuX3NvdXJjZSk7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRvc3dlYi5pdGVtX3N0b3JlLm5ldyhpdGVtX3R5cGUsIGl0ZW1fbmFtZSwgZGVmX3N0cik7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJhaXNlIG9zZXhjZXB0aW9uKHUnRmFpbGVkIHRvIHBhcnNlIGRlZmluaXRpb24nLGxpbmU9bGluZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblx0XHRcdH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gR2V0IHRoZSBuZXh0IGxpbmUuXHJcblx0XHRpZiAoZ2V0X25leHQgPT0gdHJ1ZSlcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICBsID0gdGhpcy5fc291cmNlLnNoaWZ0KCk7XHJcblx0XHR9XHJcbiAgICAgICAgICAgIH1cclxuXHR9O1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBiYWNrZW5kcy5cclxuICAgICAqL1xyXG5cclxuICAgIHAuaW5pdF9jbG9jayA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBJbml0aWFsaXplcyB0aGUgY2xvY2sgYmFja2VuZC5cclxuXHR0aGlzLl9jbG9jay5pbml0aWFsaXplO1xyXG4gICAgfTtcdFxyXG5cclxuICAgIHAuaW5pdF9kaXNwbGF5ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIEluaXRpYWxpemVzIHRoZSBjYW52YXMgYmFja2VuZC5cclxuXHR0aGlzLl9jYW52YXMuaW5pdF9kaXNwbGF5KHRoaXMpO1xyXG5cclxuICAgICAgICB0aGlzLl9weXRob25fd29ya3NwYWNlWyd3aW4nXSA9IHdpbmRvdztcclxuICAgIH07XHJcblxyXG4gICAgcC5pbml0X2hlYXJ0YmVhdCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBJbml0aWFsaXplcyBoZWFydGJlYXQuXHJcblx0aWYgKCh0aGlzLmhlYXJ0YmVhdF9pbnRlcnZhbCA8PSAwKSB8fCAodGhpcy52YXJzLmZ1bGxzY3JlZW4gPT0gJ3llcycpIHx8ICh0aGlzLm91dHB1dF9jaGFubmVsID09IG51bGwpKVxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy5oZWFydGJlYXQgPSBudWxsO1xyXG5cdH1cclxuXHRlbHNlXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLmhlYXJ0YmVhdCA9IG5ldyBvc3dlYi5oZWFydGJlYXQodGhpcywgMSk7IFx0XHJcbiAgICAgICAgICAgIHRoaXMuaGVhcnRiZWF0LnN0YXJ0KCk7XHJcblx0fVxyXG4gICAgfTtcdFxyXG5cclxuICAgIHAuaW5pdF9sb2cgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICBcdC8vIE9wZW4gYSBjb25uZWN0aW9uIHRvIHRoZSBsb2cgZmlsZS5cclxuXHR0aGlzLl9sb2cub3Blbih0aGlzLmxvZ2ZpbGUpOyBcdFxyXG4gICAgfTtcclxuXHJcbiAgICBwLmluaXRfcmFuZG9tID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIEluaXRpYWxpemVzIHRoZSByYW5kb20gbnVtYmVyIGdlbmVyYXRvcnMuIEZvciBzb21lIHJlYXNvblxyXG5cdC8qIGltcG9ydCByYW5kb21cclxuXHRyYW5kb20uc2VlZCgpXHJcblx0dHJ5OlxyXG4gICAgICAgICAgICAjIERvbid0IGFzc3VtZSB0aGF0IG51bXB5IGlzIGF2YWlsYWJsZVxyXG4gICAgICAgICAgICBpbXBvcnQgbnVtcHlcclxuICAgICAgICAgICAgbnVtcHkucmFuZG9tLnNlZWQoKVxyXG4gICAgICAgICAgICBleGNlcHQ6XHJcbiAgICAgICAgICAgIHBhc3MgKi9cclxuICAgIH07XHJcblxyXG4gICAgcC5pbml0X3NvdW5kID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIEludGlhbGl6ZXMgdGhlIHNvdW5kIGJhY2tlbmQuXHJcblx0LyogZnJvbSBvcGVuZXhwIGltcG9ydCBzYW1wbGVyXHJcblx0c2FtcGxlci5pbml0X3NvdW5kKHNlbGYpICovXHJcbiAgICB9O1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVubmluZyBpdGVtLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5pdGVtX3J1bigpO1xyXG5cdFxyXG5cdC8vIFJ1bnMgdGhlIGV4cGVyaW1lbnQuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLl9zdGF0dXMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjYXNlIG9zd2ViLmNvbnN0YW50cy5TVEFUVVNfSU5JVElBTElaRTpcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN0YXR1cyB0byBmaW5hbGl6ZS5cclxuXHRcdHRoaXMuX3N0YXR1cyA9IG9zd2ViLmNvbnN0YW50cy5TVEFUVVNfRklOQUxJWkU7XHJcblxyXG5cdFx0Ly8gU2F2ZSB0aGUgZGF0ZSBhbmQgdGltZSwgYW5kIHRoZSB2ZXJzaW9uIG9mIE9wZW5TZXNhbWVcclxuXHRcdHRoaXMudmFycy5kYXRldGltZSA9IG5ldyBEYXRlKCkudG9TdHJpbmcoKTtcclxuXHRcdHRoaXMudmFycy5vcGVuc2VzYW1lX3ZlcnNpb24gID0gb3N3ZWIuVkVSU0lPTl9OVU1CRVI7IFxyXG5cdFx0dGhpcy52YXJzLm9wZW5zZXNhbWVfY29kZW5hbWUgPSBvc3dlYi5WRVJTSU9OX05BTUU7IFxyXG5cdFx0dGhpcy5ydW5uaW5nID0gdHJ1ZTtcclxuXHRcdHRoaXMuaW5pdF9yYW5kb20oKTtcclxuXHRcdHRoaXMuaW5pdF9kaXNwbGF5KCk7XHJcblx0XHR0aGlzLmluaXRfY2xvY2soKTtcclxuXHRcdHRoaXMuaW5pdF9zb3VuZCgpO1xyXG5cdFx0dGhpcy5pbml0X2xvZygpO1xyXG5cdFx0dGhpcy5weXRob25fd29ya3NwYWNlLmluaXRfZ2xvYmFscygpO1xyXG5cdFx0dGhpcy5yZXNldF9mZWVkYmFjaygpO1xyXG5cdFx0dGhpcy5pbml0X2hlYXJ0YmVhdCgpOyBcclxuXHRcclxuXHRcdC8vIEFkZCBjbG9zaW5nIG1lc3NhZ2UgdG8gZGVidWcgc3lzdGVtLlxyXG5cdFx0b3N3ZWIuZGVidWcuYWRkTWVzc2FnZSgnZXhwZXJpbWVudC5ydW4oKTogZXhwZXJpbWVudCBzdGFydGVkIGF0ICcgKyBuZXcgRGF0ZSgpLnRvVVRDU3RyaW5nKCkpOyBcclxuXHJcblx0XHRpZiAob3N3ZWIuaXRlbV9zdG9yZS5faXRlbXNbdGhpcy52YXJzLnN0YXJ0XSAhPSBudWxsKVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgIG9zd2ViLml0ZW1fc3RhY2suY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgICAgICBvc3dlYi5pdGVtX3N0b3JlLnByZXBhcmUodGhpcy52YXJzLnN0YXJ0LCB0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAvL29zd2ViLml0ZW1fc3RvcmUuZXhlY3V0ZSh0aGlzLnZhcnMuc3RhcnQsIHRoaXMpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKCdDb3VsZCBub3QgZmluZCBpdGVtICcgKyBzZWxmLnZhcnMuc3RhcnQgKyAgJyAsIHdoaWNoIGlzIHRoZSBlbnRyeSBwb2ludCBvZiB0aGUgZXhwZXJpbWVudCcpO1xyXG5cdFx0fVxyXG5cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2Ugb3N3ZWIuY29uc3RhbnRzLlNUQVRVU19GSU5BTElaRTpcclxuXHJcblx0XHQvLyBBZGQgY2xvc2luZyBtZXNzYWdlIHRvIGRlYnVnIHN5c3RlbS5cclxuICAgICAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2UoJ2V4cGVyaW1lbnQucnVuKCk6IGV4cGVyaW1lbnQgZmluaXNoZWQgYXQgJyArICBuZXcgRGF0ZSgpLnRvVVRDU3RyaW5nKCkpO1xyXG5cclxuXHRcdC8vIENvbXBsZXRlIHRoZSBydW4gcHJvY2Vzcy5cclxuXHRcdHRoaXMuZW5kKCk7XHJcblx0XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH07IFxyXG4gICAgfTtcclxuXHJcbiAgICBwLmVuZCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBEaXNhYmxlIHRoZSBydW4gdG9nZ2xlLlxyXG4gICAgICAgIHRoaXMucnVubmluZyA9IGZhbHNlO1xyXG5cdFxyXG4gICAgICAgIC8vIENsb3NlIHRoZSBsb2cgZmlsZS5cclxuICAgICAgICB0aGlzLl9sb2cuY2xvc2UoKTtcclxuXHRcdFxyXG5cdC8vIERpc2FibGUgdGhlIHByb2Nlc3NpbmcgdW5pdC5cclxuXHRvc3dlYi5ldmVudHMuX2N1cnJlbnRfaXRlbSA9IG51bGw7XHJcblx0XHJcblx0Ly8gQ2xlYXIgdGhlIGV4cHJpbWVudGFsIHN0YWdlIGFuZCBlbmFibGVkIHRoZSBtb3VzZS5cclxuXHRvc3dlYi5ydW5uZXIuX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7XHJcbiAgICAgICAgb3N3ZWIucnVubmVyLl9zdGFnZS51cGRhdGUoKTsgXHJcblx0XHRcdFxyXG5cdC8vIEZpbmFsaXplIHRoZSBwYXJlbnQgKHJ1bm5lcikuXHRcclxuICAgIFx0b3N3ZWIucnVubmVyLl9maW5hbGl6ZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBleHBlcmltZW50IGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5leHBlcmltZW50ID0gb3N3ZWIucHJvbW90ZUNsYXNzKGV4cGVyaW1lbnQsIFwiaXRlbVwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGlubGluZV9zY3JpcHQuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGlubGluZV9zY3JpcHQocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLml0ZW1fY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuXHRcclxuXHQvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG5cdHRoaXMuX3ByZXBhcmVfcnVuICA9IGZhbHNlOyAgIFxyXG4gICAgICAgIHRoaXMuX3ByZXBhcmVfdHJlZSA9IG51bGw7XHJcblx0dGhpcy5fcnVuX3RyZWUgICAgID0gbnVsbDtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhpbmxpbmVfc2NyaXB0LCBvc3dlYi5pdGVtKTtcclxuXHJcbiAgICAvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdFeGVjdXRlcyBQeXRob24gY29kZSc7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHJpdmF0ZSBtZXRob2RzIC0gY29tcGlsaW5nIHNjcmlwdC5cclxuICAgICAqL1xyXG5cclxuICAgIHAuX2NvbXBpbGUgPSBmdW5jdGlvbihwU2NyaXB0KVxyXG4gICAge1xyXG4gICAgICAgIGlmIChwU2NyaXB0ICE9ICcnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGxvY2F0aW9ucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgcGFyc2VGbiAgID0gZmlsYmVydF9sb29zZS5wYXJzZV9kYW1taXQ7XHJcbiAgICAgICAgICAgIHZhciByYW5nZXMgICAgPSBmYWxzZTtcclxuICAgICAgICBcdFx0XHJcbiAgICAgICAgICAgIHRyeSBcclxuXHQgICAge1xyXG4gICAgICAgIFx0dmFyIGNvZGUgID0gcFNjcmlwdDtcclxuICAgICAgICAgXHR2YXIgYXN0ICAgPSBwYXJzZUZuKGNvZGUsIHsgbG9jYXRpb25zOiBsb2NhdGlvbnMsIHJhbmdlczogcmFuZ2VzIH0pO1xyXG4gICAgICAgIFxyXG5cdCAgICAgICBcdHJldHVybiBhc3Q7XHJcbiAgICBcdCAgICB9XHJcbiAgICAgICBcdCAgICBjYXRjaCAoZSkgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICBcdGNvbnNvbGUubG9nKCdlcnJvcicpO1xyXG4gICAgICAgIFx0Y29uc29sZS5sb2coZS50b1N0cmluZygpKTtcclxuICAgIFx0ICAgXHRcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblx0fVxyXG5cdGVsc2VcclxuXHR7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cdCAgIFx0XHJcbiAgICB9O1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gYnVpbGRpbmcgaXRlbS4gICAgICAgICBcclxuICAgICAqL1xyXG5cdFx0XHJcbiAgICBwLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFJlc2V0cyBhbGwgaXRlbSB2YXJpYWJsZXMgdG8gdGhlaXIgZGVmYXVsdCB2YWx1ZS5cclxuXHR0aGlzLl92YXJfaW5mbyAgICAgPSBudWxsO1xyXG5cdHRoaXMudmFycy5fcHJlcGFyZSA9ICcnO1xyXG5cdHRoaXMudmFycy5fcnVuICAgICA9ICcnO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmZyb21fc3RyaW5nID0gZnVuY3Rpb24ocFN0cmluZylcclxuICAgIHtcclxuICAgIFx0Ly8gUGFyc2VzIGEgZGVmaW5pdGlvbiBzdHJpbmcuXHJcblx0dGhpcy5yZXNldCgpO1xyXG5cdFx0XHJcblx0Ly8gU3BsaXQgdGhlIHN0cmluZyBpbnRvIGFuIGFycmF5IG9mIGxpbmVzLiAgXHJcblx0aWYgKHBTdHJpbmcgIT0gbnVsbClcclxuXHR7XHJcbiAgICAgICAgICAgIHZhciByZWFkX3J1bl9saW5lcyAgICAgPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIHJlYWRfcHJlcGFyZV9saW5lcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgbGluZXMgPSBwU3RyaW5nLnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuXHRcdHZhciB0b2tlbnMgPSBvc3dlYi5zeW50YXguc3BsaXQobGluZXNbaV0pO1xyXG5cdFx0XHRcclxuXHRcdGlmICgodG9rZW5zICE9IG51bGwpICYmICh0b2tlbnMubGVuZ3RoID4gMCkpXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbnNbMF0pXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG5cdFx0XHRjYXNlICdzZXQnOiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2VfdmFyaWFibGUobGluZXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cdFx0XHRjYXNlICdfX2VuZF9fJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRfcnVuX2xpbmVzICAgICA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZF9wcmVwYXJlX2xpbmVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuXHRcdFx0YnJlYWs7XHRcclxuXHRcdFx0Y2FzZSAnX19fcHJlcGFyZV9fJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRfcHJlcGFyZV9saW5lcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuXHRcdFx0YnJlYWs7XHJcblx0XHRcdGNhc2UgJ19fX3J1bl9fJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRfcnVuX2xpbmVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG5cdFx0XHRicmVhaztcclxuXHRcdFx0ZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFkX3J1bl9saW5lcyA9PSB0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG5cdFx0XHRcdHRoaXMudmFycy5fcnVuID0gdGhpcy52YXJzLl9ydW4gKyBsaW5lc1tpXSArICdcXG4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVhZF9wcmVwYXJlX2xpbmVzID09IHRydWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcdHRoaXMudmFycy5fcHJlcGFyZSA9IHRoaXMudmFycy5fcHJlcGFyZSArIGxpbmVzW2ldICsgJ1xcbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSBcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVhZF9ydW5fbGluZXMgPT0gdHJ1ZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcblx0XHRcdHRoaXMudmFycy5fcnVuID0gdGhpcy52YXJzLl9ydW4gKyBsaW5lc1tpXSArICdcXG4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZWFkX3ByZXBhcmVfbGluZXMgPT0gdHJ1ZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcblx0XHRcdHRoaXMudmFycy5fcHJlcGFyZSA9IHRoaXMudmFycy5fcHJlcGFyZSArIGxpbmVzW2ldICsgJ1xcbic7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcdH0gXHJcbiAgICAgICAgICAgIH1cclxuXHR9XHJcbiAgICB9O1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVubmluZyBpdGVtLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5wcmVwYXJlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIENvbXBpbGUgdGhlIHNjcmlwdCBjb2RlIHRvIGFzdCB0cmVlcy5cclxuICAgICAgICB0aGlzLl9wcmVwYXJlX3RyZWUgPSBvc3dlYi5wYXJzZXIuX3ByZXBhcmUodGhpcy52YXJzLl9wcmVwYXJlKTtcclxuICAgICAgICB0aGlzLl9ydW5fdHJlZSAgICAgPSBvc3dlYi5wYXJzZXIuX3ByZXBhcmUodGhpcy52YXJzLl9ydW4pO1xyXG5cdFxyXG4gICAgICAgIC8vIEV4ZWN1dGUgdGhlIHJ1biBjb2RlLlxyXG4gXHRpZiAodGhpcy5fcHJlcGFyZV90cmVlICE9IG51bGwpXHJcbiAgICBcdHtcclxuICAgICAgICAgICAgLy8gU2V0IHRoZSBjdXJyZW50IGl0ZW0uXHJcbiAgICAgICAgICAgIG9zd2ViLmV2ZW50cy5fY3VycmVudF9pdGVtID0gdGhpcztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgcHJlcGFyZSBydW4gdG9nZ2xlLlxyXG4gICAgICAgICAgICB0aGlzLl9wcmVwYXJlX3J1biA9IHRydWU7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTdGFydCB0aGUgcGFyc2VyXHJcbiAgICAgICAgICAgIG9zd2ViLnBhcnNlci5fcnVuKHRoaXMsIHRoaXMuX3ByZXBhcmVfdHJlZSk7ICAgIFx0XHRcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbV9wcmVwYXJlKCk7XHJcbiAgICAgICAgfSAgICBcclxuICAgIH07XHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICBcdC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuaXRlbV9ydW4oKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBSZWNvcmQgdGhlIG9uc2V0IG9mIHRoZSBjdXJyZW50IGl0ZW0uXHJcblx0dGhpcy5zZXRfaXRlbV9vbnNldCgpOyBcclxuXHJcbiAgICAgICAgLy8gRXhlY3V0ZSB0aGUgcnVuIGNvZGUuXHJcbiBcdGlmICh0aGlzLl9ydW5fdHJlZSAhPSBudWxsKVxyXG4gICAgXHR7XHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgcHJlcGFyZSBydW4gdG9nZ2xlLlxyXG4gICAgICAgICAgICB0aGlzLl9wcmVwYXJlX3J1biA9IGZhbHNlO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHBhcnNlclxyXG4gICAgICAgICAgICBvc3dlYi5wYXJzZXIuX3J1bih0aGlzLCB0aGlzLl9ydW5fdHJlZSk7ICAgIFx0XHRcclxuICAgIFx0fVxyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBwYXJzZXIgaXMgcmVhZHkuIFxyXG4gICAgICAgIGlmIChvc3dlYi5wYXJzZXIuX3N0YXR1cyA9PSAxKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgY3VycmVudCBhY3RpdmUgbm9kZS5cclxuICAgICAgICAgICAgb3N3ZWIucGFyc2VyLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHsgICAgXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9wcmVwYXJlX3J1biA9PT0gdHJ1ZSkgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vIEluaGVyaXRlZCBwcmVwYXJlLlx0XHJcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW1fcHJlcGFyZSgpO1xyXG4gICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHsgXHJcbiAgICAgICAgICAgICAgICAvLyBJbmhlcml0ZWQuICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuaXRlbV9jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSAgICBcclxuICAgIH07IFxyXG5cdFxyXG4gICAgcC5jb21wbGV0ZV9zY3JpcHQgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gQWRkZWQgZm9yIHZpZGVvIHNjcmlwdCBmdW5jdGlvbmFsaXJ5LlxyXG4gICAgICAgIHRoaXMuY29tcGxldGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgU2VxdWVuY2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmlubGluZV9zY3JpcHQgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoaW5saW5lX3NjcmlwdCwgXCJpdGVtXCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3Mga2V5Ym9hcmRfcmVzcG9uc2UuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGtleWJvYXJkX3Jlc3BvbnNlKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMuZ2VuZXJpY19yZXNwb25zZV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG5cclxuICAgICAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgcHJvcGVydGllcy4gXHJcblx0dGhpcy5fZmx1c2ggICAgPSAneWVzJztcclxuXHR0aGlzLl9rZXlib2FyZCA9IG5ldyBvc3dlYi5rZXlib2FyZCh0aGlzLmV4cGVyaW1lbnQpOyBcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhrZXlib2FyZF9yZXNwb25zZSwgb3N3ZWIuZ2VuZXJpY19yZXNwb25zZSk7XHJcblxyXG4gICAgICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdDb2xsZWN0cyBrZXlib2FyZCByZXNwb25zZXMnO1xyXG5cdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBidWlsZCBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucmVzZXQgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gUmVzZXRzIGFsbCBpdGVtIHZhcmlhYmxlcyB0byB0aGVpciBkZWZhdWx0IHZhbHVlLlxyXG5cdHRoaXMuYXV0b19yZXNwb25zZSAgICAgICAgICA9ICdzcGFjZSc7XHJcblx0dGhpcy5wcm9jZXNzX2ZlZWRiYWNrICAgICAgID0gdHJ1ZTsgXHJcblx0dGhpcy52YXJzLmFsbG93ZWRfcmVzcG9uc2VzID0gbnVsbDtcclxuXHR0aGlzLnZhcnMuY29ycmVjdF9yZXNwb25zZSAgPSBudWxsO1xyXG5cdHRoaXMudmFycy5kdXJhdGlvbiAgICAgICAgICA9ICdrZXlwcmVzcyc7XHJcblx0dGhpcy52YXJzLmZsdXNoICAgICAgICAgICAgID0gJ3llcyc7XHJcblx0dGhpcy52YXJzLnRpbWVvdXQgICAgICAgICAgID0gJ2luZmluaXRlJztcclxuICAgIH07XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW4gY3ljbGUuXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnByZXBhcmUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHRcclxuXHQvLyBTZXQgdGhlIGludGVybmFsIGZsdXNoIHByb3BlcnR5LlxyXG5cdHRoaXMuX2ZsdXNoID0gKHRoaXMudmFycy5mbHVzaCkgPyB0aGlzLnZhcnMuZmx1c2ggOiAneWVzJztcclxuXHJcbiAgICBcdC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuZ2VuZXJpY19yZXNwb25zZV9wcmVwYXJlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAucnVuID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuZ2VuZXJpY19yZXNwb25zZV9ydW4oKTtcclxuXHJcbiAgICAgICAgLy8gUmVjb3JkIHRoZSBvbnNldCBvZiB0aGUgY3VycmVudCBpdGVtLlxyXG5cdHRoaXMuc2V0X2l0ZW1fb25zZXQoKTsgXHJcblx0XHJcblx0Ly8gRmx1c2ggcmVzcG9uc2VzLCB0byBtYWtlIHN1cmUgdGhhdCBlYXJsaWVyIHJlc3BvbnNlcyBhcmUgbm90IGNhcnJpZWQgb3Zlci5cclxuICAgICAgICBpZiAodGhpcy5fZmx1c2ggPT0gJ3llcycpXHJcblx0e1x0XHJcbiAgICAgICAgICAgIHRoaXMuX2tleWJvYXJkLmZsdXNoKCk7XHJcblx0fVx0XHRcclxuXHRcclxuICAgICAgICB0aGlzLnNldF9zcmkoKTtcclxuXHR0aGlzLnByb2Nlc3NfcmVzcG9uc2UoKTtcclxuICAgIH07XHJcblx0XHJcbiAgICAvLyBCaW5kIHRoZSBrZXlib2FyZF9yZXNwb25zZSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIua2V5Ym9hcmRfcmVzcG9uc2UgPSBvc3dlYi5wcm9tb3RlQ2xhc3Moa2V5Ym9hcmRfcmVzcG9uc2UsIFwiZ2VuZXJpY19yZXNwb25zZVwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGxvZ2dlci5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gbG9nZ2VyKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMuaXRlbV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG5cdFxyXG4gICAgICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBwcm9wZXJ0aWVzLiBcclxuXHR0aGlzLl9sb2d2YXJzID0gbnVsbDtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhsb2dnZXIsIG9zd2ViLml0ZW0pO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdMb2dzIGV4cGVyaW1lbnRhbCBkYXRhJztcclxuICAgIHAubG9ndmFyc1x0ICA9IFtdO1xyXG5cdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMgLSBidWlsZCBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucmVzZXQgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gUmVzZXRzIGFsbCBpdGVtIHZhcmlhYmxlcyB0byB0aGVpciBkZWZhdWx0IHZhbHVlLlxyXG5cdHRoaXMuX2xvZ3ZhcnMgICAgICA9IG51bGw7XHJcblx0dGhpcy5sb2d2YXJzICAgICAgID0gW107XHJcblx0dGhpcy52YXJzLmF1dG9fbG9nID0gJ3llcyc7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZnJvbV9zdHJpbmcgPSBmdW5jdGlvbihwU3RyaW5nKVxyXG4gICAge1xyXG5cdC8vIFBhcnNlcyBhIGRlZmluaXRpb24gc3RyaW5nLlxyXG5cdHRoaXMudmFyaWFibGVzID0ge307XHJcblx0dGhpcy5jb21tZW50cyAgPSBbXTtcclxuXHR0aGlzLnJlc2V0KCk7XHJcblxyXG5cdC8vIFNwbGl0IHRoZSBzdHJpbmcgaW50byBhbiBhcnJheSBvZiBsaW5lcy4gIFxyXG5cdGlmIChwU3RyaW5nICE9IG51bGwpXHJcblx0e1xyXG4gICAgICAgICAgICB2YXIgbGluZXMgPSBwU3RyaW5nLnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuXHRcdGlmICgobGluZXNbaV0gIT0gJycpICYmICh0aGlzLnBhcnNlX3ZhcmlhYmxlKGxpbmVzW2ldKSA9PSBmYWxzZSkpXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VucyA9IG9zd2ViLnN5bnRheC5zcGxpdChsaW5lc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCh0b2tlbnNbMF0gPT0gJ2xvZycpICYmICh0b2tlbnMubGVuZ3RoID4gMCkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG5cdFx0XHR0aGlzLmxvZ3ZhcnMucHVzaCh0b2tlbnNbMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cdFxyXG5cdFx0fVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcdFxyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBjbGFzcyBtZXRob2RzIC0gcnVuIGN5Y2xlLlxyXG4gICAgICovXHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5pdGVtX3J1bigpO1xyXG5cdFx0XHJcblx0Ly8gUnVuIGl0ZW0gb25seSBvbmUgdGltZS4gICBcclxuXHRpZiAodGhpcy5fc3RhdHVzICE9IG9zd2ViLmNvbnN0YW50cy5TVEFUVVNfRklOQUxJWkUpXHJcblx0e1xyXG4gICAgICAgICAgICAvLyBpdGVtIGlzIGZpbmFsaXplZC5cclxuICAgICAgICAgICAgdGhpcy5fc3RhdHVzID0gb3N3ZWIuY29uc3RhbnRzLlNUQVRVU19GSU5BTElaRTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2V0X2l0ZW1fb25zZXQoKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2xvZ3ZhcnMgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG5cdFx0aWYgKHRoaXMudmFycy5hdXRvX2xvZyA9PSAneWVzJylcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9sb2d2YXJzID0gdGhpcy5leHBlcmltZW50Ll9sb2cuYWxsX3ZhcnMoKTtcclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9sb2d2YXJzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXJpYWJsZSBpbiB0aGlzLmxvZ3ZhcnMpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gXHRcdFx0aWYgKCh2YXJpYWJsZSBpbiB0aGlzLl9sb2d2YXJzKSA9PSBmYWxzZSlcclxuIFx0XHRcdHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xvZ3ZhcnMucHVzaCh2YXJpYWJsZSk7XHJcblx0XHRcdH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbG9ndmFycy5zb3J0KCk7XHRcdFxyXG5cdFx0fVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZXhwZXJpbWVudC5fbG9nLndyaXRlX3ZhcnModGhpcy5fbG9ndmFycyk7IFxyXG5cclxuICAgICAgICAgICAgLy8gQ29tcGxldGUgdGhlIGN5Y2xlLlxyXG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgcC5jb21wbGV0ZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgICAgICB0aGlzLml0ZW1fY29tcGxldGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgbG9nZ2VyIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5sb2dnZXIgPSBvc3dlYi5wcm9tb3RlQ2xhc3MobG9nZ2VyLCBcIml0ZW1cIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBsb29wLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBsb29wKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMuaXRlbV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG5cclxuICAgICAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgcHJvcGVydGllcy4gXHJcbiAgICAgICAgdGhpcy5fYnJlYWtfaWYgPSAnJztcclxuICAgICAgICB0aGlzLl9jeWNsZXMgICA9IFtdO1xyXG4gICAgICAgIHRoaXMuX2luZGV4ICAgID0gLTE7XHJcbiAgICAgICAgdGhpcy5fa2V5Ym9hcmQgPSBudWxsO1xyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGxvb3AsIG9zd2ViLml0ZW0pO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdSZXBlYXRlZGx5IHJ1bnMgYW5vdGhlciBpdGVtJztcclxuICAgIHAubWF0cml4ICAgICAgPSBudWxsO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gYnVpbGRpbmcgY3ljbGUuICAgICAgICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFJlc2V0cyBhbGwgaXRlbSB2YXJpYWJsZXMgdG8gdGhlaXIgZGVmYXVsdCB2YWx1ZS5cclxuXHR0aGlzLm1hdHJpeCAgICAgICAgPSB7fTtcclxuXHR0aGlzLnZhcnMuY3ljbGVzICAgPSAxO1xyXG5cdHRoaXMudmFycy5yZXBlYXQgICA9IDE7XHJcblx0dGhpcy52YXJzLnNraXAgICAgID0gMDtcclxuXHR0aGlzLnZhcnMub2Zmc2V0ICAgPSAnbm8nO1xyXG5cdHRoaXMudmFycy5vcmRlciAgICA9ICdyYW5kb20nO1xyXG5cdHRoaXMudmFycy5pdGVtICAgICA9ICcnO1xyXG5cdHRoaXMudmFycy5icmVha19pZiA9ICduZXZlcic7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZnJvbV9zdHJpbmcgPSBmdW5jdGlvbihwU3RyaW5nKVxyXG4gICAge1xyXG4gICAgXHQvLyBDcmVhdGVzIGEgbG9vcCBmcm9tIGEgZGVmaW5pdGlvbiBpbiBhIHN0cmluZy5cclxuICAgIFx0dGhpcy5jb21tZW50cyAgPSBbXTtcclxuXHR0aGlzLnZhcmlhYmxlcyA9IHt9O1xyXG5cdHRoaXMucmVzZXQoKTtcclxuXHRcdFxyXG5cdC8vIFNwbGl0IHRoZSBzdHJpbmcgaW50byBhbiBhcnJheSBvZiBsaW5lcy4gIFxyXG5cdGlmIChwU3RyaW5nICE9IG51bGwpXHJcblx0e1xyXG4gICAgICAgICAgICB2YXIgbGluZXMgPSBwU3RyaW5nLnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuXHRcdGlmICgobGluZXNbaV0gIT0gJycpICYmICh0aGlzLnBhcnNlX3ZhcmlhYmxlKGxpbmVzW2ldKSA9PSBmYWxzZSkpXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VucyA9IG9zd2ViLnN5bnRheC5zcGxpdChsaW5lc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCh0b2tlbnNbMF0gPT0gJ3J1bicpICYmICh0b2tlbnMubGVuZ3RoID4gMSkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0dGhpcy52YXJzLml0ZW0gPSB0b2tlbnNbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVx0XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHRva2Vuc1swXSA9PSAnc2V0Y3ljbGUnKSAmJiAodG9rZW5zLmxlbmd0aCA+IDMpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuXHRcdFx0dmFyIGN5Y2xlID0gdG9rZW5zWzFdO1xyXG5cdFx0XHR2YXIgbmFtZSAgPSB0b2tlbnNbMl07XHJcblx0XHRcdHZhciB2YWx1ZSA9IG9zd2ViLnN5bnRheC5yZW1vdmVfcXVvdGVzKHRva2Vuc1szXSk7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0Ly8gQ2hlY2sgaWYgdGhlIHZhbHVlIGlzIG51bWVyaWNcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvc3dlYi5zeW50YXguaXNOdW1iZXIodmFsdWUpID8gTnVtYmVyKHZhbHVlKSA6IHZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVydCB0aGUgcHl0aG9uIGV4cHJlc3Npb24gdG8gamF2YXNjcmlwdC5cclxuXHRcdFx0aWYgKHZhbHVlWzBdID09ICc9JylcclxuXHRcdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUGFyc2UgdGhlIHB5dGhvbiBzdGF0ZW1lbnQuIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvc3dlYi5wYXJzZXIuX3ByZXBhcmUodmFsdWUuc2xpY2UoMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09IG51bGwpICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmJvZHlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ICAgIFxyXG5cdFx0XHR9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXRyaXhbY3ljbGVdID09IHVuZGVmaW5lZClcclxuXHRcdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXRyaXhbY3ljbGVdID0ge307XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWF0cml4W2N5Y2xlXVtuYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cdFxyXG5cdFx0fVxyXG4gICAgICAgICAgICB9XHRcclxuXHR9XHJcbiAgICB9O1xyXG4gIFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW5uIGN5Y2xlLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5zaHVmZmxlID0gZnVuY3Rpb24obGlzdClcclxuICAgIHtcclxuICAgICAgICB2YXIgaSwgaiwgdDtcclxuXHRmb3IgKGkgPSAxOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykgXHJcblx0e1xyXG5cdCAgICBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEgKyBpKSk7ICBcclxuXHQgICAgaWYgKGogIT0gaSkgXHJcblx0ICAgIHtcclxuXHQgICAgICAgIHQgICAgICAgPSBsaXN0W2ldOyAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgbGlzdFtpXSA9IGxpc3Rbal07XHJcblx0ICAgICAgICBsaXN0W2pdID0gdDtcclxuICAgICAgICAgICAgfVxyXG5cdH1cdFx0XHRcclxuICAgIH07XHJcblxyXG4gICAgcC5hcHBseV9jeWNsZSA9IGZ1bmN0aW9uKGN5Y2xlKVxyXG4gICAge1xyXG5cdC8vIFNldHMgYWxsIHRoZSBsb29wIHZhcmlhYmxlcyBhY2NvcmRpbmcgdG8gdGhlIGN5Y2xlLlxyXG5cdGlmIChjeWNsZSBpbiB0aGlzLm1hdHJpeClcclxuXHR7XHJcbiAgICAgICAgICAgIGZvciAodmFyIHZhcmlhYmxlIGluIHRoaXMubWF0cml4W2N5Y2xlXSlcclxuICAgICAgICAgICAge1xyXG5cdFx0Ly8gR2V0IHRoZSB2YWx1ZSBvZiB0aGUgdmFyaWFibGUuXHJcblx0XHR2YXIgdmFsdWUgPSB0aGlzLm1hdHJpeFtjeWNsZV1bdmFyaWFibGVdO1xyXG5cclxuXHRcdC8vIENoZWNrIGZvciBweXRob24gZXhwcmVzc2lvbi5cclxuXHRcdGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlIGNvbnRhaW5zIGFzdCB0cmVlLCBydW4gdGhlIHBhcnNlci5cclxuICAgICAgICAgICAgICAgICAgICB0cnlcclxuICAgICAgICAgICAgICAgICAgICB7XHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXZhbHVhdGUgdGhlIGV4cHJlc3Npb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvc3dlYi5wYXJzZXIuX3J1bnN0YXRlbWVudCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXJyb3IgZHVyaW5nIGV2YWx1YXRpb24uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKCdGYWlsZWQgdG8gZXZhbHVhdGUgJyArIHZhbHVlICsgJyBpbiBsb29wIGl0ZW0gJyArIHRoaXMubmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVx0XHRcdFx0XHRcdFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cdFx0XHRcdFxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSB2YXJpYWJsZS5cclxuICAgICAgICAgICAgICAgIHRoaXMuZXhwZXJpbWVudC52YXJzLnNldCh2YXJpYWJsZSwgdmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcblx0fVxyXG4gICAgfTtcclxuXHRcclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBQcmVwYXJlIHRoZSBicmVhayBpZiBjb25kaXRpb24uXHJcblx0aWYgKCh0aGlzLnZhcnMuYnJlYWtfaWYgIT0gJycpICYmICh0aGlzLnZhcnMuYnJlYWtfaWYgIT0gJ25ldmVyJykpXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLl9icmVha19pZiA9IHRoaXMuc3ludGF4LmNvbXBpbGVfY29uZCh0aGlzLnZhcnMuYnJlYWtfaWYpO1xyXG4gICAgICAgIH1cclxuXHRlbHNlXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLl9icmVha19pZiA9IG51bGw7XHJcblx0fVxyXG5cclxuXHQvLyAgRmlyc3QgZ2VuZXJhdGUgYSBsaXN0IG9mIGN5Y2xlIG51bWJlcnNcclxuXHR0aGlzLl9jeWNsZXMgPSBbXTtcclxuXHR0aGlzLl9pbmRleCAgPSAwO1xyXG5cdFx0XHJcblx0Ly8gV2FsayB0aHJvdWdoIGFsbCBjb21wbGV0ZSByZXBlYXRzXHJcblx0dmFyIHdob2xlX3JlcGVhdHMgPSBNYXRoLmZsb29yKHRoaXMudmFycy5yZXBlYXQpO1xyXG5cdGZvciAodmFyIGogPSAwOyBqIDwgd2hvbGVfcmVwZWF0czsgaisrKVxyXG5cdHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnZhcnMuY3ljbGVzOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuXHRcdHRoaXMuX2N5Y2xlcy5wdXNoKGkpO1xyXG4gICAgICAgICAgICB9XHJcblx0fVxyXG5cdFx0XHRcdFxyXG5cdC8vIEFkZCB0aGUgbGVmdG92ZXIgcmVwZWF0cy5cclxuXHR2YXIgcGFydGlhbF9yZXBlYXRzID0gdGhpcy52YXJzLnJlcGVhdCAtIHdob2xlX3JlcGVhdHM7XHJcblx0aWYgKHBhcnRpYWxfcmVwZWF0cyA+IDApXHJcblx0e1xyXG4gICAgICAgICAgICB2YXIgYWxsX2N5Y2xlcyA9IEFycmF5LmFwcGx5KG51bGwsIHtsZW5ndGg6IHRoaXMudmFycy5jeWNsZXN9KS5tYXAoTnVtYmVyLmNhbGwsIE51bWJlcik7ICAgIFxyXG4gICAgICAgICAgICB2YXIgcmVtYWluZGVyICA9IE1hdGguZmxvb3IodGhpcy52YXJzLmN5Y2xlcyAqIHBhcnRpYWxfcmVwZWF0cyk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVtYWluZGVyOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSByYW5kb20gcG9zaXRpb24uXHJcbiAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhbGxfY3ljbGVzLmxlbmd0aCk7ICAgICBcclxuICAgICAgICAgICAgICAgIC8vIEFkZCBwb3NpdGlvbiB0byBjeWNsZXMuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jeWNsZXMucHVzaChwb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgcG9zaXRpb24gZnJvbSBhcnJheS5cclxuICAgICAgICAgICAgICAgIGFsbF9jeWNsZXMuc3BsaWNlKHBvc2l0aW9uLDEpO1xyXG4gICAgICAgICAgICB9XHJcblx0fVx0XHRcclxuXHJcblx0Ly8gUmFuZG9taXplIHRoZSBsaXN0IGlmIG5lY2Vzc2FyeS5cclxuXHRpZiAodGhpcy52YXJzLm9yZGVyID09ICdyYW5kb20nKVxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy5zaHVmZmxlKHRoaXMuX2N5Y2xlcyk7XHJcblx0fVx0XHJcblx0ZWxzZVxyXG5cdHtcclxuICAgICAgICAgICAgLy8gSW4gc2VxdWVudGlhbCBvcmRlciwgdGhlIG9mZnNldCBhbmQgdGhlIHNraXAgYXJlIHJlbGV2YW50LlxyXG4gICAgICAgICAgICBpZiAodGhpcy5fY3ljbGVzLmxlbmd0aCA8IHRoaXMudmFycy5za2lwKSAgXHJcbiAgICAgICAgICAgIHtcclxuXHRcdG9zd2ViLmRlYnVnLmFkZEVycm9yKCdUaGUgdmFsdWUgb2Ygc2tpcCBpcyB0b28gaGlnaCBpbiBsb29wIGl0ZW0gJyArIHRoaXMubmFtZSArICcuIFlvdSBjYW5ub3Qgc2tpcCBtb3JlIGN5Y2xlcyB0aGFuIHRoZXJlIGFyZS4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuXHRcdGlmICh0aGlzLnZhcnMub2Zmc2V0ID09ICd5ZXMnKVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgc2tpcCBlbGVtZW50cy5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2tpcCA9IHRoaXMuX2N5Y2xlcy5zbGljZSgwLCB0aGlzLnZhcnMuc2tpcCk7XHJcblx0XHRcdFx0XHRcclxuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHNraXAgZWxlbWVudHMgZnJvbSB0aGUgb3JpZ2luYWwgbG9jYXRpb24uXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3ljbGVzID0gdGhpcy5fY3ljbGVzLnNsaWNlKHRoaXMudmFycy5za2lwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBza2lwIGVsZW1lbnQgdG8gdGhlIGVuZC5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jeWNsZXMgPSB0aGlzLl9jeWNsZXMuY29uY2F0KHNraXApO1x0XHRcdFx0XHRcdFx0XHRcdFx0XHJcblx0XHR9XHJcblx0XHRlbHNlXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3ljbGVzID0gdGhpcy5fY3ljbGVzLnNsaWNlKHRoaXMudmFycy5za2lwKTtcclxuXHRcdH1cclxuICAgICAgICAgICAgfVxyXG5cdH1cclxuXHRcdFxyXG5cdC8vIENyZWF0ZSBhIGtleWJvYXJkIHRvIGZsdXNoIHJlc3BvbnNlcyBiZXR3ZWVuIGN5Y2xlcy5cclxuXHR0aGlzLl9rZXlib2FyZCA9IG5ldyBvc3dlYi5rZXlib2FyZCh0aGlzLmV4cGVyaW1lbnQpO1xyXG5cdFxyXG4gICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgaXRlbSB0byBydW4gZXhpc3RzLlxyXG5cdGlmICh0aGlzLmV4cGVyaW1lbnQuaXRlbXMuX2l0ZW1zW3RoaXMudmFycy5pdGVtXSA9PT0gJ3VuZGVmaW5lZCcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRFcnJvcignQ291bGQgbm90IGZpbmQgaXRlbSAnICsgdGhpcy52YXJzLml0ZW0gKyAnLCB3aGljaCBpcyBjYWxsZWQgYnkgbG9vcCBpdGVtICcgKyB0aGlzLm5hbWUpO1xyXG4gICAgICAgIH0gICAgXHJcblxyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuaXRlbV9wcmVwYXJlKCk7XHJcblx0XHJcblx0Ly8gU2V0IHRoZSBvbnNldCB0aW1lLlxyXG5cdHRoaXMuc2V0X2l0ZW1fb25zZXQoKTtcclxuICAgIH07XHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICAgICAgdGhpcy5pdGVtX3J1bigpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fY3ljbGVzLmxlbmd0aCA+IDApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgZXhpdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLl9pbmRleCA9IHRoaXMuX2N5Y2xlcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICB0aGlzLmFwcGx5X2N5Y2xlKHRoaXMuX2luZGV4KTtcclxuXHRcdFxyXG4gICAgICAgICAgICBpZiAodGhpcy5fYnJlYWtfaWYgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5weXRob25fd29ya3NwYWNlWyd0aGlzJ10gPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgYnJlYWtfaWYgPSBvc3dlYi5zeW50YXguZXZhbF90ZXh0KHRoaXMuX2JyZWFrX2lmKTsgXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnB5dGhvbl93b3Jrc3BhY2UuX2V2YWwoYnJlYWtfaWYpID09IHRydWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXhpdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHRcclxuICAgICAgICAgICAgfVxyXG5cdFx0XHRcclxuICAgICAgICAgICAgaWYgKGV4aXQgPT0gZmFsc2UpXHJcbiAgICAgICAgICAgIHtcclxuXHRcdHRoaXMuZXhwZXJpbWVudC52YXJzLnJlcGVhdF9jeWNsZSA9IDA7XHJcblx0XHRcclxuICAgICAgICAgICAgICAgIG9zd2ViLml0ZW1fc3RvcmUucHJlcGFyZSh0aGlzLnZhcnMuaXRlbSwgdGhpcyk7XHJcbiAgICAgICAgICAgICAgICAvL29zd2ViLml0ZW1fc3RvcmUuZXhlY3V0ZSh0aGlzLnZhcnMuaXRlbSwgdGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvLyBCcmVhayB0aGUgbG9vcC5cclxuICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvLyBCcmVhayB0aGUgbG9vcC5cclxuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHRcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIGlmIHRoZSBjeWNsZSBtdXN0IGJlIHJlcGVhdGVkLlxyXG5cdGlmICh0aGlzLmV4cGVyaW1lbnQudmFycy5yZXBlYXRfY3ljbGUgPT0gMSlcclxuXHR7XHJcbiAgICAgICAgICAgIG9zd2ViLmRlYnVnLm1zZygncmVwZWF0aW5nIGN5Y2xlICcgKyB0aGlzLl9pbmRleCk7XHJcblx0XHRcdFxyXG4gICAgICAgICAgICB0aGlzLl9jeWNsZXMucHVzaCh0aGlzLl9pbmRleCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAodGhpcy52YXJzLm9yZGVyID09ICdyYW5kb20nKVxyXG4gICAgICAgICAgICB7XHJcblx0XHR0aGlzLnNodWZmbGUodGhpcy5fY3ljbGVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHR9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gQWxsIGl0ZW1zIGFyZSBwcm9jZXNzZWQsIHNldCB0aGUgc3RhdHVzIHRvIGZpbmFsaXplZC5cclxuICAgICAgICAgICAgdGhpcy5fc3RhdHVzID0gb3N3ZWIuY29uc3RhbnRzLlNUQVRVU19GSU5BTElaRTtcclxuXHJcbiAgICAgICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG4gICAgICAgICAgICB0aGlzLml0ZW1fY29tcGxldGUoKTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBsb29wIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5sb29wID0gb3N3ZWIucHJvbW90ZUNsYXNzKGxvb3AsIFwiaXRlbVwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIG1vdXNlX3Jlc3BvbnNlLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBtb3VzZV9yZXNwb25zZShwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkIGNyZWF0ZS5cclxuXHR0aGlzLmdlbmVyaWNfcmVzcG9uc2VfY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuXHJcbiAgICAgICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIHByb3BlcnRpZXMuIFxyXG5cdHRoaXMuX2ZsdXNoID0gJ3llcyc7XHJcblx0dGhpcy5fbW91c2UgPSBuZXcgb3N3ZWIubW91c2UodGhpcy5leHBlcmltZW50KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhtb3VzZV9yZXNwb25zZSwgb3N3ZWIuZ2VuZXJpY19yZXNwb25zZSk7XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ0NvbGxlY3RzIG1vdXNlIHJlc3BvbnNlcyc7XHJcbiAgICBwLnJlc3BfY29kZXMgID0ge307XHJcblx0XHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLlxyXG4gICAgICovXHJcblx0XHJcbiAgICBwLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFJlc2V0cyBhbGwgaXRlbSB2YXJpYWJsZXMgdG8gdGhlaXIgZGVmYXVsdCB2YWx1ZS5cclxuXHR0aGlzLmF1dG9fcmVzcG9uc2UgICAgICAgICAgPSAxO1xyXG5cdHRoaXMucHJvY2Vzc19mZWVkYmFjayAgICAgICA9IHRydWU7XHJcblx0dGhpcy5yZXNwX2NvZGVzICAgICAgICAgICAgID0ge307XHJcblx0dGhpcy5yZXNwX2NvZGVzWycwJ10gICAgICAgID0gJ3RpbWVvdXQnO1xyXG5cdHRoaXMucmVzcF9jb2Rlc1snMSddICAgICAgICA9ICdsZWZ0X2J1dHRvbic7XHJcblx0dGhpcy5yZXNwX2NvZGVzWycyJ10gICAgICAgID0gJ21pZGRsZV9idXR0b24nO1xyXG5cdHRoaXMucmVzcF9jb2Rlc1snMyddICAgICAgICA9ICdyaWdodF9idXR0b24nO1xyXG5cdHRoaXMucmVzcF9jb2Rlc1snNCddICAgICAgICA9ICdzY3JvbGxfdXAnO1xyXG5cdHRoaXMucmVzcF9jb2Rlc1snNSddICAgICAgICA9ICdzY3JvbGxfZG93bic7XHJcblx0dGhpcy52YXJzLmFsbG93ZWRfcmVzcG9uc2VzID0gbnVsbDtcclxuXHR0aGlzLnZhcnMuY29ycmVjdF9yZXNwb25zZSAgPSBudWxsO1xyXG5cdHRoaXMudmFycy5kdXJhdGlvbiAgICAgICAgICA9ICdtb3VzZWNsaWNrJztcclxuXHR0aGlzLnZhcnMuZmx1c2ggICAgICAgICAgICAgPSAneWVzJztcclxuXHR0aGlzLnZhcnMuc2hvd19jdXJzb3IgICAgICAgPSAneWVzJztcclxuXHR0aGlzLnZhcnMudGltZW91dCAgICAgICAgICAgPSAnaW5maW5pdGUnO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcdFxyXG5cdC8vIFNldCB0aGUgaW50ZXJuYWwgZmx1c2ggcHJvcGVydHkuXHJcblx0dGhpcy5fZmx1c2ggPSAodGhpcy52YXJzLmZsdXNoKSA/IHRoaXMudmFycy5mbHVzaCA6ICd5ZXMnO1xyXG4gXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5nZW5lcmljX3Jlc3BvbnNlX3ByZXBhcmUoKTtcclxuICAgfTtcclxuXHJcbiAgICBwLnJ1biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmdlbmVyaWNfcmVzcG9uc2VfcnVuKCk7XHJcblxyXG4gICAgICAgIC8vIFJlY29yZCB0aGUgb25zZXQgb2YgdGhlIGN1cnJlbnQgaXRlbS5cclxuXHR0aGlzLnNldF9pdGVtX29uc2V0KCk7IFxyXG4gICAgICAgIFxyXG5cdC8vIFNob3cgdGhlIGN1cnNvciBpZiBkZWZpbmVkLlxyXG4gICAgICAgIGlmICh0aGlzLnZhcnMuc2hvd19jdXJzb3IgPT0gJ3llcycpXHJcblx0e1x0XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlLnNob3dfY3Vyc29yKHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcblx0Ly8gRmx1c2ggcmVzcG9uc2VzLCB0byBtYWtlIHN1cmUgdGhhdCBlYXJsaWVyIHJlc3BvbnNlcyBhcmUgbm90IGNhcnJpZWQgb3Zlci5cclxuXHRpZiAodGhpcy5fZmx1c2ggPT0gJ3llcycpXHJcblx0e1x0XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlLmZsdXNoKCk7XHJcblx0fVx0XHRcclxuICAgIFxyXG4gICAgICAgIHRoaXMuc2V0X3NyaSgpO1xyXG4gICAgICAgIHRoaXMucHJvY2Vzc19yZXNwb25zZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEhpZGUgdGhlIG1vdXNlIGN1cnNvci4gICAgXHJcbiAgICAgICAgdGhpcy5fbW91c2Uuc2hvd19jdXJzb3IoZmFsc2UpO1xyXG4gICAgICAgXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICAgICAgdGhpcy5nZW5lcmljX3Jlc3BvbnNlX2NvbXBsZXRlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIG1vdXNlX3Jlc3BvbnNlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5tb3VzZV9yZXNwb25zZSA9IG9zd2ViLnByb21vdGVDbGFzcyhtb3VzZV9yZXNwb25zZSwgXCJnZW5lcmljX3Jlc3BvbnNlXCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3Mgc2VxdWVuY2UuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIHNlcXVlbmNlKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMuaXRlbV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG5cdFxyXG4gICAgICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBwcm9wZXJ0aWVzLiBcclxuXHR0aGlzLl9pbmRleCAgICAgICAgID0gLTE7XHJcblx0dGhpcy5faW5kZXhfcHJlcGFyZSA9IC0xO1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zICAgICAgICAgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2tleWJvYXJkICAgICAgPSBudWxsOyAgICBcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhzZXF1ZW5jZSwgb3N3ZWIuaXRlbSk7XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uICAgID0gJ1J1bnMgYSBudW1iZXIgb2YgaXRlbXMgaW4gc2VxdWVuY2UnO1xyXG4gICAgcC5mbHVzaF9rZXlib2FyZCA9ICd5ZXMnO1xyXG4gICAgcC5pdGVtcyAgICAgICAgICA9IG51bGw7XHJcblx0XHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5yZXNldCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBSZXNldHMgYWxsIGl0ZW0gdmFyaWFibGVzIHRvIHRoZWlyIGRlZmF1bHQgdmFsdWUuLlxyXG5cdHRoaXMuaXRlbXMgICAgICAgICAgICAgICA9IFtdO1xyXG5cdHRoaXMudmFycy5mbHVzaF9rZXlib2FyZCA9ICd5ZXMnO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmZyb21fc3RyaW5nID0gZnVuY3Rpb24ocFN0cmluZylcclxuICAgIHtcclxuXHQvLyBQYXJzZXMgYSBkZWZpbml0aW9uIHN0cmluZy5cclxuXHR0aGlzLnZhcmlhYmxlcyA9IHt9O1xyXG5cdHRoaXMuY29tbWVudHMgID0gW107XHJcblx0dGhpcy5yZXNldCgpO1xyXG5cdFx0XHJcblx0Ly8gU3BsaXQgdGhlIHN0cmluZyBpbnRvIGFuIGFycmF5IG9mIGxpbmVzLiAgXHJcblx0aWYgKHBTdHJpbmcgIT0gbnVsbClcclxuXHR7XHJcbiAgICAgICAgICAgIHZhciBsaW5lcyA9IHBTdHJpbmcuc3BsaXQoJ1xcbicpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpPTA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG5cdFx0aWYgKChsaW5lc1tpXSAhPSAnJykgJiYgKHRoaXMucGFyc2VfdmFyaWFibGUobGluZXNbaV0pID09IGZhbHNlKSlcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5zID0gb3N3ZWIuc3ludGF4LnNwbGl0KGxpbmVzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKHRva2Vucy5sZW5ndGggPiAwKSAmJiAodG9rZW5zWzBdID09ICdydW4nKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdG9rZW5zWzFdO1xyXG5cdFx0XHR2YXIgY29uZCA9ICdhbHdheXMnO1xyXG5cdFx0XHRpZiAodG9rZW5zLmxlbmd0aCA+IDIpXHJcblx0XHRcdHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmQgPSB0b2tlbnNbMl07XHJcblx0XHRcdH1cdFxyXG5cclxuXHRcdFx0Ly8gUHVzaCB0aGUgaXRlbSBhbmQgY29uZGl0aW9uIGRlZmluaXRpb24gdG8gdGhlIGl0ZW1zIGxpc3QuXHJcblx0XHRcdHRoaXMuaXRlbXMucHVzaCh7J2l0ZW0nOiBpdGVtLCAnY29uZCc6IGNvbmR9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHRcclxuICAgICAgICAgICAgXHR9IFxyXG4gICAgICAgICAgICB9XHJcblx0fVx0XHRcdFx0XHRcclxuICAgIH07XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW4gY3ljbGUuICAgICAgICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnByZXBhcmUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5pdGVtX3ByZXBhcmUoKTtcclxuXHRcclxuICAgICAgICAvLyBDcmVhdGUgYSBrZXlib2FyZCB0byBmbHVzaCByZXNwb25zZXMgYXQgdGhlIHN0YXJ0IG9mIHRoZSBydW4gcGhhc2VcclxuXHRpZiAodGhpcy52YXJzLmZsdXNoX2tleWJvYXJkID09ICd5ZXMnKVxyXG4gICAgICAgIHtcdFxyXG4gICAgICAgICAgICB0aGlzLl9rZXlib2FyZCA9IG5ldyBvc3dlYi5rZXlib2FyZCh0aGlzLmV4cGVyaW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgeyAgICBcclxuICAgICAgICAgICAgdGhpcy5fa2V5Ym9hcmQgPSBudWxsO1xyXG4gICAgICAgIH0gICAgXHJcblx0XHJcbiAgICAgICAgLy8gR2VuZXJhdGUgdGhlIGl0ZW1zIGxpc3QgZm9yIHRoZSBydW4gY3ljbGUuXHJcbiAgICAgICAgdGhpcy5faW5kZXggPSAwO1xyXG5cdHRoaXMuX2l0ZW1zID0gW107XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJlcGFyZSB0aGUgaXRlbXMuXHJcbiAgICAgICAgdGhpcy5wcmVwYXJlX2NvbXBsZXRlKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvKiB0aGlzLl9pdGVtcyA9IFtdO1xyXG5cdGZvciAodmFyIGk9MDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspXHJcblx0e1xyXG4gICAgICAgICAgICBpZiAoKHRoaXMuaXRlbXNbaV0uaXRlbSBpbiBvc3dlYi5pdGVtX3N0b3JlLl9pdGVtcykgPT09IGZhbHNlKVxyXG4gICAgICAgICAgICB7XHJcblx0XHRvc3dlYi5kZWJ1Zy5hZGRFcnJvcignQ291bGQgbm90IGZpbmQgaXRlbSAnICsgdGhpcy5pdGVtc1tpXS5pdGVtLm5hbWUgKyAnIHdoaWNoIGlzIGNhbGxlZCBieSBzZXF1ZW5jZSBpdGVtICcgKyB0aGlzLm5hbWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgdGhlIGl0ZW1zLlxyXG4gICAgICAgICAgICAgICAgb3N3ZWIuaXRlbV9zdG9yZS5wcmVwYXJlKHRoaXMuaXRlbXNbaV0uaXRlbSk7XHJcblx0XHRcclxuICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgaXRlbSB0byB0aGUgaW50ZXJuYWwgbGlzdC5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1zLnB1c2goeydpdGVtJzogdGhpcy5pdGVtc1tpXS5pdGVtLCAnY29uZCc6IG9zd2ViLnN5bnRheC5jb21waWxlX2NvbmQodGhpcy5pdGVtc1tpXS5jb25kKX0pO1xyXG4gICAgICAgICAgICB9XHJcblx0fSAqL1x0XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBwLnByZXBhcmVfY29tcGxldGUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gR2VuZXJhdGUgdGhlIGl0ZW1zIGxpc3QgZm9yIHRoZSBydW4gY3ljbGUuXHJcbiAgICAgICAgaWYgKHRoaXMuX2luZGV4IDwgdGhpcy5pdGVtcy5sZW5ndGgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoKHRoaXMuaXRlbXNbdGhpcy5faW5kZXhdLml0ZW0gaW4gb3N3ZWIuaXRlbV9zdG9yZS5faXRlbXMpID09PSBmYWxzZSlcclxuICAgICAgICAgICAge1xyXG5cdFx0b3N3ZWIuZGVidWcuYWRkRXJyb3IoJ0NvdWxkIG5vdCBmaW5kIGl0ZW0gJyArIHRoaXMuaXRlbXNbdGhpcy5faW5kZXhdLml0ZW0ubmFtZSArICcgd2hpY2ggaXMgY2FsbGVkIGJ5IHNlcXVlbmNlIGl0ZW0gJyArIHRoaXMubmFtZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy8gSW5jcmVhc2UgdGhlIGN1cnJlbnQgaW5kZXguXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIGl0ZW0gdG8gdGhlIGludGVybmFsIGxpc3QuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtcy5wdXNoKHsnaXRlbSc6IHRoaXMuaXRlbXNbdGhpcy5faW5kZXggLSAxXS5pdGVtLCAnY29uZCc6IG9zd2ViLnN5bnRheC5jb21waWxlX2NvbmQodGhpcy5pdGVtc1t0aGlzLl9pbmRleCAtIDFdLmNvbmQpfSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgdGhlIGl0ZW0uXHJcbiAgICAgICAgICAgICAgICBvc3dlYi5pdGVtX3N0b3JlLnByZXBhcmUodGhpcy5pdGVtc1t0aGlzLl9pbmRleCAtIDFdLml0ZW0sIHRoaXMpO1xyXG5cdCAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIFByZXBhcmUgcHJvY2VzcyBpcyBkb25lLCBzdGFydCBleGVjdXRpb24uXHJcbiAgICAgICAgICAgIHRoaXMuX2luZGV4ID0gMDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgcHJlcGFyZSBwaGFzZSBmb3JtIHRoZSBzdGFjay4gICAgXHJcbiAgICAgICAgICAgIG9zd2ViLml0ZW1fc3RhY2sucG9wKCk7XHJcbiAgICBcclxuICBcdCAgICAvLyBFeGVjdXRlIHRoZSBuZXh0IGN5Y2xlIG9mIHRoZSBzZXF1bmNlIGl0c2VsZi5cclxuICAgICAgICAgICAgb3N3ZWIuaXRlbV9zdG9yZS5ydW4odGhpcy5uYW1lLCB0aGlzLl9wYXJlbnQpO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBwLnJ1biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgICAgICB0aGlzLml0ZW1fcnVuKCk7XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGlmIGFsbCBpdGVtcyBoYXZlIGJlZW4gcHJvY2Vzc2VkLlxyXG4gICAgICAgIGlmICh0aGlzLl9pbmRleCA8IHRoaXMuX2l0ZW1zLmxlbmd0aClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIEZsdXNoIHRoZSBrZXlib2FyZCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBzZXF1ZW5jZS5cclxuICAgICAgICAgICAgaWYgKCh0aGlzLl9pbmRleCA9PSAwKSAmJiAodGhpcy52YXJzLmZsdXNoX2tleWJvYXJkID09ICd5ZXMnKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fa2V5Ym9hcmQuZmx1c2goKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSW5jcmVhc2UgdGhlIGN1cnJlbnQgaW5kZXguXHJcbiAgICAgICAgICAgIHRoaXMuX2luZGV4Kys7XHJcbiAgICAgICAgICAgIGN1cnJlbnRfaXRlbSA9IHRoaXMuX2l0ZW1zW3RoaXMuX2luZGV4IC0gMV1cclxuXHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgd29ya3NwYWNlLlxyXG4gICAgICAgICAgICBvc3dlYi5weXRob25fd29ya3NwYWNlWydzZWxmJ10gPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGl0ZW0gbWF5IHJ1bi4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChvc3dlYi5weXRob25fd29ya3NwYWNlLl9ldmFsKGN1cnJlbnRfaXRlbS5jb25kKSA9PSB0cnVlKSBcclxuICAgICAgICAgICAgeyAgIFxyXG4gICAgICAgICAgICAgICAgLy8gcnVuIHRoZSBjdXJyZW50IGl0ZW0gb2YgdGhlIHNlcXVlbmNlIG9iamVjdC5cclxuICAgICAgICAgICAgICAgIG9zd2ViLml0ZW1fc3RvcmUucnVuKGN1cnJlbnRfaXRlbS5pdGVtLCB0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gIFx0ICAgIGVsc2VcclxuICBcdCAgICB7XHJcbiAgXHQgICAgXHQvLyBFeGVjdXRlIHRoZSBuZXh0IGN5Y2xlIG9mIHRoZSBzZXF1bmNlIGl0c2VsZi5cclxuICBcdCAgICBcdHRoaXMucnVuKCk7XHRcclxuICBcdCAgICB9XHJcblx0fVxyXG5cdGVsc2VcclxuXHR7XHJcbiAgICAgICAgICAgIC8vIHNlcXVlbmNlIGlzIGZpbmFsaXplZC5cclxuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblx0XHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIHNlcXVlbmNlIGlzIGZpbmFsaXplZC5cclxuICAgICAgICB0aGlzLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFO1xyXG4gXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICAgICAgdGhpcy5pdGVtX2NvbXBsZXRlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIHNlcXVlbmNlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5zZXF1ZW5jZSA9IG9zd2ViLnByb21vdGVDbGFzcyhzZXF1ZW5jZSwgXCJpdGVtXCIpO1xyXG59KCkpO1xyXG4iLCIvKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBza2V0Y2hwYWQuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIHNrZXRjaHBhZChwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHB1YmxpY2UgcHJvcGVydGllcy5cclxuICAgIFx0dGhpcy5jYW52YXMgICA9IG5ldyBvc3dlYi5jYW52YXMocEV4cGVyaW1lbnQsIGZhbHNlKTtcclxuXHR0aGlzLmVsZW1lbnRzID0gW107XHJcblxyXG5cdC8vIEluaGVyaXRlZCBjcmVhdGUuXHJcblx0dGhpcy5nZW5lcmljX3Jlc3BvbnNlX2NvbnN0cnVjdG9yKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCk7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3Moc2tldGNocGFkLCBvc3dlYi5nZW5lcmljX3Jlc3BvbnNlKTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuY2FudmFzICAgPSBudWxsO1xyXG4gICAgcC5lbGVtZW50cyA9IFtdO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLiAgICAgICAgIFxyXG4gICAgICovXHJcbiAgICBcclxuICAgIHAuX2NvbXBhcmUgPSBmdW5jdGlvbihhLGIpIFxyXG4gICAge1xyXG4gICAgICAgIC8vIFNvcnQgZnVuY3Rpb24gdXNlZCBmb3IgZGV0ZXJtaW5pbmcgdGhlIGRyYXcgaW5kZXggKHotaW5kZXgpIG9mIGFsbGUgZWxlbWVudGUuXHJcbiAgICAgICAgaWYgKGEuel9pbmRleCgpIDwgYi56X2luZGV4KCkpXHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgIGVsc2UgaWYgKGEuel9pbmRleCgpID4gYi56X2luZGV4KCkpXHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICBlbHNlIFxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gYnVpbGQgY3ljbGUuLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5yZXNldCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gUmVzZXRzIGFsbCBpdGVtIHZhcmlhYmxlcyB0byB0aGVpciBkZWZhdWx0IHZhbHVlLlxyXG4gICAgXHR0aGlzLmVsZW1lbnRzICAgICAgPSBbXTtcclxuXHR0aGlzLnZhcnMuZHVyYXRpb24gPSAna2V5cHJlc3MnO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmZyb21fc3RyaW5nID0gZnVuY3Rpb24ocFN0cmluZylcclxuICAgIHtcclxuICAgICAgICAvLyBEZWZpbmUgYW5kIHJlc2V0IHZhcmlhYmxlcyB0byB0aGVpciBkZWZhdWx0cy5cclxuICAgICAgICB0aGlzLnZhcmlhYmxlcyA9IHt9O1xyXG4gICAgICAgIHRoaXMuY29tbWVudHMgID0gW107XHJcbiBcdHRoaXMucmVzZXQoKTtcclxuXHRcdFxyXG5cdC8vIFNwbGl0IHRoZSBzdHJpbmcgaW50byBhbiBhcnJheSBvZiBsaW5lcy4gIFxyXG5cdGlmIChwU3RyaW5nICE9IG51bGwpXHJcblx0e1xyXG4gICAgICAgICAgICB2YXIgbGluZXMgPSBwU3RyaW5nLnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuXHRcdGlmICgobGluZXNbaV0gIT0gJycpICYmICh0aGlzLnBhcnNlX3ZhcmlhYmxlKGxpbmVzW2ldKSA9PSBmYWxzZSkpXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VucyA9IG9zd2ViLnN5bnRheC5zcGxpdChsaW5lc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCh0b2tlbnMubGVuZ3RoID4gMCkgJiYgKHRva2Vuc1swXSA9PSAnZHJhdycpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuXHRcdFx0aWYgKG9zd2ViLmlzQ2xhc3ModG9rZW5zWzFdKSA9PSB0cnVlKVxyXG5cdFx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IG9zd2ViLm5ld0VsZW1lbnRDbGFzcyh0b2tlbnNbMV0sIHRoaXMsIGxpbmVzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudHMucHVzaChlbGVtZW50KTtcdFxyXG5cdFx0XHR9XHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG5cdFx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlcnJvci5cclxuXHRcdFx0fVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHRcdH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gU29ydCB0aGUgZWxlbWVudHMgdXNpbiB0aGUgei1pbmRleC5cclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50cy5zb3J0KHRoaXMuX2NvbXBhcmUpO1xyXG4gICAgICAgIH1cdFx0XHRcdFx0XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW5uIGN5Y2xlLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5wcmVwYXJlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIERyYXcgdGhlIGVsZW1lbnRzLiBcclxuXHRmb3IgKHZhciBpPTA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKVxyXG5cdHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudHNbaV0uaXNfc2hvd24oKSA9PSB0cnVlKVxyXG4gICAgICAgICAgICB7XHJcblx0XHR0aGlzLmVsZW1lbnRzW2ldLmRyYXcoKTtcclxuICAgICAgICAgICAgfVx0XHRcdFxyXG5cdH1cdFx0XHRcdFxyXG4gICAgXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5nZW5lcmljX3Jlc3BvbnNlX3ByZXBhcmUoKTtcclxuICAgIH07XHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5nZW5lcmljX3Jlc3BvbnNlX3J1bigpO1xyXG5cdFx0XHJcbiAgICAgICAgLy8gU2V0IHRoZSBvbnNldCBhbmQgc3RhcnQgdGhlIHN0aW11bHVzIHJlc3BvbnNlIHByb2Nlc3MuICAgICAgICBcclxuXHR0aGlzLnNldF9pdGVtX29uc2V0KHRoaXMuY2FudmFzLnNob3coKSk7IFxyXG5cdHRoaXMuc2V0X3NyaShmYWxzZSk7XHJcblx0dGhpcy5wcm9jZXNzX3Jlc3BvbnNlKCk7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC5jb21wbGV0ZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBDbGVhciB0aGUgY2FudmFzLlxyXG5cdHRoaXMuY2FudmFzLmNsZWFyKCk7XHJcblx0XHRcclxuXHQvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmdlbmVyaWNfcmVzcG9uc2VfY29tcGxldGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgc2tldGNocGFkIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5za2V0Y2hwYWQgPSBvc3dlYi5wcm9tb3RlQ2xhc3Moc2tldGNocGFkLCBcImdlbmVyaWNfcmVzcG9uc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBmZWVkYmFjay5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZmVlZGJhY2socEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZCBjcmVhdGUuXHJcblx0dGhpcy5za2V0Y2hwYWRfY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhmZWVkYmFjaywgb3N3ZWIuc2tldGNocGFkKTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZGVzY3JpcHRpb24gPSAnUHJvdmlkZXMgZmVlZGJhY2sgdG8gdGhlIHBhcnRpY2lwYW50JztcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLlxyXG4gICAgICovXHJcblxyXG4gICAgcC5yZXNldCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gUmVzZXRzIGFsbCBpdGVtIHZhcmlhYmxlcyB0byB0aGVpciBkZWZhdWx0IHZhbHVlLlxyXG5cdHRoaXMuc2tldGNocGFkX3Jlc2V0KCk7XHJcblx0dGhpcy52YXJzLnJlc2V0X3ZhcmlhYmxlcyA9ICd5ZXMnO1xyXG4gICAgfTtcdFxyXG4gICAgXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBQcmVwYXJlcyB0aGUgaXRlbS5cclxuICAgICAgICB0aGlzLl9wYXJlbnQucHJlcGFyZV9jb21wbGV0ZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnJ1biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5za2V0Y2hwYWRfcHJlcGFyZSgpO1xyXG5cdHRoaXMuc2tldGNocGFkX3J1bigpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgXHQvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLnNrZXRjaHBhZF9jb21wbGV0ZSgpO1xyXG5cclxuXHQvLyBSZXNldCBmZWVkYmFjayB2YXJpYWJsZXMuXHJcblx0aWYgKHRoaXMudmFycy5yZXNldF92YXJpYWJsZXMgPT0gJ3llcycpXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQucmVzZXRfZmVlZGJhY2soKTtcclxuXHR9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGZlZWRiYWNrIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5mZWVkYmFjayA9IG9zd2ViLnByb21vdGVDbGFzcyhmZWVkYmFjaywgXCJza2V0Y2hwYWRcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBzeW50aC5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gc3ludGgocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLnNhbXBsZXJfY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhzeW50aCwgb3N3ZWIuc2FtcGxlcik7XHJcblxyXG4gICAgLy8gRGVmaW5lIGFuZCBzZXQgdGhlIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZGVzY3JpcHRpb24gPSAnQSBiYXNpYyBzb3VuZCBzeW50aGVzaXplcic7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMuXHJcbiAgICAgKi9cclxuXHJcbiAgICAvLyBCaW5kIHRoZSBzeW50aCBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuc3ludGggPSBvc3dlYi5wcm9tb3RlQ2xhc3Moc3ludGgsIFwic2FtcGxlclwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGFkdmFuY2VkX2RlbGF5LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBhZHZhbmNlZF9kZWxheShwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuaXRlbV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG4gICAgXHJcbiAgICAgICAgLy8gU2V0IHByaXZhdGUgcHJvcGVydGllcy5cclxuICAgICAgICB0aGlzLl9kdXJhdGlvbiA9IC0xO1xyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGFkdmFuY2VkX2RlbGF5LCBvc3dlYi5pdGVtKTtcclxuXHJcbiAgICAvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdXYWl0cyBmb3IgYSBzcGVjaWZpZWQgZHVyYXRpb24nO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBjbGFzcyBtZXRob2RzIC0gYnVpbGQgY3ljbGUuXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgXHQvLyBSZXNldHMgYWxsIGl0ZW0gdmFyaWFibGVzIHRvIHRoZWlyIGRlZmF1bHQgdmFsdWUuXHJcblx0dGhpcy52YXJzLmR1cmF0aW9uICAgID0gMTAwMDtcclxuXHR0aGlzLnZhcnMuaml0dGVyICAgICAgPSAwO1xyXG5cdHRoaXMudmFycy5qaXR0ZXJfbW9kZSA9ICdVbmlmb3JtJztcclxuICAgIH07IFxyXG4gICAgXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHR0aGlzLl9kdXJhdGlvbiA9IHRoaXMudmFycy5kdXJhdGlvbjtcclxuICAgICAgICAvKiAjIFNhbml0eSBjaGVjayBvbiB0aGUgZHVyYXRpb24gdmFsdWUsIHdoaWNoIHNob3VsZCBiZSBhIHBvc2l0aXZlIG51bWVyaWNcclxuXHQjIHZhbHVlLlxyXG5cdGlmIHR5cGUoc2VsZi52YXIuZHVyYXRpb24pIG5vdCBpbiAoaW50LCBmbG9hdCkgb3Igc2VsZi52YXIuZHVyYXRpb24gPCAwOlxyXG5cdFx0cmFpc2Ugb3NleGNlcHRpb24oXHJcblx0XHRcdHUnRHVyYXRpb24gc2hvdWxkIGJlIGEgcG9zaXRpdmUgbnVtZXJpYyB2YWx1ZSBpbiBhZHZhbmNlZF9kZWxheSAlcycgXFxcclxuXHRcdFx0JSBzZWxmLm5hbWUpXHJcblx0aWYgc2VsZi52YXIuaml0dGVyX21vZGUgPT0gdSdVbmlmb3JtJzpcclxuXHRcdHNlbGYuX2R1cmF0aW9uID0gcmFuZG9tLnVuaWZvcm0oc2VsZi52YXIuZHVyYXRpb24tc2VsZi52YXIuaml0dGVyLzIsXHJcblx0XHRcdHNlbGYudmFyLmR1cmF0aW9uK3NlbGYudmFyLmppdHRlci8yKVxyXG5cdGVsaWYgc2VsZi52YXIuaml0dGVyX21vZGUgPT0gdSdTdGQuIERldi4nOlxyXG5cdFx0c2VsZi5fZHVyYXRpb24gPSByYW5kb20uZ2F1c3Moc2VsZi52YXIuZHVyYXRpb24sIHNlbGYudmFyLmppdHRlcilcclxuXHRlbHNlOlxyXG5cdFx0cmFpc2Ugb3NleGNlcHRpb24oXHJcblx0XHRcdHUnVW5rbm93biBqaXR0ZXIgbW9kZSBpbiBhZHZhbmNlZF9kZWxheSAlcycgJSBzZWxmLm5hbWUpXHJcblx0IyBEb24ndCBhbGxvdyBuZWdhdGl2ZSBkdXJhdGlvbnMuXHJcblx0aWYgc2VsZi5fZHVyYXRpb24gPCAwOlxyXG5cdFx0c2VsZi5fZHVyYXRpb24gPSAwXHJcblx0c2VsZi5fZHVyYXRpb24gPSBpbnQoc2VsZi5fZHVyYXRpb24pXHJcblx0c2VsZi5leHBlcmltZW50LnZhci5zZXQodSdkZWxheV8lcycgJSBzZWxmLm5hbWUsIHNlbGYuX2R1cmF0aW9uKVxyXG5cdGRlYnVnLm1zZyh1XCJkZWxheSBmb3IgJXMgbXNcIiAlIHNlbGYuX2R1cmF0aW9uKSAqL1xyXG5cclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLml0ZW1fcHJlcGFyZSgpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpIFxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG4gICAgXHR0aGlzLml0ZW1fcnVuKCk7XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgb25zZXQgdGltZS5cclxuICAgICAgICB0aGlzLnNldF9pdGVtX29uc2V0KHRoaXMudGltZSgpKTtcclxuICAgICAgICB0aGlzLnNsZWVwKHRoaXMuX2R1cmF0aW9uKTtcdFx0XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGFkdmFuY2VkX2RlbGF5IGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5hZHZhbmNlZF9kZWxheSA9IG9zd2ViLnByb21vdGVDbGFzcyhhZHZhbmNlZF9kZWxheSwgXCJpdGVtXCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgZm9ybV9iYXNlLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBmb3JtX2Jhc2UocE5hbWUsIHBFeHBlcmltZW50LCBwU2NyaXB0LCBwSXRlbV90eXBlLCBwRGVzY3JpcHRpb24pXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuaXRlbV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG5cclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHByaXZhdGUgcHJvcGVydGllcy5cclxuICAgICAgICB0aGlzLl9mb3JtX3RleHQgPSBmYWxzZTtcclxuICAgIFxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuXHJcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IHBEZXNjcmlwdGlvbjtcclxuICAgICAgICB0aGlzLml0ZW1fdHlwZSAgID0gcEl0ZW1fdHlwZTtcclxuICAgIH0gICBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MoZm9ybV9iYXNlLCBvc3dlYi5pdGVtKTtcclxuXHJcbiAgICAvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5jb2xzICAgICAgICA9IFtdO1xyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdBIGdlbmVyaWMgZm9ybSBwbHVnLWluJztcclxuICAgIHAuZm9ybSAgICAgICAgPSBudWxsO1xyXG4gICAgcC5yb3dzICAgICAgICA9IFtdO1xyXG4gICAgXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLlxyXG4gICAgICovXHJcblxyXG4gICAgcC5yZXNldCA9IGZ1bmN0aW9uKCkgXHJcbiAgICB7XHJcbiAgICAgIFx0Ly8gUmVzZXRzIGFsbCBpdGVtIHZhcmlhYmxlcyB0byB0aGVpciBkZWZhdWx0IHZhbHVlLlxyXG4gICAgICBcdHRoaXMudmFycy5jb2xzICAgICAgICA9ICcyOzInO1xyXG4gICAgXHR0aGlzLnZhcnMucm93cyAgICAgICAgPSAnMjsyJztcclxuICAgIFx0dGhpcy52YXJzLnNwYWNpbmcgICAgID0gMTA7XHJcbiAgICBcdHRoaXMudmFycy5fdGhlbWUgICAgICA9ICdncmF5JztcclxuICAgIFx0dGhpcy52YXJzLm9ubHlfcmVuZGVyID0gJ25vJztcclxuICAgIFx0dGhpcy52YXJzLnRpbWVvdXQgICAgID0gJ2luZmluaXRlJztcclxuICAgIFx0dGhpcy52YXJzLm1hcmdpbnMgICAgID0gJzUwOzUwOzUwOzUwJztcclxuICAgIFx0dGhpcy5fdmFyaWFibGVzICAgICAgID0gW107ICAgXHJcbiAgICBcdHRoaXMuX3dpZGdldHMgICAgICAgICA9IFtdO1xyXG4gICAgfTsgICAgXHJcblxyXG4gICAgcC5wYXJzZV9saW5lID0gZnVuY3Rpb24ocFN0cmluZylcclxuICAgIHtcclxuICAgICAgICAvLyBTcGxpdCB0aGUgbGluZSBpbiB0b2tlbnMuXHJcbiAgICAgICAgdmFyIGxpc3QgPSB0aGlzLnN5bnRheC5zcGxpdChwU3RyaW5nKTtcclxuXHJcbiAgICAgICAgaWYgKCh0aGlzLl9mb3JtX3RleHQgPT0gdHJ1ZSkgJiYgKGxpc3RbMF0gIT0gJ19fZW5kX18nKSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMudmFyc1snZm9ybV90ZXh0J10gPSB0aGlzLnZhcnNbJ2Zvcm1fdGV4dCddICsgcFN0cmluZy5yZXBsYWNlKCdcXHQnLCcnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBDaGVjayBmb3Igd2lkZ2V0IGRlZmluaXRpb24uXHJcbiAgICAgICAgaWYgKGxpc3RbMF0gPT0gJ3dpZGdldCcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvLyBSZW1vdmUgd2lkZ2V0IGNvbW1hbmQuXHJcbiAgICAgICAgICAgIGxpc3Quc2hpZnQoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEFkZCB3aWRnZXQgdG8gdGhlIGxpc3QuXHJcbiAgICAgICAgICAgIHRoaXMuX3dpZGdldHMucHVzaChsaXN0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAobGlzdFswXSA9PSAnX19mb3JtX3RleHRfXycpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnZhcnNbJ2Zvcm1fdGV4dCddID0gJyc7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1fdGV4dCAgICAgICAgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChsaXN0WzBdID09ICdfX2VuZF9fJylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1fdGV4dCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvKiBpZiB1J3ZhcicgaW4ga3dkaWN0OlxyXG5cdCBzZWxmLl92YXJpYWJsZXMuYXBwZW5kKGt3ZGljdFt1J3ZhciddKSAgICovICBcclxuICAgIH07XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMgLSBydW4gY3ljbGUuXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnByZXBhcmUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gUmV0cmlldmUgdGhlIGNvbHVtbiwgcm93cyBhbmQgbWFyZ2lucy5cclxuICAgICAgICB2YXIgY29scyAgICA9IHRoaXMudmFycy5jb2xzLnNwbGl0KCc7Jyk7XHJcbiAgICAgICAgdmFyIHJvd3MgICAgPSB0aGlzLnZhcnMucm93cy5zcGxpdCgnOycpO1xyXG4gICAgICAgIHZhciBtYXJnaW5zID0gdGhpcy52YXJzLm1hcmdpbnMuc3BsaXQoJzsnKTsgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gR2V0IHRoZSB0aW1lIG91dCBwYXJhbXRlci5cclxuICAgICAgICBpZiAodGhpcy52YXJzLnRpbWVvdXQgPT0gJ2luZmluaXRlJylcclxuICAgICAgICB7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgdGltZW91dCA9IG51bGw7XHJcbiAgICAgICAgfSAgICBcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgeyAgICBcclxuICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSB0aGlzLnZhcnMudGltZW91dDtcclxuICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICAgICBcclxuICAgICAgICAvLyBDcmVhdGUgdGhlIGJhc2ljIGZvcm0uICAgIFxyXG4gICAgICAgIHRoaXMuZm9ybSA9IG5ldyBvc3dlYi5mb3JtKHRoaXMuZXhwZXJpbWVudCwgY29scywgcm93cywgdGhpcy52YXJzLnNwYWNpbmcsIG1hcmdpbnMsIHRoaXMudmFycy5fdGhlbWUsIHRoaXMsIHRpbWVvdXQsIHRoaXMudmFycy5mb3JtX2NsaWNrcyA9PSAneWVzJyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZm9yICh2YXIgaT0wO2kgPCB0aGlzLl93aWRnZXRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5mb2N1c193aWRnZXQgPSBudWxsO1xyXG4gICAgICAgICAgICB2YXIga3dkaWN0ID0ge307XHJcbiAgICAgICAgICAgIHZhciBwYXJhbWV0ZXJzID0gW107XHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnMucHVzaCh0aGlzLmZvcm0pO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fd2lkZ2V0c1tpXS5sZW5ndGggPiA1KSBcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaj01O2ogPCB0aGlzLl93aWRnZXRzW2ldLmxlbmd0aDtqKyspXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhck5hbWUgID0gU3RyaW5nKHRoaXMuX3dpZGdldHNbaV1bal0pLnN1YnN0cigwLFN0cmluZyh0aGlzLl93aWRnZXRzW2ldW2pdKS5pbmRleE9mKCc9JykpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YXJWYWx1ZSA9IFN0cmluZyh0aGlzLl93aWRnZXRzW2ldW2pdKS5zdWJzdHJpbmcoU3RyaW5nKHRoaXMuX3dpZGdldHNbaV1bal0pLmluZGV4T2YoJz0nKSArIDEsU3RyaW5nKHRoaXMuX3dpZGdldHNbaV1bal0pLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAga3dkaWN0W3Zhck5hbWVdID0gb3N3ZWIuc3ludGF4LnJlbW92ZV9xdW90ZXModmFyVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGt3ZGljdFt2YXJOYW1lXSA9IG9zd2ViLnN5bnRheC5ldmFsX3RleHQoa3dkaWN0W3Zhck5hbWVdLCB0aGlzLnZhcnMpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVycy5wdXNoKG9zd2ViLnN5bnRheC5yZW1vdmVfcXVvdGVzKHZhclZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvKiAjIFByb2Nlc3MgZm9jdXMga2V5d29yZFxyXG4gICAgICAgICAgICBmb2N1cyA9IEZhbHNlXHJcbiAgICAgICAgICAgIGlmIHUnZm9jdXMnIGluIGt3ZGljdDpcclxuICAgICAgICAgICAgICAgIGlmIGt3ZGljdFt1J2ZvY3VzJ10gPT0gdSd5ZXMnOlxyXG4gICAgICAgICAgICAgICAgICAgIGZvY3VzID0gVHJ1ZVxyXG4gICAgICAgICAgICAgICAgZGVsIGt3ZGljdFt1J2ZvY3VzJ10gKi9cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFBhcnNlIGFyZ3VtZW50c1xyXG4gICAgICAgICAgICB2YXIgX3R5cGUgICA9IHRoaXMuX3dpZGdldHNbaV1bNF07XHJcbiAgICAgICAgICAgIHZhciBjb2wgICAgID0gdGhpcy5fd2lkZ2V0c1tpXVswXTtcclxuICAgICAgICAgICAgdmFyIHJvdyAgICAgPSB0aGlzLl93aWRnZXRzW2ldWzFdO1xyXG4gICAgICAgICAgICB2YXIgY29sc3BhbiA9IHRoaXMuX3dpZGdldHNbaV1bMl07XHJcbiAgICAgICAgICAgIHZhciByb3dzcGFuID0gdGhpcy5fd2lkZ2V0c1tpXVszXTtcclxuXHRcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSB3aWRnZXQuXHJcbiAgICAgICAgICAgIHRyeSBcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIF93ID0gb3N3ZWIubmV3V2lkZ2V0Q2xhc3MoX3R5cGUsIHRoaXMuZm9ybSwga3dkaWN0KTtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocGFyYW1ldGVycyk7XHJcbiAgICAgICAgICAgICAgICAvL3ZhciBfdyA9IG9zd2ViLm5ld1dpZGdldENsYXNzKF90eXBlLCBwYXJhbWV0ZXJzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaChlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSB3aWRnZXQgJyArIF90eXBlICsgJywgZXJyb3I6JyArIGUpO1xyXG4gICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgd2lkdGggcG9zaXRpb24gYW5kIGZvcm0uICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5mb3JtLnNldF93aWRnZXQoX3csIFtjb2wsIHJvd10sIGNvbHNwYW4sIHJvd3NwYW4pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gQWRkIGFzIGZvY3VzIHdpZGdldFxyXG4gICAgICAgICAgICBpZiAoZm9jdXMgPT0gdHJ1ZSkgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgXHRpZiAodGhpcy5mb2N1c193aWRnZXQgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRFcnJvcignT3N3ZWIgZXJyb3I6IFlvdSBjYW4gb25seSBzcGVjaWZ5IG9uZSBmb2N1cyB3aWRnZXQnKTtcclxuICAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c193aWRnZXQgPSBfdztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEluaGVyaXRlZC4gICBcclxuICAgICAgICB0aGlzLml0ZW1fcHJlcGFyZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnJ1biA9IGZ1bmN0aW9uKCkgXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICBcdHRoaXMuaXRlbV9ydW4oKTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5mb3JtKTtcclxuICAgICAgICAvLyBTZXQgZGltZW5zaW9ucy5cclxuICAgICAgICB0aGlzLmZvcm0uX3BhcmVudGZvcm0uc3R5bGUud2lkdGggICAgICA9IG9zd2ViLnJ1bm5lci5fY2FudmFzLndpZHRoO1xyXG4gICAgICAgIHRoaXMuZm9ybS5fcGFyZW50Zm9ybS5zdHlsZS5oZWlnaHQgICAgID0gb3N3ZWIucnVubmVyLl9jYW52YXMuaGVpZ2h0O1xyXG4gICAgICAgIHRoaXMuZm9ybS5fcGFyZW50Zm9ybS5zdHlsZS5iYWNrZ3JvdW5kID0gdGhpcy5leHBlcmltZW50LnZhcnMuYmFja2dyb3VuZDtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIC8vIEhpZGUgdGhlIGNhbnZhcywgc2hvdyB0aGUgZm9ybS5cclxuICAgICAgICBvc3dlYi5ydW5uZXIuX2NhbnZhcy5zdHlsZS5kaXNwbGF5ICA9ICdub25lJztcclxuICAgICAgICB0aGlzLmZvcm0uX3BhcmVudGZvcm0uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICAgICAgdGhpcy5mb3JtLl9mb3JtLnN0eWxlLmRpc3BsYXkgICAgICAgPSAnYmxvY2snO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEhpZGUgdGhlIGZvcm1cclxuICAgICAgICB0aGlzLmZvcm0uX3BhcmVudGZvcm0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICB0aGlzLmZvcm0uX2Zvcm0uc3R5bGUuZGlzcGxheSAgICAgICA9ICdub25lJztcclxuICAgICAgICBvc3dlYi5ydW5uZXIuX2NhbnZhcy5zdHlsZS5kaXNwbGF5ICA9ICdpbmxpbmUnO1xyXG5cclxuICAgICAgICAvLyBmb3JtIGlzIGZpbmFsaXplZC5cclxuICAgICAgICB0aGlzLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFO1xyXG5cclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgICAgICB0aGlzLml0ZW1fY29tcGxldGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgZm9ybV9iYXNlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5mb3JtX2Jhc2UgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoZm9ybV9iYXNlLCBcIml0ZW1cIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBmb3JtX2NvbnNlbnQuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGZvcm1fY29uc2VudChwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuZm9ybV9iYXNlX2NvbnN0cnVjdG9yKHBOYW1lLCBwRXhwZXJpbWVudCwgcFNjcmlwdCwgJ2Zvcm1fY29uc2VudCcsICdBIHNpbXBsZSBjb25zZW50IGZvcm0nKTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhmb3JtX2NvbnNlbnQsIG9zd2ViLmZvcm1fYmFzZSk7XHJcblxyXG4gICAgLy8gRGVmaW5lIGFuZCBzZXQgdGhlIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZGVzY3JpcHRpb24gPSAnQSBzaW1wbGUgY29uc2VudCBmb3JtJztcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucnVuID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5mb3JtX2Jhc2VfcnVuKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuY29tcGxldGUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICBcdHRoaXMuZm9ybV9iYXNlX2NvbXBsZXRlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGZvcm1fY29uc2VudCBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuZm9ybV9jb25zZW50ID0gb3N3ZWIucHJvbW90ZUNsYXNzKGZvcm1fY29uc2VudCwgXCJmb3JtX2Jhc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBmb3JtX211bHRpcGxlX2Nob2ljZS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZm9ybV9tdWx0aXBsZV9jaG9pY2UocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLml0ZW1fY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhmb3JtX211bHRpcGxlX2Nob2ljZSwgb3N3ZWIuaXRlbSk7XHJcbiAgICBcclxuICAgIC8vIERlZmluZSBhbmQgc2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ0Egc2ltcGxlIG11bHRpcGxlIGNob2ljZSBpdGVtJztcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBmb3JtX2Jhc2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmZvcm1fbXVsdGlwbGVfY2hvaWNlID0gb3N3ZWIucHJvbW90ZUNsYXNzKGZvcm1fbXVsdGlwbGVfY2hvaWNlLCBcIml0ZW1cIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBmb3JtX3RleHRfZGlzcGxheS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZm9ybV90ZXh0X2Rpc3BsYXkocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLmZvcm1fYmFzZV9jb25zdHJ1Y3RvcihwTmFtZSwgcEV4cGVyaW1lbnQsIHBTY3JpcHQsICdmb3JtX3RleHRfZGlzcGxheScsICdBIHNpbXBsZSB0ZXh0IGRpc3BsYXkgZm9ybScpO1xyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGZvcm1fdGV4dF9kaXNwbGF5LCBvc3dlYi5mb3JtX2Jhc2UpO1xyXG5cclxuICAgIC8vIERlZmluZSBhbmQgc2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ0Egc2ltcGxlIHRleHQgZGlzcGxheSBmb3JtJztcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucnVuID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5mb3JtX2Jhc2VfcnVuKCk7XHJcbiAgICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG4gICAgXHR0aGlzLmZvcm1fYmFzZV9jb21wbGV0ZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBmb3JtX3RleHRfZGlzcGxheSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuZm9ybV90ZXh0X2Rpc3BsYXkgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoZm9ybV90ZXh0X2Rpc3BsYXksIFwiZm9ybV9iYXNlXCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgZm9ybV90ZXh0X2lucHV0LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBmb3JtX3RleHRfaW5wdXQocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLmZvcm1fYmFzZV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGZvcm1fdGV4dF9pbnB1dCwgb3N3ZWIuZm9ybV9iYXNlKTtcclxuXHJcbiAgICAvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdBIHNpbXBsZSB0ZXh0IGlucHV0IGZvcm0nO1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGZvcm1fYmFzZSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuZm9ybV90ZXh0X2lucHV0ID0gb3N3ZWIucHJvbW90ZUNsYXNzKGZvcm1fdGV4dF9pbnB1dCwgXCJmb3JtX2Jhc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBmb3JtX3RleHRfcmVuZGVyLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBmb3JtX3RleHRfcmVuZGVyKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5mb3JtX2Jhc2VfY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhmb3JtX3RleHRfcmVuZGVyLCBvc3dlYi5mb3JtX2Jhc2UpO1xyXG5cclxuICAgIC8vIERlZmluZSBhbmQgc2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ0Egc2ltcGxlIHRleHQgZGlzcGxheSBmb3JtJztcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBmb3JtX2Jhc2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmZvcm1fdGV4dF9yZW5kZXIgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoZm9ybV90ZXh0X3JlbmRlciwgXCJmb3JtX2Jhc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBtZWRpYV9wbGF5ZXJfdmxjLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBtZWRpYV9wbGF5ZXJfdmxjKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5nZW5lcmljX3Jlc3BvbnNlX2NvbnN0cnVjdG9yKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCk7XHJcbiAgICBcclxuICAgICAgICAvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHJpdmF0ZSBwcm9wZXJ0aWVzLiBcclxuICAgICAgICB0aGlzLl9zY3JpcHRfZXhlY3V0ZWQgPSBmYWxzZTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhtZWRpYV9wbGF5ZXJfdmxjLCBvc3dlYi5nZW5lcmljX3Jlc3BvbnNlKTtcclxuXHJcbiAgICAvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdBIHZpZGVvIHBsYXllcic7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMgLSBydW4gY3ljbGUuXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnByZXBhcmUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gT3BlbnMgdGhlIHZpZGVvIGZpbGUgZm9yIHBsYXliYWNrLlxyXG4gICAgICAgIHRoaXMuX3ZpZGVvICAgICAgICA9IG9zd2ViLnBvb2xbdGhpcy52YXJzLmdldCgndmlkZW9fc3JjJyldOyAgXHJcbiAgICAgICAgdGhpcy5fdmlkZW9fcGxheWVyID0gbmV3IG9zd2ViLnZpZGVvX2JhY2tlbmQodGhpcy5leHBlcmltZW50LCB0aGlzLl92aWRlbyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHRoZSBpbmxpbmUgY29kZSBvcHRpb25zLlxyXG4gICAgICAgIGlmICh0aGlzLnZhcnMuZXZlbnRfaGFuZGxlciAhPT0gJycpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl92aWRlb19wbGF5ZXIuX3NjcmlwdCA9IG9zd2ViLnBhcnNlci5fcHJlcGFyZSh0aGlzLnZhcnMuZXZlbnRfaGFuZGxlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3ZpZGVvX3BsYXllci5fZXZlbnRfaGFuZGxlcl9hbHdheXMgPSAodGhpcy52YXJzLmV2ZW50X2hhbmRsZXJfdHJpZ2dlciA9PSAnYWZ0ZXIgZXZlcnkgZnJhbWUnKTtcclxuXHRcdFxyXG4gICAgICAgIC8vIFNldCB0aGUgYXVkaW8gb3B0aW9uLlxyXG4gICAgICAgIHRoaXMuX3ZpZGVvX3BsYXllci5hdWRpbyA9ICh0aGlzLnZhcnMuZ2V0KCdwbGF5YXVkaW8nKSA9PSAneWVzJyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHRoZSBmdWxsIHNjcmVlbiBvcHRpb24gKGlmIGVuYWJsZWQpLlxyXG4gICAgICAgIHRoaXMuX3ZpZGVvX3BsYXllci5mdWxsX3NjcmVlbiA9ICh0aGlzLnZhcnMuZ2V0KCdyZXNpemVWaWRlbycpID09ICd5ZXMnKTtcclxuXHRcclxuICAgICAgXHQvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmdlbmVyaWNfcmVzcG9uc2VfcHJlcGFyZSgpO1xyXG4gICAgfTsgICAgXHJcbiAgICBcclxuICAgIHAucnVuID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIG9uc2V0IHRpbWUuXHJcbiAgICAgICAgdGhpcy5zZXRfaXRlbV9vbnNldCgpO1xyXG5cdHRoaXMuc2V0X3NyaSgpO1xyXG5cclxuICAgICAgICAvLyBTdGFydCB0aGUgdmlkZW8gcGxheWVyLlxyXG4gICAgICAgIHRoaXMuX3ZpZGVvX3BsYXllci5wbGF5KCk7ICAgIFxyXG5cclxuICAgICAgICAvLyBTdGFydCByZXNwb25zZSBwcm9jZXNzaW5nLlxyXG4gICAgICAgIHRoaXMucHJvY2Vzc19yZXNwb25zZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICBpZiAodGhpcy5fc2NyaXB0X2V4ZWN1dGVkID09IGZhbHNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gU3RvcCB0aGUgdmlkZW8gcGxheWluZy4gIFxyXG4gICAgICAgICAgICB0aGlzLl92aWRlb19wbGF5ZXIuc3RvcCgpO1xyXG5cdFxyXG4gICAgICAgICAgICAvLyBleGVjdXRlIHNjcmlwdC5cclxuICAgICAgICAgICAgaWYgKCh0aGlzLl92aWRlb19wbGF5ZXIuX3NjcmlwdCAhPT0gbnVsbCkgJiYgKHRoaXMudmFycy5nZXQoJ2V2ZW50X2hhbmRsZXJfdHJpZ2dlcicpID09ICdvbiBrZXlwcmVzcycpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGV4ZWN1dGUgdG9nZ2xlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2NyaXB0X2V4ZWN1dGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSBzY3JpcHQgY29kZS5cclxuICAgICAgICAgICAgICAgIG9zd2ViLnBhcnNlci5fcnVuKHRoaXMsIHRoaXMuX3ZpZGVvX3BsYXllci5fc2NyaXB0KTtcclxuICAgICAgICAgICAgfSAgIFxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHsgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJpY19yZXNwb25zZV9jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG4gICAgICAgICAgICB0aGlzLmdlbmVyaWNfcmVzcG9uc2VfY29tcGxldGUoKTtcclxuICAgICAgICB9OyAgICBcclxuICAgIH07ICAgIFxyXG5cclxuICAgIHAudXBkYXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgdmlkZW8gY2FudmFzLlxyXG4gICAgICAgIHRoaXMuX3ZpZGVvX3BsYXllci5fdXBkYXRlX3ZpZGVvX2NhbnZhcygpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQmluZCB0aGUgbWVkaWFfcGxheWVyX3ZsYyBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIubWVkaWFfcGxheWVyX3ZsYyA9IG9zd2ViLnByb21vdGVDbGFzcyhtZWRpYV9wbGF5ZXJfdmxjLCBcImdlbmVyaWNfcmVzcG9uc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBub3RlcGFkLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBub3RlcGFkKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5pdGVtX2NvbnN0cnVjdG9yKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCk7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3Mobm90ZXBhZCwgb3N3ZWIuaXRlbSk7XHJcblxyXG4gICAgLy8gRGVmaW5lIGFuZCBzZXQgdGhlIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZGVzY3JpcHRpb24gPSAnQSBzaW1wbGUgbm90ZXBhZCB0byBkb2N1bWVudCB5b3VyIGV4cGVyaW1lbnQuIFRoaXMgcGx1Zy1pbiBkb2VzIG5vdGhpbmcuJztcclxuICAgIHAubm90ZSAgICAgICAgPSAnJztcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucnVuID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5pdGVtX3J1bigpO1xyXG5cclxuXHQvLyBTaG93IHRoZSBpbmZvcm1hdGlvbiBvZiB0aGUgbm90ZXBhZCBvbiB0aGUgY29uc29sZS5cclxuXHQvL29zd2ViLmRlYnVnLmFkZE1lc3NhZ2UodGhpcy5ub3RlKTtcclxuXHJcbiAgICAgICAgLy8gQ29tcGxldGUgdGhlIGN1cnJlbnQgY3ljbGUuXHJcbiAgICAgICAgdGhpcy5jb21wbGV0ZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIHNlcXVlbmNlIGlzIGZpbmFsaXplZC5cclxuICAgICAgICB0aGlzLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFO1xyXG4gXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICAgICAgdGhpcy5pdGVtX2NvbXBsZXRlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIG5vdGVwYWQgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLm5vdGVwYWQgPSBvc3dlYi5wcm9tb3RlQ2xhc3Mobm90ZXBhZCwgXCJpdGVtXCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgcmVwZWF0X2N5Y2xlLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiByZXBlYXRfY3ljbGUocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG4gICAgXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5pdGVtX2NvbnN0cnVjdG9yKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCk7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MocmVwZWF0X2N5Y2xlLCBvc3dlYi5pdGVtKTtcclxuXHJcbiAgIC8vIERlZmluZSBhbmQgc2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ09wdGlvbmFsbHkgcmVwZWF0IGEgY3ljbGUgZnJvbSBhIGxvb3AnO1xyXG4gICAgXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBQcmVwYXJlIHRoZSBjb25kdGlvbiBmb3Igd2hpY2ggdGhlIHJlcGVhdF9jeWNsZSBtdXN0IGZpcmUuXHJcbiAgICAgICAgdGhpcy5fY29uZGl0aW9uID0gb3N3ZWIuc3ludGF4LmNvbXBpbGVfY29uZCh0aGlzLnZhcnMuZ2V0KCdjb25kaXRpb24nKSk7XHJcblxyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuaXRlbV9wcmVwYXJlKCk7XHJcbiAgICB9OyBcclxuXHJcbiAgICBwLnJ1biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5pdGVtX3J1bigpO1xyXG5cdFx0XHJcblx0Ly8gUnVuIGl0ZW0gb25seSBvbmUgdGltZS4gICBcclxuXHRpZiAodGhpcy5fc3RhdHVzICE9IG9zd2ViLmNvbnN0YW50cy5TVEFUVVNfRklOQUxJWkUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAob3N3ZWIucHl0aG9uX3dvcmtzcGFjZS5fZXZhbCh0aGlzLl9jb25kaXRpb24pID09IHRydWUpIFxyXG4gICAgICAgICAgICB7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQudmFycy5yZXBlYXRfY3ljbGUgPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBDb21wbGV0ZSB0aGUgY3VycmVudCBjeWNsZS5cclxuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcC5jb21wbGV0ZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBzZXF1ZW5jZSBpcyBmaW5hbGl6ZWQuXHJcbiAgICAgICAgdGhpcy5fc3RhdHVzID0gb3N3ZWIuY29uc3RhbnRzLlNUQVRVU19GSU5BTElaRTtcclxuIFxyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG4gICAgICAgIHRoaXMuaXRlbV9jb21wbGV0ZSgpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQmluZCB0aGUgcmVwZWF0X2N5Y2xlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5yZXBlYXRfY3ljbGUgPSBvc3dlYi5wcm9tb3RlQ2xhc3MocmVwZWF0X2N5Y2xlLCBcIml0ZW1cIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyByZXNldF9mZWVkYmFjay5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gcmVzZXRfZmVlZGJhY2socEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG4gICAgXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5pdGVtX2NvbnN0cnVjdG9yKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCk7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MocmVzZXRfZmVlZGJhY2ssIG9zd2ViLml0ZW0pO1xyXG5cclxuICAgIC8vIERlZmluZSBhbmQgc2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ1Jlc2V0cyB0aGUgZmVlZGJhY2sgdmFyaWFibGVzLCBzdWNoIGFzIFwiYXZnX3J0XCIgYW5kIFwiYWNjXCInO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBjbGFzcyBtZXRob2RzIC0gcnVuIGN5Y2xlLlxyXG4gICAgICovXHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICBcdC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuaXRlbV9ydW4oKTtcclxuXHRcdFxyXG5cdC8vIFJ1biBpdGVtIG9ubHkgb25lIHRpbWUuICAgXHJcblx0aWYgKHRoaXMuX3N0YXR1cyAhPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFKVxyXG5cdHtcclxuICAgICAgICAgICAgLy8gUnVuIHRoZSBpdGVtLlxyXG4gICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQucmVzZXRfZmVlZGJhY2soKTtcclxuXHJcbiAgICAgICAgICAgIC8vIENvbXBsZXRlIHRoZSBjdXJyZW50IGN5Y2xlLlxyXG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIHNlcXVlbmNlIGlzIGZpbmFsaXplZC5cclxuICAgICAgICB0aGlzLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFO1xyXG4gXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICAgICAgdGhpcy5pdGVtX2NvbXBsZXRlKCk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBCaW5kIHRoZSByZXNldF9mZWVkYmFjayBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIucmVzZXRfZmVlZGJhY2sgPSBvc3dlYi5wcm9tb3RlQ2xhc3MocmVzZXRfZmVlZGJhY2ssIFwiaXRlbVwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIHRvdWNoX3Jlc3BvbnNlLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiB0b3VjaF9yZXNwb25zZShwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMubW91c2VfcmVzcG9uc2VfY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyh0b3VjaF9yZXNwb25zZSwgb3N3ZWIubW91c2VfcmVzcG9uc2UpO1xyXG5cclxuICAgIC8vIERlZmluZSBhbmQgc2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ0EgZ3JpZC1iYXNlZCByZXNwb25zZSBpdGVtLCBjb252ZW5pZW50IGZvciB0b3VjaCBzY3JlZW5zJztcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLlxyXG4gICAgICovXHJcblx0XHJcbiAgICBwLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cclxuICAgICAgICB0aGlzLm1vdXNlX3Jlc3BvbnNlX3Jlc2V0KCk7XHJcbiAgICAgICAgdGhpcy52YXJzLnNldCgnYWxsb3dlZF9yZXNwb25zZXMnLG51bGwpO1xyXG5cdFxyXG4gICAgICAgIC8vIFJlc2V0cyBhbGwgaXRlbSB2YXJpYWJsZXMgdG8gdGhlaXIgZGVmYXVsdCB2YWx1ZS5cclxuICAgICAgICB0aGlzLnZhcnMuX25jb2wgPSAyO1xyXG5cdHRoaXMudmFycy5fbnJvdyA9IDE7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVuIGN5Y2xlLlxyXG4gICAgICovXHJcbiAgICBcclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBUZW1wIGhhY2tcclxuICAgICAgICB0aGlzLmV4cGVyaW1lbnQudmFycy5jb3JyZWN0ID0gLTE7XHJcbiAgIFxyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cclxuICAgICAgICB0aGlzLm1vdXNlX3Jlc3BvbnNlX3ByZXBhcmUoKTtcclxuICAgIH07XHJcbiAgICAgICAgXHJcbiAgICBwLnByb2Nlc3NfcmVzcG9uc2VfbW91c2VjbGljayA9IGZ1bmN0aW9uKHBSZXR2YWwpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gUHJvY2Vzc2VzIGEgbW91c2VjbGljayByZXNwb25zZS5cclxuXHR0aGlzLmV4cGVyaW1lbnQuX3N0YXJ0X3Jlc3BvbnNlX2ludGVydmFsID0gdGhpcy5zcmk7XHJcblx0dGhpcy5leHBlcmltZW50Ll9lbmRfcmVzcG9uc2VfaW50ZXJ2YWwgICA9IHBSZXR2YWwucnRUaW1lO1xyXG5cdHRoaXMuZXhwZXJpbWVudC52YXJzLnJlc3BvbnNlXHRcdCA9IHBSZXR2YWwucmVzcDtcclxuXHR0aGlzLnN5bm9ueW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gdGhpcy5fbW91c2Uuc3lub255bXModGhpcy5leHBlcmltZW50LnZhcnMucmVzcG9uc2UpO1xyXG5cdHRoaXMuZXhwZXJpbWVudC52YXJzLmN1cnNvcl94ICAgICAgICAgICAgPSBwUmV0dmFsLmV2ZW50LmNsaWVudFg7XHJcblx0dGhpcy5leHBlcmltZW50LnZhcnMuY3Vyc29yX3kgICAgICAgICAgICA9IHBSZXR2YWwuZXZlbnQuY2xpZW50WTtcclxuXHRcclxuICAgICAgICB2YXIgcmVjdCA9IG9zd2ViLnJ1bm5lci5fY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmV4cGVyaW1lbnQudmFycy51bmlmb3JtX2Nvb3JkaW5hdGVzID09ICd5ZXMnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5feCA9IHBSZXR2YWwuZXZlbnQuY2xpZW50WCArICh0aGlzLmV4cGVyaW1lbnQudmFycy53aWR0aCAvIDIpO1xyXG5cdCAgICB0aGlzLl95ID0gcFJldHZhbC5ldmVudC5jbGllbnRZICsgKHRoaXMuZXhwZXJpbWVudC52YXJzLmhlaWdodCAvIDIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl94ID0gcFJldHZhbC5ldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0O1xyXG5cdCAgICB0aGlzLl95ID0gcFJldHZhbC5ldmVudC5jbGllbnRZIC0gcmVjdC50b3A7XHJcbiAgICAgICAgfSAgICBcclxuICAgICAgICBcclxuICAgICAgICAvLyBDYWx1bGF0ZSB0aGUgcm93LCBjb2x1bW4gYW5kIGNlbGwuIFxyXG4gICAgICAgIHRoaXMuY29sICA9IE1hdGguZmxvb3IodGhpcy5feCAvICh0aGlzLmV4cGVyaW1lbnQudmFycy53aWR0aCAgLyB0aGlzLnZhcnMuX25jb2wpKTtcclxuXHR0aGlzLnJvdyAgPSBNYXRoLmZsb29yKHRoaXMuX3kgLyAodGhpcy5leHBlcmltZW50LnZhcnMuaGVpZ2h0IC8gdGhpcy52YXJzLl9ucm93KSk7XHJcblx0dGhpcy5jZWxsID0gdGhpcy5yb3cgKiB0aGlzLnZhcnMuX25jb2wgKyB0aGlzLmNvbCArIDE7XHJcbiAgICAgICAgdGhpcy5leHBlcmltZW50LnZhcnMucmVzcG9uc2UgPSB0aGlzLmNlbGw7XHJcbiAgICAgICAgdGhpcy5zeW5vbnltcyAgICAgICAgICAgICAgICAgPSBbU3RyaW5nKHRoaXMuZXhwZXJpbWVudC52YXJzLnJlc3BvbnNlKV07XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAvLyBEbyB0aGUgYm9va2tlZXBpbmcgXHJcbiAgICAgICAgdGhpcy5yZXNwb25zZV9ib29ra2VlcGluZygpO1xyXG4gICAgfTsgICAgICAgICAgICBcclxuXHJcbiAgICAvLyBCaW5kIHRoZSB0b3VjaF9yZXNwb25zZSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIudG91Y2hfcmVzcG9uc2UgPSBvc3dlYi5wcm9tb3RlQ2xhc3ModG91Y2hfcmVzcG9uc2UsIFwibW91c2VfcmVzcG9uc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBiYXNlX2VsZW1lbnQuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGJhc2VfZWxlbWVudChwU2tldGNocGFkLCBwU2NyaXB0LCBwRGVmYXVsdHMpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy5cdFx0XHJcblx0dGhpcy5jYW52YXMgICAgICAgICAgID0gcFNrZXRjaHBhZC5jYW52YXM7XHJcblx0dGhpcy5kZWZhdWx0cyAgICAgICAgID0gcERlZmF1bHRzO1xyXG5cdHRoaXMuZGVmYXVsdHMuc2hvd19pZiA9ICdhbHdheXMnO1xyXG5cdHRoaXMuZGVmYXVsdHMuel9pbmRleCA9IDA7XHJcbiAgICAgICAgdGhpcy5leHBlcmltZW50ICAgICAgID0gcFNrZXRjaHBhZC5leHBlcmltZW50O1xyXG5cdHRoaXMuZml4X2Nvb3JkaW5hdGVzICA9IChwU2tldGNocGFkLnZhcnMudW5pZm9ybV9jb29yZGluYXRlcyA9PSAneWVzJyk7XHJcblx0dGhpcy5uYW1lICAgICAgICAgICAgID0gcFNrZXRjaHBhZC5uYW1lO1xyXG5cdHRoaXMub25seV9rZXl3b3JkcyAgICA9IGZhbHNlO1xyXG5cdHRoaXMucG9vbCAgICAgICAgICAgICA9IHBTa2V0Y2hwYWQuZXhwZXJpbWVudC5wb29sO1xyXG5cdHRoaXMuc2tldGNocGFkICAgICAgICA9IHBTa2V0Y2hwYWQ7XHJcblx0dGhpcy5zeW50YXggICAgICAgICAgID0gcFNrZXRjaHBhZC5zeW50YXg7XHJcblx0dGhpcy52YXJzICAgICAgICAgICAgID0gcFNrZXRjaHBhZC52YXJzO1xyXG5cclxuICAgICAgICAvLyBTZXQgdGhlIHByaXZhdGUgcHJvcGVydGllcy5cdFx0XHJcbiAgICAgICAgdGhpcy5fcHJvcGVydGllcyAgICAgID0gbnVsbDsgICBcclxuXHJcbiAgICAgICAgLy8gUmVhZCB0aGUgZGVmaW5pdGlvbiBzdHJpbmcuXHJcblx0dGhpcy5mcm9tX3N0cmluZyhwU2NyaXB0KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBiYXNlX2VsZW1lbnQucHJvdG90eXBlO1xyXG5cclxuICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZWZhdWx0cyAgICAgICAgPSB7fTtcclxuICAgIHAuZml4X2Nvb3JkaW5hdGVzID0gdHJ1ZTtcclxuICAgIHAub25seV9rZXl3b3JkcyAgID0gZmFsc2U7XHJcbiAgICBwLnByb3BlcnRpZXMgICAgICA9IHt9O1xyXG4gICAgcC5za2V0Y2hwYWQgICAgICAgPSBudWxsO1x0XHJcbiAgICBwLnZhcnMgICAgICAgICAgICA9IG51bGw7XHJcblx0ICAgICAgICBcdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBidWlsZGluZyBjeWNsZS4gICAgICAgICBcclxuICAgICAqL1xyXG5cclxuICAgIHAuZnJvbV9zdHJpbmcgPSBmdW5jdGlvbihwU3RyaW5nKVxyXG4gICAge1xyXG5cdHZhciB0b2tlbnMgPSBvc3dlYi5zeW50YXgucGFyc2VfY21kKHBTdHJpbmcpO1xyXG5cdFxyXG5cdC8vIFNldCB0aGUgZGVmYXVsdCBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMucHJvcGVydGllcyA9IHt9O1xyXG5cdFx0XHRcclxuXHQvLyBTZXQgdGhlIGRlZmluZSBwcm9wZXJ0aWVzLlxyXG5cdGZvciAodmFyIGk9MDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKylcclxuXHR7XHJcbiAgICAgICAgICAgIHZhciBuYW1lICA9IHRva2Vuc1tpXS5zbGljZSgwLHRva2Vuc1tpXS5pbmRleE9mKCc9JykpO1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSB0b2tlbnNbaV0uc2xpY2UodG9rZW5zW2ldLmluZGV4T2YoJz0nKSArIDEsdG9rZW5zW2ldLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IG9zd2ViLnN5bnRheC5yZW1vdmVfcXVvdGVzKHZhbHVlKTtcclxuXHRcdFx0XHJcbiAgICAgICAgICAgIC8vIFNldCAoYW5kIG92ZXJ3cml0ZSkgdGhlIHByb3BlcnRpZXMuXHJcbiAgICAgICAgICAgIHRoaXMucHJvcGVydGllc1tuYW1lXSA9IHZhbHVlO1xyXG5cdH1cclxuICAgIH07XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW5uaW5nIGN5Y2xlLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC56X2luZGV4ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgXHQvLyAgRGV0ZXJtaW5lcyB0aGUgZHJhd2luZyBvcmRlciBvZiB0aGUgZWxlbWVudHMuIFxyXG4gICAgXHRyZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLnpfaW5kZXg7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZXZhbF9wcm9wZXJ0aWVzID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIEV2YWx1YXRlcyBhbGwgcHJvcGVydGllcyBhbmQgcmV0dXJuIHRoZW0uXHJcblx0dGhpcy5fcHJvcGVydGllcyA9IHt9O1xyXG5cdFx0XHJcblx0dmFyIHhjID0gdGhpcy5leHBlcmltZW50LnZhcnMud2lkdGggLyAyO1xyXG5cdHZhciB5YyA9IHRoaXMuZXhwZXJpbWVudC52YXJzLmhlaWdodCAvIDI7XHJcblxyXG4gICAgXHRmb3IgKHZhciBwcm9wZXJ0eSBpbiB0aGlzLnByb3BlcnRpZXMpIFxyXG5cdHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5za2V0Y2hwYWQuc3ludGF4LmV2YWxfdGV4dCh0aGlzLnByb3BlcnRpZXNbcHJvcGVydHldKTtcclxuICAgICAgICAgICAgLyogaWYgdmFyID09IHUndGV4dCc6XHJcblx0XHRcdHJvdW5kX2Zsb2F0ID0gVHJ1ZVxyXG4gICAgICAgICAgICAgICAgZWxzZTpcclxuXHRcdFx0cm91bmRfZmxvYXQgPSBGYWxzZVxyXG5cdFx0dmFsID0gc2VsZi5za2V0Y2hwYWQuc3ludGF4LmF1dG9fdHlwZShcclxuXHRcdFx0c2VsZi5za2V0Y2hwYWQuc3ludGF4LmV2YWxfdGV4dCh2YWwsIHJvdW5kX2Zsb2F0PXJvdW5kX2Zsb2F0KSlcclxuXHRcdGlmIHNlbGYuZml4X2Nvb3JkaW5hdGVzIGFuZCB0eXBlKHZhbCkgaW4gKGludCwgZmxvYXQpOiAqL1xyXG4gICAgICAgICAgICBpZiAoKHByb3BlcnR5ICA9PSAneCcpIHx8IChwcm9wZXJ0eSAgPT0gJ3gxJykgfHwgKHByb3BlcnR5ICA9PSAneDInKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICBcdHZhbHVlID0gTnVtYmVyKHZhbHVlKSArIHhjO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpZiAoKHByb3BlcnR5ICA9PSAneScpIHx8IChwcm9wZXJ0eSAgPT0gJ3kxJykgfHwgKHByb3BlcnR5ICA9PSAneTInKSlcclxuICAgICAgICAgICAge1xyXG5cdFx0dmFsdWUgPSBOdW1iZXIodmFsdWUpICsgeWM7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9wcm9wZXJ0aWVzW3Byb3BlcnR5XSA9IHZhbHVlOyBcclxuXHR9XHJcbiAgICB9O1x0XHRcclxuXHRcdFxyXG4gICAgcC5pc19zaG93biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIHNlbGYgb2YgdGhlIGN1cnJlbnQgd29ya3NwYWNlLlxyXG4gICAgICAgIHRoaXMuZXhwZXJpbWVudC5weXRob25fd29ya3NwYWNlWydzZWxmJ10gPSB0aGlzLnNrZXRjaHBhZDtcclxuICAgICAgICBcclxuICAgICAgICAvLyBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGVsZW1lbnQgc2hvdWxkIGJlIHNob3duLCBiYXNlZCBvbiB0aGUgc2hvdy1pZiBzdGF0ZW1lbnQuXHJcblx0cmV0dXJuIHRoaXMuZXhwZXJpbWVudC5weXRob25fd29ya3NwYWNlLl9ldmFsKHRoaXMuZXhwZXJpbWVudC5zeW50YXguY29tcGlsZV9jb25kKHRoaXMucHJvcGVydGllc1snc2hvd19pZiddKSk7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC5kcmF3ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZHluYW1pYyBwcm9wZXJ0aWVzLlxyXG4gICAgICAgIHRoaXMuZXZhbF9wcm9wZXJ0aWVzKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGJhc2VfZWxlbWVudCBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuYmFzZV9lbGVtZW50ID0gYmFzZV9lbGVtZW50O1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgYXJyb3cuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGFycm93KHBTa2V0Y2hwYWQsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBkZWZhdWx0IHByb3BlcnRpZXMuXHJcblx0dGhpcy5kZWZhdWx0c1x0XHQgICAgICAgID0ge307XHJcblx0dGhpcy5kZWZhdWx0cy5hcnJvd19ib2R5X2xlbmd0aCA9IDAuODtcclxuXHR0aGlzLmRlZmF1bHRzLmFycm93X2JvZHlfd2lkdGggID0gMC41O1xyXG5cdHRoaXMuZGVmYXVsdHMuYXJyb3dfaGVhZF93aWR0aCAgPSAzMDtcclxuXHR0aGlzLmRlZmF1bHRzLmZpbGwgICAgIFx0XHQ9IDE7XHJcblx0dGhpcy5kZWZhdWx0cy5jb2xvciAgICBcdFx0PSBwU2tldGNocGFkLnZhcnMuZ2V0KCdmb3JlZ3JvdW5kJyk7XHJcblx0dGhpcy5kZWZhdWx0cy5wZW53aWR0aCBcdFx0PSAxO1xyXG5cdHRoaXMuZGVmYXVsdHMueDEgICAgICAgXHRcdD0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLnkxICAgICAgIFx0XHQ9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy54MiAgICAgICAgICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy55MiAgICAgICBcdFx0PSBudWxsO1xyXG5cclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5iYXNlX2VsZW1lbnRfY29uc3RydWN0b3IocFNrZXRjaHBhZCwgcFNjcmlwdCwgdGhpcy5kZWZhdWx0cyk7XHJcbiAgICB9IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhhcnJvdywgb3N3ZWIuYmFzZV9lbGVtZW50KTtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHJ1biBjeWNsZS4gICBcclxuICAgICAqL1xyXG5cclxuICAgIHAuZHJhdyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmJhc2VfZWxlbWVudF9kcmF3KCk7XHJcblx0XHRcclxuXHQvLyBEcmF3IHRoZSBhcnJvdyBlbGVtZW50IHRvIHRoZSBjYW52YXMgb2YgdGhlIHNrZXRjaHBhZC5cclxuXHR0aGlzLnNrZXRjaHBhZC5jYW52YXMuYXJyb3codGhpcy5fcHJvcGVydGllcy54MSwgdGhpcy5fcHJvcGVydGllcy55MSwgdGhpcy5fcHJvcGVydGllcy54MiwgdGhpcy5fcHJvcGVydGllcy55MiwgdGhpcy5fcHJvcGVydGllcy5jb2xvciwgdGhpcy5fcHJvcGVydGllcy5wZW53aWR0aCwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnRpZXMuYXJyb3dfaGVhZF93aWR0aCwgdGhpcy5fcHJvcGVydGllcy5hcnJvd19ib2R5X3dpZHRoLCB0aGlzLl9wcm9wZXJ0aWVzLmFycm93X2JvZHlfbGVuZ3RoLCB0aGlzLl9wcm9wZXJ0aWVzLmZpbGwpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQmluZCB0aGUgQXJyb3cgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmFycm93ID0gb3N3ZWIucHJvbW90ZUNsYXNzKGFycm93LCBcImJhc2VfZWxlbWVudFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGNpcmNsZS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gY2lyY2xlKHBTa2V0Y2hwYWQsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBkZWZhdWx0IHByb3BlcnRpZXMuXHJcblx0dGhpcy5kZWZhdWx0cyAgICAgICAgICA9IHt9O1xyXG5cdHRoaXMuZGVmYXVsdHMuY29sb3IgICAgPSBwU2tldGNocGFkLnZhcnMuZ2V0KCdmb3JlZ3JvdW5kJyk7XHJcblx0dGhpcy5kZWZhdWx0cy5maWxsICAgICA9IDA7XHJcblx0dGhpcy5kZWZhdWx0cy5wZW53aWR0aCA9IDE7XHJcblx0dGhpcy5kZWZhdWx0cy54ICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy55ICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy5yICAgICAgICA9IG51bGw7XHJcblx0XHRcclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5iYXNlX2VsZW1lbnRfY29uc3RydWN0b3IocFNrZXRjaHBhZCwgcFNjcmlwdCwgdGhpcy5kZWZhdWx0cyk7XHJcbiAgICB9IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhjaXJjbGUsIG9zd2ViLmJhc2VfZWxlbWVudCk7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW4gY3ljbGUuICAgXHJcbiAgICAgKi9cclxuXHRcclxuICAgIHAuZHJhdyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmJhc2VfZWxlbWVudF9kcmF3KCk7XHJcblx0XHRcclxuXHQvLyBEcmF3IHRoZSBjaXJjbGUgZWxlbWVudCB0byB0aGUgY2FudmFzIG9mIHRoZSBza2V0Y2hwYWQuXHJcblx0dGhpcy5za2V0Y2hwYWQuY2FudmFzLmNpcmNsZSh0aGlzLl9wcm9wZXJ0aWVzLngsIHRoaXMuX3Byb3BlcnRpZXMueSwgdGhpcy5fcHJvcGVydGllcy5yLCB0aGlzLl9wcm9wZXJ0aWVzLmZpbGwsIHRoaXMuX3Byb3BlcnRpZXMuY29sb3IsIHRoaXMuX3Byb3BlcnRpZXMucGVud2lkdGgpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQmluZCB0aGUgQ2lyY2xlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5jaXJjbGUgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoY2lyY2xlLFwiYmFzZV9lbGVtZW50XCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgZWxsaXBzZS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZWxsaXBzZShwU2tldGNocGFkLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIFNldCB0aGUgZGVmYXVsdCBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuZGVmYXVsdHMgICAgICAgICAgPSB7fTtcclxuXHR0aGlzLmRlZmF1bHRzLmZpbGwgICAgID0gMTtcclxuXHR0aGlzLmRlZmF1bHRzLmNvbG9yICAgID0gcFNrZXRjaHBhZC52YXJzLmdldCgnZm9yZWdyb3VuZCcpO1xyXG5cdHRoaXMuZGVmYXVsdHMucGVud2lkdGggPSAxO1xyXG5cdHRoaXMuZGVmYXVsdHMueCAgICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMueSAgICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMudyAgICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMuaCAgICAgICAgPSBudWxsO1xyXG5cclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5iYXNlX2VsZW1lbnRfY29uc3RydWN0b3IocFNrZXRjaHBhZCwgcFNjcmlwdCwgdGhpcy5kZWZhdWx0cyk7XHJcbiAgICB9IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhlbGxpcHNlLCBvc3dlYi5iYXNlX2VsZW1lbnQpO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVuIGN5Y2xlLiAgIFxyXG4gICAgICovXHJcblx0XHJcbiAgICBwLmRyYXcgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5iYXNlX2VsZW1lbnRfZHJhdygpO1xyXG5cdFx0XHJcblx0Ly8gRHJhdyB0aGUgZWxsaXBzZSBlbGVtZW50IHRvIHRoZSBjYW52YXMgb2YgdGhlIHNrZXRjaHBhZC5cclxuICAgICAgICB0aGlzLnNrZXRjaHBhZC5jYW52YXMuZWxsaXBzZShOdW1iZXIodGhpcy5fcHJvcGVydGllcy54KSwgTnVtYmVyKHRoaXMuX3Byb3BlcnRpZXMueSksIE51bWJlcih0aGlzLl9wcm9wZXJ0aWVzLncpLCBOdW1iZXIodGhpcy5fcHJvcGVydGllcy5oKSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydGllcy5maWxsLCB0aGlzLl9wcm9wZXJ0aWVzLmNvbG9yLCB0aGlzLl9wcm9wZXJ0aWVzLnBlbndpZHRoKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIEJpbmQgdGhlIGVsbGlwc2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmVsbGlwc2UgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoZWxsaXBzZSxcImJhc2VfZWxlbWVudFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGZpeGRvdC5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZml4ZG90KHBTa2V0Y2hwYWQsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBkZWZhdWx0IHByb3BlcnRpZXMuXHJcblx0dGhpcy5kZWZhdWx0cyAgICAgICAgICA9IHt9O1xyXG5cdHRoaXMuZGVmYXVsdHMuY29sb3IgICAgPSBwU2tldGNocGFkLnZhcnMuZ2V0KCdmb3JlZ3JvdW5kJyk7XHJcblx0dGhpcy5kZWZhdWx0cy5zdHlsZSAgICA9ICdkZWZhdWx0JztcclxuXHR0aGlzLmRlZmF1bHRzLnggICAgICAgID0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLnkgICAgICAgID0gbnVsbDtcclxuXHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuYmFzZV9lbGVtZW50X2NvbnN0cnVjdG9yKHBTa2V0Y2hwYWQsIHBTY3JpcHQsIHRoaXMuZGVmYXVsdHMpO1xyXG4gICAgfSBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MoZml4ZG90LCBvc3dlYi5iYXNlX2VsZW1lbnQpO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVubmluZyBjeWNsZS4gICAgICAgICBcclxuICAgICAqL1xyXG5cdFxyXG4gICAgcC5kcmF3ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuYmFzZV9lbGVtZW50X2RyYXcoKTtcclxuXHRcdFxyXG5cdC8vIERyYXcgdGhlIGZpeGRvdCBlbGVtZW50IHRvIHRoZSBjYW52YXMgb2YgdGhlIHNrZXRjaHBhZC5cclxuXHR0aGlzLnNrZXRjaHBhZC5jYW52YXMuZml4ZG90KHRoaXMuX3Byb3BlcnRpZXMueCwgdGhpcy5fcHJvcGVydGllcy55LCB0aGlzLl9wcm9wZXJ0aWVzLmNvbG9yLCB0aGlzLl9wcm9wZXJ0aWVzLnN0eWxlKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIEJpbmQgdGhlIGZpeGRvdCBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuZml4ZG90ID0gb3N3ZWIucHJvbW90ZUNsYXNzKGZpeGRvdCxcImJhc2VfZWxlbWVudFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGdhYm9yLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBnYWJvcihwU2tldGNocGFkLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIFNldCB0aGUgZGVmYXVsdCBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuZGVmYXVsdHMgICAgICAgID0ge307XHJcblx0dGhpcy5kZWZhdWx0cy5iZ21vZGUgPSAnYXZnJztcclxuXHR0aGlzLmRlZmF1bHRzLmNvbG9yMSA9ICd3aGl0ZSc7XHJcblx0dGhpcy5kZWZhdWx0cy5jb2xvcjIgPSAnYmxhY2snO1xyXG5cdHRoaXMuZGVmYXVsdHMuZW52ICAgID0gJ2dhdXNzaWFuJztcclxuXHR0aGlzLmRlZmF1bHRzLmZyZXEgICA9IDE7XHJcblx0dGhpcy5kZWZhdWx0cy5vcmllbnQgPSAwO1xyXG5cdHRoaXMuZGVmYXVsdHMucGhhc2UgID0gMDtcclxuXHR0aGlzLmRlZmF1bHRzLnNpemUgICA9IDk2O1xyXG5cdHRoaXMuZGVmYXVsdHMuc3RkZXYgID0gMTI7XHJcblx0dGhpcy5kZWZhdWx0cy54ICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMueSAgICAgID0gbnVsbDtcclxuXHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuYmFzZV9lbGVtZW50X2NvbnN0cnVjdG9yKHBTa2V0Y2hwYWQsIHBTY3JpcHQsIHRoaXMuZGVmYXVsdHMpO1xyXG4gICAgfSBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MoZ2Fib3IsIG9zd2ViLmJhc2VfZWxlbWVudCk7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgKHJ1biBjeWNsZSkuICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLmRyYXcgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICBcdHRoaXMuYmFzZV9lbGVtZW50X2RyYXcoKTtcclxuXHRcdFxyXG5cdC8vIERyYXcgdGhlIGdhYm9yIGVsZW1lbnQgdG8gdGhlIGNhbnZhcyBvZiB0aGUgc2tldGNocGFkLlxyXG5cdHRoaXMuc2tldGNocGFkLmNhbnZhcy5nYWJvcih0aGlzLl9wcm9wZXJ0aWVzLngsIHRoaXMuX3Byb3BlcnRpZXMueSwgdGhpcy5fcHJvcGVydGllcy5vcmllbnQsIHRoaXMuX3Byb3BlcnRpZXMuZnJlcSwgdGhpcy5fcHJvcGVydGllcy5lbnYsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9wZXJ0aWVzLnNpemUsIHRoaXMuX3Byb3BlcnRpZXMuc3RkZXYsIHRoaXMuX3Byb3BlcnRpZXMucGhhc2UsIHRoaXMuX3Byb3BlcnRpZXMuY29sb3IxLCB0aGlzLl9wcm9wZXJ0aWVzLmNvbG9yMiwgdGhpcy5fcHJvcGVydGllcy5iZ21vZGUpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQmluZCB0aGUgZ2Fib3IgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmdhYm9yID0gb3N3ZWIucHJvbW90ZUNsYXNzKGdhYm9yLFwiYmFzZV9lbGVtZW50XCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgaW1hZ2UuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGltYWdlKHBTa2V0Y2hwYWQsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBjbGFzcyBwdWJsaWMgcHJvcGVydGllcy5cclxuXHR0aGlzLmRlZmF1bHRzXHQgICAgID0ge307XHJcblx0dGhpcy5kZWZhdWx0cy5jZW50ZXIgPSAxO1xyXG5cdHRoaXMuZGVmYXVsdHMuZmlsZSAgID0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLnNjYWxlICA9IDE7XHJcblx0dGhpcy5kZWZhdWx0cy54ICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMueSAgICAgID0gbnVsbDtcclxuXHJcblx0Ly8gU2V0IHRoZSBjbGFzcyBwcml2YXRlIHByb3BlcnRpZXMuIFxyXG5cdHRoaXMuX2ZpbGUgICAgICAgICAgID0gbnVsbDtcclxuXHRcdFxyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLmJhc2VfZWxlbWVudF9jb25zdHJ1Y3RvcihwU2tldGNocGFkLCBwU2NyaXB0LCB0aGlzLmRlZmF1bHRzKTtcclxuICAgIH0gXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGltYWdlLCBvc3dlYi5iYXNlX2VsZW1lbnQpO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVuIGN5Y2xlLiAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5kcmF3ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuYmFzZV9lbGVtZW50X2RyYXcoKTtcclxuXHJcbiAgICBcdC8vIFJldHJpZXZlIHRoZSBjb250ZW50IGZyb20gdGhlIGZpbGUgcG9vbC5cclxuXHR0aGlzLl9maWxlID0gb3N3ZWIucG9vbFt0aGlzLl9wcm9wZXJ0aWVzWydmaWxlJ11dOyAgXHJcblxyXG5cdC8vIERyYXcgdGhlIGltYWdlIGVsZW1lbnQgdG8gdGhlIGNhbnZhcyBvZiB0aGUgc2tldGNocGFkLlxyXG5cdHRoaXMuc2tldGNocGFkLmNhbnZhcy5pbWFnZSh0aGlzLl9maWxlLCB0aGlzLl9wcm9wZXJ0aWVzLmNlbnRlciwgdGhpcy5fcHJvcGVydGllcy54LCB0aGlzLl9wcm9wZXJ0aWVzLnksIHRoaXMuX3Byb3BlcnRpZXMuc2NhbGUpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQmluZCB0aGUgaW1hZ2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmltYWdlID0gb3N3ZWIucHJvbW90ZUNsYXNzKGltYWdlLCBcImJhc2VfZWxlbWVudFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGxpbmUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGxpbmUocFNrZXRjaHBhZCwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBTZXQgdGhlIGRlZmF1bHQgcHJvcGVydGllcy5cclxuXHR0aGlzLmRlZmF1bHRzICAgICAgICAgID0ge307XHJcblx0dGhpcy5kZWZhdWx0cy5jb2xvciAgICA9IHBTa2V0Y2hwYWQudmFycy5nZXQoJ2ZvcmVncm91bmQnKTtcclxuXHR0aGlzLmRlZmF1bHRzLnBlbndpZHRoID0gMTtcclxuXHR0aGlzLmRlZmF1bHRzLngxICAgICAgID0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLnkxICAgICAgID0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLngyICAgICAgID0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLnkyICAgICAgID0gbnVsbDtcclxuXHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuYmFzZV9lbGVtZW50X2NvbnN0cnVjdG9yKHBTa2V0Y2hwYWQsIHBTY3JpcHQsIHRoaXMuZGVmYXVsdHMpO1xyXG4gICAgfSBcclxuXHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGxpbmUsIG9zd2ViLmJhc2VfZWxlbWVudCk7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW4gY3ljbGUuICAgXHJcbiAgICAgKi9cclxuXHRcclxuICAgIHAuZHJhdyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmJhc2VfZWxlbWVudF9kcmF3KCk7XHJcblx0XHRcclxuXHQvLyBEcmF3IHRoZSBsaW5lIGVsZW1lbnQgdG8gdGhlIGNhbnZhcyBvZiB0aGUgc2tldGNocGFkLlxyXG5cdHRoaXMuc2tldGNocGFkLmNhbnZhcy5saW5lKHRoaXMuX3Byb3BlcnRpZXMueDEsIHRoaXMuX3Byb3BlcnRpZXMueTEsIHRoaXMuX3Byb3BlcnRpZXMueDIsIHRoaXMuX3Byb3BlcnRpZXMueTIsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnRpZXMuY29sb3IsIHRoaXMuX3Byb3BlcnRpZXMucGVud2lkdGgpO1xyXG4gICAgfTtcclxuICAgICAgICBcclxuICAgIC8vIEJpbmQgdGhlIGxpbmUgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmxpbmUgPSBvc3dlYi5wcm9tb3RlQ2xhc3MobGluZSxcImJhc2VfZWxlbWVudFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIG5vaXNlLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBub2lzZShwU2tldGNocGFkLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIFNldCB0aGUgZGVmYXVsdCBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuZGVmYXVsdHNcdCAgICAgPSB7fTtcclxuXHR0aGlzLmRlZmF1bHRzLmNvbG9yMSA9ICd3aGl0ZSc7XHJcblx0dGhpcy5kZWZhdWx0cy5jb2xvcjIgPSAnYmxhY2snO1xyXG5cdHRoaXMuZGVmYXVsdHMuZW52ICAgID0gJ2dhdXNzaWFuJztcclxuXHR0aGlzLmRlZmF1bHRzLnNpemUgICA9IDk2O1xyXG5cdHRoaXMuZGVmYXVsdHMuc3RkZXYgID0gMTI7XHJcblx0dGhpcy5kZWZhdWx0cy54ICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMueSAgICAgID0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLmJnbW9kZSA9ICdhdmcnO1xyXG5cclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5iYXNlX2VsZW1lbnRfY29uc3RydWN0b3IocFNrZXRjaHBhZCwgcFNjcmlwdCwgdGhpcy5kZWZhdWx0cyk7XHJcbiAgICB9IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhub2lzZSwgb3N3ZWIuYmFzZV9lbGVtZW50KTtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAocnVuIGN5Y2xlKS4gICBcclxuICAgICAqL1xyXG5cclxuICAgIHAuZHJhdyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5iYXNlX2VsZW1lbnRfZHJhdygpO1xyXG5cdFx0XHJcblx0Ly8gRHJhdyB0aGUgbm9pc2UgZWxlbWVudCB0byB0aGUgY2FudmFzIG9mIHRoZSBza2V0Y2hwYWQuXHJcblx0dGhpcy5za2V0Y2hwYWQuY2FudmFzLm5vaXNlKHRoaXMuX3Byb3BlcnRpZXMueCwgdGhpcy5fcHJvcGVydGllcy55LCB0aGlzLl9wcm9wZXJ0aWVzLmVudiwgdGhpcy5fcHJvcGVydGllcy5zaXplLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydGllcy5zdGRldiwgdGhpcy5fcHJvcGVydGllcy5jb2xvcjEsIHRoaXMuX3Byb3BlcnRpZXMuY29sb3IyLCB0aGlzLl9wcm9wZXJ0aWVzLmJnbW9kZSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBCaW5kIHRoZSBub2lzZSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIubm9pc2UgPSBvc3dlYi5wcm9tb3RlQ2xhc3Mobm9pc2UsXCJiYXNlX2VsZW1lbnRcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyByZWN0LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiByZWN0KHBTa2V0Y2hwYWQsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBkZWZhdWx0IHByb3BlcnRpZXMuXHJcblx0dGhpcy5kZWZhdWx0cyAgICAgICAgICA9IHt9O1xyXG5cdHRoaXMuZGVmYXVsdHMuZmlsbCAgICAgPSAxO1xyXG5cdHRoaXMuZGVmYXVsdHMuY29sb3IgICAgPSBwU2tldGNocGFkLnZhcnMuZ2V0KCdmb3JlZ3JvdW5kJyk7XHJcblx0dGhpcy5kZWZhdWx0cy5wZW53aWR0aCA9IDE7XHJcblx0dGhpcy5kZWZhdWx0cy54ICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy55ICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy53ICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy5oICAgICAgICA9IG51bGw7XHJcblxyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLmJhc2VfZWxlbWVudF9jb25zdHJ1Y3RvcihwU2tldGNocGFkLCBwU2NyaXB0LCB0aGlzLmRlZmF1bHRzKTtcclxuICAgIH0gXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKHJlY3QsIG9zd2ViLmJhc2VfZWxlbWVudCk7XHJcblx0XHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHJ1biBjeWNsZS4gICBcclxuICAgICAqL1xyXG5cclxuICAgIHAuZHJhdyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5iYXNlX2VsZW1lbnRfZHJhdygpO1xyXG5cdFx0XHJcblx0Ly8gRHJhdyB0aGUgcmVjdGFuZ2xlIGVsZW1lbnQgdG8gdGhlIGNhbnZhcyBvZiB0aGUgc2tldGNocGFkLlxyXG5cdHRoaXMuc2tldGNocGFkLmNhbnZhcy5yZWN0KHRoaXMuX3Byb3BlcnRpZXMueCwgdGhpcy5fcHJvcGVydGllcy55LCB0aGlzLl9wcm9wZXJ0aWVzLncsIHRoaXMuX3Byb3BlcnRpZXMuaCwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydGllcy5maWxsLCB0aGlzLl9wcm9wZXJ0aWVzLmNvbG9yLCB0aGlzLl9wcm9wZXJ0aWVzLnBlbndpZHRoKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIEJpbmQgdGhlIFJlY3QgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnJlY3QgPSBvc3dlYi5wcm9tb3RlQ2xhc3MocmVjdCxcImJhc2VfZWxlbWVudFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIHRleHRsaW5lLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiB0ZXh0bGluZShwU2tldGNocGFkLCBwU2NyaXB0KVxyXG4gICAge1xyXG4gICAgICAgIC8vIFNldCB0aGUgZGVmYXVsdCBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuZGVmYXVsdHMgICAgICAgICAgICAgPSB7fTtcclxuXHR0aGlzLmRlZmF1bHRzLmNlbnRlciAgICAgID0gMTtcclxuXHR0aGlzLmRlZmF1bHRzLmNvbG9yICAgICAgID0gcFNrZXRjaHBhZC52YXJzLmdldCgnZm9yZWdyb3VuZCcpO1xyXG5cdHRoaXMuZGVmYXVsdHMuZm9udF9mYW1pbHkgPSBwU2tldGNocGFkLnZhcnMuZ2V0KCdmb250X2ZhbWlseScpO1xyXG5cdHRoaXMuZGVmYXVsdHMuZm9udF9zaXplICAgPSBwU2tldGNocGFkLnZhcnMuZ2V0KCdmb250X3NpemUnKTtcclxuXHR0aGlzLmRlZmF1bHRzLmZvbnRfYm9sZCAgID0gcFNrZXRjaHBhZC52YXJzLmdldCgnZm9udF9ib2xkJyk7XHJcblx0dGhpcy5kZWZhdWx0cy5mb250X2l0YWxpYyA9IHBTa2V0Y2hwYWQudmFycy5nZXQoJ2ZvbnRfaXRhbGljJyk7XHJcblx0dGhpcy5kZWZhdWx0cy5odG1sICAgICAgICA9ICd5ZXMnO1xyXG5cdHRoaXMuZGVmYXVsdHMudGV4dCAgICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMueCAgICAgICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMueSAgICAgICAgICAgPSBudWxsO1xyXG5cclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5iYXNlX2VsZW1lbnRfY29uc3RydWN0b3IocFNrZXRjaHBhZCwgcFNjcmlwdCwgdGhpcy5kZWZhdWx0cyk7XHJcbiAgICB9IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyh0ZXh0bGluZSwgb3N3ZWIuYmFzZV9lbGVtZW50KTtcclxuXHRcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVubmluZyBjeWNsZS4gICAgICAgICBcclxuICAgICAqL1xyXG5cclxuICAgIHAuZHJhdyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5iYXNlX2VsZW1lbnRfZHJhdygpO1xyXG5cdFx0XHJcbiAgICBcdC8vIFNldCB0aGUgZm9udCBzdHlsZSBhbmQgZHJhdyB0aGUgdGV4dCBlbGVtZW50IHRvIHRoZSBjYW52YXMgb2YgdGhlIHNrZXRjaHBhZC5cclxuXHR0aGlzLnNrZXRjaHBhZC5jYW52YXMuc2V0X2ZvbnQodGhpcy5fcHJvcGVydGllcy5mb250X2ZhbWlseSwgdGhpcy5fcHJvcGVydGllcy5mb250X3NpemUsIHRoaXMuX3Byb3BlcnRpZXMuZm9udF9pdGFsaWMgPT0gJ3llcycsIHRoaXMuX3Byb3BlcnRpZXMuZm9udF9ib2xkID09ICd5ZXMnLCB0aGlzLl9wcm9wZXJ0aWVzLmZvbnRfdW5kZXJsaW5lID09ICd5ZXMnKTtcdFx0XHJcbiAgICAgICAgdGhpcy5za2V0Y2hwYWQuY2FudmFzLnRleHQodGhpcy5fcHJvcGVydGllcy50ZXh0LCB0aGlzLl9wcm9wZXJ0aWVzLmNlbnRlciwgdGhpcy5fcHJvcGVydGllcy54LCB0aGlzLl9wcm9wZXJ0aWVzLnksIHRoaXMuX3Byb3BlcnRpZXMuY29sb3IsIHRoaXMuX3Byb3BlcnRpZXMuaHRtbCk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBCaW5kIHRoZSBUZXh0IGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi50ZXh0bGluZSA9IG9zd2ViLnByb21vdGVDbGFzcyh0ZXh0bGluZSwgXCJiYXNlX2VsZW1lbnRcIik7XHJcbn0oKSk7XHJcbiIsIlx0XHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGZvcm0uXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGZvcm0ocEV4cGVyaW1lbnQsIHBDb2xzLCBwUm93cywgcFNwYWNpbmcsIHBNYXJnaW5zLCBwVGhlbWUsIHBJdGVtLCBwVGltZW91dCwgcENsaWNrcylcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHB1YmxpYyBwcm9wZXJ0aWVzLlxyXG4gICAgICAgIHRoaXMuY2xpY2tzICAgICA9IHBDbGlja3M7XHJcblx0dGhpcy5leHBlcmltZW50ID0gcEV4cGVyaW1lbnQ7XHJcblx0dGhpcy5oZWlnaHQgICAgID0gdGhpcy5leHBlcmltZW50LnZhcnMuaGVpZ2h0O1xyXG5cdHRoaXMuaXRlbSAgICAgICA9IChwSXRlbSAhPSBudWxsKSA/IHBJdGVtIDogcEV4cGVyaW1lbnQ7XHJcblx0dGhpcy5tYXJnaW5zICAgID0gcE1hcmdpbnM7XHJcbiAgICAgICAgdGhpcy5zcGFjaW5nICAgID0gcFNwYWNpbmc7XHJcblx0dGhpcy5zcGFuICAgICAgID0gW107XHJcbiAgICAgICAgdGhpcy50aW1lb3V0ICAgID0gcFRpbWVvdXQ7XHJcblx0dGhpcy53aWRnZXRzICAgID0gW107IFxyXG4gICAgICAgIHRoaXMud2lkdGggICAgICA9IHRoaXMuZXhwZXJpbWVudC52YXJzLndpZHRoO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMgLSBjb2x1bW5zIGFuZCByb3dzLlxyXG4gICAgICAgIHZhciBjb2xTaXplID0gMDtcclxuICAgICAgICBmb3IgKHZhciBpPTA7aSA8IHBDb2xzLmxlbmd0aDtpKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjb2xTaXplID0gY29sU2l6ZSArIE51bWJlcihwQ29sc1tpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29scyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGk9MDtpIDwgcENvbHMubGVuZ3RoO2krKylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuY29scy5wdXNoKE1hdGgucm91bmQoKHBDb2xzW2ldIC8gY29sU2l6ZSkgKiAxMDApKTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgICAgIHZhciByb3dTaXplID0gMDtcclxuICAgICAgICBmb3IgKHZhciBpPTA7aSA8IHBSb3dzLmxlbmd0aDtpKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByb3dTaXplID0gcm93U2l6ZSArIE51bWJlcihwUm93c1tpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucm93cyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGk9MDtpIDwgcFJvd3MubGVuZ3RoO2krKylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMucm93cy5wdXNoKE1hdGgucm91bmQoKHBSb3dzW2ldIC8gcm93U2l6ZSkgKiAxMDApKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHJpdmF0ZSBwcm9wZXJ0aWVzLlxyXG4gICAgICAgIHRoaXMuX3BhcmVudGZvcm0gICAgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvc3dlYl9mb3JtJyk7XHJcbiAgICAgICAgdGhpcy5fZm9ybSAgICAgICAgICAgICAgID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIkRJVlwiKTtcclxuICAgICAgICB0aGlzLl9mb3JtLnN0eWxlLmhlaWdodCAgPSAnMTAwJSc7XHJcbiAgICAgICAgdGhpcy5fZm9ybS5zdHlsZS53aWR0aCAgID0gJzEwMCUnO1xyXG4gICAgICAgIHRoaXMuX2Zvcm0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICBcclxuICAgICAgICAvLyBTZXQgdGhlIHRhYmxlIHByb3BlcnRpZXMgYW5kIGNvbnRlbnQuXHJcbiAgICAgICAgdGhpcy5fdGFibGUgICAgICAgICAgICAgICAgICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJUQUJMRVwiKTtcclxuICAgICAgICB0aGlzLl90YWJsZS5zdHlsZS5wYWRkaW5nICAgID0gdGhpcy5tYXJnaW5zWzBdICsgJ3B4ICcgKyB0aGlzLm1hcmdpbnNbMV0gKyAncHggJyArIHRoaXMubWFyZ2luc1syXSArICdweCAnICsgdGhpcy5tYXJnaW5zWzNdICsgJ3B4JztcclxuICAgICAgICB0aGlzLl90YWJsZS5zdHlsZS5oZWlnaHQgICAgID0gJzEwMCUnO1xyXG4gICAgICAgIHRoaXMuX3RhYmxlLnN0eWxlLndpZHRoICAgICAgPSAnMTAwJSc7XHJcbiAgICAgICAgdGhpcy5fdGFibGUuc3R5bGUuZm9udFN0eWxlICA9IHRoaXMuZXhwZXJpbWVudC52YXJzLmZvbnRfaXRhbGljID09ICd5ZXMnID8gJ2l0YWxpYycgOiAnbm9ybWFsJzsgXHJcbiAgICAgICAgdGhpcy5fdGFibGUuc3R5bGUuZm9udFdlaWdodCA9IHRoaXMuZXhwZXJpbWVudC52YXJzLmZvbnRfYm9sZCAgID09ICd5ZXMnID8gJ2JvbGQnICAgOiAnbm9ybWFsJzsgXHJcbiAgICAgICAgdGhpcy5fdGFibGUuc3R5bGUuZm9udEZhbWlseSA9IHRoaXMuZXhwZXJpbWVudC52YXJzLmZvbnRfZmFtaWx5O1xyXG4gICAgICAgIHRoaXMuX3RhYmxlLnN0eWxlLmNvbG9yICAgICAgPSB0aGlzLmV4cGVyaW1lbnQudmFycy5mb3JlZ3JvdW5kO1xyXG4gICAgICAgIHRoaXMuX3RhYmxlLnN0eWxlLmZvbnRTaXplICAgPSB0aGlzLmV4cGVyaW1lbnQudmFycy5mb250X3NpemUgKyAncHgnO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZvciAodmFyIGk9MDtpIDwgdGhpcy5yb3dzLmxlbmd0aDtpKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvLyBJbnNlcnQgdGhlIHJvdyBpbnRvIHRoZSB0YWJsZS5cclxuICAgICAgICAgICAgdmFyIHJvdyAgICAgICAgICA9IHRoaXMuX3RhYmxlLmluc2VydFJvdygpO1xyXG4gICAgICAgICAgICByb3cuc3R5bGUuaGVpZ2h0ID0gdGhpcy5yb3dzW2ldICsgJyUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gSW5zZXIgdGhlIGNlbGxzLlxyXG4gICAgICAgICAgICBmb3IgKHZhciBqPTA7aiA8IHRoaXMuY29scy5sZW5ndGg7aisrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IHJvdy5pbnNlcnRDZWxsKGopO1xyXG4gICAgICAgICAgICAgICAgY2VsbC5zdHlsZS53aWR0aCAgID0gdGhpcy5jb2xzW2pdICsgJyUnO1xyXG4gICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5wYWRkaW5nID0gJzVweCc7XHJcbiAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgfSAgICAgICAgXHJcblxyXG4gICAgICAgIC8vIEFwcGVuZCB0aGUgdGFibGUgdG8gdGhlIGZvcm0uXHJcbiAgICAgICAgdGhpcy5fcGFyZW50Zm9ybS5hcHBlbmRDaGlsZCh0aGlzLl9mb3JtKTtcclxuICAgICAgICB0aGlzLl9mb3JtLmFwcGVuZENoaWxkKHRoaXMuX3RhYmxlKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBEeW5hbWljYWxseSBsb2FkIHRoZSB0aGVtZSBvYmplY3RcclxuXHQvKiB0aGVtZV9tb2QgPSBfX2ltcG9ydF9fKHUnbGlib3BlbnNlc2FtZS53aWRnZXRzLnRoZW1lcy4lcycgJSB0aGVtZSwgZnJvbWxpc3Q9W3UnZHVtbXknXSlcclxuXHR0aGVtZV9jbHMgPSBnZXRhdHRyKHRoZW1lX21vZCwgdGhlbWUpXHJcblx0c2VsZi50aGVtZV9lbmdpbmUgPSB0aGVtZV9jbHMoc2VsZikgKi9cclxuICAgIH0gXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IGZvcm0ucHJvdG90eXBlO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5jbGlja3MgICAgID0gbnVsbDtcclxuICAgIHAuZXhwZXJpbWVudCA9IG51bGw7XHJcbiAgICBwLmhlaWdodCAgICAgPSAtMTtcclxuICAgIHAuaXRlbSAgICAgICA9IG51bGw7XHJcbiAgICBwLnNwYWNpbmcgICAgPSBudWxsO1xyXG4gICAgcC50aW1lb3V0ICAgID0gLTE7XHJcbiAgICBwLndpZHRoICAgICAgPSAtMTtcclxuICAgIFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBnZW5lcmFsIGZ1bmN0aW9uLlxyXG4gICAgICovXHJcblxyXG4gICAgcC5fZXhlYyA9IGZ1bmN0aW9uKHBGb2N1c193aWRnZXQpXHJcbiAgICB7XHJcbiAgICB9OyAgIFxyXG5cclxuICAgIHAudGltZWRfb3V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNlbGxfaW5kZXggPSBmdW5jdGlvbihwUG9zKVxyXG4gICAge1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnZhbGlkYXRlX2dlb21ldHJ5ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmdldF9jZWxsID0gZnVuY3Rpb24ocEluZGV4KVxyXG4gICAge1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcC5nZXRfcmVjdCA9IGZ1bmN0aW9uKHBJbmRleClcclxuICAgIHtcclxuICAgIH07XHJcblxyXG4gICAgcC5yZW5kZXIgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0dGhpcy52YWxpZGF0ZV9nZW9tZXRyeSgpO1xyXG5cdHRoaXMuY2FudmFzLmNsZWFyKCk7XHJcblx0Zm9yICh2YXIgd2lkZ2V0IGluIHRoaXMud2lkZ2V0cylcclxuXHR7XHJcbiAgICAgICAgICAgIGlmICh3aWRnZXQgIT09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdpZGdldC5yZW5kZXIoKTtcclxuICAgICAgICAgICAgfSAgICBcclxuICAgICAgICB9XHRcdFxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuY2FudmFzLnNob3coKTtcclxuICAgIH07ICAgIFxyXG5cclxuICAgIHAuc2V0X3dpZGdldCA9IGZ1bmN0aW9uKHBXaWRnZXQsIHBQb3MsIHBDb2xzcGFuLCBwUm93c3BhbilcclxuICAgIHtcclxuICAgICAgICAvLyBHZXQgdGhlIHJvdyBwb3N0aXRpb24gb2YgdGhlIHdpZGdldC5cclxuICAgICAgICB2YXIgcm93ICA9IHRoaXMuX3RhYmxlLnJvd3NbTnVtYmVyKHBQb3NbMV0pXTtcclxuICAgICAgICB2YXIgY2VsbCA9IHJvdy5jZWxsc1tOdW1iZXIocFBvc1swXSldOyBcclxuICAgICAgICBpZiAoTnVtYmVyKHBDb2xzcGFuKSA+IDEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjZWxsLmNvbFNwYW4gPSBOdW1iZXIocENvbHNwYW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoTnVtYmVyKHBSb3dzcGFuKSA+IDEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjZWxsLnJvd1NwYW4gPSBOdW1iZXIocFJvd3NwYW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvLyBBcHBlbmQgd2lkZ2V0IHRvIHRoZSBjZWxsLlxyXG4gICAgICAgIGNlbGwuYXBwZW5kQ2hpbGQocFdpZGdldC5fZWxlbWVudCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLyogdmFyIGluZGV4ID0gdGhpcy5jZWxsX2luZGV4KG5Qb3M7KVxyXG5cdGlmIChpbmRleCA+PSBsZW4odGhpcy53aWRnZXRzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gcmFpc2Ugb3NleGNlcHRpb24odSdXaWRnZXQgcG9zaXRpb24gKCVzLCAlcykgaXMgb3V0c2lkZSBvZiB0aGUgZm9ybScgJSBwb3MpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIHR5cGUoY29sc3BhbikgIT0gaW50IG9yIGNvbHNwYW4gPCAxIG9yIGNvbHNwYW4gPiBsZW4oc2VsZi5jb2xzKTpcclxuXHRcdFx0cmFpc2Ugb3NleGNlcHRpb24oIFxcXHJcblx0XHRcdFx0dSdDb2x1bW4gc3BhbiAlcyBpcyBpbnZhbGlkIChpLmUuIHRvbyBsYXJnZSwgdG9vIHNtYWxsLCBvciBub3QgYSBudW1iZXIpJyBcXFxyXG5cdFx0XHRcdCUgY29sc3BhbilcclxuXHRcdGlmIHR5cGUocm93c3BhbikgIT0gaW50IG9yIHJvd3NwYW4gPCAxIG9yIHJvd3NwYW4gPiBsZW4oc2VsZi5yb3dzKTpcclxuXHRcdFx0cmFpc2Ugb3NleGNlcHRpb24oIFxcXHJcblx0XHRcdFx0dSdSb3cgc3BhbiAlcyBpcyBpbnZhbGlkIChpLmUuIHRvbyBsYXJnZSwgdG9vIHNtYWxsLCBvciBub3QgYSBudW1iZXIpJyBcXFxyXG5cdFx0XHRcdCUgcm93c3BhbikgXHJcblx0dGhpcy53aWRnZXRzW2luZGV4XSA9IHdpZGdldDtcclxuXHR0aGlzLnNwYW5baW5kZXhdICAgID0gY29sc3Bhbiwgcm93c3BhblxyXG4gICAgICAgIHRoaXMud2lkZ2V0LnNldF9yZWN0KHRoaXMuZ2V0X3JlY3QoaW5kZXgpKSAqL1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnh5X3RvX2luZGV4ID0gZnVuY3Rpb24ocFh5KVxyXG4gICAge1xyXG4gICAgfTtcclxuICBcclxuICAgIC8vIEJpbmQgdGhlIGZvcm0gY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmZvcm0gPSBmb3JtO1xyXG59KCkpO1xyXG4iLCJcdFxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyB3aWRnZXQuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIHdpZGdldChwRm9ybSlcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHB1YmxpYyBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuZm9jdXMgPSBmYWxzZTtcclxuXHR0aGlzLmZvcm0gID0gcEZvcm07XHJcblx0dGhpcy5yZWN0ICA9IG51bGw7XHJcblx0dGhpcy50eXBlICA9ICd3aWRnZXQnO1xyXG5cdHRoaXMudmFycyAgPSBudWxsO1xyXG4gICAgfSBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gd2lkZ2V0LnByb3RvdHlwZTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIGNsYXNzIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZm9ybSAgPSBudWxsO1xyXG4gICAgcC5mb2N1cyA9IGZhbHNlO1xyXG4gICAgcC5yZWN0ICA9IG51bGw7XHJcbiAgICBwLnR5cGUgID0gJyc7XHRcclxuICAgIHAudmFycyAgPSBudWxsO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gZ2VuZXJhbCBmdW5jdGlvbi5cclxuICAgICAqL1xyXG5cclxuICAgIHAuYm94X3NpemUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9OyAgICAgICAgICAgIFxyXG5cclxuICAgIHAudGhlbWVfZW5naW5lID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcC5kcmF3X2ZyYW1lID0gZnVuY3Rpb24ocFJlY3QsIHBTdHlsZSlcclxuICAgIHtcclxuICAgIH07ICAgIFxyXG5cclxuICAgIHAub25fbW91c2VfY2xpY2sgPSBmdW5jdGlvbihwZXZlbnQpXHJcbiAgICB7XHJcbiAgICB9OyAgICAgICAgXHJcblxyXG4gICAgcC5yZW5kZXIgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuc2V0X3JlY3QgPSBmdW5jdGlvbihwUmVjdClcclxuICAgIHtcclxuICAgIH07XHJcbiAgICBcclxuICAgIHAuc2V0X3ZhciA9IGZ1bmN0aW9uKHBWYWwsIHBWYXIpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gU2V0cyBhbiBleHBlcmltZW50YWwgdmFyaWFibGUuXHJcbiAgICAgICAgaWYgKHBWYXIgPT0gbnVsbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHBWYXIgPSB0aGlzLnZhcnM7XHJcbiAgICAgICAgfSAgICBcclxuXHRcclxuICAgICAgICBpZiAocFZhciAhPSBudWxsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5mb3JtLmV4cGVyaW1lbnQudmFycy5zZXQocFZhciwgcFZhbCk7ICBcclxuICAgICAgICB9ICBcclxuICAgIH07ICAgIFxyXG4gICAgXHJcbiAgICAvLyBCaW5kIHRoZSB3aWRnZXQgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLndpZGdldCA9IHdpZGdldDtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGJ1dHRvbi5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gYnV0dG9uKHBGb3JtLCBwUHJvcGVydGllcylcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMud2lkZ2V0X2NvbnN0cnVjdG9yKHBGb3JtKTtcclxuXHRcclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHByaXZhdGUgcHJvcGVydGllcy5cclxuICAgICAgICB0aGlzLl9lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIkJVVFRPTlwiKTtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLndpZHRoICA9ICcxMDAlJztcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLmhlaWdodCA9ICcxMDAlJztcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnRleHRDb250ZW50ID0gcFByb3BlcnRpZXNbJ3RleHQnXTtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLmZvbnRTdHlsZSAgPSB0aGlzLmZvcm0uZXhwZXJpbWVudC52YXJzLmZvbnRfaXRhbGljID09ICd5ZXMnID8gJ2l0YWxpYycgOiAnbm9ybWFsJzsgXHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZS5mb250V2VpZ2h0ID0gdGhpcy5mb3JtLmV4cGVyaW1lbnQudmFycy5mb250X2JvbGQgICA9PSAneWVzJyA/ICdib2xkJyAgIDogJ25vcm1hbCc7IFxyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuc3R5bGUuZm9udEZhbWlseSA9IHRoaXMuZm9ybS5leHBlcmltZW50LnZhcnMuZm9udF9mYW1pbHk7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZS5jb2xvciAgICAgID0gdGhpcy5mb3JtLmV4cGVyaW1lbnQudmFycy5mb3JlZ3JvdW5kO1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuc3R5bGUuZm9udFNpemUgICA9IHRoaXMuZm9ybS5leHBlcmltZW50LnZhcnMuZm9udF9zaXplICsgJ3B4JztcclxuXHJcbiAgICAgICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBlbGVtZW50LlxyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMucmVzcG9uc2UuYmluZCh0aGlzKSk7XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuXHJcblx0dGhpcy5jZW50ZXIgID0gKHR5cGVvZiBwUHJvcGVydGllc1snY2VudGVyJ10gPT0gJ2Jvb2xlYW4nKSA/IHBQcm9wZXJ0aWVzWydjZW50ZXInXSA6IGZhbHNlOyBcclxuICAgICAgICB0aGlzLmZyYW1lICAgPSAodHlwZW9mIHBQcm9wZXJ0aWVzWydmcmFtZSddICA9PSAnYm9vbGVhbicpID8gcFByb3BlcnRpZXNbJ2ZyYW1lJ10gIDogZmFsc2U7IFxyXG4gICAgICAgIHRoaXMudGFiX3N0ciA9ICcgICAgJztcclxuXHR0aGlzLnR5cGUgICAgPSAnYnV0dG9uJztcclxuXHR0aGlzLnhfcGFkICAgPSA4O1xyXG5cdHRoaXMueV9wYWQgICA9IDg7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MoYnV0dG9uLCBvc3dlYi53aWRnZXQpO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5jZW50ZXIgID0gZmFsc2U7XHJcbiAgICBwLmZyYW1lICAgPSBudWxsO1xyXG4gICAgcC50YWJfc3RyID0gJyc7XHJcbiAgICBwLnRleHQgICAgPSAnJztcclxuICAgIHAueF9wYWQgICA9IDA7XHJcbiAgICBwLnlfcGFkICAgPSAwO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBjbGFzcyBtZXRob2RzIC0gYnVpbGQgY3ljbGUuXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnJlc3BvbnNlID0gZnVuY3Rpb24oZXZlbnQpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcyk7XHJcbiAgICAgICAgLy8gQ29tcGxldGUgdGhlIHBhcmVudCBmb3JtLlxyXG4gICAgICAgIHRoaXMuZm9ybS5pdGVtLmNvbXBsZXRlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZHJhd190ZXh0ID0gZnVuY3Rpb24ocFRleHQsIHBIdG1sKVxyXG4gICAge1xyXG4gICAgICAgIC8vIERyYXdzIHRleHQgaW5zaWRlIHRoZSB3aWRnZXQuXHJcblx0cFRleHQgPSB0aGlzLmZvcm0uZXhwZXJpbWVudC5zeW50YXguZXZhbF90ZXh0KHBUZXh0KTtcclxuXHRwVGV4dCA9IHNhZmVfZGVjb2RlKHBUZXh0KS5yZXBsYWNlKCdcXHQnLCB0aGlzLnRhYl9zdHIpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jZW50ZXIgPT0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciB4ID0gdGhpcy5yZWN0LnggKyB0aGlzLnJlY3QudyAvIDI7XHJcbiAgICAgICAgICAgIHZhciB5ID0gdGhpcy5yZWN0LnkgKyB0aGlzLnJlY3QuaCAvIDI7XHJcbiAgICAgICAgfSAgXHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHsgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgeCA9IHRoaXMucmVjdC54ICsgdGhpcy54X3BhZDtcclxuICAgICAgICAgICAgdmFyIHkgPSB0aGlzLnJlY3QueSArIHRoaXMueV9wYWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciB3ID0gdGhpcy5yZWN0LncgLSAyICogdGhpcy54X3BhZDtcclxuICAgICAgICBcclxuXHR0aGlzLmZvcm0uY2FudmFzLnRleHQocFRleHQsIHRoaXMuY2VudGVyLCB4LCB5LCB3LCBwSHRtbCk7XHJcbiAgICB9OyAgICBcclxuXHJcbiAgICBwLnJlbmRlciA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBEcmF3cyB0aGUgd2lkZ2V0LlxyXG4gICAgICAgIGlmICh0aGlzLmZyYW1lID09IHRydWUpXHJcbiAgICAgICAgeyAgICBcclxuICAgICAgICAgICAgdGhpcy5kcmF3X2ZyYW1lKHRoaXMucmVjdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuZHJhd190ZXh0KHRoaXMudGV4dCk7IFxyXG4gICAgfTsgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgLy8gQmluZCB0aGUgYnV0dG9uIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5idXR0b24gPSBvc3dlYi5wcm9tb3RlQ2xhc3MoYnV0dG9uLCBcIndpZGdldFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGNoZWNrYm94LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBjaGVja2JveChwRm9ybSwgcFByb3BlcnRpZXMpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkIGNyZWF0ZS5cclxuXHR0aGlzLndpZGdldF9jb25zdHJ1Y3RvcihwRm9ybSk7XHJcblx0XHJcbiAgICAgICAgLy8gU2V0IHRoZSBjbGFzcyBwcml2YXRlIHByb3BlcnRpZXMuXHJcbiAgICAgICAgdGhpcy5fZWxlbWVudCAgICAgICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJMQUJFTFwiKTsgXHJcbiAgICAgICAgdGhpcy5fZWxlbWVudF9jaGVjayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJJTlBVVFwiKTtcclxuICAgICAgICB0aGlzLl9lbGVtZW50X2NoZWNrLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJjaGVja2JveFwiKTtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLndpZHRoICAgICAgPSAnMTAwJSc7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZS5oZWlnaHQgICAgID0gJzEwMCUnO1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQudGV4dENvbnRlbnQgICAgICAgID0gcFByb3BlcnRpZXNbJ3RleHQnXTtcclxuICAgICAgICBcclxuICAgICAgICAvL3RoaXMuX2VsZW1lbnQuaW5uZXJIVE1MICAgICAgICA9IHBQcm9wZXJ0aWVzWyd0ZXh0J107XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZS5mb250U3R5bGUgID0gdGhpcy5mb3JtLmV4cGVyaW1lbnQudmFycy5mb250X2l0YWxpYyA9PSAneWVzJyA/ICdpdGFsaWMnIDogJ25vcm1hbCc7IFxyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuc3R5bGUuZm9udFdlaWdodCA9IHRoaXMuZm9ybS5leHBlcmltZW50LnZhcnMuZm9udF9ib2xkICAgPT0gJ3llcycgPyAnYm9sZCcgICA6ICdub3JtYWwnOyBcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLmZvbnRGYW1pbHkgPSB0aGlzLmZvcm0uZXhwZXJpbWVudC52YXJzLmZvbnRfZmFtaWx5O1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuc3R5bGUuY29sb3IgICAgICA9IHRoaXMuZm9ybS5leHBlcmltZW50LnZhcnMuZm9yZWdyb3VuZDtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLmZvbnRTaXplICAgPSB0aGlzLmZvcm0uZXhwZXJpbWVudC52YXJzLmZvbnRfc2l6ZSArICdweCc7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9lbGVtZW50X2NoZWNrKTtcclxuXHJcbiAgICAgICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBlbGVtZW50LlxyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMub25fbW91c2VfY2xpY2suYmluZCh0aGlzKSk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCctLS0nKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhwUHJvcGVydGllcyk7XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuXHJcblx0dGhpcy5jbGlja19hY2NlcHRzID0gKHR5cGVvZiBwUHJvcGVydGllcy5jbGlja19hY2NlcHRzID09PSAndW5kZWZpbmVkJykgPyBmYWxzZSA6IHBQcm9wZXJ0aWVzLmNsaWNrX2FjY2VwdHM7XHJcblx0dGhpcy5ncm91cCAgICAgICAgID0gKHR5cGVvZiBwUHJvcGVydGllcy5ncm91cCA9PT0gJ3VuZGVmaW5lZCcpID8gbnVsbCA6IHBQcm9wZXJ0aWVzLmdyb3VwO1xyXG5cdHRoaXMudHlwZSAgICAgICAgICA9ICdjaGVja2JveCc7XHJcbiAgICAgICAgdGhpcy52YXIgICAgICAgICAgID0gKHR5cGVvZiBwUHJvcGVydGllcy52YXIgPT09ICd1bmRlZmluZWQnKSA/IG51bGwgOiBwUHJvcGVydGllcy52YXI7XHJcbiAgICAgICAgdGhpcy5jaGVja2VkICAgICAgID0gKHR5cGVvZiBwUHJvcGVydGllcy5jaGVja2VkID09PSAnY2hlY2tlZCcpID8gZmFsc2UgIDogcFByb3BlcnRpZXMuY2hlY2tlZDtcclxuICAgICAgICBcclxuICAgICAgICAvLyBTZXQgdGhlIGN1cnJlbnQgc3RhdHVzIG9mIHRoZSBjaGVja2JveC5cclxuICAgICAgICB0aGlzLnNldF92YXIodGhpcy5jaGVja2VkKTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhjaGVja2JveCwgb3N3ZWIud2lkZ2V0KTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuY2VudGVyICA9IGZhbHNlO1xyXG4gICAgcC5mcmFtZSAgID0gbnVsbDtcclxuICAgIHAudGFiX3N0ciA9ICcnO1xyXG4gICAgcC50ZXh0ICAgID0gJyc7XHJcbiAgICBwLnhfcGFkICAgPSAwO1xyXG4gICAgcC55X3BhZCAgID0gMDtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcy5cclxuICAgICAqL1xyXG5cclxuICAgIHAub25fbW91c2VfY2xpY2sgPSBmdW5jdGlvbihldmVudClcclxuICAgIHtcclxuICAgICAgIGNvbnNvbGUubG9nKCdjaGVja2JveCBjbGlja2VkJyk7IFxyXG4gICAgXHJcbiAgICB9O1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAvLyBCaW5kIHRoZSBjaGVja2JveCBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuY2hlY2tib3ggPSBvc3dlYi5wcm9tb3RlQ2xhc3MoY2hlY2tib3gsIFwid2lkZ2V0XCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgbGFiZWwuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGxhYmVsKHBGb3JtLCBwUHJvcGVydGllcylcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMud2lkZ2V0X2NvbnN0cnVjdG9yKHBGb3JtKTtcclxuXHRcclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHByaXZhdGUgcHJvcGVydGllcy5cclxuICAgICAgICB0aGlzLl9lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIlNQQU5cIik7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5pbm5lckhUTUwgPSBwUHJvcGVydGllc1sndGV4dCddO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuXHJcblx0dGhpcy5jZW50ZXIgID0gKHR5cGVvZiBwUHJvcGVydGllc1snY2VudGVyJ10gPT0gJ2Jvb2xlYW4nKSA/IHBQcm9wZXJ0aWVzWydjZW50ZXInXSA6IGZhbHNlOyBcclxuICAgICAgICB0aGlzLmZyYW1lICAgPSAodHlwZW9mIHBQcm9wZXJ0aWVzWydmcmFtZSddICA9PSAnYm9vbGVhbicpID8gcFByb3BlcnRpZXNbJ2ZyYW1lJ10gIDogZmFsc2U7IFxyXG4gICAgICAgIHRoaXMudGFiX3N0ciA9ICcgICAgJztcclxuXHR0aGlzLnR5cGUgICAgPSAnbGFiZWwnO1xyXG5cdHRoaXMueF9wYWQgICA9IDg7XHJcblx0dGhpcy55X3BhZCAgID0gODtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhsYWJlbCwgb3N3ZWIud2lkZ2V0KTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuY2VudGVyICA9IGZhbHNlO1xyXG4gICAgcC5mcmFtZSAgID0gZmFsc2U7XHJcbiAgICBwLnRhYl9zdHIgPSAnJztcclxuICAgIHAudGV4dCAgICA9ICcnO1xyXG4gICAgcC54X3BhZCAgID0gMDtcclxuICAgIHAueV9wYWQgICA9IDA7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMgLSBidWlsZCBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAuZHJhd190ZXh0ID0gZnVuY3Rpb24ocFRleHQsIHBIdG1sKVxyXG4gICAge1xyXG4gICAgICAgIC8vIERyYXdzIHRleHQgaW5zaWRlIHRoZSB3aWRnZXQuXHJcblx0cFRleHQgPSB0aGlzLmZvcm0uZXhwZXJpbWVudC5zeW50YXguZXZhbF90ZXh0KHBUZXh0KTtcclxuXHRwVGV4dCA9IHNhZmVfZGVjb2RlKHBUZXh0KS5yZXBsYWNlKCdcXHQnLCB0aGlzLnRhYl9zdHIpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jZW50ZXIgPT0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciB4ID0gdGhpcy5yZWN0LnggKyB0aGlzLnJlY3QudyAvIDI7XHJcbiAgICAgICAgICAgIHZhciB5ID0gdGhpcy5yZWN0LnkgKyB0aGlzLnJlY3QuaCAvIDI7XHJcbiAgICAgICAgfSAgXHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHsgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgeCA9IHRoaXMucmVjdC54ICsgdGhpcy54X3BhZDtcclxuICAgICAgICAgICAgdmFyIHkgPSB0aGlzLnJlY3QueSArIHRoaXMueV9wYWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciB3ID0gdGhpcy5yZWN0LncgLSAyICogdGhpcy54X3BhZDtcclxuICAgICAgICBcclxuXHR0aGlzLmZvcm0uY2FudmFzLnRleHQocFRleHQsIHRoaXMuY2VudGVyLCB4LCB5LCB3LCBwSHRtbCk7XHJcbiAgICB9OyAgICBcclxuXHJcbiAgICBwLnJlbmRlciA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBEcmF3cyB0aGUgd2lkZ2V0LlxyXG4gICAgICAgIGlmICh0aGlzLmZyYW1lID09IHRydWUpXHJcbiAgICAgICAgeyAgICBcclxuICAgICAgICAgICAgdGhpcy5kcmF3X2ZyYW1lKHRoaXMucmVjdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuZHJhd190ZXh0KHRoaXMudGV4dCk7IFxyXG4gICAgfTsgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgLy8gQmluZCB0aGUgbGFiZWwgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmxhYmVsID0gb3N3ZWIucHJvbW90ZUNsYXNzKGxhYmVsLCBcIndpZGdldFwiKTtcclxufSgpKTtcclxuIiwiXHJcbihmdW5jdGlvbigpIHtcclxuICAgIC8vIENsYXNzIGV2ZW50cyAtIHByb2Nlc3NpbmcgYWxsIHVzZXIgYW5kIHN5c3RlbSBldmVucyB3aXRoaW4gb3N3ZWIuXHJcbiAgICBmdW5jdGlvbiBldmVudHMoKSB7XHJcbiAgICBcdHRocm93ICdUaGUgY2xhc3MgZXZlbnRzIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhJztcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIHByb3BlcnRpZXMuXHJcbiAgICBldmVudHMuX2FjdGl2ZSA9IGZhbHNlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdHJ1ZSBldmVudCBwcm9jZXNzaW5nIGlzIGFjdGl2ZS5cclxuICAgIGV2ZW50cy5fY2FsbGVyID0gbnVsbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgY2FsbGVyIG9iamVjdCAoY2xvY2ssIGtleWJvYXJkLCBtb3VzZSkuXHJcbiAgICBldmVudHMuX2N1cnJlbnRfaXRlbSA9IG51bGw7XHRcdFx0ICAgLy8gQ29udGFpbiB0aGUgY3VycmVudCBhY3RpdmUgaXRlbS4gXHRcdFx0XHJcbiAgICBldmVudHMuX2tleWJvYXJkX21vZGUgPSBvc3dlYi5jb25zdGFudHMuUFJFU1NFU19PTkxZOyAgLy8gS2V5Ym9hcmQgY29sbGVjdGluZyBtb2RlIChkb3duL3VwL2JvdGgpLlxyXG4gICAgZXZlbnRzLl9rZXlib2FyZF9ldmVudCA9IG51bGw7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbnRhaW5zIHRoZSBsYXN0IGtub3duIGtleWJvYXJkIGV2ZW50LlxyXG4gICAgZXZlbnRzLl9tb3VzZV9tb2RlID0gb3N3ZWIuY29uc3RhbnRzLlBSRVNTRVNfT05MWTsgICAgIC8vIE1vdXNlIGNvbGxlY3RpbmcgbW9kZSAoZG93bi91cC9ib3RoKS5cclxuICAgIGV2ZW50cy5fbW91c2VfbW92ZSA9IG51bGw7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb250YWlucyB0aGUgbGFzdCBrbm93biBtb3VzZSBtb3ZlIGV2ZW50ICh1c2VkIHdpdGhpbiB0aGUgbW91c2UgY2xhc3MpLlxyXG4gICAgZXZlbnRzLl9tb3VzZV9wcmVzcyA9IG51bGw7XHRcdFx0XHQgICAvLyBDb250YWlucyB0aGUgbGFzdCBrbm93biBtb3VzZSBwcmVzcyBldmVudCAodXNlZCB3aXRoaW4gdGhlIG1vdXNlIGNsYXNzKS5cdFxyXG4gICAgZXZlbnRzLl9yZXNwb25zZV9naXZlbiA9IGZhbHNlO1x0XHRcdCAgIC8vIFZhbGlkIHJlc3BvbnNlIHRvZ2dsZVxyXG4gICAgZXZlbnRzLl9yZXNwb25zZV90eXBlID0gLTE7XHRcdFx0XHQgICAvLyBTZXQgdHlwZSBvZiByZXNwb25zZSAoMCA9IG5vbmUsIDEgPSBrZXlib2FyZCwgMiA9IG1vdXNlLCAzID0gc291bmQpLiBcclxuICAgIGV2ZW50cy5fcmVzcG9uc2VfbGlzdCA9IG51bGw7XHQgICAgICAgICAgICAgICAgICAgLy8gSXRlbXMgdG8gcmVzcG9uZCBvbi5cclxuICAgIGV2ZW50cy5fc291bmRfZW5kZWQgPSBmYWxzZTtcdFx0XHQgICAvLyBTb3VuZCBwbGF5IGlzIGZpbmlzaGVkLlxyXG4gICAgZXZlbnRzLl90aW1lb3V0ID0gLTE7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIER1cmF0aW9uIGZvciB0aW1lb3V0LlxyXG4gICAgZXZlbnRzLl92aWRlb19lbmRlZCA9IGZhbHNlO1x0XHRcdCAgIC8vIFZpZGVvIHBsYXkgaXMgZmluaXNoZWQuXHJcbiAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgdGhlIGNvbnZlcnNpb24gdGFibGUgdG8gY29udmVydCBrZXljb2RlcyB0byBPcGVuU2VzYW1lIGNvZGVzLlxyXG4gICAgZXZlbnRzLktFWV9DT0RFUyA9IFsnJywnJywnJywnJywnJywnJywnaGVscCcsJycsJ2JhY2tzcGFjZScsJ3RhYicsJycsJycsJ2NsZWFyJywnZW50ZXInLCdlbnRlcl9zcGVjaWFsJywnJywnc2hpZnQnLCdjdHJsJywnYWx0JywncGF1c2UnLCAgICAgICAgIC8vIDAwICAuLiAxOVxyXG4gICAgICAgICdjYXBzJywnJywnJywnJywnJywnJywnJywnZXNjYXBlJywnJywnJywnJywnJywnc3BhY2UnLCdwYWdlIHVwJywncGFnZSBkb3duJywnZW5kJywnaG9tZScsJ2xlZnQnLCd1cCcsJ3JpZ2h0JywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIwICAuLiAzOVxyXG4gICAgICAgICdkb3duJywnc2VsZWN0JywncHJpbnQnLCdleGVjdXRlJywncHJpbnQgc2NyZWVuJywnaW5zZXJ0JywnZGVsZXRlJywnJywnMCcsJzEnLCcyJywnMycsJzQnLCc1JywnNicsJzcnLCc4JywnOScsJzonLCc7JywgICAgICAgICAgICAgICAgICAgICAgIC8vIDQwICAuLiA1OVxyXG4gICAgICAgICc8JywnPScsJz4nLCc/JywnQCcsJ2EnLCdiJywnYycsJ2QnLCdlJywnZicsJ2cnLCdoJywnaScsJ2onLCdrJywnbCcsJ20nLCduJywnbycsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDYwICAuLiA3OVxyXG4gICAgICAgICdwJywncScsJ3InLCdzJywndCcsJ3UnLCd2JywndycsJ3gnLCd5JywneicsJ2xlZnQgbWV0YScsJ3JpZ2h0IG1ldGEnLCdtZW51JywnJywnJywna3AwJywna3AxJywna3AyJywna3AzJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDgwICAuLiA5OVxyXG4gICAgICAgICdrcDQnLCdrcDUnLCdrcDYnLCdrcDcnLCdrcDgnLCdrcDknLCdrcF9tdWx0aXBseScsJ2twX3BsdXMnLCcnLCdrcF9taW51cycsJ2twX3BlcmlvZCcsJ2twX2RpdmlkZScsJ2YxJywnZjInLCdmMycsJ2Y0JywnZjUnLCdmNicsJ2Y3JywnZjgnLCAgIC8vIDEwMCAuLiAxMTlcclxuICAgICAgICAnZjknLCdmMTAnLCdmMTEnLCdmMTInLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAxMjAgLi4gMTM5XHJcbiAgICAgICAgJycsJycsJycsJycsJ251bWxvY2snLCdzY3JvbGxvY2snLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMTQwIC4uIDE1OVxyXG4gICAgICAgICdeJywnIScsJ1wiJywnIycsJyQnLCclJywnJicsJ18nLCcoJywnKScsJyonLCcrJywnfCcsJ18nLCd7JywnfScsJ34nLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAxNjAgLi4gMTc5XHJcbiAgICAgICAgJycsJycsJycsJycsJycsJycsJzsnLCc9JywnLCcsJy0nLCcuJywnLycsJ2AnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMTgwIC4uIDE5OVxyXG4gICAgICAgICcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCdbJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIwMCAuLiAyMTlcclxuICAgICAgICAnXFxcXCcsJ10nLCdcXCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAyMjAgLi4gMjM5XHJcbiAgICAgICAgJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJyddOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMjQwIC4uIDI1NVxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY29udmVyc2lvbiB0YWJsZSB0byBjb252ZXJ0IHNoaWZ0IGtleWNvZGVzIHRvIE9wZW5TZXNhbWUgY29kZXMuXHJcbiAgICBldmVudHMuS0VZX1NDT0RFUyA9IFsnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywncGF1c2UnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMDAgIC4uIDE5XHJcbiAgICAgICAgJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMjAgIC4uIDM5XHJcbiAgICAgICAgJycsJycsJycsJycsJycsJycsJycsJycsJyknLCchJywnQCcsJyMnLCckJywnJScsJ14nLCcmJywnKicsJygnLCcnLCc6JywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gNDAgIC4uIDU5XHJcbiAgICAgICAgJycsJysnLCcnLCcnLCcnLCdhJywnYicsJ2MnLCdkJywnZScsJ2YnLCdnJywnaCcsJ2knLCdqJywnaycsJ2wnLCdtJywnbicsJ28nLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gNjAgIC4uIDc5XHJcbiAgICAgICAgJ3AnLCdxJywncicsJ3MnLCd0JywndScsJ3YnLCd3JywneScsJ3onLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gODAgIC4uIDk5XHJcbiAgICAgICAgJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMTAwIC4uIDExOVxyXG4gICAgICAgICcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDEyMCAuLiAxMzlcclxuICAgICAgICAnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAxNDAgLi4gMTU5XHJcbiAgICAgICAgJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJ18nLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMTYwIC4uIDE3OVxyXG4gICAgICAgICcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCc8JywnJywnPicsJz8nLCd+JywnJywnJywnJywnJywnJywnJywnJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDE4MCAuLiAxOTlcclxuICAgICAgICAnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywneycsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAyMDAgLi4gMjE5XHJcbiAgICAgICAgJ3wnLCd9JywnXCInLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIyMCAuLiAyMzlcclxuICAgICAgICAnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJ107ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAyNDAgLi4gMjU1XHJcbiAgIFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBtZXRob2RzIGZvciBnZW5lcmFsIGV2ZW50IHByb2Nlc3NpbmcuICAgIFxyXG5cclxuICAgIGV2ZW50cy5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xyXG5cdC8vIEluaXRpYWxpemUgdGhlIGtleWJvYXJkIGV2ZW50IGxpc3RlbmVycy5cclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5fa2V5RG93bi5iaW5kKHRoaXMpLCBmYWxzZSk7IFxyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5fa2V5VXAuYmluZCh0aGlzKSwgZmFsc2UpO1xyXG5cclxuXHQvLyBJbml0aWFsaXplIHRoZSBtb3VzZSBldmVudCBsaXN0ZW5lcnMuXHJcbiAgICBcdG9zd2ViLnJ1bm5lci5fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5fbW91c2VEb3duLmJpbmQodGhpcyksIGZhbHNlKTtcclxuXHRvc3dlYi5ydW5uZXIuX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMuX21vdXNlTW92ZS5iaW5kKHRoaXMpLCBmYWxzZSk7XHJcblx0b3N3ZWIucnVubmVyLl9jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5fbW91c2VVcC5iaW5kKHRoaXMpLCBmYWxzZSk7XHJcbiAgICAgICAgXHJcbiAgICBcdC8vIEluaXRpYWxpemUgdGhlIG1vdXNlIGNvbnRleHQgZXZlbnQgbGlzdGVuZXJzLlxyXG4gICAgICAgIG9zd2ViLnJ1bm5lci5fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCB0aGlzLl9tb3VzZUNvbnRleHQuYmluZCh0aGlzKSwgZmFsc2UpO1xyXG5cclxuXHQvLyBJbml0aWFsaXplIHRoZSB0aWNrIGV2ZW50IGxpc3RlbmVyLlxyXG5cdGNyZWF0ZWpzLlRpY2tlci5zZXRJbnRlcnZhbCgxNSk7XHJcblx0Y3JlYXRlanMuVGlja2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJ0aWNrXCIsIHRoaXMuX3RpY2suYmluZCh0aGlzKSk7XHRcclxuICAgIH07XHJcbiBcclxuICAgIGV2ZW50cy5fZmluYWxpemUgPSBmdW5jdGlvbigpIHtcclxuICAgIFx0Ly8gRmluYWxpemUgdGhlIHRpY2sgZXZlbnQgbGlzdGVuZXIuICAgICAgICAgICAgIFxyXG5cdGNyZWF0ZWpzLlRpY2tlci5yZW1vdmVFdmVudExpc3RlbmVyKFwidGlja1wiKTtcclxuXHJcblx0Ly8gRmluYWxpemUgdGhlIG1vdXNlIGNvbnRleHQgZXZlbnQgbGlzdGVuZXJzLlxyXG5cdG9zd2ViLnJ1bm5lci5fY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCB0aGlzLl9tb3VzZUNvbnRleHQsIGZhbHNlKTtcclxuXHJcblx0Ly8gRmluYWxpemUgdGhlIG1vdXNlIGV2ZW50IGxpc3RlbmVycy5cclxuXHRvc3dlYi5ydW5uZXIuX2NhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX21vdXNlRG93biwgZmFsc2UpO1xyXG5cdG9zd2ViLnJ1bm5lci5fY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgdGhpcy5fbW91c2VNb3ZlLCBmYWxzZSk7IFxyXG5cdG9zd2ViLnJ1bm5lci5fY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHRoaXMuX21vdXNlVXAsIGZhbHNlKTsgXHJcblxyXG5cdC8vIEZpbmFsaXplIHRoZSBrZXlib2FyZCBldmVudCBsaXN0ZW5lcnMuXHJcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2tleURvd24sIGZhbHNlKTtcclxuXHR3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIHRoaXMuX2tleVVwLCBmYWxzZSk7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgZXZlbnRzLl9ydW4gPSBmdW5jdGlvbihjYWxsZXIsIHRpbWVvdXQsIHJlc3BvbnNlX3R5cGUsIHJlc3BvbnNlX2xpc3QpIHtcclxuXHQvLyBTZXQgdGhlIGV2ZW50IHJ1bm5pbmcgcHJvcGVydGllcy4gICAgIFxyXG5cdHRoaXMuX2NhbGxlciA9IGNhbGxlcjtcclxuXHR0aGlzLl9yZXNwb25zZV9saXN0ID0gcmVzcG9uc2VfbGlzdDtcclxuXHR0aGlzLl9yZXNwb25zZV90eXBlID0gcmVzcG9uc2VfdHlwZTtcclxuXHR0aGlzLl90aW1lb3V0ID0gdGltZW91dDtcclxuXHJcblx0Ly8gQWN0aXZhdGUgdGhlIGV2ZW50IHJ1bm5pbmcuICBcclxuXHR0aGlzLl9yZXNwb25zZV9naXZlbiA9IGZhbHNlO1xyXG5cdHRoaXMuX3NvdW5kX2VuZGVkID0gZmFsc2U7XHRcdFx0XHRcdFx0XHQgICAgXHJcblx0dGhpcy5fdmlkZW9fZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLl9hY3RpdmUgPSB0cnVlO1x0XHJcbiAgICB9O1xyXG5cclxuICAgIGV2ZW50cy5fdXBkYXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcdC8vIENoZWNrIGlmIHRoZSBkdXJhdGlvbiBpcyBmaW5pc2RoZWQuXHJcbiAgIFx0aWYgKCgodGhpcy5fdGltZW91dCA9PT0gLTEpICYmICgodGhpcy5fcmVzcG9uc2VfZ2l2ZW4gPT09IHRydWUpIHx8ICh0aGlzLl9zb3VuZF9lbmRlZCA9PT0gdHJ1ZSkgfHwgKHRoaXMuX3ZpZGVvX2VuZGVkID09PSB0cnVlKSkpIHx8XHJcbiAgICAgICAgICAgICgodGhpcy5fdGltZW91dCA+IDApICYmICgodGhpcy5fcmVzcG9uc2VfdHlwZSA9PT0gb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX0tFWUJPQVJEKSB8fCAodGhpcy5fcmVzcG9uc2VfdHlwZSA9PT0gb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX01PVVNFKSkgJiYgKHRoaXMuX3Jlc3BvbnNlX2dpdmVuID09PSB0cnVlKSkgfHxcclxuICAgICAgICAgICAgKCgodGhpcy5fdGltZW91dCA+IDApICYmICh0aGlzLl9jdXJyZW50X2l0ZW0uY2xvY2sudGltZSgpIC0gdGhpcy5fY3VycmVudF9pdGVtLmV4cGVyaW1lbnQudmFycy5nZXQoJ3RpbWVfJyArIHRoaXMuX2N1cnJlbnRfaXRlbS5uYW1lKSkgPiB0aGlzLl90aW1lb3V0KSkpIHtcclxuICAgICAgICAgICAgLy8gU2V0IHRoZSBzdGF0dXMgb2YgdGhlIGN1cnJlbnQgaXRlbSB0byBmaW5hbGl6ZS5cclxuICAgICAgICAgICAgdGhpcy5fY3VycmVudF9pdGVtLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFO1xyXG4gIFx0fVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGN1cnJlbnQgaXRlbS5cclxuICAgICAgICAgICAgdGhpcy5fY3VycmVudF9pdGVtLnVwZGF0ZSgpO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBldmVudHMuX2NvbXBsZXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gRGlzYWJsZSB0aGUgdGlja2VyXHJcbiAgICAgICAgdGhpcy5fYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUmVtb3ZlIHRoZSBpdGVtcyBmcm9tIHRoZSBnZW5lcmFsIHN0YWNrLlxyXG5cdG9zd2ViLml0ZW1fc3RhY2sucG9wKCk7XHJcblxyXG4gICAgICAgIC8vIEV4ZWN1dGUgdGhlIHBvc3QtcnVuIHBoYXNlIGFmdGVyIGR1cmF0aW9uIGlzIGZpbmlzaGVkIG9yIHJlc3BvbnNlIGlzIHJlY2VpdmVkLlxyXG5cdHRoaXMuX2N1cnJlbnRfaXRlbS5jb21wbGV0ZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIG1ldGhvZHMgZm9yIGtleWJvYXJkIGV2ZW50IHByb2Nlc3NpbmcuXHJcblx0XHJcbiAgICBldmVudHMuX2NvbnZlcnRLZXlDb2RlID0gZnVuY3Rpb24oZXZlbnQpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gQ2hlY2sgZm9yIHNwZWNpYWwgY2hhcmFjdGVyc1xyXG4gICAgICAgIHZhciBrZXkgPSAnJztcclxuICAgICAgICBpZiAoKGV2ZW50LnNoaWZ0S2V5ID09PSB0cnVlKSAmJiAoZXZlbnQua2V5Q29kZSAhPT0gMTYpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gU2hpZnQga2V5IHByZXNzZWQgd2l0aCBvdGhlciBrZXksIHNvIGNvbnZlcnQgc2hpZnQga2V5cy5cclxuICAgICAgICAgICAga2V5ID0gdGhpcy5LRVlfU0NPREVTW2V2ZW50LmtleUNvZGVdO1xyXG4gICAgICAgIH0gXHJcbiAgICAgICAgZWxzZSBpZiAoKGV2ZW50LnNoaWZ0S2V5ID09PSB0cnVlKSAmJiAoZXZlbnQua2V5Q29kZSA9PT0gMTYpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gU2hpZnQgY29kZSBwcmVzc2VkLCBjaGVjayBmb3IgbG9jYXRpb24gKGxlZnQgb3IgcmlnaHQpXHJcbiAgICAgICAgICAgIGtleSA9IChldmVudC5sb2NhdGlvbiA9PSAxKSA/ICdsc2hpZnQnIDogJ3JzaGlmdCc7IFxyXG4gICAgICAgIH0gXHJcbiAgICAgICAgZWxzZSBpZiAoKGV2ZW50LmN0cmxLZXkgPT09IHRydWUpICYmIChldmVudC5rZXlDb2RlID09PSAxNykpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvLyBDdHJsIGNvZGUgcHJlc3NlZCwgY2hlY2sgZm9yIGxvY2F0aW9uIChsZWZ0IG9yIHJpZ2h0KVxyXG4gICAgICAgICAgICBrZXkgPSAoZXZlbnQubG9jYXRpb24gPT0gMSkgPyAnbGN0cmwnIDogJ3JjdHJsJzsgXHJcbiAgICAgICAgfSBcclxuICAgICAgICBlbHNlIGlmICgoZXZlbnQuYWx0S2V5ID09PSB0cnVlKSAmJiAoZXZlbnQua2V5Q29kZSA9PT0gMTgpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gQWx0IGNvZGUgcHJlc3NlZCwgY2hlY2sgZm9yIGxvY2F0aW9uIChsZWZ0IG9yIHJpZ2h0KVxyXG4gICAgICAgICAgICBrZXkgPSAoZXZlbnQubG9jYXRpb24gPT0gMSkgPyAnbGFsdCcgOiAncmFsdCc7IFxyXG4gICAgICAgIH0gXHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gQ29udmVydCBzdGFuZGFyZCBrZXljb2RlLlxyXG4gICAgICAgICAgICBrZXkgID0gdGhpcy5LRVlfQ09ERVNbZXZlbnQua2V5Q29kZV07XHJcbiAgICAgICAgfSBcclxuICAgICAgICBcclxuICAgICAgICAvLyBSZXR1cm4gZnVuY3Rpb24gcmVzdWx0LlxyXG4gICAgICAgIHJldHVybiBrZXk7XHJcbiAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgZXZlbnRzLl9rZXlEb3duID0gZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICAvLyBTdG9yZSB0aGUga2V5Ym9hcmQgZXZlbnQuICAgIFxyXG5cdHRoaXMua2V5Ym9hcmRfZXZlbnQgPSBldmVudDtcclxuXHJcbiAgICAgICAgLy8gT25seSBzZWxlY3QgdGhpcyBldmVudCB3aGVuIHRoZSBjb2xsZWN0aW9uIG1vZGUgaXMgc2V0IGZvciB0aGlzLlxyXG4gICAgXHRpZiAoKHRoaXMuX2tleWJvYXJkX21vZGUgPT09IG9zd2ViLmNvbnN0YW50cy5QUkVTU0VTX09OTFkpIHx8ICh0aGlzLl9rZXlib2FyZF9tb2RlID09PSBvc3dlYi5jb25zdGFudHMuUFJFU1NFU19BTkRfUkVMRUFTRVMpKSB7XHJcbiAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIGV2ZW50LlxyXG4gICAgICAgICAgICB0aGlzLl9wcm9jZXNzS2V5Ym9hcmRFdmVudChldmVudCwgMSk7XHJcbiAgICBcdH0gXHJcbiAgICB9O1x0IFxyXG5cclxuICAgIGV2ZW50cy5fa2V5VXAgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgXHQvLyBPbmx5IHNlbGVjdCB0aGlzIGV2ZW50IHdoZW4gdGhlIGNvbGxlY3Rpb24gbW9kZSBpcyBzZXQgZm9yIHRoaXMuXHJcbiAgICBcdGlmICgodGhpcy5fa2V5Ym9hcmRfbW9kZSA9PT0gb3N3ZWIuY29uc3RhbnRzLlJFTEVBU0VTX09OTFkpIHx8ICh0aGlzLl9rZXlib2FyZF9tb2RlID09PSBvc3dlYi5jb25zdGFudHMuUFJFU1NFU19BTkRfUkVMRUFTRVMpKSB7XHJcbiAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIGV2ZW50LlxyXG4gICAgICAgICAgICB0aGlzLl9wcm9jZXNzS2V5Ym9hcmRFdmVudChldmVudCwgMCk7XHJcbiAgICBcdH0gXHQgXHJcbiAgICB9O1xyXG5cclxuICAgIGV2ZW50cy5fcHJvY2Vzc0tleWJvYXJkRXZlbnQgPSBmdW5jdGlvbihldmVudCwga2V5Ym9hcmRfc3RhdGUpIHtcclxuICAgICAgICAvLyBDcmVhdGUgYSBuZXcga2V5Ym9hcmQgcmVzcG9uc2Ugb2JqZWN0LlxyXG4gICAgICAgIHZhciBLZXlib2FyZFJlc3BvbnNlcyA9IHsnZXZlbnQnOiBldmVudCwgJ3J0VGltZSc6ICBvc3dlYi5ydW5uZXIuZXhwZXJpbWVudC5jbG9jay50aW1lKCksICdzdGF0ZSc6IGtleWJvYXJkX3N0YXRlLCAndHlwZSc6IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9LRVlCT0FSRH07XHJcbiAgICAgIFxyXG4gICAgICAgIC8vIENvbnZlcnQgcmVzcG9uc2UgdG8gcHJvcGVyIGtleWJvYXJkIHRva2VuLiBcclxuICAgICAgICBLZXlib2FyZFJlc3BvbnNlcy5yZXNwID0gdGhpcy5fY29udmVydEtleUNvZGUoZXZlbnQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFByb2Nlc3MgdGhlIHJlc3BvbnNlIHRvIHRoZSBjdXJyZW50IG9iamVjdC5cclxuICAgICAgICBpZiAoKHRoaXMuX3Jlc3BvbnNlX3R5cGUgPT09IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9LRVlCT0FSRCkgJiYgKCh0aGlzLl9yZXNwb25zZV9saXN0ID09PSBudWxsKSB8fCAodGhpcy5fcmVzcG9uc2VfbGlzdC5pbmRleE9mKEtleWJvYXJkUmVzcG9uc2VzLnJlc3ApID49IDApKSkge1xyXG4gICAgICAgICAgICAvLyBQcm9jZXNzIHRoZSBjdXJyZW50IGl0ZW0uXHJcblx0ICAgIGlmICh0aGlzLl9jdXJyZW50X2l0ZW0gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIHJlc3BvbnNlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9pdGVtLnVwZGF0ZV9yZXNwb25zZShLZXlib2FyZFJlc3BvbnNlcyk7XHJcbiAgICAgICAgICAgIH0gXHQgXHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgdmFsaWQgcmVzcG9uc2UgZ2l2ZW4gdG9nZ2xlLlxyXG4gICAgICAgICAgICB0aGlzLl9yZXNwb25zZV9naXZlbiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHRcclxuICAgIC8vIERlZmluaXRpb24gb2YgbWV0aG9kcyBmb3IgbW91c2UgZXZlbnQgcHJvY2Vzc2luZy5cclxuIFxyXG4gICAgZXZlbnRzLl9tb3VzZUNvbnRleHQgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgIC8vIFByZXZlbnQgZGVmYXVsdCBhY3Rpb24uIFxyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUmV0dXJuIGZhbHNlIHRvIHByZXZlbnQgdGhlIGNvbnRleHQgbWVudSBmcm9tIHB1c2hpbmcgdXAuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTsgICAgICAgICAgICBcclxuIFxyXG4gICAgZXZlbnRzLl9tb3VzZURvd24gPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgIC8vIFN0b3JlIHRoZSBtb3VzZSBwcmVzcyBzdGF0dXMgZm9yIHVzZSBpbiB0aGUgbW91c2VlIGNsYXNzLlxyXG4gICAgICAgIHRoaXMuX21vdXNlX3ByZXNzID0gZXZlbnQ7XHJcblxyXG5cdC8vIE9ubHkgc2VsZWN0IHRoaXMgZXZlbnQgd2hlbiB0aGUgY29sbGVjdGlvbiBtb2RlIGlzIHNldCBmb3IgdGhpcy5cclxuICAgIFx0aWYgKCh0aGlzLl9tb3VzZV9tb2RlID09PSBvc3dlYi5jb25zdGFudHMuUFJFU1NFU19PTkxZKSB8fCAodGhpcy5fbW91c2VfbW9kZSA9PT0gb3N3ZWIuY29uc3RhbnRzLlBSRVNTRVNfQU5EX1JFTEVBU0VTKSkge1xyXG4gICAgICAgICAgICAvLyBQcm9jZXNzIHRoZSBldmVudC5cclxuICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc01vdXNlRXZlbnQoZXZlbnQsIDEpO1xyXG4gICAgXHR9XHRcclxuICAgIH07XHRcclxuXHJcbiAgICBldmVudHMuX21vdXNlTW92ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgLy8gU3RvcmUgdGhlIG1vdXNlIG1vdmUgZXZlbnQgYW5kIGl0cyB0aW1lc3RhbXAgZm9yIHVzZSBpbiB0aGUgbW91c2UgY2xhc3MuXHJcbiAgICAgICAgdGhpcy5fbW91c2VfbW92ZSA9IHsnZXZlbnQnOiBldmVudCwgJ3J0VGltZSc6IG9zd2ViLnJ1bm5lci5leHBlcmltZW50LmNsb2NrLnRpbWUoKX07XHJcbiAgICB9O1x0XHJcblxyXG4gICAgZXZlbnRzLl9tb3VzZVVwID0gZnVuY3Rpb24oZXZlbnQpIHtcclxuXHQvLyBPbmx5IHNlbGVjdCB0aGlzIGV2ZW50IHdoZW4gdGhlIGNvbGxlY3Rpb24gbW9kZSBpcyBzZXQgZm9yIHRoaXMuXHJcbiAgICBcdGlmICgodGhpcy5fbW91c2VfbW9kZSA9PT0gb3N3ZWIuY29uc3RhbnRzLlJFTEVBU0VTX09OTFkpIHx8ICh0aGlzLl9tb3VzZV9tb2RlID09PSBvc3dlYi5jb25zdGFudHMuUFJFU1NFU19BTkRfUkVMRUFTRVMpKSB7XHJcbiAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIGV2ZW50LlxyXG4gICAgICAgICAgICB0aGlzLl9wcm9jZXNzTW91c2VFdmVudChldmVudCwgMCk7XHJcbiAgICBcdH0gXHRcclxuICAgIH07XHJcblxyXG4gICAgZXZlbnRzLl9wcm9jZXNzTW91c2VFdmVudCA9IGZ1bmN0aW9uKGV2ZW50LCBtb3VzZV9zdGF0ZSkge1xyXG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyBtb3VzZSByZXNwb25zZSBvYmplY3QuXHJcbiAgICAgICAgdmFyIE1vdXNlUmVzcG9uc2VzID0geydldmVudCc6IGV2ZW50LCAncnRUaW1lJzogb3N3ZWIucnVubmVyLmV4cGVyaW1lbnQuY2xvY2sudGltZSgpLCAnc3RhdGUnOiBtb3VzZV9zdGF0ZSwgJ3R5cGUnOiBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfTU9VU0V9O1xyXG4gICAgIFx0XHJcbiAgICAgXHQvLyBBZGp1c3QgbW91c2UgcmVzcG9uc2UuICBcclxuICAgICBcdE1vdXNlUmVzcG9uc2VzLnJlc3AgPSBTdHJpbmcoZXZlbnQuYnV0dG9uICsgMSk7ICBcclxuICAgICBcdCBcclxuICAgICAgICAvLyBQcm9jZXNzIHRoZSByZXNwb25zZSB0byB0aGUgY3VycmVudCBvYmplY3QuXHJcbiAgICAgICAgaWYgKCh0aGlzLl9yZXNwb25zZV90eXBlID09PSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfTU9VU0UpICYmICgodGhpcy5fcmVzcG9uc2VfbGlzdCA9PT0gbnVsbCkgfHwgKHRoaXMuX3Jlc3BvbnNlX2xpc3QuaW5kZXhPZihNb3VzZVJlc3BvbnNlcy5yZXNwKSA+PSAwKSkpIHtcclxuICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgcmVzcG9uc2UgdG8gdGhlIGN1cnJlbnQgb2JqZWN0LlxyXG4gICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudF9pdGVtICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X2l0ZW0udXBkYXRlX3Jlc3BvbnNlKE1vdXNlUmVzcG9uc2VzKTtcclxuICAgICAgICAgICAgfSAgIFxyXG5cclxuICAgICAgICAgICAgLy8gU2V0IHRoZSB2YWxpZCByZXNwb25zZSBnaXZlbiB0b2dnbGUuXHJcbiAgICAgICAgICAgIHRoaXMuX3Jlc3BvbnNlX2dpdmVuID0gdHJ1ZTtcclxuXHR9XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBtZXRob2RzIGZvciBzb3VuZCBldmVudCBwcm9jZXNzaW5nLlxyXG5cclxuICAgIGV2ZW50cy5fYXVkaW9FbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIElmIGR1cmF0aW9uIGlzZXF1YWwgdG8gc291bmQgZXhpdCB0aGUgc291bmQgaXRlbS5cclxuICAgICAgICBvc3dlYi5ldmVudHMuX3NvdW5kX2VuZGVkID0gdHJ1ZTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBtZXRob2RzIGZvciB2aWRlbyBldmVudCBwcm9jZXNzaW5nLlxyXG5cclxuICAgIGV2ZW50cy5fdmlkZW9FbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIG9zd2ViLmV2ZW50cy5fdmlkZW9fZW5kZWQgPSB0cnVlO1xyXG4gICAgfTtcclxuXHJcbiAgICBldmVudHMuX3ZpZGVvUGxheSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgbWV0aG9kcyBmb3IgdGljayBldmVudCBwcm9jZXNzaW5nICh0aW1pbmcpLlxyXG4gXHJcbiAgICBldmVudHMuX3RpY2sgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgXHQvLyBPbmx5IGNoZWNrIGZvciBzdGF0dXMgaWYgdGhlcmUgaXMgYSBjdXJyZW50IGl0ZW0gYW5kIHRoZSB0aWNrZXIgaXMgYWN0aXZhdGVkLlxyXG4gICAgICAgIGlmICgodGhpcy5fY3VycmVudF9pdGVtICE9PSBudWxsKSAmJiAodGhpcy5fYWN0aXZlID09PSB0cnVlKSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX2N1cnJlbnRfaXRlbS5fc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIG9zd2ViLmNvbnN0YW50cy5TVEFUVVNfRklOQUxJWkU6XHJcbiAgICAgICAgICAgICAgICAgICAvLyBFbmQgYWN0aW9uLiBDb21wbGV0ZSBjdXJyZW50IGFjdGl2ZSBpdGVtLlxyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50cy5fY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cdFx0ZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAvLyBEZWZhdWx0IGFjdGlvbiwgdXBkYXRlIHNlY3Rpb24gb2YgdGhlIGN1cnJlbnQgYWN0aXZlIGl0ZW0uXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRzLl91cGRhdGUoKTtcclxuICAgICAgICAgICAgfVxyXG5cdH1cclxuICAgIH07XHQgXHJcblxyXG4gICAgLy8gQmluZCB0aGUgZXZlbnRzIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5ldmVudHMgPSBldmVudHM7XHJcbn0oKSk7XHJcbiIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBmdW5jdGlvbnMuXHJcbiAgICBmdW5jdGlvbiBmdW5jdGlvbnMoKSB7XHJcblx0dGhyb3cgJ1RoZSBjbGFzcyBmdW5jdGlvbnMgY2Fubm90IGJlIGluc3RhbnRpYXRlZCEnO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBtZXRob2RzLiAgIFxyXG5cclxuICAgIGZ1bmN0aW9ucy5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xyXG5cdC8vIENyZWF0ZSB0aGUgZ2VuZXJhbCBmdW5jdGlvbiBjYWxscyBmb3IgdXNlIGluIHRoZSBpbmxpZGUgc2NyaXB0IGl0ZW0uXHJcblx0d2luZG93WydwcmludCddID0gdGhpcy5wcmludDtcclxuXHR3aW5kb3dbJ3JhbmRpbnQnXSA9IHRoaXMucmFuZGludDtcclxuICAgIH07XHJcblx0XHRcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBnbG9iYWwgaW5saW5lIGZ1bmN0aW9ucy5cclxuXHJcbiAgICBmdW5jdGlvbnMucHJpbnQgPSBmdW5jdGlvbih0ZXh0KSB7XHJcblx0Y29uc29sZS5sb2coJ3ByaW50IG91dHB1dDonICsgdGV4dCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9ucy5yYW5kaW50ID0gZnVuY3Rpb24oc3RhcnQsIGVuZCkge1xyXG4gICAgICAgIHZhciBtdWx0aXBsaWVyID0gZW5kIC0gc3RhcnQ7XHJcbiAgICAgICAgdmFyIHJhbmQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtdWx0aXBsaWVyKTtcclxuICAgICAgICByZXR1cm4gcmFuZCArIHN0YXJ0O1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBmdW5jdGlvbnMgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmZ1bmN0aW9ucyA9IGZ1bmN0aW9ucztcclxufSgpKTsgXHJcblxyXG4iLCJcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgUGFyYW1ldGVycy5cclxuICAgIGZ1bmN0aW9uIHBhcmFtZXRlcnMoKSB7XHJcblx0dGhyb3cgJ1RoZSBjbGFzcyBwYXJhbWV0ZXJzIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhJztcclxuICAgIH0gXHJcblxyXG4gICAgLy8gRGVmaW5lIHRoZSBwcml2YXRlIHByb3BlcnRpZXMuIFxyXG4gICAgcGFyYW1ldGVycy5faXRlbUNvdW50ZXIgPSAwO1xyXG4gICAgcGFyYW1ldGVycy5fcGFyYW1ldGVycyAgPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgICAvLyBEZWZpbmUgdGhlIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHBhcmFtZXRlcnMuZGlzcGxheVN1bW1hcnkgICA9IGZhbHNlO1xyXG4gICAgcGFyYW1ldGVycy51c2VEZWZhdWx0VmFsdWVzID0gZmFsc2U7XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMgLSBpbml0aWFsaXplIHBhcmFtZXRlcnMuICAgXHJcblxyXG4gICAgcGFyYW1ldGVycy5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICBcdC8vIFNldCBwcm9wZXJ0aWVzIGlmIGRlZmluZWQuXHJcbiAgICBcdHZhciBwYXJhbWV0ZXIgPSB7ZGF0YVR5cGU6ICcwJywgZGVmYXVsdFZhbHVlOiAnMCcsIG5hbWU6ICdzdWJqZWN0X25yJywgcHJvbXB0OiAnUGxlYXNlIGVudGVyIHRoZSBzdWJqZWN0IG51bWJlcicsIHByb21wdEVuYWJsZWQ6IHRydWV9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEFkZCB0aGUgc3ViamVjdCBwYXJhbWV0ZXIgdG8gdGhlIHBhcmFtZXRlcnMgbGlzdC5cclxuICAgICAgICB0aGlzLl9wYXJhbWV0ZXJzLnB1c2gocGFyYW1ldGVyKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMgLSBwcm9jZXNzIHBhcmFtZXRlcnMuICAgXHJcbiAgICBcclxuICAgIHBhcmFtZXRlcnMuX3Byb2Nlc3NQYXJhbWV0ZXJzID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcdC8vIFByb2Nlc3MgYWxsIGl0ZW1zIGZvciB3aGljaCBhIHVzZXIgaW5wdXQgaXMgcmVxdWlyZWQuXHJcbiAgICAgICAgaWYgKHRoaXMuX2l0ZW1Db3VudGVyIDwgdGhpcy5fcGFyYW1ldGVycy5sZW5ndGgpIHtcdFxyXG4gICAgICAgICAgICAvLyBQcm9jZXNzIHRoZSBQYXJhbWV0ZXIuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnVzZURlZmF1bHRWYWx1ZXMgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3NQYXJhbWV0ZXIodGhpcy5fcGFyYW1ldGVyc1t0aGlzLl9pdGVtQ291bnRlcl0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gVHJhbnNmZXIgdGhlIHN0YXJ0dXAgaW5mbyB0byB0aGUgY29udGV4dC5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zZmVyUGFyYW1ldGVycygpO1xyXG4gICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gQWxsIGl0ZW1zIGhhdmUgYmVlbiBwcm9jZXNzZWQsIGNvbnRpbmUgdGhlIFJ1bm5lciBwcm9jZXNzaW5nLlxyXG4gICAgICAgICAgICBpZiAodGhpcy5kaXNwbGF5U3VtbWFyeSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBTaG93IGEgc3VtbWFyeSBvZiB0aGUgdGhlIHN0YXJ0dXAgaW5mb3JtYXRpb24uIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2hvd1BhcmFtZXRlcnMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHsgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIFRyYW5zZmVyIHRoZSBzdGFydHVwIGluZm8gdG8gdGhlIGNvbnRleHQuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl90cmFuc2ZlclBhcmFtZXRlcnMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcGFyYW1ldGVycy5fcHJvY2Vzc1BhcmFtZXRlciA9IGZ1bmN0aW9uKHBhcmFtZXRlcikge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIGEgdXNlciByZXF1ZXN0IGlzIHJlcXVpcmVkLlxyXG4gICAgICAgIGlmIChwYXJhbWV0ZXIucHJvbXB0RW5hYmxlZCA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Nob3dEaWFsb2cocGFyYW1ldGVyLmRhdGFUeXBlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgZGlhbG9nIGludGVyZmFjZS5cclxuICAgICAgICAgICAgaWYgKHBhcmFtZXRlci5yZXNwb25zZSA9PSAnJykge1xyXG4gICAgICAgICAgICBcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcGRpYWxvZ2lucHV0JykudmFsdWUgPSBwYXJhbWV0ZXIuZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcGRpYWxvZ2lucHV0JykudmFsdWUgPSBwYXJhbWV0ZXIuZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhbG9nYm94aGVhZCcpLmlubmVySFRNTCA9IHBhcmFtZXRlci5wcm9tcHQ7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcGJ1dHRvbnllcycpLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgcmVzcG9uc2UgaW5mb3JtYXRpb25cclxuICAgICAgICAgICAgICAgIHBhcmFtZXRlci5yZXNwb25zZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcGRpYWxvZ2lucHV0JykudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIENsb3NlIHRoZSBkaWFsb2cuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9oaWRlRGlhbG9nKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gSW5jcmVhc2UgdGhlIGNvdW50ZXIuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtQ291bnRlcisrO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENvbnRpbnVlIHByb2Nlc3NpbmcuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzUGFyYW1ldGVycygpO1xyXG5cclxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpO1xyXG4gICAgICAgIFx0XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcGJ1dHRvbm5vJykub25jbGljayA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gQ2xvc2UgdGhlIGRpYWxvZy5cclxuXHQgICAgICAgIHRoaXMuX2hpZGVEaWFsb2coKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICBcdFx0Ly8gRmluYWxpemUgdGhlIGludHJvc2NyZWVuIGVsZW1lbnRzLlxyXG5cdFx0b3N3ZWIucnVubmVyLl9leGl0KCk7XHJcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIEFzc2lnbiBkZWZhdWx0IHZhbHVlIHRvIHRoZSBTdGFydHVwIGl0ZW0uXHJcbiAgICAgICAgICAgIHBhcmFtZXRlci5yZXNwb25zZSA9IHBhcmFtZXRlci5kZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEluY3JlYXNlIHRoZSBjb3VudGVyLlxyXG4gICAgICAgICAgICB0aGlzLl9pdGVtQ291bnRlcisrO1xyXG5cclxuICAgICAgICAgICAgLy8gQ29udGludWUgcHJvY2Vzc2luZy5cclxuICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc1BhcmFtZXRlcnMoKTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICBwYXJhbWV0ZXJzLl9zaG93UGFyYW1ldGVycyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFsb2dib3hoZWFkJykuaW5uZXJIVE1MID0gJ1N1bW1hcnkgb2Ygc3RhcnR1cCBpbmZvJztcclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXBidXR0b255ZXMnKS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIENsb3NlIHRoZSBkaWFsb2cuXHJcblx0ICAgIHRoaXMuX2hpZGVEaWFsb2coKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFRyYW5zZmVyIHRoZSBzdGFydHVwIGluZm8gdG8gdGhlIGNvbnRleHQuXHJcbiAgICAgICAgICAgIHRoaXMuX3RyYW5zZmVyUGFyYW1ldGVycygpOyBcclxuICAgICAgICBcclxuICAgICAgICB9LmJpbmQodGhpcyk7ICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcGJ1dHRvbm5vJykub25jbGljayA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBDbG9zZSB0aGUgZGlhbG9nLlxyXG4gICAgICAgICAgICB0aGlzLl9oaWRlRGlhbG9nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFJlc2V0IHRoZSBpdGVtIGNvdW50ZXIuXHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW1Db3VudGVyID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFJlc3RhdCB0aGUgaW5wdXQgcHJvY2Vzcy4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3NQYXJhbWV0ZXJzKCk7IFxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9LmJpbmQodGhpcyk7ICAgIFxyXG5cclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXBidXR0b25jYW5jZWwnKS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIENsb3NlIHRoZSBkaWFsb2cuXHJcblx0ICAgIHRoaXMuX2hpZGVEaWFsb2coKTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgLy8gRmluYWxpemUgdGhlIGludHJvc2NyZWVuIGVsZW1lbnRzLlxyXG4gICAgICAgICAgICBvc3dlYi5ydW5uZXIuX2V4aXQoKTtcclxuICAgICAgICB9LmJpbmQodGhpcyk7ICAgIFxyXG4gICAgICAgXHJcbiAgXHQvLyBTZXQgdGhlIGRpYWxvZyBpbnRlcmZhY2UuXHJcbiAgICAgICAgdmFyIFRtcFN0cmluZyA9ICcnO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwO2kgPCB0aGlzLl9wYXJhbWV0ZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICgodGhpcy5fcGFyYW1ldGVyc1tpXS5lbmFibGVkICE9IDApICYmICh0aGlzLl9wYXJhbWV0ZXJzW2ldLnByb21wdEVuYWJsZWQgIT0gMCkpIHtcclxuXHRcdFRtcFN0cmluZyA9IFRtcFN0cmluZyArIHRoaXMuX3BhcmFtZXRlcnNbaV0ubmFtZSArICc6ICcgKyB0aGlzLl9wYXJhbWV0ZXJzW2ldLnJlc3BvbnNlICsgJ1xcclxcbic7ICBcdCAgICAgICAgXHRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FwZGlhbG9ndGV4dGFyZWEnKS5pbm5lckhUTUwgPSBUbXBTdHJpbmc7XHJcbiAgICB9O1xyXG5cclxuICAgIHBhcmFtZXRlcnMuX3RyYW5zZmVyUGFyYW1ldGVycyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgXHQvLyBUcmFuc2ZlciB0aGUgc3RhcnR1cCBpbmZvIGl0ZW1zIHRvIHRoZSBjb250ZXh0LlxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwO2kgPCB0aGlzLl9wYXJhbWV0ZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIG9zd2ViLnJ1bm5lci5leHBlcmltZW50LnZhcnMuc2V0KHRoaXMuX3BhcmFtZXRlcnNbaV0ubmFtZSx0aGlzLl9wYXJhbWV0ZXJzW2ldLnJlc3BvbnNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcblx0Ly8gUGFyYW1ldGVycyBhcmUgcHJvY2Vzc2VkLCBuZXh0IHBoYXNlLlxyXG4gICAgICAgIG9zd2ViLnJ1bm5lci5fcHJlcGFyZVN0YXJ0U2NyZWVuKCk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAgLy8gRGVmaW5pdGlvbiBvZiBjbGFzcyBtZXRob2RzIChkaWFsb2dzKS4gICBcclxuICAgICBcclxuICAgIHBhcmFtZXRlcnMuX3Nob3dEaWFsb2cgPSBmdW5jdGlvbihkaWFsb2dfdHlwZSkge1xyXG4gICAgICAgIHZhciBkaWFsb2dvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWxvZ292ZXJsYXknKTtcclxuXHR2YXIgZGlhbG9nYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWxvZ2JveCcpO1xyXG5cdFx0ICAgICAgICAgICAgICAgIFxyXG5cdGRpYWxvZ292ZXJsYXkuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuXHRkaWFsb2dvdmVybGF5LnN0eWxlLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCArIFwicHhcIjtcclxuXHRkaWFsb2dib3guc3R5bGUubGVmdCA9ICh3aW5kb3cuaW5uZXJXaWR0aCAvIDIpIC0gKDQwMCAqIC41KSArIFwicHhcIjtcclxuXHRkaWFsb2dib3guc3R5bGUudG9wID0gXCIyMDBweFwiO1xyXG5cdGRpYWxvZ2JveC5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmVcIjtcclxuXHJcblx0c3dpdGNoIChkaWFsb2dfdHlwZSkge1xyXG5cdCAgICBjYXNlIFwiMFwiOiBcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFsb2dib3hib2R5JykuaW5uZXJIVE1MID0gJzxpbnB1dCBpZD1cInFwZGlhbG9naW5wdXRcIj48L2lucHV0Pic7XHJcblx0ICAgIFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWxvZ2JveGZvb3QnKS5pbm5lckhUTUwgPSAnPGJ1dHRvbiBpZD1cInFwYnV0dG9ueWVzXCI+T2s8L2J1dHRvbj48YnV0dG9uIGlkPVwicXBidXR0b25ub1wiPkNhbmNlbDwvYnV0dG9uPic7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXBkaWFsb2dpbnB1dCcpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiMVwiOiBcclxuXHQgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFsb2dib3hib2R5JykuaW5uZXJIVE1MID0gJzxpbnB1dCBpZD1cInFwZGlhbG9naW5wdXRcIj48L2lucHV0Pic7XHJcblx0XHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhbG9nYm94Zm9vdCcpLmlubmVySFRNTCA9ICc8YnV0dG9uIGlkPVwicXBidXR0b255ZXNcIj5PazwvYnV0dG9uPjxidXR0b24gaWQ9XCJxcGJ1dHRvbm5vXCI+Q2FuY2VsPC9idXR0b24+JztcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcGRpYWxvZ2lucHV0JykuZm9jdXMoKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCIyXCI6IFxyXG5cdCAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWxvZ2JveGJvZHknKS5pbm5lckhUTUwgPSAnPGlucHV0IGlkPVwicXBkaWFsb2dpbnB1dFwiPjwvaW5wdXQ+JztcclxuXHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFsb2dib3hmb290JykuaW5uZXJIVE1MID0gJzxidXR0b24gaWQ9XCJxcGJ1dHRvbnllc1wiPk9rPC9idXR0b24+PGJ1dHRvbiBpZD1cInFwYnV0dG9ubm9cIj5DYW5jZWw8L2J1dHRvbj4nO1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FwZGlhbG9naW5wdXQnKS5mb2N1cygpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcIjNcIjogXHJcblx0ICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhbG9nYm94Ym9keScpLmlubmVySFRNTCA9ICc8dGV4dGFyZWEgaWQ9XCJxcGRpYWxvZ3RleHRhcmVhXCI+PC90ZXh0YXJlYT4nO1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWxvZ2JveGZvb3QnKS5pbm5lckhUTUwgPSAnPGJ1dHRvbiBpZD1cInFwYnV0dG9ueWVzXCI+WWVzPC9idXR0b24+PGJ1dHRvbiBpZD1cInFwYnV0dG9ubm9cIj5ObzwvYnV0dG9uPjxidXR0b24gaWQ9XCJxcGJ1dHRvbmNhbmNlbFwiPkNhbmNlbDwvYnV0dG9uPic7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXBkaWFsb2d0ZXh0YXJlYScpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cdH1cclxuICAgIH07XHJcblx0IFxyXG4gICAgcGFyYW1ldGVycy5faGlkZURpYWxvZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGRpYWxvZ292ZXJsYXkuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG5cdGRpYWxvZ2JveC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcblx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWxvZ2JveGJvZHknKS5pbm5lckhUTUwgPSAnJztcclxuXHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhbG9nYm94Zm9vdCcpLmlubmVySFRNTCA9ICcnO1xyXG4gICAgfTtcdFxyXG5cclxuICAgIC8vIEJpbmQgdGhlIHBhcmFtZXRlcnMgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzO1xyXG59KCkpO1xyXG4iLCJcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3Mgc2Vzc2lvbi5cclxuICAgIGZ1bmN0aW9uIHBhcnNlcigpIHtcclxuXHR0aHJvdyAnVGhlIGNsYXNzIHBhcnNlciBjYW5ub3QgYmUgaW5zdGFudGlhdGVkISc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIHByb3BlcnRpZXMuXHJcbiAgICBwYXJzZXIuX2FzdF90cmVlID0gbnVsbDsgICAgXHJcbiAgICBwYXJzZXIuX2N1cnJlbnRfbm9kZSA9IG51bGw7XHJcbiAgICBwYXJzZXIuX2lubGluZV9zY3JpcHQgPSBudWxsO1xyXG4gICAgcGFyc2VyLl9zdGF0dXMgPSAwOyAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMgLSBwcmVwYXJlIGN5Y2xlLiAgIFxyXG5cclxuICAgIHBhcnNlci5fcHJlcGFyZSA9IGZ1bmN0aW9uKHNjcmlwdCkge1xyXG4gICAgICAgIGlmIChzY3JpcHQgIT09ICcnKSB7XHJcbiAgICAgICAgICAgIHZhciBsb2NhdGlvbnMgPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIHBhcnNlRm4gPSBmaWxiZXJ0X2xvb3NlLnBhcnNlX2RhbW1pdDtcclxuICAgICAgICAgICAgdmFyIHJhbmdlcyA9IGZhbHNlO1xyXG4gICAgICAgIFx0XHRcclxuXHQgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHZhciBjb2RlID0gc2NyaXB0O1xyXG4gICAgICAgICAgIFx0dmFyIGFzdCA9IHBhcnNlRm4oY29kZSwgeyBsb2NhdGlvbnM6IGxvY2F0aW9ucywgcmFuZ2VzOiByYW5nZXMgfSk7XHJcblx0ICAgICAgICByZXR1cm4gYXN0O1xyXG4gICAgXHQgICAgfVxyXG4gICAgICAgXHQgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICBcdGNvbnNvbGUubG9nKCdlcnJvcicpO1xyXG4gICAgICAgIFx0Y29uc29sZS5sb2coZS50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlXHJcblx0e1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHQgICBcdFxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMgLSBnZW5lcmFsIHBhcnNlciBmdW5jdGlvbnMuXHJcblxyXG4gICAgcGFyc2VyLl9zZXRfcmV0dXJuX3ZhbHVlID0gZnVuY3Rpb24obm9kZSwgdmFsdWUpIHtcclxuICAgICAgICB2YXIgaW5kZXggPSAwO1xyXG4gICAgICAgIHdoaWxlICh0eXBlb2Ygbm9kZVsncmV0dXJudmFsdWUnICsgU3RyaW5nKGluZGV4KV0gIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgfSAgICBcclxuICAgICAgICBcclxuICAgICAgICAvLyBTZXQgdGhlIHJldHVybiB2YWx1ZVxcXHJcbiAgICAgICAgbm9kZVsncmV0dXJudmFsdWUnICsgU3RyaW5nKGluZGV4KV0gPSB2YWx1ZTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBtZXRob2RzIC0gbm9kZSBwcm9jZXNzaW5nLlxyXG4gICAgXHJcbiAgICBwYXJzZXIuX25vZGVfYmluYXJ5X2V4cHJlc3Npb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBJbml0aWFsaXplIHN0YXR1cyBwcm9wZXJ0eS5cclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gKHR5cGVvZiB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID09PSAndW5kZWZpbmVkJykgPyAwICA6IHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXM7IFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFByb2Nlc3MgdGhlIGN1cnJlbnQgc3RhdHVzLlxyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cykge1xyXG4gICAgICAgICAgICBjYXNlIDA6IFxyXG4gICAgICAgICAgICAgICAgLy8gcHJvY2VzcyByaWdodCBleHByZXNzaW9uO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUucmlnaHQucGFyZW50ID0gdGhpcy5fY3VycmVudF9ub2RlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLnJpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgYnJlYWs7ICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAxOiBcclxuICAgICAgICAgICAgICAgIC8vIHByb2Nlc3MgcmlnaHQgZXhwcmVzc2lvbjtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmxlZnQucGFyZW50ID0gdGhpcy5fY3VycmVudF9ub2RlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLmxlZnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICBicmVhazsgICAgICAgIFxyXG4gICAgICAgICAgICBjYXNlIDI6IFxyXG4gICAgICAgICAgICAgICAgdmFyIGxlZnQscmlnaHQ7XHJcbiAgICAgICAgICAgICAgICBpZiAgKHR5cGVvZiB3aW5kb3dbdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMF0gPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJpZ2h0ID0gdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByaWdodCA9IHdpbmRvd1t0aGlzLl9jdXJyZW50X25vZGUucmV0dXJudmFsdWUwXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBsZWZ0LHJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgaWYgICh0eXBlb2Ygd2luZG93W3RoaXMuX2N1cnJlbnRfbm9kZS5yZXR1cm52YWx1ZTFdID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsZWZ0ID0gdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsZWZ0ID0gd2luZG93W3RoaXMuX2N1cnJlbnRfbm9kZS5yZXR1cm52YWx1ZTFdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIFNlbGVjdCB0aGUgYmluYXJ5IG9wZXJhdG9yIHRvIHBlcmZvcm0uXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX2N1cnJlbnRfbm9kZS5vcGVyYXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJy0nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGNhbGwgLSBjaGVjayBmb3IgYmxvY2tpbmcgbWV0aG9kcy5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0X3JldHVybl92YWx1ZSh0aGlzLl9jdXJyZW50X25vZGUucGFyZW50LGxlZnQgLSByaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHBhcmVudCBub2RlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUgPSB0aGlzLl9jdXJyZW50X25vZGUucGFyZW50O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgYnJlYWs7ICAgICAgICBcclxuICAgICAgICB9ICAgIFxyXG4gICAgfTsgICAgXHJcblxyXG4gICAgcGFyc2VyLl9ub2RlX2NhbGxfZXhwcmVzc2lvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIEluaXRpYWxpemUgc3RhdHVzIHByb3BlcnR5LlxyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5hcmd1bWVudHMgPSAodHlwZW9mIHRoaXMuX2N1cnJlbnRfbm9kZS5hcmd1bWVudHMgPT09ICd1bmRlZmluZWQnKSA/IFtdIDogdGhpcy5fY3VycmVudF9ub2RlLmFyZ3VtZW50cztcclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggPSAodHlwZW9mIHRoaXMuX2N1cnJlbnRfbm9kZS5pbmRleCA9PT0gJ3VuZGVmaW5lZCcpID8gMCAgOiB0aGlzLl9jdXJyZW50X25vZGUuaW5kZXg7IFxyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAodHlwZW9mIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPT09ICd1bmRlZmluZWQnKSA/IDAgIDogdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1czsgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJvY2VzcyB0aGUgY3VycmVudCBzdGF0dXMuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMDogXHJcbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGFyZ3VtZW50cy5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggPCB0aGlzLl9jdXJyZW50X25vZGUuYXJndW1lbnRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBjdXJyZW50IG5vZGUgdG8gbmV4dCBub2RlIGluIGxpc3QuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmFyZ3VtZW50c1t0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggLSAxXS5wYXJlbnQgPSB0aGlzLl9jdXJyZW50X25vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLmFyZ3VtZW50c1t0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggLSAxXTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgICAgIGVsc2UgeyBcclxuICAgICAgICAgICAgICAgICAgICAvLyBTZXQgcGFyZW50IG5vZGUuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc19ub2RlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDE6IFxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHBhcmVudCBub2RlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuY2FsbGVlLnBhcmVudCA9IHRoaXMuX2N1cnJlbnRfbm9kZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZSA9IHRoaXMuX2N1cnJlbnRfbm9kZS5jYWxsZWU7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICBicmVhazsgICAgXHJcbiAgICAgICAgICAgIGNhc2UgMjogXHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgc3RhdHVzIG9mIG5vZGUuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gMztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIGFydW1lbnRzIGFycmF5LlxyXG4gICAgICAgICAgICAgICAgdmFyIHRtcF9hcmd1bWVudHMgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGk9MDtpPCB0aGlzLl9jdXJyZW50X25vZGUuYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3dbdGhpcy5fY3VycmVudF9ub2RlWydyZXR1cm52YWx1ZScgKyBTdHJpbmcoaSldXSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wX2FyZ3VtZW50cy5wdXNoKHdpbmRvd1t0aGlzLl9jdXJyZW50X25vZGVbJ3JldHVybnZhbHVlJyArIFN0cmluZyhpKV1dKTtcclxuICAgICAgICAgICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgeyAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wX2FyZ3VtZW50cy5wdXNoKHRoaXMuX2N1cnJlbnRfbm9kZVsncmV0dXJudmFsdWUnICsgU3RyaW5nKGkpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSAgICBcclxuICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBTZWxlY3QgdGhlIHR5cGUgb2YgY2FsbCB0byBwcm9jZXNzXHJcbiAgICAgICAgICAgICAgICB2YXIgY2FsbGVlID0gdGhpcy5fY3VycmVudF9ub2RlWydyZXR1cm52YWx1ZScgKyBTdHJpbmcodGhpcy5fY3VycmVudF9ub2RlLmFyZ3VtZW50cy5sZW5ndGgpXTtcclxuICAgICAgICAgICAgICAgIHZhciByZXR1cm52YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGVlLnR5cGUgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGZ1bmN0aW9uIGNhbGxcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm52YWx1ZSA9IHdpbmRvd1tjYWxsZWUub2JqXS5hcHBseShudWxsLCB0bXBfYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGNhbGwgLSBjaGVjayBmb3IgYmxvY2tpbmcgbWV0aG9kcy5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUucGFyZW50WydyZXR1cm52YWx1ZScgKyBTdHJpbmcodGhpcy5fY3VycmVudF9ub2RlLmFyZ3VtZW50cy5sZW5ndGgpXSA9IHJldHVybnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjYWxsZWUudHlwZSA9PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgoY2FsbGVlLm9iaiA9PSAnY2xvY2snKSAmJiAoY2FsbGVlLnByb3AgPT0gJ3NsZWVwJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBzcGVjaWFsIGNhbGxzIHdpdGggYmxvY2tpbmcgKG5vIGRpcmVjdCByZXN1bHQgcHJvY2Vzc2luZykuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvd1tjYWxsZWUub2JqXVtjYWxsZWUucHJvcF0uYXBwbHkod2luZG93W2NhbGxlZS5vYmpdLCB0bXBfYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgeyAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gb2JqZWN0IG1ldGhvZHMgY2FsbHMuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnZhbHVlID0gd2luZG93W2NhbGxlZS5vYmpdW2NhbGxlZS5wcm9wXSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGNhbGwgLSBjaGVjayBmb3IgYmxvY2tpbmcgbWV0aG9kcy5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnBhcmVudFsncmV0dXJudmFsdWUnICsgU3RyaW5nKHRoaXMuX2N1cnJlbnRfbm9kZS5hcmd1bWVudHMubGVuZ3RoKV0gPSByZXR1cm52YWx1ZTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9ICAgICAgICBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoY2FsbGVlKSB7ICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NhbnZhcyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm52YWx1ZSA9IG5ldyBvc3dlYi5jYW52YXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7ICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgY2FsbCAtIGNoZWNrIGZvciBibG9ja2luZyBtZXRob2RzLlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnRbJ3JldHVybnZhbHVlJyArIFN0cmluZyh0aGlzLl9jdXJyZW50X25vZGUuYXJndW1lbnRzLmxlbmd0aCldID0gcmV0dXJudmFsdWU7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICAgICAgfSAgICBcclxuICAgICAgICAgICAgYnJlYWs7ICAgIFxyXG4gICAgICAgICAgICBjYXNlIDM6IFxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHBhcmVudCBub2RlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUgPSB0aGlzLl9jdXJyZW50X25vZGUucGFyZW50O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgYnJlYWs7ICAgICAgICBcclxuICAgICAgICB9ICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICBwYXJzZXIuX25vZGVfZXhwcmVzc2lvbl9zdGF0ZW1lbnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBJbml0aWFsaXplIHN0YXR1cyBwcm9wZXJ0eS5cclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gKHR5cGVvZiB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID09PSAndW5kZWZpbmVkJykgPyAwICA6IHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXM7IFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFByb2Nlc3MgdGhlIGN1cnJlbnQgc3RhdHVzLlxyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cykge1xyXG4gICAgICAgICAgICBjYXNlIDA6IFxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHBhcmVudCBub2RlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuZXhwcmVzc2lvbi5wYXJlbnQgPSB0aGlzLl9jdXJyZW50X25vZGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUgPSB0aGlzLl9jdXJyZW50X25vZGUuZXhwcmVzc2lvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAxOiBcclxuICAgICAgICAgICAgICAgIC8vIFNldCBwYXJlbnQgbm9kZS5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLnBhcmVudDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc19ub2RlKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIDt9ICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICBwYXJzZXIuX25vZGVfaWRlbnRpZmllciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIFJldHVybiBmdW5jdGlvbiByZXN1bHQuXHJcbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3dbdGhpcy5fY3VycmVudF9ub2RlLm5hbWVdID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAvLyBJdGVtIGlzIHVuZGVmaW5lZCwgY3JlYXRlIGl0IHdpdGhvdXQgdmFsdWUvdHlwZSBkZWZpbml0aW9uLlxyXG4gICAgICAgICAgICB3aW5kb3dbdGhpcy5fY3VycmVudF9ub2RlLm5hbWVdID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHRoZSByZXR1cm4gdmFsdWUuXHJcbiAgICAgICAgdGhpcy5fc2V0X3JldHVybl92YWx1ZSh0aGlzLl9jdXJyZW50X25vZGUucGFyZW50LCB0aGlzLl9jdXJyZW50X25vZGUubmFtZSk7XHJcblxyXG4gICAgICAgIC8vIFNldCBwYXJlbnQgbm9kZS5cclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUgPSB0aGlzLl9jdXJyZW50X25vZGUucGFyZW50O1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwYXJzZXIuX25vZGVfbGl0ZXJhbCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIHJldHVybiB2YWx1ZS5cclxuICAgICAgICB0aGlzLl9zZXRfcmV0dXJuX3ZhbHVlKHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQsIHRoaXMuX2N1cnJlbnRfbm9kZS52YWx1ZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHBhcmVudCBub2RlLlxyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZSA9IHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQ7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgdGhpcy5fcHJvY2Vzc19ub2RlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHBhcnNlci5fbm9kZV9tZW1iZXJfZXhwcmVzc2lvbiA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbml0aWFsaXplIHN0YXR1cyBwcm9wZXJ0eS5cclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gKHR5cGVvZiB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID09PSAndW5kZWZpbmVkJykgPyAwIDogdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1czsgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJvY2VzcyB0aGUgY3VycmVudCBzdGF0dXMuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMDogXHJcbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIG9iamVjdC5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLm9iamVjdC5wYXJlbnQgPSB0aGlzLl9jdXJyZW50X25vZGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUgPSB0aGlzLl9jdXJyZW50X25vZGUub2JqZWN0O1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc19ub2RlKCk7XHJcbiAgICAgICAgICAgIGJyZWFrOyAgICBcclxuICAgICAgICAgICAgY2FzZSAxOiBcclxuICAgICAgICAgICAgICAgIC8vIFByb2Nlc3Mgb2JqZWN0LlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUucHJvcGVydHkucGFyZW50ID0gdGhpcy5fY3VycmVudF9ub2RlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLnByb3BlcnR5O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgYnJlYWs7ICAgIFxyXG4gICAgICAgICAgICBjYXNlIDI6IFxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSByZXR1cm4gdmFsdWUuXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdtZW1iZXItPicpO1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyh0eXBlb2YgdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuX2N1cnJlbnRfbm9kZS5yZXR1cm52YWx1ZTAgPT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRfcmV0dXJuX3ZhbHVlKHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQseyAnb2JqJzogdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMSwgJ3Byb3AnOiBudWxsLCAndHlwZSc6ICdmdW5jdGlvbid9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgeyAgICBcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRfcmV0dXJuX3ZhbHVlKHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQseyAnb2JqJzogdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMCwgJ3Byb3AnOiB0aGlzLl9jdXJyZW50X25vZGUucmV0dXJudmFsdWUxLCd0eXBlJzonb2JqZWN0J30pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgcGFyZW50IG5vZGUuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gMztcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZSA9IHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICBicmVhazsgICAgXHJcbiAgICAgICAgfSAgICAgICAgXHJcbiAgICB9O1xyXG5cclxuICAgIHBhcnNlci5fbm9kZV9wcm9ncmFtID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaXRpYWxpemUgaW5kZXggY291bnRlciBvbmx5IHRoZSBmaXRzdCB0aW1lLlxyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5pbmRleCA9ICh0eXBlb2YgdGhpcy5fY3VycmVudF9ub2RlLmluZGV4ID09PSAndW5kZWZpbmVkJykgPyAwIDogdGhpcy5fY3VycmVudF9ub2RlLmluZGV4OyBcclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gKHR5cGVvZiB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID09PSAndW5kZWZpbmVkJykgPyAwIDogdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1czsgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJvY2VzcyB0aGUgY3VycmVudCBzdGF0dXMuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMDogXHJcbiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBhbGwgbm9kZXMgaW4gc2NyaXB0IGhhdmUgYmVlbiBwcm9jZXNzZWQuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudF9ub2RlLmluZGV4IDwgdGhpcy5fY3VycmVudF9ub2RlLmJvZHkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGN1cnJlbnQgbm9kZSB0byBuZXh0IG5vZGUgaW4gbGlzdC5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuYm9keVt0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggLSAxXS5wYXJlbnQgPSB0aGlzLl9jdXJyZW50X25vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLmJvZHlbdGhpcy5fY3VycmVudF9ub2RlLmluZGV4IC0gMV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc19ub2RlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBFbmQgc3RhdHVzLlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAxO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAvLyBDaGFuZ2UgdGhlIG5vZGUgc3RhdHMuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAyO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEFsbCBub2RlcyBhcmUgcHJvY2Vzc2VkLCBzZXQgc3RhdHVzIHRvIGZpbmlzaGVkLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdHVzID0gMjtcclxuICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIENvbXBsZXRlIHRoZSBpbmxpbmUgaXRlbS4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faW5saW5lX3NjcmlwdCAhPSBudWxsKSB7ICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2lubGluZV9zY3JpcHQuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgIGJyZWFrOyAgICBcclxuICAgICAgICB9ICAgXHJcbiAgICB9OyAgICBcclxuXHJcbiAgICBwYXJzZXIuX25vZGVfdmFyaWFibGVfZGVjbGFyYXRpb24gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBpbmRleCBjb3VudGVyIG9ubHkgdGhlIGZpdHN0IHRpbWUuXHJcbiAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmluZGV4ID0gKHR5cGVvZiB0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggPT09ICd1bmRlZmluZWQnKSA/IDAgOiB0aGlzLl9jdXJyZW50X25vZGUuaW5kZXg7IFxyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAodHlwZW9mIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPT09ICd1bmRlZmluZWQnKSA/IDAgOiB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzOyBcclxuICAgICAgICBcclxuICAgICAgICAvLyBQcm9jZXNzIHRoZSBjdXJyZW50IHN0YXR1cy5cclxuICAgICAgICBzd2l0Y2ggKHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMpIHtcclxuICAgICAgICAgICAgY2FzZSAwOiBcclxuICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGFsbCBub2RlcyBpbiBzY3JpcHQgaGF2ZSBiZWVuIHByb2Nlc3NlZC5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggPCB0aGlzLl9jdXJyZW50X25vZGUuZGVjbGFyYXRpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBjdXJyZW50IG5vZGUgdG8gbmV4dCBub2RlIGluIGxpc3QuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmRlY2xhcmF0aW9uc1t0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggLSAxXS5wYXJlbnQgPSB0aGlzLl9jdXJyZW50X25vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLmRlY2xhcmF0aW9uc1t0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggLSAxXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBDaGFuZ2UgdGhlIG5vZGUgc3RhdHMuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgIGJyZWFrOyBcclxuICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgLy8gQ2hhbmdlIHRoZSBub2RlIHN0YXRzLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gMjtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgcGFyZW50IG5vZGUuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUgPSB0aGlzLl9jdXJyZW50X25vZGUucGFyZW50O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfSAgIFxyXG4gICAgfTtcclxuXHJcbiAgICBwYXJzZXIuX25vZGVfdmFyaWFibGVfZGVjbGFyYXRvciA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbml0aWFsaXplIHN0YXR1cyBwcm9wZXJ0eS5cclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gKHR5cGVvZiB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID09PSAndW5kZWZpbmVkJykgPyAwIDogdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1czsgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJvY2VzcyB0aGUgY3VycmVudCBzdGF0dXMuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMDogXHJcbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGluaXQuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzICAgICAgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmluaXQucGFyZW50ID0gdGhpcy5fY3VycmVudF9ub2RlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlICAgICAgICAgICAgID0gdGhpcy5fY3VycmVudF9ub2RlLmluaXQ7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgYnJlYWs7ICAgIFxyXG4gICAgICAgICAgICBjYXNlIDE6IFxyXG4gICAgICAgICAgICAgICAgLy8gcHJvY2VzcyBpZC5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgICAgPSAyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmlkLnBhcmVudCA9IHRoaXMuX2N1cnJlbnRfbm9kZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZSAgICAgICAgICAgPSB0aGlzLl9jdXJyZW50X25vZGUuaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICBicmVhazsgICAgXHJcbiAgICAgICAgICAgIGNhc2UgMjogXHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgdmFyaWFibGUuXHJcbiAgICAgICAgICAgICAgICB3aW5kb3dbdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMV0gPSB0aGlzLl9jdXJyZW50X25vZGUucmV0dXJudmFsdWUwOyAgICAgIFxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgcGFyZW50IG5vZGUuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gMztcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZSA9IHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICBicmVhazsgICAgXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcyAtIGdlbmVyYWwgbm9kZSBwcm9jZXNzaW5nLlxyXG5cclxuICAgIHBhcnNlci5fcHJvY2Vzc19ub2RlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3Byb2Nlc3Npbmcgbm9kZScpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuX2N1cnJlbnRfbm9kZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2VsZWN0IHRoZSB0eXBlIG9mIG5vZGUgdG8gcHJvY2Vzc1xyXG4gICAgICAgIHN3aXRjaCh0aGlzLl9jdXJyZW50X25vZGUudHlwZSkgeyBcclxuICAgICAgICAgICAgY2FzZSAnQmluYXJ5RXhwcmVzc2lvbic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub2RlX2JpbmFyeV9leHByZXNzaW9uKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdDYWxsRXhwcmVzc2lvbic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub2RlX2NhbGxfZXhwcmVzc2lvbigpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnRXhwcmVzc2lvblN0YXRlbWVudCc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub2RlX2V4cHJlc3Npb25fc3RhdGVtZW50KCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdJZGVudGlmaWVyJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX25vZGVfaWRlbnRpZmllcigpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnTGl0ZXJhbCc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub2RlX2xpdGVyYWwoKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ01lbWJlckV4cHJlc3Npb24nOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fbm9kZV9tZW1iZXJfZXhwcmVzc2lvbigpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnUHJvZ3JhbSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub2RlX3Byb2dyYW0oKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ1ZhcmlhYmxlRGVjbGFyYXRpb24nOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fbm9kZV92YXJpYWJsZV9kZWNsYXJhdGlvbigpO1xyXG4gICAgICAgICAgICBicmVhazsgXHJcbiAgICAgICAgICAgIGNhc2UgJ1ZhcmlhYmxlRGVjbGFyYXRvcic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub2RlX3ZhcmlhYmxlX2RlY2xhcmF0b3IoKTtcclxuICAgICAgICAgICAgYnJlYWs7IFxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMgLSBydW4gY3ljbGUuXHJcblxyXG4gICAgcGFyc2VyLl9ydW5zdGF0ZW1lbnQgPSBmdW5jdGlvbihub2RlKSB7XHJcbiAgICAgICAgLy8gQ2FsbCB0aGUgZXhwcmVzc2lvbiBzdGF0ZW1lbnQgZW4gcmV0dXJuIHRoZSB2YWx1ZS4gICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX25vZGVfY2FsbF9leHByZXNzaW9uKG5vZGUuZXhwcmVzc2lvbik7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBwYXJzZXIuX3J1biA9IGZ1bmN0aW9uKGlubGluZV9zY3JpcHQsIGFzdF90cmVlKSB7XHJcbiAgICAgICAgLy8gU2V0IHRoZSBpbmxpbmUgaXRlbS4gXHJcblx0dGhpcy5faW5saW5lX3NjcmlwdCA9IGlubGluZV9zY3JpcHQ7XHJcblx0XHJcblx0Ly8gU2V0IHRoZSBmaXJzdCBub2RlIGFuZCBpdHMgcGFyZW50LlxyXG5cdHRoaXMuX2N1cnJlbnRfbm9kZSA9IGFzdF90cmVlO1xyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX3N0YXR1cyA9IDE7XHJcbiAgICAgICAgXHJcbiAgICBcdC8vIFByb2Nlc3MgdGhlIG5vZGVzLiBcclxuXHRvc3dlYi5wYXJzZXIuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBwYXJzZXIgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnBhcnNlciA9IHBhcnNlcjtcclxufSgpKTsgXHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBwcm5nLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBwcm5nKClcclxuICAgIHtcclxuICAgIFx0dGhyb3cgXCJUaGUgY2xhc3MgcHJuZyBjYW5ub3QgYmUgaW5zdGFudGlhdGVkIVwiO1xyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBTZXQgdGhlIGNsYXNzIHByaXZhdGUgcHJvcGVydGllcy4gXHJcbiAgICBwcm5nLl9wcmV2aW91cyA9IDA7XHJcbiAgICBwcm5nLl9wcm5nICAgICA9IHVoZXBybmcoKTsgICAgXHJcbiAgICBwcm5nLl9zZWVkICAgICA9ICcwJztcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBjbGFzcyBtZXRob2RzIC0gcnVuIGN5Y2xlLiAgIFxyXG4gICAgICovXHJcbiAgICBcclxuICAgIHBybmcuX2luaXRpYWxpemUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gQ3JlYXRlIHRoZSByYW5kb20gc2VlZC4gXHJcbiAgICAgICAgdGhpcy5fcHJuZy5pbml0U3RhdGUoKTtcclxuICAgICAgICB0aGlzLl9wcm5nLmhhc2hTdHJpbmcodGhpcy5fc2VlZCk7IFxyXG4gICAgfTtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBjbGFzcyBtZXRob2RzLiAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcHJuZy5fZ2V0TmV4dCA9IGZ1bmN0aW9uKCkgXHJcbiAgICB7XHJcbiAgICAgICAgLy8gR2V0IHRoZSBuZXh0IHJhbmRvbSBudW1iZXIuXHJcbiAgICAgICAgdGhpcy5fcHJldmlvdXMgPSAodGhpcy5fcHJuZygxMDAwMDAwMDAwMDAwMDAwKSAvIDEwMDAwMDAwMDAwMDAwMDApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFJldHVybiBmdW5jdGlvbiByZXN1bHQuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXZpb3VzO1xyXG5cdH07XHJcblxyXG4gICAgcHJuZy5fZ2V0UHJldmlvdXMgPSBmdW5jdGlvbigpIFxyXG4gICAge1xyXG4gICAgICAgIC8vIFJldHVybiBmdW5jdGlvbiByZXN1bHQuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXZpb3VzO1xyXG4gICAgfTtcclxuXHJcbiAgICBwcm5nLl9nZXRTZWVkID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICAvLyBSZXR1cm4gdGhlIGN1cnJlbnQgc2VlZCB2YWx1ZS5cclxuICAgICAgICByZXR1cm4gdGhpcy5fc2VlZDsgICAgICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICBwcm5nLl9yYW5kb20gPSBmdW5jdGlvbihwTWluLCBwTWF4KSBcclxuICAgIHtcclxuICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIHJhbmdlIGRldmlkZXIuXHJcbiAgICAgICAgdmFyIGRldmlkZXIgPSAoMSAvICgocE1heCAtIHBNaW4pICsgMSkpO1xyXG4gICAgICAgICBcclxuICAgICAgICAvLyBHZXQgdGhlIHJhbmRvbSBudW1iZXIgYW5kIGRldmlkZSBpdC5cclxuICAgICAgICB0aGlzLl9wcmV2aW91cyA9ICgodGhpcy5fcHJuZygxMDAwMDAwMDAwMDAwMDAwKSAvIDEwMDAwMDAwMDAwMDAwMDApKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBTZXQgdGhlIGRldmlkZXIuXHJcbiAgICAgICAgdGhpcy5fcHJldmlvdXMgPSBwTWluICsgTWF0aC5mbG9vcih0aGlzLl9wcmV2aW91cyAvIGRldmlkZXIpO1xyXG4gICAgICAgICAgICAgICBcclxuICAgICAgICAvLyBSZXR1cm4gZnVuY3Rpb24gcmVzdWx0LiBcclxuICAgICAgICByZXR1cm4gdGhpcy5fcHJldmlvdXM7XHJcbiAgICB9O1xyXG5cclxuICAgIHBybmcuX3Jlc2V0ID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIHJhbmRvbSBzZWVkIHZhbHVlIHRvIDAuIFxyXG4gICAgICAgIHRoaXMuX3NlZWQgPSAnMCc7XHJcblxyXG4gICAgICAgIC8vIFJlc2V0IHRoZSBQUk5HIHJhbmdlLlxyXG4gICAgICAgIHRoaXMuX3BybmcuaW5pdFN0YXRlKCk7XHJcbiAgICAgICAgdGhpcy5fcHJuZy5oYXNoU3RyaW5nKFN0cmluZyh0aGlzLl9zZWVkKSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBwcm5nLl9zZXRTZWVkID0gZnVuY3Rpb24ocFNlZWQpIFxyXG4gICAge1xyXG4gICAgICAgIC8vIFNldCB0aGUgcmFuZG9tIHNlZWQgdmFsdWUuIFxyXG4gICAgICAgIHRoaXMuX3NlZWQgPSBTdHJpbmcocFNlZWQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFJlc2V0IHRoZSBQUk5HIHJhbmdlLlxyXG4gICAgICAgIHRoaXMuX3BybmcuaW5pdFN0YXRlKCk7XHJcbiAgICAgICAgdGhpcy5fcHJuZy5oYXNoU3RyaW5nKHRoaXMuX3NlZWQpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBwcm5nIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5wcm5nID0gcHJuZztcclxufSgpKTtcclxuIiwiXHJcbihmdW5jdGlvbigpIHtcclxuICAgIC8vIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIHNlc3Npb24gLSBzdG9yZSB1c2VyIHNlc3Npb24gaW5mb3JtYXRpb24uIFxyXG4gICAgZnVuY3Rpb24gc2Vzc2lvbigpIHtcclxuICAgIFx0dGhyb3cgJ1RoZSBjbGFzcyBzZXNzaW9uIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhJztcclxuICAgIH1cclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcy4gICBcclxuXHJcbiAgICBzZXNzaW9uLl9pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcdC8vIFVwZGF0ZSB0aGUgbG9hZGVyIHRleHQuXHJcbiAgICBcdG9zd2ViLnJ1bm5lci5fdXBkYXRlSW50cm9TY3JlZW4ob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA4KTtcclxuXHRcclxuICAgIFx0Ly8gR2V0IHRoZSBzZXNzaW9uIGluZm9ybWF0aW9uLlxyXG5cdHRoaXMuX2dldFNlc3Npb25JbmZvcm1hdGlvbigpO1xyXG4gICAgfTtcclxuXHJcbiAgICBzZXNzaW9uLl9nZXRTZXNzaW9uSW5mb3JtYXRpb24gPSBmdW5jdGlvbigpIHtcclxuICAgIFx0Ly8gR2V0IHRoZSBzZXNzaW9uIGluZm9ybWF0aW9uIGZyb20gdGhlIGNsaWVudCBzeXN0ZW0uXHJcbiAgICBcdHRoaXMuX2RhdGUgPSBuZXcgRGF0ZSgpO1xyXG5cdHRoaXMuX3Nlc3Npb24gPSB7XHJcbiAgICAgICAgICAgICdicm93c2VyJzoge1xyXG4gICAgICAgICAgICAgICAgJ2NvZGVuYW1lJzogbmF2aWdhdG9yLmFwcENvZGVOYW1lLFxyXG4gICAgICAgICAgICAgICAgJ25hbWUnOiBuYXZpZ2F0b3IuYXBwTmFtZSxcclxuICAgICAgICAgICAgICAgICd2ZXJzaW9uJzogbmF2aWdhdG9yLmFwcFZlcnNpb25cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ2RhdGUnOiB7XHJcbiAgICAgICAgICAgICAgICAnc3RhcnRkYXRlJzogKCcwJyArIHRoaXMuX2RhdGUuZ2V0RGF0ZSgpKS5zbGljZSgtMikgKyAnLScgKyAoJzAnICsgdGhpcy5fZGF0ZS5nZXRNb250aCgpKS5zbGljZSgtMikgKyAnLScgKyAoJzAnICsgdGhpcy5fZGF0ZS5nZXRGdWxsWWVhcigpKS5zbGljZSgtMiksXHJcbiAgICAgICAgICAgICAgICAnc3RhcnR0aW1lJzogKCcwJyArIHRoaXMuX2RhdGUuZ2V0SG91cnMoKSkuc2xpY2UoLTIpICsgJzonICsgKCcwJyArIHRoaXMuX2RhdGUuZ2V0TWludXRlcygpKS5zbGljZSgtMikgKyAnOicgKyAoJzAnICsgdGhpcy5fZGF0ZS5nZXRTZWNvbmRzKCkpLnNsaWNlKC0yKSxcclxuICAgICAgICAgICAgICAgICdzdGFydGRhdGVVVEMnIDogKCcwJyArIHRoaXMuX2RhdGUuZ2V0VVRDRGF0ZSgpKS5zbGljZSgtMikgKyAnLScgKyAoJzAnICsgdGhpcy5fZGF0ZS5nZXRVVENNb250aCgpKS5zbGljZSgtMikgKyAnLScgKyAoJzAnICsgdGhpcy5fZGF0ZS5nZXRVVENGdWxsWWVhcigpKS5zbGljZSgtMilcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ2V4cGVyaW1lbnQnOiB7XHJcblx0XHQnZGVidWcnOiAwLFxyXG4gICAgICAgICAgICAgICAgJ3BhcmFtZXRlcnMnOiAwLFxyXG5cdFx0J3BpbG90JzogMCxcclxuICAgICAgICAgICAgICAgICd0YXNrbmFtZSc6IDAsXHJcbiAgICAgICAgICAgICAgICAndGFza3ZlcnNpb24nOiAwXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdzY3JlZW4nOiB7XHJcbiAgICAgICAgICAgICAgICAnYXZhaWxhYmxlSGVpZ2h0Jzogc2NyZWVuLmF2YWlsSGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgJ2F2YWlsYWJsZVdpZHRoJzogc2NyZWVuLmF2YWlsV2lkdGgsXHJcbiAgICAgICAgICAgICAgICAnY29sb3JEZXB0aCc6IHNjcmVlbi5jb2xvckRlcHRoLFxyXG4gICAgICAgICAgICAgICAgJ2hlaWdodCc6IHNjcmVlbi5oZWlnaHQsXHJcbiAgICAgICAgICAgICAgICAnb3V0ZXJoZWlnaHQnOiB3aW5kb3cub3V0ZXJoZWlnaHQsXHJcbiAgICAgICAgICAgICAgICAnb3V0ZXJ3aWR0aCc6IHdpbmRvdy5vdXRlcndpZHRoLFxyXG4gICAgICAgICAgICAgICAgJ3BpeGVsRGVwdGgnOiBzY3JlZW4ucGl4ZWxEZXB0aCxcclxuICAgICAgICAgICAgICAgICdzY3JlZW5YJzogd2luZG93LnNjcmVlblgsXHJcbiAgICAgICAgICAgICAgICAnc2NyZWVuWSc6IHdpbmRvdy5zY3JlZW5ZLFxyXG4gICAgICAgICAgICAgICAgJ3dpZHRoJzogc2NyZWVuLndpZHRoXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdzeXN0ZW0nOiB7XHJcbiAgICAgICAgICAgICAgICAnb3MnOiBuYXZpZ2F0b3IucGxhdGZvcm1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIHNlc3Npb24gY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnNlc3Npb24gPSBzZXNzaW9uO1xyXG59KCkpOyBcclxuIiwiXHJcbihmdW5jdGlvbigpIHtcclxuICAgIC8vIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIHJ1bm5lci5cclxuICAgIGZ1bmN0aW9uIHJ1bm5lcigpIHtcclxuICAgIFx0dGhyb3cgJ1RoZSBjbGFzcyBydW5uZXIgY2Fubm90IGJlIGluc3RhbnRpYXRlZCEnO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBTaG93IGxpYnJhcnkgbmFtZSBhbmQgbGlicmFyeSB2ZXJzaW9uIG51bWJlciBpbiB0aGUgY29uc29sZS5cclxuICAgIGNvbnNvbGUubG9nKG9zd2ViLlZFUlNJT05fTkFNRSArICcgLSAnICsgb3N3ZWIuVkVSU0lPTl9OVU1CRVIpO1x0XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIHByb3BlcnRpZXMuXHJcbiAgICBydW5uZXIuX2NhbnZhcyA9IG51bGw7ICAgICAgICAgICAgICAgICAgICAgICAvLyBDYW52YXMgb24gd2hpY2ggdGhlIGV4cGVyaW1lbnQgaXMgc2hvd24uXHJcbiAgICBydW5uZXIuX3F1YWx0cmljcyA9IG51bGw7ICAgICAgICAgICAgICAgICAgICAvLyBMaW5rIHRvIHRoZSBxdWFsdHJpY3MgaW50ZXJmYWNlIChvcHRpb25hbClcclxuICAgIHJ1bm5lci5fc3RhZ2UgPSBudWxsOyAgICAgICAgICAgICAgICAgICAgICAgIC8vIExpbmtzIHRvIHRoZSBzdGFnZSBvYmplY3QgKENyZWF0ZUpTKS5cclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLlxyXG4gICAgcnVubmVyLmRhdGEgPSBudWxsOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29udGFpbmVyIGZvciB0aGUgZXhwZXJpbWVudCByZXN1bHQgZGF0YSAoaWYgZGVmaW5lZCkuXHJcbiAgICBydW5uZXIuZGVidWcgPSBmYWxzZTsgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWJ1ZyB0b2dnbGUuXHJcbiAgICBydW5uZXIuZXhwZXJpbWVudCA9IG51bGw7ICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcm9vdCBleHBlcmltZW50IG9iamVjdCB0byBydW4uICAgICAgICAgICBcclxuICAgIHJ1bm5lci5vbkZpbmlzaGVkID0gbnVsbDsgICAgICAgICAgICAgICAgICAgIC8vIEV2ZW50IHRyaWdnZXJlZCBvbiBmaW5pc2hpbmcgdGhlIGV4cGVyaW1lbnQuXHJcbiAgICBydW5uZXIuc2NyZWVuSW50cm8gPSB0cnVlOyAgICAgICAgICAgICAgICAgICAvLyBTaG93IGludHJvc2NyZWVuIHRvZ2dsZS5cclxuICAgIHJ1bm5lci5zY3JlZW5DbGljayA9IHRydWU7ICAgICAgICAgICAgICAgICAgIC8vIFNob3cgY2xpY2tzY3JlZW4gdG9nZ2xlXHJcbiAgICBydW5uZXIuc2NyaXB0ID0gbnVsbDsgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb250YWluZXIgZm9yIHRoZSBKU09OIHNjcmlwdCBkZWZpbml0aW9uIG9mIHRoZSBleHBlcmltZW50LlxyXG4gICAgcnVubmVyLnNjcmlwdElEID0gMDsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWQgdXNlZCB3aGVuIHJldHJpZXZpbmcgdGhlIHNjcmlwdCBmcm9tIHRoZSBkYXRhYmFzZS5cclxuICAgIHJ1bm5lci5zY3JpcHRVUkwgPSAnJzsgICAgICAgICAgICAgICAgICAgICAgIC8vIFBhdGggcG9pbnRpbmcgdG8gdGhlIEFNRlBIUCBkYXRhYmFzZSBmaWxlcy5cclxuICAgIHJ1bm5lci5zZXNzaW9uID0gbnVsbDsgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbnRhaW5lciBmb3IgdGhlIEpTT04gc2Vzc2lvbiBpbmZvcm1hdGlvbi5cclxuICAgIFxyXG4gICAgLypcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBtZXRob2RzIC0gc2V0dXAgcnVubmVyLiAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcnVubmVyLl9zZXR1cENvbnRlbnQgPSBmdW5jdGlvbihjb250ZW50KSB7XHJcbiAgICBcdC8vIENoZWNrIGlmIHRoZSBleHBlcmltZW50IGNvbnRhaW5lciBpcyBkZWZpbmVkLiAgICAgICAgICAgICAgICAgICAgIFxyXG5cdGlmICh0eXBlb2YgY29udGVudCAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAvLyBHZXQgdGhlIGNhbnZhcyBmcm9tIHRoZSBET00gRWxlbWVudCB0cmVlLlxyXG4gICAgICAgICAgICB0aGlzLl9jYW52YXMgPSAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRlbnQpIDogY29udGVudDsgXHRcdFxyXG5cdFx0XHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgc3RhZ2Ugb2JqZWN0IChlYXNlbEpTKS4gXHJcbiAgICAgICAgICAgIHRoaXMuX3N0YWdlID0gbmV3IGNyZWF0ZWpzLlN0YWdlKHRoaXMuX2NhbnZhcyk7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YWdlLnNuYXBUb1BpeGVsRW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YWdlLnJlZ1ggPSAtLjU7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YWdlLnJlZ1kgPSAtLjU7XHJcblx0XHRcclxuICAgICAgICAgICAgLy8gQnVpbGQgdGhlIGluaXRpYWxpemF0aW9uIHNjcmVlbi5cclxuICAgICAgICAgICAgdGhpcy5fc2V0dXBJbnRyb1NjcmVlbigpO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuICAgICAgICAgICAgb3N3ZWIuZGVidWcuYWRkRXJyb3Iob3N3ZWIuY29uc3RhbnRzLkVSUk9SXzAwMik7XHJcblx0fVxyXG4gICAgfTtcclxuXHJcbiAgICBydW5uZXIuX3NldHVwQ29udGV4dCA9IGZ1bmN0aW9uKGNvbnRleHQpIHtcclxuXHQvLyBDaGVjayBpZiB0aGUgc2NyaXB0IHBhcmFtZXRlciBpcyBkZWZpbmVkLiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG5cdGlmICh0eXBlb2YgY29udGV4dCAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBjb250ZXh0IHBhcmFtZXRlcnMuXHJcbiAgICAgICAgICAgIHRoaXMuZGVidWcgPSAodHlwZW9mIGNvbnRleHQuZGVidWcgIT09ICd1bmRlZmluZWQnKSA/IGNvbnRleHQuZGVidWcgOiBmYWxzZTsgXHJcbiAgICAgICAgICAgIHRoaXMuZmlsZSA9ICh0eXBlb2YgY29udGV4dC5maWxlICE9PSAndW5kZWZpbmVkJykgPyBjb250ZXh0LmZpbGUgOiBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLm9uRmluaXNoZWQgPSAodHlwZW9mIGNvbnRleHQub25GaW5pc2hlZCAhPT0gJ3VuZGVmaW5lZCcpID8gY29udGV4dC5vbkZpbmlzaGVkIDogbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5zY3JlZW5DbGljayA9ICh0eXBlb2YgY29udGV4dC5zY3JlZW5DbGljayAhPT0gJ3VuZGVmaW5lZCcpID8gY29udGV4dC5zY3JlZW5DbGljayA6IHRydWU7XHRcdFx0XHQgICAgICBcclxuICAgICAgICAgICAgdGhpcy5zY3JlZW5JbnRybyA9ICh0eXBlb2YgY29udGV4dC5zY3JlZW5JbnRybyAhPT0gJ3VuZGVmaW5lZCcpID8gY29udGV4dC5zY3JlZW5JbnRybyA6IHRydWU7IFxyXG4gICAgICAgICAgICB0aGlzLnNjcmlwdCA9ICh0eXBlb2YgY29udGV4dC5zY3JpcHQgIT09ICd1bmRlZmluZWQnKSA/IGNvbnRleHQuc2NyaXB0IDogbnVsbDsgICAgICBcclxuICAgICAgICAgICAgdGhpcy5zY3JpcHRJRCA9ICh0eXBlb2YgY29udGV4dC5zY3JpcHRJRCAhPT0gJ3VuZGVmaW5lZCcpID8gY29udGV4dC5zY3JpcHRJRCA6IDA7ICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuc2NyaXB0VVJMID0gKHR5cGVvZiBjb250ZXh0LnNjcmlwdFVSTCAhPT0gJ3VuZGVmaW5lZCcpID8gY29udGV4dC5zY3JpcHRVUkwgOiAnJztcdFx0IFxyXG4gICAgICAgICAgICB0aGlzLnNlc3Npb24gPSAodHlwZW9mIGNvbnRleHQuc2Vzc2lvbiAhPT0gJ3VuZGVmaW5lZCcpID8gY29udGV4dC5zZXNzaW9uIDogbnVsbDtcclxuXHRcdFx0XHRcdFxyXG4gICAgICAgICAgICAvLyBDaGVjayBpZiBhbiBvc2V4cCBzY3JpcHQgaXMgZ2l2ZW4gYXMgcGFyYW1ldGVyLiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2NyaXB0ICE9PSBudWxsKSB7XHRcclxuICAgICAgICAgICAgICAgIC8vIFN0YXJ0IGJ1aWxkaW5nIHRoZSBleHBlcmltZW50IHN0cnVjdHVyZS4gICAgICBcclxuXHRcdHRoaXMuX2J1aWxkRXhwZXJpbWVudCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGFuIG9zZXhwIGZpbGUgaXMgZ2l2ZW4gYXMgcGFyYW1ldGVyLiBcclxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5maWxlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXR1cFNjcmlwdEZyb21GaWxlKCk7XHJcbiAgICAgICAgICAgIH1cdFxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIFJldHJpZXZlIHRoZSBzY3JpcHQgZnJvbSBhbiBleHRlcm5hbCBsb2NhdGlvbi5cclxuXHRcdHRoaXMuX3NldHVwU2NyaXB0RnJvbURhdGFiYXNlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHR9XHJcblx0ZWxzZSB7XHJcbiAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKG9zd2ViLmNvbnN0YW50cy5FUlJPUl8wMDMpO1xyXG5cdH1cclxuICAgIH07XHJcblxyXG4gICAgcnVubmVyLl9zZXR1cFNjcmlwdEZyb21GaWxlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgZm9yIGJpbmFyeSBvciB0ZXh0IGZpbGUgZGVmaW5pdGlvbi5cclxuICAgICAgICBpZiAodGhpcy5maWxlLnN1YnN0cmluZygwLDMpID09ICctLS0nKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2NyaXB0ID0gU3RyaW5nKHRoaXMuZmlsZSk7XHJcbiAgICAgICAgfSBcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gRGVjb21wcmVzcyB0aGUgZ2l6cCBmaWxlIGFuZCBzcGxpdHQgdGhlIHRhciByZXN1bHQuXHRcclxuICAgICAgICAgICAgR1ppcC5sb2FkbG9jYWwodGhpcy5maWxlLCBmdW5jdGlvbihoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGFyID0gbmV3IFRhckdaO1xyXG4gICAgICAgICAgICAgICAgdGFyLnBhcnNlVGFyKGguZGF0YS5qb2luKCcnKSk7XHJcbiAgICAgICAgICAgICAgICB0YXIuZmlsZXMuZm9yRWFjaCh0aGlzLnNldHVwU2NyaXB0RnJvbUZpbGVSZXN1bHQuYmluZCh0aGlzKSk7IFxyXG4gICAgICAgICAgICB9LmJpbmQodGhpcyksIHRoaXMuc2V0dXBTY3JpcHRGcm9tRmlsZVByb2dyZXNzLCB0aGlzLnNldHVwU2NyaXB0RnJvbUZpbGVBbGVydCk7XHJcbiAgICAgICAgfSAgICBcclxuICAgICAgICBcclxuICAgICAgICAvLyBTdGFydCBidWlsZGluZyB0aGUgZXhwZXJpbWVudCBzdHJ1Y3R1cmUuICAgICAgXHJcblx0dGhpcy5fYnVpbGRFeHBlcmltZW50KCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHJ1bm5lci5zZXR1cFNjcmlwdEZyb21GaWxlQWxlcnQgPSBmdW5jdGlvbigpIHtcclxuICAgIH07XHJcblxyXG4gICAgcnVubmVyLnNldHVwU2NyaXB0RnJvbUZpbGVQcm9ncmVzcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgfTtcclxuXHJcbiAgICBydW5uZXIuc2V0dXBTY3JpcHRGcm9tRmlsZVJlc3VsdCA9IGZ1bmN0aW9uKHBGaWxlKSB7XHJcblx0Ly8gQ2hlY2sgaWYgdGhlIGZpbGUgaXMgdGhlIHNjcmlwdGZpbGUuXHJcbiAgICBcdGlmIChwRmlsZS5maWxlbmFtZSA9PT0gJ3NjcmlwdC5vcGVuc2VzYW1lJykge1xyXG4gICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHNjcmlwdC5cclxuICAgICAgICAgICAgdGhpcy5zY3JpcHQgPSBTdHJpbmcocEZpbGUuZGF0YSk7XHJcbiAgIFx0fVxyXG5cdGVsc2UgaWYgKChwRmlsZS5kYXRhICE9PSBudWxsKSAmJiAocEZpbGUuZGF0YSAhPT0gJycpKSB7XHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGZpbGUgcG9vbCBlbGVtZW50LlxyXG4gICAgICAgICAgICBvc3dlYi5wb29sLmFkZF9mcm9tX2xvY2FsX3NvdXJjZShwRmlsZSk7XHRcdFx0XHJcblx0fVxyXG4gICAgfTtcclxuXHJcbiAgICBydW5uZXIuX3NldHVwU2NyaXB0RnJvbURhdGFiYXNlID0gZnVuY3Rpb24oKSB7XHJcblx0Ly8gQ2hlY2sgaWYgdGhlIFVSTCBhbmQgSUQgaXMgcHJvcGVydGx5IGRlZmluZWQuXHJcbiAgICAgICBcdGlmICgodGhpcy5zY3JpcHRJRCA+PSAwKSAmJiAodGhpcy5zY3JpcHRVUkwgIT09ICcnKSkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gdGhpcy5zY3JpcHRVUkwgKyAnL3BocC9pbmRleC5waHA/L2FqYXgvZ3JvdXAvZ2V0X3N0YXR1cyc7XHJcbiAgICAgICAgICAgIHZhciBwYXJhbWV0ZXJzID0ge2dyb3VwX2lkOiA5OSwgdGFza19udW1iZXI6IHRoaXMuc2NyaXB0SUR9O1xyXG5cdFx0XHJcbiAgICAgICAgICAgIG5ldyBBamF4LlJlcXVlc3QodXJsLCB7XHJcbiAgICAgICAgICAgIFx0cGFyYW1ldGVyczogcGFyYW1ldGVycyxcclxuXHRcdG9uQ3JlYXRlOiBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0ID0gcmVzcG9uc2UudHJhbnNwb3J0O1xyXG4gICAgICAgICAgICAgICAgICAgIHQuc2V0UmVxdWVzdEhlYWRlciA9IHQuc2V0UmVxdWVzdEhlYWRlci53cmFwKGZ1bmN0aW9uKG9yaWdpbmFsLCBrLCB2KSB7XHJcblx0XHRcdGlmICgvXihhY2NlcHR8YWNjZXB0LWxhbmd1YWdlfGNvbnRlbnQtbGFuZ3VhZ2UpJC9pLnRlc3QoaykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWwoaywgdik7XHJcblx0XHRcdGlmICgvXmNvbnRlbnQtdHlwZSQvaS50ZXN0KGspICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvXihhcHBsaWNhdGlvblxcL3gtd3d3LWZvcm0tdXJsZW5jb2RlZHxtdWx0aXBhcnRcXC9mb3JtLWRhdGF8dGV4dFxcL3BsYWluKSg7LispPyQvaS50ZXN0KHYpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsKGssIHYpO1xyXG5cdFx0XHRyZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblx0XHR9LFxyXG5cdFx0b25TdWNjZXNzOiBmdW5jdGlvbih0cmFuc3BvcnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIHRoZSByZXNwb25zZVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmFuc3BvcnQucmVzcG9uc2VUZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJldHJpZXZlIHRoZSByZXNwb25zZSB0ZXh0LlxyXG5cdFx0XHR2YXIganNvbnJlc3BvbnNlID0gSlNPTi5wYXJzZSh0cmFuc3BvcnQucmVzcG9uc2VUZXh0KTtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHQvLyBDaGVjayBpZiB0aGUgdGFzayBpcyBhdmFpbGFibGUuXHJcblx0XHRcdGlmIChqc29ucmVzcG9uc2UudGFza19hdmFpbGFibGUgPT09ICcxJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzY3JpcHQgcGFyYW1ldGVyLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JpcHQgPSBqc29ucmVzcG9uc2UuZGF0YV9hdmFpbGFibGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVzICA9IGpzb25yZXNwb25zZS5maWxlX2F2YWlsYWJsZS5zcGxpdCgnXFxyXFxuJyk7ICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhIGZpbGUgcG9vbCBlbGVtZW50LlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3N3ZWIucG9vbC5hZGRfZnJvbV9zZXJ2ZXJfc291cmNlKHRoaXMuc2NyaXB0VVJMICsgJy91c2VyLzQvJywgdGhpcy5maWxlcyk7XHRcdFx0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHRcdFx0ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTaG93IGVyb3JyIG1lc3NhZ2Ugd2l0aGluIHRoZSBjb25jb2xlLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3N3ZWIuZGVidWcuYWRkRXJyb3Iob3N3ZWIuY29uc3RhbnRzLkVSUk9SXzAwNyk7XHJcblx0XHRcdH1cclxuICAgICAgICAgICAgICAgICAgICB9XHRcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuXHRcdFx0Ly8gU2hvdyBlcm9yciBtZXNzYWdlIHdpdGhpbiB0aGUgY29uY29sZS5cclxuXHRcdFx0b3N3ZWIuZGVidWcuYWRkRXJyb3Iob3N3ZWIuY29uc3RhbnRzLkVSUk9SXzAwNik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cdFx0fS5iaW5kKHRoaXMpLFxyXG5cdFx0b25GYWlsdXJlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBTaG93IGVyb3JyIG1lc3NhZ2Ugd2l0aGluIHRoZSBjb25jb2xlLlxyXG4gICAgICAgICAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKG9zd2ViLmNvbnN0YW50cy5FUlJPUl8wMDUpO1xyXG5cdFx0fS5iaW5kKHRoaXMpIFxyXG4gICAgICAgICAgICB9KTsgXHJcblx0fVxyXG5cdGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBTaG93IGVyb3JyIG1lc3NhZ2Ugd2l0aGluIHRoZSBjb25jb2xlLlxyXG4gICAgICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRFcnJvcihvc3dlYi5jb25zdGFudHMuRVJST1JfMDA0KTtcclxuXHR9IFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcyAtIEludHJvZHVjdGlvbiBzY3JlZW4uXHJcblxyXG4gICAgcnVubmVyLl9zZXR1cEludHJvU2NyZWVuID0gIGZ1bmN0aW9uKCkge1xyXG4gICAgXHQvLyBTZXQgdGhlIGludHJvc2NyZWVuIGVsZW1lbnRzLlxyXG5cdGlmICh0aGlzLnNjcmVlbkludHJvID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2ludHJvU2NyZWVuICA9IG5ldyBjcmVhdGVqcy5TaGFwZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9pbnRyb1NjcmVlbi5ncmFwaGljcy5iZWdpbkZpbGwoJyMwMDAwMDAnKS5kcmF3UmVjdCgwLDAsdGhpcy5fc3RhZ2Uud2lkdGgsdGhpcy5fc3RhZ2UuaGVpZ2h0KTtcclxuICAgICAgICAgICAgdGhpcy5faW50cm9MaW5lICAgID0gbmV3IGNyZWF0ZWpzLlNoYXBlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2ludHJvTGluZS5ncmFwaGljcy5iZWdpbkZpbGwoJyNBQUFBQUEnKS5kcmF3UmVjdCgyMDAsMTU1LDQwMCwxKTtcclxuICAgICAgICAgICAgdGhpcy5faW50cm9UZXh0MSAgID0gbmV3IGNyZWF0ZWpzLlRleHQoJ09TJywgXCIyNHB4IGJvbGQgVGltZXNcIiwgXCIjRkYwMDAwXCIpO1xyXG4gICAgICAgICAgICB0aGlzLl9pbnRyb1RleHQxLnggPSAyMDA7XHJcbiAgICAgICAgICAgIHRoaXMuX2ludHJvVGV4dDEueSA9IDEzNTtcclxuICAgICAgICAgICAgdGhpcy5faW50cm9UZXh0MiAgID0gbmV3IGNyZWF0ZWpzLlRleHQob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDAyICsgb3N3ZWIuVkVSU0lPTl9OVU1CRVIsIFwiMTRweCBBcmlhbFwiLCBcIiNGRkZGRkZcIik7XHJcbiAgICAgICAgICAgIHRoaXMuX2ludHJvVGV4dDIueCA9IDIzMTtcclxuICAgICAgICAgICAgdGhpcy5faW50cm9UZXh0Mi55ID0gMTQyO1xyXG4gICAgICAgICAgICB0aGlzLl9pbnRyb1RleHQzICAgPSBuZXcgY3JlYXRlanMuVGV4dChvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDMsXCIxMnB4IEFyaWFsXCIsIFwiI0ZGRkZGRlwiKTtcclxuICAgICAgICAgICAgdGhpcy5faW50cm9UZXh0My54ID0gMjAwO1xyXG4gICAgICAgICAgICB0aGlzLl9pbnRyb1RleHQzLnkgPSAxNjg7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YWdlLmFkZENoaWxkKHRoaXMuX2ludHJvU2NyZWVuLHRoaXMuX2ludHJvTGluZSx0aGlzLl9pbnRyb1RleHQxLHRoaXMuX2ludHJvVGV4dDIsdGhpcy5faW50cm9UZXh0Myk7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YWdlLnVwZGF0ZSgpO1xyXG5cdH1cclxuICAgIH07XHJcblx0XHJcbiAgICBydW5uZXIuX2NsZWFySW50cm9TY3JlZW4gPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgaW50cm9zY3JlZW4gZWxlbWVudHMuXHJcblx0aWYgKHRoaXMuc2NyZWVuSW50cm8gPT09IHRydWUpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhZ2UucmVtb3ZlQ2hpbGQodGhpcy5faW50cm9TY3JlZW4sdGhpcy5faW50cm9MaW5lLHRoaXMuX2ludHJvVGV4dDEsdGhpcy5faW50cm9UZXh0Mix0aGlzLl9pbnRyb1RleHQzKTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhZ2UudXBkYXRlKCk7XHJcblx0fVx0XHRcclxuICAgIH07XHJcblx0XHJcbiAgICBydW5uZXIuX3VwZGF0ZUludHJvU2NyZWVuID0gZnVuY3Rpb24odGV4dCkge1xyXG5cdC8vIFVwZGF0ZSB0aGUgaW50cm9zY3JlZW4gZWxlbWVudHMuXHJcblx0aWYgKHRoaXMuc2NyZWVuSW50cm8gPT09IHRydWUpIHtcclxuICAgICAgICAgICAgdGhpcy5faW50cm9UZXh0My50ZXh0ID0gdGV4dDtcclxuICAgICAgICAgICAgdGhpcy5fc3RhZ2UudXBkYXRlKCk7XHJcblx0fVx0XHRcclxuICAgIH07XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgcHJpdmF0ZSBtZXRob2RzIC0gYnVpbGQgY3ljbGUuICAgICAgXHJcblxyXG4gICAgcnVubmVyLl9idWlsZEV4cGVyaW1lbnQgPSBmdW5jdGlvbigpIHtcclxuICAgIFx0Ly8gQnVpbGQgdGhlIGJhc2UgZXhwZXJpbWVudCBvYmplY3QuXHJcblx0dGhpcy5leHBlcmltZW50ID0gbmV3IG9zd2ViLmV4cGVyaW1lbnQobnVsbCwgJ3Rlc3QnLCB0aGlzLnNjcmlwdCk7XHJcblx0XHJcbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBnbG9iYWwgc3RhdGljIG9iamVjdCBjbGFzc2VzLlxyXG5cdHdpbmRvd1snaXRlbXMnXSA9IG9zd2ViLml0ZW1fc3RvcmU7XHJcblx0d2luZG93Wydwb29sJ10gID0gb3N3ZWIuZmlsZV9wb2xlX3N0b3JlO1xyXG5cdHdpbmRvd1sndmFycyddICA9IHRoaXMuZXhwZXJpbWVudC52YXJzO1xyXG5cdFx0XHJcblx0Ly8gUGVwYXJlIHRoZSBleHBlcmltZW50IHRvIHJ1bi5cclxuXHR0aGlzLl9wcmVwYXJlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBtZXRob2RzIC0gcHJlcGFyZSBjeWNsZS4gICBcclxuXHJcbiAgICBydW5uZXIuX3ByZXBhcmUgPSBmdW5jdGlvbigpIHtcclxuXHQvLyBVcGRhdGUgaW5yb3NjcmVlbi5cclxuXHR0aGlzLl91cGRhdGVJbnRyb1NjcmVlbihvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDQpO1xyXG5cdFx0XHJcblx0Ly8gU3RhcnQgdGhlIHN0aW11bGkgbG9hZGVyLlxyXG5cdG9zd2ViLnBhcmFtZXRlcnMuX2luaXRpYWxpemUoKTtcclxuICAgICAgICBvc3dlYi5mdW5jdGlvbnMuX2luaXRpYWxpemUoKTtcclxuXHRvc3dlYi5weXRob25fd29ya3NwYWNlX2FwaS5faW5pdGlhbGl6ZSgpO1xyXG4gICAgICAgIG9zd2ViLnNlc3Npb24uX2luaXRpYWxpemUoKTtcclxuXHJcbiAgICAgICAgLy8gU3RhcnQgdGhlIHBhcmFtZXRlciBzY3JlZW4gKHN1YmplY3QgbnVtYmVyKS5cclxuICAgICAgICB0aGlzLl9wcmVwYXJlUGFyYW1ldGVycygpO1xyXG4gICAgfTtcclxuXHJcbiAgICBydW5uZXIuX3ByZXBhcmVQYXJhbWV0ZXJzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gVXBkYXRlIGlucm9zY3JlZW4uXHJcblx0dGhpcy5fdXBkYXRlSW50cm9TY3JlZW4ob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA1KTtcclxuXHJcblx0Ly8gQ2hlY2sgaWYgaXRlbXMgbXVzdCBiZSBwcm9jZXNzZWQuIFxyXG5cdGlmIChvc3dlYi5wYXJhbWV0ZXJzLl9wYXJhbWV0ZXJzLmxlbmd0aCA+IDApIHtcclxuXHRcdC8vIFByb2Nlc3MgdGhlIFBhcmFtZXRlcnMuICAgICAgICBcclxuICAgXHQgICAgb3N3ZWIucGFyYW1ldGVycy5fcHJvY2Vzc1BhcmFtZXRlcnMoKTtcclxuXHR9XHJcblx0ZWxzZSB7IFxyXG4gICAgICAgICAgICAvLyBTdGFydCB0aGUgZXhwZXJpbWVudC5cclxuICAgXHQgICAgdGhpcy5fcHJlcGFyZVN0YXJ0U2NyZWVuKCk7XHJcblx0fVxyXG4gICAgfTtcclxuXHJcbiAgICBydW5uZXIuX3ByZXBhcmVTdGFydFNjcmVlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBleHBlcmltZW50IG11c3QgYmUgY2xpY2tlZCB0byBzdGFydC5cclxuICAgICAgICBpZiAodGhpcy5zY3JlZW5DbGljayA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAvLyBVcGRhdGUgaW5yb3NjcmVlbi5cclxuICAgICAgICAgICAgdGhpcy5fdXBkYXRlSW50cm9TY3JlZW4ob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA2KTtcclxuXHRcdFxyXG4gICAgICAgICAgICAvLyBTZXR1cCB0aGUgbW91c2UgY2xpY2sgcmVzcG9uc2UgaGFuZGxlci5cclxuICAgICAgICAgICAgdmFyIGNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcblx0XHQvLyBSZW1vdmUgdGhlIGhhbmRsZXIuXHJcblx0XHR0aGlzLl9jYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNsaWNrSGFuZGxlcik7XHJcblxyXG5cdFx0Ly8gRmluYWxpemUgdGhlIGludHJvc2NyZWVuIGVsZW1lbnRzLlxyXG5cdFx0dGhpcy5fY2xlYXJJbnRyb1NjcmVlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFN0YXJ0IHRoZSB0YXNrLlxyXG5cdFx0dGhpcy5faW5pdGlhbGl6ZSgpO1xyXG4gICAgICAgICAgICB9LmJpbmQodGhpcyk7IFxyXG5cclxuICAgICAgICAgICAgLy8gU2V0IHRoZSB0ZW1wb3JhcnkgbW91c2UgY2xpY2suXHJcbiAgICAgICAgICAgIHRoaXMuX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2xpY2tIYW5kbGVyLCBmYWxzZSk7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBGaW5hbGl6ZSB0aGUgaW50cm9zY3JlZW4gZWxlbWVudHMuXHJcbiAgICAgICAgICAgIHRoaXMuX2NsZWFySW50cm9TY3JlZW4oKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFN0YXJ0IHRoZSBydW5uZXIuXHJcbiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemUoKTsgXHJcblx0fVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcyAtIHJ1biBjeWNsZS4gICBcclxuICAgIFxyXG4gICAgcnVubmVyLl9pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XHJcblx0Ly8gSW5pdGlhbGl6ZSB0aGUgZGVidWdnZXIuIFxyXG5cdG9zd2ViLmRlYnVnLl9pbml0aWFsaXplKCk7XHJcblxyXG4gICAgICAgIC8vIEluaXRpYWxpemUgdGhlIGRldmljZXMuXHJcblx0b3N3ZWIuZXZlbnRzLl9pbml0aWFsaXplKCk7XHJcblxyXG4gICAgICAgIC8vIFByZXBhcmUgYW5kIGV4ZWN1dGUgdGhlIGV4cGVyaW1lbnQgaXRlbS5cclxuXHR0aGlzLmV4cGVyaW1lbnQucHJlcGFyZSgpO1xyXG5cdHRoaXMuZXhwZXJpbWVudC5ydW4oKTtcclxuICAgIH07XHJcblx0XHJcbiAgICBydW5uZXIuX2ZpbmFsaXplID0gZnVuY3Rpb24oKSB7ICAgXHJcbiAgICAgICAgLy8gRmluYWxpemUgdGhlIGRldmljZXMuXHJcbiAgICBcdG9zd2ViLmV2ZW50cy5fZmluYWxpemUoKTtcclxuICAgICAgICBcclxuICAgIFx0Ly8gRmluYWxpemUgdGhlIGRlYnVnZ2VyLiBcclxuXHRvc3dlYi5kZWJ1Zy5fZmluYWxpemUoKTtcclxuXHJcbiAgICAgICAgLy8gRXhpdCB0aGUgYXBwbGljYXRpb24uXHJcbiAgICAgICAgdGhpcy5fZXhpdCgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBydW5uZXIuX2V4aXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBDbGVhciB0aGUgY2FudmFzLlxyXG4gICAgICAgIHRoaXMuX3N0YWdlLmNsZWFyKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHRoZSBjdXJzb3IgdmlzaWJpbGl0eSB0byBkZWZhdWx0LlxyXG4gICAgICAgIHRoaXMuX3N0YWdlLmNhbnZhcy5zdHlsZS5jdXJzb3IgPSBcImRlZmF1bHRcIjtcclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgYW4gZXZlbnQgaGFuZGxlciBpcyBhdHRhY2hlZC5cclxuXHRpZiAodGhpcy5vbkZpbmlzaGVkKSB7XHJcbiAgICAgICAgICAgIC8vIEV4ZWN1dGUuXHJcbiAgICAgICAgICAgIHRoaXMub25GaW5pc2hlZCh0aGlzLmRhdGEsIG9zd2ViLnNlc3Npb24uX3Nlc3Npb24pO1xyXG5cdH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHJ1biBjeWNsZS4gICAgICBcclxuXHJcbiAgICBydW5uZXIucnVuID0gZnVuY3Rpb24oY29udGVudCwgY29udGV4dCkge1xyXG4gICAgICAgIC8vIEluaXRpYWxpemUgdGhlIGNvbnRlbnQgY29udGFpbmVyLlxyXG5cdHRoaXMuX3NldHVwQ29udGVudChjb250ZW50KTtcclxuXHJcblx0Ly8gSW5pdGlhbGl6ZSB0aGUgY29udGV4dCBwYXJhbWV0ZXJcclxuXHR0aGlzLl9zZXR1cENvbnRleHQoY29udGV4dCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIHJ1bm5lciBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIucnVubmVyID0gcnVubmVyO1xyXG59KCkpOyBcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
